(self.webpackChunkpcmap=self.webpackChunkpcmap||[]).push([[179],{196:(Ud,cc,uc)=>{"use strict";function Bn(t){return"function"==typeof t}function _h(t){const r=t(a=>{Error.call(a),a.stack=(new Error).stack});return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}const $d=_h(t=>function(r){t(this),this.message=r?`${r.length} errors occurred during unsubscription:\n${r.map((a,h)=>`${h+1}) ${a.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=r});function d(t,n){if(t){const r=t.indexOf(n);0<=r&&t.splice(r,1)}}class Jn{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:r}=this;if(r)if(this._parentage=null,Array.isArray(r))for(const g of r)g.remove(this);else r.remove(this);const{initialTeardown:a}=this;if(Bn(a))try{a()}catch(g){n=g instanceof $d?g.errors:[g]}const{_teardowns:h}=this;if(h){this._teardowns=null;for(const g of h)try{Ke(g)}catch(b){n=null!=n?n:[],b instanceof $d?n=[...n,...b.errors]:n.push(b)}}if(n)throw new $d(n)}}add(n){var r;if(n&&n!==this)if(this.closed)Ke(n);else{if(n instanceof Jn){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._teardowns=null!==(r=this._teardowns)&&void 0!==r?r:[]).push(n)}}_hasParent(n){const{_parentage:r}=this;return r===n||Array.isArray(r)&&r.includes(n)}_addParent(n){const{_parentage:r}=this;this._parentage=Array.isArray(r)?(r.push(n),r):r?[r,n]:n}_removeParent(n){const{_parentage:r}=this;r===n?this._parentage=null:Array.isArray(r)&&d(r,n)}remove(n){const{_teardowns:r}=this;r&&d(r,n),n instanceof Jn&&n._removeParent(this)}}Jn.EMPTY=(()=>{const t=new Jn;return t.closed=!0,t})();const Ao=Jn.EMPTY;function ei(t){return t instanceof Jn||t&&"closed"in t&&Bn(t.remove)&&Bn(t.add)&&Bn(t.unsubscribe)}function Ke(t){Bn(t)?t():t.unsubscribe()}const yt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ae={setTimeout(...t){const{delegate:n}=Ae;return((null==n?void 0:n.setTimeout)||setTimeout)(...t)},clearTimeout(t){const{delegate:n}=Ae;return((null==n?void 0:n.clearTimeout)||clearTimeout)(t)},delegate:void 0};function mi(t){Ae.setTimeout(()=>{const{onUnhandledError:n}=yt;if(!n)throw t;n(t)})}function Tn(){}const ll=Zi("C",void 0,void 0);function Zi(t,n,r){return{kind:t,value:n,error:r}}let fr=null;function Po(t){if(yt.useDeprecatedSynchronousErrorHandling){const n=!fr;if(n&&(fr={errorThrown:!1,error:null}),t(),n){const{errorThrown:r,error:a}=fr;if(fr=null,r)throw a}}else t()}class ko extends Jn{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,ei(n)&&n.add(this)):this.destination=hl}static create(n,r,a){return new Ss(n,r,a)}next(n){this.isStopped?Wi(function cl(t){return Zi("N",t,void 0)}(n),this):this._next(n)}error(n){this.isStopped?Wi(function ti(t){return Zi("E",void 0,t)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?Wi(ll,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class Ss extends ko{constructor(n,r,a){let h;if(super(),Bn(n))h=n;else if(n){let g;({next:h,error:r,complete:a}=n),this&&yt.useDeprecatedNextContext?(g=Object.create(n),g.unsubscribe=()=>this.unsubscribe()):g=n,h=null==h?void 0:h.bind(g),r=null==r?void 0:r.bind(g),a=null==a?void 0:a.bind(g)}this.destination={next:h?Fo(h):Tn,error:Fo(null!=r?r:ul),complete:a?Fo(a):Tn}}}function Fo(t,n){return(...r)=>{try{t(...r)}catch(a){yt.useDeprecatedSynchronousErrorHandling?function ao(t){yt.useDeprecatedSynchronousErrorHandling&&fr&&(fr.errorThrown=!0,fr.error=t)}(a):mi(a)}}}function ul(t){throw t}function Wi(t,n){const{onStoppedNotification:r}=yt;r&&Ae.setTimeout(()=>r(t,n))}const hl={closed:!0,next:Tn,error:ul,complete:Tn},os="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ro(t){return t}let wn=(()=>{class t{constructor(r){r&&(this._subscribe=r)}lift(r){const a=new t;return a.source=this,a.operator=r,a}subscribe(r,a,h){const g=function ba(t){return t&&t instanceof ko||function lo(t){return t&&Bn(t.next)&&Bn(t.error)&&Bn(t.complete)}(t)&&ei(t)}(r)?r:new Ss(r,a,h);return Po(()=>{const{operator:b,source:T}=this;g.add(b?b.call(g,T):T?this._subscribe(g):this._trySubscribe(g))}),g}_trySubscribe(r){try{return this._subscribe(r)}catch(a){r.error(a)}}forEach(r,a){return new(a=As(a))((h,g)=>{let b;b=this.subscribe(T=>{try{r(T)}catch(I){g(I),null==b||b.unsubscribe()}},g,h)})}_subscribe(r){var a;return null===(a=this.source)||void 0===a?void 0:a.subscribe(r)}[os](){return this}pipe(...r){return function Xi(t){return 0===t.length?Ro:1===t.length?t[0]:function(r){return t.reduce((a,h)=>h(a),r)}}(r)(this)}toPromise(r){return new(r=As(r))((a,h)=>{let g;this.subscribe(b=>g=b,b=>h(b),()=>a(g))})}}return t.create=n=>new t(n),t})();function As(t){var n;return null!==(n=null!=t?t:yt.Promise)&&void 0!==n?n:Promise}const Ut=_h(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let wa=(()=>{class t extends wn{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(r){const a=new ss(this,this);return a.operator=r,a}_throwIfClosed(){if(this.closed)throw new Ut}next(r){Po(()=>{if(this._throwIfClosed(),!this.isStopped){const a=this.observers.slice();for(const h of a)h.next(r)}})}error(r){Po(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=r;const{observers:a}=this;for(;a.length;)a.shift().error(r)}})}complete(){Po(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:r}=this;for(;r.length;)r.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var r;return(null===(r=this.observers)||void 0===r?void 0:r.length)>0}_trySubscribe(r){return this._throwIfClosed(),super._trySubscribe(r)}_subscribe(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)}_innerSubscribe(r){const{hasError:a,isStopped:h,observers:g}=this;return a||h?Ao:(g.push(r),new Jn(()=>d(g,r)))}_checkFinalizedStatuses(r){const{hasError:a,thrownError:h,isStopped:g}=this;a?r.error(h):g&&r.complete()}asObservable(){const r=new wn;return r.source=this,r}}return t.create=(n,r)=>new ss(n,r),t})();class ss extends wa{constructor(n,r){super(),this.destination=n,this.source=r}next(n){var r,a;null===(a=null===(r=this.destination)||void 0===r?void 0:r.next)||void 0===a||a.call(r,n)}error(n){var r,a;null===(a=null===(r=this.destination)||void 0===r?void 0:r.error)||void 0===a||a.call(r,n)}complete(){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===r||r.call(n)}_subscribe(n){var r,a;return null!==(a=null===(r=this.source)||void 0===r?void 0:r.subscribe(n))&&void 0!==a?a:Ao}}function Lo(t){return n=>{if(function Ps(t){return Bn(null==t?void 0:t.lift)}(n))return n.lift(function(r){try{return t(r,this)}catch(a){this.error(a)}});throw new TypeError("Unable to lift unknown Observable type")}}class Si extends ko{constructor(n,r,a,h,g){super(n),this.onFinalize=g,this._next=r?function(b){try{r(b)}catch(T){n.error(T)}}:super._next,this._error=h?function(b){try{h(b)}catch(T){n.error(T)}finally{this.unsubscribe()}}:super._error,this._complete=a?function(){try{a()}catch(b){n.error(b)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;const{closed:r}=this;super.unsubscribe(),!r&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}function Vr(t,n){return Lo((r,a)=>{let h=0;r.subscribe(new Si(a,g=>{a.next(t.call(n,g,h++))}))})}function Ai(t){return this instanceof Ai?(this.v=t,this):new Ai(t)}function Nn(t,n,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var h,a=r.apply(t,n||[]),g=[];return h={},b("next"),b("throw"),b("return"),h[Symbol.asyncIterator]=function(){return this},h;function b(ee){a[ee]&&(h[ee]=function(oe){return new Promise(function(ge,Re){g.push([ee,oe,ge,Re])>1||T(ee,oe)})})}function T(ee,oe){try{!function I(ee){ee.value instanceof Ai?Promise.resolve(ee.value.v).then(k,B):$(g[0][2],ee)}(a[ee](oe))}catch(ge){$(g[0][3],ge)}}function k(ee){T("next",ee)}function B(ee){T("throw",ee)}function $(ee,oe){ee(oe),g.shift(),g.length&&T(g[0][0],g[0][1])}}function fl(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,n=t[Symbol.asyncIterator];return n?n.call(t):(t=function Ta(t){var n="function"==typeof Symbol&&Symbol.iterator,r=n&&t[n],a=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&&t[a++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r);function a(g){r[g]=t[g]&&function(b){return new Promise(function(T,I){!function h(g,b,T,I){Promise.resolve(I).then(function(k){g({value:k,done:T})},b)}(T,I,(b=t[g](b)).done,b.value)})}}}const Ls=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function _i(t){return Bn(null==t?void 0:t.then)}function _l(t){return Bn(t[os])}function Mn(t){return Symbol.asyncIterator&&Bn(null==t?void 0:t[Symbol.asyncIterator])}function yi(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Ki=function Ma(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function zs(t){return Bn(null==t?void 0:t[Ki])}function ls(t){return Nn(this,arguments,function*(){const r=t.getReader();try{for(;;){const{value:a,done:h}=yield Ai(r.read());if(h)return yield Ai(void 0);yield yield Ai(a)}}finally{r.releaseLock()}})}function co(t){return Bn(null==t?void 0:t.getReader)}function Sr(t){if(t instanceof wn)return t;if(null!=t){if(_l(t))return function cs(t){return new wn(n=>{const r=t[os]();if(Bn(r.subscribe))return r.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(Ls(t))return function uo(t){return new wn(n=>{for(let r=0;r<t.length&&!n.closed;r++)n.next(t[r]);n.complete()})}(t);if(_i(t))return function Ia(t){return new wn(n=>{t.then(r=>{n.closed||(n.next(r),n.complete())},r=>n.error(r)).then(null,mi)})}(t);if(Mn(t))return K(t);if(zs(t))return function vi(t){return new wn(n=>{for(const r of t)if(n.next(r),n.closed)return;n.complete()})}(t);if(co(t))return function L(t){return K(ls(t))}(t)}throw yi(t)}function K(t){return new wn(n=>{(function V(t,n){var r,a,h,g;return function gi(t,n,r,a){return new(r||(r=Promise))(function(g,b){function T(B){try{k(a.next(B))}catch($){b($)}}function I(B){try{k(a.throw(B))}catch($){b($)}}function k(B){B.done?g(B.value):function h(g){return g instanceof r?g:new r(function(b){b(g)})}(B.value).then(T,I)}k((a=a.apply(t,n||[])).next())})}(this,void 0,void 0,function*(){try{for(r=fl(t);!(a=yield r.next()).done;)if(n.next(a.value),n.closed)return}catch(b){h={error:b}}finally{try{a&&!a.done&&(g=r.return)&&(yield g.call(r))}finally{if(h)throw h.error}}n.complete()})})(t,n).catch(r=>n.error(r))})}function X(t,n,r,a=0,h=!1){const g=n.schedule(function(){r(),h?t.add(this.schedule(null,a)):this.unsubscribe()},a);if(t.add(g),!h)return g}function le(t,n,r=1/0){return Bn(n)?le((a,h)=>Vr((g,b)=>n(a,g,h,b))(Sr(t(a,h))),r):("number"==typeof n&&(r=n),Lo((a,h)=>function Y(t,n,r,a,h,g,b,T){const I=[];let k=0,B=0,$=!1;const ee=()=>{$&&!I.length&&!k&&n.complete()},oe=Re=>k<a?ge(Re):I.push(Re),ge=Re=>{g&&n.next(Re),k++;let He=!1;Sr(r(Re,B++)).subscribe(new Si(n,Ge=>{null==h||h(Ge),g?oe(Ge):n.next(Ge)},()=>{He=!0},void 0,()=>{if(He)try{for(k--;I.length&&k<a;){const Ge=I.shift();b?X(n,b,()=>ge(Ge)):ge(Ge)}ee()}catch(Ge){n.error(Ge)}}))};return t.subscribe(new Si(n,oe,()=>{$=!0,ee()})),()=>{null==T||T()}}(a,h,t,r)))}const fe=new wn(t=>t.complete());function Se(t){return t[t.length-1]}function nt(t){return function Me(t){return t&&Bn(t.schedule)}(Se(t))?t.pop():void 0}function lt(t,n=0){return Lo((r,a)=>{r.subscribe(new Si(a,h=>X(a,t,()=>a.next(h),n),()=>X(a,t,()=>a.complete(),n),h=>X(a,t,()=>a.error(h),n)))})}function ut(t,n=0){return Lo((r,a)=>{a.add(t.schedule(()=>r.subscribe(a),n))})}function En(t,n){if(!t)throw new Error("Iterable cannot be null");return new wn(r=>{X(r,n,()=>{const a=t[Symbol.asyncIterator]();X(r,n,()=>{a.next().then(h=>{h.done?r.complete():r.next(h.value)})},0,!0)})})}function $n(t,n){return n?function zo(t,n){if(null!=t){if(_l(t))return function It(t,n){return Sr(t).pipe(ut(n),lt(n))}(t,n);if(Ls(t))return function Cn(t,n){return new wn(r=>{let a=0;return n.schedule(function(){a===t.length?r.complete():(r.next(t[a++]),r.closed||this.schedule())})})}(t,n);if(_i(t))return function yn(t,n){return Sr(t).pipe(ut(n),lt(n))}(t,n);if(Mn(t))return En(t,n);if(zs(t))return function fn(t,n){return new wn(r=>{let a;return X(r,n,()=>{a=t[Ki](),X(r,n,()=>{let h,g;try{({value:h,done:g}=a.next())}catch(b){return void r.error(b)}g?r.complete():r.next(h)},0,!0)}),()=>Bn(null==a?void 0:a.return)&&a.return()})}(t,n);if(co(t))return function us(t,n){return En(ls(t),n)}(t,n)}throw yi(t)}(t,n):Sr(t)}function yl(t,n,...r){return!0===n?(t(),null):!1===n?null:n(...r).pipe(function mc(t){return t<=0?()=>fe:Lo((n,r)=>{let a=0;n.subscribe(new Si(r,h=>{++a<=t&&(r.next(h),t<=a&&r.complete())}))})}(1)).subscribe(()=>t())}function sn(t){for(let n in t)if(t[n]===sn)return n;throw Error("Could not find renamed property on target object.")}function nn(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(nn).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const n=t.toString();if(null==n)return""+n;const r=n.indexOf("\n");return-1===r?n:n.substring(0,r)}function Sa(t,n){return null==t||""===t?null===n?"":n:null==n||""===n?t:t+" "+n}const xl=sn({__forward_ref__:sn});function bl(t){return t.__forward_ref__=bl,t.toString=function(){return nn(this())},t}function mt(t){return function Aa(t){return"function"==typeof t&&t.hasOwnProperty(xl)&&t.__forward_ref__===bl}(t)?t():t}class an extends Error{constructor(n,r){super(function gc(t,n){return`NG0${Math.abs(t)}${n?": "+n:""}`}(n,r)),this.code=n}}function vt(t){return"string"==typeof t?t:null==t?"":String(t)}function Yn(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():vt(t)}function Os(t,n){const r=n?` in ${n}`:"";throw new an(-201,`No provider for ${Yn(t)} found${r}`)}function gt(t,n){null==t&&function it(t,n,r,a){throw new Error(`ASSERTION ERROR: ${t}`+(null==a?"":` [Expected=> ${r} ${a} ${n} <=Actual]`))}(n,t,null,"!=")}function en(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function ki(t){return{providers:t.providers||[],imports:t.imports||[]}}function ni(t){return In(t,No)||In(t,Vs)}function In(t,n){return t.hasOwnProperty(n)?t[n]:null}function Dl(t){return t&&(t.hasOwnProperty(fs)||t.hasOwnProperty(Ht))?t[fs]:null}const No=sn({\u0275prov:sn}),fs=sn({\u0275inj:sn}),Vs=sn({ngInjectableDef:sn}),Ht=sn({ngInjectorDef:sn});var wt=(()=>((wt=wt||{})[wt.Default=0]="Default",wt[wt.Host=1]="Host",wt[wt.Self=2]="Self",wt[wt.SkipSelf=4]="SkipSelf",wt[wt.Optional=8]="Optional",wt))();let Tl;function lr(t){const n=Tl;return Tl=t,n}function cu(t,n,r){const a=ni(t);return a&&"root"==a.providedIn?void 0===a.value?a.value=a.factory():a.value:r&wt.Optional?null:void 0!==n?n:void Os(nn(t),"Injector")}function vn(t){return{toString:t}.toString()}var jr=(()=>((jr=jr||{})[jr.OnPush=0]="OnPush",jr[jr.Default=1]="Default",jr))(),xi=(()=>{return(t=xi||(xi={}))[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",xi;var t})();const Fi="undefined"!=typeof globalThis&&globalThis,fo="undefined"!=typeof window&&window,Us="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,$t=Fi||"undefined"!=typeof global&&global||fo||Us,mr={},ln=[],Ji=sn({\u0275cmp:sn}),Pa=sn({\u0275dir:sn}),$s=sn({\u0275pipe:sn}),hu=sn({\u0275mod:sn}),mo=sn({\u0275fac:sn}),Gs=sn({__NG_ELEMENT_ID__:sn});let xh=0;function ka(t){return vn(()=>{const r={},a={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:r,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===jr.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors||ln,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||xi.Emulated,id:"c",styles:t.styles||ln,_:null,setInput:null,schemas:t.schemas||null,tView:null},h=t.directives,g=t.features,b=t.pipes;return a.id+=xh++,a.inputs=fu(t.inputs,r),a.outputs=fu(t.outputs),g&&g.forEach(T=>T(a)),a.directiveDefs=h?()=>("function"==typeof h?h():h).map(du):null,a.pipeDefs=b?()=>("function"==typeof b?b():b).map(bh):null,a})}function du(t){return Hn(t)||function Ri(t){return t[Pa]||null}(t)}function bh(t){return function Yi(t){return t[$s]||null}(t)}const _c={};function ms(t){return vn(()=>{const n={type:t.type,bootstrap:t.bootstrap||ln,declarations:t.declarations||ln,imports:t.imports||ln,exports:t.exports||ln,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null};return null!=t.id&&(_c[t.id]=t.type),n})}function fu(t,n){if(null==t)return mr;const r={};for(const a in t)if(t.hasOwnProperty(a)){let h=t[a],g=h;Array.isArray(h)&&(g=h[1],h=h[0]),r[h]=a,n&&(n[h]=g)}return r}const bi=ka;function Hn(t){return t[Ji]||null}function Ur(t,n){const r=t[hu]||null;if(!r&&!0===n)throw new Error(`Type ${nn(t)} does not have '\u0275mod' property.`);return r}function Ei(t){return Array.isArray(t)&&"object"==typeof t[1]}function gr(t){return Array.isArray(t)&&!0===t[1]}function Ks(t){return 0!=(8&t.flags)}function Cl(t){return 2==(2&t.flags)}function Js(t){return 1==(1&t.flags)}function _r(t){return null!==t.template}function Eh(t){return 0!=(512&t[2])}function vo(t,n){return t.hasOwnProperty(mo)?t[mo]:null}class ep{constructor(n,r,a){this.previousValue=n,this.currentValue=r,this.firstChange=a}isFirstChange(){return this.firstChange}}function Ah(t){return t.type.prototype.ngOnChanges&&(t.setInput=La),xu}function xu(){const t=Oa(this),n=null==t?void 0:t.current;if(n){const r=t.previous;if(r===mr)t.previous=n;else for(let a in n)r[a]=n[a];t.current=null,this.ngOnChanges(n)}}function La(t,n,r,a){const h=Oa(t)||function bu(t,n){return t[za]=n}(t,{previous:mr,current:null}),g=h.current||(h.current={}),b=h.previous,T=this.declaredInputs[r],I=b[T];g[T]=new ep(I&&I.currentValue,n,b===mr),t[a]=n}const za="__ngSimpleChanges__";function Oa(t){return t[za]||null}let Sl;function An(t){return!!t.listen}const Du={createRenderer:(t,n)=>function Na(){return void 0!==Sl?Sl:"undefined"!=typeof document?document:void 0}()};function tr(t){for(;Array.isArray(t);)t=t[0];return t}function si(t,n){return tr(n[t.index])}function Tc(t,n){return t.data[n]}function Gr(t,n){const r=n[t];return Ei(r)?r:r[0]}function ea(t){return 128==(128&t[2])}function Go(t,n){return null==n?null:t[n]}function ja(t){t[18]=0}function vs(t,n){t[5]+=n;let r=t,a=t[3];for(;null!==a&&(1===n&&1===r[5]||-1===n&&0===r[5]);)a[5]+=n,r=a,a=a[3]}const xt={lFrame:O(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Cc(){return xt.bindingsEnabled}function Oe(){return xt.lFrame.lView}function Xt(){return xt.lFrame.tView}function Rn(){let t=ta();for(;null!==t&&64===t.type;)t=t.parent;return t}function ta(){return xt.lFrame.currentTNode}function Oi(t,n){const r=xt.lFrame;r.currentTNode=t,r.isParent=n}function Au(){return xt.lFrame.isParent}function Mc(){xt.lFrame.isParent=!1}function xs(){return xt.isInCheckNoChangesMode}function Ho(t){xt.isInCheckNoChangesMode=t}function ra(){return xt.lFrame.bindingIndex++}function o(t,n){const r=xt.lFrame;r.bindingIndex=r.bindingRootIndex=t,m(n)}function m(t){xt.lFrame.currentDirectiveIndex=t}function E(t){xt.lFrame.currentQueryIndex=t}function C(t){const n=t[1];return 2===n.type?n.declTNode:1===n.type?t[6]:null}function P(t,n,r){if(r&wt.SkipSelf){let h=n,g=t;for(;!(h=h.parent,null!==h||r&wt.Host||(h=C(g),null===h||(g=g[15],10&h.type))););if(null===h)return!1;n=h,t=g}const a=xt.lFrame=R();return a.currentTNode=n,a.lView=t,!0}function F(t){const n=R(),r=t[1];xt.lFrame=n,n.currentTNode=r.firstChild,n.lView=t,n.tView=r,n.contextLView=t,n.bindingIndex=r.bindingStartIndex,n.inI18n=!1}function R(){const t=xt.lFrame,n=null===t?null:t.child;return null===n?O(t):n}function O(t){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=n),n}function j(){const t=xt.lFrame;return xt.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const Z=j;function H(){const t=j();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function G(){return xt.lFrame.selectedIndex}function ne(t){xt.lFrame.selectedIndex=t}function Le(t,n){for(let r=n.directiveStart,a=n.directiveEnd;r<a;r++){const g=t.data[r].type.prototype,{ngAfterContentInit:b,ngAfterContentChecked:T,ngAfterViewInit:I,ngAfterViewChecked:k,ngOnDestroy:B}=g;b&&(t.contentHooks||(t.contentHooks=[])).push(-r,b),T&&((t.contentHooks||(t.contentHooks=[])).push(r,T),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(r,T)),I&&(t.viewHooks||(t.viewHooks=[])).push(-r,I),k&&((t.viewHooks||(t.viewHooks=[])).push(r,k),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(r,k)),null!=B&&(t.destroyHooks||(t.destroyHooks=[])).push(r,B)}}function ke(t,n,r){Fe(t,n,3,r)}function be(t,n,r,a){(3&t[2])===r&&Fe(t,n,r,a)}function ve(t,n){let r=t[2];(3&r)===n&&(r&=2047,r+=1,t[2]=r)}function Fe(t,n,r,a){const g=null!=a?a:-1,b=n.length-1;let T=0;for(let I=void 0!==a?65535&t[18]:0;I<b;I++)if("number"==typeof n[I+1]){if(T=n[I],null!=a&&T>=a)break}else n[I]<0&&(t[18]+=65536),(T<g||-1==g)&&(Ie(t,r,n,I),t[18]=(4294901760&t[18])+I+2),I++}function Ie(t,n,r,a){const h=r[a]<0,g=r[a+1],T=t[h?-r[a]:r[a]];if(h){if(t[2]>>11<t[18]>>16&&(3&t[2])===n){t[2]+=2048;try{g.call(T)}finally{}}}else try{g.call(T)}finally{}}class at{constructor(n,r,a){this.factory=n,this.resolving=!1,this.canSeeViewProviders=r,this.injectImpl=a}}function gn(t,n,r){const a=An(t);let h=0;for(;h<r.length;){const g=r[h];if("number"==typeof g){if(0!==g)break;h++;const b=r[h++],T=r[h++],I=r[h++];a?t.setAttribute(n,T,I,b):n.setAttributeNS(b,T,I)}else{const b=g,T=r[++h];kr(b)?a&&t.setProperty(n,b,T):a?t.setAttribute(n,b,T):n.setAttribute(b,T),h++}}return h}function Zn(t){return 3===t||4===t||6===t}function kr(t){return 64===t.charCodeAt(0)}function qr(t,n){if(null!==n&&0!==n.length)if(null===t||0===t.length)t=n.slice();else{let r=-1;for(let a=0;a<n.length;a++){const h=n[a];"number"==typeof h?r=h:0===r||Bi(t,r,h,null,-1===r||2===r?n[++a]:null)}}return t}function Bi(t,n,r,a,h){let g=0,b=t.length;if(-1===n)b=-1;else for(;g<t.length;){const T=t[g++];if("number"==typeof T){if(T===n){b=-1;break}if(T>n){b=g-1;break}}}for(;g<t.length;){const T=t[g];if("number"==typeof T)break;if(T===r){if(null===a)return void(null!==h&&(t[g+1]=h));if(a===t[g+1])return void(t[g+2]=h)}g++,null!==a&&g++,null!==h&&g++}-1!==b&&(t.splice(b,0,n),g=b+1),t.splice(g++,0,r),null!==a&&t.splice(g++,0,a),null!==h&&t.splice(g++,0,h)}function Nt(t){return-1!==t}function pt(t){return 32767&t}function bn(t,n){let r=function Lt(t){return t>>16}(t),a=n;for(;r>0;)a=a[15],r--;return a}let Zr=!0;function hn(t){const n=Zr;return Zr=t,n}let ia=0;function st(t,n){const r=qo(t,n);if(-1!==r)return r;const a=n[1];a.firstCreatePass&&(t.injectorIndex=n.length,nr(a.data,t),nr(n,null),nr(a.blueprint,null));const h=eo(t,n),g=t.injectorIndex;if(Nt(h)){const b=pt(h),T=bn(h,n),I=T[1].data;for(let k=0;k<8;k++)n[g+k]=T[b+k]|I[b+k]}return n[g+8]=h,g}function nr(t,n){t.push(0,0,0,0,0,0,0,0,n)}function qo(t,n){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===n[t.injectorIndex+8]?-1:t.injectorIndex}function eo(t,n){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let r=0,a=null,h=n;for(;null!==h;){const g=h[1],b=g.type;if(a=2===b?g.declTNode:1===b?h[6]:null,null===a)return-1;if(r++,h=h[15],-1!==a.injectorIndex)return a.injectorIndex|r<<16}return-1}function rr(t,n,r){!function tt(t,n,r){let a;"string"==typeof r?a=r.charCodeAt(0)||0:r.hasOwnProperty(Gs)&&(a=r[Gs]),null==a&&(a=r[Gs]=ia++);const h=255&a;n.data[t+(h>>5)]|=1<<h}(t,n,r)}function Rf(t,n,r){if(r&wt.Optional)return t;Os(n,"NodeInjector")}function Sc(t,n,r,a){if(r&wt.Optional&&void 0===a&&(a=null),0==(r&(wt.Self|wt.Host))){const h=t[9],g=lr(void 0);try{return h?h.get(n,a,r&wt.Optional):cu(n,a,r&wt.Optional)}finally{lr(g)}}return Rf(a,n,r)}function jn(t,n,r,a=wt.Default,h){if(null!==t){const g=function Pc(t){if("string"==typeof t)return t.charCodeAt(0)||0;const n=t.hasOwnProperty(Gs)?t[Gs]:void 0;return"number"==typeof n?n>=0?255&n:Lf:n}(r);if("function"==typeof g){if(!P(n,t,a))return a&wt.Host?Rf(h,r,a):Sc(n,r,a,h);try{const b=g(a);if(null!=b||a&wt.Optional)return b;Os(r)}finally{Z()}}else if("number"==typeof g){let b=null,T=qo(t,n),I=-1,k=a&wt.Host?n[16][6]:null;for((-1===T||a&wt.SkipSelf)&&(I=-1===T?eo(t,n):n[T+8],-1!==I&&Pu(a,!1)?(b=n[1],T=pt(I),n=bn(I,n)):T=-1);-1!==T;){const B=n[1];if(sa(g,T,B.data)){const $=Ac(T,n,r,b,a,k);if($!==Pn)return $}I=n[T+8],-1!==I&&Pu(a,n[1].data[T+8]===k)&&sa(g,T,n)?(b=B,T=pt(I),n=bn(I,n)):T=-1}}}return Sc(n,r,a,h)}const Pn={};function Lf(){return new $a(Rn(),Oe())}function Ac(t,n,r,a,h,g){const b=n[1],T=b.data[t+8],B=function oa(t,n,r,a,h){const g=t.providerIndexes,b=n.data,T=1048575&g,I=t.directiveStart,B=g>>20,ee=h?T+B:t.directiveEnd;for(let oe=a?T:T+B;oe<ee;oe++){const ge=b[oe];if(oe<I&&r===ge||oe>=I&&ge.type===r)return oe}if(h){const oe=b[I];if(oe&&_r(oe)&&oe.type===r)return I}return null}(T,b,r,null==a?Cl(T)&&Zr:a!=b&&0!=(3&T.type),h&wt.Host&&g===T);return null!==B?Pl(n,b,B,T):Pn}function Pl(t,n,r,a){let h=t[r];const g=n.data;if(function Tt(t){return t instanceof at}(h)){const b=h;b.resolving&&function wl(t,n){const r=n?`. Dependency path: ${n.join(" > ")} > ${t}`:"";throw new an(-200,`Circular dependency in DI detected for ${t}${r}`)}(Yn(g[r]));const T=hn(b.canSeeViewProviders);b.resolving=!0;const I=b.injectImpl?lr(b.injectImpl):null;P(t,a,wt.Default);try{h=t[r]=b.factory(void 0,g,t,a),n.firstCreatePass&&r>=a.directiveStart&&function Ue(t,n,r){const{ngOnChanges:a,ngOnInit:h,ngDoCheck:g}=n.type.prototype;if(a){const b=Ah(n);(r.preOrderHooks||(r.preOrderHooks=[])).push(t,b),(r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(t,b)}h&&(r.preOrderHooks||(r.preOrderHooks=[])).push(0-t,h),g&&((r.preOrderHooks||(r.preOrderHooks=[])).push(t,g),(r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(t,g))}(r,g[r],n)}finally{null!==I&&lr(I),hn(T),b.resolving=!1,Z()}}return h}function sa(t,n,r){return!!(r[n+(t>>5)]&1<<t)}function Pu(t,n){return!(t&wt.Self||t&wt.Host&&n)}class $a{constructor(n,r){this._tNode=n,this._lView=r}get(n,r,a){return jn(this._tNode,this._lView,n,a,r)}}const Ha="__parameters__";function aa(t,n,r){return vn(()=>{const a=function Fu(t){return function(...r){if(t){const a=t(...r);for(const h in a)this[h]=a[h]}}}(n);function h(...g){if(this instanceof h)return a.apply(this,g),this;const b=new h(...g);return T.annotation=b,T;function T(I,k,B){const $=I.hasOwnProperty(Ha)?I[Ha]:Object.defineProperty(I,Ha,{value:[]})[Ha];for(;$.length<=B;)$.push(null);return($[B]=$[B]||[]).push(b),I}}return r&&(h.prototype=Object.create(r.prototype)),h.prototype.ngMetadataName=t,h.annotationCls=h,h})}class cn{constructor(n,r){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof r?this.__NG_ELEMENT_ID__=r:void 0!==r&&(this.\u0275prov=en({token:this,providedIn:r.providedIn||"root",factory:r.factory}))}toString(){return`InjectionToken ${this._desc}`}}function Zo(t,n){t.forEach(r=>Array.isArray(r)?Zo(r,n):n(r))}function Vf(t,n,r){n>=t.length?t.push(r):t.splice(n,0,r)}function zh(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}const no={},ca="__NG_DI_FLAG__",Bh="ngTempTokenPath",Xg=/\n/gm,cp="__source",Nh=sn({provide:String,useValue:sn});let Ti;function Uf(t){const n=Ti;return Ti=t,n}function Jg(t,n=wt.Default){if(void 0===Ti)throw new an(203,"");return null===Ti?cu(t,void 0,n):Ti.get(t,n&wt.Optional?null:void 0,n)}function ht(t,n=wt.Default){return(function Et(){return Tl}()||Jg)(mt(t),n)}const Ll=ht;function Vh(t){const n=[];for(let r=0;r<t.length;r++){const a=mt(t[r]);if(Array.isArray(a)){if(0===a.length)throw new an(900,"");let h,g=wt.Default;for(let b=0;b<a.length;b++){const T=a[b],I=$f(T);"number"==typeof I?-1===I?h=T.token:g|=I:h=T}n.push(ht(h,g))}else n.push(ht(a))}return n}function Kt(t,n){return t[ca]=n,t.prototype[ca]=n,t}function $f(t){return t[ca]}const ji=Kt(aa("Optional"),8),Ci=Kt(aa("SkipSelf"),4),Cp="__ngContext__";function hr(t,n){t[Cp]=n}function Mp(t){const n=function qu(t){return t[Cp]||null}(t);return n?Array.isArray(n)?n:n.lView:null}function Nl(t){return t.ngOriginalError}function pm(t,...n){t.error(...n)}class Xu{constructor(){this._console=console}handleError(n){const r=this._findOriginalError(n),a=function dm(t){return t&&t.ngErrorLogger||pm}(n);a(this._console,"ERROR",n),r&&a(this._console,"ORIGINAL ERROR",r)}_findOriginalError(n){let r=n&&Nl(n);for(;r&&Nl(r);)r=Nl(r);return r||null}}const _m=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind($t))();function Qo(t){return t instanceof Function?t():t}var li=(()=>((li=li||{})[li.Important=1]="Important",li[li.DashCase=2]="DashCase",li))();function Ip(t,n){return undefined(t,n)}function Ku(t){const n=t[3];return gr(n)?n[3]:n}function Kh(t){return dn(t[13])}function Vl(t){return dn(t[4])}function dn(t){for(;null!==t&&!gr(t);)t=t[4];return t}function jl(t,n,r,a,h){if(null!=a){let g,b=!1;gr(a)?g=a:Ei(a)&&(b=!0,a=a[0]);const T=tr(a);0===t&&null!==r?null==h?Qh(n,r,T):Ul(n,r,T,h||null,!0):1===t&&null!==r?Ul(n,r,T,h||null,!0):2===t?function id(t,n,r){const a=ci(t,n);a&&function Cm(t,n,r,a){An(t)?t.removeChild(n,r,a):n.removeChild(r)}(t,a,n,r)}(n,T,b):3===t&&n.destroyNode(T),null!=g&&function ha(t,n,r,a,h){const g=r[7];g!==tr(r)&&jl(n,t,a,g,h);for(let T=10;T<r.length;T++){const I=r[T];Wc(I[1],I,t,n,a,g)}}(n,t,g,r,h)}}function Yh(t,n,r){if(An(t))return t.createElement(n,r);{const a=null!==r?function Uo(t){const n=t.toLowerCase();return"svg"===n?"http://www.w3.org/2000/svg":"math"===n?"http://www.w3.org/1998/MathML/":null}(r):null;return null===a?t.createElement(n):t.createElementNS(a,n)}}function bm(t,n){const r=t[9],a=r.indexOf(n),h=n[3];1024&n[2]&&(n[2]&=-1025,vs(h,-1)),r.splice(a,1)}function Ap(t,n){if(t.length<=10)return;const r=10+n,a=t[r];if(a){const h=a[17];null!==h&&h!==t&&bm(h,a),n>0&&(t[r-1][4]=a[4]);const g=zh(t,10+n);!function T_(t,n){Wc(t,n,n[11],2,null,null),n[0]=null,n[6]=null}(a[1],a);const b=g[19];null!==b&&b.detachView(g[1]),a[3]=null,a[4]=null,a[2]&=-129}return a}function wm(t,n){if(!(256&n[2])){const r=n[11];An(r)&&r.destroyNode&&Wc(t,n,r,3,null,null),function I_(t){let n=t[13];if(!n)return qc(t[1],t);for(;n;){let r=null;if(Ei(n))r=n[13];else{const a=n[10];a&&(r=a)}if(!r){for(;n&&!n[4]&&n!==t;)Ei(n)&&qc(n[1],n),n=n[3];null===n&&(n=t),Ei(n)&&qc(n[1],n),r=n&&n[4]}n=r}}(n)}}function qc(t,n){if(!(256&n[2])){n[2]&=-129,n[2]|=256,function Em(t,n){let r;if(null!=t&&null!=(r=t.destroyHooks))for(let a=0;a<r.length;a+=2){const h=n[r[a]];if(!(h instanceof at)){const g=r[a+1];if(Array.isArray(g))for(let b=0;b<g.length;b+=2){const T=h[g[b]],I=g[b+1];try{I.call(T)}finally{}}else try{g.call(h)}finally{}}}}(t,n),function Zc(t,n){const r=t.cleanup,a=n[7];let h=-1;if(null!==r)for(let g=0;g<r.length-1;g+=2)if("string"==typeof r[g]){const b=r[g+1],T="function"==typeof b?b(n):tr(n[b]),I=a[h=r[g+2]],k=r[g+3];"boolean"==typeof k?T.removeEventListener(r[g],I,k):k>=0?a[h=k]():a[h=-k].unsubscribe(),g+=2}else{const b=a[h=r[g+1]];r[g].call(b)}if(null!==a){for(let g=h+1;g<a.length;g++)a[g]();n[7]=null}}(t,n),1===n[1].type&&An(n[11])&&n[11].destroy();const r=n[17];if(null!==r&&gr(n[3])){r!==n[3]&&bm(r,n);const a=n[19];null!==a&&a.detachView(t)}}}function Dm(t,n,r){return function Tm(t,n,r){let a=n;for(;null!==a&&40&a.type;)a=(n=a).parent;if(null===a)return r[0];if(2&a.flags){const h=t.data[a.directiveStart].encapsulation;if(h===xi.None||h===xi.Emulated)return null}return si(a,r)}(t,n.parent,r)}function Ul(t,n,r,a,h){An(t)?t.insertBefore(n,r,a,h):n.insertBefore(r,a,h)}function Qh(t,n,r){An(t)?t.appendChild(n,r):n.appendChild(r)}function ed(t,n,r,a,h){null!==a?Ul(t,n,r,a,h):Qh(t,n,r)}function ci(t,n){return An(t)?t.parentNode(n):n.parentNode}let Yu=function td(t,n,r){return 40&t.type?si(t,r):null};function Qu(t,n,r,a){const h=Dm(t,a,n),g=n[11],T=function $l(t,n,r){return Yu(t,n,r)}(a.parent||n[6],a,n);if(null!=h)if(Array.isArray(r))for(let I=0;I<r.length;I++)ed(g,h,r[I],T,!1);else ed(g,h,r,T,!1)}function nd(t,n){if(null!==n){const r=n.type;if(3&r)return si(n,t);if(4&r)return rd(-1,t[n.index]);if(8&r){const a=n.child;if(null!==a)return nd(t,a);{const h=t[n.index];return gr(h)?rd(-1,h):tr(h)}}if(32&r)return Ip(n,t)()||tr(t[n.index]);{const a=Fp(t,n);return null!==a?Array.isArray(a)?a[0]:nd(Ku(t[16]),a):nd(t,n.next)}}return null}function Fp(t,n){return null!==n?t[16][6].projection[n.projection]:null}function rd(t,n){const r=10+t+1;if(r<n.length){const a=n[r],h=a[1].firstChild;if(null!==h)return nd(a,h)}return n[7]}function eh(t,n,r,a,h,g,b){for(;null!=r;){const T=a[r.index],I=r.type;if(b&&0===n&&(T&&hr(tr(T),a),r.flags|=4),64!=(64&r.flags))if(8&I)eh(t,n,r.child,a,h,g,!1),jl(n,t,h,T,g);else if(32&I){const k=Ip(r,a);let B;for(;B=k();)jl(n,t,h,B,g);jl(n,t,h,T,g)}else 16&I?Rp(t,n,a,r,h,g):jl(n,t,h,T,g);r=b?r.projectionNext:r.next}}function Wc(t,n,r,a,h,g){eh(r,a,t.firstChild,n,h,g,!1)}function Rp(t,n,r,a,h,g){const b=r[16],I=b[6].projection[a.projection];if(Array.isArray(I))for(let k=0;k<I.length;k++)jl(n,t,h,I[k],g);else eh(t,n,I,b[3],h,g,!0)}function Lp(t,n,r){An(t)?t.setAttribute(n,"style",r):n.style.cssText=r}function od(t,n,r){An(t)?""===r?t.removeAttribute(n,"class"):t.setAttribute(n,"class",r):n.className=r}function zp(t,n,r){let a=t.length;for(;;){const h=t.indexOf(n,r);if(-1===h)return h;if(0===h||t.charCodeAt(h-1)<=32){const g=n.length;if(h+g===a||t.charCodeAt(h+g)<=32)return h}r=h+1}}const Im="ng-template";function Sm(t,n,r){let a=0;for(;a<t.length;){let h=t[a++];if(r&&"class"===h){if(h=t[a],-1!==zp(h.toLowerCase(),n,0))return!0}else if(1===h){for(;a<t.length&&"string"==typeof(h=t[a++]);)if(h.toLowerCase()===n)return!0;return!1}}return!1}function Op(t){return 4===t.type&&t.value!==Im}function th(t,n,r){return n===(4!==t.type||r?t.value:Im)}function Am(t,n,r){let a=4;const h=t.attrs||[],g=function sd(t){for(let n=0;n<t.length;n++)if(Zn(t[n]))return n;return t.length}(h);let b=!1;for(let T=0;T<n.length;T++){const I=n[T];if("number"!=typeof I){if(!b)if(4&a){if(a=2|1&a,""!==I&&!th(t,I,r)||""===I&&1===n.length){if(bo(a))return!1;b=!0}}else{const k=8&a?I:n[++T];if(8&a&&null!==t.attrs){if(!Sm(t.attrs,k,r)){if(bo(a))return!1;b=!0}continue}const $=Bp(8&a?"class":I,h,Op(t),r);if(-1===$){if(bo(a))return!1;b=!0;continue}if(""!==k){let ee;ee=$>g?"":h[$+1].toLowerCase();const oe=8&a?ee:null;if(oe&&-1!==zp(oe,k,0)||2&a&&k!==ee){if(bo(a))return!1;b=!0}}}}else{if(!b&&!bo(a)&&!bo(I))return!1;if(b&&bo(I))continue;b=!1,a=I|1&a}}return bo(a)||b}function bo(t){return 0==(1&t)}function Bp(t,n,r,a){if(null===n)return-1;let h=0;if(a||!r){let g=!1;for(;h<n.length;){const b=n[h];if(b===t)return h;if(3===b||6===b)g=!0;else{if(1===b||2===b){let T=n[++h];for(;"string"==typeof T;)T=n[++h];continue}if(4===b)break;if(0===b){h+=4;continue}}h+=g?1:2}return-1}return function km(t,n){let r=t.indexOf(4);if(r>-1)for(r++;r<t.length;){const a=t[r];if("number"==typeof a)return-1;if(a===n)return r;r++}return-1}(n,t)}function Gl(t,n,r=!1){for(let a=0;a<n.length;a++)if(Am(t,n[a],r))return!0;return!1}function nh(t,n){return t?":not("+n.trim()+")":n}function k_(t){let n=t[0],r=1,a=2,h="",g=!1;for(;r<t.length;){let b=t[r];if("string"==typeof b)if(2&a){const T=t[++r];h+="["+b+(T.length>0?'="'+T+'"':"")+"]"}else 8&a?h+="."+b:4&a&&(h+=" "+b);else""!==h&&!bo(b)&&(n+=nh(g,h),h=""),a=b,g=g||!bo(a);r++}return""!==h&&(n+=nh(g,h)),n}const Mt={};function wo(t){Hl(Xt(),Oe(),G()+t,xs())}function Hl(t,n,r,a){if(!a)if(3==(3&n[2])){const g=t.preOrderCheckHooks;null!==g&&ke(n,g,r)}else{const g=t.preOrderHooks;null!==g&&be(n,g,0,r)}ne(r)}function Xp(t,n){const r=t.contentQueries;if(null!==r)for(let a=0;a<r.length;a+=2){const h=r[a],g=r[a+1];if(-1!==g){const b=t.data[g];E(h),b.contentQueries(2,n[g],g)}}}function Jc(t,n,r,a,h,g,b,T,I,k){const B=n.blueprint.slice();return B[0]=h,B[2]=140|a,ja(B),B[3]=B[15]=t,B[8]=r,B[10]=b||t&&t[10],B[11]=T||t&&t[11],B[12]=I||t&&t[12]||null,B[9]=k||t&&t[9]||null,B[6]=g,B[16]=2==n.type?t[16]:B,B}function Xl(t,n,r,a,h){let g=t.data[n];if(null===g)g=function md(t,n,r,a,h){const g=ta(),b=Au(),I=t.data[n]=function Do(t,n,r,a,h,g){return{type:r,index:a,insertBeforeIndex:null,injectorIndex:n?n.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:h,attrs:g,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,b?g:g&&g.parent,r,n,a,h);return null===t.firstChild&&(t.firstChild=I),null!==g&&(b?null==g.child&&null!==I.parent&&(g.child=I):null===g.next&&(g.next=I)),I}(t,n,r,a,h),function bs(){return xt.lFrame.inI18n}()&&(g.flags|=64);else if(64&g.type){g.type=r,g.value=a,g.attrs=h;const b=function Al(){const t=xt.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}();g.injectorIndex=null===b?-1:b.injectorIndex}return Oi(g,!0),g}function Kl(t,n,r,a){if(0===r)return-1;const h=n.length;for(let g=0;g<r;g++)n.push(a),t.blueprint.push(a),t.data.push(null);return h}function Yc(t,n,r){F(n);try{const a=t.viewQuery;null!==a&&uf(1,a,r);const h=t.template;null!==h&&Kp(t,n,h,1,r),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&Xp(t,n),t.staticViewQueries&&uf(2,t.viewQuery,r);const g=t.components;null!==g&&function jm(t,n){for(let r=0;r<n.length;r++)ch(t,n[r])}(n,g)}catch(a){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),a}finally{n[2]&=-5,H()}}function Jl(t,n,r,a){const h=n[2];if(256==(256&h))return;F(n);const g=xs();try{ja(n),function na(t){return xt.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==r&&Kp(t,n,r,2,a);const b=3==(3&h);if(!g)if(b){const k=t.preOrderCheckHooks;null!==k&&ke(n,k,null)}else{const k=t.preOrderHooks;null!==k&&be(n,k,0,null),ve(n,0)}if(function Z_(t){for(let n=Kh(t);null!==n;n=Vl(n)){if(!n[2])continue;const r=n[9];for(let a=0;a<r.length;a++){const h=r[a],g=h[3];0==(1024&h[2])&&vs(g,1),h[2]|=1024}}}(n),function Km(t){for(let n=Kh(t);null!==n;n=Vl(n))for(let r=10;r<n.length;r++){const a=n[r],h=a[1];ea(a)&&Jl(h,a,h.template,a[8])}}(n),null!==t.contentQueries&&Xp(t,n),!g)if(b){const k=t.contentCheckHooks;null!==k&&ke(n,k)}else{const k=t.contentHooks;null!==k&&be(n,k,1),ve(n,1)}!function Vm(t,n){const r=t.hostBindingOpCodes;if(null!==r)try{for(let a=0;a<r.length;a++){const h=r[a];if(h<0)ne(~h);else{const g=h,b=r[++a],T=r[++a];o(b,g),T(2,n[g])}}}finally{ne(-1)}}(t,n);const T=t.components;null!==T&&function U_(t,n){for(let r=0;r<n.length;r++)Yl(t,n[r])}(n,T);const I=t.viewQuery;if(null!==I&&uf(2,I,a),!g)if(b){const k=t.viewCheckHooks;null!==k&&ke(n,k)}else{const k=t.viewHooks;null!==k&&be(n,k,2),ve(n,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),g||(n[2]&=-73),1024&n[2]&&(n[2]&=-1025,vs(n[3],-1))}finally{H()}}function Ya(t,n,r,a){const h=n[10],g=!xs(),b=function Tu(t){return 4==(4&t[2])}(n);try{g&&!b&&h.begin&&h.begin(),b&&Yc(t,n,a),Jl(t,n,r,a)}finally{g&&!b&&h.end&&h.end()}}function Kp(t,n,r,a,h){const g=G(),b=2&a;try{ne(-1),b&&n.length>20&&Hl(t,n,20,xs()),r(a,h)}finally{ne(g)}}function ah(t,n,r){if(Ks(n)){const h=n.directiveEnd;for(let g=n.directiveStart;g<h;g++){const b=t.data[g];b.contentQueries&&b.contentQueries(1,r[g],g)}}}function Jp(t,n,r){!Cc()||(function $i(t,n,r,a){const h=r.directiveStart,g=r.directiveEnd;t.firstCreatePass||st(r,n),hr(a,n);const b=r.initialInputs;for(let T=h;T<g;T++){const I=t.data[T],k=_r(I);k&&Zm(n,r,I);const B=Pl(n,t,T,r);hr(B,n),null!==b&&Wm(0,T-h,B,I,0,b),k&&(Gr(r.index,n)[8]=B)}}(t,n,r,si(r,n)),128==(128&r.flags)&&function Gi(t,n,r){const a=r.directiveStart,h=r.directiveEnd,b=r.index,T=function c(){return xt.lFrame.currentDirectiveIndex}();try{ne(b);for(let I=a;I<h;I++){const k=t.data[I],B=n[I];m(I),(null!==k.hostBindings||0!==k.hostVars||null!==k.hostAttrs)&&qm(k,B)}}finally{ne(-1),m(T)}}(t,n,r))}function pa(t,n,r=si){const a=n.localNames;if(null!==a){let h=n.index+1;for(let g=0;g<a.length;g+=2){const b=a[g+1],T=-1===b?r(n,t):t[b];t[h++]=T}}}function Yp(t){const n=t.tView;return null===n||n.incompleteFirstPass?t.tView=lh(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):n}function lh(t,n,r,a,h,g,b,T,I,k){const B=20+a,$=B+h,ee=function gd(t,n){const r=[];for(let a=0;a<n;a++)r.push(a<t?null:Mt);return r}(B,$),oe="function"==typeof k?k():k;return ee[1]={type:t,blueprint:ee,template:r,queries:null,viewQuery:T,declTNode:n,data:ee.slice().fill(null,B),bindingStartIndex:B,expandoStartIndex:$,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof g?g():g,pipeRegistry:"function"==typeof b?b():b,firstChild:null,schemas:I,consts:oe,incompleteFirstPass:!1}}function ts(t,n,r){for(let a in t)if(t.hasOwnProperty(a)){const h=t[a];(r=null===r?{}:r).hasOwnProperty(a)?r[a].push(n,h):r[a]=[n,h]}return r}function vd(t,n,r,a){let h=!1;if(Cc()){const g=function xd(t,n,r){const a=t.directiveRegistry;let h=null;if(a)for(let g=0;g<a.length;g++){const b=a[g];Gl(r,b.selectors,!1)&&(h||(h=[]),rr(st(r,n),t,b.type),_r(b)?(tf(t,r),h.unshift(b)):h.push(b))}return h}(t,n,r),b=null===a?null:{"":-1};if(null!==g){h=!0,rf(r,t.data.length,g.length);for(let B=0;B<g.length;B++){const $=g[B];$.providersResolver&&$.providersResolver($)}let T=!1,I=!1,k=Kl(t,n,g.length,null);for(let B=0;B<g.length;B++){const $=g[B];r.mergedAttrs=qr(r.mergedAttrs,$.hostAttrs),of(t,r,n,k,$),bd(k,$,b),null!==$.contentQueries&&(r.flags|=8),(null!==$.hostBindings||null!==$.hostAttrs||0!==$.hostVars)&&(r.flags|=128);const ee=$.type.prototype;!T&&(ee.ngOnChanges||ee.ngOnInit||ee.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(r.index),T=!0),!I&&(ee.ngOnChanges||ee.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(r.index),I=!0),k++}!function Qa(t,n){const a=n.directiveEnd,h=t.data,g=n.attrs,b=[];let T=null,I=null;for(let k=n.directiveStart;k<a;k++){const B=h[k],$=B.inputs,ee=null===g||Op(n)?null:q_($,g);b.push(ee),T=ts($,k,T),I=ts(B.outputs,k,I)}null!==T&&(T.hasOwnProperty("class")&&(n.flags|=16),T.hasOwnProperty("style")&&(n.flags|=32)),n.initialInputs=b,n.inputs=T,n.outputs=I}(t,r)}b&&function nf(t,n,r){if(n){const a=t.localNames=[];for(let h=0;h<n.length;h+=2){const g=r[n[h+1]];if(null==g)throw new an(-301,!1);a.push(n[h],g)}}}(r,a,b)}return r.mergedAttrs=qr(r.mergedAttrs,r.attrs),h}function el(t,n,r,a,h,g){const b=g.hostBindings;if(b){let T=t.hostBindingOpCodes;null===T&&(T=t.hostBindingOpCodes=[]);const I=~n.index;(function ef(t){let n=t.length;for(;n>0;){const r=t[--n];if("number"==typeof r&&r<0)return r}return 0})(T)!=I&&T.push(I),T.push(a,h,b)}}function qm(t,n){null!==t.hostBindings&&t.hostBindings(1,n)}function tf(t,n){n.flags|=2,(t.components||(t.components=[])).push(n.index)}function bd(t,n,r){if(r){if(n.exportAs)for(let a=0;a<n.exportAs.length;a++)r[n.exportAs[a]]=t;_r(n)&&(r[""]=t)}}function rf(t,n,r){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+r,t.providerIndexes=n}function of(t,n,r,a,h){t.data[a]=h;const g=h.factory||(h.factory=vo(h.type)),b=new at(g,_r(h),null);t.blueprint[a]=b,r[a]=b,el(t,n,0,a,Kl(t,r,h.hostVars,Mt),h)}function Zm(t,n,r){const a=si(n,t),h=Yp(r),g=t[10],b=nl(t,Jc(t,h,null,r.onPush?64:16,a,n,g,g.createRenderer(a,r),null,null));t[n.index]=b}function Wm(t,n,r,a,h,g){const b=g[n];if(null!==b){const T=a.setInput;for(let I=0;I<b.length;){const k=b[I++],B=b[I++],$=b[I++];null!==T?a.setInput(r,$,k,B):r[B]=$}}}function q_(t,n){let r=null,a=0;for(;a<n.length;){const h=n[a];if(0!==h)if(5!==h){if("number"==typeof h)break;t.hasOwnProperty(h)&&(null===r&&(r=[]),r.push(h,t[h],n[a+1])),a+=2}else a+=2;else a+=4}return r}function sf(t,n,r,a){return new Array(t,!0,!1,n,null,0,a,r,null,null)}function Yl(t,n){const r=Gr(n,t);if(ea(r)){const a=r[1];80&r[2]?Jl(a,r,a.template,r[8]):r[5]>0&&af(r)}}function af(t){for(let a=Kh(t);null!==a;a=Vl(a))for(let h=10;h<a.length;h++){const g=a[h];if(1024&g[2]){const b=g[1];Jl(b,g,b.template,g[8])}else g[5]>0&&af(g)}const r=t[1].components;if(null!==r)for(let a=0;a<r.length;a++){const h=Gr(r[a],t);ea(h)&&h[5]>0&&af(h)}}function ch(t,n){const r=Gr(n,t),a=r[1];(function uh(t,n){for(let r=n.length;r<t.blueprint.length;r++)n.push(t.blueprint[r])})(a,r),Yc(a,r,r[8])}function nl(t,n){return t[13]?t[14][4]=n:t[13]=n,t[14]=n,n}function Ql(t){for(;t;){t[2]|=64;const n=Ku(t);if(Eh(t)&&!n)return t;t=n}return null}function cf(t,n,r){const a=n[10];a.begin&&a.begin();try{Jl(t,n,t.template,r)}catch(h){throw e(n,h),h}finally{a.end&&a.end()}}function ec(t){!function lf(t){for(let n=0;n<t.components.length;n++){const r=t.components[n],a=Mp(r),h=a[1];Ya(h,a,h.template,r)}}(t[8])}function uf(t,n,r){E(0),n(t,r)}const K_=(()=>Promise.resolve(null))();function hf(t){return t[7]||(t[7]=[])}function df(t){return t.cleanup||(t.cleanup=[])}function e(t,n){const r=t[9],a=r?r.get(Xu,null):null;a&&a.handleError(n)}function s(t,n,r,a,h){for(let g=0;g<r.length;){const b=r[g++],T=r[g++],I=n[b],k=t.data[b];null!==k.setInput?k.setInput(I,h,a,T):I[T]=h}}function l(t,n,r){const a=function Qs(t,n){return tr(n[t])}(n,t);!function Es(t,n,r){An(t)?t.setValue(n,r):n.textContent=r}(t[11],a,r)}function u(t,n,r){let a=r?t.styles:null,h=r?t.classes:null,g=0;if(null!==n)for(let b=0;b<n.length;b++){const T=n[b];"number"==typeof T?g=T:1==g?h=Sa(h,T):2==g&&(a=Sa(a,T+": "+n[++b]+";"))}r?t.styles=a:t.stylesWithoutHost=a,r?t.classes=h:t.classesWithoutHost=h}const w=new cn("INJECTOR",-1);class D{get(n,r=no){if(r===no){const a=new Error(`NullInjectorError: No provider for ${nn(n)}!`);throw a.name="NullInjectorError",a}return r}}const M=new cn("Set Injector scope."),S={},A={};let z;function N(){return void 0===z&&(z=new D),z}function U(t,n=null,r=null,a){const h=q(t,n,r,a);return h._resolveInjectorDefTypes(),h}function q(t,n=null,r=null,a){return new J(t,r,n||N(),a)}class J{constructor(n,r,a,h=null){this.parent=a,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const g=[];r&&Zo(r,T=>this.processProvider(T,n,r)),Zo([n],T=>this.processInjectorType(T,[],g)),this.records.set(w,de(void 0,this));const b=this.records.get(M);this.scope=null!=b?b.value:null,this.source=h||("object"==typeof n?null:nn(n))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(n=>n.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(n,r=no,a=wt.Default){this.assertNotDestroyed();const h=Uf(this),g=lr(void 0);try{if(!(a&wt.SkipSelf)){let T=this.records.get(n);if(void 0===T){const I=function Pe(t){return"function"==typeof t||"object"==typeof t&&t instanceof cn}(n)&&ni(n);T=I&&this.injectableDefInScope(I)?de(ie(n),S):null,this.records.set(n,T)}if(null!=T)return this.hydrate(n,T)}return(a&wt.Self?N():this.parent).get(n,r=a&wt.Optional&&r===no?null:r)}catch(b){if("NullInjectorError"===b.name){if((b[Bh]=b[Bh]||[]).unshift(nn(n)),h)throw b;return function Gf(t,n,r,a){const h=t[Bh];throw n[cp]&&h.unshift(n[cp]),t.message=function zc(t,n,r,a=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let h=nn(n);if(Array.isArray(n))h=n.map(nn).join(" -> ");else if("object"==typeof n){let g=[];for(let b in n)if(n.hasOwnProperty(b)){let T=n[b];g.push(b+":"+("string"==typeof T?JSON.stringify(T):nn(T)))}h=`{${g.join(", ")}}`}return`${r}${a?"("+a+")":""}[${h}]: ${t.replace(Xg,"\n  ")}`}("\n"+t.message,h,r,a),t.ngTokenPath=h,t[Bh]=null,t}(b,n,"R3InjectorError",this.source)}throw b}finally{lr(g),Uf(h)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(n=>this.get(n))}toString(){const n=[];return this.records.forEach((a,h)=>n.push(nn(h))),`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new an(205,!1)}processInjectorType(n,r,a){if(!(n=mt(n)))return!1;let h=Dl(n);const g=null==h&&n.ngModule||void 0,b=void 0===g?n:g,T=-1!==a.indexOf(b);if(void 0!==g&&(h=Dl(g)),null==h)return!1;if(null!=h.imports&&!T){let B;a.push(b);try{Zo(h.imports,$=>{this.processInjectorType($,r,a)&&(void 0===B&&(B=[]),B.push($))})}finally{}if(void 0!==B)for(let $=0;$<B.length;$++){const{ngModule:ee,providers:oe}=B[$];Zo(oe,ge=>this.processProvider(ge,ee,oe||ln))}}this.injectorDefTypes.add(b);const I=vo(b)||(()=>new b);this.records.set(b,de(I,S));const k=h.providers;if(null!=k&&!T){const B=n;Zo(k,$=>this.processProvider($,B,k))}return void 0!==g&&void 0!==n.providers}processProvider(n,r,a){let h=Be(n=mt(n))?n:mt(n&&n.provide);const g=function he(t,n,r){return De(t)?de(void 0,t.useValue):de(function pe(t,n,r){let a;if(Be(t)){const h=mt(t);return vo(h)||ie(h)}if(De(t))a=()=>mt(t.useValue);else if(function $e(t){return!(!t||!t.useFactory)}(t))a=()=>t.useFactory(...Vh(t.deps||[]));else if(function we(t){return!(!t||!t.useExisting)}(t))a=()=>ht(mt(t.useExisting));else{const h=mt(t&&(t.useClass||t.provide));if(!function Ve(t){return!!t.deps}(t))return vo(h)||ie(h);a=()=>new h(...Vh(t.deps))}return a}(t),S)}(n);if(Be(n)||!0!==n.multi)this.records.get(h);else{let b=this.records.get(h);b||(b=de(void 0,S,!0),b.factory=()=>Vh(b.multi),this.records.set(h,b)),h=n,b.multi.push(n)}this.records.set(h,g)}hydrate(n,r){return r.value===S&&(r.value=A,r.value=r.factory()),"object"==typeof r.value&&r.value&&function Ze(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(r.value)&&this.onDestroy.add(r.value),r.value}injectableDefInScope(n){if(!n.providedIn)return!1;const r=mt(n.providedIn);return"string"==typeof r?"any"===r||r===this.scope:this.injectorDefTypes.has(r)}}function ie(t){const n=ni(t),r=null!==n?n.factory:vo(t);if(null!==r)return r;if(t instanceof cn)throw new an(204,!1);if(t instanceof Function)return function ce(t){const n=t.length;if(n>0)throw function Lc(t,n){const r=[];for(let a=0;a<t;a++)r.push(n);return r}(n,"?"),new an(204,!1);const r=function Zd(t){const n=t&&(t[No]||t[Vs]);if(n){const r=function ri(t){if(t.hasOwnProperty("name"))return t.name;const n=(""+t).match(/^function\s*([^\s(]+)/);return null===n?"":n[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${r}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${r}" class.`),n}return null}(t);return null!==r?()=>r.factory(t):()=>new t}(t);throw new an(204,!1)}function de(t,n,r=!1){return{factory:t,value:n,multi:r?[]:void 0}}function De(t){return null!==t&&"object"==typeof t&&Nh in t}function Be(t){return"function"==typeof t}let We=(()=>{class t{static create(r,a){var h;if(Array.isArray(r))return U({name:""},a,r,"");{const g=null!==(h=r.name)&&void 0!==h?h:"";return U({name:g},r.parent,r.providers,g)}}}return t.THROW_IF_NOT_FOUND=no,t.NULL=new D,t.\u0275prov=en({token:t,providedIn:"any",factory:()=>ht(w)}),t.__NG_ELEMENT_ID__=-1,t})();function kn(t,n){Le(Mp(t)[1],Rn())}let ph=null;function tc(){if(!ph){const t=$t.Symbol;if(t&&t.iterator)ph=t.iterator;else{const n=Object.getOwnPropertyNames(Map.prototype);for(let r=0;r<n.length;++r){const a=n[r];"entries"!==a&&"size"!==a&&Map.prototype[a]===Map.prototype.entries&&(ph=a)}}}return ph}function nc(t){return!!function Dd(t){return null!==t&&("function"==typeof t||"object"==typeof t)}(t)&&(Array.isArray(t)||!(t instanceof Map)&&tc()in t)}function Kn(t,n,r){return!Object.is(t[n],r)&&(t[n]=r,!0)}function ff(t,n,r,a,h,g,b,T){const I=Oe(),k=Xt(),B=t+20,$=k.firstCreatePass?function Sb(t,n,r,a,h,g,b,T,I){const k=n.consts,B=Xl(n,t,4,b||null,Go(k,T));vd(n,r,B,Go(k,I)),Le(n,B);const $=B.tViews=lh(2,B,a,h,g,n.directiveRegistry,n.pipeRegistry,null,n.schemas,k);return null!==n.queries&&(n.queries.template(n,B),$.queries=n.queries.embeddedTView(B)),B}(B,k,I,n,r,a,h,g,b):k.data[B];Oi($,!1);const ee=I[11].createComment("");Qu(k,I,ee,$),hr(ee,I),nl(I,I[B]=sf(ee,I,ee,$)),Js($)&&Jp(k,I,$),null!=b&&pa(I,$,T)}function Qt(t,n=wt.Default){const r=Oe();return null===r?ht(t,n):jn(Rn(),r,mt(t),n)}function eu(t,n,r){const a=Oe();return Kn(a,ra(),n)&&function xr(t,n,r,a,h,g,b,T){const I=si(n,r);let B,k=n.inputs;!T&&null!=k&&(B=k[a])?(s(t,r,B,a,h),Cl(n)&&function _d(t,n){const r=Gr(n,t);16&r[2]||(r[2]|=64)}(r,n.index)):3&n.type&&(a=function Ds(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(a),h=null!=b?b(h,n.value||"",a):h,An(g)?g.setProperty(I,a,h):kr(a)||(I.setProperty?I.setProperty(a,h):I[a]=h))}(Xt(),function Q(){const t=xt.lFrame;return Tc(t.tView,t.selectedIndex)}(),a,t,n,a[11],r,!1),eu}function ty(t,n,r,a,h){const b=h?"class":"style";s(t,r,n.inputs[b],b,a)}function qi(t,n,r,a){const h=Oe(),g=Xt(),b=20+t,T=h[11],I=h[b]=Yh(T,n,function xe(){return xt.lFrame.currentNamespace}()),k=g.firstCreatePass?function Yb(t,n,r,a,h,g,b){const T=n.consts,k=Xl(n,t,2,h,Go(T,g));return vd(n,r,k,Go(T,b)),null!==k.attrs&&u(k,k.attrs,!1),null!==k.mergedAttrs&&u(k,k.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,k),k}(b,g,h,0,n,r,a):g.data[b];Oi(k,!0);const B=k.mergedAttrs;null!==B&&gn(T,I,B);const $=k.classes;null!==$&&od(T,I,$);const ee=k.styles;return null!==ee&&Lp(T,I,ee),64!=(64&k.flags)&&Qu(g,h,I,k),0===function Cu(){return xt.lFrame.elementDepthCount}()&&hr(I,h),function Mu(){xt.lFrame.elementDepthCount++}(),Js(k)&&(Jp(g,h,k),ah(g,k,h)),null!==a&&pa(h,k),qi}function Jr(){let t=Rn();Au()?Mc():(t=t.parent,Oi(t,!1));const n=t;!function Iu(){xt.lFrame.elementDepthCount--}();const r=Xt();return r.firstCreatePass&&(Le(r,t),Ks(t)&&r.queries.elementEnd(t)),null!=n.classesWithoutHost&&function rn(t){return 0!=(16&t.flags)}(n)&&ty(r,n,Oe(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function mn(t){return 0!=(32&t.flags)}(n)&&ty(r,n,Oe(),n.stylesWithoutHost,!1),Jr}function eg(t,n,r,a){return qi(t,n,r,a),Jr(),eg}function tg(t,n,r){const a=Oe(),h=Xt(),g=t+20,b=h.firstCreatePass?function Qb(t,n,r,a,h){const g=n.consts,b=Go(g,a),T=Xl(n,t,8,"ng-container",b);return null!==b&&u(T,b,!0),vd(n,r,T,Go(g,h)),null!==n.queries&&n.queries.elementStart(n,T),T}(g,h,a,n,r):h.data[g];Oi(b,!0);const T=a[g]=a[11].createComment("");return Qu(h,a,T,b),hr(T,a),Js(b)&&(Jp(h,a,b),ah(h,b,a)),null!=r&&pa(a,b),tg}function ng(){let t=Rn();const n=Xt();return Au()?Mc():(t=t.parent,Oi(t,!1)),n.firstCreatePass&&(Le(n,t),Ks(t)&&n.queries.elementEnd(t)),ng}function ny(t){return!!t&&"function"==typeof t.then}const ew=function sx(t){return!!t&&"function"==typeof t.subscribe};function rg(t,n,r,a){const h=Oe(),g=Xt(),b=Rn();return function lx(t,n,r,a,h,g,b,T){const I=Js(a),B=t.firstCreatePass&&df(t),$=n[8],ee=hf(n);let oe=!0;if(3&a.type||T){const He=si(a,n),Ge=T?T(He):He,Ce=ee.length,dt=T?Bt=>T(tr(Bt[a.index])):a.index;if(An(r)){let Bt=null;if(!T&&I&&(Bt=function tw(t,n,r,a){const h=t.cleanup;if(null!=h)for(let g=0;g<h.length-1;g+=2){const b=h[g];if(b===r&&h[g+1]===a){const T=n[7],I=h[g+2];return T.length>I?T[I]:null}"string"==typeof b&&(g+=2)}return null}(t,n,h,a.index)),null!==Bt)(Bt.__ngLastListenerFn__||Bt).__ngNextListenerFn__=g,Bt.__ngLastListenerFn__=g,oe=!1;else{g=ry(a,n,$,g,!1);const _n=r.listen(Ge,h,g);ee.push(g,_n),B&&B.push(h,dt,Ce,Ce+1)}}else g=ry(a,n,$,g,!0),Ge.addEventListener(h,g,b),ee.push(g),B&&B.push(h,dt,Ce,b)}else g=ry(a,n,$,g,!1);const ge=a.outputs;let Re;if(oe&&null!==ge&&(Re=ge[h])){const He=Re.length;if(He)for(let Ge=0;Ge<He;Ge+=2){const is=n[Re[Ge]][Re[Ge+1]].subscribe(g),gh=ee.length;ee.push(g,is),B&&B.push(h,a.index,gh,-(gh+1))}}}(g,h,h[11],b,t,n,!!r,a),rg}function cx(t,n,r,a){try{return!1!==r(a)}catch(h){return e(t,h),!1}}function ry(t,n,r,a,h){return function g(b){if(b===Function)return a;const T=2&t.flags?Gr(t.index,n):n;0==(32&n[2])&&Ql(T);let I=cx(n,0,a,b),k=g.__ngNextListenerFn__;for(;k;)I=cx(n,0,k,b)&&I,k=k.__ngNextListenerFn__;return h&&!1===I&&(b.preventDefault(),b.returnValue=!1),I}}function kd(t=1){return function W(t){return(xt.lFrame.contextLView=function se(t,n){for(;t>0;)n=n[15],t--;return n}(t,xt.lFrame.contextLView))[8]}(t)}function sl(t,n=""){const r=Oe(),a=Xt(),h=t+20,g=a.firstCreatePass?Xl(a,h,1,n,null):a.data[h],b=r[h]=function Jh(t,n){return An(t)?t.createText(n):t.createTextNode(n)}(r[11],n);Qu(a,r,b,g),Oi(g,!1)}function Rd(t){return og("",t,""),Rd}function og(t,n,r){const a=Oe(),h=function rl(t,n,r,a){return Kn(t,ra(),r)?n+vt(r)+a:Mt}(a,t,n,r);return h!==Mt&&l(a,G(),h),og}const sg="en-US";let t0=sg;class M0{}class HE{resolveComponentFactory(n){throw function GE(t){const n=Error(`No component factory found for ${nn(t)}. Did you add it to @NgModule.entryComponents?`);return n.ngComponent=t,n}(n)}}let hg=(()=>{class t{}return t.NULL=new HE,t})();function qE(){return Od(Rn(),Oe())}function Od(t,n){return new Bd(si(t,n))}let Bd=(()=>{class t{constructor(r){this.nativeElement=r}}return t.__NG_ELEMENT_ID__=qE,t})();class S0{}let KE=(()=>{class t{}return t.\u0275prov=en({token:t,providedIn:"root",factory:()=>null}),t})();class dy{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const JE=new dy("13.3.0"),py={};function dg(t,n,r,a,h=!1){for(;null!==r;){const g=n[r.index];if(null!==g&&a.push(tr(g)),gr(g))for(let T=10;T<g.length;T++){const I=g[T],k=I[1].firstChild;null!==k&&dg(I[1],I,k,a)}const b=r.type;if(8&b)dg(t,n,r.child,a);else if(32&b){const T=Ip(r,n);let I;for(;I=T();)a.push(I)}else if(16&b){const T=Fp(n,r);if(Array.isArray(T))a.push(...T);else{const I=Ku(n[16]);dg(I[1],I,T,a,!0)}}r=h?r.projectionNext:r.next}return a}class xf{constructor(n,r){this._lView=n,this._cdRefInjectingView=r,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const n=this._lView,r=n[1];return dg(r,n,r.firstChild,[])}get context(){return this._lView[8]}set context(n){this._lView[8]=n}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[3];if(gr(n)){const r=n[8],a=r?r.indexOf(this):-1;a>-1&&(Ap(n,a),zh(r,a))}this._attachedToViewContainer=!1}wm(this._lView[1],this._lView)}onDestroy(n){!function $m(t,n,r,a){const h=hf(n);null===r?h.push(a):(h.push(r),t.firstCreatePass&&df(t).push(a,h.length-1))}(this._lView[1],this._lView,null,n)}markForCheck(){Ql(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){cf(this._lView[1],this._lView,this.context)}checkNoChanges(){!function Ed(t,n,r){Ho(!0);try{cf(t,n,r)}finally{Ho(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new an(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function M_(t,n){Wc(t,n,n[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new an(902,"");this._appRef=n}}class YE extends xf{constructor(n){super(n),this._view=n}detectChanges(){ec(this._view)}checkNoChanges(){!function W_(t){Ho(!0);try{ec(t)}finally{Ho(!1)}}(this._view)}get context(){return null}}class P0 extends hg{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const r=Hn(n);return new fy(r,this.ngModule)}}function k0(t){const n=[];for(let r in t)t.hasOwnProperty(r)&&n.push({propName:t[r],templateName:r});return n}class fy extends M0{constructor(n,r){super(),this.componentDef=n,this.ngModule=r,this.componentType=n.type,this.selector=function F_(t){return t.map(k_).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!r}get inputs(){return k0(this.componentDef.inputs)}get outputs(){return k0(this.componentDef.outputs)}create(n,r,a,h){const g=(h=h||this.ngModule)?function eD(t,n){return{get:(r,a,h)=>{const g=t.get(r,py,h);return g!==py||a===py?g:n.get(r,a,h)}}}(n,h.injector):n,b=g.get(S0,Du),T=g.get(KE,null),I=b.createRenderer(null,this.componentDef),k=this.componentDef.selectors[0][0]||"div",B=a?function Um(t,n,r){if(An(t))return t.selectRootElement(n,r===xi.ShadowDom);let a="string"==typeof n?t.querySelector(n):n;return a.textContent="",a}(I,a,this.componentDef.encapsulation):Yh(b.createRenderer(null,this.componentDef),k,function QE(t){const n=t.toLowerCase();return"svg"===n?"svg":"math"===n?"math":null}(k)),$=this.componentDef.onPush?576:528,ee=function dr(t,n){return{components:[],scheduler:t||_m,clean:K_,playerHandler:n||null,flags:0}}(),oe=lh(0,null,null,1,0,null,null,null,null,null),ge=Jc(null,oe,ee,$,null,null,b,I,T,g);let Re,He;F(ge);try{const Ge=function br(t,n,r,a,h,g){const b=r[1];r[20]=t;const I=Xl(b,20,2,"#host",null),k=I.mergedAttrs=n.hostAttrs;null!==k&&(u(I,k,!0),null!==t&&(gn(h,t,k),null!==I.classes&&od(h,t,I.classes),null!==I.styles&&Lp(h,t,I.styles)));const B=a.createRenderer(t,n),$=Jc(r,Yp(n),null,n.onPush?64:16,r[20],I,a,B,g||null,null);return b.firstCreatePass&&(rr(st(I,r),b,n.type),tf(b,I),rf(I,r.length,1)),nl(r,$),r[20]=$}(B,this.componentDef,ge,b,I);if(B)if(a)gn(I,B,["ng-version",JE.full]);else{const{attrs:Ce,classes:dt}=function R_(t){const n=[],r=[];let a=1,h=2;for(;a<t.length;){let g=t[a];if("string"==typeof g)2===h?""!==g&&n.push(g,t[++a]):8===h&&r.push(g);else{if(!bo(h))break;h=g}a++}return{attrs:n,classes:r}}(this.componentDef.selectors[0]);Ce&&gn(I,B,Ce),dt&&dt.length>0&&od(I,B,dt.join(" "))}if(He=Tc(oe,20),void 0!==r){const Ce=He.projection=[];for(let dt=0;dt<this.ngContentSelectors.length;dt++){const Bt=r[dt];Ce.push(null!=Bt?Array.from(Bt):null)}}Re=function un(t,n,r,a,h){const g=r[1],b=function H_(t,n,r){const a=Rn();t.firstCreatePass&&(r.providersResolver&&r.providersResolver(r),of(t,a,n,Kl(t,n,1,null),r));const h=Pl(n,t,a.directiveStart,a);hr(h,n);const g=si(a,n);return g&&hr(g,n),h}(g,r,n);if(a.components.push(b),t[8]=b,h&&h.forEach(I=>I(b,n)),n.contentQueries){const I=Rn();n.contentQueries(1,b,I.directiveStart)}const T=Rn();return!g.firstCreatePass||null===n.hostBindings&&null===n.hostAttrs||(ne(T.index),el(r[1],T,0,T.directiveStart,T.directiveEnd,n),qm(n,b)),b}(Ge,this.componentDef,ge,ee,[kn]),Yc(oe,ge,null)}finally{H()}return new nD(this.componentType,Re,Od(He,ge),ge,He)}}class nD extends class $E{}{constructor(n,r,a,h,g){super(),this.location=a,this._rootLView=h,this._tNode=g,this.instance=r,this.hostView=this.changeDetectorRef=new YE(h),this.componentType=n}get injector(){return new $a(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}class Nd{}const Vd=new Map;class L0 extends Nd{constructor(n,r){super(),this._parent=r,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new P0(this);const a=Ur(n);this._bootstrapComponents=Qo(a.bootstrap),this._r3Injector=q(n,r,[{provide:Nd,useValue:this},{provide:hg,useValue:this.componentFactoryResolver}],nn(n)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(n)}get(n,r=We.THROW_IF_NOT_FOUND,a=wt.Default){return n===We||n===Nd||n===w?this:this._r3Injector.get(n,r,a)}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(r=>r()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class my extends class iD{}{constructor(n){super(),this.moduleType=n,null!==Ur(n)&&function oD(t){const n=new Set;!function r(a){const h=Ur(a,!0),g=h.id;null!==g&&(function F0(t,n,r){if(n&&n!==r)throw new Error(`Duplicate module registered for ${t} - ${nn(n)} vs ${nn(n.name)}`)}(g,Vd.get(g),a),Vd.set(g,a));const b=Qo(h.imports);for(const T of b)n.has(T)||(n.add(T),r(T))}(t)}(n)}create(n){return new L0(this.moduleType,n)}}function gy(t){return n=>{setTimeout(t,void 0,n)}}const oc=class ED extends wa{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,r,a){var h,g,b;let T=n,I=r||(()=>null),k=a;if(n&&"object"==typeof n){const $=n;T=null===(h=$.next)||void 0===h?void 0:h.bind($),I=null===(g=$.error)||void 0===g?void 0:g.bind($),k=null===(b=$.complete)||void 0===b?void 0:b.bind($)}this.__isAsync&&(I=gy(I),T&&(T=gy(T)),k&&(k=gy(k)));const B=super.subscribe({next:T,error:I,complete:k});return n instanceof Jn&&n.add(B),B}};Symbol;let sc=(()=>{class t{}return t.__NG_ELEMENT_ID__=MD,t})();const TD=sc,CD=class extends TD{constructor(n,r,a){super(),this._declarationLView=n,this._declarationTContainer=r,this.elementRef=a}createEmbeddedView(n){const r=this._declarationTContainer.tViews,a=Jc(this._declarationLView,r,n,16,null,r.declTNode,null,null,null,null);a[17]=this._declarationLView[this._declarationTContainer.index];const g=this._declarationLView[19];return null!==g&&(a[19]=g.createEmbeddedView(r)),Yc(r,a,n),new xf(a)}};function MD(){return function pg(t,n){return 4&t.type?new CD(n,t,Od(t,n)):null}(Rn(),Oe())}let al=(()=>{class t{}return t.__NG_ELEMENT_ID__=ID,t})();function ID(){return function $0(t,n){let r;const a=n[t.index];if(gr(a))r=a;else{let h;if(8&t.type)h=tr(a);else{const g=n[11];h=g.createComment("");const b=si(t,n);Ul(g,ci(g,b),h,function Ju(t,n){return An(t)?t.nextSibling(n):n.nextSibling}(g,b),!1)}n[t.index]=r=sf(a,n,h,t),nl(n,r)}return new j0(r,t,n)}(Rn(),Oe())}const SD=al,j0=class extends SD{constructor(n,r,a){super(),this._lContainer=n,this._hostTNode=r,this._hostLView=a}get element(){return Od(this._hostTNode,this._hostLView)}get injector(){return new $a(this._hostTNode,this._hostLView)}get parentInjector(){const n=eo(this._hostTNode,this._hostLView);if(Nt(n)){const r=bn(n,this._hostLView),a=pt(n);return new $a(r[1].data[a+8],r)}return new $a(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const r=U0(this._lContainer);return null!==r&&r[n]||null}get length(){return this._lContainer.length-10}createEmbeddedView(n,r,a){const h=n.createEmbeddedView(r||{});return this.insert(h,a),h}createComponent(n,r,a,h,g){const b=n&&!function Rc(t){return"function"==typeof t}(n);let T;if(b)T=r;else{const $=r||{};T=$.index,a=$.injector,h=$.projectableNodes,g=$.ngModuleRef}const I=b?n:new fy(Hn(n)),k=a||this.parentInjector;if(!g&&null==I.ngModule){const ee=(b?k:this.parentInjector).get(Nd,null);ee&&(g=ee)}const B=I.create(k,h,void 0,g);return this.insert(B.hostView,T),B}insert(n,r){const a=n._lView,h=a[1];if(function Fh(t){return gr(t[3])}(a)){const B=this.indexOf(n);if(-1!==B)this.detach(B);else{const $=a[3],ee=new j0($,$[6],$[3]);ee.detach(ee.indexOf(n))}}const g=this._adjustIndex(r),b=this._lContainer;!function S_(t,n,r,a){const h=10+a,g=r.length;a>0&&(r[h-1][4]=n),a<g-10?(n[4]=r[h],Vf(r,10+a,n)):(r.push(n),n[4]=null),n[3]=r;const b=n[17];null!==b&&r!==b&&function A_(t,n){const r=t[9];n[16]!==n[3][3][16]&&(t[2]=!0),null===r?t[9]=[n]:r.push(n)}(b,n);const T=n[19];null!==T&&T.insertView(t),n[2]|=128}(h,a,b,g);const T=rd(g,b),I=a[11],k=ci(I,b[7]);return null!==k&&function C_(t,n,r,a,h,g){a[0]=h,a[6]=n,Wc(t,a,r,1,h,g)}(h,b[6],I,a,k,T),n.attachToViewContainerRef(),Vf(yy(b),g,n),n}move(n,r){return this.insert(n,r)}indexOf(n){const r=U0(this._lContainer);return null!==r?r.indexOf(n):-1}remove(n){const r=this._adjustIndex(n,-1),a=Ap(this._lContainer,r);a&&(zh(yy(this._lContainer),r),wm(a[1],a))}detach(n){const r=this._adjustIndex(n,-1),a=Ap(this._lContainer,r);return a&&null!=zh(yy(this._lContainer),r)?new xf(a):null}_adjustIndex(n,r=0){return null==n?this.length+r:n}};function U0(t){return t[8]}function yy(t){return t[8]||(t[8]=[])}function gg(...t){}const h1=new cn("Application Initializer");let Sy=(()=>{class t{constructor(r){this.appInits=r,this.resolve=gg,this.reject=gg,this.initialized=!1,this.done=!1,this.donePromise=new Promise((a,h)=>{this.resolve=a,this.reject=h})}runInitializers(){if(this.initialized)return;const r=[],a=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let h=0;h<this.appInits.length;h++){const g=this.appInits[h]();if(ny(g))r.push(g);else if(ew(g)){const b=new Promise((T,I)=>{g.subscribe({complete:T,error:I})});r.push(b)}}Promise.all(r).then(()=>{a()}).catch(h=>{this.reject(h)}),0===r.length&&a(),this.initialized=!0}}return t.\u0275fac=function(r){return new(r||t)(ht(h1,8))},t.\u0275prov=en({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Df=new cn("AppId",{providedIn:"root",factory:function d1(){return`${Ay()}${Ay()}${Ay()}`}});function Ay(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const p1=new cn("Platform Initializer"),_g=new cn("Platform ID"),oT=new cn("appBootstrapListener");let sT=(()=>{class t{log(r){console.log(r)}warn(r){console.warn(r)}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=en({token:t,factory:t.\u0275fac}),t})();const tu=new cn("LocaleId",{providedIn:"root",factory:()=>Ll(tu,wt.Optional|wt.SkipSelf)||function aT(){return"undefined"!=typeof $localize&&$localize.locale||sg}()}),hT=(()=>Promise.resolve(0))();function Py(t){"undefined"==typeof Zone?hT.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class Io{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:a=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new oc(!1),this.onMicrotaskEmpty=new oc(!1),this.onStable=new oc(!1),this.onError=new oc(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const h=this;h._nesting=0,h._outer=h._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(h._inner=h._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(h._inner=h._inner.fork(Zone.longStackTraceZoneSpec)),h.shouldCoalesceEventChangeDetection=!a&&r,h.shouldCoalesceRunChangeDetection=a,h.lastRequestAnimationFrameId=-1,h.nativeRequestAnimationFrame=function dT(){let t=$t.requestAnimationFrame,n=$t.cancelAnimationFrame;if("undefined"!=typeof Zone&&t&&n){const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r);const a=n[Zone.__symbol__("OriginalDelegate")];a&&(n=a)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function mT(t){const n=()=>{!function fT(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call($t,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,Fy(t),t.isCheckStableRunning=!0,ky(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),Fy(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(r,a,h,g,b,T)=>{try{return f1(t),r.invokeTask(h,g,b,T)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===g.type||t.shouldCoalesceRunChangeDetection)&&n(),m1(t)}},onInvoke:(r,a,h,g,b,T,I)=>{try{return f1(t),r.invoke(h,g,b,T,I)}finally{t.shouldCoalesceRunChangeDetection&&n(),m1(t)}},onHasTask:(r,a,h,g)=>{r.hasTask(h,g),a===h&&("microTask"==g.change?(t._hasPendingMicrotasks=g.microTask,Fy(t),ky(t)):"macroTask"==g.change&&(t.hasPendingMacrotasks=g.macroTask))},onHandleError:(r,a,h,g)=>(r.handleError(h,g),t.runOutsideAngular(()=>t.onError.emit(g)),!1)})}(h)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Io.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Io.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(n,r,a){return this._inner.run(n,r,a)}runTask(n,r,a,h){const g=this._inner,b=g.scheduleEventTask("NgZoneEvent: "+h,n,pT,gg,gg);try{return g.runTask(b,r,a)}finally{g.cancelTask(b)}}runGuarded(n,r,a){return this._inner.runGuarded(n,r,a)}runOutsideAngular(n){return this._outer.run(n)}}const pT={};function ky(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function Fy(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function f1(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function m1(t){t._nesting--,ky(t)}class gT{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new oc,this.onMicrotaskEmpty=new oc,this.onStable=new oc,this.onError=new oc}run(n,r,a){return n.apply(r,a)}runGuarded(n,r,a){return n.apply(r,a)}runOutsideAngular(n){return n()}runTask(n,r,a,h){return n.apply(r,a)}}let Ry=(()=>{class t{constructor(r){this._ngZone=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),r.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Io.assertNotInAngularZone(),Py(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Py(()=>{for(;0!==this._callbacks.length;){let r=this._callbacks.pop();clearTimeout(r.timeoutId),r.doneCb(this._didWork)}this._didWork=!1});else{let r=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>!a.updateCb||!a.updateCb(r)||(clearTimeout(a.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(r=>({source:r.source,creationLocation:r.creationLocation,data:r.data})):[]}addCallback(r,a,h){let g=-1;a&&a>0&&(g=setTimeout(()=>{this._callbacks=this._callbacks.filter(b=>b.timeoutId!==g),r(this._didWork,this.getPendingTasks())},a)),this._callbacks.push({doneCb:r,timeoutId:g,updateCb:h})}whenStable(r,a,h){if(h&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(r,a,h),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(r,a,h){return[]}}return t.\u0275fac=function(r){return new(r||t)(ht(Io))},t.\u0275prov=en({token:t,factory:t.\u0275fac}),t})(),g1=(()=>{class t{constructor(){this._applications=new Map,Ly.addToWindow(this)}registerApplication(r,a){this._applications.set(r,a)}unregisterApplication(r){this._applications.delete(r)}unregisterAllApplications(){this._applications.clear()}getTestability(r){return this._applications.get(r)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(r,a=!0){return Ly.findTestabilityInTree(this,r,a)}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=en({token:t,factory:t.\u0275fac}),t})();class _T{addToWindow(n){}findTestabilityInTree(n,r,a){return null}}let _a,Ly=new _T;const _1=new cn("AllowMultipleToken");function y1(t,n,r=[]){const a=`Platform: ${n}`,h=new cn(a);return(g=[])=>{let b=v1();if(!b||b.injector.get(_1,!1))if(t)t(r.concat(g).concat({provide:h,useValue:!0}));else{const T=r.concat(g).concat({provide:h,useValue:!0},{provide:M,useValue:"platform"});!function bT(t){if(_a&&!_a.destroyed&&!_a.injector.get(_1,!1))throw new an(400,"");_a=t.get(x1);const n=t.get(p1,null);n&&n.forEach(r=>r())}(We.create({providers:T,name:a}))}return function wT(t){const n=v1();if(!n)throw new an(401,"");return n}()}}function v1(){return _a&&!_a.destroyed?_a:null}let x1=(()=>{class t{constructor(r){this._injector=r,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(r,a){const T=function ET(t,n){let r;return r="noop"===t?new gT:("zone.js"===t?void 0:t)||new Io({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==n?void 0:n.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==n?void 0:n.ngZoneRunCoalescing)}),r}(a?a.ngZone:void 0,{ngZoneEventCoalescing:a&&a.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:a&&a.ngZoneRunCoalescing||!1}),I=[{provide:Io,useValue:T}];return T.run(()=>{const k=We.create({providers:I,parent:this.injector,name:r.moduleType.name}),B=r.create(k),$=B.injector.get(Xu,null);if(!$)throw new an(402,"");return T.runOutsideAngular(()=>{const ee=T.onError.subscribe({next:oe=>{$.handleError(oe)}});B.onDestroy(()=>{zy(this._modules,B),ee.unsubscribe()})}),function DT(t,n,r){try{const a=r();return ny(a)?a.catch(h=>{throw n.runOutsideAngular(()=>t.handleError(h)),h}):a}catch(a){throw n.runOutsideAngular(()=>t.handleError(a)),a}}($,T,()=>{const ee=B.injector.get(Sy);return ee.runInitializers(),ee.donePromise.then(()=>(function Zw(t){gt(t,"Expected localeId to be defined"),"string"==typeof t&&(t0=t.toLowerCase().replace(/_/g,"-"))}(B.injector.get(tu,sg)||sg),this._moduleDoBootstrap(B),B))})})}bootstrapModule(r,a=[]){const h=b1({},a);return function vT(t,n,r){const a=new my(r);return Promise.resolve(a)}(0,0,r).then(g=>this.bootstrapModuleFactory(g,h))}_moduleDoBootstrap(r){const a=r.injector.get(w1);if(r._bootstrapComponents.length>0)r._bootstrapComponents.forEach(h=>a.bootstrap(h));else{if(!r.instance.ngDoBootstrap)throw new an(403,"");r.instance.ngDoBootstrap(a)}this._modules.push(r)}onDestroy(r){this._destroyListeners.push(r)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new an(404,"");this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(r){return new(r||t)(ht(We))},t.\u0275prov=en({token:t,factory:t.\u0275fac}),t})();function b1(t,n){return Array.isArray(n)?n.reduce(b1,t):Object.assign(Object.assign({},t),n)}let w1=(()=>{class t{constructor(r,a,h,g,b){this._zone=r,this._injector=a,this._exceptionHandler=h,this._componentFactoryResolver=g,this._initStatus=b,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const T=new wn(k=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{k.next(this._stable),k.complete()})}),I=new wn(k=>{let B;this._zone.runOutsideAngular(()=>{B=this._zone.onStable.subscribe(()=>{Io.assertNotInAngularZone(),Py(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,k.next(!0))})})});const $=this._zone.onUnstable.subscribe(()=>{Io.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{k.next(!1)}))});return()=>{B.unsubscribe(),$.unsubscribe()}});this.isStable=function ho(...t){const n=nt(t),r=function ct(t,n){return"number"==typeof Se(t)?t.pop():n}(t,1/0),a=t;return a.length?1===a.length?Sr(a[0]):function me(t=1/0){return le(Ro,t)}(r)($n(a,n)):fe}(T,I.pipe(function vh(t={}){const{connector:n=(()=>new wa),resetOnError:r=!0,resetOnComplete:a=!0,resetOnRefCountZero:h=!0}=t;return g=>{let b=null,T=null,I=null,k=0,B=!1,$=!1;const ee=()=>{null==T||T.unsubscribe(),T=null},oe=()=>{ee(),b=I=null,B=$=!1},ge=()=>{const Re=b;oe(),null==Re||Re.unsubscribe()};return Lo((Re,He)=>{k++,!$&&!B&&ee();const Ge=I=null!=I?I:n();He.add(()=>{k--,0===k&&!$&&!B&&(T=yl(ge,h))}),Ge.subscribe(He),b||(b=new Ss({next:Ce=>Ge.next(Ce),error:Ce=>{$=!0,ee(),T=yl(oe,r,Ce),Ge.error(Ce)},complete:()=>{B=!0,ee(),T=yl(oe,a),Ge.complete()}}),$n(Re).subscribe(b))})(g)}}()))}bootstrap(r,a){if(!this._initStatus.done)throw new an(405,"");let h;h=r instanceof M0?r:this._componentFactoryResolver.resolveComponentFactory(r),this.componentTypes.push(h.componentType);const g=function xT(t){return t.isBoundToModule}(h)?void 0:this._injector.get(Nd),T=h.create(We.NULL,[],a||h.selector,g),I=T.location.nativeElement,k=T.injector.get(Ry,null),B=k&&T.injector.get(g1);return k&&B&&B.registerApplication(I,k),T.onDestroy(()=>{this.detachView(T.hostView),zy(this.components,T),B&&B.unregisterApplication(I)}),this._loadComponent(T),T}tick(){if(this._runningTick)throw new an(101,"");try{this._runningTick=!0;for(let r of this._views)r.detectChanges()}catch(r){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(r))}finally{this._runningTick=!1}}attachView(r){const a=r;this._views.push(a),a.attachToAppRef(this)}detachView(r){const a=r;zy(this._views,a),a.detachFromAppRef()}_loadComponent(r){this.attachView(r.hostView),this.tick(),this.components.push(r),this._injector.get(oT,[]).concat(this._bootstrapListeners).forEach(h=>h(r))}ngOnDestroy(){this._views.slice().forEach(r=>r.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return t.\u0275fac=function(r){return new(r||t)(ht(Io),ht(We),ht(Xu),ht(hg),ht(Sy))},t.\u0275prov=en({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function zy(t,n){const r=t.indexOf(n);r>-1&&t.splice(r,1)}let D1=!0;class S1{constructor(){}supports(n){return nc(n)}create(n){return new LT(n)}}const RT=(t,n)=>n;class LT{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||RT}forEachItem(n){let r;for(r=this._itHead;null!==r;r=r._next)n(r)}forEachOperation(n){let r=this._itHead,a=this._removalsHead,h=0,g=null;for(;r||a;){const b=!a||r&&r.currentIndex<P1(a,h,g)?r:a,T=P1(b,h,g),I=b.currentIndex;if(b===a)h--,a=a._nextRemoved;else if(r=r._next,null==b.previousIndex)h++;else{g||(g=[]);const k=T-h,B=I-h;if(k!=B){for(let ee=0;ee<k;ee++){const oe=ee<g.length?g[ee]:g[ee]=0,ge=oe+ee;B<=ge&&ge<k&&(g[ee]=oe+1)}g[b.previousIndex]=B-k}}T!==I&&n(b,T,I)}}forEachPreviousItem(n){let r;for(r=this._previousItHead;null!==r;r=r._nextPrevious)n(r)}forEachAddedItem(n){let r;for(r=this._additionsHead;null!==r;r=r._nextAdded)n(r)}forEachMovedItem(n){let r;for(r=this._movesHead;null!==r;r=r._nextMoved)n(r)}forEachRemovedItem(n){let r;for(r=this._removalsHead;null!==r;r=r._nextRemoved)n(r)}forEachIdentityChange(n){let r;for(r=this._identityChangesHead;null!==r;r=r._nextIdentityChange)n(r)}diff(n){if(null==n&&(n=[]),!nc(n))throw new an(900,"");return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let h,g,b,r=this._itHead,a=!1;if(Array.isArray(n)){this.length=n.length;for(let T=0;T<this.length;T++)g=n[T],b=this._trackByFn(T,g),null!==r&&Object.is(r.trackById,b)?(a&&(r=this._verifyReinsertion(r,g,b,T)),Object.is(r.item,g)||this._addIdentityChange(r,g)):(r=this._mismatch(r,g,b,T),a=!0),r=r._next}else h=0,function Ts(t,n){if(Array.isArray(t))for(let r=0;r<t.length;r++)n(t[r]);else{const r=t[tc()]();let a;for(;!(a=r.next()).done;)n(a.value)}}(n,T=>{b=this._trackByFn(h,T),null!==r&&Object.is(r.trackById,b)?(a&&(r=this._verifyReinsertion(r,T,b,h)),Object.is(r.item,T)||this._addIdentityChange(r,T)):(r=this._mismatch(r,T,b,h),a=!0),r=r._next,h++}),this.length=h;return this._truncate(r),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,r,a,h){let g;return null===n?g=this._itTail:(g=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null))?(Object.is(n.item,r)||this._addIdentityChange(n,r),this._reinsertAfter(n,g,h)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(a,h))?(Object.is(n.item,r)||this._addIdentityChange(n,r),this._moveAfter(n,g,h)):n=this._addAfter(new zT(r,a),g,h),n}_verifyReinsertion(n,r,a,h){let g=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null);return null!==g?n=this._reinsertAfter(g,n._prev,h):n.currentIndex!=h&&(n.currentIndex=h,this._addToMoves(n,h)),n}_truncate(n){for(;null!==n;){const r=n._next;this._addToRemovals(this._unlink(n)),n=r}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,r,a){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const h=n._prevRemoved,g=n._nextRemoved;return null===h?this._removalsHead=g:h._nextRemoved=g,null===g?this._removalsTail=h:g._prevRemoved=h,this._insertAfter(n,r,a),this._addToMoves(n,a),n}_moveAfter(n,r,a){return this._unlink(n),this._insertAfter(n,r,a),this._addToMoves(n,a),n}_addAfter(n,r,a){return this._insertAfter(n,r,a),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,r,a){const h=null===r?this._itHead:r._next;return n._next=h,n._prev=r,null===h?this._itTail=n:h._prev=n,null===r?this._itHead=n:r._next=n,null===this._linkedRecords&&(this._linkedRecords=new A1),this._linkedRecords.put(n),n.currentIndex=a,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const r=n._prev,a=n._next;return null===r?this._itHead=a:r._next=a,null===a?this._itTail=r:a._prev=r,n}_addToMoves(n,r){return n.previousIndex===r||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new A1),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,r){return n.item=r,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class zT{constructor(n,r){this.item=n,this.trackById=r,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class OT{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,r){let a;for(a=this._head;null!==a;a=a._nextDup)if((null===r||r<=a.currentIndex)&&Object.is(a.trackById,n))return a;return null}remove(n){const r=n._prevDup,a=n._nextDup;return null===r?this._head=a:r._nextDup=a,null===a?this._tail=r:a._prevDup=r,null===this._head}}class A1{constructor(){this.map=new Map}put(n){const r=n.trackById;let a=this.map.get(r);a||(a=new OT,this.map.set(r,a)),a.add(n)}get(n,r){const h=this.map.get(n);return h?h.get(n,r):null}remove(n){const r=n.trackById;return this.map.get(r).remove(n)&&this.map.delete(r),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function P1(t,n,r){const a=t.previousIndex;if(null===a)return a;let h=0;return r&&a<r.length&&(h=r[a]),a+n+h}function F1(){return new xg([new S1])}let xg=(()=>{class t{constructor(r){this.factories=r}static create(r,a){if(null!=a){const h=a.factories.slice();r=r.concat(h)}return new t(r)}static extend(r){return{provide:t,useFactory:a=>t.create(r,a||F1()),deps:[[t,new Ci,new ji]]}}find(r){const a=this.factories.find(h=>h.supports(r));if(null!=a)return a;throw new an(901,"")}}return t.\u0275prov=en({token:t,providedIn:"root",factory:F1}),t})();const UT=y1(null,"core",[{provide:_g,useValue:"unknown"},{provide:x1,deps:[We]},{provide:g1,deps:[]},{provide:sT,deps:[]}]);let $T=(()=>{class t{constructor(r){}}return t.\u0275fac=function(r){return new(r||t)(ht(w1))},t.\u0275mod=ms({type:t}),t.\u0275inj=ki({}),t})(),bg=null;function Cf(){return bg}const ya=new cn("DocumentToken");function H1(t,n){n=encodeURIComponent(n);for(const r of t.split(";")){const a=r.indexOf("="),[h,g]=-1==a?[r,""]:[r.slice(0,a),r.slice(a+1)];if(h.trim()===n)return decodeURIComponent(g)}return null}class RC{constructor(n,r,a,h){this.$implicit=n,this.ngForOf=r,this.index=a,this.count=h}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let q1=(()=>{class t{constructor(r,a,h){this._viewContainer=r,this._template=a,this._differs=h,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(r){this._ngForOf=r,this._ngForOfDirty=!0}set ngForTrackBy(r){this._trackByFn=r}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(r){r&&(this._template=r)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const r=this._ngForOf;!this._differ&&r&&(this._differ=this._differs.find(r).create(this.ngForTrackBy))}if(this._differ){const r=this._differ.diff(this._ngForOf);r&&this._applyChanges(r)}}_applyChanges(r){const a=this._viewContainer;r.forEachOperation((h,g,b)=>{if(null==h.previousIndex)a.createEmbeddedView(this._template,new RC(h.item,this._ngForOf,-1,-1),null===b?void 0:b);else if(null==b)a.remove(null===g?void 0:g);else if(null!==g){const T=a.get(g);a.move(T,b),Z1(T,h)}});for(let h=0,g=a.length;h<g;h++){const T=a.get(h).context;T.index=h,T.count=g,T.ngForOf=this._ngForOf}r.forEachIdentityChange(h=>{Z1(a.get(h.currentIndex),h)})}static ngTemplateContextGuard(r,a){return!0}}return t.\u0275fac=function(r){return new(r||t)(Qt(al),Qt(sc),Qt(xg))},t.\u0275dir=bi({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),t})();function Z1(t,n){t.context.$implicit=n.item}let W1=(()=>{class t{constructor(r,a){this._viewContainer=r,this._context=new LC,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=a}set ngIf(r){this._context.$implicit=this._context.ngIf=r,this._updateView()}set ngIfThen(r){X1("ngIfThen",r),this._thenTemplateRef=r,this._thenViewRef=null,this._updateView()}set ngIfElse(r){X1("ngIfElse",r),this._elseTemplateRef=r,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(r,a){return!0}}return t.\u0275fac=function(r){return new(r||t)(Qt(al),Qt(sc))},t.\u0275dir=bi({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),t})();class LC{constructor(){this.$implicit=null,this.ngIf=null}}function X1(t,n){if(n&&!n.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${nn(n)}'.`)}let lM=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=ms({type:t}),t.\u0275inj=ki({}),t})();class eb{}class ev extends class pM extends class qT{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function HT(t){bg||(bg=t)}(new ev)}onAndCancel(n,r,a){return n.addEventListener(r,a,!1),()=>{n.removeEventListener(r,a,!1)}}dispatchEvent(n,r){n.dispatchEvent(r)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,r){return(r=r||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,r){return"window"===r?window:"document"===r?n:"body"===r?n.body:null}getBaseHref(n){const r=function fM(){return Sf=Sf||document.querySelector("base"),Sf?Sf.getAttribute("href"):null}();return null==r?null:function mM(t){Pg=Pg||document.createElement("a"),Pg.setAttribute("href",t);const n=Pg.pathname;return"/"===n.charAt(0)?n:`/${n}`}(r)}resetBaseElement(){Sf=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return H1(document.cookie,n)}}let Pg,Sf=null;const tb=new cn("TRANSITION_ID"),_M=[{provide:h1,useFactory:function gM(t,n,r){return()=>{r.get(Sy).donePromise.then(()=>{const a=Cf(),h=n.querySelectorAll(`style[ng-transition="${t}"]`);for(let g=0;g<h.length;g++)a.remove(h[g])})}},deps:[tb,ya,We],multi:!0}];class tv{static init(){!function yT(t){Ly=t}(new tv)}addToWindow(n){$t.getAngularTestability=(a,h=!0)=>{const g=n.findTestabilityInTree(a,h);if(null==g)throw new Error("Could not find testability for element.");return g},$t.getAllAngularTestabilities=()=>n.getAllTestabilities(),$t.getAllAngularRootElements=()=>n.getAllRootElements(),$t.frameworkStabilizers||($t.frameworkStabilizers=[]),$t.frameworkStabilizers.push(a=>{const h=$t.getAllAngularTestabilities();let g=h.length,b=!1;const T=function(I){b=b||I,g--,0==g&&a(b)};h.forEach(function(I){I.whenStable(T)})})}findTestabilityInTree(n,r,a){if(null==r)return null;const h=n.getTestability(r);return null!=h?h:a?Cf().isShadowRoot(r)?this.findTestabilityInTree(n,r.host,!0):this.findTestabilityInTree(n,r.parentElement,!0):null}}let yM=(()=>{class t{build(){return new XMLHttpRequest}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=en({token:t,factory:t.\u0275fac}),t})();const kg=new cn("EventManagerPlugins");let Fg=(()=>{class t{constructor(r,a){this._zone=a,this._eventNameToPlugin=new Map,r.forEach(h=>h.manager=this),this._plugins=r.slice().reverse()}addEventListener(r,a,h){return this._findPluginFor(a).addEventListener(r,a,h)}addGlobalEventListener(r,a,h){return this._findPluginFor(a).addGlobalEventListener(r,a,h)}getZone(){return this._zone}_findPluginFor(r){const a=this._eventNameToPlugin.get(r);if(a)return a;const h=this._plugins;for(let g=0;g<h.length;g++){const b=h[g];if(b.supports(r))return this._eventNameToPlugin.set(r,b),b}throw new Error(`No event manager plugin found for event ${r}`)}}return t.\u0275fac=function(r){return new(r||t)(ht(kg),ht(Io))},t.\u0275prov=en({token:t,factory:t.\u0275fac}),t})();class nb{constructor(n){this._doc=n}addGlobalEventListener(n,r,a){const h=Cf().getGlobalEventTarget(this._doc,n);if(!h)throw new Error(`Unsupported event target ${h} for event ${r}`);return this.addEventListener(h,r,a)}}let rb=(()=>{class t{constructor(){this._stylesSet=new Set}addStyles(r){const a=new Set;r.forEach(h=>{this._stylesSet.has(h)||(this._stylesSet.add(h),a.add(h))}),this.onStylesAdded(a)}onStylesAdded(r){}getAllStyles(){return Array.from(this._stylesSet)}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=en({token:t,factory:t.\u0275fac}),t})(),Af=(()=>{class t extends rb{constructor(r){super(),this._doc=r,this._hostNodes=new Map,this._hostNodes.set(r.head,[])}_addStylesToHost(r,a,h){r.forEach(g=>{const b=this._doc.createElement("style");b.textContent=g,h.push(a.appendChild(b))})}addHost(r){const a=[];this._addStylesToHost(this._stylesSet,r,a),this._hostNodes.set(r,a)}removeHost(r){const a=this._hostNodes.get(r);a&&a.forEach(ib),this._hostNodes.delete(r)}onStylesAdded(r){this._hostNodes.forEach((a,h)=>{this._addStylesToHost(r,h,a)})}ngOnDestroy(){this._hostNodes.forEach(r=>r.forEach(ib))}}return t.\u0275fac=function(r){return new(r||t)(ht(ya))},t.\u0275prov=en({token:t,factory:t.\u0275fac}),t})();function ib(t){Cf().remove(t)}const nv={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},rv=/%COMP%/g;function Rg(t,n,r){for(let a=0;a<n.length;a++){let h=n[a];Array.isArray(h)?Rg(t,h,r):(h=h.replace(rv,t),r.push(h))}return r}function ab(t){return n=>{if("__ngUnwrap__"===n)return t;!1===t(n)&&(n.preventDefault(),n.returnValue=!1)}}let iv=(()=>{class t{constructor(r,a,h){this.eventManager=r,this.sharedStylesHost=a,this.appId=h,this.rendererByCompId=new Map,this.defaultRenderer=new ov(r)}createRenderer(r,a){if(!r||!a)return this.defaultRenderer;switch(a.encapsulation){case xi.Emulated:{let h=this.rendererByCompId.get(a.id);return h||(h=new DM(this.eventManager,this.sharedStylesHost,a,this.appId),this.rendererByCompId.set(a.id,h)),h.applyToHost(r),h}case 1:case xi.ShadowDom:return new TM(this.eventManager,this.sharedStylesHost,r,a);default:if(!this.rendererByCompId.has(a.id)){const h=Rg(a.id,a.styles,[]);this.sharedStylesHost.addStyles(h),this.rendererByCompId.set(a.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return t.\u0275fac=function(r){return new(r||t)(ht(Fg),ht(Af),ht(Df))},t.\u0275prov=en({token:t,factory:t.\u0275fac}),t})();class ov{constructor(n){this.eventManager=n,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(n,r){return r?document.createElementNS(nv[r]||r,n):document.createElement(n)}createComment(n){return document.createComment(n)}createText(n){return document.createTextNode(n)}appendChild(n,r){n.appendChild(r)}insertBefore(n,r,a){n&&n.insertBefore(r,a)}removeChild(n,r){n&&n.removeChild(r)}selectRootElement(n,r){let a="string"==typeof n?document.querySelector(n):n;if(!a)throw new Error(`The selector "${n}" did not match any elements`);return r||(a.textContent=""),a}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,r,a,h){if(h){r=h+":"+r;const g=nv[h];g?n.setAttributeNS(g,r,a):n.setAttribute(r,a)}else n.setAttribute(r,a)}removeAttribute(n,r,a){if(a){const h=nv[a];h?n.removeAttributeNS(h,r):n.removeAttribute(`${a}:${r}`)}else n.removeAttribute(r)}addClass(n,r){n.classList.add(r)}removeClass(n,r){n.classList.remove(r)}setStyle(n,r,a,h){h&(li.DashCase|li.Important)?n.style.setProperty(r,a,h&li.Important?"important":""):n.style[r]=a}removeStyle(n,r,a){a&li.DashCase?n.style.removeProperty(r):n.style[r]=""}setProperty(n,r,a){n[r]=a}setValue(n,r){n.nodeValue=r}listen(n,r,a){return"string"==typeof n?this.eventManager.addGlobalEventListener(n,r,ab(a)):this.eventManager.addEventListener(n,r,ab(a))}}class DM extends ov{constructor(n,r,a,h){super(n),this.component=a;const g=Rg(h+"-"+a.id,a.styles,[]);r.addStyles(g),this.contentAttr=function bM(t){return"_ngcontent-%COMP%".replace(rv,t)}(h+"-"+a.id),this.hostAttr=function wM(t){return"_nghost-%COMP%".replace(rv,t)}(h+"-"+a.id)}applyToHost(n){super.setAttribute(n,this.hostAttr,"")}createElement(n,r){const a=super.createElement(n,r);return super.setAttribute(a,this.contentAttr,""),a}}class TM extends ov{constructor(n,r,a,h){super(n),this.sharedStylesHost=r,this.hostEl=a,this.shadowRoot=a.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const g=Rg(h.id,h.styles,[]);for(let b=0;b<g.length;b++){const T=document.createElement("style");T.textContent=g[b],this.shadowRoot.appendChild(T)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(n,r){return super.appendChild(this.nodeOrShadowRoot(n),r)}insertBefore(n,r,a){return super.insertBefore(this.nodeOrShadowRoot(n),r,a)}removeChild(n,r){return super.removeChild(this.nodeOrShadowRoot(n),r)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}}let CM=(()=>{class t extends nb{constructor(r){super(r)}supports(r){return!0}addEventListener(r,a,h){return r.addEventListener(a,h,!1),()=>this.removeEventListener(r,a,h)}removeEventListener(r,a,h){return r.removeEventListener(a,h)}}return t.\u0275fac=function(r){return new(r||t)(ht(ya))},t.\u0275prov=en({token:t,factory:t.\u0275fac}),t})();const cb=["alt","control","meta","shift"],IM={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},ub={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},SM={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let AM=(()=>{class t extends nb{constructor(r){super(r)}supports(r){return null!=t.parseEventName(r)}addEventListener(r,a,h){const g=t.parseEventName(a),b=t.eventCallback(g.fullKey,h,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Cf().onAndCancel(r,g.domEventName,b))}static parseEventName(r){const a=r.toLowerCase().split("."),h=a.shift();if(0===a.length||"keydown"!==h&&"keyup"!==h)return null;const g=t._normalizeKey(a.pop());let b="";if(cb.forEach(I=>{const k=a.indexOf(I);k>-1&&(a.splice(k,1),b+=I+".")}),b+=g,0!=a.length||0===g.length)return null;const T={};return T.domEventName=h,T.fullKey=b,T}static getEventFullKey(r){let a="",h=function PM(t){let n=t.key;if(null==n){if(n=t.keyIdentifier,null==n)return"Unidentified";n.startsWith("U+")&&(n=String.fromCharCode(parseInt(n.substring(2),16)),3===t.location&&ub.hasOwnProperty(n)&&(n=ub[n]))}return IM[n]||n}(r);return h=h.toLowerCase()," "===h?h="space":"."===h&&(h="dot"),cb.forEach(g=>{g!=h&&SM[g](r)&&(a+=g+".")}),a+=h,a}static eventCallback(r,a,h){return g=>{t.getEventFullKey(g)===r&&h.runGuarded(()=>a(g))}}static _normalizeKey(r){return"esc"===r?"escape":r}}return t.\u0275fac=function(r){return new(r||t)(ht(ya))},t.\u0275prov=en({token:t,factory:t.\u0275fac}),t})();const LM=y1(UT,"browser",[{provide:_g,useValue:"browser"},{provide:p1,useValue:function kM(){ev.makeCurrent(),tv.init()},multi:!0},{provide:ya,useFactory:function RM(){return function Dc(t){Sl=t}(document),document},deps:[]}]),zM=[{provide:M,useValue:"root"},{provide:Xu,useFactory:function FM(){return new Xu},deps:[]},{provide:kg,useClass:CM,multi:!0,deps:[ya,Io,_g]},{provide:kg,useClass:AM,multi:!0,deps:[ya]},{provide:iv,useClass:iv,deps:[Fg,Af,Df]},{provide:S0,useExisting:iv},{provide:rb,useExisting:Af},{provide:Af,useClass:Af,deps:[ya]},{provide:Ry,useClass:Ry,deps:[Io]},{provide:Fg,useClass:Fg,deps:[kg,Io]},{provide:eb,useClass:yM,deps:[]}];let OM=(()=>{class t{constructor(r){if(r)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(r){return{ngModule:t,providers:[{provide:Df,useValue:r.appId},{provide:tb,useExisting:Df},_M]}}}return t.\u0275fac=function(r){return new(r||t)(ht(t,12))},t.\u0275mod=ms({type:t}),t.\u0275inj=ki({providers:zM,imports:[lM,$T]}),t})();"undefined"!=typeof window&&window;class pb{}class fb{}class lc{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?this.lazyInit="string"==typeof n?()=>{this.headers=new Map,n.split("\n").forEach(r=>{const a=r.indexOf(":");if(a>0){const h=r.slice(0,a),g=h.toLowerCase(),b=r.slice(a+1).trim();this.maybeSetNormalizedName(h,g),this.headers.has(g)?this.headers.get(g).push(b):this.headers.set(g,[b])}})}:()=>{this.headers=new Map,Object.keys(n).forEach(r=>{let a=n[r];const h=r.toLowerCase();"string"==typeof a&&(a=[a]),a.length>0&&(this.headers.set(h,a),this.maybeSetNormalizedName(r,h))})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();const r=this.headers.get(n.toLowerCase());return r&&r.length>0?r[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,r){return this.clone({name:n,value:r,op:"a"})}set(n,r){return this.clone({name:n,value:r,op:"s"})}delete(n,r){return this.clone({name:n,value:r,op:"d"})}maybeSetNormalizedName(n,r){this.normalizedNames.has(r)||this.normalizedNames.set(r,n)}init(){this.lazyInit&&(this.lazyInit instanceof lc?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(r=>{this.headers.set(r,n.headers.get(r)),this.normalizedNames.set(r,n.normalizedNames.get(r))})}clone(n){const r=new lc;return r.lazyInit=this.lazyInit&&this.lazyInit instanceof lc?this.lazyInit:this,r.lazyUpdate=(this.lazyUpdate||[]).concat([n]),r}applyUpdate(n){const r=n.name.toLowerCase();switch(n.op){case"a":case"s":let a=n.value;if("string"==typeof a&&(a=[a]),0===a.length)return;this.maybeSetNormalizedName(n.name,r);const h=("a"===n.op?this.headers.get(r):void 0)||[];h.push(...a),this.headers.set(r,h);break;case"d":const g=n.value;if(g){let b=this.headers.get(r);if(!b)return;b=b.filter(T=>-1===g.indexOf(T)),0===b.length?(this.headers.delete(r),this.normalizedNames.delete(r)):this.headers.set(r,b)}else this.headers.delete(r),this.normalizedNames.delete(r)}}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(r=>n(this.normalizedNames.get(r),this.headers.get(r)))}}class JM{encodeKey(n){return mb(n)}encodeValue(n){return mb(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}}const QM=/%(\d[a-f0-9])/gi,eI={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function mb(t){return encodeURIComponent(t).replace(QM,(n,r)=>{var a;return null!==(a=eI[r])&&void 0!==a?a:n})}function gb(t){return`${t}`}class ru{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new JM,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function YM(t,n){const r=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(h=>{const g=h.indexOf("="),[b,T]=-1==g?[n.decodeKey(h),""]:[n.decodeKey(h.slice(0,g)),n.decodeValue(h.slice(g+1))],I=r.get(b)||[];I.push(T),r.set(b,I)}),r}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(r=>{const a=n.fromObject[r];this.map.set(r,Array.isArray(a)?a:[a])})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();const r=this.map.get(n);return r?r[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,r){return this.clone({param:n,value:r,op:"a"})}appendAll(n){const r=[];return Object.keys(n).forEach(a=>{const h=n[a];Array.isArray(h)?h.forEach(g=>{r.push({param:a,value:g,op:"a"})}):r.push({param:a,value:h,op:"a"})}),this.clone(r)}set(n,r){return this.clone({param:n,value:r,op:"s"})}delete(n,r){return this.clone({param:n,value:r,op:"d"})}toString(){return this.init(),this.keys().map(n=>{const r=this.encoder.encodeKey(n);return this.map.get(n).map(a=>r+"="+this.encoder.encodeValue(a)).join("&")}).filter(n=>""!==n).join("&")}clone(n){const r=new ru({encoder:this.encoder});return r.cloneFrom=this.cloneFrom||this,r.updates=(this.updates||[]).concat(n),r}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":const r=("a"===n.op?this.map.get(n.param):void 0)||[];r.push(gb(n.value)),this.map.set(n.param,r);break;case"d":if(void 0===n.value){this.map.delete(n.param);break}{let a=this.map.get(n.param)||[];const h=a.indexOf(gb(n.value));-1!==h&&a.splice(h,1),a.length>0?this.map.set(n.param,a):this.map.delete(n.param)}}}),this.cloneFrom=this.updates=null)}}class tI{constructor(){this.map=new Map}set(n,r){return this.map.set(n,r),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}}function _b(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer}function yb(t){return"undefined"!=typeof Blob&&t instanceof Blob}function vb(t){return"undefined"!=typeof FormData&&t instanceof FormData}class Pf{constructor(n,r,a,h){let g;if(this.url=r,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase(),function nI(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||h?(this.body=void 0!==a?a:null,g=h):g=a,g&&(this.reportProgress=!!g.reportProgress,this.withCredentials=!!g.withCredentials,g.responseType&&(this.responseType=g.responseType),g.headers&&(this.headers=g.headers),g.context&&(this.context=g.context),g.params&&(this.params=g.params)),this.headers||(this.headers=new lc),this.context||(this.context=new tI),this.params){const b=this.params.toString();if(0===b.length)this.urlWithParams=r;else{const T=r.indexOf("?");this.urlWithParams=r+(-1===T?"?":T<r.length-1?"&":"")+b}}else this.params=new ru,this.urlWithParams=r}serializeBody(){return null===this.body?null:_b(this.body)||yb(this.body)||vb(this.body)||function rI(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof ru?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||vb(this.body)?null:yb(this.body)?this.body.type||null:_b(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof ru?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(n={}){var r;const a=n.method||this.method,h=n.url||this.url,g=n.responseType||this.responseType,b=void 0!==n.body?n.body:this.body,T=void 0!==n.withCredentials?n.withCredentials:this.withCredentials,I=void 0!==n.reportProgress?n.reportProgress:this.reportProgress;let k=n.headers||this.headers,B=n.params||this.params;const $=null!==(r=n.context)&&void 0!==r?r:this.context;return void 0!==n.setHeaders&&(k=Object.keys(n.setHeaders).reduce((ee,oe)=>ee.set(oe,n.setHeaders[oe]),k)),n.setParams&&(B=Object.keys(n.setParams).reduce((ee,oe)=>ee.set(oe,n.setParams[oe]),B)),new Pf(a,h,b,{params:B,headers:k,context:$,reportProgress:I,responseType:g,withCredentials:T})}}var Nr=(()=>((Nr=Nr||{})[Nr.Sent=0]="Sent",Nr[Nr.UploadProgress=1]="UploadProgress",Nr[Nr.ResponseHeader=2]="ResponseHeader",Nr[Nr.DownloadProgress=3]="DownloadProgress",Nr[Nr.Response=4]="Response",Nr[Nr.User=5]="User",Nr))();class av{constructor(n,r=200,a="OK"){this.headers=n.headers||new lc,this.status=void 0!==n.status?n.status:r,this.statusText=n.statusText||a,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}}class lv extends av{constructor(n={}){super(n),this.type=Nr.ResponseHeader}clone(n={}){return new lv({headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class Lg extends av{constructor(n={}){super(n),this.type=Nr.Response,this.body=void 0!==n.body?n.body:null}clone(n={}){return new Lg({body:void 0!==n.body?n.body:this.body,headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class xb extends av{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${n.url||"(unknown url)"}`:`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}}function cv(t,n){return{body:n,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let bb=(()=>{class t{constructor(r){this.handler=r}request(r,a,h={}){let g;if(r instanceof Pf)g=r;else{let I,k;I=h.headers instanceof lc?h.headers:new lc(h.headers),h.params&&(k=h.params instanceof ru?h.params:new ru({fromObject:h.params})),g=new Pf(r,a,void 0!==h.body?h.body:null,{headers:I,context:h.context,params:k,reportProgress:h.reportProgress,responseType:h.responseType||"json",withCredentials:h.withCredentials})}const b=function WM(...t){return $n(t,nt(t))}(g).pipe(function XM(t,n){return Bn(n)?le(t,n,1):le(t,1)}(I=>this.handler.handle(I)));if(r instanceof Pf||"events"===h.observe)return b;const T=b.pipe(function KM(t,n){return Lo((r,a)=>{let h=0;r.subscribe(new Si(a,g=>t.call(n,g,h++)&&a.next(g)))})}(I=>I instanceof Lg));switch(h.observe||"body"){case"body":switch(g.responseType){case"arraybuffer":return T.pipe(Vr(I=>{if(null!==I.body&&!(I.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return I.body}));case"blob":return T.pipe(Vr(I=>{if(null!==I.body&&!(I.body instanceof Blob))throw new Error("Response is not a Blob.");return I.body}));case"text":return T.pipe(Vr(I=>{if(null!==I.body&&"string"!=typeof I.body)throw new Error("Response is not a string.");return I.body}));default:return T.pipe(Vr(I=>I.body))}case"response":return T;default:throw new Error(`Unreachable: unhandled observe type ${h.observe}}`)}}delete(r,a={}){return this.request("DELETE",r,a)}get(r,a={}){return this.request("GET",r,a)}head(r,a={}){return this.request("HEAD",r,a)}jsonp(r,a){return this.request("JSONP",r,{params:(new ru).append(a,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(r,a={}){return this.request("OPTIONS",r,a)}patch(r,a,h={}){return this.request("PATCH",r,cv(h,a))}post(r,a,h={}){return this.request("POST",r,cv(h,a))}put(r,a,h={}){return this.request("PUT",r,cv(h,a))}}return t.\u0275fac=function(r){return new(r||t)(ht(pb))},t.\u0275prov=en({token:t,factory:t.\u0275fac}),t})();class wb{constructor(n,r){this.next=n,this.interceptor=r}handle(n){return this.interceptor.intercept(n,this.next)}}const Eb=new cn("HTTP_INTERCEPTORS");let iI=(()=>{class t{intercept(r,a){return a.handle(r)}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=en({token:t,factory:t.\u0275fac}),t})();const oI=/^\)\]\}',?\n/;let Db=(()=>{class t{constructor(r){this.xhrFactory=r}handle(r){if("JSONP"===r.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new wn(a=>{const h=this.xhrFactory.build();if(h.open(r.method,r.urlWithParams),r.withCredentials&&(h.withCredentials=!0),r.headers.forEach((oe,ge)=>h.setRequestHeader(oe,ge.join(","))),r.headers.has("Accept")||h.setRequestHeader("Accept","application/json, text/plain, */*"),!r.headers.has("Content-Type")){const oe=r.detectContentTypeHeader();null!==oe&&h.setRequestHeader("Content-Type",oe)}if(r.responseType){const oe=r.responseType.toLowerCase();h.responseType="json"!==oe?oe:"text"}const g=r.serializeBody();let b=null;const T=()=>{if(null!==b)return b;const oe=h.statusText||"OK",ge=new lc(h.getAllResponseHeaders()),Re=function sI(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(h)||r.url;return b=new lv({headers:ge,status:h.status,statusText:oe,url:Re}),b},I=()=>{let{headers:oe,status:ge,statusText:Re,url:He}=T(),Ge=null;204!==ge&&(Ge=void 0===h.response?h.responseText:h.response),0===ge&&(ge=Ge?200:0);let Ce=ge>=200&&ge<300;if("json"===r.responseType&&"string"==typeof Ge){const dt=Ge;Ge=Ge.replace(oI,"");try{Ge=""!==Ge?JSON.parse(Ge):null}catch(Bt){Ge=dt,Ce&&(Ce=!1,Ge={error:Bt,text:Ge})}}Ce?(a.next(new Lg({body:Ge,headers:oe,status:ge,statusText:Re,url:He||void 0})),a.complete()):a.error(new xb({error:Ge,headers:oe,status:ge,statusText:Re,url:He||void 0}))},k=oe=>{const{url:ge}=T(),Re=new xb({error:oe,status:h.status||0,statusText:h.statusText||"Unknown Error",url:ge||void 0});a.error(Re)};let B=!1;const $=oe=>{B||(a.next(T()),B=!0);let ge={type:Nr.DownloadProgress,loaded:oe.loaded};oe.lengthComputable&&(ge.total=oe.total),"text"===r.responseType&&!!h.responseText&&(ge.partialText=h.responseText),a.next(ge)},ee=oe=>{let ge={type:Nr.UploadProgress,loaded:oe.loaded};oe.lengthComputable&&(ge.total=oe.total),a.next(ge)};return h.addEventListener("load",I),h.addEventListener("error",k),h.addEventListener("timeout",k),h.addEventListener("abort",k),r.reportProgress&&(h.addEventListener("progress",$),null!==g&&h.upload&&h.upload.addEventListener("progress",ee)),h.send(g),a.next({type:Nr.Sent}),()=>{h.removeEventListener("error",k),h.removeEventListener("abort",k),h.removeEventListener("load",I),h.removeEventListener("timeout",k),r.reportProgress&&(h.removeEventListener("progress",$),null!==g&&h.upload&&h.upload.removeEventListener("progress",ee)),h.readyState!==h.DONE&&h.abort()}})}}return t.\u0275fac=function(r){return new(r||t)(ht(eb))},t.\u0275prov=en({token:t,factory:t.\u0275fac}),t})();const uv=new cn("XSRF_COOKIE_NAME"),hv=new cn("XSRF_HEADER_NAME");class Tb{}let aI=(()=>{class t{constructor(r,a,h){this.doc=r,this.platform=a,this.cookieName=h,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const r=this.doc.cookie||"";return r!==this.lastCookieString&&(this.parseCount++,this.lastToken=H1(r,this.cookieName),this.lastCookieString=r),this.lastToken}}return t.\u0275fac=function(r){return new(r||t)(ht(ya),ht(_g),ht(uv))},t.\u0275prov=en({token:t,factory:t.\u0275fac}),t})(),dv=(()=>{class t{constructor(r,a){this.tokenService=r,this.headerName=a}intercept(r,a){const h=r.url.toLowerCase();if("GET"===r.method||"HEAD"===r.method||h.startsWith("http://")||h.startsWith("https://"))return a.handle(r);const g=this.tokenService.getToken();return null!==g&&!r.headers.has(this.headerName)&&(r=r.clone({headers:r.headers.set(this.headerName,g)})),a.handle(r)}}return t.\u0275fac=function(r){return new(r||t)(ht(Tb),ht(hv))},t.\u0275prov=en({token:t,factory:t.\u0275fac}),t})(),lI=(()=>{class t{constructor(r,a){this.backend=r,this.injector=a,this.chain=null}handle(r){if(null===this.chain){const a=this.injector.get(Eb,[]);this.chain=a.reduceRight((h,g)=>new wb(h,g),this.backend)}return this.chain.handle(r)}}return t.\u0275fac=function(r){return new(r||t)(ht(fb),ht(We))},t.\u0275prov=en({token:t,factory:t.\u0275fac}),t})(),cI=(()=>{class t{static disable(){return{ngModule:t,providers:[{provide:dv,useClass:iI}]}}static withOptions(r={}){return{ngModule:t,providers:[r.cookieName?{provide:uv,useValue:r.cookieName}:[],r.headerName?{provide:hv,useValue:r.headerName}:[]]}}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=ms({type:t}),t.\u0275inj=ki({providers:[dv,{provide:Eb,useExisting:dv,multi:!0},{provide:Tb,useClass:aI},{provide:uv,useValue:"XSRF-TOKEN"},{provide:hv,useValue:"X-XSRF-TOKEN"}]}),t})(),uI=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=ms({type:t}),t.\u0275inj=ki({providers:[bb,{provide:pb,useClass:lI},Db,{provide:fb,useExisting:Db}],imports:[[cI.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),t})();var pv=uc(898);const Cb_mapbox_accessToken="pk.eyJ1IjoicnhsMyIsImEiOiJjbDBzOTZvOTkwYjNlM2puNTBmamZnbGRiIn0.Bxp9WUS69H7HKEESbWxBjw",{isArray:hI}=Array,{getPrototypeOf:dI,prototype:pI,keys:fI}=Object;const{isArray:_I}=Array;function bI(...t){const n=nt(t),r=function ze(t){return Bn(Se(t))?t.pop():void 0}(t),{args:a,keys:h}=function mI(t){if(1===t.length){const n=t[0];if(hI(n))return{args:n,keys:null};if(function gI(t){return t&&"object"==typeof t&&dI(t)===pI}(n)){const r=fI(n);return{args:r.map(a=>n[a]),keys:r}}}return{args:t,keys:null}}(t);if(0===a.length)return $n([],n);const g=new wn(function wI(t,n,r=Ro){return a=>{Mb(n,()=>{const{length:h}=t,g=new Array(h);let b=h,T=h;for(let I=0;I<h;I++)Mb(n,()=>{const k=$n(t[I],n);let B=!1;k.subscribe(new Si(a,$=>{g[I]=$,B||(B=!0,T--),T||a.next(r(g.slice()))},()=>{--b||a.complete()}))},a)},a)}}(a,n,h?b=>function xI(t,n){return t.reduce((r,a,h)=>(r[a]=n[h],r),{})}(h,b):Ro));return r?g.pipe(function vI(t){return Vr(n=>function yI(t,n){return _I(n)?t(...n):t(n)}(t,n))}(r)):g}function Mb(t,n,r){t?X(r,t,n):n()}function EI(t,n){if(1&t){const r=function ox(){return Oe()}();qi(0,"span")(1,"label")(2,"input",8),rg("click",function(){const g=function zi(t){return xt.lFrame.contextLView=t,t[8]}(r).$implicit;return kd().toggleOffenceFilter(g)}),Jr(),sl(3),Jr()()}if(2&t){const r=n.$implicit,a=kd();wo(2),eu("checked",a.isOffenceSelected(r)),wo(1),og(" ",r," ")}}function DI(t,n){if(1&t&&(qi(0,"div",11)(1,"div"),sl(2),Jr(),qi(3,"div"),sl(4),Jr()()),2&t){const r=n.$implicit,a=kd(2);wo(2),Rd(a.toTitleCase(r.properties.wa_local_2)),wo(2),Rd(r.properties["crime-rate"])}}function TI(t,n){if(1&t&&(qi(0,"div",11)(1,"div"),sl(2),Jr(),qi(3,"div"),sl(4),Jr()()),2&t){const r=n.$implicit,a=kd(2);wo(2),Rd(a.toTitleCase(r.properties.wa_local_2)),wo(2),Rd(r.properties["crime-rate"])}}function CI(t,n){if(1&t&&(tg(0),qi(1,"h3"),sl(2,"Highest crime rate suburbs per capita"),Jr(),qi(3,"div",9),ff(4,DI,5,2,"div",10),Jr(),qi(5,"h3"),sl(6,"Lowest crime rate suburbs per capita"),Jr(),qi(7,"div",9),ff(8,TI,5,2,"div",10),Jr(),ng()),2&t){const r=kd();wo(4),eu("ngForOf",r.highestCrimeRateLocalities),wo(4),eu("ngForOf",r.lowestCrimeRateLocalities)}}var zg=(()=>{return(t=zg||(zg={})).Homicide="Homicide",t.SexualOffences="Sexual Offences",t.AssaultFamily="Assault (Family)",t.AssaultNonFamily="Assault (Non-Family)",t.ThreateningFamily="Threatening Behaviour (Family)",t.ThreateningNonFamily="Threatening Behaviour (Non-Family)",t.Deprivation="Deprivation of Liberty",t.Robbery="Robbery",t.DwellingBurglary="Dwelling Burglary",t.NonDwellingBurglary="Non-Dwelling Burglary",t.StealingMotorVehicle="Stealing of Motor Vehicle",t.Stealing="Stealing",t.PropertyDamage="Property Damage",t.Arson="Arson",t.DrugOffences="Drug Offences",t.Graffiti="Graffiti",t.Fraud="Fraud & Related Offences",t.BreachOfRestraint="Breach of Violence Restraint Order",zg;var t})(),Og=(()=>{return(t=Og||(Og={}))["2011-12"]="2011-12",t["2012-13"]="2012-13",t["2013-14"]="2013-14",t["2014-15"]="2014-15",t["2015-16"]="2015-16",t["2016-17"]="2016-17",t["2017-18"]="2017-18",t["2018-19"]="2018-19",t["2019-20"]="2019-20",t["2020-21"]="2020-21",t["2021-22"]="2021-22",Og;var t})();let MI=(()=>{class t{constructor(r){this.http=r,this.style="mapbox://styles/mapbox/streets-v11",this.lat=-31.95,this.lng=115.86,this.minLat=-32.63,this.maxLat=-31.55,this.minLng=115.63,this.maxLng=116.08,this.geoJsonUrl="assets/suburbs.geojson",this.localitiesUrl="assets/localities.json",this.statsUrl="assets/locality_stats.json",this.populationsUrl="assets/population_data.json",this.hoveredSuburbId=null,this.offenceList=Object.values(zg),this.selectedOffenceFilters=[...this.offenceList]}toTitleCase(r){let a=r.split(" ");return a=a.map(h=>h[0].toUpperCase()+h.slice(1).toLowerCase()),a.join(" ")}ngOnInit(){bI([this.http.get(this.geoJsonUrl),this.http.get(this.localitiesUrl),this.http.get(this.statsUrl),this.http.get(this.populationsUrl)]).subscribe(([r,a,h,g])=>{this.geoJsonData=r,this.localities=a,this.localityStats=h,this.populations=g;let b=[];r.features.forEach(I=>{const k=I.geometry;let B=!1;for(let $=0;$<k.coordinates.length;$++)if(+k.coordinates[0][0][$][0]<this.maxLng&&+k.coordinates[0][0][$][0]>this.minLng&&+k.coordinates[0][0][$][1]<this.maxLat&&+k.coordinates[0][0][$][1]>this.minLat){B=!0;break}B&&b.push(I)}),this.geoJsonData.features=b,this.filteredGeoJsonData=this.geoJsonData,this.recalculateCrimeRates(),this.map=new pv.Map({accessToken:Cb_mapbox_accessToken,container:"map",style:this.style,zoom:12,center:[this.lng,this.lat]}),this.map.setMaxBounds([this.minLng,this.minLat,this.maxLng,this.maxLat]),this.map.addControl(new pv.NavigationControl),this.map.on("load",()=>{this.map.addSource("westernAustralia",{type:"geojson",data:this.filteredGeoJsonData,generateId:!0}),this.map.addLayer({id:"suburb-fills",type:"fill",source:"westernAustralia",layout:{},paint:{"fill-color":["interpolate",["linear"],["get","crime-rate"],0,"#F6E7D8",4,"#F68989",6,"#C65D7B",10,"#874356",100,"#000"],"fill-opacity":["case",["boolean",["feature-state","hover"],!1],.85,.5]}}),this.map.addLayer({id:"outline",type:"line",source:"westernAustralia",layout:{},paint:{"line-color":"#627BC1","line-width":2}}),this.map.on("mousemove","suburb-fills",I=>{I&&I.features&&I.features.length>0&&(null!==this.hoveredSuburbId&&this.map.setFeatureState({source:"westernAustralia",id:this.hoveredSuburbId},{hover:!1}),this.hoveredSuburbId=I.features[0].id,this.hoveredSuburbName=I.features[0].properties.wa_local_2,this.map.setFeatureState({source:"westernAustralia",id:this.hoveredSuburbId},{hover:!0}))}),this.map.on("mouseleave","suburb-fills",()=>{null!==this.hoveredSuburbId&&this.map.setFeatureState({source:"westernAustralia",id:this.hoveredSuburbId},{hover:!1}),this.hoveredSuburbId=null,this.hoveredSuburbName=null}),this.map.on("click","suburb-fills",I=>{const k=this.localities.find(B=>B.Name.toUpperCase()===this.hoveredSuburbName);if(k){let B=0;const $=this.populations[k.Name.toUpperCase()],ee=this.localityStats.find(Ce=>Ce[0].Locality===k.Name);ee&&ee.forEach(Ce=>{this.selectedOffenceFilters.includes(Ce.Offence)&&(B+=+Ce.TotalAnnual)});const oe=50,ge=10,Re=25;new pv.Popup({offset:{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-oe],"bottom-left":[Re,-1*(oe-ge+Re)],"bottom-right":[-Re,-1*(oe-ge+Re)],left:[ge,-1*(oe-ge)],right:[-ge,-1*(oe-ge)]},className:"map-popup"}).setLngLat(I.lngLat).setHTML(`<div style="padding:0.5rem"><h2 style="padding-left: 3px">${k.Name}</h2><table><tr><td style="font-weight: bold">Rank</td><td>${this.geoJsonData.features.findIndex(Ce=>Ce.properties.wa_local_2===k.Name.toUpperCase())}/${this.geoJsonData.features.length}</td></tr><tr><td style="font-weight: bold">Crime Rate</td><td>${$>100?(B/$).toFixed(2):"Insufficient data"}</td></tr></table></div>`).setMaxWidth("300px").addTo(this.map)}})})})}recalculateCrimeRates(){this.geoJsonData.features.forEach(g=>{const b=g.properties.wa_local_2,T=this.populations[b];let I=0;const k=this.localityStats.find(B=>B[0].Locality===this.toTitleCase(b));k&&k.filter($=>$.FinancialYear===Og["2021-22"]).forEach($=>{this.selectedOffenceFilters.includes($.Offence)&&(I+=+$.TotalAnnual)}),g.properties["crime-rate"]=T>=100?+(100*I/T).toFixed(2):NaN});const r=this.geoJsonData.features.filter(g=>g.properties["crime-rate"]>=0);r.sort((g,b)=>+g.properties["crime-rate"]>+b.properties["crime-rate"]?1:+g.properties["crime-rate"]<+b.properties["crime-rate"]?-1:0),this.filteredGeoJsonData.features=r,r.map(g=>g.properties["crime-rate"]);const h=this.geoJsonData.features.filter(g=>g.properties["crime-rate"]>=0);this.highestCrimeRateLocalities=h.slice(-10).reverse(),this.lowestCrimeRateLocalities=h.slice(0,10),this.map&&this.map.getSource("westernAustralia").setData(this.geoJsonData)}toggleOffenceFilter(r){const a=this.selectedOffenceFilters.findIndex(g=>g===r);a>-1?this.selectedOffenceFilters.splice(a,1):this.selectedOffenceFilters.push(r),document.getElementById("selectAll").indeterminate=this.selectedOffenceFilters.length>0&&this.selectedOffenceFilters.length<this.offenceList.length,this.recalculateCrimeRates()}toggleAllFilters(){document.getElementById("selectAll").indeterminate=!1,this.selectedOffenceFilters=this.selectedOffenceFilters.length>0?[]:[...this.offenceList],this.recalculateCrimeRates()}isOffenceSelected(r){return this.selectedOffenceFilters.findIndex(a=>a===r)>-1}}return t.\u0275fac=function(r){return new(r||t)(Qt(bb))},t.\u0275cmp=ka({type:t,selectors:[["app-map"]],decls:11,vars:3,consts:[[1,"flex-container"],[1,"map-container"],["id","map",1,"match-parent"],[1,"filters"],["type","checkbox","id","selectAll",3,"checked","click"],[4,"ngFor","ngForOf"],[1,"panel-container"],[4,"ngIf"],["type","checkbox",3,"checked","click"],[1,"panel-column"],["class","panel-row",4,"ngFor","ngForOf"],[1,"panel-row"]],template:function(r,a){1&r&&(qi(0,"div",0)(1,"div",1),eg(2,"div",2),qi(3,"div",3)(4,"span")(5,"label")(6,"input",4),rg("click",function(){return a.toggleAllFilters()}),Jr(),sl(7," Select All "),Jr()(),ff(8,EI,4,2,"span",5),Jr()(),qi(9,"div",6),ff(10,CI,9,2,"ng-container",7),Jr()()),2&r&&(wo(6),eu("checked",a.selectedOffenceFilters.length===a.offenceList.length),wo(2),eu("ngForOf",a.offenceList),wo(2),eu("ngIf",a.selectedOffenceFilters.length>0))},directives:[q1,W1],styles:[".flex-container[_ngcontent-%COMP%]{display:flex;height:100%}.map-container[_ngcontent-%COMP%]{flex:2;height:100%}.panel-container[_ngcontent-%COMP%]{flex:1;padding:1rem}.panel-container[_ngcontent-%COMP%]   .panel-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-wrap:wrap;max-height:14rem}.panel-container[_ngcontent-%COMP%]   .panel-column[_ngcontent-%COMP%]   .panel-row[_ngcontent-%COMP%]{width:50%}.panel-container[_ngcontent-%COMP%]   .panel-column[_ngcontent-%COMP%]   .panel-row[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2){font-weight:300}.match-parent[_ngcontent-%COMP%]{width:100%;height:100%;max-width:1000px;margin:0 auto}.filters[_ngcontent-%COMP%]{max-width:1000px;margin:1rem auto 0;display:flex;flex-wrap:wrap}.filters[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:inline-block;margin-top:.5rem;flex:1;min-width:16rem}.filters[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:not(:last-child){margin-right:.5rem}.filters[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:inline-block}.map-popup[_ngcontent-%COMP%]{text-align:left}"]}),t})(),II=(()=>{class t{constructor(){this.title="pcmap"}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275cmp=ka({type:t,selectors:[["app-root"]],decls:4,vars:0,consts:[[1,"app-main"]],template:function(r,a){1&r&&(qi(0,"div",0)(1,"h1"),sl(2,"Perth crime rates divided by suburb (# per 100 residents)"),Jr(),eg(3,"app-map"),Jr())},directives:[MI],styles:[".app-main[_ngcontent-%COMP%]{height:600px;padding:1.5rem}.app-main[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{text-align:center;font-weight:600}"]}),t})(),SI=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=ms({type:t,bootstrap:[II]}),t.\u0275inj=ki({providers:[],imports:[[OM,uI]]}),t})();(function CT(){D1=!1})(),LM().bootstrapModule(SI).catch(t=>console.error(t))},898:function(Ud){Ud.exports=function(){"use strict";var cc,uc,Bn;function _h(d,Jn){if(cc)if(uc){var Ao="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+cc+")(sharedChunk); ("+uc+")(sharedChunk); self.onerror = null;",ei={};cc(ei),Bn=Jn(ei),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(Bn.workerUrl=window.URL.createObjectURL(new Blob([Ao],{type:"text/javascript"})))}else uc=Jn;else cc=Jn}return _h(0,function(d){var Ao=ei;function ei(i,e,s,l){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(l-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=l,this.p2x=s,this.p2y=l}ei.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},ei.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},ei.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},ei.prototype.solveCurveX=function(i,e){var s,l,u,p,_;for(void 0===e&&(e=1e-6),u=i,_=0;_<8;_++){if(p=this.sampleCurveX(u)-i,Math.abs(p)<e)return u;var v=this.sampleCurveDerivativeX(u);if(Math.abs(v)<1e-6)break;u-=p/v}if((u=i)<(s=0))return s;if(u>(l=1))return l;for(;s<l;){if(p=this.sampleCurveX(u),Math.abs(p-i)<e)return u;i>p?s=u:l=u,u=.5*(l-s)+s}return u},ei.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var Ke=yt;function yt(i,e){this.x=i,this.y=e}yt.prototype={clone:function(){return new yt(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,s=i.y-this.y;return e*e+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),s=Math.sin(i),l=s*this.x+e*this.y;return this.x=e*this.x-s*this.y,this.y=l,this},_rotateAround:function(i,e){var s=Math.cos(i),l=Math.sin(i),u=e.y+l*(this.x-e.x)+s*(this.y-e.y);return this.x=e.x+s*(this.x-e.x)-l*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},yt.convert=function(i){return i instanceof yt?i:Array.isArray(i)?new yt(i[0],i[1]):i};var Ae="undefined"!=typeof self?self:{},mi=1e-6,Tn="undefined"!=typeof Float32Array?Float32Array:Array;function ll(){var i=new Tn(9);return Tn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function ti(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function cl(i,e,s){var l=e[0],u=e[1],p=e[2],_=e[3],v=e[4],w=e[5],D=e[6],M=e[7],S=e[8],A=e[9],z=e[10],N=e[11],U=e[12],q=e[13],J=e[14],ie=e[15],ce=s[0],he=s[1],pe=s[2],de=s[3];return i[0]=ce*l+he*v+pe*S+de*U,i[1]=ce*u+he*w+pe*A+de*q,i[2]=ce*p+he*D+pe*z+de*J,i[3]=ce*_+he*M+pe*N+de*ie,i[4]=(ce=s[4])*l+(he=s[5])*v+(pe=s[6])*S+(de=s[7])*U,i[5]=ce*u+he*w+pe*A+de*q,i[6]=ce*p+he*D+pe*z+de*J,i[7]=ce*_+he*M+pe*N+de*ie,i[8]=(ce=s[8])*l+(he=s[9])*v+(pe=s[10])*S+(de=s[11])*U,i[9]=ce*u+he*w+pe*A+de*q,i[10]=ce*p+he*D+pe*z+de*J,i[11]=ce*_+he*M+pe*N+de*ie,i[12]=(ce=s[12])*l+(he=s[13])*v+(pe=s[14])*S+(de=s[15])*U,i[13]=ce*u+he*w+pe*A+de*q,i[14]=ce*p+he*D+pe*z+de*J,i[15]=ce*_+he*M+pe*N+de*ie,i}function Zi(i,e,s){var l,u,p,_,v,w,D,M,S,A,z,N,U=s[0],q=s[1],J=s[2];return e===i?(i[12]=e[0]*U+e[4]*q+e[8]*J+e[12],i[13]=e[1]*U+e[5]*q+e[9]*J+e[13],i[14]=e[2]*U+e[6]*q+e[10]*J+e[14],i[15]=e[3]*U+e[7]*q+e[11]*J+e[15]):(u=e[1],p=e[2],_=e[3],v=e[4],w=e[5],D=e[6],M=e[7],S=e[8],A=e[9],z=e[10],N=e[11],i[0]=l=e[0],i[1]=u,i[2]=p,i[3]=_,i[4]=v,i[5]=w,i[6]=D,i[7]=M,i[8]=S,i[9]=A,i[10]=z,i[11]=N,i[12]=l*U+v*q+S*J+e[12],i[13]=u*U+w*q+A*J+e[13],i[14]=p*U+D*q+z*J+e[14],i[15]=_*U+M*q+N*J+e[15]),i}function fr(i,e,s){var l=s[0],u=s[1],p=s[2];return i[0]=e[0]*l,i[1]=e[1]*l,i[2]=e[2]*l,i[3]=e[3]*l,i[4]=e[4]*u,i[5]=e[5]*u,i[6]=e[6]*u,i[7]=e[7]*u,i[8]=e[8]*p,i[9]=e[9]*p,i[10]=e[10]*p,i[11]=e[11]*p,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Po(i,e,s){var l=Math.sin(s),u=Math.cos(s),p=e[4],_=e[5],v=e[6],w=e[7],D=e[8],M=e[9],S=e[10],A=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=p*u+D*l,i[5]=_*u+M*l,i[6]=v*u+S*l,i[7]=w*u+A*l,i[8]=D*u-p*l,i[9]=M*u-_*l,i[10]=S*u-v*l,i[11]=A*u-w*l,i}function ao(i,e,s){var l=Math.sin(s),u=Math.cos(s),p=e[0],_=e[1],v=e[2],w=e[3],D=e[8],M=e[9],S=e[10],A=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*u-D*l,i[1]=_*u-M*l,i[2]=v*u-S*l,i[3]=w*u-A*l,i[8]=p*l+D*u,i[9]=_*l+M*u,i[10]=v*l+S*u,i[11]=w*l+A*u,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var ko=cl;function Ss(){var i=new Tn(3);return Tn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Fo(i){var e=new Tn(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function ul(i){return Math.hypot(i[0],i[1],i[2])}function Wi(i,e,s){var l=new Tn(3);return l[0]=i,l[1]=e,l[2]=s,l}function hl(i,e,s){return i[0]=e[0]+s[0],i[1]=e[1]+s[1],i[2]=e[2]+s[2],i}function os(i,e,s){return i[0]=e[0]-s[0],i[1]=e[1]-s[1],i[2]=e[2]-s[2],i}function Ro(i,e,s){return i[0]=e[0]*s[0],i[1]=e[1]*s[1],i[2]=e[2]*s[2],i}function yh(i,e,s){return i[0]=Math.max(e[0],s[0]),i[1]=Math.max(e[1],s[1]),i[2]=Math.max(e[2],s[2]),i}function Xi(i,e,s){return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i}function wn(i,e,s,l){return i[0]=e[0]+s[0]*l,i[1]=e[1]+s[1]*l,i[2]=e[2]+s[2]*l,i}function As(i,e){var s=e[0],l=e[1],u=e[2],p=s*s+l*l+u*u;return p>0&&(p=1/Math.sqrt(p)),i[0]=e[0]*p,i[1]=e[1]*p,i[2]=e[2]*p,i}function lo(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function ba(i,e,s){var l=e[0],u=e[1],p=e[2],_=s[0],v=s[1],w=s[2];return i[0]=u*w-p*v,i[1]=p*_-l*w,i[2]=l*v-u*_,i}function Ut(i,e,s){var l=e[0],u=e[1],p=e[2],_=s[3]*l+s[7]*u+s[11]*p+s[15];return i[0]=(s[0]*l+s[4]*u+s[8]*p+s[12])/(_=_||1),i[1]=(s[1]*l+s[5]*u+s[9]*p+s[13])/_,i[2]=(s[2]*l+s[6]*u+s[10]*p+s[14])/_,i}function wa(i,e,s){var l=s[0],u=s[1],p=s[2],_=e[0],v=e[1],w=e[2],D=u*w-p*v,M=p*_-l*w,S=l*v-u*_,A=u*S-p*M,z=p*D-l*S,N=l*M-u*D,U=2*s[3];return M*=U,S*=U,z*=2,N*=2,i[0]=_+(D*=U)+(A*=2),i[1]=v+M+z,i[2]=w+S+N,i}var ss,i,Ps=os,Lo=Ro,Si=ul;function Vr(i,e,s){var l=e[0],u=e[1],p=e[2],_=e[3];return i[0]=s[0]*l+s[4]*u+s[8]*p+s[12]*_,i[1]=s[1]*l+s[5]*u+s[9]*p+s[13]*_,i[2]=s[2]*l+s[6]*u+s[10]*p+s[14]*_,i[3]=s[3]*l+s[7]*u+s[11]*p+s[15]*_,i}function ks(){var i=new Tn(4);return Tn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function iu(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function dl(i,e,s){s*=.5;var l=e[0],u=e[1],p=e[2],_=e[3],v=Math.sin(s),w=Math.cos(s);return i[0]=l*w+_*v,i[1]=u*w+p*v,i[2]=p*w-u*v,i[3]=_*w-l*v,i}function hc(i,e){return i[0]===e[0]&&i[1]===e[1]}Ss(),ss=new Tn(4),Tn!=Float32Array&&(ss[0]=0,ss[1]=0,ss[2]=0,ss[3]=0),Ss(),Wi(1,0,0),Wi(0,1,0),ks(),ks(),ll(),i=new Tn(2),Tn!=Float32Array&&(i[0]=0,i[1]=0);const ou=Math.PI/180,pl=180/Math.PI;function Ft(i){return i*ou}function gi(i){return i*pl}const Ea=[[0,0],[1,0],[1,1],[0,1]];function Da(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,s=e*i;return 4*(i<.5?s:3*(i-e)+s-.75)}function dc(i,e,s,l){const u=new Ao(i,e,s,l);return function(p){return u.solve(p)}}const Ta=dc(.25,.1,.25,1);function on(i,e,s){return Math.min(s,Math.max(e,i))}function Fs(i,e,s){return(s=on((s-i)/(e-i),0,1))*s*(3-2*s)}function as(i,e,s){const l=s-e,u=((i-e)%l+l)%l+e;return u===e?s:u}function Ca(i,e,s){if(!i.length)return s(null,[]);let l=i.length;const u=new Array(i.length);let p=null;i.forEach((_,v)=>{e(_,(w,D)=>{w&&(p=w),u[v]=D,0==--l&&s(p,u)})})}function Ai(i){const e=[];for(const s in i)e.push(i[s]);return e}function Nn(i,...e){for(const s of e)for(const l in s)i[l]=s[l];return i}let pc=1;function fl(){return pc++}function fc(){return function i(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Pi(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function su(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function ml(i,e){i.forEach(s=>{e[s]&&(e[s]=e[s].bind(e))})}function gl(i,e){return-1!==i.indexOf(e,i.length-e.length)}function Rs(i,e,s){const l={};for(const u in i)l[u]=e.call(s||this,i[u],u,i);return l}function Ls(i,e,s){const l={};for(const u in i)e.call(s||this,i[u],u,i)&&(l[u]=i[u]);return l}function _i(i){return Array.isArray(i)?i.map(_i):"object"==typeof i&&i?Rs(i,_i):i}const _l={};function Mn(i){_l[i]||("undefined"!=typeof console&&console.warn(i),_l[i]=!0)}function yi(i,e,s){return(s.y-i.y)*(e.x-i.x)>(e.y-i.y)*(s.x-i.x)}function Ma(i){let e=0;for(let s,l,u=0,p=i.length,_=p-1;u<p;_=u++)s=i[u],l=i[_],e+=(l.x-s.x)*(s.y+l.y);return e}function Ki(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function zs(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,l,u,p)=>{const _=u||p;return e[l]=!_||_.toLowerCase(),""}),e["max-age"]){const s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e}let ls,co,Sr,cs=null;function uo(i){if(null==cs){const e=i.navigator?i.navigator.userAgent:null;cs=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return cs}function Ia(i){try{const e=Ae[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(e){return!1}}const vi={now:()=>void 0!==Sr?Sr:Ae.performance.now(),setNow(i){Sr=i},restoreNow(){Sr=void 0},frame(i){const e=Ae.requestAnimationFrame(i);return{cancel:()=>Ae.cancelAnimationFrame(e)}},getImageData(i,e=0){const s=Ae.document.createElement("canvas"),l=s.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return s.width=i.width,s.height=i.height,l.drawImage(i,0,0,i.width,i.height),l.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(ls||(ls=Ae.document.createElement("a")),ls.href=i,ls.href),get devicePixelRatio(){return Ae.devicePixelRatio},get prefersReducedMotion(){return!!Ae.matchMedia&&(null==co&&(co=Ae.matchMedia("(prefers-reduced-motion: reduce)")),co.matches)}};let K;const L={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==K){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{K=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):i}catch(e){K=i}}return K},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},V={supported:!1,testSupport:function(i){!le&&Y&&(me?fe(i):X=i)}};let X,Y,le=!1,me=!1;function fe(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Y),i.isContextLost())return;V.supported=!0}catch(s){}i.deleteTexture(e),le=!0}Ae.document&&(Y=Ae.document.createElement("img"),Y.onload=function(){X&&fe(X),X=null,me=!0},Y.onerror=function(){le=!0,X=null},Y.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ue="01",ye="NO_ACCESS_TOKEN";function Me(i){return 0===i.indexOf("mapbox:")}function Se(i){return L.API_URL_REGEX.test(i)}const ze=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function nt(i){const e=i.match(ze);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ct(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function lt(i){if(!i)return null;const e=i.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Ae.atob(e[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(s){return null}}class ut{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const s=lt(L.ACCESS_TOKEN);let l="";return l=s&&s.u?Ae.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(u,p)=>String.fromCharCode(Number("0x"+p)))):L.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${l}`:`mapbox.eventData:${l}`}fetchEventData(){const e=Ia("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{const u=Ae.localStorage.getItem(s);u&&(this.eventData=JSON.parse(u));const p=Ae.localStorage.getItem(l);p&&(this.anonId=p)}catch(u){Mn("Unable to read from LocalStorage")}}saveEventData(){const e=Ia("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{Ae.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&Ae.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(u){Mn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,s,l,u){if(!L.EVENTS_URL)return;const p=nt(L.EVENTS_URL);p.params.push(`access_token=${u||L.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.7.0",skuId:ue,userId:this.anonId},v=s?Nn(_,s):_,w={url:ct(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=Oo(w,D=>{this.pendingRequest=null,l(D),this.saveEventData(),this.processRequests(u)})}queueRequest(e,s){this.queue.push(e),this.processRequests(s)}}const It=new class extends ut{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){L.EVENTS_URL&&L.ACCESS_TOKEN&&Array.isArray(i)&&i.some(s=>Me(s)||Se(s))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=lt(L.ACCESS_TOKEN),s=e?e.u:L.ACCESS_TOKEN;let l=s!==this.eventData.tokenU;su(this.anonId)||(this.anonId=fc(),l=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),_=new Date(u),v=(u-this.eventData.lastSuccess)/864e5;l=l||v>=1||v<-1||p.getDate()!==_.getDate()}else l=!0;if(!l)return this.processRequests();this.postEvent(u,{"enabled.telemetry":!1},p=>{p||(this.eventData.lastSuccess=u,this.eventData.tokenU=s)},i)}},yn=It.postTurnstileEvent.bind(It),Cn=new class extends ut{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,s,l){this.skuToken=e,this.errorCb=l,L.EVENTS_URL&&(s||L.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},s):this.errorCb(new Error(ye)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:s}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),su(this.anonId)||(this.anonId=fc()),this.postEvent(s,{skuToken:this.skuToken},l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},i))}},fn=Cn.postMapLoadEvent.bind(Cn),En=new class extends ut{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,s,l){if(!L.API_URL||!L.SESSION_PATH)return;const u=nt(L.API_URL+L.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${l||L.ACCESS_TOKEN||""}`);const p={url:ct(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=an(p,_=>{this.pendingRequest=null,s(_),this.saveEventData(),this.processRequests(l)})}getSessionAPI(i,e,s,l){this.skuToken=e,this.errorCb=l,L.SESSION_PATH&&L.API_URL&&(s||L.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},s):this.errorCb(new Error(ye)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:s}=this.queue.shift();e&&this.success[e]||this.getSession(s,this.skuToken,l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},i)}},us=En.getSessionAPI.bind(En),zo=new Set,$n="mapbox-tiles";let ho,mc,vh=500,yl=50;function sn(){Ae.caches&&!ho&&(ho=Ae.caches.open($n))}function vl(i){const e=i.indexOf("?");return e<0?i:i.slice(0,e)}let nn=1/0;const Sa={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Sa);class xl extends Error{constructor(e,s,l){401===s&&Se(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=s,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const bl=Ki()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Ae.location.protocol?Ae.parent:Ae).location.href,mt=function(i,e){if(!(/^file:/.test(s=i.url)||/^file:/.test(bl())&&!/^\w+:/.test(s))){if(Ae.fetch&&Ae.Request&&Ae.AbortController&&Ae.Request.prototype.hasOwnProperty("signal"))return function(l,u){const p=new Ae.AbortController,_=new Ae.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:bl(),signal:p.signal});let v=!1,w=!1;const D=(M=_.url).indexOf("sku=")>0&&Se(M);var M;"json"===l.type&&_.headers.set("Accept","application/json");const S=(z,N,U)=>{if(w)return;if(z&&"SecurityError"!==z.message&&Mn(z),N&&U)return A(N);const q=Date.now();Ae.fetch(_).then(J=>{if(J.ok){const ie=D?J.clone():null;return A(J,ie,q)}return u(new xl(J.statusText,J.status,l.url))}).catch(J=>{20!==J.code&&u(new Error(J.message))})},A=(z,N,U)=>{("arrayBuffer"===l.type?z.arrayBuffer():"json"===l.type?z.json():z.text()).then(q=>{w||(N&&U&&function(J,ie,ce){if(sn(),!ho)return;const he={status:ie.status,statusText:ie.statusText,headers:new Ae.Headers};ie.headers.forEach((de,De)=>he.headers.set(De,de));const pe=zs(ie.headers.get("Cache-Control")||"");pe["no-store"]||(pe["max-age"]&&he.headers.set("Expires",new Date(ce+1e3*pe["max-age"]).toUTCString()),new Date(he.headers.get("Expires")).getTime()-ce<42e4||function(de,De){if(void 0===mc)try{new Response(new ReadableStream),mc=!0}catch(we){mc=!1}mc?De(de.body):de.blob().then(De)}(ie,de=>{const De=new Ae.Response(de,he);sn(),ho&&ho.then(we=>we.put(vl(J.url),De)).catch(we=>Mn(we.message))}))}(_,N,U),v=!0,u(null,q,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(q=>{w||u(new Error(q.message))})};return D?function(z,N){if(sn(),!ho)return N(null);const U=vl(z.url);ho.then(q=>{q.match(U).then(J=>{const ie=function(ce){if(!ce)return!1;const he=new Date(ce.headers.get("Expires")||0),pe=zs(ce.headers.get("Cache-Control")||"");return he>Date.now()&&!pe["no-cache"]}(J);q.delete(U),ie&&q.put(U,J.clone()),N(null,J,ie)}).catch(N)}).catch(N)}(_,S):S(null,null),{cancel:()=>{w=!0,v||p.abort()}}}(i,e);if(Ki()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var s;return function(l,u){const p=new Ae.XMLHttpRequest;p.open(l.method||"GET",l.url,!0),"arrayBuffer"===l.type&&(p.responseType="arraybuffer");for(const _ in l.headers)p.setRequestHeader(_,l.headers[_]);return"json"===l.type&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials="include"===l.credentials,p.onerror=()=>{u(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||0===p.status)&&null!==p.response){let _=p.response;if("json"===l.type)try{_=JSON.parse(p.response)}catch(v){return u(v)}u(null,_,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else u(new xl(p.statusText,p.status,l.url))},p.send(l.body),{cancel:()=>p.abort()}}(i,e)},Aa=function(i,e){return mt(Nn(i,{type:"arrayBuffer"}),e)},Oo=function(i,e){return mt(Nn(i,{method:"POST"}),e)},an=function(i,e){return mt(Nn(i,{method:"GET"}),e)};function gc(i){const e=Ae.document.createElement("a");return e.href=i,e.protocol===Ae.document.location.protocol&&e.host===Ae.document.location.host}const vt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Yn,wl;Yn=[],wl=0;const Gd=function(i,e){if(V.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),wl>=L.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Yn.push(p),p}wl++;let s=!1;const l=()=>{if(!s)for(s=!0,wl--;Yn.length&&wl<L.MAX_PARALLEL_IMAGE_REQUESTS;){const p=Yn.shift(),{requestParameters:_,callback:v,cancelled:w}=p;w||(p.cancel=Gd(_,v).cancel)}},u=Aa(i,(p,_,v,w)=>{l(),p?e(p):_&&(Ae.createImageBitmap?function(D,M){const S=new Ae.Blob([new Uint8Array(D)],{type:"image/png"});Ae.createImageBitmap(S).then(A=>{M(null,A)}).catch(A=>{M(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(D,M)=>e(D,M,v,w)):function(D,M){const S=new Ae.Image,A=Ae.URL;S.onload=()=>{M(null,S),A.revokeObjectURL(S.src),S.onload=null,Ae.requestAnimationFrame(()=>{S.src=vt})},S.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new Ae.Blob([new Uint8Array(D)],{type:"image/png"});S.src=D.byteLength?A.createObjectURL(z):vt}(_,(D,M)=>e(D,M,v,w)))});return{cancel:()=>{u.cancel(),l()}}};function Hd(i,e,s){s[i]&&-1!==s[i].indexOf(e)||(s[i]=s[i]||[],s[i].push(e))}function Os(i,e,s){if(s&&s[i]){const l=s[i].indexOf(e);-1!==l&&s[i].splice(l,1)}}class Qn{constructor(e,s={}){Nn(this,s),this.type=e}}class au extends Qn{constructor(e,s={}){super("error",Nn({error:e},s))}}class hs{on(e,s){return this._listeners=this._listeners||{},Hd(e,s,this._listeners),this}off(e,s){return Os(e,s,this._listeners),Os(e,s,this._oneTimeListeners),this}once(e,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Hd(e,s,this._oneTimeListeners),this):new Promise(l=>this.once(e,l))}fire(e,s){"string"==typeof e&&(e=new Qn(e,s||{}));const l=e.type;if(this.listens(l)){e.target=this;const u=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const v of u)v.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const v of p)Os(l,v,this._oneTimeListeners),v.call(this,e);const _=this._eventedParent;_&&(Nn(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof au&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}var Ee=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class qe{constructor(e,s,l,u){this.message=(e?`${e}: `:"")+l,u&&(this.identifier=u),null!=s&&s.__line__&&(this.line=s.__line__)}}function qd(i){const e=i.value;return e?[new qe(i.key,e,"constants have been deprecated as of v8")]:[]}function Bs(i,...e){for(const s of e)for(const l in s)i[l]=s[l];return i}function Gn(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function ds(i){if(Array.isArray(i))return i.map(ds);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const s in i)e[s]=ds(i[s]);return e}return Gn(i)}class po extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}class lu{constructor(e,s=[]){this.parent=e,this.bindings={};for(const[l,u]of s)this.bindings[l]=u}concat(e){return new lu(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ps={kind:"null"},Je={kind:"number"},gt={kind:"string"},it={kind:"boolean"},Bo={kind:"color"},El={kind:"object"},St={kind:"value"},en={kind:"collator"},Ns={kind:"formatted"},ki={kind:"resolvedImage"};function ni(i,e){return{kind:"array",itemType:i,N:e}}function In(i){if("array"===i.kind){const e=In(i.itemType);return"number"==typeof i.N?`array<${e}, ${i.N}>`:"value"===i.itemType.kind?"array":`array<${e}>`}return i.kind}const Zd=[ps,Je,gt,it,Bo,Ns,El,ni(St),ki];function ri(i,e){if("error"===e.kind)return null;if("array"===i.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!ri(i.itemType,e.itemType))&&("number"!=typeof i.N||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if("value"===i.kind)for(const s of Zd)if(!ri(s,e))return null}return`Expected ${In(i)} but found ${In(e)} instead.`}function Dl(i,e){return e.some(s=>s.kind===i.kind)}function No(i,e){return e.some(s=>"null"===s?null===i:"array"===s?Array.isArray(i):"object"===s?i&&!Array.isArray(i)&&"object"==typeof i:s===typeof i)}function fs(i){var e={exports:{}};return i(e,e.exports),e.exports}var Vs=fs(function(i,e){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function l(v){return(v=Math.round(v))<0?0:v>255?255:v}function u(v){return l("%"===v[v.length-1]?parseFloat(v)/100*255:parseInt(v))}function p(v){return(w="%"===v[v.length-1]?parseFloat(v)/100:parseFloat(v))<0?0:w>1?1:w;var w}function _(v,w,D){return D<0?D+=1:D>1&&(D-=1),6*D<1?v+(w-v)*D*6:2*D<1?w:3*D<2?v+(w-v)*(2/3-D)*6:v}try{e.parseCSSColor=function(v){var w,D=v.replace(/ /g,"").toLowerCase();if(D in s)return s[D].slice();if("#"===D[0])return 4===D.length?(w=parseInt(D.substr(1),16))>=0&&w<=4095?[(3840&w)>>4|(3840&w)>>8,240&w|(240&w)>>4,15&w|(15&w)<<4,1]:null:7===D.length&&(w=parseInt(D.substr(1),16))>=0&&w<=16777215?[(16711680&w)>>16,(65280&w)>>8,255&w,1]:null;var M=D.indexOf("("),S=D.indexOf(")");if(-1!==M&&S+1===D.length){var A=D.substr(0,M),z=D.substr(M+1,S-(M+1)).split(","),N=1;switch(A){case"rgba":if(4!==z.length)return null;N=p(z.pop());case"rgb":return 3!==z.length?null:[u(z[0]),u(z[1]),u(z[2]),N];case"hsla":if(4!==z.length)return null;N=p(z.pop());case"hsl":if(3!==z.length)return null;var U=(parseFloat(z[0])%360+360)%360/360,q=p(z[1]),J=p(z[2]),ie=J<=.5?J*(q+1):J+q-J*q,ce=2*J-ie;return[l(255*_(ce,ie,U+1/3)),l(255*_(ce,ie,U)),l(255*_(ce,ie,U-1/3)),N];default:return null}}return null}}catch(v){}});class Ht{constructor(e,s,l,u=1){this.r=e,this.g=s,this.b=l,this.a=u}static parse(e){if(!e)return;if(e instanceof Ht)return e;if("string"!=typeof e)return;const s=Vs.parseCSSColor(e);return s?new Ht(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[e,s,l,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(s)},${Math.round(l)},${u})`}toArray(){const{r:e,g:s,b:l,a:u}=this;return 0===u?[0,0,0,0]:[255*e/u,255*s/u,255*l/u,u]}}Ht.black=new Ht(0,0,0,1),Ht.white=new Ht(1,1,1,1),Ht.transparent=new Ht(0,0,0,0),Ht.red=new Ht(1,0,0,1),Ht.blue=new Ht(0,0,1,1);class wt{constructor(e,s,l){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Tl{constructor(e,s,l,u,p){this.text=e.normalize?e.normalize():e,this.image=s,this.scale=l,this.fontStack=u,this.textColor=p}}class Et{constructor(e){this.sections=e}static fromString(e){return new Et([new Tl(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Et?e:Et.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const s of this.sections){if(s.image){e.push(["image",s.image.name]);continue}e.push(s.text);const l={};s.fontStack&&(l["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(l["font-scale"]=s.scale),s.textColor&&(l["text-color"]=["rgba"].concat(s.textColor.toArray())),e.push(l)}return e}}class lr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new lr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function cu(i,e,s,l){return"number"==typeof i&&i>=0&&i<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===l||"number"==typeof l&&l>=0&&l<=1?null:`Invalid rgba value [${[i,e,s,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof l?[i,e,s,l]:[i,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function uu(i){if(null===i||"string"==typeof i||"boolean"==typeof i||"number"==typeof i||i instanceof Ht||i instanceof wt||i instanceof Et||i instanceof lr)return!0;if(Array.isArray(i)){for(const e of i)if(!uu(e))return!1;return!0}if("object"==typeof i){for(const e in i)if(!uu(i[e]))return!1;return!0}return!1}function vn(i){if(null===i)return ps;if("string"==typeof i)return gt;if("boolean"==typeof i)return it;if("number"==typeof i)return Je;if(i instanceof Ht)return Bo;if(i instanceof wt)return en;if(i instanceof Et)return Ns;if(i instanceof lr)return ki;if(Array.isArray(i)){const e=i.length;let s;for(const l of i){const u=vn(l);if(s){if(s===u)continue;s=St;break}s=u}return ni(s||St,e)}return El}function jr(i){const e=typeof i;return null===i?"":"string"===e||"number"===e||"boolean"===e?String(i):i instanceof Ht||i instanceof Et||i instanceof lr?i.toString():JSON.stringify(i)}class js{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(2!==e.length)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!uu(e[1]))return s.error("invalid value");const l=e[1];let u=vn(l);const p=s.expectedType;return"array"!==u.kind||0!==u.N||!p||"array"!==p.kind||"number"==typeof p.N&&0!==p.N||(u=p),new js(u,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Ht?["rgba"].concat(this.value.toArray()):this.value instanceof Et?this.value.serialize():this.value}}class Dr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const xi={string:gt,number:Je,boolean:it,object:El};class Fi{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let l,u=1;const p=e[0];if("array"===p){let v,w;if(e.length>2){const D=e[1];if("string"!=typeof D||!(D in xi)||"object"===D)return s.error('The item type argument of "array" must be one of string, number, boolean',1);v=xi[D],u++}else v=St;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);w=e[2],u++}l=ni(v,w)}else l=xi[p];const _=[];for(;u<e.length;u++){const v=s.parse(e[u],u,St);if(!v)return null;_.push(v)}return new Fi(l,_)}evaluate(e){for(let s=0;s<this.args.length;s++){const l=this.args[s].evaluate(e);if(!ri(this.type,vn(l)))return l;if(s===this.args.length-1)throw new Dr(`Expected value to be of type ${In(this.type)}, but found ${In(vn(l))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,s=[e.kind];if("array"===e.kind){const l=e.itemType;if("string"===l.kind||"number"===l.kind||"boolean"===l.kind){s.push(l.kind);const u=e.N;("number"==typeof u||this.args.length>1)&&s.push(u)}}return s.concat(this.args.map(l=>l.serialize()))}}class fo{constructor(e){this.type=Ns,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&"object"==typeof l)return s.error("First argument must be an image or text section.");const u=[];let p=!1;for(let _=1;_<=e.length-1;++_){const v=e[_];if(p&&"object"==typeof v&&!Array.isArray(v)){p=!1;let w=null;if(v["font-scale"]&&(w=s.parse(v["font-scale"],1,Je),!w))return null;let D=null;if(v["text-font"]&&(D=s.parse(v["text-font"],1,ni(gt)),!D))return null;let M=null;if(v["text-color"]&&(M=s.parse(v["text-color"],1,Bo),!M))return null;const S=u[u.length-1];S.scale=w,S.font=D,S.textColor=M}else{const w=s.parse(e[_],1,St);if(!w)return null;const D=w.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:w,scale:null,font:null,textColor:null})}}return new fo(u)}evaluate(e){return new Et(this.sections.map(s=>{const l=s.content.evaluate(e);return vn(l)===ki?new Tl("",l,null,null,null):new Tl(jr(l),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null)}))}eachChild(e){for(const s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const s of this.sections){e.push(s.content.serialize());const l={};s.scale&&(l["font-scale"]=s.scale.serialize()),s.font&&(l["text-font"]=s.font.serialize()),s.textColor&&(l["text-color"]=s.textColor.serialize()),e.push(l)}return e}}class Us{constructor(e){this.type=ki,this.input=e}static parse(e,s){if(2!==e.length)return s.error("Expected two arguments.");const l=s.parse(e[1],1,gt);return l?new Us(l):s.error("No image name provided.")}evaluate(e){const s=this.input.evaluate(e),l=lr.fromString(s);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(s)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const kf={"to-boolean":it,"to-color":Bo,"to-number":Je,"to-string":gt};class $t{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const l=e[0];if(("to-boolean"===l||"to-string"===l)&&2!==e.length)return s.error("Expected one argument.");const u=kf[l],p=[];for(let _=1;_<e.length;_++){const v=s.parse(e[_],_,St);if(!v)return null;p.push(v)}return new $t(u,p)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let s,l;for(const u of this.args){if(s=u.evaluate(e),l=null,s instanceof Ht)return s;if("string"==typeof s){const p=e.parseColor(s);if(p)return p}else if(Array.isArray(s)&&(l=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:cu(s[0],s[1],s[2],s[3]),!l))return new Ht(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Dr(l||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const l of this.args){if(s=l.evaluate(e),null===s)return 0;const u=Number(s);if(!isNaN(u))return u}throw new Dr(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?Et.fromString(jr(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?lr.fromString(jr(this.args[0].evaluate(e))):jr(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new fo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Us(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(s=>{e.push(s.serialize())}),e}}const Wd=["Unknown","Point","LineString","Polygon"];class Xd{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Wd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:l,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*s-e[0])+this.featureDistanceData.bearing[1]*(u*s-e[1])}return 0}parseColor(e){let s=this._parseColorCache[e];return s||(s=this._parseColorCache[e]=Ht.parse(e)),s}}class mr{constructor(e,s,l,u){this.name=e,this.type=s,this._evaluate=l,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,s){const l=e[0],u=mr.definitions[l];if(!u)return s.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,_=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,v=_.filter(([D])=>!Array.isArray(D)||D.length===e.length-1);let w=null;for(const[D,M]of v){w=new Hs(s.registry,s.path,null,s.scope);const S=[];let A=!1;for(let z=1;z<e.length;z++){const N=e[z],U=Array.isArray(D)?D[z-1]:D.type,q=w.parse(N,1+S.length,U);if(!q){A=!0;break}S.push(q)}if(!A)if(Array.isArray(D)&&D.length!==S.length)w.error(`Expected ${D.length} arguments, but found ${S.length} instead.`);else{for(let z=0;z<S.length;z++){const N=Array.isArray(D)?D[z]:D.type,U=S[z];w.concat(z+1).checkSubtype(N,U.type)}if(0===w.errors.length)return new mr(l,p,M,S)}}if(1===v.length)s.errors.push(...w.errors);else{const D=(v.length?v:_).map(([S])=>{return A=S,Array.isArray(A)?`(${A.map(In).join(", ")})`:`(${In(A.type)}...)`;var A}).join(" | "),M=[];for(let S=1;S<e.length;S++){const A=s.parse(e[S],1+M.length);if(!A)return null;M.push(In(A.type))}s.error(`Expected arguments of type ${D}, but found (${M.join(", ")}) instead.`)}return null}static register(e,s){mr.definitions=s;for(const l in s)e[l]=mr}}class ln{constructor(e,s,l){this.type=en,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(2!==e.length)return s.error("Expected one argument.");const l=e[1];if("object"!=typeof l||Array.isArray(l))return s.error("Collator options argument must be an object.");const u=s.parse(void 0!==l["case-sensitive"]&&l["case-sensitive"],1,it);if(!u)return null;const p=s.parse(void 0!==l["diacritic-sensitive"]&&l["diacritic-sensitive"],1,it);if(!p)return null;let _=null;return l.locale&&(_=s.parse(l.locale,1,gt),!_)?null:new ln(u,p,_)}evaluate(e){return new wt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Ji=8192;function Pa(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function $s(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function hu(i,e){const s=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(s*u*Ji),Math.round(l*u*Ji)]}function mo(i,e,s){const l=i[0]-e[0],u=i[1]-e[1],p=i[0]-s[0],_=i[1]-s[1];return l*_-p*u==0&&l*p<=0&&u*_<=0}function Gs(i,e){let s=!1;for(let _=0,v=e.length;_<v;_++){const w=e[_];for(let D=0,M=w.length;D<M-1;D++){if(mo(i,w[D],w[D+1]))return!1;(u=w[D])[1]>(l=i)[1]!=(p=w[D+1])[1]>l[1]&&l[0]<(p[0]-u[0])*(l[1]-u[1])/(p[1]-u[1])+u[0]&&(s=!s)}}var l,u,p;return s}function xh(i,e){for(let s=0;s<e.length;s++)if(Gs(i,e[s]))return!0;return!1}function ka(i,e,s,l){const u=l[0]-s[0],p=l[1]-s[1],_=(i[0]-s[0])*p-u*(i[1]-s[1]),v=(e[0]-s[0])*p-u*(e[1]-s[1]);return _>0&&v<0||_<0&&v>0}function Kd(i,e,s){for(const D of s)for(let M=0;M<D.length-1;++M)if((v=[(_=D[M+1])[0]-(p=D[M])[0],_[1]-p[1]])[0]*(w=[(u=e)[0]-(l=i)[0],u[1]-l[1]])[1]-v[1]*w[0]!=0&&ka(l,u,p,_)&&ka(p,_,l,u))return!0;var l,u,p,_,v,w;return!1}function du(i,e){for(let s=0;s<i.length;++s)if(!Gs(i[s],e))return!1;for(let s=0;s<i.length-1;++s)if(Kd(i[s],i[s+1],e))return!1;return!0}function bh(i,e){for(let s=0;s<e.length;s++)if(du(i,e[s]))return!0;return!1}function _c(i,e,s){const l=[];for(let u=0;u<i.length;u++){const p=[];for(let _=0;_<i[u].length;_++){const v=hu(i[u][_],s);Pa(e,v),p.push(v)}l.push(p)}return l}function ms(i,e,s){const l=[];for(let u=0;u<i.length;u++){const p=_c(i[u],e,s);l.push(p)}return l}function pu(i,e,s,l){if(i[0]<s[0]||i[0]>s[2]){const u=.5*l;let p=i[0]-s[0]>u?-l:s[0]-i[0]>u?l:0;0===p&&(p=i[0]-s[2]>u?-l:s[2]-i[0]>u?l:0),i[0]+=p}Pa(e,i)}function fu(i,e,s,l){const u=Math.pow(2,l.z)*Ji,p=[l.x*Ji,l.y*Ji],_=[];for(const v of i)for(const w of v){const D=[w.x+p[0],w.y+p[1]];pu(D,e,s,u),_.push(D)}return _}function bi(i,e,s,l){const u=Math.pow(2,l.z)*Ji,p=[l.x*Ji,l.y*Ji],_=[];for(const w of i){const D=[];for(const M of w){const S=[M.x+p[0],M.y+p[1]];Pa(e,S),D.push(S)}_.push(D)}if(e[2]-e[0]<=u/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of _)for(const D of w)pu(D,e,s,u)}var v;return _}class er{constructor(e,s){this.type=it,this.geojson=e,this.geometries=s}static parse(e,s){if(2!==e.length)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(uu(e[1])){const l=e[1];if("FeatureCollection"===l.type)for(let u=0;u<l.features.length;++u){const p=l.features[u].geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new er(l,l.features[u].geometry)}else if("Feature"===l.type){const u=l.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new er(l,l.geometry)}else if("Polygon"===l.type||"MultiPolygon"===l.type)return new er(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(s,l){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if("Polygon"===l.type){const v=_c(l.coordinates,p,_),w=fu(s.geometry(),u,p,_);if(!$s(u,p))return!1;for(const D of w)if(!Gs(D,v))return!1}if("MultiPolygon"===l.type){const v=ms(l.coordinates,p,_),w=fu(s.geometry(),u,p,_);if(!$s(u,p))return!1;for(const D of w)if(!xh(D,v))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(s,l){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if("Polygon"===l.type){const v=_c(l.coordinates,p,_),w=bi(s.geometry(),u,p,_);if(!$s(u,p))return!1;for(const D of w)if(!du(D,v))return!1}if("MultiPolygon"===l.type){const v=ms(l.coordinates,p,_),w=bi(s.geometry(),u,p,_);if(!$s(u,p))return!1;for(const D of w)if(!bh(D,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Hn(i){if(i instanceof mr&&("get"===i.name&&1===i.args.length||"feature-state"===i.name||"has"===i.name&&1===i.args.length||"properties"===i.name||"geometry-type"===i.name||"id"===i.name||/^filter-/.test(i.name))||i instanceof er)return!1;let e=!0;return i.eachChild(s=>{e&&!Hn(s)&&(e=!1)}),e}function Ri(i){if(i instanceof mr&&"feature-state"===i.name)return!1;let e=!0;return i.eachChild(s=>{e&&!Ri(s)&&(e=!1)}),e}function Yi(i,e){if(i instanceof mr&&e.indexOf(i.name)>=0)return!1;let s=!0;return i.eachChild(l=>{s&&!Yi(l,e)&&(s=!1)}),s}class Ur{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(2!==e.length||"string"!=typeof e[1])return s.error("'var' expression requires exactly one string literal argument.");const l=e[1];return s.scope.has(l)?new Ur(l,s.scope.get(l)):s.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Hs{constructor(e,s=[],l,u=new lu,p=[]){this.registry=e,this.path=s,this.key=s.map(_=>`[${_}]`).join(""),this.scope=u,this.errors=p,this.expectedType=l}parse(e,s,l,u,p={}){return s?this.concat(s,l,u)._parse(e,p):this._parse(e,p)}_parse(e,s){function l(u,p,_){return"assert"===_?new Fi(p,[u]):"coerce"===_?new $t(p,[u]):u}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if("string"!=typeof u)return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let _=p.parse(e,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,w=_.type;if("string"!==v.kind&&"number"!==v.kind&&"boolean"!==v.kind&&"object"!==v.kind&&"array"!==v.kind||"value"!==w.kind)if("color"!==v.kind&&"formatted"!==v.kind&&"resolvedImage"!==v.kind||"value"!==w.kind&&"string"!==w.kind){if(this.checkSubtype(v,w))return null}else _=l(_,v,s.typeAnnotation||"coerce");else _=l(_,v,s.typeAnnotation||"assert")}if(!(_ instanceof js)&&"resolvedImage"!==_.type.kind&&Fa(_)){const v=new Xd;try{_=new js(_.type,_.evaluate(v))}catch(w){return this.error(w.message),null}}return _}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,l){const u="number"==typeof e?this.path.concat(e):this.path,p=l?this.scope.concat(l):this.scope;return new Hs(this.registry,u,s||null,p,this.errors)}error(e,...s){const l=`${this.key}${s.map(u=>`[${u}]`).join("")}`;this.errors.push(new po(l,e))}checkSubtype(e,s){const l=ri(e,s);return l&&this.error(l),l}}function Fa(i){if(i instanceof Ur)return Fa(i.boundExpression);if(i instanceof mr&&"error"===i.name||i instanceof ln||i instanceof er)return!1;const e=i instanceof $t||i instanceof Fi;let s=!0;return i.eachChild(l=>{s=e?s&&Fa(l):s&&l instanceof js}),!!s&&Hn(i)&&Yi(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Vo(i,e){const s=i.length-1;let l,u,p=0,_=s,v=0;for(;p<=_;)if(v=Math.floor((p+_)/2),l=i[v],u=i[v+1],l<=e){if(v===s||e<u)return v;p=v+1}else{if(!(l>e))throw new Dr("Input is not a number.");_=v-1}return 0}class gs{constructor(e,s,l){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(const[u,p]of l)this.labels.push(u),this.outputs.push(p)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");const l=s.parse(e[1],1,Je);if(!l)return null;const u=[];let p=null;s.expectedType&&"value"!==s.expectedType.kind&&(p=s.expectedType);for(let _=1;_<e.length;_+=2){const v=1===_?-1/0:e[_],w=e[_+1],D=_,M=_+1;if("number"!=typeof v)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(u.length&&u[u.length-1][0]>=v)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const S=s.parse(w,M,p);if(!S)return null;p=p||S.type,u.push([v,S])}return new gs(p,l,u)}evaluate(e){const s=this.labels,l=this.outputs;if(1===s.length)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=s[0])return l[0].evaluate(e);const p=s.length;return u>=s[p-1]?l[p-1].evaluate(e):l[Vo(s,u)].evaluate(e)}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&e.push(this.labels[s]),e.push(this.outputs[s].serialize());return e}}function Rt(i,e,s){return i*(1-s)+e*s}var cr=Object.freeze({__proto__:null,number:Rt,color:function(i,e,s){return new Ht(Rt(i.r,e.r,s),Rt(i.g,e.g,s),Rt(i.b,e.b,s),Rt(i.a,e.a,s))},array:function(i,e,s){return i.map((l,u)=>Rt(l,e[u],s))}});const Qe=4/29,At=6/29,Sn=3*At*At,wi=Math.PI/180,qs=180/Math.PI;function qn(i){return i>.008856451679035631?Math.pow(i,1/3):i/Sn+Qe}function go(i){return i>At?i*i*i:Sn*(i-Qe)}function Fn(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function jo(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Zs(i){const e=jo(i.r),s=jo(i.g),l=jo(i.b),u=qn((.4124564*e+.3575761*s+.1804375*l)/.95047),p=qn((.2126729*e+.7151522*s+.072175*l)/1);return{l:116*p-16,a:500*(u-p),b:200*(p-qn((.0193339*e+.119192*s+.9503041*l)/1.08883)),alpha:i.a}}function Ct(i){let e=(i.l+16)/116,s=isNaN(i.a)?e:e+i.a/500,l=isNaN(i.b)?e:e-i.b/200;return e=1*go(e),s=.95047*go(s),l=1.08883*go(l),new Ht(Fn(3.2404542*s-1.5371385*e-.4985314*l),Fn(-.969266*s+1.8760108*e+.041556*l),Fn(.0556434*s-.2040259*e+1.0572252*l),i.alpha)}function yc(i,e,s){const l=e-i;return i+s*(l>180||l<-180?l-360*Math.round(l/360):l)}const _o={forward:Zs,reverse:Ct,interpolate:function(i,e,s){return{l:Rt(i.l,e.l,s),a:Rt(i.a,e.a,s),b:Rt(i.b,e.b,s),alpha:Rt(i.alpha,e.alpha,s)}}},Ws={forward:function(i){const{l:e,a:s,b:l}=Zs(i),u=Math.atan2(l,s)*qs;return{h:u<0?u+360:u,c:Math.sqrt(s*s+l*l),l:e,alpha:i.a}},reverse:function(i){const e=i.h*wi,s=i.c;return Ct({l:i.l,a:Math.cos(e)*s,b:Math.sin(e)*s,alpha:i.alpha})},interpolate:function(i,e,s){return{h:yc(i.h,e.h,s),c:Rt(i.c,e.c,s),l:Rt(i.l,e.l,s),alpha:Rt(i.alpha,e.alpha,s)}}};var Xs=Object.freeze({__proto__:null,lab:_o,hcl:Ws});class Dn{constructor(e,s,l,u,p){this.type=e,this.operator=s,this.interpolation=l,this.input=u,this.labels=[],this.outputs=[];for(const[_,v]of p)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(e,s,l,u){let p=0;if("exponential"===e.name)p=_s(s,e.base,l,u);else if("linear"===e.name)p=_s(s,1,l,u);else if("cubic-bezier"===e.name){const _=e.controlPoints;p=new Ao(_[0],_[1],_[2],_[3]).solve(_s(s,1,l,u))}return p}static parse(e,s){let[l,u,p,..._]=e;if(!Array.isArray(u)||0===u.length)return s.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const D=u[1];if("number"!=typeof D)return s.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:D}}else{if("cubic-bezier"!==u[0])return s.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const D=u.slice(1);if(4!==D.length||D.some(M=>"number"!=typeof M||M<0||M>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:D}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(p=s.parse(p,2,Je),!p)return null;const v=[];let w=null;"interpolate-hcl"===l||"interpolate-lab"===l?w=Bo:s.expectedType&&"value"!==s.expectedType.kind&&(w=s.expectedType);for(let D=0;D<_.length;D+=2){const M=_[D],S=_[D+1],A=D+3,z=D+4;if("number"!=typeof M)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(v.length&&v[v.length-1][0]>=M)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const N=s.parse(S,z,w);if(!N)return null;w=w||N.type,v.push([M,N])}return"number"===w.kind||"color"===w.kind||"array"===w.kind&&"number"===w.itemType.kind&&"number"==typeof w.N?new Dn(w,l,u,p,v):s.error(`Type ${In(w)} is not interpolatable.`)}evaluate(e){const s=this.labels,l=this.outputs;if(1===s.length)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=s[0])return l[0].evaluate(e);const p=s.length;if(u>=s[p-1])return l[p-1].evaluate(e);const _=Vo(s,u),v=Dn.interpolationFactor(this.interpolation,u,s[_],s[_+1]),w=l[_].evaluate(e),D=l[_+1].evaluate(e);return"interpolate"===this.operator?cr[this.type.kind.toLowerCase()](w,D,v):"interpolate-hcl"===this.operator?Ws.reverse(Ws.interpolate(Ws.forward(w),Ws.forward(D),v)):_o.reverse(_o.interpolate(_o.forward(w),_o.forward(D),v))}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)s.push(this.labels[l],this.outputs[l].serialize());return s}}function _s(i,e,s,l){const u=l-s,p=i-s;return 0===u?0:1===e?p/u:(Math.pow(e,p)-1)/(Math.pow(e,u)-1)}class Li{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expectected at least one argument.");let l=null;const u=s.expectedType;u&&"value"!==u.kind&&(l=u);const p=[];for(const v of e.slice(1)){const w=s.parse(v,1+p.length,l,void 0,{typeAnnotation:"omit"});if(!w)return null;l=l||w.type,p.push(w)}const _=u&&p.some(v=>ri(u,v.type));return new Li(_?St:l,p)}evaluate(e){let s,l=null,u=0;for(const p of this.args){if(u++,l=p.evaluate(e),l&&l instanceof lr&&!l.available&&(s||(s=l),l=null,u===this.args.length))return s;if(null!==l)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class ii{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let p=1;p<e.length-1;p+=2){const _=e[p];if("string"!=typeof _)return s.error(`Expected string, but found ${typeof _} instead.`,p);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=s.parse(e[p+1],p+1);if(!v)return null;l.push([_,v])}const u=s.parse(e[e.length-1],e.length-1,s.expectedType,l);return u?new ii(l,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[s,l]of this.bindings)e.push(s,l.serialize());return e.push(this.result.serialize()),e}}class xn{constructor(e,s,l){this.type=e,this.index=s,this.input=l}static parse(e,s){if(3!==e.length)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,Je),u=s.parse(e[2],2,ni(s.expectedType||St));return l&&u?new xn(u.type.itemType,l,u):null}evaluate(e){const s=this.index.evaluate(e),l=this.input.evaluate(e);if(s<0)throw new Dr(`Array index out of bounds: ${s} < 0.`);if(s>=l.length)throw new Dr(`Array index out of bounds: ${s} > ${l.length-1}.`);if(s!==Math.floor(s))throw new Dr(`Array index must be an integer, but found ${s} instead.`);return l[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class mu{constructor(e,s){this.type=it,this.needle=e,this.haystack=s}static parse(e,s){if(3!==e.length)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,St),u=s.parse(e[2],2,St);return l&&u?Dl(l.type,[it,gt,Je,ps,St])?new mu(l,u):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${In(l.type)} instead`):null}evaluate(e){const s=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!l)return!1;if(!No(s,["boolean","string","number","null"]))throw new Dr(`Expected first argument to be of type boolean, string, number or null, but found ${In(vn(s))} instead.`);if(!No(l,["string","array"]))throw new Dr(`Expected second argument to be of type array or string, but found ${In(vn(l))} instead.`);return l.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Qi{constructor(e,s,l){this.type=Je,this.needle=e,this.haystack=s,this.fromIndex=l}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,St),u=s.parse(e[2],2,St);if(!l||!u)return null;if(!Dl(l.type,[it,gt,Je,ps,St]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${In(l.type)} instead`);if(4===e.length){const p=s.parse(e[3],3,Je);return p?new Qi(l,u,p):null}return new Qi(l,u)}evaluate(e){const s=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!No(s,["boolean","string","number","null"]))throw new Dr(`Expected first argument to be of type boolean, string, number or null, but found ${In(vn(s))} instead.`);if(!No(l,["string","array"]))throw new Dr(`Expected second argument to be of type array or string, but found ${In(vn(l))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return l.indexOf(s,u)}return l.indexOf(s)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ei{constructor(e,s,l,u,p,_){this.inputType=e,this.type=s,this.input=l,this.cases=u,this.outputs=p,this.otherwise=_}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let l,u;s.expectedType&&"value"!==s.expectedType.kind&&(u=s.expectedType);const p={},_=[];for(let D=2;D<e.length-1;D+=2){let M=e[D];const S=e[D+1];Array.isArray(M)||(M=[M]);const A=s.concat(D);if(0===M.length)return A.error("Expected at least one branch label.");for(const N of M){if("number"!=typeof N&&"string"!=typeof N)return A.error("Branch labels must be numbers or strings.");if("number"==typeof N&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof N&&Math.floor(N)!==N)return A.error("Numeric branch labels must be integer values.");if(l){if(A.checkSubtype(l,vn(N)))return null}else l=vn(N);if(void 0!==p[String(N)])return A.error("Branch labels must be unique.");p[String(N)]=_.length}const z=s.parse(S,D,u);if(!z)return null;u=u||z.type,_.push(z)}const v=s.parse(e[1],1,St);if(!v)return null;const w=s.parse(e[e.length-1],e.length-1,u);return w?"value"!==v.type.kind&&s.concat(1).checkSubtype(l,v.type)?null:new Ei(l,u,v,p,_,w):null}evaluate(e){const s=this.input.evaluate(e);return(vn(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),l=[],u={};for(const _ of s){const v=u[this.cases[_]];void 0===v?(u[this.cases[_]]=l.length,l.push([this.cases[_],[_]])):l[v][1].push(_)}const p=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,v]of l)e.push(1===v.length?p(v[0]):v.map(p)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class gr{constructor(e,s,l){this.type=e,this.branches=s,this.otherwise=l}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let l;s.expectedType&&"value"!==s.expectedType.kind&&(l=s.expectedType);const u=[];for(let _=1;_<e.length-1;_+=2){const v=s.parse(e[_],_,it);if(!v)return null;const w=s.parse(e[_+1],_+1,l);if(!w)return null;u.push([v,w]),l=l||w.type}const p=s.parse(e[e.length-1],e.length-1,l);return p?new gr(l,u,p):null}evaluate(e){for(const[s,l]of this.branches)if(s.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[s,l]of this.branches)e(s),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class Ks{constructor(e,s,l,u){this.type=e,this.input=s,this.beginIndex=l,this.endIndex=u}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,St),u=s.parse(e[2],2,Je);if(!l||!u)return null;if(!Dl(l.type,[ni(St),gt,St]))return s.error(`Expected first argument to be of type array or string, but found ${In(l.type)} instead`);if(4===e.length){const p=s.parse(e[3],3,Je);return p?new Ks(l.type,l,u,p):null}return new Ks(l.type,l,u)}evaluate(e){const s=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!No(s,["string","array"]))throw new Dr(`Expected first argument to be of type array or string, but found ${In(vn(s))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return s.slice(l,u)}return s.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Cl(i,e){return"=="===i||"!="===i?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Js(i,e,s,l){return 0===l.compare(e,s)}function _r(i,e,s){const l="=="!==i&&"!="!==i;return class Ib{constructor(p,_,v){this.type=it,this.lhs=p,this.rhs=_,this.collator=v,this.hasUntypedArgument="value"===p.type.kind||"value"===_.type.kind}static parse(p,_){if(3!==p.length&&4!==p.length)return _.error("Expected two or three arguments.");const v=p[0];let w=_.parse(p[1],1,St);if(!w)return null;if(!Cl(v,w.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${In(w.type)}'.`);let D=_.parse(p[2],2,St);if(!D)return null;if(!Cl(v,D.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${In(D.type)}'.`);if(w.type.kind!==D.type.kind&&"value"!==w.type.kind&&"value"!==D.type.kind)return _.error(`Cannot compare types '${In(w.type)}' and '${In(D.type)}'.`);l&&("value"===w.type.kind&&"value"!==D.type.kind?w=new Fi(D.type,[w]):"value"!==w.type.kind&&"value"===D.type.kind&&(D=new Fi(w.type,[D])));let M=null;if(4===p.length){if("string"!==w.type.kind&&"string"!==D.type.kind&&"value"!==w.type.kind&&"value"!==D.type.kind)return _.error("Cannot use collator to compare non-string types.");if(M=_.parse(p[3],3,en),!M)return null}return new Ib(w,D,M)}evaluate(p){const _=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(l&&this.hasUntypedArgument){const w=vn(_),D=vn(v);if(w.kind!==D.kind||"string"!==w.kind&&"number"!==w.kind)throw new Dr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${w.kind}, ${D.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const w=vn(_),D=vn(v);if("string"!==w.kind||"string"!==D.kind)return e(p,_,v)}return this.collator?s(p,_,v,this.collator.evaluate(p)):e(p,_,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[i];return this.eachChild(_=>{p.push(_.serialize())}),p}}}const Eh=_r("==",function(i,e,s){return e===s},Js),Dh=_r("!=",function(i,e,s){return e!==s},function(i,e,s,l){return!Js(0,e,s,l)}),gu=_r("<",function(i,e,s){return e<s},function(i,e,s,l){return l.compare(e,s)<0}),Th=_r(">",function(i,e,s){return e>s},function(i,e,s,l){return l.compare(e,s)>0}),Ch=_r("<=",function(i,e,s){return e<=s},function(i,e,s,l){return l.compare(e,s)<=0}),Jd=_r(">=",function(i,e,s){return e>=s},function(i,e,s,l){return l.compare(e,s)>=0});class _u{constructor(e,s,l,u,p){this.type=gt,this.number=e,this.locale=s,this.currency=l,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(e,s){if(3!==e.length)return s.error("Expected two arguments.");const l=s.parse(e[1],1,Je);if(!l)return null;const u=e[2];if("object"!=typeof u||Array.isArray(u))return s.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=s.parse(u.locale,1,gt),!p))return null;let _=null;if(u.currency&&(_=s.parse(u.currency,1,gt),!_))return null;let v=null;if(u["min-fraction-digits"]&&(v=s.parse(u["min-fraction-digits"],1,Je),!v))return null;let w=null;return u["max-fraction-digits"]&&(w=s.parse(u["max-fraction-digits"],1,Je),!w)?null:new _u(l,p,_,v,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class yu{constructor(e){this.type=Je,this.input=e}static parse(e,s){if(2!==e.length)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=s.parse(e[1],1);return l?"array"!==l.type.kind&&"string"!==l.type.kind&&"value"!==l.type.kind?s.error(`Expected argument of type string or array, but found ${In(l.type)} instead.`):new yu(l):null}evaluate(e){const s=this.input.evaluate(e);if("string"==typeof s||Array.isArray(s))return s.length;throw new Dr(`Expected value to be of type string or array, but found ${In(vn(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(s=>{e.push(s.serialize())}),e}}const yo={"==":Eh,"!=":Dh,">":Th,"<":gu,">=":Jd,"<=":Ch,array:Fi,at:xn,boolean:Fi,case:gr,coalesce:Li,collator:ln,format:fo,image:Us,in:mu,"index-of":Qi,interpolate:Dn,"interpolate-hcl":Dn,"interpolate-lab":Dn,length:yu,let:ii,literal:js,match:Ei,number:Fi,"number-format":_u,object:Fi,slice:Ks,step:gs,string:Fi,"to-boolean":$t,"to-color":$t,"to-number":$t,"to-string":$t,var:Ur,within:er};function Mh(i,[e,s,l,u]){e=e.evaluate(i),s=s.evaluate(i),l=l.evaluate(i);const p=u?u.evaluate(i):1,_=cu(e,s,l,p);if(_)throw new Dr(_);return new Ht(e/255*p,s/255*p,l/255*p,p)}function Ih(i,e){return i in e}function vc(i,e){const s=e[i];return void 0===s?null:s}function Ys(i){return{type:i}}function Yd(i){return{result:"success",value:i}}function ys(i){return{result:"error",value:i}}function Ml(i){return"data-driven"===i["property-type"]||"cross-faded-data-driven"===i["property-type"]}function Qd(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Sh(i){return!!i.expression&&i.expression.interpolated}function Wt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":null===i?"null":typeof i}function Ra(i){return"object"==typeof i&&null!==i&&!Array.isArray(i)}function vu(i){return i}function xc(i,e){const s="color"===e.type,l=i.stops&&"object"==typeof i.stops[0][0],u=l||!(l||void 0!==i.property),p=i.type||(Sh(e)?"exponential":"interval");if(s&&((i=Bs({},i)).stops&&(i.stops=i.stops.map(D=>[D[0],Ht.parse(D[1])])),i.default=Ht.parse(i.default?i.default:e.default)),i.colorSpace&&"rgb"!==i.colorSpace&&!Xs[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let _,v,w;if("exponential"===p)_=Il;else if("interval"===p)_=ep;else if("categorical"===p){_=vo,v=Object.create(null);for(const D of i.stops)v[D[0]]=D[1];w=typeof i.stops[0][0]}else{if("identity"!==p)throw new Error(`Unknown function type "${p}"`);_=Ah}if(l){const D={},M=[];for(let z=0;z<i.stops.length;z++){const N=i.stops[z],U=N[0].zoom;void 0===D[U]&&(D[U]={zoom:U,type:i.type,property:i.property,default:i.default,stops:[]},M.push(U)),D[U].stops.push([N[0].value,N[1]])}const S=[];for(const z of M)S.push([D[z].zoom,xc(D[z],e)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:Dn.interpolationFactor.bind(void 0,A),zoomStops:S.map(z=>z[0]),evaluate:({zoom:z},N)=>Il({stops:S,base:i.base},e,z).evaluate(z,N)}}if(u){const D="exponential"===p?{name:"exponential",base:void 0!==i.base?i.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Dn.interpolationFactor.bind(void 0,D),zoomStops:i.stops.map(M=>M[0]),evaluate:({zoom:M})=>_(i,e,M,v,w)}}return{kind:"source",evaluate(D,M){const S=M&&M.properties?M.properties[i.property]:void 0;return void 0===S?Pr(i.default,e.default):_(i,e,S,v,w)}}}function Pr(i,e,s){return void 0!==i?i:void 0!==e?e:void 0!==s?s:void 0}function vo(i,e,s,l,u){return Pr(typeof s===u?l[s]:void 0,i.default,e.default)}function ep(i,e,s){if("number"!==Wt(s))return Pr(i.default,e.default);const l=i.stops.length;if(1===l||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[l-1][0])return i.stops[l-1][1];const u=Vo(i.stops.map(p=>p[0]),s);return i.stops[u][1]}function Il(i,e,s){const l=void 0!==i.base?i.base:1;if("number"!==Wt(s))return Pr(i.default,e.default);const u=i.stops.length;if(1===u||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[u-1][0])return i.stops[u-1][1];const p=Vo(i.stops.map(M=>M[0]),s),_=function(M,S,A,z){const N=z-A,U=M-A;return 0===N?0:1===S?U/N:(Math.pow(S,U)-1)/(Math.pow(S,N)-1)}(s,l,i.stops[p][0],i.stops[p+1][0]),v=i.stops[p][1],w=i.stops[p+1][1];let D=cr[e.type]||vu;if(i.colorSpace&&"rgb"!==i.colorSpace){const M=Xs[i.colorSpace];D=(S,A)=>M.reverse(M.interpolate(M.forward(S),M.forward(A),_))}return"function"==typeof v.evaluate?{evaluate(...M){const S=v.evaluate.apply(void 0,M),A=w.evaluate.apply(void 0,M);if(void 0!==S&&void 0!==A)return D(S,A,_)}}:D(v,w,_)}function Ah(i,e,s){return"color"===e.type?s=Ht.parse(s):"formatted"===e.type?s=Et.fromString(s.toString()):"resolvedImage"===e.type?s=lr.fromString(s.toString()):Wt(s)===e.type||"enum"===e.type&&e.values[s]||(s=void 0),Pr(s,i.default,e.default)}mr.register(yo,{error:[{kind:"error"},[gt],(i,[e])=>{throw new Dr(e.evaluate(i))}],typeof:[gt,[St],(i,[e])=>In(vn(e.evaluate(i)))],"to-rgba":[ni(Je,4),[Bo],(i,[e])=>e.evaluate(i).toArray()],rgb:[Bo,[Je,Je,Je],Mh],rgba:[Bo,[Je,Je,Je,Je],Mh],has:{type:it,overloads:[[[gt],(i,[e])=>Ih(e.evaluate(i),i.properties())],[[gt,El],(i,[e,s])=>Ih(e.evaluate(i),s.evaluate(i))]]},get:{type:St,overloads:[[[gt],(i,[e])=>vc(e.evaluate(i),i.properties())],[[gt,El],(i,[e,s])=>vc(e.evaluate(i),s.evaluate(i))]]},"feature-state":[St,[gt],(i,[e])=>vc(e.evaluate(i),i.featureState||{})],properties:[El,[],i=>i.properties()],"geometry-type":[gt,[],i=>i.geometryType()],id:[St,[],i=>i.id()],zoom:[Je,[],i=>i.globals.zoom],pitch:[Je,[],i=>i.globals.pitch||0],"distance-from-center":[Je,[],i=>i.distanceFromCenter()],"heatmap-density":[Je,[],i=>i.globals.heatmapDensity||0],"line-progress":[Je,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[Je,[],i=>i.globals.skyRadialProgress||0],accumulated:[St,[],i=>void 0===i.globals.accumulated?null:i.globals.accumulated],"+":[Je,Ys(Je),(i,e)=>{let s=0;for(const l of e)s+=l.evaluate(i);return s}],"*":[Je,Ys(Je),(i,e)=>{let s=1;for(const l of e)s*=l.evaluate(i);return s}],"-":{type:Je,overloads:[[[Je,Je],(i,[e,s])=>e.evaluate(i)-s.evaluate(i)],[[Je],(i,[e])=>-e.evaluate(i)]]},"/":[Je,[Je,Je],(i,[e,s])=>e.evaluate(i)/s.evaluate(i)],"%":[Je,[Je,Je],(i,[e,s])=>e.evaluate(i)%s.evaluate(i)],ln2:[Je,[],()=>Math.LN2],pi:[Je,[],()=>Math.PI],e:[Je,[],()=>Math.E],"^":[Je,[Je,Je],(i,[e,s])=>Math.pow(e.evaluate(i),s.evaluate(i))],sqrt:[Je,[Je],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Je,[Je],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Je,[Je],(i,[e])=>Math.log(e.evaluate(i))],log2:[Je,[Je],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Je,[Je],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Je,[Je],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Je,[Je],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Je,[Je],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Je,[Je],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Je,[Je],(i,[e])=>Math.atan(e.evaluate(i))],min:[Je,Ys(Je),(i,e)=>Math.min(...e.map(s=>s.evaluate(i)))],max:[Je,Ys(Je),(i,e)=>Math.max(...e.map(s=>s.evaluate(i)))],abs:[Je,[Je],(i,[e])=>Math.abs(e.evaluate(i))],round:[Je,[Je],(i,[e])=>{const s=e.evaluate(i);return s<0?-Math.round(-s):Math.round(s)}],floor:[Je,[Je],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Je,[Je],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[it,[gt,St],(i,[e,s])=>i.properties()[e.value]===s.value],"filter-id-==":[it,[St],(i,[e])=>i.id()===e.value],"filter-type-==":[it,[gt],(i,[e])=>i.geometryType()===e.value],"filter-<":[it,[gt,St],(i,[e,s])=>{const l=i.properties()[e.value],u=s.value;return typeof l==typeof u&&l<u}],"filter-id-<":[it,[St],(i,[e])=>{const s=i.id(),l=e.value;return typeof s==typeof l&&s<l}],"filter->":[it,[gt,St],(i,[e,s])=>{const l=i.properties()[e.value],u=s.value;return typeof l==typeof u&&l>u}],"filter-id->":[it,[St],(i,[e])=>{const s=i.id(),l=e.value;return typeof s==typeof l&&s>l}],"filter-<=":[it,[gt,St],(i,[e,s])=>{const l=i.properties()[e.value],u=s.value;return typeof l==typeof u&&l<=u}],"filter-id-<=":[it,[St],(i,[e])=>{const s=i.id(),l=e.value;return typeof s==typeof l&&s<=l}],"filter->=":[it,[gt,St],(i,[e,s])=>{const l=i.properties()[e.value],u=s.value;return typeof l==typeof u&&l>=u}],"filter-id->=":[it,[St],(i,[e])=>{const s=i.id(),l=e.value;return typeof s==typeof l&&s>=l}],"filter-has":[it,[St],(i,[e])=>e.value in i.properties()],"filter-has-id":[it,[],i=>null!==i.id()&&void 0!==i.id()],"filter-type-in":[it,[ni(gt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[it,[ni(St)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[it,[gt,ni(St)],(i,[e,s])=>s.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[it,[gt,ni(St)],(i,[e,s])=>function(l,u,p,_){for(;p<=_;){const v=p+_>>1;if(u[v]===l)return!0;u[v]>l?_=v-1:p=v+1}return!1}(i.properties()[e.value],s.value,0,s.value.length-1)],all:{type:it,overloads:[[[it,it],(i,[e,s])=>e.evaluate(i)&&s.evaluate(i)],[Ys(it),(i,e)=>{for(const s of e)if(!s.evaluate(i))return!1;return!0}]]},any:{type:it,overloads:[[[it,it],(i,[e,s])=>e.evaluate(i)||s.evaluate(i)],[Ys(it),(i,e)=>{for(const s of e)if(s.evaluate(i))return!0;return!1}]]},"!":[it,[it],(i,[e])=>!e.evaluate(i)],"is-supported-script":[it,[gt],(i,[e])=>{const s=i.globals&&i.globals.isSupportedScript;return!s||s(e.evaluate(i))}],upcase:[gt,[gt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[gt,[gt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[gt,Ys(St),(i,e)=>e.map(s=>jr(s.evaluate(i))).join("")],"resolved-locale":[gt,[en],(i,[e])=>e.evaluate(i).resolvedLocale()]});class xu{constructor(e,s){var l;this.expression=e,this._warningHistory={},this._evaluator=new Xd,this._defaultValue=s?"color"===(l=s).type&&Ra(l.default)?new Ht(0,0,0,0):"color"===l.type?Ht.parse(l.default)||null:void 0===l.default?null:l.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(e,s,l,u,p,_,v,w){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,s,l,u,p,_,v,w){this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Dr(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,"undefined"!=typeof console&&console.warn(D.message)),this._defaultValue}}}function La(i){return Array.isArray(i)&&i.length>0&&"string"==typeof i[0]&&i[0]in yo}function za(i,e){const s=new Hs(yo,[],e?function(u){const p={color:Bo,string:gt,number:Je,enum:gt,boolean:it,formatted:Ns,resolvedImage:ki};return"array"===u.type?ni(p[u.value]||St,u.length):p[u.type]}(e):void 0),l=s.parse(i,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return l?Yd(new xu(l,e)):ys(s.errors)}class Oa{constructor(e,s){this.kind=e,this._styleExpression=s,this.isStateDependent="constant"!==e&&!Ri(s.expression)}evaluateWithoutErrorHandling(e,s,l,u,p,_){return this._styleExpression.evaluateWithoutErrorHandling(e,s,l,u,p,_)}evaluate(e,s,l,u,p,_){return this._styleExpression.evaluate(e,s,l,u,p,_)}}class bu{constructor(e,s,l,u){this.kind=e,this.zoomStops=l,this._styleExpression=s,this.isStateDependent="camera"!==e&&!Ri(s.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,s,l,u,p,_){return this._styleExpression.evaluateWithoutErrorHandling(e,s,l,u,p,_)}evaluate(e,s,l,u,p,_){return this._styleExpression.evaluate(e,s,l,u,p,_)}interpolationFactor(e,s,l){return this.interpolationType?Dn.interpolationFactor(this.interpolationType,e,s,l):0}}function bc(i,e){if("error"===(i=za(i,e)).result)return i;const s=i.value.expression,l=Hn(s);if(!l&&!Ml(e))return ys([new po("","data expressions not supported")]);const u=Yi(s,["zoom","pitch","distance-from-center"]);if(!u&&!Qd(e))return ys([new po("","zoom expressions not supported")]);const p=$r(s);return p||u?p instanceof po?ys([p]):p instanceof Dn&&!Sh(e)?ys([new po("",'"interpolate" expressions cannot be used with this property')]):Yd(p?new bu(l?"camera":"composite",i.value,p.labels,p instanceof Dn?p.interpolation:void 0):new Oa(l?"constant":"source",i.value)):ys([new po("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ba{constructor(e,s){this._parameters=e,this._specification=s,Bs(this,xc(this._parameters,this._specification))}static deserialize(e){return new Ba(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function $r(i){let e=null;if(i instanceof ii)e=$r(i.result);else if(i instanceof Li){for(const s of i.args)if(e=$r(s),e)break}else(i instanceof gs||i instanceof Dn)&&i.input instanceof mr&&"zoom"===i.input.name&&(e=i);return e instanceof po||i.eachChild(s=>{const l=$r(s);l instanceof po?e=l:!e&&l?e=new po("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new po("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function oi(i){const e=i.key,s=i.value,l=i.valueSpec||{},u=i.objectElementValidators||{},p=i.style,_=i.styleSpec;let v=[];const w=Wt(s);if("object"!==w)return[new qe(e,s,`object expected, ${w} found`)];for(const D in s){const M=D.split(".")[0],S=l[M]||l["*"];let A;if(u[M])A=u[M];else if(l[M])A=yr;else if(u["*"])A=u["*"];else{if(!l["*"]){v.push(new qe(e,s[D],`unknown property "${D}"`));continue}A=yr}v=v.concat(A({key:(e&&`${e}.`)+D,value:s[D],valueSpec:S,style:p,styleSpec:_,object:s,objectKey:D},s))}for(const D in l)u[D]||l[D].required&&void 0===l[D].default&&void 0===s[D]&&v.push(new qe(e,s,`missing required property "${D}"`));return v}function wu(i){const e=i.value,s=i.valueSpec,l=i.style,u=i.styleSpec,p=i.key,_=i.arrayElementValidator||yr;if("array"!==Wt(e))return[new qe(p,e,`array expected, ${Wt(e)} found`)];if(s.length&&e.length!==s.length)return[new qe(p,e,`array length ${s.length} expected, length ${e.length} found`)];if(s["min-length"]&&e.length<s["min-length"])return[new qe(p,e,`array length at least ${s["min-length"]} expected, length ${e.length} found`)];let v={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum};u.$version<7&&(v.function=s.function),"object"===Wt(s.value)&&(v=s.value);let w=[];for(let D=0;D<e.length;D++)w=w.concat(_({array:e,arrayIndex:D,value:e[D],valueSpec:v,style:l,styleSpec:u,key:`${p}[${D}]`}));return w}function wc(i){const e=i.key,s=i.value,l=i.valueSpec;let u=Wt(s);if("number"===u&&s!=s&&(u="NaN"),"number"!==u)return[new qe(e,s,`number expected, ${u} found`)];if("minimum"in l){let p=l.minimum;if("array"===Wt(l.minimum)&&(p=l.minimum[i.arrayIndex]),s<p)return[new qe(e,s,`${s} is less than the minimum value ${p}`)]}if("maximum"in l){let p=l.maximum;if("array"===Wt(l.maximum)&&(p=l.maximum[i.arrayIndex]),s>p)return[new qe(e,s,`${s} is greater than the maximum value ${p}`)]}return[]}function Ec(i){const e=i.valueSpec,s=Gn(i.value.type);let l,u,p,_={};const v="categorical"!==s&&void 0===i.value.property,w=!v,D="array"===Wt(i.value.stops)&&"array"===Wt(i.value.stops[0])&&"object"===Wt(i.value.stops[0][0]),M=oi({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(z){if("identity"===s)return[new qe(z.key,z.value,'identity function may not have a "stops" property')];let N=[];const U=z.value;return N=N.concat(wu({key:z.key,value:U,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:S})),"array"===Wt(U)&&0===U.length&&N.push(new qe(z.key,U,"array must have at least one stop")),N},default:function(z){return yr({key:z.key,value:z.value,valueSpec:e,style:z.style,styleSpec:z.styleSpec})}}});return"identity"===s&&v&&M.push(new qe(i.key,i.value,'missing required property "property"')),"identity"===s||i.value.stops||M.push(new qe(i.key,i.value,'missing required property "stops"')),"exponential"===s&&i.valueSpec.expression&&!Sh(i.valueSpec)&&M.push(new qe(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(w&&!Ml(i.valueSpec)?M.push(new qe(i.key,i.value,"property functions not supported")):v&&!Qd(i.valueSpec)&&M.push(new qe(i.key,i.value,"zoom functions not supported"))),"categorical"!==s&&!D||void 0!==i.value.property||M.push(new qe(i.key,i.value,'"property" property is required')),M;function S(z){let N=[];const U=z.value,q=z.key;if("array"!==Wt(U))return[new qe(q,U,`array expected, ${Wt(U)} found`)];if(2!==U.length)return[new qe(q,U,`array length 2 expected, length ${U.length} found`)];if(D){if("object"!==Wt(U[0]))return[new qe(q,U,`object expected, ${Wt(U[0])} found`)];if(void 0===U[0].zoom)return[new qe(q,U,"object stop key must have zoom")];if(void 0===U[0].value)return[new qe(q,U,"object stop key must have value")];if(p&&p>Gn(U[0].zoom))return[new qe(q,U[0].zoom,"stop zoom values must appear in ascending order")];Gn(U[0].zoom)!==p&&(p=Gn(U[0].zoom),u=void 0,_={}),N=N.concat(oi({key:`${q}[0]`,value:U[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:wc,value:A}}))}else N=N.concat(A({key:`${q}[0]`,value:U[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},U));return La(ds(U[1]))?N.concat([new qe(`${q}[1]`,U[1],"expressions are not allowed in function stops.")]):N.concat(yr({key:`${q}[1]`,value:U[1],valueSpec:e,style:z.style,styleSpec:z.styleSpec}))}function A(z,N){const U=Wt(z.value),q=Gn(z.value),J=null!==z.value?z.value:N;if(l){if(U!==l)return[new qe(z.key,J,`${U} stop domain type must match previous stop domain type ${l}`)]}else l=U;if("number"!==U&&"string"!==U&&"boolean"!==U)return[new qe(z.key,J,"stop domain value must be a number, string, or boolean")];if("number"!==U&&"categorical"!==s){let ie=`number expected, ${U} found`;return Ml(e)&&void 0===s&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new qe(z.key,J,ie)]}return"categorical"!==s||"number"!==U||isFinite(q)&&Math.floor(q)===q?"categorical"!==s&&"number"===U&&void 0!==u&&q<u?[new qe(z.key,J,"stop domain values must appear in ascending order")]:(u=q,"categorical"===s&&q in _?[new qe(z.key,J,"stop domain values must be unique")]:(_[q]=!0,[])):[new qe(z.key,J,`integer expected, found ${q}`)]}}function Uo(i){const e=("property"===i.expressionContext?bc:za)(ds(i.value),i.valueSpec);if("error"===e.result)return e.value.map(l=>new qe(`${i.key}${l.key}`,i.value,l.message));const s=e.value.expression||e.value._styleExpression.expression;if("property"===i.expressionContext&&"text-font"===i.propertyKey&&!s.outputDefined())return[new qe(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===i.expressionContext&&"layout"===i.propertyType&&!Ri(s))return[new qe(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===i.expressionContext)return Sl(s,i);if(i.expressionContext&&0===i.expressionContext.indexOf("cluster")){if(!Yi(s,["zoom","feature-state"]))return[new qe(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===i.expressionContext&&!Hn(s))return[new qe(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Sl(i,e){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const u of e.valueSpec.expression.parameters)s.delete(u);if(0===s.size)return[];const l=[];return i instanceof mr&&s.has(i.name)?[new qe(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(u=>{l.push(...Sl(u,e))}),l)}function Dc(i){const e=i.key,s=i.value,l=i.valueSpec,u=[];return Array.isArray(l.values)?-1===l.values.indexOf(Gn(s))&&u.push(new qe(e,s,`expected one of [${l.values.join(", ")}], ${JSON.stringify(s)} found`)):-1===Object.keys(l.values).indexOf(Gn(s))&&u.push(new qe(e,s,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(s)} found`)),u}function Na(i){if(!0===i||!1===i)return!0;if(!Array.isArray(i)||0===i.length)return!1;switch(i[0]){case"has":return i.length>=2&&"$id"!==i[1]&&"$type"!==i[1];case"in":return i.length>=3&&("string"!=typeof i[1]||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==i.length||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Na(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Eu(i,e="fill"){if(null==i)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Na(i)||(i=Qs(i));const s=i;let l=!0;try{l=function(D){if(!Va(D))return D;let M=ds(D);return Du(M),M=An(M),M}(s)}catch(D){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(s,null,2)}\n        `)}const u=Ee[`filter_${e}`],p=za(l,u);let _=null;if("error"===p.result)throw new Error(p.value.map(D=>`${D.key}: ${D.message}`).join(", "));_=(D,M,S)=>p.value.evaluate(D,M,{},S);let v=null,w=null;if(l!==s){const D=za(s,u);if("error"===D.result)throw new Error(D.value.map(M=>`${M.key}: ${M.message}`).join(", "));v=(M,S,A,z,N)=>D.value.evaluate(M,S,{},A,void 0,void 0,z,N),w=!Hn(D.value.expression)}return _=_,{filter:_,dynamicFilter:v||void 0,needGeometry:Ph(l),needFeature:!!w}}function An(i){if(!Array.isArray(i))return i;const e=function(s){if(tr.has(s[0]))for(let l=1;l<s.length;l++)if(Va(s[l]))return!0;return s}(i);return!0===e?e:e.map(s=>An(s))}function Du(i){let e=!1;const s=[];if("case"===i[0]){for(let l=1;l<i.length-1;l+=2)e=e||Va(i[l]),s.push(i[l+1]);s.push(i[i.length-1])}else if("match"===i[0]){e=e||Va(i[1]);for(let l=2;l<i.length-1;l+=2)s.push(i[l+1]);s.push(i[i.length-1])}else if("step"===i[0]){e=e||Va(i[1]);for(let l=1;l<i.length-1;l+=2)s.push(i[l+1])}e&&(i.length=0,i.push("any",...s));for(let l=1;l<i.length;l++)Du(i[l])}function Va(i){if(!Array.isArray(i))return!1;if("pitch"===(e=i[0])||"distance-from-center"===e)return!0;var e;for(let s=1;s<i.length;s++)if(Va(i[s]))return!0;return!1}const tr=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function tp(i,e){return i<e?-1:i>e?1:0}function Ph(i){if(!Array.isArray(i))return!1;if("within"===i[0])return!0;for(let e=1;e<i.length;e++)if(Ph(i[e]))return!0;return!1}function Qs(i){if(!i)return!0;const e=i[0];return i.length<=1?"any"!==e:"=="===e?si(i[1],i[2],"=="):"!="===e?$o(si(i[1],i[2],"==")):"<"===e||">"===e||"<="===e||">="===e?si(i[1],i[2],e):"any"===e?(s=i.slice(1),["any"].concat(s.map(Qs))):"all"===e?["all"].concat(i.slice(1).map(Qs)):"none"===e?["all"].concat(i.slice(1).map(Qs).map($o)):"in"===e?kh(i[1],i.slice(2)):"!in"===e?$o(kh(i[1],i.slice(2))):"has"===e?Tc(i[1]):"!has"===e?$o(Tc(i[1])):"within"!==e||i;var s}function si(i,e,s){switch(i){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,i,e]}}function kh(i,e){if(0===e.length)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",i,["literal",e.sort(tp)]]:["filter-in-small",i,["literal",e]]}}function Tc(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function $o(i){return["!",i]}function Gr(i){if(Na(ds(i.value))){const e=ds(i.layerType);return Uo(Bs({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${e||"fill"}`]}))}return Tu(i)}function Tu(i){const e=i.value,s=i.key;if("array"!==Wt(e))return[new qe(s,e,`array expected, ${Wt(e)} found`)];const l=i.styleSpec;let u,p=[];if(e.length<1)return[new qe(s,e,"filter array must have at least 1 element")];switch(p=p.concat(Dc({key:`${s}[0]`,value:e[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),Gn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Gn(e[1])&&p.push(new qe(s,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&p.push(new qe(s,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Wt(e[1]),"string"!==u&&p.push(new qe(`${s}[1]`,e[1],`string expected, ${u} found`)));for(let _=2;_<e.length;_++)u=Wt(e[_]),"$type"===Gn(e[1])?p=p.concat(Dc({key:`${s}[${_}]`,value:e[_],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):"string"!==u&&"number"!==u&&"boolean"!==u&&p.push(new qe(`${s}[${_}]`,e[_],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)p=p.concat(Tu({key:`${s}[${_}]`,value:e[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=Wt(e[1]),2!==e.length?p.push(new qe(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==u&&p.push(new qe(`${s}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=Wt(e[1]),2!==e.length?p.push(new qe(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==u&&p.push(new qe(`${s}[1]`,e[1],`object expected, ${u} found`))}return p}function ea(i,e){const s=i.key,l=i.style,u=i.styleSpec,p=i.value,_=i.objectKey,v=u[`${e}_${i.layerType}`];if(!v)return[];const w=_.match(/^(.*)-transition$/);if("paint"===e&&w&&v[w[1]]&&v[w[1]].transition)return yr({key:s,value:p,valueSpec:u.transition,style:l,styleSpec:u});const D=i.valueSpec||v[_];if(!D)return[new qe(s,p,`unknown property "${_}"`)];let M;if("string"===Wt(p)&&Ml(D)&&!D.tokens&&(M=/^{([^}]+)}$/.exec(p)))return[new qe(s,p,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const S=[];return"symbol"===i.layerType&&("text-field"===_&&l&&!l.glyphs&&S.push(new qe(s,p,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&Ra(ds(p))&&"identity"===Gn(p.type)&&S.push(new qe(s,p,'"text-font" does not support identity functions'))),S.concat(yr({key:i.key,value:p,valueSpec:D,style:l,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:_}))}function Fh(i){return ea(i,"paint")}function Go(i){return ea(i,"layout")}function ja(i){let e=[];const s=i.value,l=i.key,u=i.style,p=i.styleSpec;s.type||s.ref||e.push(new qe(l,s,'either "type" or "ref" is required'));let _=Gn(s.type);const v=Gn(s.ref);if(s.id){const w=Gn(s.id);for(let D=0;D<i.arrayIndex;D++){const M=u.layers[D];Gn(M.id)===w&&e.push(new qe(l,s.id,`duplicate layer id "${s.id}", previously used at line ${M.id.__line__}`))}}if("ref"in s){let w;["type","source","source-layer","filter","layout"].forEach(D=>{D in s&&e.push(new qe(l,s[D],`"${D}" is prohibited for ref layers`))}),u.layers.forEach(D=>{Gn(D.id)===v&&(w=D)}),w?w.ref?e.push(new qe(l,s.ref,"ref cannot reference another ref layer")):_=Gn(w.type):e.push(new qe(l,s.ref,`ref layer "${v}" not found`))}else if("background"!==_&&"sky"!==_)if(s.source){const w=u.sources&&u.sources[s.source],D=w&&Gn(w.type);w?"vector"===D&&"raster"===_?e.push(new qe(l,s.source,`layer "${s.id}" requires a raster source`)):"raster"===D&&"raster"!==_?e.push(new qe(l,s.source,`layer "${s.id}" requires a vector source`)):"vector"!==D||s["source-layer"]?"raster-dem"===D&&"hillshade"!==_?e.push(new qe(l,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!s.paint||!s.paint["line-gradient"]||"geojson"===D&&w.lineMetrics||e.push(new qe(l,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new qe(l,s,`layer "${s.id}" must specify a "source-layer"`)):e.push(new qe(l,s.source,`source "${s.source}" not found`))}else e.push(new qe(l,s,'missing required property "source"'));return e=e.concat(oi({key:l,value:s,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>yr({key:`${l}.type`,value:s.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,object:s,objectKey:"type"}),filter:w=>Gr(Bs({layerType:_},w)),layout:w=>oi({layer:s,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":D=>Go(Bs({layerType:_},D))}}),paint:w=>oi({layer:s,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":D=>Fh(Bs({layerType:_},D))}})}})),e}function vs(i){const e=i.value,s=i.key,l=Wt(e);return"string"!==l?[new qe(s,e,`string expected, ${l} found`)]:[]}const xt={promoteId:function({key:i,value:e}){if("string"===Wt(e))return vs({key:i,value:e});{const s=[];for(const l in e)s.push(...vs({key:`${i}.${l}`,value:e[l]}));return s}}};function np(i){const e=i.value,s=i.key,l=i.styleSpec,u=i.style;if(!e.type)return[new qe(s,e,'"type" is required')];const p=Gn(e.type);let _;switch(p){case"vector":case"raster":case"raster-dem":return _=oi({key:s,value:e,valueSpec:l[`source_${p.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:xt}),_;case"geojson":if(_=oi({key:s,value:e,valueSpec:l.source_geojson,style:u,styleSpec:l,objectElementValidators:xt}),e.cluster)for(const v in e.clusterProperties){const[w,D]=e.clusterProperties[v],M="string"==typeof w?[w,["accumulated"],["get",v]]:w;_.push(...Uo({key:`${s}.${v}.map`,value:D,expressionContext:"cluster-map"})),_.push(...Uo({key:`${s}.${v}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return _;case"video":return oi({key:s,value:e,valueSpec:l.source_video,style:u,styleSpec:l});case"image":return oi({key:s,value:e,valueSpec:l.source_image,style:u,styleSpec:l});case"canvas":return[new qe(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Dc({key:`${s}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:l})}}function Cu(i){const e=i.value,s=i.styleSpec,l=s.light,u=i.style;let p=[];const _=Wt(e);if(void 0===e)return p;if("object"!==_)return p=p.concat([new qe("light",e,`object expected, ${_} found`)]),p;for(const v in e){const w=v.match(/^(.*)-transition$/);p=p.concat(w&&l[w[1]]&&l[w[1]].transition?yr({key:v,value:e[v],valueSpec:s.transition,style:u,styleSpec:s}):l[v]?yr({key:v,value:e[v],valueSpec:l[v],style:u,styleSpec:s}):[new qe(v,e[v],`unknown property "${v}"`)])}return p}function Mu(i){const e=i.value,s=i.key,l=i.style,u=i.styleSpec,p=u.terrain;let _=[];const v=Wt(e);if(void 0===e)return _;if("object"!==v)return _=_.concat([new qe("terrain",e,`object expected, ${v} found`)]),_;for(const w in e){const D=w.match(/^(.*)-transition$/);_=_.concat(D&&p[D[1]]&&p[D[1]].transition?yr({key:w,value:e[w],valueSpec:u.transition,style:l,styleSpec:u}):p[w]?yr({key:w,value:e[w],valueSpec:p[w],style:l,styleSpec:u}):[new qe(w,e[w],`unknown property "${w}"`)])}if(e.source){const w=l.sources&&l.sources[e.source],D=w&&Gn(w.type);w?"raster-dem"!==D&&_.push(new qe(s,e.source,`terrain cannot be used with a source of type ${D}, it only be used with a "raster-dem" source type`)):_.push(new qe(s,e.source,`source "${e.source}" not found`))}else _.push(new qe(s,e,'terrain is missing required property "source"'));return _}function Iu(i){const e=i.value,s=i.style,l=i.styleSpec,u=l.fog;let p=[];const _=Wt(e);if(void 0===e)return p;if("object"!==_)return p=p.concat([new qe("fog",e,`object expected, ${_} found`)]),p;for(const v in e){const w=v.match(/^(.*)-transition$/);p=p.concat(w&&u[w[1]]&&u[w[1]].transition?yr({key:v,value:e[v],valueSpec:l.transition,style:s,styleSpec:l}):u[v]?yr({key:v,value:e[v],valueSpec:u[v],style:s,styleSpec:l}):[new qe(v,e[v],`unknown property "${v}"`)])}return p}const Cc={"*":()=>[],array:wu,boolean:function(i){const e=i.value,s=i.key,l=Wt(e);return"boolean"!==l?[new qe(s,e,`boolean expected, ${l} found`)]:[]},number:wc,color:function(i){const e=i.key,s=i.value,l=Wt(s);return"string"!==l?[new qe(e,s,`color expected, ${l} found`)]:null===Vs.parseCSSColor(s)?[new qe(e,s,`color expected, "${s}" found`)]:[]},constants:qd,enum:Dc,filter:Gr,function:Ec,layer:ja,object:oi,source:np,light:Cu,terrain:Mu,fog:Iu,string:vs,formatted:function(i){return 0===vs(i).length?[]:Uo(i)},resolvedImage:function(i){return 0===vs(i).length?[]:Uo(i)},projection:function(i){const e=i.value,s=i.styleSpec,l=s.projection,u=i.style;let p=[];const _=Wt(e);if("object"===_)for(const v in e)p=p.concat(yr({key:v,value:e[v],valueSpec:l[v],style:u,styleSpec:s}));else"string"!==_&&(p=p.concat([new qe("projection",e,`object or string expected, ${_} found`)]));return p}};function yr(i){const e=i.value,s=i.valueSpec,l=i.styleSpec;return s.expression&&Ra(Gn(e))?Ec(i):s.expression&&La(ds(e))?Uo(i):s.type&&Cc[s.type]?Cc[s.type](i):oi(Bs({},i,{valueSpec:s.type?l[s.type]:s}))}function Su(i){const e=i.value,s=i.key,l=vs(i);return l.length||(-1===e.indexOf("{fontstack}")&&l.push(new qe(s,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&l.push(new qe(s,e,'"glyphs" url must include a "{range}" token'))),l}function Oe(i,e=Ee){let s=[];return s=s.concat(yr({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:Su,"*":()=>[]}})),i.constants&&(s=s.concat(qd({key:"constants",value:i.constants,style:i,styleSpec:e}))),Xt(s)}function Xt(i){return[].concat(i).sort((e,s)=>e.line-s.line)}function zi(i){return function(...e){return Xt(i.apply(this,e))}}Oe.source=zi(np),Oe.light=zi(Cu),Oe.terrain=zi(Mu),Oe.fog=zi(Iu),Oe.layer=zi(ja),Oe.filter=zi(Gr),Oe.paintProperty=zi(Fh),Oe.layoutProperty=zi(Go);const Rn=Oe,ta=Rn.light,Al=Rn.fog,Oi=Rn.paintProperty,Au=Rn.layoutProperty;function Mc(i,e){let s=!1;if(e&&e.length)for(const l of e)i.fire(new au(new Error(l.message))),s=!0;return s}var Ic=Hr;function Hr(i,e,s){var l=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var u=new Int32Array(this.arrayBuffer);i=u[0],this.d=(e=u[1])+2*(s=u[2]);for(var p=0;p<this.d*this.d;p++){var _=u[3+p],v=u[3+p+1];l.push(_===v?null:u.subarray(_,v))}var w=u[3+l.length+1];this.keys=u.subarray(u[3+l.length],w),this.bboxes=u.subarray(w),this.insert=this._insertReadonly}else{this.d=e+2*s;for(var D=0;D<this.d*this.d;D++)l.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=s,this.scale=e/i,this.uid=0;var M=s/e*i;this.min=-M,this.max=i+M}Hr.prototype.insert=function(i,e,s,l,u){this._forEachCell(e,s,l,u,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(u)},Hr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Hr.prototype._insertCell=function(i,e,s,l,u,p){this.cells[u].push(p)},Hr.prototype.query=function(i,e,s,l,u){var p=this.min,_=this.max;if(i<=p&&e<=p&&_<=s&&_<=l&&!u)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(i,e,s,l,this._queryCell,v,{},u),v},Hr.prototype._queryCell=function(i,e,s,l,u,p,_,v){var w=this.cells[u];if(null!==w)for(var D=this.keys,M=this.bboxes,S=0;S<w.length;S++){var A=w[S];if(void 0===_[A]){var z=4*A;(v?v(M[z+0],M[z+1],M[z+2],M[z+3]):i<=M[z+2]&&e<=M[z+3]&&s>=M[z+0]&&l>=M[z+1])?(_[A]=!0,p.push(D[A])):_[A]=!1}}},Hr.prototype._forEachCell=function(i,e,s,l,u,p,_,v){for(var w=this._convertToCellCoord(i),D=this._convertToCellCoord(e),M=this._convertToCellCoord(s),S=this._convertToCellCoord(l),A=w;A<=M;A++)for(var z=D;z<=S;z++){var N=this.d*z+A;if((!v||v(this._convertFromCellCoord(A),this._convertFromCellCoord(z),this._convertFromCellCoord(A+1),this._convertFromCellCoord(z+1)))&&u.call(this,i,e,s,l,N,p,_,v))return}},Hr.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Hr.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Hr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,s=0,l=0;l<this.cells.length;l++)s+=this.cells[l].length;var u=new Int32Array(e+s+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var p=e,_=0;_<i.length;_++){var v=i[_];u[3+_]=p,u.set(v,p),p+=v.length}return u[3+i.length]=p,u.set(this.keys,p),u[3+i.length+1]=p+=this.keys.length,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer};const{ImageData:xs,ImageBitmap:Ho}=Ae,ur={};function Xe(i,e,s={}){Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),ur[i]={klass:e,omit:s.omit||[],shallow:s.shallow||[]}}Xe("Object",Object),Ic.serialize=function(i,e){const s=i.toArrayBuffer();return e&&e.push(s),{buffer:s}},Ic.deserialize=function(i){return new Ic(i.buffer)},Xe("Grid",Ic),Xe("Color",Ht),Xe("Error",Error),Xe("ResolvedImage",lr),Xe("StylePropertyFunction",Ba),Xe("StyleExpression",xu,{omit:["_evaluator"]}),Xe("ZoomDependentExpression",bu),Xe("ZoomConstantExpression",Oa),Xe("CompoundExpression",mr,{omit:["_evaluate"]});for(const i in yo)yo[i]._classRegistryKey||Xe(`Expression_${i}`,yo[i]);function na(i){return i&&"undefined"!=typeof ArrayBuffer&&(i instanceof ArrayBuffer||i.constructor&&"ArrayBuffer"===i.constructor.name)}function ra(i){return Ho&&i instanceof Ho}function Di(i,e){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(na(i)||ra(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const s=i;return e&&e.push(s.buffer),s}if(i instanceof xs)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const s=[];for(const l of i)s.push(Di(l,e));return s}if("object"==typeof i){const s=i.constructor,l=s._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class");const u=s.serialize?s.serialize(i,e):{};if(!s.serialize){for(const p in i){if(!i.hasOwnProperty(p)||ur[l].omit.indexOf(p)>=0)continue;const _=i[p];u[p]=ur[l].shallow.indexOf(p)>=0?_:Di(_,e)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==l&&(u.$name=l),u}throw new Error("can't serialize object of type "+typeof i)}function bs(i){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||na(i)||ra(i)||ArrayBuffer.isView(i)||i instanceof xs)return i;if(Array.isArray(i))return i.map(bs);if("object"==typeof i){const e=i.$name||"Object",{klass:s}=ur[e];if(!s)throw new Error(`can't deserialize unregistered class ${e}`);if(s.deserialize)return s.deserialize(i);const l=Object.create(s.prototype);for(const u of Object.keys(i)){if("$name"===u)continue;const p=i[u];l[u]=ur[e].shallow.indexOf(u)>=0?p:bs(p)}return l}throw new Error("can't deserialize object of type "+typeof i)}class f{constructor(){this.first=!0}update(e,s){const l=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=l,!0))}}const o=i=>i>=1536&&i<=1791,c=i=>i>=1872&&i<=1919,m=i=>i>=2208&&i<=2303,y=i=>i>=11904&&i<=12031,x=i=>i>=12032&&i<=12255,E=i=>i>=12272&&i<=12287,C=i=>i>=12288&&i<=12351,P=i=>i>=12352&&i<=12447,F=i=>i>=12448&&i<=12543,R=i=>i>=12544&&i<=12591,O=i=>i>=12704&&i<=12735,j=i=>i>=12736&&i<=12783,Z=i=>i>=12784&&i<=12799,H=i=>i>=12800&&i<=13055,W=i=>i>=13056&&i<=13311,se=i=>i>=13312&&i<=19903,G=i=>i>=19968&&i<=40959,ne=i=>i>=40960&&i<=42127,Q=i=>i>=42128&&i<=42191,te=i=>i>=44032&&i<=55215,re=i=>i>=63744&&i<=64255,ae=i=>i>=64336&&i<=65023,_e=i=>i>=65040&&i<=65055,xe=i=>i>=65072&&i<=65103,Ue=i=>i>=65104&&i<=65135,Le=i=>i>=65136&&i<=65279,ke=i=>i>=65280&&i<=65519;function be(i){for(const e of i)if(Ie(e.charCodeAt(0)))return!0;return!1}function ve(i){for(const e of i)if(!Fe(e.charCodeAt(0)))return!1;return!0}function Fe(i){return!(o(i)||c(i)||m(i)||ae(i)||Le(i))}function Ie(i){return!(746!==i&&747!==i&&(i<4352||!(O(i)||R(i)||xe(i)&&!(i>=65097&&i<=65103)||re(i)||W(i)||y(i)||j(i)||!(!C(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||12336===i)||se(i)||G(i)||H(i)||(e=i,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||te(i)||P(i)||E(i)||(e=>e>=12688&&e<=12703)(i)||x(i)||Z(i)||F(i)&&12540!==i||!(!ke(i)||65288===i||65289===i||65293===i||i>=65306&&i<=65310||65339===i||65341===i||65343===i||i>=65371&&i<=65503||65507===i||i>=65512&&i<=65519)||!(!Ue(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||_e(i)||(e=>e>=19904&&e<=19967)(i)||ne(i)||Q(i))));var e}function et(i){return!(Ie(i)||(e=i,(s=e)>=128&&s<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(s=>s>=8192&&s<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(s=>s>=8448&&s<=8527)(e)||(s=>s>=8528&&s<=8591)(e)||(s=>s>=8960&&s<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(s=>s>=9216&&s<=9279)(e)&&9251!==e||(s=>s>=9280&&s<=9311)(e)||(s=>s>=9312&&s<=9471)(e)||(s=>s>=9632&&s<=9727)(e)||(s=>s>=9728&&s<=9983)(e)&&!(e>=9754&&e<=9759)||(s=>s>=11008&&s<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||C(e)||F(e)||(s=>s>=57344&&s<=63743)(e)||xe(e)||Ue(e)||ke(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,s}function at(i){return i>=1424&&i<=2303||ae(i)||Le(i)}function Tt(i,e){return!(!e&&at(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(s=i,s>=6016&&s<=6143));var s}function je(i){for(const e of i)if(at(e.charCodeAt(0)))return!0;return!1}const ot="deferred",ft="loading",rn="loaded";let mn=null,_t="unavailable",kt=null;const gn=function(i){i&&"string"==typeof i&&i.indexOf("NetworkError")>-1&&(_t="error"),mn&&mn(i)};function Zn(){kr.fire(new Qn("pluginStateChange",{pluginStatus:_t,pluginURL:kt}))}const kr=new hs,qr=function(){return _t},Bi=function(){if(_t!==ot||!kt)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_t=ft,Zn(),kt&&Aa({url:kt},i=>{i?gn(i):(_t=rn,Zn())})},Nt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>_t===rn||null!=Nt.applyArabicShaping,isLoading:()=>_t===ft,setState(i){_t=i.pluginStatus,kt=i.pluginURL},isParsed:()=>null!=Nt.applyArabicShaping&&null!=Nt.processBidirectionalText&&null!=Nt.processStyledBidirectionalText,getPluginURL:()=>kt};class pt{constructor(e,s){this.zoom=e,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new f,this.transition={},this.pitch=0)}isSupportedScript(e){return function(s,l){for(const u of s)if(!Tt(u.charCodeAt(0),l))return!1;return!0}(e,Nt.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,s=e-Math.floor(e),l=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}}}class Lt{constructor(e,s){this.property=e,this.value=s,this.expression=function(l,u){if(Ra(l))return new Ba(l,u);if(La(l)){const p=bc(l,u);if("error"===p.result)throw new Error(p.value.map(_=>`${_.key}: ${_.message}`).join(", "));return p.value}{let p=l;return"string"==typeof l&&"color"===u.type&&(p=Ht.parse(l)),{kind:"constant",evaluate:()=>p}}}(void 0===s?e.specification.default:s,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,s,l){return this.property.possiblyEvaluate(this,e,s,l)}}class bn{constructor(e){this.property=e,this.value=new Lt(e,void 0)}transitioned(e,s){return new hn(this.property,this.value,s,Nn({},e.transition,this.transition),e.now)}untransitioned(){return new hn(this.property,this.value,null,{},0)}}class Zr{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return _i(this._values[e].value.value)}setValue(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new bn(this._values[e].property)),this._values[e].value=new Lt(this._values[e].property,null===s?void 0:_i(s))}getTransition(e){return _i(this._values[e].transition)}setTransition(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new bn(this._values[e].property)),this._values[e].transition=_i(s)||void 0}serialize(){const e={};for(const s of Object.keys(this._values)){const l=this.getValue(s);void 0!==l&&(e[s]=l);const u=this.getTransition(s);void 0!==u&&(e[`${s}-transition`]=u)}return e}transitioned(e,s){const l=new Ni(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].transitioned(e,s._values[u]);return l}untransitioned(){const e=new Ni(this._properties);for(const s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}}class hn{constructor(e,s,l,u,p){const _=u.delay||0,v=u.duration||0;p=p||0,this.property=e,this.value=s,this.begin=p+_,this.end=this.begin+v,e.specification.transition&&(u.delay||u.duration)&&(this.prior=l)}possiblyEvaluate(e,s,l){const u=e.now||0,p=this.value.possiblyEvaluate(e,s,l),_=this.prior;if(_){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return _.possiblyEvaluate(e,s,l);{const v=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,s,l),p,Da(v))}}return p}}class Ni{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,l){const u=new ia(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,s,l);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ua{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return _i(this._values[e].value)}setValue(e,s){this._values[e]=new Lt(this._values[e].property,null===s?void 0:_i(s))}serialize(){const e={};for(const s of Object.keys(this._values)){const l=this.getValue(s);void 0!==l&&(e[s]=l)}return e}possiblyEvaluate(e,s,l){const u=new ia(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,s,l);return u}}class Wr{constructor(e,s,l){this.property=e,this.value=s,this.parameters=l}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,s,l,u){return this.property.evaluate(this.value,this.parameters,e,s,l,u)}}class ia{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class tt{constructor(e){this.specification=e}possiblyEvaluate(e,s){return e.expression.evaluate(s)}interpolate(e,s,l){const u=cr[this.specification.type];return u?u(e,s,l):e}}class st{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,l,u){return new Wr(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(s,null,{},l,u)}:e.expression,s)}interpolate(e,s,l){if("constant"!==e.value.kind||"constant"!==s.value.kind)return e;if(void 0===e.value.value||void 0===s.value.value)return new Wr(this,{kind:"constant",value:void 0},e.parameters);const u=cr[this.specification.type];return u?new Wr(this,{kind:"constant",value:u(e.value.value,s.value.value,l)},e.parameters):e}evaluate(e,s,l,u,p,_){return"constant"===e.kind?e.value:e.evaluate(s,l,u,p,_)}}class nr extends st{possiblyEvaluate(e,s,l,u){if(void 0===e.value)return new Wr(this,{kind:"constant",value:void 0},s);if("constant"===e.expression.kind){const p=e.expression.evaluate(s,null,{},l,u),_="resolvedImage"===e.property.specification.type&&"string"!=typeof p?p.name:p,v=this._calculate(_,_,_,s);return new Wr(this,{kind:"constant",value:v},s)}if("camera"===e.expression.kind){const p=this._calculate(e.expression.evaluate({zoom:s.zoom-1}),e.expression.evaluate({zoom:s.zoom}),e.expression.evaluate({zoom:s.zoom+1}),s);return new Wr(this,{kind:"constant",value:p},s)}return new Wr(this,e.expression,s)}evaluate(e,s,l,u,p,_){if("source"===e.kind){const v=e.evaluate(s,l,u,p,_);return this._calculate(v,v,v,s)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(s.zoom)-1},l,u),e.evaluate({zoom:Math.floor(s.zoom)},l,u),e.evaluate({zoom:Math.floor(s.zoom)+1},l,u),s):e.value}_calculate(e,s,l,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:s,other:l}:{from:l,to:s,other:e}}interpolate(e){return e}}class qo{constructor(e){this.specification=e}possiblyEvaluate(e,s,l,u){if(void 0!==e.value){if("constant"===e.expression.kind){const p=e.expression.evaluate(s,null,{},l,u);return this._calculate(p,p,p,s)}return this._calculate(e.expression.evaluate(new pt(Math.floor(s.zoom-1),s)),e.expression.evaluate(new pt(Math.floor(s.zoom),s)),e.expression.evaluate(new pt(Math.floor(s.zoom+1),s)),s)}}_calculate(e,s,l,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:l,to:s}}interpolate(e){return e}}class eo{constructor(e){this.specification=e}possiblyEvaluate(e,s,l,u){return!!e.expression.evaluate(s,null,{},l,u)}interpolate(){return!1}}class rr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in e){const l=e[s];l.specification.overridable&&this.overridableProperties.push(s);const u=this.defaultPropertyValues[s]=new Lt(l,void 0),p=this.defaultTransitionablePropertyValues[s]=new bn(l);this.defaultTransitioningPropertyValues[s]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=u.possiblyEvaluate({})}}}function Ff(i,e){return 256*(i=on(Math.floor(i),0,255))+on(Math.floor(e),0,255)}Xe("DataDrivenProperty",st),Xe("DataConstantProperty",tt),Xe("CrossFadedDataDrivenProperty",nr),Xe("CrossFadedProperty",qo),Xe("ColorRampProperty",eo);const Rf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Sc{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class jn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&(e.isTransferred=!0,s.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Pn(i,e=1){let s=0,l=0;return{members:i.map(u=>{const p=Rf[u.type].BYTES_PER_ELEMENT,_=s=Lf(s,Math.max(e,p)),v=u.components||1;return l=Math.max(l,p),s+=p*v,{name:u.name,type:u.type,components:v,offset:_}}),size:Lf(s,Math.max(l,e)),alignment:e}}function Lf(i,e){return Math.ceil(i/e)*e}class Ac extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,s)}emplace(e,s,l){const u=2*e;return this.int16[u+0]=s,this.int16[u+1]=l,e}}Ac.prototype.bytesPerElement=4,Xe("StructArrayLayout2i4",Ac);class oa extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,l,u)}emplace(e,s,l,u,p){const _=4*e;return this.int16[_+0]=s,this.int16[_+1]=l,this.int16[_+2]=u,this.int16[_+3]=p,e}}oa.prototype.bytesPerElement=8,Xe("StructArrayLayout4i8",oa);class Pl extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,l,u,p,_,v)}emplace(e,s,l,u,p,_,v,w){const D=6*e,M=12*e,S=3*e;return this.int16[D+0]=s,this.int16[D+1]=l,this.uint8[M+4]=u,this.uint8[M+5]=p,this.uint8[M+6]=_,this.uint8[M+7]=v,this.float32[S+2]=w,e}}Pl.prototype.bytesPerElement=12,Xe("StructArrayLayout2i4ub1f12",Pl);class Pc extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,s,l)}emplace(e,s,l,u){const p=3*e;return this.float32[p+0]=s,this.float32[p+1]=l,this.float32[p+2]=u,e}}Pc.prototype.bytesPerElement=12,Xe("StructArrayLayout3f12",Pc);class sa extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v,w,D,M){const S=this.length;return this.resize(S+1),this.emplace(S,e,s,l,u,p,_,v,w,D,M)}emplace(e,s,l,u,p,_,v,w,D,M,S){const A=10*e;return this.uint16[A+0]=s,this.uint16[A+1]=l,this.uint16[A+2]=u,this.uint16[A+3]=p,this.uint16[A+4]=_,this.uint16[A+5]=v,this.uint16[A+6]=w,this.uint16[A+7]=D,this.uint16[A+8]=M,this.uint16[A+9]=S,e}}sa.prototype.bytesPerElement=20,Xe("StructArrayLayout10ui20",sa);class Pu extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v,w){const D=this.length;return this.resize(D+1),this.emplace(D,e,s,l,u,p,_,v,w)}emplace(e,s,l,u,p,_,v,w,D){const M=8*e;return this.uint16[M+0]=s,this.uint16[M+1]=l,this.uint16[M+2]=u,this.uint16[M+3]=p,this.uint16[M+4]=_,this.uint16[M+5]=v,this.uint16[M+6]=w,this.uint16[M+7]=D,e}}Pu.prototype.bytesPerElement=16,Xe("StructArrayLayout8ui16",Pu);class $a extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v,w,D,M,S,A,z,N,U,q){const J=this.length;return this.resize(J+1),this.emplace(J,e,s,l,u,p,_,v,w,D,M,S,A,z,N,U,q)}emplace(e,s,l,u,p,_,v,w,D,M,S,A,z,N,U,q,J){const ie=16*e;return this.int16[ie+0]=s,this.int16[ie+1]=l,this.int16[ie+2]=u,this.int16[ie+3]=p,this.uint16[ie+4]=_,this.uint16[ie+5]=v,this.uint16[ie+6]=w,this.uint16[ie+7]=D,this.int16[ie+8]=M,this.int16[ie+9]=S,this.int16[ie+10]=A,this.int16[ie+11]=z,this.int16[ie+12]=N,this.int16[ie+13]=U,this.int16[ie+14]=q,this.int16[ie+15]=J,e}}$a.prototype.bytesPerElement=32,Xe("StructArrayLayout4i4ui4i4i32",$a);class rp extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}rp.prototype.bytesPerElement=4,Xe("StructArrayLayout1ul4",rp);class ku extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v,w,D,M,S,A,z){const N=this.length;return this.resize(N+1),this.emplace(N,e,s,l,u,p,_,v,w,D,M,S,A,z)}emplace(e,s,l,u,p,_,v,w,D,M,S,A,z,N){const U=20*e,q=10*e;return this.int16[U+0]=s,this.int16[U+1]=l,this.int16[U+2]=u,this.int16[U+3]=p,this.int16[U+4]=_,this.float32[q+3]=v,this.float32[q+4]=w,this.float32[q+5]=D,this.float32[q+6]=M,this.int16[U+14]=S,this.uint32[q+8]=A,this.uint16[U+18]=z,this.uint16[U+19]=N,e}}ku.prototype.bytesPerElement=40,Xe("StructArrayLayout5i4f1i1ul2ui40",ku);class kc extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,l,u,p,_,v)}emplace(e,s,l,u,p,_,v,w){const D=8*e;return this.int16[D+0]=s,this.int16[D+1]=l,this.int16[D+2]=u,this.int16[D+4]=p,this.int16[D+5]=_,this.int16[D+6]=v,this.int16[D+7]=w,e}}kc.prototype.bytesPerElement=16,Xe("StructArrayLayout3i2i2i16",kc);class Ga extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,s,l,u,p)}emplace(e,s,l,u,p,_){const v=4*e,w=8*e;return this.float32[v+0]=s,this.float32[v+1]=l,this.float32[v+2]=u,this.int16[w+6]=p,this.int16[w+7]=_,e}}Ga.prototype.bytesPerElement=16,Xe("StructArrayLayout2f1f2i16",Ga);class Ha extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,l,u)}emplace(e,s,l,u,p){const _=12*e,v=3*e;return this.uint8[_+0]=s,this.uint8[_+1]=l,this.float32[v+1]=u,this.float32[v+2]=p,e}}Ha.prototype.bytesPerElement=12,Xe("StructArrayLayout2ub2f12",Ha);class Fr extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,s,l)}emplace(e,s,l,u){const p=3*e;return this.uint16[p+0]=s,this.uint16[p+1]=l,this.uint16[p+2]=u,e}}Fr.prototype.bytesPerElement=6,Xe("StructArrayLayout3ui6",Fr);class Rh extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v,w,D,M,S,A,z,N,U,q,J,ie,ce,he,pe){const de=this.length;return this.resize(de+1),this.emplace(de,e,s,l,u,p,_,v,w,D,M,S,A,z,N,U,q,J,ie,ce,he,pe)}emplace(e,s,l,u,p,_,v,w,D,M,S,A,z,N,U,q,J,ie,ce,he,pe,de){const De=30*e,we=15*e,$e=60*e;return this.int16[De+0]=s,this.int16[De+1]=l,this.int16[De+2]=u,this.float32[we+2]=p,this.float32[we+3]=_,this.uint16[De+8]=v,this.uint16[De+9]=w,this.uint32[we+5]=D,this.uint32[we+6]=M,this.uint32[we+7]=S,this.uint16[De+16]=A,this.uint16[De+17]=z,this.uint16[De+18]=N,this.float32[we+10]=U,this.float32[we+11]=q,this.uint8[$e+48]=J,this.uint8[$e+49]=ie,this.uint8[$e+50]=ce,this.uint32[we+13]=he,this.int16[De+28]=pe,this.uint8[$e+58]=de,e}}Rh.prototype.bytesPerElement=60,Xe("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",Rh);class Fu extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v,w,D,M,S,A,z,N,U,q,J,ie,ce,he,pe,de,De,we,$e,Be,Te,Ve,Ze,Pe){const We=this.length;return this.resize(We+1),this.emplace(We,e,s,l,u,p,_,v,w,D,M,S,A,z,N,U,q,J,ie,ce,he,pe,de,De,we,$e,Be,Te,Ve,Ze,Pe)}emplace(e,s,l,u,p,_,v,w,D,M,S,A,z,N,U,q,J,ie,ce,he,pe,de,De,we,$e,Be,Te,Ve,Ze,Pe,We){const Ye=38*e,zt=19*e;return this.int16[Ye+0]=s,this.int16[Ye+1]=l,this.int16[Ye+2]=u,this.float32[zt+2]=p,this.float32[zt+3]=_,this.int16[Ye+8]=v,this.int16[Ye+9]=w,this.int16[Ye+10]=D,this.int16[Ye+11]=M,this.int16[Ye+12]=S,this.int16[Ye+13]=A,this.uint16[Ye+14]=z,this.uint16[Ye+15]=N,this.uint16[Ye+16]=U,this.uint16[Ye+17]=q,this.uint16[Ye+18]=J,this.uint16[Ye+19]=ie,this.uint16[Ye+20]=ce,this.uint16[Ye+21]=he,this.uint16[Ye+22]=pe,this.uint16[Ye+23]=de,this.uint16[Ye+24]=De,this.uint16[Ye+25]=we,this.uint16[Ye+26]=$e,this.uint16[Ye+27]=Be,this.uint16[Ye+28]=Te,this.uint32[zt+15]=Ve,this.float32[zt+16]=Ze,this.float32[zt+17]=Pe,this.float32[zt+18]=We,e}}Fu.prototype.bytesPerElement=76,Xe("StructArrayLayout3i2f6i15ui1ul3f76",Fu);class aa extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}aa.prototype.bytesPerElement=4,Xe("StructArrayLayout1f4",aa);class zf extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,s,l)}emplace(e,s,l,u){const p=3*e;return this.int16[p+0]=s,this.int16[p+1]=l,this.int16[p+2]=u,e}}zf.prototype.bytesPerElement=6,Xe("StructArrayLayout3i6",zf);class Ru extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,l,u,p,_,v)}emplace(e,s,l,u,p,_,v,w){const D=7*e;return this.float32[D+0]=s,this.float32[D+1]=l,this.float32[D+2]=u,this.float32[D+3]=p,this.float32[D+4]=_,this.float32[D+5]=v,this.float32[D+6]=w,e}}Ru.prototype.bytesPerElement=28,Xe("StructArrayLayout7f28",Ru);class cn extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,l,u)}emplace(e,s,l,u,p){const _=6*e;return this.uint32[3*e+0]=s,this.uint16[_+2]=l,this.uint16[_+3]=u,this.uint16[_+4]=p,e}}cn.prototype.bytesPerElement=12,Xe("StructArrayLayout1ul3ui12",cn);class kl extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,s)}emplace(e,s,l){const u=2*e;return this.uint16[u+0]=s,this.uint16[u+1]=l,e}}kl.prototype.bytesPerElement=4,Xe("StructArrayLayout2ui4",kl);class ip extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}ip.prototype.bytesPerElement=2,Xe("StructArrayLayout1ui2",ip);class op extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,s)}emplace(e,s,l){const u=2*e;return this.float32[u+0]=s,this.float32[u+1]=l,e}}op.prototype.bytesPerElement=8,Xe("StructArrayLayout2f8",op);class Of extends jn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,l,u)}emplace(e,s,l,u,p){const _=4*e;return this.float32[_+0]=s,this.float32[_+1]=l,this.float32[_+2]=u,this.float32[_+3]=p,e}}Of.prototype.bytesPerElement=16,Xe("StructArrayLayout4f16",Of);class Bg extends Sc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Bg.prototype.size=40;class Bf extends ku{get(e){return new Bg(this,e)}}Xe("CollisionBoxArray",Bf);class Ng extends Sc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Ng.prototype.size=60;class Fc extends Rh{get(e){return new Ng(this,e)}}Xe("PlacedSymbolArray",Fc);class Vg extends Sc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Vg.prototype.size=76;class vr extends Fu{get(e){return new Vg(this,e)}}Xe("SymbolInstanceArray",vr);class Lh extends aa{getoffsetX(e){return this.float32[1*e+0]}}Xe("GlyphOffsetArray",Lh);class Rc extends zf{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Xe("SymbolLineVertexArray",Rc);class jg extends Sc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}jg.prototype.size=12;class Nf extends cn{get(e){return new jg(this,e)}}Xe("FeatureIndexArray",Nf);class to extends Sc{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}to.prototype.size=4;class Zo extends kl{get(e){return new to(this,e)}}Xe("FillExtrusionCentroidArray",Zo);const Vf=Pn([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),zh=Pn([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Lc=fs(function(i){i.exports=function(e,s){var l,u,p,_,v,w,D,M;for(u=e.length-(l=3&e.length),p=s,v=3432918353,w=461845907,M=0;M<u;)D=255&e.charCodeAt(M)|(255&e.charCodeAt(++M))<<8|(255&e.charCodeAt(++M))<<16|(255&e.charCodeAt(++M))<<24,++M,p=27492+(65535&(_=5*(65535&(p=(p^=D=(65535&(D=(D=(65535&D)*v+(((D>>>16)*v&65535)<<16)&4294967295)<<15|D>>>17))*w+(((D>>>16)*w&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(D=0,l){case 3:D^=(255&e.charCodeAt(M+2))<<16;case 2:D^=(255&e.charCodeAt(M+1))<<8;case 1:p^=D=(65535&(D=(D=(65535&(D^=255&e.charCodeAt(M)))*v+(((D>>>16)*v&65535)<<16)&4294967295)<<15|D>>>17))*w+(((D>>>16)*w&65535)<<16)&4294967295}return p^=e.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}}),jf=fs(function(i){i.exports=function(e,s){for(var l,u=e.length,p=s^u,_=0;u>=4;)l=1540483477*(65535&(l=255&e.charCodeAt(_)|(255&e.charCodeAt(++_))<<8|(255&e.charCodeAt(++_))<<16|(255&e.charCodeAt(++_))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),u-=4,++_;switch(u){case 3:p^=(255&e.charCodeAt(_+2))<<16;case 2:p^=(255&e.charCodeAt(_+1))<<8;case 1:p=1540483477*(65535&(p^=255&e.charCodeAt(_)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}}),Lu=Lc,Ug=jf;Lu.murmur3=Lc,Lu.murmur2=Ug;class sp{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,s,l,u){this.ids.push($g(e)),this.positions.push(s,l,u)}getPositions(e){const s=$g(e);let l=0,u=this.ids.length-1;for(;l<u;){const _=l+u>>1;this.ids[_]>=s?u=_:l=_+1}const p=[];for(;this.ids[l]===s;)p.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return p}static serialize(e,s){const l=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Oh(l,u,0,l.length-1),s&&s.push(l.buffer,u.buffer),{ids:l,positions:u}}static deserialize(e){const s=new sp;return s.ids=e.ids,s.positions=e.positions,s.indexed=!0,s}}function $g(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Lu(String(i))}function Oh(i,e,s,l){for(;s<l;){const u=i[s+l>>1];let p=s-1,_=l+1;for(;;){do{p++}while(i[p]<u);do{_--}while(i[_]>u);if(p>=_)break;ai(i,p,_),ai(e,3*p,3*_),ai(e,3*p+1,3*_+1),ai(e,3*p+2,3*_+2)}_-s<l-_?(Oh(i,e,s,_),s=_+1):(Oh(i,e,_+1,l),l=_)}}function ai(i,e,s){const l=i[e];i[e]=i[s],i[s]=l}Xe("FeaturePositionMap",sp);class Wo{constructor(e,s){this.gl=e.gl,this.location=s}}class la extends Wo{constructor(e,s){super(e,s),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Gg extends Wo{constructor(e,s){super(e,s),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class ap extends Wo{constructor(e,s){super(e,s),this.current=Ht.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Hg=new Float32Array(16),qg=new Float32Array(9),Zg=new Float32Array(4);function lp(i){return[Ff(255*i.r,255*i.g),Ff(255*i.b,255*i.a)]}class zu{constructor(e,s,l){this.value=e,this.uniformNames=s.map(u=>`u_${u}`),this.type=l}setUniform(e,s,l){e.set(l.constantOr(this.value))}getBinding(e,s,l){return"color"===this.type?new ap(e,s):new la(e,s)}}class Fl{constructor(e,s){this.uniformNames=s.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=s.tl.concat(s.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,s,l,u){const p="u_pattern_to"===u||"u_dash_to"===u?this.patternTo:"u_pattern_from"===u||"u_dash_from"===u?this.patternFrom:"u_pixel_ratio_to"===u?this.pixelRatioTo:"u_pixel_ratio_from"===u?this.pixelRatioFrom:null;p&&e.set(p)}getBinding(e,s,l){return"u_pattern_from"===l||"u_pattern_to"===l||"u_dash_from"===l||"u_dash_to"===l?new Gg(e,s):new la(e,s)}}class Xo{constructor(e,s,l,u){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(p=>({name:`a_${p}`,type:"Float32",components:"color"===l?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,s,l,u,p,_){const v=this.paintVertexArray.length,w=this.expression.evaluate(new pt(0),s,{},p,u,_);this.paintVertexArray.resize(e),this._setPaintValue(v,e,w)}updatePaintArray(e,s,l,u,p){const _=this.expression.evaluate({zoom:0},l,u,void 0,p);this._setPaintValue(e,s,_)}_setPaintValue(e,s,l){if("color"===this.type){const u=lp(l);for(let p=e;p<s;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=e;u<s;u++)this.paintVertexArray.emplace(u,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vi{constructor(e,s,l,u,p,_){this.expression=e,this.uniformNames=s.map(v=>`u_${v}_t`),this.type=l,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:"color"===l?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,s,l,u,p,_){const v=this.expression.evaluate(new pt(this.zoom),s,{},p,u,_),w=this.expression.evaluate(new pt(this.zoom+1),s,{},p,u,_),D=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(D,e,v,w)}updatePaintArray(e,s,l,u,p){const _=this.expression.evaluate({zoom:this.zoom},l,u,void 0,p),v=this.expression.evaluate({zoom:this.zoom+1},l,u,void 0,p);this._setPaintValue(e,s,_,v)}_setPaintValue(e,s,l,u){if("color"===this.type){const p=lp(l),_=lp(u);for(let v=e;v<s;v++)this.paintVertexArray.emplace(v,p[0],p[1],_[0],_[1])}else{for(let p=e;p<s;p++)this.paintVertexArray.emplace(p,l,u);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s){const l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,u=on(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,s,l){return new la(e,s)}}class Rl{constructor(e,s,l,u,p,_,v){this.expression=e,this.type=l,this.useIntegerZoom=u,this.zoom=p,this.layerId=v,this.paintVertexAttributes=("array"===l?zh:Vf).members;for(let w=0;w<s.length;++w);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,s,l){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,s.patterns&&s.patterns[this.layerId],l)}updatePaintArray(e,s,l,u,p,_){this._setPaintValues(e,s,l.patterns&&l.patterns[this.layerId],_)}_setPaintValues(e,s,l,u){if(!u||!l)return;const{min:p,mid:_,max:v}=l,w=u[p],D=u[_],M=u[v];if(w&&D&&M)for(let S=e;S<s;S++)this._setPaintValue(this.zoomInPaintVertexArray,S,D,w),this._setPaintValue(this.zoomOutPaintVertexArray,S,D,M)}_setPaintValue(e,s,l,u){e.emplace(s,l.tl[0],l.tl[1],l.br[0],l.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],l.pixelRatio,u.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class no{constructor(e,s,l=(()=>!0)){this.binders={},this._buffers=[];const u=[];for(const p in e.paint._values){if(!l(p))continue;const _=e.paint.get(p);if(!(_ instanceof Wr&&Ml(_.property.specification)))continue;const v=Wg(p,e.type),w=_.value,D=_.property.specification.type,M=_.property.useIntegerZoom,S=_.property.specification["property-type"],A="cross-faded"===S||"cross-faded-data-driven"===S,z="line-dasharray"===String(p)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==w.kind||z)if("source"===w.kind||z||A){const N=cp(p,D,"source");this.binders[p]=A?new Rl(w,v,D,M,s,N,e.id):new Xo(w,v,D,N),u.push(`/a_${p}`)}else{const N=cp(p,D,"composite");this.binders[p]=new Vi(w,v,D,M,s,N),u.push(`/z_${p}`)}else this.binders[p]=A?new Fl(w.value,v):new zu(w.value,v,D),u.push(`/u_${p}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const s=this.binders[e];return s instanceof Xo||s instanceof Vi?s.maxValue:0}populatePaintArrays(e,s,l,u,p,_){for(const v in this.binders){const w=this.binders[v];(w instanceof Xo||w instanceof Vi||w instanceof Rl)&&w.populatePaintArray(e,s,l,u,p,_)}}setConstantPatternPositions(e,s){for(const l in this.binders){const u=this.binders[l];u instanceof Fl&&u.setConstantPatternPositions(e,s)}}updatePaintArrays(e,s,l,u,p,_){let v=!1;for(const w in e){const D=s.getPositions(w);for(const M of D){const S=l.feature(M.index);for(const A in this.binders){const z=this.binders[A];if((z instanceof Xo||z instanceof Vi||z instanceof Rl)&&!0===z.expression.isStateDependent){const N=u.paint.get(A);z.expression=N.value,z.updatePaintArray(M.start,M.end,S,e[w],p,_),v=!0}}}}return v}defines(){const e=[];for(const s in this.binders){const l=this.binders[s];(l instanceof zu||l instanceof Fl)&&e.push(...l.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof Xo||l instanceof Vi||l instanceof Rl)for(let u=0;u<l.paintVertexAttributes.length;u++)e.push(l.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof zu||l instanceof Fl||l instanceof Vi)for(const u of l.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,s){const l=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof zu||p instanceof Fl||p instanceof Vi)for(const _ of p.uniformNames)if(s[_]){const v=p.getBinding(e,s[_],_);l.push({name:_,property:u,binding:v})}}return l}setUniforms(e,s,l,u){for(const{name:p,property:_,binding:v}of s)this.binders[_].setUniform(v,u,l.get(_),p)}updatePaintBuffers(e){this._buffers=[];for(const s in this.binders){const l=this.binders[s];if(e&&l instanceof Rl){const u=2===e.fromScale?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(l instanceof Xo||l instanceof Vi)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(e){for(const s in this.binders){const l=this.binders[s];(l instanceof Xo||l instanceof Vi||l instanceof Rl)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const s=this.binders[e];(s instanceof Xo||s instanceof Vi||s instanceof Rl)&&s.destroy()}}}class ca{constructor(e,s,l=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new no(u,s,l);this.needsUpload=!1,this._featureMap=new sp,this._bufferOffset=0}populatePaintArrays(e,s,l,u,p,_,v){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,s,u,p,_,v);void 0!==s.id&&this._featureMap.add(s.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,l,u,p){for(const _ of l)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,s,_,u,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Bh={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Wg(i,e){return Bh[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const Xg={"line-pattern":{source:sa,composite:sa},"fill-pattern":{source:sa,composite:sa},"fill-extrusion-pattern":{source:sa,composite:sa},"line-dasharray":{source:Pu,composite:Pu}},Kg={color:{source:op,composite:Of},number:{source:aa,composite:op}};function cp(i,e,s){const l=Xg[i];return l&&l[s]||Kg[e][s]}Xe("ConstantBinder",zu),Xe("CrossFadedConstantBinder",Fl),Xe("SourceExpressionBinder",Xo),Xe("CrossFadedCompositeBinder",Rl),Xe("CompositeExpressionBinder",Vi),Xe("ProgramConfiguration",no,{omit:["_buffers"]}),Xe("ProgramConfigurationSet",ca);const Nh="-transition";class Ti extends hs{constructor(e,s){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),s.layout&&(this._unevaluatedLayout=new Ua(s.layout)),s.paint)){this._transitionablePaint=new Zr(s.paint);for(const l in e.paint)this.setPaintProperty(l,e.paint[l],{validate:!1});for(const l in e.layout)this.setLayoutProperty(l,e.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ia(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,s,l={}){null!=s&&this._validate(Au,`layers.${this.id}.layout.${e}`,e,s,l)||("visibility"!==e?this._unevaluatedLayout.setValue(e,s):this.visibility=s)}getPaintProperty(e){return gl(e,Nh)?this._transitionablePaint.getTransition(e.slice(0,-Nh.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,s,l={}){if(null!=s&&this._validate(Oi,`layers.${this.id}.paint.${e}`,e,s,l))return!1;if(gl(e,Nh))return this._transitionablePaint.setTransition(e.slice(0,-Nh.length),s||void 0),!1;{const u=this._transitionablePaint._values[e],p="cross-faded-data-driven"===u.property.specification["property-type"],_=u.value.isDataDriven(),v=u.value;this._transitionablePaint.setValue(e,s),this._handleSpecialPaintPropertyUpdate(e);const w=this._transitionablePaint._values[e].value;return w.isDataDriven()||_||p||this._handleOverridablePaintPropertyUpdate(e,v,w)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,s,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ls(e,(s,l)=>!(void 0===s||"layout"===l&&!Object.keys(s).length||"paint"===l&&!Object.keys(s).length))}_validate(e,s,l,u,p={}){return(!p||!1!==p.validate)&&Mc(this,e.call(Rn,{key:s,layerType:this.type,objectKey:l,value:u,styleSpec:Ee,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const s=this.paint.get(e);if(s instanceof Wr&&Ml(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Eu(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Uf=Pn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Jg}=Uf;class ht{constructor(e=[]){this.segments=e}prepareSegment(e,s,l,u){let p=this.segments[this.segments.length-1];return e>ht.MAX_VERTEX_ARRAY_LENGTH&&Mn(`Max vertices per segment is ${ht.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>ht.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u)&&(p={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},void 0!==u&&(p.sortKey=u),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const e of this.segments)for(const s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,l,u){return new ht([{vertexOffset:e,primitiveOffset:s,vertexLength:l,primitiveLength:u,vaos:{},sortKey:0}])}}ht.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xe("SegmentVector",ht);var Pt=8192;class Ll{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Kt?new Kt(e.lng,e.lat):Kt.convert(e),this}setSouthWest(e){return this._sw=e instanceof Kt?new Kt(e.lng,e.lat):Kt.convert(e),this}extend(e){const s=this._sw,l=this._ne;let u,p;if(e instanceof Kt)u=e,p=e;else{if(!(e instanceof Ll))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Ll.convert(e)):this.extend(Kt.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return s||l?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new Kt(u.lng,u.lat),this._ne=new Kt(p.lng,p.lat)),this}getCenter(){return new Kt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Kt(this.getWest(),this.getNorth())}getSouthEast(){return new Kt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:l}=Kt.convert(e);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return!e||e instanceof Ll?e:new Ll(e)}}const Vh=6371008.8;class Kt{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Kt(as(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const s=Math.PI/180,l=this.lat*s,u=e.lat*s,p=Math.sin(l)*Math.sin(u)+Math.cos(l)*Math.cos(u)*Math.cos((e.lng-this.lng)*s);return Vh*Math.acos(Math.min(p,1))}toBounds(e=0){const s=360*e/40075017,l=s/Math.cos(Math.PI/180*this.lat);return new Ll(new Kt(this.lng-l,this.lat-s),new Kt(this.lng+l,this.lat+s))}static convert(e){if(e instanceof Kt)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Kt(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Kt(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const $f=2*Math.PI*Vh;function Gf(i){return $f*Math.cos(i*Math.PI/180)}function zc(i){return(180+i)/360}function qa(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function ji(i,e){return i/Gf(e)}function ws(i){return 360*i-180}function Ci(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Hf(i,e){return i*Gf(Ci(e))}const Ko=85.051129;class Oc{constructor(e,s,l=0){this.x=+e,this.y=+s,this.z=+l}static fromLngLat(e,s=0){const l=Kt.convert(e);return new Oc(zc(l.lng),qa(l.lat),ji(s,l.lat))}toLngLat(){return new Kt(ws(this.x),Ci(this.y))}toAltitude(){return Hf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/$f*(e=Ci(this.y),1/Math.cos(e*Math.PI/180));var e}}function Bc(i,e,s,l,u,p,_,v,w){const D=(e+l)/2,M=(s+u)/2,S=new Ke(D,M);v(S),function(A,z,N,U,q,J){const ie=N-q,ce=U-J;return Math.abs((U-z)*ie-(N-A)*ce)/Math.hypot(ie,ce)}(S.x,S.y,p.x,p.y,_.x,_.y)>=w?(Bc(i,e,s,D,M,p,S,v,w),Bc(i,D,M,l,u,S,_,v,w)):i.push(_)}function qf(i,e,s){const l=[];let u,p,_;for(const v of i){const{x:w,y:D}=v;e(v),_?Bc(l,u,p,w,D,_,v,e,s):l.push(v),u=w,p=D,_=v}return l}const up=Math.pow(2,14)-1,Zf=-up-1;function Nc(i,e){const s=Math.round(i.x*e),l=Math.round(i.y*e);return i.x=on(s,Zf,up),i.y=on(l,Zf,up),(s<i.x||s>i.x+1||l<i.y||l>i.y+1)&&Mn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function ro(i,e,s){const l=i.loadGeometry(),u=i.extent,p=Pt/u;if(e&&s&&s.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:v,x:w,y:D,projection:M}=s,S=A=>{const z=ws((e.x+A.x/u)/_),N=Ci((e.y+A.y/u)/_),U=M.project(z,N);A.x=(U.x*v-w)*u,A.y=(U.y*v-D)*u};for(let A=0;A<l.length;A++)if(1!==i.type)l[A]=qf(l[A],S,1);else{const z=[];for(const N of l[A])N.x<0||N.x>=u||N.y<0||N.y>=u||(S(N),z.push(N));l[A]=z}}for(const _ of l)for(const v of _)Nc(v,p);return l}function zl(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?ro(i):[]}}function hp(i,e,s,l,u){i.emplaceBack(2*e+(l+1)/2,2*s+(u+1)/2)}class jh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ac,this.indexArray=new Fr,this.segments=new ht,this.programConfigurations=new ca(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,l,u){const p=this.layers[0],_=[];let v=null;"circle"===p.type&&(v=p.layout.get("circle-sort-key"));for(const{feature:w,id:D,index:M,sourceLayerIndex:S}of e){const A=this.layers[0]._featureFilter.needGeometry,z=zl(w,A);if(!this.layers[0]._featureFilter.filter(new pt(this.zoom),z,l))continue;const N=v?v.evaluate(z,{},l):void 0,U={id:D,properties:w.properties,type:w.type,sourceLayerIndex:S,index:M,geometry:A?z.geometry:ro(w,l,u),patterns:{},sortKey:N};_.push(U)}v&&_.sort((w,D)=>w.sortKey-D.sortKey);for(const w of _){const{geometry:D,index:M,sourceLayerIndex:S}=w,A=e[M].feature;this.addFeature(w,D,M,s.availableImages,l),s.featureIndex.insert(A,D,M,S,this.index)}}update(e,s,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,l,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jg),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,l,u,p){for(const _ of s)for(const v of _){const w=v.x,D=v.y;if(w<0||w>=Pt||D<0||D>=Pt)continue;const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),S=M.vertexLength;hp(this.layoutVertexArray,w,D,-1,-1),hp(this.layoutVertexArray,w,D,1,-1),hp(this.layoutVertexArray,w,D,1,1),hp(this.layoutVertexArray,w,D,-1,1),this.indexArray.emplaceBack(S,S+1,S+2),this.indexArray.emplaceBack(S,S+3,S+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},u,p)}}function Wf(i,e){for(let s=0;s<i.length;s++)if(Vc(e,i[s]))return!0;for(let s=0;s<e.length;s++)if(Vc(i,e[s]))return!0;return!!dp(i,e)}function Ev(i,e,s){return!!Vc(i,e)||!!Ou(e,i,s)}function Xf(i,e){if(1===i.length)return Kf(e,i[0]);for(let s=0;s<e.length;s++){const l=e[s];for(let u=0;u<l.length;u++)if(Vc(i,l[u]))return!0}for(let s=0;s<i.length;s++)if(Kf(e,i[s]))return!0;for(let s=0;s<e.length;s++)if(dp(i,e[s]))return!0;return!1}function Yg(i,e,s){if(i.length>1){if(dp(i,e))return!0;for(let l=0;l<e.length;l++)if(Ou(e[l],i,s))return!0}for(let l=0;l<i.length;l++)if(Ou(i[l],e,s))return!0;return!1}function dp(i,e){if(0===i.length||0===e.length)return!1;for(let s=0;s<i.length-1;s++){const l=i[s],u=i[s+1];for(let p=0;p<e.length-1;p++)if(Uh(l,u,e[p],e[p+1]))return!0}return!1}function Uh(i,e,s,l){return yi(i,s,l)!==yi(e,s,l)&&yi(i,e,s)!==yi(i,e,l)}function Ou(i,e,s){const l=s*s;if(1===e.length)return i.distSqr(e[0])<l;for(let u=1;u<e.length;u++)if(Ol(i,e[u-1],e[u])<l)return!0;return!1}function Ol(i,e,s){const l=e.distSqr(s);if(0===l)return i.distSqr(e);const u=((i.x-e.x)*(s.x-e.x)+(i.y-e.y)*(s.y-e.y))/l;return i.distSqr(u<0?e:u>1?s:s.sub(e)._mult(u)._add(e))}function Kf(i,e){let s,l,u,p=!1;for(let _=0;_<i.length;_++){s=i[_];for(let v=0,w=s.length-1;v<s.length;w=v++)l=s[v],u=s[w],l.y>e.y!=u.y>e.y&&e.x<(u.x-l.x)*(e.y-l.y)/(u.y-l.y)+l.x&&(p=!p)}return p}function Vc(i,e){let s=!1;for(let l=0,u=i.length-1;l<i.length;u=l++){const p=i[l],_=i[u];p.y>e.y!=_.y>e.y&&e.x<(_.x-p.x)*(e.y-p.y)/(_.y-p.y)+p.x&&(s=!s)}return s}function Qg(i,e,s,l,u){for(const _ of i)if(e<=_.x&&s<=_.y&&l>=_.x&&u>=_.y)return!0;const p=[new Ke(e,s),new Ke(e,u),new Ke(l,u),new Ke(l,s)];if(i.length>2)for(const _ of p)if(Vc(i,_))return!0;for(let _=0;_<i.length-1;_++)if($h(i[_],i[_+1],p))return!0;return!1}function $h(i,e,s){const l=s[0],u=s[2];if(i.x<l.x&&e.x<l.x||i.x>u.x&&e.x>u.x||i.y<l.y&&e.y<l.y||i.y>u.y&&e.y>u.y)return!1;const p=yi(i,e,s[0]);return p!==yi(i,e,s[1])||p!==yi(i,e,s[2])||p!==yi(i,e,s[3])}function Za(i,e,s){const l=e.paint.get(i).value;return"constant"===l.kind?l.value:s.programConfigurations.get(e.id).getMaxValue(i)}function Bu(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function pp(i,e,s,l,u){if(!e[0]&&!e[1])return i;const p=Ke.convert(e)._mult(u);"viewport"===s&&p._rotate(-l);const _=[];for(let v=0;v<i.length;v++)_.push(i[v].sub(p));return _}function fp(i,e,s,l){const u=Ke.convert(i)._mult(l);return"viewport"===e&&u._rotate(-s),u}Xe("CircleBucket",jh,{omit:["layers"]});const Jf=new rr({"circle-sort-key":new st(Ee.layout_circle["circle-sort-key"])});var e_={paint:new rr({"circle-radius":new st(Ee.paint_circle["circle-radius"]),"circle-color":new st(Ee.paint_circle["circle-color"]),"circle-blur":new st(Ee.paint_circle["circle-blur"]),"circle-opacity":new st(Ee.paint_circle["circle-opacity"]),"circle-translate":new tt(Ee.paint_circle["circle-translate"]),"circle-translate-anchor":new tt(Ee.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new tt(Ee.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new tt(Ee.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new st(Ee.paint_circle["circle-stroke-width"]),"circle-stroke-color":new st(Ee.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new st(Ee.paint_circle["circle-stroke-opacity"])}),layout:Jf};class mp{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,l,u){const p=Math.pow(2,l),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const D=Vr([],w,e),M=1/D[3]/s*p;return(S=D)[0]=(A=D)[0]*(z=[M,M,u?1/D[3]:M,M])[0],S[1]=A[1]*z[1],S[2]=A[2]*z[2],S[3]=A[3]*z[3],S;var S,A,z}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const D=As([],ba([],Ps([],_[w[0]],_[w[1]]),Ps([],_[w[2]],_[w[1]]))),M=-lo(D,_[w[1]]);return D.concat(M)});return new mp(_,v)}}class Jo{constructor(e,s){this.min=e,this.max=s,this.center=Xi([],hl([],this.min,this.max),.5)}quadrant(e){const s=[e%2==0,e<2],l=Fo(this.min),u=Fo(this.max);for(let p=0;p<s.length;p++)l[p]=s[p]?this.min[p]:this.center[p],u[p]=s[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new Jo(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,s=this.max;return[[e[0],e[1],e[2]],[s[0],e[1],e[2]],[s[0],s[1],e[2]],[e[0],s[1],e[2]],[e[0],e[1],s[2]],[s[0],e[1],s[2]],[s[0],s[1],s[2]],[e[0],s[1],s[2]]]}intersects(e){const s=this.getCorners();let l=!0;for(let u=0;u<e.planes.length;u++){const p=e.planes[u];let _=0;for(let v=0;v<s.length;v++)_+=lo(p,s[v])+p[3]>=0;if(0===_)return 0;_!==s.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let v=0;v<e.points.length;v++){const w=e.points[v][u]-this.min[u];p=Math.min(p,w),_=Math.max(_,w)}if(_<0||p>this.max[u]-this.min[u])return 0}return 1}}function Yf(i,e,s,l,u,p,_,v,w){if(p&&i.queryGeometry.isAboveHorizon)return!1;p&&(w*=i.pixelToTileUnitsFactor);for(const D of e)for(const M of D){const S=M.add(v),A=u&&s.elevation?s.elevation.exaggeration()*u.getElevationAt(S.x,S.y,!0):0,z=p?S:t_(S,A,l),N=p?i.tilespaceRays.map(q=>n_(q,A)):i.queryGeometry.screenGeometry,U=Vr([],[M.x,M.y,A,1],l);if(!_&&p?w*=U[3]/s.cameraToCenterDistance:_&&!p&&(w*=s.cameraToCenterDistance/U[3]),Ev(N,z,w))return!0}return!1}function t_(i,e,s){const l=Vr([],[i.x,i.y,e,1],s);return new Ke(l[0]/l[3],l[1]/l[3])}const ua=Wi(0,0,0),Nu=Wi(0,0,1);function n_(i,e){const s=Ss();return ua[2]=e,i.intersectsPlane(ua,Nu,s),new Ke(s[0],s[1])}class r_ extends jh{}function Qf(i,{width:e,height:s},l,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*s*l)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*s*l);return i.width=e,i.height=s,i.data=u,i}function i_(i,{width:e,height:s},l){if(e===i.width&&s===i.height)return;const u=Qf({},{width:e,height:s},l);em(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,s)},l),i.width=e,i.height=s,i.data=u.data}function em(i,e,s,l,u,p){if(0===u.width||0===u.height)return e;if(u.width>i.width||u.height>i.height||s.x>i.width-u.width||s.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||l.x>e.width-u.width||l.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,v=e.data;for(let w=0;w<u.height;w++){const D=((s.y+w)*i.width+s.x)*p,M=((l.y+w)*e.width+l.x)*p;for(let S=0;S<u.width*p;S++)v[M+S]=_[D+S]}return e}Xe("HeatmapBucket",r_,{omit:["layers"]});class Bl{constructor(e,s){Qf(this,e,1,s)}resize(e){i_(this,e,1)}clone(){return new Bl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,l,u,p){em(e,s,l,u,p,1)}}class Ui{constructor(e,s){Qf(this,e,4,s)}resize(e){i_(this,e,4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ui({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,l,u,p){em(e,s,l,u,p,4)}}Xe("AlphaImage",Bl),Xe("RGBAImage",Ui);var o_={paint:new rr({"heatmap-radius":new st(Ee.paint_heatmap["heatmap-radius"]),"heatmap-weight":new st(Ee.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new tt(Ee.paint_heatmap["heatmap-intensity"]),"heatmap-color":new eo(Ee.paint_heatmap["heatmap-color"]),"heatmap-opacity":new tt(Ee.paint_heatmap["heatmap-opacity"])})};function gp(i){const e={},s=i.resolution||256,l=i.clips?i.clips.length:1,u=i.image||new Ui({width:s,height:l}),p=(_,v,w)=>{e[i.evaluationKey]=w;const D=i.expression.evaluate(e);u.data[_+v+0]=Math.floor(255*D.r/D.a),u.data[_+v+1]=Math.floor(255*D.g/D.a),u.data[_+v+2]=Math.floor(255*D.b/D.a),u.data[_+v+3]=Math.floor(255*D.a)};if(i.clips)for(let _=0,v=0;_<l;++_,v+=4*s)for(let w=0,D=0;w<s;w++,D+=4){const M=w/(s-1),{start:S,end:A}=i.clips[_];p(v,D,S*(1-M)+A*M)}else for(let _=0,v=0;_<s;_++,v+=4)p(0,v,_/(s-1));return u}var s_={paint:new rr({"hillshade-illumination-direction":new tt(Ee.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new tt(Ee.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new tt(Ee.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new tt(Ee.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new tt(Ee.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new tt(Ee.paint_hillshade["hillshade-accent-color"])})};const a_=Pn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Dv}=a_;var Gh=Vu,Hh=Vu;function Vu(i,e,s){s=s||2;var l,u,p,_,v,w,D,M=e&&e.length,S=M?e[0]*s:i.length,A=Yo(i,0,S,s,!0),z=[];if(!A||A.next===A.prev)return z;if(M&&(A=function(U,q,J,ie){var ce,he,pe,de=[];for(ce=0,he=q.length;ce<he;ce++)(pe=Yo(U,q[ce]*ie,ce<he-1?q[ce+1]*ie:U.length,ie,!1))===pe.next&&(pe.steiner=!0),de.push(Iv(pe));for(de.sort(Mv),ce=0;ce<de.length;ce++)J=xo(J=_p(de[ce],J),J.next);return J}(i,e,A,s)),i.length>80*s){l=p=i[0],u=_=i[1];for(var N=s;N<S;N+=s)(v=i[N])<l&&(l=v),(w=i[N+1])<u&&(u=w),v>p&&(p=v),w>_&&(_=w);D=0!==(D=Math.max(p-l,_-u))?1/D:0}return jc(A,z,s,l,u,D),z}function Yo(i,e,s,l,u){var p,_;if(u===vp(i,e,s,l)>0)for(p=e;p<s;p+=l)_=Wh(p,i[p],i[p+1],_);else for(p=s-l;p>=e;p-=l)_=Wh(p,i[p],i[p+1],_);return _&&qh(_,_.next)&&(Gu(_),_=_.next),_}function xo(i,e){if(!i)return i;e||(e=i);var s,l=i;do{if(s=!1,l.steiner||!qh(l,l.next)&&0!==Wn(l.prev,l,l.next))l=l.next;else{if(Gu(l),(l=e=l.prev)===l.next)break;s=!0}}while(s||l!==e);return e}function jc(i,e,s,l,u,p,_){if(i){!_&&p&&function(M,S,A,z){var N=M;do{null===N.z&&(N.z=ju(N.x,N.y,S,A,z)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next}while(N!==M);N.prevZ.nextZ=null,N.prevZ=null,function(U){var q,J,ie,ce,he,pe,de,De,we=1;do{for(J=U,U=null,he=null,pe=0;J;){for(pe++,ie=J,de=0,q=0;q<we&&(de++,ie=ie.nextZ);q++);for(De=we;de>0||De>0&&ie;)0!==de&&(0===De||!ie||J.z<=ie.z)?(ce=J,J=J.nextZ,de--):(ce=ie,ie=ie.nextZ,De--),he?he.nextZ=ce:U=ce,ce.prevZ=he,he=ce;J=ie}he.nextZ=null,we*=2}while(pe>1)}(N)}(i,l,u,p);for(var v,w,D=i;i.prev!==i.next;)if(v=i.prev,w=i.next,p?nm(i,l,u,p):tm(i))e.push(v.i/s),e.push(i.i/s),e.push(w.i/s),Gu(i),i=w.next,D=w.next;else if((i=w)===D){_?1===_?jc(i=Tv(xo(i),e,s),e,s,l,u,p,2):2===_&&Cv(i,e,s,l,u,p):jc(xo(i),e,s,l,u,p,1);break}}}function tm(i){var e=i.prev,s=i,l=i.next;if(Wn(e,s,l)>=0)return!1;for(var u=i.next.next;u!==i.prev;){if(Uu(e.x,e.y,s.x,s.y,l.x,l.y,u.x,u.y)&&Wn(u.prev,u,u.next)>=0)return!1;u=u.next}return!0}function nm(i,e,s,l){var u=i.prev,p=i,_=i.next;if(Wn(u,p,_)>=0)return!1;for(var v=u.x>p.x?u.x>_.x?u.x:_.x:p.x>_.x?p.x:_.x,w=u.y>p.y?u.y>_.y?u.y:_.y:p.y>_.y?p.y:_.y,D=ju(u.x<p.x?u.x<_.x?u.x:_.x:p.x<_.x?p.x:_.x,u.y<p.y?u.y<_.y?u.y:_.y:p.y<_.y?p.y:_.y,e,s,l),M=ju(v,w,e,s,l),S=i.prevZ,A=i.nextZ;S&&S.z>=D&&A&&A.z<=M;){if(S!==i.prev&&S!==i.next&&Uu(u.x,u.y,p.x,p.y,_.x,_.y,S.x,S.y)&&Wn(S.prev,S,S.next)>=0||(S=S.prevZ,A!==i.prev&&A!==i.next&&Uu(u.x,u.y,p.x,p.y,_.x,_.y,A.x,A.y)&&Wn(A.prev,A,A.next)>=0))return!1;A=A.nextZ}for(;S&&S.z>=D;){if(S!==i.prev&&S!==i.next&&Uu(u.x,u.y,p.x,p.y,_.x,_.y,S.x,S.y)&&Wn(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;A&&A.z<=M;){if(A!==i.prev&&A!==i.next&&Uu(u.x,u.y,p.x,p.y,_.x,_.y,A.x,A.y)&&Wn(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function Tv(i,e,s){var l=i;do{var u=l.prev,p=l.next.next;!qh(u,p)&&im(u,l,l.next,p)&&Wa(u,p)&&Wa(p,u)&&(e.push(u.i/s),e.push(l.i/s),e.push(p.i/s),Gu(l),Gu(l.next),l=i=p),l=l.next}while(l!==i);return xo(l)}function Cv(i,e,s,l,u,p){var _=i;do{for(var v=_.next.next;v!==_.prev;){if(_.i!==v.i&&rm(_,v)){var w=om(_,v);return _=xo(_,_.next),w=xo(w,w.next),jc(_,e,s,l,u,p),void jc(w,e,s,l,u,p)}v=v.next}_=_.next}while(_!==i)}function Mv(i,e){return i.x-e.x}function _p(i,e){var s=function(p,_){var v,w=_,D=p.x,M=p.y,S=-1/0;do{if(M<=w.y&&M>=w.next.y&&w.next.y!==w.y){var A=w.x+(M-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(A<=D&&A>S){if(S=A,A===D){if(M===w.y)return w;if(M===w.next.y)return w.next}v=w.x<w.next.x?w:w.next}}w=w.next}while(w!==_);if(!v)return null;if(D===S)return v;var z,N=v,U=v.x,q=v.y,J=1/0;w=v;do{D>=w.x&&w.x>=U&&D!==w.x&&Uu(M<q?D:S,M,U,q,M<q?S:D,M,w.x,w.y)&&(z=Math.abs(M-w.y)/(D-w.x),Wa(w,p)&&(z<J||z===J&&(w.x>v.x||w.x===v.x&&yp(v,w)))&&(v=w,J=z)),w=w.next}while(w!==N);return v}(i,e);if(!s)return e;var l=om(s,i),u=xo(s,s.next);return xo(l,l.next),e===s?u:e}function yp(i,e){return Wn(i.prev,i,e.prev)<0&&Wn(e.next,i,i.next)<0}function ju(i,e,s,l,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-s)*u)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-l)*u)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Iv(i){var e=i,s=i;do{(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next}while(e!==i);return s}function Uu(i,e,s,l,u,p,_,v){return(u-_)*(e-v)-(i-_)*(p-v)>=0&&(i-_)*(l-v)-(s-_)*(e-v)>=0&&(s-_)*(p-v)-(u-_)*(l-v)>=0}function rm(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(s,l){var u=s;do{if(u.i!==s.i&&u.next.i!==s.i&&u.i!==l.i&&u.next.i!==l.i&&im(u,u.next,s,l))return!0;u=u.next}while(u!==s);return!1}(i,e)&&(Wa(i,e)&&Wa(e,i)&&function(s,l){var u=s,p=!1,_=(s.x+l.x)/2,v=(s.y+l.y)/2;do{u.y>v!=u.next.y>v&&u.next.y!==u.y&&_<(u.next.x-u.x)*(v-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next}while(u!==s);return p}(i,e)&&(Wn(i.prev,i,e.prev)||Wn(i,e.prev,e))||qh(i,e)&&Wn(i.prev,i,i.next)>0&&Wn(e.prev,e,e.next)>0)}function Wn(i,e,s){return(e.y-i.y)*(s.x-e.x)-(e.x-i.x)*(s.y-e.y)}function qh(i,e){return i.x===e.x&&i.y===e.y}function im(i,e,s,l){var u=$u(Wn(i,e,s)),p=$u(Wn(i,e,l)),_=$u(Wn(s,l,i)),v=$u(Wn(s,l,e));return u!==p&&_!==v||!(0!==u||!Zh(i,s,e))||!(0!==p||!Zh(i,l,e))||!(0!==_||!Zh(s,i,l))||!(0!==v||!Zh(s,e,l))}function Zh(i,e,s){return e.x<=Math.max(i.x,s.x)&&e.x>=Math.min(i.x,s.x)&&e.y<=Math.max(i.y,s.y)&&e.y>=Math.min(i.y,s.y)}function $u(i){return i>0?1:i<0?-1:0}function Wa(i,e){return Wn(i.prev,i,i.next)<0?Wn(i,e,i.next)>=0&&Wn(i,i.prev,e)>=0:Wn(i,e,i.prev)<0||Wn(i,i.next,e)<0}function om(i,e){var s=new ir(i.i,i.x,i.y),l=new ir(e.i,e.x,e.y),u=i.next,p=e.prev;return i.next=e,e.prev=i,s.next=u,u.prev=s,l.next=s,s.prev=l,p.next=l,l.prev=p,l}function Wh(i,e,s,l){var u=new ir(i,e,s);return l?(u.next=l.next,u.prev=l,l.next.prev=u,l.next=u):(u.prev=u,u.next=u),u}function Gu(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function ir(i,e,s){this.i=i,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function vp(i,e,s,l){for(var u=0,p=e,_=s-l;p<s;p+=l)u+=(i[_]-i[p])*(i[p+1]+i[_+1]),_=p;return u}function l_(i,e,s,l,u){xp(i,e,s||0,l||i.length-1,u||c_)}function xp(i,e,s,l,u){for(;l>s;){if(l-s>600){var p=l-s+1,_=e-s+1,v=Math.log(p),w=.5*Math.exp(2*v/3),D=.5*Math.sqrt(v*w*(p-w)/p)*(_-p/2<0?-1:1);xp(i,e,Math.max(s,Math.floor(e-_*w/p+D)),Math.min(l,Math.floor(e+(p-_)*w/p+D)),u)}var M=i[e],S=s,A=l;for(Uc(i,s,e),u(i[l],M)>0&&Uc(i,s,l);S<A;){for(Uc(i,S,A),S++,A--;u(i[S],M)<0;)S++;for(;u(i[A],M)>0;)A--}0===u(i[s],M)?Uc(i,s,A):Uc(i,++A,l),A<=e&&(s=A+1),e<=A&&(l=A-1)}}function Uc(i,e,s){var l=i[e];i[e]=i[s],i[s]=l}function c_(i,e){return i<e?-1:i>e?1:0}function bp(i,e){const s=i.length;if(s<=1)return[i];const l=[];let u,p;for(let _=0;_<s;_++){const v=Ma(i[_]);0!==v&&(i[_].area=Math.abs(v),void 0===p&&(p=v<0),p===v<0?(u&&l.push(u),u=[i[_]]):u.push(i[_]))}if(u&&l.push(u),e>1)for(let _=0;_<l.length;_++)l[_].length<=e||(l_(l[_],e,1,l[_].length-1,u_),l[_]=l[_].slice(0,e));return l}function u_(i,e){return e.area-i.area}function wp(i,e,s){const l=s.patternDependencies;let u=!1;for(const p of e){const _=p.paint.get(`${i}-pattern`);_.isConstant()||(u=!0);const v=_.constantOr(null);v&&(u=!0,l[v.to]=!0,l[v.from]=!0)}return u}function Ep(i,e,s,l,u){const p=u.patternDependencies;for(const _ of e){const v=_.paint.get(`${i}-pattern`).value;if("constant"!==v.kind){let w=v.evaluate({zoom:l-1},s,{},u.availableImages),D=v.evaluate({zoom:l},s,{},u.availableImages),M=v.evaluate({zoom:l+1},s,{},u.availableImages);w=w&&w.name?w.name:w,D=D&&D.name?D.name:D,M=M&&M.name?M.name:M,p[w]=!0,p[D]=!0,p[M]=!0,s.patterns[_.id]={min:w,mid:D,max:M}}}return s}Vu.deviation=function(i,e,s,l){var u=e&&e.length,p=Math.abs(vp(i,0,u?e[0]*s:i.length,s));if(u)for(var _=0,v=e.length;_<v;_++)p-=Math.abs(vp(i,e[_]*s,_<v-1?e[_+1]*s:i.length,s));var w=0;for(_=0;_<l.length;_+=3){var D=l[_]*s,M=l[_+1]*s,S=l[_+2]*s;w+=Math.abs((i[D]-i[S])*(i[M+1]-i[D+1])-(i[D]-i[M])*(i[S+1]-i[D+1]))}return 0===p&&0===w?0:Math.abs((w-p)/p)},Vu.flatten=function(i){for(var e=i[0][0].length,s={vertices:[],holes:[],dimensions:e},l=0,u=0;u<i.length;u++){for(var p=0;p<i[u].length;p++)for(var _=0;_<e;_++)s.vertices.push(i[u][p][_]);u>0&&s.holes.push(l+=i[u-1].length)}return s},Gh.default=Hh;class Dp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ac,this.indexArray=new Fr,this.indexArray2=new kl,this.programConfigurations=new ca(e.layers,e.zoom),this.segments=new ht,this.segments2=new ht,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,l,u){this.hasPattern=wp("fill",this.layers,s);const p=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:v,id:w,index:D,sourceLayerIndex:M}of e){const S=this.layers[0]._featureFilter.needGeometry,A=zl(v,S);if(!this.layers[0]._featureFilter.filter(new pt(this.zoom),A,l))continue;const z=p?p.evaluate(A,{},l,s.availableImages):void 0,N={id:w,properties:v.properties,type:v.type,sourceLayerIndex:M,index:D,geometry:S?A.geometry:ro(v,l,u),patterns:{},sortKey:z};_.push(N)}p&&_.sort((v,w)=>v.sortKey-w.sortKey);for(const v of _){const{geometry:w,index:D,sourceLayerIndex:M}=v;if(this.hasPattern){const S=Ep("fill",this.layers,v,this.zoom,s);this.patternFeatures.push(S)}else this.addFeature(v,w,D,l,{},s.availableImages);s.featureIndex.insert(e[D].feature,w,D,M,this.index)}}update(e,s,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,l,u)}addFeatures(e,s,l,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,l,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Dv),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,s,l,u,p,_=[]){for(const v of bp(s,500)){let w=0;for(const N of v)w+=N.length;const D=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),M=D.vertexLength,S=[],A=[];for(const N of v){if(0===N.length)continue;N!==v[0]&&A.push(S.length/2);const U=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),q=U.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(q+N.length-1,q),S.push(N[0].x),S.push(N[0].y);for(let J=1;J<N.length;J++)this.layoutVertexArray.emplaceBack(N[J].x,N[J].y),this.indexArray2.emplaceBack(q+J-1,q+J),S.push(N[J].x),S.push(N[J].y);U.vertexLength+=N.length,U.primitiveLength+=N.length}const z=Gh(S,A);for(let N=0;N<z.length;N+=3)this.indexArray.emplaceBack(M+z[N],M+z[N+1],M+z[N+2]);D.vertexLength+=w,D.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,_,u)}}Xe("FillBucket",Dp,{omit:["layers","patternFeatures"]});const Sv=new rr({"fill-sort-key":new st(Ee.layout_fill["fill-sort-key"])});var Hu={paint:new rr({"fill-antialias":new tt(Ee.paint_fill["fill-antialias"]),"fill-opacity":new st(Ee.paint_fill["fill-opacity"]),"fill-color":new st(Ee.paint_fill["fill-color"]),"fill-outline-color":new st(Ee.paint_fill["fill-outline-color"]),"fill-translate":new tt(Ee.paint_fill["fill-translate"]),"fill-translate-anchor":new tt(Ee.paint_fill["fill-translate-anchor"]),"fill-pattern":new nr(Ee.paint_fill["fill-pattern"])}),layout:Sv};const Mi=Pn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Tp=Pn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:sm}=Mi;var Cp=hr;function hr(i,e,s,l,u){this.properties={},this.extent=s,this.type=0,this._pbf=i,this._geometry=-1,this._keys=l,this._values=u,i.readFields(qu,this,e)}function qu(i,e,s){1==i?e.id=s.readVarint():2==i?function(l,u){for(var p=l.readVarint()+l.pos;l.pos<p;){var _=u._keys[l.readVarint()],v=u._values[l.readVarint()];u.properties[_]=v}}(s,e):3==i?e.type=s.readVarint():4==i&&(e._geometry=s.pos)}function Mp(i){for(var e,s,l=0,u=0,p=i.length,_=p-1;u<p;_=u++)l+=((s=i[_]).x-(e=i[u]).x)*(e.y+s.y);return l}hr.types=["Unknown","Point","LineString","Polygon"],hr.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,s=i.readVarint()+i.pos,l=1,u=0,p=0,_=0,v=[];i.pos<s;){if(u<=0){var w=i.readVarint();l=7&w,u=w>>3}if(u--,1===l||2===l)p+=i.readSVarint(),_+=i.readSVarint(),1===l&&(e&&v.push(e),e=[]),e.push(new Ke(p,_));else{if(7!==l)throw new Error("unknown command "+l);e&&e.push(e[0].clone())}}return e&&v.push(e),v},hr.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,s=1,l=0,u=0,p=0,_=1/0,v=-1/0,w=1/0,D=-1/0;i.pos<e;){if(l<=0){var M=i.readVarint();s=7&M,l=M>>3}if(l--,1===s||2===s)(u+=i.readSVarint())<_&&(_=u),u>v&&(v=u),(p+=i.readSVarint())<w&&(w=p),p>D&&(D=p);else if(7!==s)throw new Error("unknown command "+s)}return[_,w,v,D]},hr.prototype.toGeoJSON=function(i,e,s){var l,u,p=this.extent*Math.pow(2,s),_=this.extent*i,v=this.extent*e,w=this.loadGeometry(),D=hr.types[this.type];function M(z){for(var N=0;N<z.length;N++){var U=z[N];z[N]=[360*(U.x+_)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+v)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var S=[];for(l=0;l<w.length;l++)S[l]=w[l][0];M(w=S);break;case 2:for(l=0;l<w.length;l++)M(w[l]);break;case 3:for(w=function(z){var N=z.length;if(N<=1)return[z];for(var U,q,J=[],ie=0;ie<N;ie++){var ce=Mp(z[ie]);0!==ce&&(void 0===q&&(q=ce<0),q===ce<0?(U&&J.push(U),U=[z[ie]]):U.push(z[ie]))}return U&&J.push(U),J}(w),l=0;l<w.length;l++)for(u=0;u<w[l].length;u++)M(w[l][u])}1===w.length?w=w[0]:D="Multi"+D;var A={type:"Feature",geometry:{type:D,coordinates:w},properties:this.properties};return"id"in this&&(A.id=this.id),A};var am=lm;function lm(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(cm,this,e),this.length=this._features.length}function cm(i,e,s){15===i?e.version=s.readVarint():1===i?e.name=s.readString():5===i?e.extent=s.readVarint():2===i?e._features.push(s.pos):3===i?e._keys.push(s.readString()):4===i&&e._values.push(function(l){for(var u=null,p=l.readVarint()+l.pos;l.pos<p;){var _=l.readVarint()>>3;u=1===_?l.readString():2===_?l.readFloat():3===_?l.readDouble():4===_?l.readVarint64():5===_?l.readVarint():6===_?l.readSVarint():7===_?l.readBoolean():null}return u}(s))}function h_(i,e,s){if(3===i){var l=new am(s,s.readVarint()+s.pos);l.length&&(e[l.name]=l)}}lm.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Cp(this._pbf,e,this.extent,this._keys,this._values)};var Xa={VectorTile:function(i,e){this.layers=i.readFields(h_,{},e)},VectorTileFeature:Cp,VectorTileLayer:am};const d_=Xa.VectorTileFeature.types,um=Math.pow(2,13);function Zu(i,e,s,l,u,p,_,v){i.emplaceBack((e<<1)+_,(s<<1)+p,(Math.floor(l*um)<<1)+u,Math.round(v))}class hm{constructor(){this.acc=new Ke(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ke(e.x,e.y),this.max=new Ke(e.x,e.y))}append(e,s){this.currentPolyCount.edges++,this.acc._add(e);let l=!!this.borders;const u=this.min,p=this.max;e.x<u.x?(u.x=e.x,l=!0):e.x>p.x&&(p.x=e.x,l=!0),e.y<u.y?(u.y=e.y,l=!0):e.y>p.y&&(p.y=e.y,l=!0),((0===e.x||e.x===Pt)&&e.x===s.x)!=((0===e.y||e.y===Pt)&&e.y===s.y)&&this.processBorderOverlap(e,s),l&&this.checkBorderIntersection(e,s)}checkBorderIntersection(e,s){s.x<0!=e.x<0&&this.addBorderIntersection(0,Rt(s.y,e.y,(0-s.x)/(e.x-s.x))),s.x>Pt!=e.x>Pt&&this.addBorderIntersection(1,Rt(s.y,e.y,(Pt-s.x)/(e.x-s.x))),s.y<0!=e.y<0&&this.addBorderIntersection(2,Rt(s.x,e.x,(0-s.y)/(e.y-s.y))),s.y>Pt!=e.y>Pt&&this.addBorderIntersection(3,Rt(s.x,e.x,(Pt-s.y)/(e.y-s.y)))}addBorderIntersection(e,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];s<l[0]&&(l[0]=s),s>l[1]&&(l[1]=s)}processBorderOverlap(e,s){if(e.x===s.x){if(e.y===s.y)return;const l=0===e.x?0:1;this.addBorderIntersection(l,s.y),this.addBorderIntersection(l,e.y)}else{const l=0===e.y?2:3;this.addBorderIntersection(l,s.x),this.addBorderIntersection(l,e.x)}}centroid(){const e=this.polyCount.reduce((s,l)=>s+l.edges,0);return 0!==e?this.acc.div(e)._round():new Ke(0,0)}span(){return new Ke(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,s)=>e+ +(s[0]!==Number.MAX_VALUE),0)}}class Wu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new oa,this.centroidVertexArray=new Zo,this.indexArray=new Fr,this.programConfigurations=new ca(e.layers,e.zoom),this.segments=new ht,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=e.enableTerrain}populate(e,s,l,u){this.features=[],this.hasPattern=wp("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(p){const _=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*_/(_*_+1)/Pt/(1<<p.z)}(l);for(const{feature:p,id:_,index:v,sourceLayerIndex:w}of e){const D=this.layers[0]._featureFilter.needGeometry,M=zl(p,D);if(!this.layers[0]._featureFilter.filter(new pt(this.zoom),M,l))continue;const S={id:_,sourceLayerIndex:w,index:v,geometry:D?M.geometry:ro(p,l,u),properties:p.properties,type:p.type,patterns:{}},A=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ep("fill-extrusion",this.layers,S,this.zoom,s)):this.addFeature(S,S.geometry,v,l,{},s.availableImages),s.featureIndex.insert(p,S.geometry,v,w,this.index,A)}this.sortBorders()}addFeatures(e,s,l,u){for(const p of this.features){const{geometry:_}=p;this.addFeature(p,_,p.index,s,l,u)}this.sortBorders()}update(e,s,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,l,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sm),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Tp.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,l,u,p,_){const v=this.enableTerrain?new hm:null;for(const D of bp(s,500)){let M=0,S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===D.length||(w=D[0]).every(q=>q.x<=0)||w.every(q=>q.x>=Pt)||w.every(q=>q.y<=0)||w.every(q=>q.y>=Pt))continue;for(let q=0;q<D.length;q++){const J=D[q];if(0===J.length)continue;M+=J.length;let ie=0;v&&v.startRing(J[0]);for(let ce=0;ce<J.length;ce++){const he=J[ce];if(ce>=1){const pe=J[ce-1];if(!p_(he,pe)){v&&v.append(he,pe),S.vertexLength+4>ht.MAX_VERTEX_ARRAY_LENGTH&&(S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const de=he.sub(pe)._perp(),De=de.x/(Math.abs(de.x)+Math.abs(de.y)),we=de.y>0?1:0,$e=pe.dist(he);ie+$e>32768&&(ie=0),Zu(this.layoutVertexArray,he.x,he.y,De,we,0,0,ie),Zu(this.layoutVertexArray,he.x,he.y,De,we,0,1,ie),ie+=$e,Zu(this.layoutVertexArray,pe.x,pe.y,De,we,0,0,ie),Zu(this.layoutVertexArray,pe.x,pe.y,De,we,0,1,ie);const Be=S.vertexLength;this.indexArray.emplaceBack(Be,Be+2,Be+1),this.indexArray.emplaceBack(Be+1,Be+2,Be+3),S.vertexLength+=4,S.primitiveLength+=2}}}}if(S.vertexLength+M>ht.MAX_VERTEX_ARRAY_LENGTH&&(S=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray)),"Polygon"!==d_[e.type])continue;const A=[],z=[],N=S.vertexLength;for(let q=0;q<D.length;q++){const J=D[q];if(0!==J.length){J!==D[0]&&z.push(A.length/2);for(let ie=0;ie<J.length;ie++){const ce=J[ie];Zu(this.layoutVertexArray,ce.x,ce.y,0,0,1,1,0),A.push(ce.x),A.push(ce.y),v&&v.currentPolyCount.top++}}}const U=Gh(A,z);for(let q=0;q<U.length;q+=3)this.indexArray.emplaceBack(N+U[q],N+U[q+2],N+U[q+1]);S.primitiveLength+=U.length/3,S.vertexLength+=M}var w;if(v&&v.polyCount.length>0){if(v.borders){v.vertexArrayOffset=this.centroidVertexArray.length;const D=v.borders,M=this.featuresOnBorder.push(v)-1;for(let S=0;S<4;S++)D[S][0]!==Number.MAX_VALUE&&this.borders[S].push(M)}this.encodeCentroid(v.borders?void 0:v.centroid(),v)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,_,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((s,l)=>this.featuresOnBorder[s].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}encodeCentroid(e,s,l=!0){let u,p;if(e)if(0!==e.y){const v=s.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(v.x/10)),p=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(v.y/10))}else u=Math.ceil(7*(e.x+450)),p=0;else u=0,p=+l;let _=l?this.centroidVertexArray.length:s.vertexArrayOffset;for(const v of s.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*v.edges+v.top);for(let w=0;w<2*v.edges;w++)this.centroidVertexArray.emplace(_++,0,p),this.centroidVertexArray.emplace(_++,u,p);for(let w=0;w<v.top;w++)this.centroidVertexArray.emplace(_++,u,p)}}}function p_(i,e){return i.x===e.x&&(i.x<0||i.x>Pt)||i.y===e.y&&(i.y<0||i.y>Pt)}Xe("FillExtrusionBucket",Wu,{omit:["layers","features"]}),Xe("PartMetadata",hm);var f_={paint:new rr({"fill-extrusion-opacity":new tt(Ee["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new st(Ee["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new tt(Ee["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new tt(Ee["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new nr(Ee["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new st(Ee["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new st(Ee["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new tt(Ee["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Nl(i,e){return i.x*e.x+i.y*e.y}function dm(i,e){if(1===i.length){let s=0;const l=e[s++];let u;for(;!u||l.equals(u);)if(u=e[s++],!u)return 1/0;for(;s<e.length;s++){const p=e[s],_=i[0],v=u.sub(l),w=p.sub(l),D=_.sub(l),M=Nl(v,v),S=Nl(v,w),A=Nl(w,w),z=Nl(D,v),N=Nl(D,w),U=M*A-S*S,q=(A*z-S*N)/U,J=(M*N-S*z)/U,ie=l.z*(1-q-J)+u.z*q+p.z*J;if(isFinite(ie))return ie}return 1/0}{let s=1/0;for(const l of e)s=Math.min(s,l.z);return s}}function pm(i){const e=new Ke(i[0],i[1]);return e.z=i[2],e}function Xu(i,e,s,l,u,p,_,v){const w=_*u.getElevationAt(i,e,!0,!0),D=0!==p[0],M=D?0===p[1]?_*(p[0]/7-450):_*function(S,A,z){const N=Math.floor(A[0]/8),U=Math.floor(A[1]/8),q=10*(A[0]-8*N),J=10*(A[1]-8*U),ie=S.getElevationAt(N,U,!0,!0),ce=S.getMeterToDEM(z),he=Math.floor(.5*(q*ce-1)),pe=Math.floor(.5*(J*ce-1)),de=S.tileCoordToPixel(N,U),De=2*he+1,we=2*pe+1,$e=(pn=De,Vt=we,[(We=S).getElevationAtPixel(Ye=de.x-he,zt=de.y-pe,!0),We.getElevationAtPixel(Ye+Vt,zt,!0),We.getElevationAtPixel(Ye,zt+Vt,!0),We.getElevationAtPixel(Ye+pn,zt+Vt,!0)]),Be=Math.abs($e[0]-$e[1]),Te=Math.abs($e[2]-$e[3]),Ve=Math.abs($e[0]-$e[2])+Math.abs($e[1]-$e[3]),Ze=Math.min(.25,.5*ce*(Be+Te)/De),Pe=Math.min(.25,.5*ce*Ve/we);var We,Ye,zt,pn,Vt;return ie+Math.max(Ze*q,Pe*J)}(u,p,v):w;return{base:w+(0===s)?-1:s,top:D?Math.max(M+l,w+s+2):w+l}}const m_=Pn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:g_}=m_,__=Pn([{name:"a_packed",components:3,type:"Float32"}]),{members:y_}=__,v_=Xa.VectorTileFeature.types,fm=Math.cos(Math.PI/180*37.5);class Xh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Pl,this.layoutVertexArray2=new Pc,this.indexArray=new Fr,this.programConfigurations=new ca(e.layers,e.zoom),this.segments=new ht,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,l,u){this.hasPattern=wp("line",this.layers,s);const p=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:M,id:S,index:A,sourceLayerIndex:z}of e){const N=this.layers[0]._featureFilter.needGeometry,U=zl(M,N);if(!this.layers[0]._featureFilter.filter(new pt(this.zoom),U,l))continue;const q=p?p.evaluate(U,{},l):void 0,J={id:S,properties:M.properties,type:M.type,sourceLayerIndex:z,index:A,geometry:N?U.geometry:ro(M,l,u),patterns:{},sortKey:q};_.push(J)}p&&_.sort((M,S)=>M.sortKey-S.sortKey);const{lineAtlas:v,featureIndex:w}=s,D=this.addConstantDashes(v);for(const M of _){const{geometry:S,index:A,sourceLayerIndex:z}=M;if(D&&this.addFeatureDashes(M,v),this.hasPattern){const N=Ep("line",this.layers,M,this.zoom,s);this.patternFeatures.push(N)}else this.addFeature(M,S,A,l,v.positions,s.availableImages);w.insert(e[A].feature,S,A,z,this.index)}}addConstantDashes(e){let s=!1;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==p.kind)s=!0;else{const _=p.value,v=u.value;if(!v)continue;e.addDash(v.from,_),e.addDash(v.to,_),v.other&&e.addDash(v.other,_)}}return s}addFeatureDashes(e,s){const l=this.zoom;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,_=u.layout.get("line-cap").value;if("constant"===p.kind&&"constant"===_.kind)continue;let v,w,D,M,S,A;if("constant"===p.kind){const q=p.value;if(!q)continue;v=q.other||q.to,w=q.to,D=q.from}else v=p.evaluate({zoom:l-1},e),w=p.evaluate({zoom:l},e),D=p.evaluate({zoom:l+1},e);"constant"===_.kind?M=S=A=_.value:(M=_.evaluate({zoom:l-1},e),S=_.evaluate({zoom:l},e),A=_.evaluate({zoom:l+1},e)),s.addDash(v,M),s.addDash(w,S),s.addDash(D,A);const z=s.getKey(v,M),N=s.getKey(w,S),U=s.getKey(D,A);e.patterns[u.id]={min:z,mid:N,max:U}}}update(e,s,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,l,u)}addFeatures(e,s,l,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,l,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,y_)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,g_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,s,l,u,p,_){const v=this.layers[0].layout,w=v.get("line-join").evaluate(e,{}),D=v.get("line-cap").evaluate(e,{}),M=v.get("line-miter-limit"),S=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const A of s)this.addLine(A,e,w,D,M,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,_,u)}addLine(e,s,l,u,p,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<e.length-1;J++)this.totalDistance+=e[J].dist(e[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v="Polygon"===v_[s.type];let w=e.length;for(;w>=2&&e[w-1].equals(e[w-2]);)w--;let D=0;for(;D<w-1&&e[D].equals(e[D+1]);)D++;if(w<(v?3:2))return;"bevel"===l&&(p=1.05);const M=this.overscaling<=16?122880/(512*this.overscaling):0,S=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let A,z,N,U,q;this.e1=this.e2=-1,v&&(A=e[w-2],q=e[D].sub(A)._unit()._perp());for(let J=D;J<w;J++){if(N=J===w-1?v?e[D+1]:void 0:e[J+1],N&&e[J].equals(N))continue;q&&(U=q),A&&(z=A),A=e[J],q=N?N.sub(A)._unit()._perp():U,U=U||q;let ie=U.add(q);0===ie.x&&0===ie.y||ie._unit();const ce=U.x*q.x+U.y*q.y,he=ie.x*q.x+ie.y*q.y,pe=0!==he?1/he:1/0,de=2*Math.sqrt(2-2*he),De=he<fm&&z&&N,we=U.x*q.y-U.y*q.x>0;if(De&&J>D){const Te=A.dist(z);if(Te>2*M){const Ve=A.sub(A.sub(z)._mult(M/Te)._round());this.updateDistance(z,Ve),this.addCurrentVertex(Ve,U,0,0,S),z=Ve}}const $e=z&&N;let Be=$e?l:v?"butt":u;if($e&&"round"===Be&&(pe<_?Be="miter":pe<=2&&(Be="fakeround")),"miter"===Be&&pe>p&&(Be="bevel"),"bevel"===Be&&(pe>2&&(Be="flipbevel"),pe<p&&(Be="miter")),z&&this.updateDistance(z,A),"miter"===Be)ie._mult(pe),this.addCurrentVertex(A,ie,0,0,S);else if("flipbevel"===Be){if(pe>100)ie=q.mult(-1);else{const Te=pe*U.add(q).mag()/U.sub(q).mag();ie._perp()._mult(Te*(we?-1:1))}this.addCurrentVertex(A,ie,0,0,S),this.addCurrentVertex(A,ie.mult(-1),0,0,S)}else if("bevel"===Be||"fakeround"===Be){const Te=-Math.sqrt(pe*pe-1),Ve=we?Te:0,Ze=we?0:Te;if(z&&this.addCurrentVertex(A,U,Ve,Ze,S),"fakeround"===Be){const Pe=Math.round(180*de/Math.PI/20);for(let We=1;We<Pe;We++){let Ye=We/Pe;if(.5!==Ye){const pn=Ye-.5;Ye+=Ye*pn*(Ye-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*pn*pn+(.848013+ce*(.215638*ce-1.06021)))}const zt=q.sub(U)._mult(Ye)._add(U)._unit()._mult(we?-1:1);this.addHalfVertex(A,zt.x,zt.y,!1,we,0,S)}}N&&this.addCurrentVertex(A,q,-Ve,-Ze,S)}else if("butt"===Be)this.addCurrentVertex(A,ie,0,0,S);else if("square"===Be){const Te=z?1:-1;z||this.addCurrentVertex(A,ie,Te,Te,S),this.addCurrentVertex(A,ie,0,0,S),z&&this.addCurrentVertex(A,ie,Te,Te,S)}else"round"===Be&&(z&&(this.addCurrentVertex(A,U,0,0,S),this.addCurrentVertex(A,U,1,1,S,!0)),N&&(this.addCurrentVertex(A,q,-1,-1,S,!0),this.addCurrentVertex(A,q,0,0,S)));if(De&&J<w-1){const Te=A.dist(N);if(Te>2*M){const Ve=A.add(N.sub(A)._mult(M/Te)._round());this.updateDistance(A,Ve),this.addCurrentVertex(Ve,q,0,0,S),A=Ve}}}}addCurrentVertex(e,s,l,u,p,_=!1){const v=s.y*u-s.x,w=-s.y-s.x*u;this.addHalfVertex(e,s.x+s.y*l,s.y-s.x*l,_,!1,l,p),this.addHalfVertex(e,v,w,_,!0,-u,p)}addHalfVertex({x:e,y:s},l,u,p,_,v,w){this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(s<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*u)+128,1+(0===v?0:v<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const D=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),w.primitiveLength++),_?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,s){this.distance+=e.dist(s),this.updateScaledDistance()}}Xe("LineBucket",Xh,{omit:["layers","patternFeatures"]});const x_=new rr({"line-cap":new st(Ee.layout_line["line-cap"]),"line-join":new st(Ee.layout_line["line-join"]),"line-miter-limit":new tt(Ee.layout_line["line-miter-limit"]),"line-round-limit":new tt(Ee.layout_line["line-round-limit"]),"line-sort-key":new st(Ee.layout_line["line-sort-key"])});var mm={paint:new rr({"line-opacity":new st(Ee.paint_line["line-opacity"]),"line-color":new st(Ee.paint_line["line-color"]),"line-translate":new tt(Ee.paint_line["line-translate"]),"line-translate-anchor":new tt(Ee.paint_line["line-translate-anchor"]),"line-width":new st(Ee.paint_line["line-width"]),"line-gap-width":new st(Ee.paint_line["line-gap-width"]),"line-offset":new st(Ee.paint_line["line-offset"]),"line-blur":new st(Ee.paint_line["line-blur"]),"line-dasharray":new nr(Ee.paint_line["line-dasharray"]),"line-pattern":new nr(Ee.paint_line["line-pattern"]),"line-gradient":new eo(Ee.paint_line["line-gradient"])}),layout:x_};const gm=new class extends st{possiblyEvaluate(i,e){return e=new pt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,s,l){return e=Nn({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,s,l)}}(mm.paint.properties["line-width"].specification);function _m(i,e){return e>0?e+2*i:i}gm.useIntegerZoom=!0;const b_=Pn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),w_=Pn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Pn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const E_=Pn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),$c=Pn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Pn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Qo=Pn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Av=Pn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Pn([{name:"triangle",components:3,type:"Uint16"}]),Pn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Pn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Pn([{type:"Float32",name:"offsetX"}]),Pn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const es=128;function ym(i,e){const{expression:s}=e;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new pt(i+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:l,interpolationType:u}=s;let p=0;for(;p<l.length&&l[p]<=i;)p++;p=Math.max(0,p-1);let _=p;for(;_<l.length&&l[_]<i+1;)_++;_=Math.min(l.length-1,_);const v=l[p],w=l[_];return"composite"===s.kind?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:u}:{kind:"camera",minZoom:v,maxZoom:w,minSize:s.evaluate(new pt(v)),maxSize:s.evaluate(new pt(w)),interpolationType:u}}}function li(i,{uSize:e,uSizeT:s},{lowerSize:l,upperSize:u}){return"source"===i.kind?l/es:"composite"===i.kind?Rt(l/es,u/es,s):e}function Ka(i,e){let s=0,l=0;if("constant"===i.kind)l=i.layoutSize;else if("source"!==i.kind){const{interpolationType:u,minZoom:p,maxZoom:_}=i,v=u?on(Dn.interpolationFactor(u,e,p,_),0,1):0;"camera"===i.kind?l=Rt(i.minSize,i.maxSize,v):s=v}return{uSizeT:s,uSize:l}}var Ip=Object.freeze({__proto__:null,getSizeData:ym,evaluateSizeForFeature:li,evaluateSizeForZoom:Ka,SIZE_PACK_FACTOR:es});function D_(i,e,s){return i.sections.forEach(l=>{l.text=function(u,p,_){const v=p.layout.get("text-transform").evaluate(_,{});return"uppercase"===v?u=u.toLocaleUpperCase():"lowercase"===v&&(u=u.toLocaleLowerCase()),Nt.applyArabicShaping&&(u=Nt.applyArabicShaping(u)),u}(l.text,e,s)}),i}const Gc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Ku(i){return"\ufe36"===i||"\ufe48"===i||"\ufe38"===i||"\ufe44"===i||"\ufe42"===i||"\ufe3e"===i||"\ufe3c"===i||"\ufe3a"===i||"\ufe18"===i||"\ufe40"===i||"\ufe10"===i||"\ufe13"===i||"\ufe14"===i||"\uff40"===i||"\uffe3"===i||"\ufe11"===i||"\ufe12"===i}function vm(i){return"\ufe35"===i||"\ufe47"===i||"\ufe37"===i||"\ufe43"===i||"\ufe41"===i||"\ufe3d"===i||"\ufe3b"===i||"\ufe39"===i||"\ufe17"===i||"\ufe3f"===i}var Sp=function(i,e,s,l,u){var p,_,v=8*u-l-1,w=(1<<v)-1,D=w>>1,M=-7,S=s?u-1:0,A=s?-1:1,z=i[e+S];for(S+=A,p=z&(1<<-M)-1,z>>=-M,M+=v;M>0;p=256*p+i[e+S],S+=A,M-=8);for(_=p&(1<<-M)-1,p>>=-M,M+=l;M>0;_=256*_+i[e+S],S+=A,M-=8);if(0===p)p=1-D;else{if(p===w)return _?NaN:1/0*(z?-1:1);_+=Math.pow(2,l),p-=D}return(z?-1:1)*_*Math.pow(2,p-l)},Kh=function(i,e,s,l,u,p){var _,v,w,D=8*p-u-1,M=(1<<D)-1,S=M>>1,A=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,z=l?0:p-1,N=l?1:-1,U=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,_=M):(_=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-_))<1&&(_--,w*=2),(e+=_+S>=1?A/w:A*Math.pow(2,1-S))*w>=2&&(_++,w/=2),_+S>=M?(v=0,_=M):_+S>=1?(v=(e*w-1)*Math.pow(2,u),_+=S):(v=e*Math.pow(2,S-1)*Math.pow(2,u),_=0));u>=8;i[s+z]=255&v,z+=N,v/=256,u-=8);for(_=_<<u|v,D+=u;D>0;i[s+z]=255&_,z+=N,_/=256,D-=8);i[s+z-N]|=128*U},Vl=dn;function dn(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}dn.Varint=0,dn.Fixed64=1,dn.Bytes=2,dn.Fixed32=5;var xm=4294967296,jl=1/xm,Jh="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Es(i){return i.type===dn.Bytes?i.readVarint()+i.pos:i.pos+1}function Yh(i,e,s){var l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));s.realloc(l);for(var u=s.pos-1;u>=i;u--)s.buf[u+l]=s.buf[u]}function T_(i,e){for(var s=0;s<i.length;s++)e.writeVarint(i[s])}function C_(i,e){for(var s=0;s<i.length;s++)e.writeSVarint(i[s])}function M_(i,e){for(var s=0;s<i.length;s++)e.writeFloat(i[s])}function I_(i,e){for(var s=0;s<i.length;s++)e.writeDouble(i[s])}function S_(i,e){for(var s=0;s<i.length;s++)e.writeBoolean(i[s])}function A_(i,e){for(var s=0;s<i.length;s++)e.writeFixed32(i[s])}function bm(i,e){for(var s=0;s<i.length;s++)e.writeSFixed32(i[s])}function Ap(i,e){for(var s=0;s<i.length;s++)e.writeFixed64(i[s])}function wm(i,e){for(var s=0;s<i.length;s++)e.writeSFixed64(i[s])}function qc(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Zc(i,e,s){i[s]=e,i[s+1]=e>>>8,i[s+2]=e>>>16,i[s+3]=e>>>24}function Em(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function Dm(i,e,s){e.glyphs=[],1===i&&s.readMessage(Tm,e)}function Tm(i,e,s){if(3===i){const{id:l,bitmap:u,width:p,height:_,left:v,top:w,advance:D}=s.readMessage(Ul,{});e.glyphs.push({id:l,bitmap:new Bl({width:p+6,height:_+6},u),metrics:{width:p,height:_,left:v,top:w,advance:D}})}else 4===i?e.ascender=s.readSVarint():5===i&&(e.descender=s.readSVarint())}function Ul(i,e,s){1===i?e.id=s.readVarint():2===i?e.bitmap=s.readBytes():3===i?e.width=s.readVarint():4===i?e.height=s.readVarint():5===i?e.left=s.readSVarint():6===i?e.top=s.readSVarint():7===i&&(e.advance=s.readVarint())}function Qh(i){let e=0,s=0;for(const _ of i)e+=_.w*_.h,s=Math.max(s,_.w);i.sort((_,v)=>v.h-_.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let u=0,p=0;for(const _ of i)for(let v=l.length-1;v>=0;v--){const w=l[v];if(!(_.w>w.w||_.h>w.h)){if(_.x=w.x,_.y=w.y,p=Math.max(p,_.y+_.h),u=Math.max(u,_.x+_.w),_.w===w.w&&_.h===w.h){const D=l.pop();v<l.length&&(l[v]=D)}else _.h===w.h?(w.x+=_.w,w.w-=_.w):_.w===w.w?(w.y+=_.h,w.h-=_.h):(l.push({x:w.x+_.w,y:w.y,w:w.w-_.w,h:_.h}),w.y+=_.h,w.h-=_.h);break}}return{w:u,h:p,fill:e/(u*p)||0}}dn.prototype={destroy:function(){this.buf=null},readFields:function(i,e,s){for(s=s||this.length;this.pos<s;){var l=this.readVarint(),u=l>>3,p=this.pos;this.type=7&l,i(u,e,this),this.pos===p&&this.skip(l)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=qc(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Em(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=qc(this.buf,this.pos)+qc(this.buf,this.pos+4)*xm;return this.pos+=8,i},readSFixed64:function(){var i=qc(this.buf,this.pos)+Em(this.buf,this.pos+4)*xm;return this.pos+=8,i},readFloat:function(){var i=Sp(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Sp(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,s,l=this.buf;return e=127&(s=l[this.pos++]),s<128?e:(e|=(127&(s=l[this.pos++]))<<7,s<128?e:(e|=(127&(s=l[this.pos++]))<<14,s<128?e:(e|=(127&(s=l[this.pos++]))<<21,s<128?e:function(u,p,_){var v,w,D=_.buf;if(v=(112&(w=D[_.pos++]))>>4,w<128||(v|=(127&(w=D[_.pos++]))<<3,w<128)||(v|=(127&(w=D[_.pos++]))<<10,w<128)||(v|=(127&(w=D[_.pos++]))<<17,w<128)||(v|=(127&(w=D[_.pos++]))<<24,w<128)||(v|=(1&(w=D[_.pos++]))<<31,w<128))return function Hc(i,e,s){return s?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}(u,v,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(s=l[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Jh?Jh.decode(this.buf.subarray(e,i)):function(s,l,u){for(var p="",_=l;_<u;){var v,w,D,M=s[_],S=null,A=M>239?4:M>223?3:M>191?2:1;if(_+A>u)break;1===A?M<128&&(S=M):2===A?128==(192&(v=s[_+1]))&&(S=(31&M)<<6|63&v)<=127&&(S=null):3===A?(w=s[_+2],128==(192&(v=s[_+1]))&&128==(192&w)&&((S=(15&M)<<12|(63&v)<<6|63&w)<=2047||S>=55296&&S<=57343)&&(S=null)):4===A&&(w=s[_+2],D=s[_+3],128==(192&(v=s[_+1]))&&128==(192&w)&&128==(192&D)&&((S=(15&M)<<18|(63&v)<<12|(63&w)<<6|63&D)<=65535||S>=1114112)&&(S=null)),null===S?(S=65533,A=1):S>65535&&(S-=65536,p+=String.fromCharCode(S>>>10&1023|55296),S=56320|1023&S),p+=String.fromCharCode(S),_+=A}return p}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==dn.Bytes)return i.push(this.readVarint(e));var s=Es(this);for(i=i||[];this.pos<s;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==dn.Bytes)return i.push(this.readSVarint());var e=Es(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==dn.Bytes)return i.push(this.readBoolean());var e=Es(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==dn.Bytes)return i.push(this.readFloat());var e=Es(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==dn.Bytes)return i.push(this.readDouble());var e=Es(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==dn.Bytes)return i.push(this.readFixed32());var e=Es(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==dn.Bytes)return i.push(this.readSFixed32());var e=Es(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==dn.Bytes)return i.push(this.readFixed64());var e=Es(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==dn.Bytes)return i.push(this.readSFixed64());var e=Es(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===dn.Varint)for(;this.buf[this.pos++]>127;);else if(e===dn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===dn.Fixed32)this.pos+=4;else{if(e!==dn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var s=new Uint8Array(e);s.set(this.buf),this.buf=s,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Zc(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Zc(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Zc(this.buf,-1&i,this.pos),Zc(this.buf,Math.floor(i*jl),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Zc(this.buf,-1&i,this.pos),Zc(this.buf,Math.floor(i*jl),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,s){var l,u,p,v;if(e>=0?(l=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(l=~(-e%4294967296))?l=l+1|0:(l=0,u=u+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),p=l,(v=s).buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7),function(p,_){var v=(7&p)<<4;_.buf[_.pos++]|=v|((p>>>=3)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p)))))}(u,s)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(l,u,p){for(var _,v,w=0;w<u.length;w++){if((_=u.charCodeAt(w))>55295&&_<57344){if(!v){_>56319||w+1===u.length?(l[p++]=239,l[p++]=191,l[p++]=189):v=_;continue}if(_<56320){l[p++]=239,l[p++]=191,l[p++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(l[p++]=239,l[p++]=191,l[p++]=189,v=null);_<128?l[p++]=_:(_<2048?l[p++]=_>>6|192:(_<65536?l[p++]=_>>12|224:(l[p++]=_>>18|240,l[p++]=_>>12&63|128),l[p++]=_>>6&63|128),l[p++]=63&_|128)}return p}(this.buf,i,this.pos);var s=this.pos-e;s>=128&&Yh(e,s,this),this.pos=e-1,this.writeVarint(s),this.pos+=s},writeFloat:function(i){this.realloc(4),Kh(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Kh(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var s=0;s<e;s++)this.buf[this.pos++]=i[s]},writeRawMessage:function(i,e){this.pos++;var s=this.pos;i(e,this);var l=this.pos-s;l>=128&&Yh(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeMessage:function(i,e,s){this.writeTag(i,dn.Bytes),this.writeRawMessage(e,s)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,T_,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,C_,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,S_,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,M_,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,I_,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,A_,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,bm,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Ap,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,wm,e)},writeBytesField:function(i,e){this.writeTag(i,dn.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,dn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,dn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,dn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,dn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,dn.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,dn.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,dn.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,dn.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,dn.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class ed{constructor(e,{pixelRatio:s,version:l,stretchX:u,stretchY:p,content:_}){this.paddedRect=e,this.pixelRatio=s,this.stretchX=u,this.stretchY=p,this.content=_,this.version=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Cm{constructor(e,s){const l={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,l,p),this.addImages(s,u,p);const{w:_,h:v}=Qh(p),w=new Ui({width:_||1,height:v||1});for(const D in e){const M=e[D],S=l[D].paddedRect;Ui.copy(M.data,w,{x:0,y:0},{x:S.x+1,y:S.y+1},M.data)}for(const D in s){const M=s[D],S=u[D].paddedRect,A=S.x+1,z=S.y+1,N=M.data.width,U=M.data.height;Ui.copy(M.data,w,{x:0,y:0},{x:A,y:z},M.data),Ui.copy(M.data,w,{x:0,y:U-1},{x:A,y:z-1},{width:N,height:1}),Ui.copy(M.data,w,{x:0,y:0},{x:A,y:z+U},{width:N,height:1}),Ui.copy(M.data,w,{x:N-1,y:0},{x:A-1,y:z},{width:1,height:U}),Ui.copy(M.data,w,{x:0,y:0},{x:A+N,y:z},{width:1,height:U})}this.image=w,this.iconPositions=l,this.patternPositions=u}addImages(e,s,l){for(const u in e){const p=e[u],_={x:0,y:0,w:p.data.width+2,h:p.data.height+2};l.push(_),s[u]=new ed(_,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,s){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),s)}patchUpdatedImage(e,s,l){if(!e||!s||e.version===s.version)return;e.version=s.version;const[u,p]=e.tl;l.update(s.data,void 0,{x:u,y:p})}}Xe("ImagePosition",ed),Xe("ImageAtlas",Cm);const ci={horizontal:1,vertical:2,horizontalOnly:3};class Ju{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,s){const l=new Ju;return l.scale=e||1,l.fontStack=s,l}static forImage(e){const s=new Ju;return s.imageName=e,s}}class $l{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s){const l=new $l;for(let u=0;u<e.sections.length;u++){const p=e.sections[u];p.image?l.addImageSection(p):l.addTextSection(p,s)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(s,l){let u="";for(let p=0;p<s.length;p++){const _=s.charCodeAt(p+1)||null,v=s.charCodeAt(p-1)||null;u+=!l&&(_&&et(_)&&!Gc[s[p+1]]||v&&et(v)&&!Gc[s[p-1]])||!Gc[s[p]]?s[p]:Gc[s[p]]}return u}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&Yu[this.text.charCodeAt(l)];l++)e++;let s=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&Yu[this.text.charCodeAt(l)];l--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){const l=new $l;return l.text=this.text.substring(e,s),l.sectionIndex=this.sectionIndex.slice(e,s),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}addTextSection(e,s){this.text+=e.text,this.sections.push(Ju.forText(e.scale,e.fontStack||s));const l=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(l)}addImageSection(e){const s=e.image?e.image.name:"";if(0===s.length)return void Mn("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Ju.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Mn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function td(i,e,s,l,u,p,_,v,w,D,M,S,A,z,N,U){const q=$l.fromFeature(i,u);let J;S===ci.vertical&&q.verticalizePunctuation(A);const{processBidirectionalText:ie,processStyledBidirectionalText:ce}=Nt;if(ie&&1===q.sections.length){J=[];const de=ie(q.toString(),id(q,D,p,e,l,z,N));for(const De of de){const we=new $l;we.text=De,we.sections=q.sections;for(let $e=0;$e<De.length;$e++)we.sectionIndex.push(0);J.push(we)}}else if(ce){J=[];const de=ce(q.text,q.sectionIndex,id(q,D,p,e,l,z,N));for(const De of de){const we=new $l;we.text=De[0],we.sectionIndex=De[1],we.sections=q.sections,J.push(we)}}else J=function(de,De){const we=[],$e=de.text;let Be=0;for(const Te of De)we.push(de.substring(Be,Te)),Be=Te;return Be<$e.length&&we.push(de.substring(Be,$e.length)),we}(q,id(q,D,p,e,l,z,N));const he=[],pe={positionedLines:he,text:q.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:S,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(de,De,we,$e,Be,Te,Ve,Ze,Pe,We,Ye,zt){let pn=0,Vt=0,jt=0;const Ne="right"===Ze?1:"left"===Ze?0:.5;let Jt=!1;for(const Yt of Be){const Ot=Yt.getSections();for(const zn of Ot){if(zn.imageName)continue;const or=De[zn.fontStack];if(or&&(Jt=void 0!==or.ascender&&void 0!==or.descender,!Jt))break}if(!Jt)break}let qt=0;for(const Yt of Be){Yt.trim();const Ot=Yt.getMaxScale(),zn=24*(Ot-1),or={positionedGlyphs:[],lineOffset:0};de.positionedLines[qt]=or;const On=or.positionedGlyphs;let sr=0;if(!Yt.length()){Vt+=Te,++qt;continue}let Cr=0,di=0;for(let Zt=0;Zt<Yt.length();Zt++){const Mr=Yt.getSection(Zt),ns=Yt.getSectionIndex(Zt),br=Yt.getCharCode(Zt);let un=Mr.scale,dr=null,kn=null,pi=null,ar=24,Lr=0;const fi=!(Pe===ci.horizontal||!Ye&&!Ie(br)||Ye&&(Yu[br]||(Xn=br,o(Xn)||c(Xn)||m(Xn)||ae(Xn)||Le(Xn))));if(Mr.imageName){const zr=$e[Mr.imageName];if(!zr)continue;pi=Mr.imageName,de.iconsInText=de.iconsInText||!0,kn=zr.paddedRect;const wr=zr.displaySize;un=24*un/zt,dr={width:wr[0],height:wr[1],left:1,top:-3,advance:fi?wr[1]:wr[0],localGlyph:!1},Lr=Jt?-dr.height*un:24*Ot-17-wr[1]*un,ar=dr.advance;const rs=(fi?wr[0]:wr[1])*un-24*Ot;rs>0&&rs>sr&&(sr=rs)}else{const zr=we[Mr.fontStack];if(!zr)continue;zr[br]&&(kn=zr[br]);const wr=De[Mr.fontStack];if(!wr)continue;const rs=wr.glyphs[br];if(!rs)continue;if(dr=rs.metrics,ar=8203!==br?24:0,Jt){const Qc=void 0!==wr.ascender?Math.abs(wr.ascender):0,hh=void 0!==wr.descender?Math.abs(wr.descender):0,dh=(Qc+hh)*un;Cr<dh&&(Cr=dh,di=(Qc-hh)/2*un),Lr=-Qc*un}else Lr=24*(Ot-un)-17}fi?(de.verticalizable=!0,On.push({glyph:br,imageName:pi,x:pn,y:Vt+Lr,vertical:fi,scale:un,localGlyph:dr.localGlyph,fontStack:Mr.fontStack,sectionIndex:ns,metrics:dr,rect:kn}),pn+=ar*un+We):(On.push({glyph:br,imageName:pi,x:pn,y:Vt+Lr,vertical:fi,scale:un,localGlyph:dr.localGlyph,fontStack:Mr.fontStack,sectionIndex:ns,metrics:dr,rect:kn}),pn+=dr.advance*un+We)}0!==On.length&&(jt=Math.max(pn-We,jt),Jt?Wc(On,Ne,sr,di,Te*Ot/2):Wc(On,Ne,sr,0,Te/2)),pn=0;const Hi=Te*Ot+sr;or.lineOffset=Math.max(sr,zn),Vt+=Hi,++qt}var Xn;const Ln=Vt,{horizontalAlign:Tr,verticalAlign:Rr}=eh(Ve);(function(Yt,Ot,zn,or,On,sr){const Cr=(Ot-zn)*On,di=-sr*or;for(const Hi of Yt)for(const Zt of Hi.positionedGlyphs)Zt.x+=Cr,Zt.y+=di})(de.positionedLines,Ne,Tr,Rr,jt,Ln),de.top+=-Rr*Ln,de.bottom=de.top+Ln,de.left+=-Tr*jt,de.right=de.left+jt,de.hasBaseline=Jt}(pe,e,s,l,J,_,v,w,S,D,A,U),!function(de){for(const De of de)if(0!==De.positionedGlyphs.length)return!1;return!0}(he)&&pe}const Yu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Pp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function kp(i,e,s,l,u,p){if(e.imageName){const _=l[e.imageName];return _?_.displaySize[0]*e.scale*24/p+u:0}{const _=s[e.fontStack],v=_&&_.glyphs[i];return v?v.metrics.advance*e.scale+u:0}}function Qu(i,e,s,l){const u=Math.pow(i-e,2);return l?i<e?u/2:2*u:u+Math.abs(s)*s}function nd(i,e,s){let l=0;return 10===i&&(l-=1e4),s&&(l+=150),40!==i&&65288!==i||(l+=50),41!==e&&65289!==e||(l+=50),l}function Fp(i,e,s,l,u,p){let _=null,v=Qu(e,s,u,p);for(const w of l){const D=Qu(e-w.x,s,u,p)+w.badness;D<=v&&(_=w,v=D)}return{index:i,x:e,priorBreak:_,badness:v}}function rd(i){return i?rd(i.priorBreak).concat(i.index):[]}function id(i,e,s,l,u,p,_){if("point"!==p)return[];if(!i)return[];const v=[],w=function(A,z,N,U,q,J){let ie=0;for(let ce=0;ce<A.length();ce++){const he=A.getSection(ce);ie+=kp(A.getCharCode(ce),he,U,q,z,J)}return ie/Math.max(1,Math.ceil(ie/N))}(i,e,s,l,u,_),D=i.text.indexOf("\u200b")>=0;let M=0;for(let A=0;A<i.length();A++){const z=i.getSection(A),N=i.getCharCode(A);if(Yu[N]||(M+=kp(N,z,l,u,e,_)),A<i.length()-1){const U=!((S=N)<11904||!(O(S)||R(S)||xe(S)||re(S)||W(S)||y(S)||j(S)||C(S)||se(S)||G(S)||H(S)||ke(S)||P(S)||E(S)||x(S)||Z(S)||F(S)||_e(S)||Q(S)||ne(S)));(Pp[N]||U||z.imageName)&&v.push(Fp(A+1,M,w,v,nd(N,i.getCharCode(A+1),U&&D),!1))}}var S;return rd(Fp(i.length(),M,w,v,0,!0))}function eh(i){let e=.5,s=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function Wc(i,e,s,l,u){if(!(e||s||l||u))return;const p=i.length-1,_=i[p],v=(_.x+_.metrics.advance*_.scale)*e;for(let w=0;w<=p;w++)i[w].x-=v,i[w].y+=s+l+u}function P_(i,e,s){const{horizontalAlign:l,verticalAlign:u}=eh(s),p=e[0]-i.displaySize[0]*l,_=e[1]-i.displaySize[1]*u;return{image:i,top:_,bottom:_+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function Rp(i,e,s,l,u,p){const _=i.image;let v;if(_.content){const q=_.content,J=_.pixelRatio||1;v=[q[0]/J,q[1]/J,_.displaySize[0]-q[2]/J,_.displaySize[1]-q[3]/J]}const w=e.left*p,D=e.right*p;let M,S,A,z;"width"===s||"both"===s?(z=u[0]+w-l[3],S=u[0]+D+l[1]):(z=u[0]+(w+D-_.displaySize[0])/2,S=z+_.displaySize[0]);const N=e.top*p,U=e.bottom*p;return"height"===s||"both"===s?(M=u[1]+N-l[0],A=u[1]+U+l[2]):(M=u[1]+(N+U-_.displaySize[1])/2,A=M+_.displaySize[1]),{image:_,top:M,right:S,bottom:A,left:z,collisionPadding:v}}class ha extends Ke{constructor(e,s,l,u,p){super(e,s),this.angle=u,this.z=l,void 0!==p&&(this.segment=p)}clone(){return new ha(this.x,this.y,this.z,this.angle,this.segment)}}function Mm(i,e,s,l,u){if(void 0===e.segment)return!0;let p=e,_=e.segment+1,v=0;for(;v>-s/2;){if(_--,_<0)return!1;v-=i[_].dist(p),p=i[_]}v+=i[_].dist(i[_+1]),_++;const w=[];let D=0;for(;v<s/2;){const M=i[_],S=i[_+1];if(!S)return!1;let A=i[_-1].angleTo(M)-M.angleTo(S);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:A}),D+=A;v-w[0].distance>l;)D-=w.shift().angleDelta;if(D>u)return!1;_++,v+=M.dist(S)}return!0}function Lp(i){let e=0;for(let s=0;s<i.length-1;s++)e+=i[s].dist(i[s+1]);return e}function od(i,e,s){return i?.6*e*s:0}function zp(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Pv(i,e,s,l,u,p){const _=od(s,u,p),v=zp(s,l)*p;let w=0;const D=Lp(i)/2;for(let M=0;M<i.length-1;M++){const S=i[M],A=i[M+1],z=S.dist(A);if(w+z>D){const N=(D-w)/z,U=Rt(S.x,A.x,N),q=Rt(S.y,A.y,N),J=new ha(U,q,0,A.angleTo(S),M);return!_||Mm(i,J,v,_,e)?J:void 0}w+=z}}function Im(i,e,s,l,u,p,_,v,w){const D=od(l,p,_),M=zp(l,u),S=M*_,A=0===i[0].x||i[0].x===w||0===i[0].y||i[0].y===w;return e-S<e/4&&(e=S+e/4),Sm(i,A?e/2*v%e:(M/2+2*p)*_*v%e,e,D,s,S,A,!1,w)}function Sm(i,e,s,l,u,p,_,v,w){const D=p/2,M=Lp(i);let S=0,A=e-s,z=[];for(let N=0;N<i.length-1;N++){const U=i[N],q=i[N+1],J=U.dist(q),ie=q.angleTo(U);for(;A+s<S+J;){A+=s;const ce=(A-S)/J,he=Rt(U.x,q.x,ce),pe=Rt(U.y,q.y,ce);if(he>=0&&he<w&&pe>=0&&pe<w&&A-D>=0&&A+D<=M){const de=new ha(he,pe,0,ie,N);de._round(),l&&!Mm(i,de,p,l,u)||z.push(de)}}S+=J}return v||z.length||_||(z=Sm(i,S/2,s,l,u,p,_,!0,w)),z}function Op(i,e,s,l,u){const p=[];for(let _=0;_<i.length;_++){const v=i[_];let w;for(let D=0;D<v.length-1;D++){let M=v[D],S=v[D+1];M.x<e&&S.x<e||(M.x<e?M=new Ke(e,M.y+(e-M.x)/(S.x-M.x)*(S.y-M.y))._round():S.x<e&&(S=new Ke(e,M.y+(e-M.x)/(S.x-M.x)*(S.y-M.y))._round()),M.y<s&&S.y<s||(M.y<s?M=new Ke(M.x+(s-M.y)/(S.y-M.y)*(S.x-M.x),s)._round():S.y<s&&(S=new Ke(M.x+(s-M.y)/(S.y-M.y)*(S.x-M.x),s)._round()),M.x>=l&&S.x>=l||(M.x>=l?M=new Ke(l,M.y+(l-M.x)/(S.x-M.x)*(S.y-M.y))._round():S.x>=l&&(S=new Ke(l,M.y+(l-M.x)/(S.x-M.x)*(S.y-M.y))._round()),M.y>=u&&S.y>=u||(M.y>=u?M=new Ke(M.x+(u-M.y)/(S.y-M.y)*(S.x-M.x),u)._round():S.y>=u&&(S=new Ke(M.x+(u-M.y)/(S.y-M.y)*(S.x-M.x),u)._round()),w&&M.equals(w[w.length-1])||(w=[M],p.push(w)),w.push(S)))))}}return p}Xe("Anchor",ha);const th=1e20;function Am(i,e,s,l,u,p,_,v,w){for(let D=e;D<e+l;D++)bo(i,s*p+D,p,u,_,v,w);for(let D=s;D<s+u;D++)bo(i,D*p+e,1,l,_,v,w)}function bo(i,e,s,l,u,p,_){p[0]=0,_[0]=-th,_[1]=th,u[0]=i[e];for(let v=1,w=0,D=0;v<l;v++){u[v]=i[e+v*s];const M=v*v;do{const S=p[w];D=(u[v]-u[S]+M-S*S)/(v-S)/2}while(D<=_[w]&&--w>-1);w++,p[w]=v,_[w]=D,_[w+1]=th}for(let v=0,w=0;v<l;v++){for(;_[w+1]<v;)w++;const D=p[w],M=v-D;i[e+v*s]=u[D]+M*M}}const Bp={none:0,ideographs:1,all:2};class Gl{constructor(e,s,l){this.requestManager=e,this.localGlyphMode=s,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,s){const l=[];for(const u in e)for(const p of e[u])l.push({stack:u,id:p});Ca(l,({stack:u,id:p},_)=>{let v=this.entries[u];v||(v=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=v.glyphs[p];if(void 0!==w)return void _(null,{stack:u,id:p,glyph:w});if(w=this._tinySDF(v,u,p),w)return v.glyphs[p]=w,void _(null,{stack:u,id:p,glyph:w});const D=Math.floor(p/256);if(256*D>65535)return void _(new Error("glyphs > 65535 not supported"));if(v.ranges[D])return void _(null,{stack:u,id:p,glyph:w});let M=v.requests[D];M||(M=v.requests[D]=[],Gl.loadGlyphRange(u,D,this.url,this.requestManager,(S,A)=>{if(A){v.ascender=A.ascender,v.descender=A.descender;for(const z in A.glyphs)this._doesCharSupportLocalGlyph(+z)||(v.glyphs[+z]=A.glyphs[+z]);v.ranges[D]=!0}for(const z of M)z(S,A);delete v.requests[D]})),M.push((S,A)=>{S?_(S):A&&_(null,{stack:u,id:p,glyph:A.glyphs[p]||null})})},(u,p)=>{if(u)s(u);else if(p){const _={};for(const{stack:v,id:w,glyph:D}of p)void 0===_[v]&&(_[v]={}),void 0===_[v].glyphs&&(_[v].glyphs={}),_[v].glyphs[w]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},_[v].ascender=this.entries[v].ascender,_[v].descender=this.entries[v].descender;s(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Bp.none&&(this.localGlyphMode===Bp.all?!!this.localFontFamily:!!this.localFontFamily&&(G(e)||te(e)||P(e)||F(e))||C(e))}_tinySDF(e,s,l){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let p=e.tinySDF;if(!p){let U="400";/bold/i.test(s)?U="900":/medium/i.test(s)?U="500":/light/i.test(s)&&(U="200"),p=e.tinySDF=new Gl.TinySDF({fontFamily:u,fontWeight:U,fontSize:48,buffer:6,radius:16}),p.fontWeight=U}if(this.localGlyphs[p.fontWeight][l])return this.localGlyphs[p.fontWeight][l];const _=String.fromCharCode(l),{data:v,width:w,height:D,glyphWidth:M,glyphHeight:S,glyphLeft:A,glyphTop:z,glyphAdvance:N}=p.draw(_);return this.localGlyphs[p.fontWeight][l]={id:l,bitmap:new Bl({width:w,height:D},v),metrics:{width:M/2,height:S/2,left:A/2,top:z/2-27,advance:N/2,localGlyph:!0}}}}function Pm(i,e,s,l){const u=[],p=i.image,_=p.pixelRatio,v=p.paddedRect.w-2,w=p.paddedRect.h-2,D=i.right-i.left,M=i.bottom-i.top,S=p.stretchX||[[0,v]],A=p.stretchY||[[0,w]],z=(Te,Ve)=>Te+Ve[1]-Ve[0],N=S.reduce(z,0),U=A.reduce(z,0),q=v-N,J=w-U;let ie=0,ce=N,he=0,pe=U,de=0,De=q,we=0,$e=J;if(p.content&&l){const Te=p.content;ie=sd(S,0,Te[0]),he=sd(A,0,Te[1]),ce=sd(S,Te[0],Te[2]),pe=sd(A,Te[1],Te[3]),de=Te[0]-ie,we=Te[1]-he,De=Te[2]-Te[0]-ce,$e=Te[3]-Te[1]-pe}const Be=(Te,Ve,Ze,Pe)=>{const We=ad(Te.stretch-ie,ce,D,i.left),Ye=nh(Te.fixed-de,De,Te.stretch,N),zt=ad(Ve.stretch-he,pe,M,i.top),pn=nh(Ve.fixed-we,$e,Ve.stretch,U),Vt=ad(Ze.stretch-ie,ce,D,i.left),jt=nh(Ze.fixed-de,De,Ze.stretch,N),Ne=ad(Pe.stretch-he,pe,M,i.top),Jt=nh(Pe.fixed-we,$e,Pe.stretch,U),qt=new Ke(We,zt),Xn=new Ke(Vt,zt),Ln=new Ke(Vt,Ne),Tr=new Ke(We,Ne),Rr=new Ke(Ye/_,pn/_),Yt=new Ke(jt/_,Jt/_),Ot=e*Math.PI/180;if(Ot){const On=Math.sin(Ot),sr=Math.cos(Ot),Cr=[sr,-On,On,sr];qt._matMult(Cr),Xn._matMult(Cr),Tr._matMult(Cr),Ln._matMult(Cr)}const zn=Te.stretch+Te.fixed,or=Ve.stretch+Ve.fixed;return{tl:qt,tr:Xn,bl:Tr,br:Ln,tex:{x:p.paddedRect.x+1+zn,y:p.paddedRect.y+1+or,w:Ze.stretch+Ze.fixed-zn,h:Pe.stretch+Pe.fixed-or},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Rr,pixelOffsetBR:Yt,minFontScaleX:De/_/D,minFontScaleY:$e/_/M,isSDF:s}};if(l&&(p.stretchX||p.stretchY)){const Te=km(S,q,N),Ve=km(A,J,U);for(let Ze=0;Ze<Te.length-1;Ze++){const Pe=Te[Ze],We=Te[Ze+1];for(let Ye=0;Ye<Ve.length-1;Ye++)u.push(Be(Pe,Ve[Ye],We,Ve[Ye+1]))}}else u.push(Be({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return u}function sd(i,e,s){let l=0;for(const u of i)l+=Math.max(e,Math.min(s,u[1]))-Math.max(e,Math.min(s,u[0]));return l}function km(i,e,s){const l=[{fixed:-1,stretch:0}];for(const[u,p]of i){const _=l[l.length-1];l.push({fixed:u-_.stretch,stretch:_.stretch}),l.push({fixed:u-_.stretch,stretch:_.stretch+(p-u)})}return l.push({fixed:e+1,stretch:s}),l}function ad(i,e,s,l){return i/e*s+l}function nh(i,e,s,l){return i-e*s/l}function k_(i,e,s,l){const u=e+i.positionedLines[l].lineOffset;return 0===l?s+u/2:s+(u+(e+i.positionedLines[l-1].lineOffset))/2}Gl.loadGlyphRange=function(i,e,s,l,u){const p=256*e,_=p+255,v=l.transformRequest(l.normalizeGlyphsURL(s).replace("{fontstack}",i).replace("{range}",`${p}-${_}`),Sa.Glyphs);Aa(v,(w,D)=>{if(w)u(w);else if(D){const M={},S=new Vl(D).readFields(Dm,{});for(const A of S.glyphs)M[A.id]=A;u(null,{glyphs:M,ascender:S.ascender,descender:S.descender})}})},Gl.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:s=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:_="normal"}){this.buffer=e,this.cutoff=l,this.radius=s;const v=this.size=i+4*e,w=this._createCanvas(v),D=this.ctx=w.getContext("2d",{willReadFrequently:!0});D.font=`${_} ${p} ${i}px ${u}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(i),_=Math.floor(s),v=Math.min(this.size-this.buffer,Math.ceil(p-u)),w=Math.min(this.size-this.buffer,Math.ceil(s)+Math.ceil(l)),D=v+2*this.buffer,M=w+2*this.buffer,S=D*M,A=new Uint8ClampedArray(S),z={data:A,width:D,height:M,glyphWidth:v,glyphHeight:w,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(0===v||0===w)return z;const{ctx:N,buffer:U,gridInner:q,gridOuter:J}=this;N.clearRect(U,U,v,w),N.fillText(i,U,U+_+1);const ie=N.getImageData(U,U,v,w);J.fill(th,0,S),q.fill(0,0,S);for(let ce=0;ce<w;ce++)for(let he=0;he<v;he++){const pe=ie.data[4*(ce*v+he)+3]/255;if(0===pe)continue;const de=(ce+U)*D+he+U;if(1===pe)J[de]=0,q[de]=th;else{const De=.5-pe;J[de]=De>0?De*De:0,q[de]=De<0?De*De:0}}Am(J,0,0,D,M,D,this.f,this.v,this.z),Am(q,U,U,v,w,D,this.f,this.v,this.z);for(let ce=0;ce<S;ce++){const he=Math.sqrt(J[ce])-Math.sqrt(q[ce]);A[ce]=Math.round(255-255*(he/this.radius+this.cutoff))}return z}};class F_{constructor(e=[],s=R_){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:s,compare:l}=this,u=s[e];for(;e>0;){const p=e-1>>1,_=s[p];if(l(u,_)>=0)break;s[e]=_,e=p}s[e]=u}_down(e){const{data:s,compare:l}=this,u=this.length>>1,p=s[e];for(;e<u;){let _=1+(e<<1),v=s[_];const w=_+1;if(w<this.length&&l(s[w],v)<0&&(_=w,v=s[w]),l(v,p)>=0)break;s[e]=v,e=_}s[e]=p}}function R_(i,e){return i<e?-1:i>e?1:0}function Mt(i,e=1,s=!1){let l=1/0,u=1/0,p=-1/0,_=-1/0;const v=i[0];for(let z=0;z<v.length;z++){const N=v[z];(!z||N.x<l)&&(l=N.x),(!z||N.y<u)&&(u=N.y),(!z||N.x>p)&&(p=N.x),(!z||N.y>_)&&(_=N.y)}const w=Math.min(p-l,_-u);let D=w/2;const M=new F_([],wo);if(0===w)return new Ke(l,u);for(let z=l;z<p;z+=w)for(let N=u;N<_;N+=w)M.push(new Hl(z+D,N+D,D,i));let S=function(z){let N=0,U=0,q=0;const J=z[0];for(let ie=0,ce=J.length,he=ce-1;ie<ce;he=ie++){const pe=J[ie],de=J[he],De=pe.x*de.y-de.x*pe.y;U+=(pe.x+de.x)*De,q+=(pe.y+de.y)*De,N+=3*De}return new Hl(U/N,q/N,0,z)}(i),A=M.length;for(;M.length;){const z=M.pop();(z.d>S.d||!S.d)&&(S=z,s&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,A)),z.max-S.d<=e||(D=z.h/2,M.push(new Hl(z.p.x-D,z.p.y-D,D,i)),M.push(new Hl(z.p.x+D,z.p.y-D,D,i)),M.push(new Hl(z.p.x-D,z.p.y+D,D,i)),M.push(new Hl(z.p.x+D,z.p.y+D,D,i)),A+=4)}return s&&(console.log(`num probes: ${A}`),console.log(`best distance: ${S.d}`)),S.p}function wo(i,e){return e.max-i.max}function Hl(i,e,s,l){this.p=new Ke(i,e),this.h=s,this.d=function(u,p){let _=!1,v=1/0;for(let w=0;w<p.length;w++){const D=p[w];for(let M=0,S=D.length,A=S-1;M<S;A=M++){const z=D[M],N=D[A];z.y>u.y!=N.y>u.y&&u.x<(N.x-z.x)*(u.y-z.y)/(N.y-z.y)+z.x&&(_=!_),v=Math.min(v,Ol(u,z,N))}}return(_?1:-1)*Math.sqrt(v)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}const ld=Number.POSITIVE_INFINITY,cd=Math.sqrt(2);function Eo(i,e){return e[1]!==ld?function(s,l,u){let p=0,_=0;switch(l=Math.abs(l),u=Math.abs(u),s){case"top-right":case"top-left":case"top":_=u-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-u}switch(s){case"top-right":case"bottom-right":case"right":p=-l;break;case"top-left":case"bottom-left":case"left":p=l}return[p,_]}(i,e[0],e[1]):function(s,l){let u=0,p=0;l<0&&(l=0);const _=l/cd;switch(s){case"top-right":case"top-left":p=_-7;break;case"bottom-right":case"bottom-left":p=7-_;break;case"bottom":p=7-l;break;case"top":p=l-7}switch(s){case"top-right":case"bottom-right":u=-_;break;case"top-left":case"bottom-left":u=_;break;case"left":u=l;break;case"right":u=-l}return[u,p]}(i,e[0])}function Fm(i,e,s,l,u,p,_,v,w,D){i.createArrays(),i.tilePixelRatio=Pt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const M=i.layers[0].layout,S=i.layers[0]._unevaluatedLayout._values,A={};if("composite"===i.textSizeData.kind){const{minZoom:U,maxZoom:q}=i.textSizeData;A.compositeTextSizes=[S["text-size"].possiblyEvaluate(new pt(U),v),S["text-size"].possiblyEvaluate(new pt(q),v)]}if("composite"===i.iconSizeData.kind){const{minZoom:U,maxZoom:q}=i.iconSizeData;A.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new pt(U),v),S["icon-size"].possiblyEvaluate(new pt(q),v)]}A.layoutTextSize=S["text-size"].possiblyEvaluate(new pt(w+1),v),A.layoutIconSize=S["icon-size"].possiblyEvaluate(new pt(w+1),v),A.textMaxSize=S["text-size"].possiblyEvaluate(new pt(18),v);const z="map"===M.get("text-rotation-alignment")&&"point"!==M.get("symbol-placement"),N=M.get("text-size");for(const U of i.features){const q=M.get("text-font").evaluate(U,{},v).join(","),J=N.evaluate(U,{},v),ie=A.layoutTextSize.evaluate(U,{},v),ce=(A.layoutIconSize.evaluate(U,{},v),{horizontal:{},vertical:void 0}),he=U.text;let pe,de=[0,0];if(he){const $e=he.toString(),Be=24*M.get("text-letter-spacing").evaluate(U,{},v),Te=24*M.get("text-line-height").evaluate(U,{},v),Ve=ve($e)?Be:0,Ze=M.get("text-anchor").evaluate(U,{},v),Pe=M.get("text-variable-anchor");if(!Pe){const jt=M.get("text-radial-offset").evaluate(U,{},v);de=jt?Eo(Ze,[24*jt,ld]):M.get("text-offset").evaluate(U,{},v).map(Ne=>24*Ne)}let We=z?"center":M.get("text-justify").evaluate(U,{},v);const Ye=M.get("symbol-placement"),zt="point"===Ye,pn="point"===Ye?24*M.get("text-max-width").evaluate(U,{},v):0,Vt=jt=>{i.allowVerticalPlacement&&be($e)&&(ce.vertical=td(he,e,s,u,q,pn,Te,Ze,jt,Ve,de,ci.vertical,!0,Ye,ie,J))};if(!z&&Pe){const jt="auto"===We?Pe.map(Jt=>Np(Jt)):[We];let Ne=!1;for(let Jt=0;Jt<jt.length;Jt++){const qt=jt[Jt];if(!ce.horizontal[qt])if(Ne)ce.horizontal[qt]=ce.horizontal[0];else{const Xn=td(he,e,s,u,q,pn,Te,"center",qt,Ve,de,ci.horizontal,!1,Ye,ie,J);Xn&&(ce.horizontal[qt]=Xn,Ne=1===Xn.positionedLines.length)}}Vt("left")}else{if("auto"===We&&(We=Np(Ze)),zt||M.get("text-writing-mode").indexOf("horizontal")>=0||!be($e)){const jt=td(he,e,s,u,q,pn,Te,Ze,We,Ve,de,ci.horizontal,!1,Ye,ie,J);jt&&(ce.horizontal[We]=jt)}Vt("point"===Ye?"left":We)}}let De=!1;if(U.icon&&U.icon.name){const $e=l[U.icon.name];$e&&(pe=P_(u[U.icon.name],M.get("icon-offset").evaluate(U,{},v),M.get("icon-anchor").evaluate(U,{},v)),De=$e.sdf,void 0===i.sdfIcons?i.sdfIcons=$e.sdf:i.sdfIcons!==$e.sdf&&Mn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),($e.pixelRatio!==i.pixelRatio||0!==M.get("icon-rotate").constantOr(1))&&(i.iconsNeedLinear=!0))}const we=jp(ce.horizontal)||ce.vertical;i.iconsInText||(i.iconsInText=!!we&&we.iconsInText),(we||pe)&&Vp(i,U,ce,pe,l,A,ie,0,de,De,_,v,D)}p&&i.generateCollisionDebugBuffers(w,i.collisionBoxArray)}function Np(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Vp(i,e,s,l,u,p,_,v,w,D,M,S,A){let z=p.textMaxSize.evaluate(e,{},S);void 0===z&&(z=_);const N=i.layers[0].layout,U=N.get("icon-offset").evaluate(e,{},S),q=jp(s.horizontal)||s.vertical,J=_/24,ie=i.tilePixelRatio*z/24,ce=i.tilePixelRatio*N.get("symbol-spacing"),he=N.get("text-padding")*i.tilePixelRatio,pe=N.get("icon-padding")*i.tilePixelRatio,de=Ft(N.get("text-max-angle")),De="map"===N.get("text-rotation-alignment")&&"point"!==N.get("symbol-placement"),we="map"===N.get("icon-rotation-alignment")&&"point"!==N.get("symbol-placement"),$e=N.get("symbol-placement"),Be=ce/2,Te=N.get("icon-text-fit");let Ve;l&&"none"!==Te&&(i.allowVerticalPlacement&&s.vertical&&(Ve=Rp(l,s.vertical,Te,N.get("icon-text-fit-padding"),U,J)),q&&(l=Rp(l,q,Te,N.get("icon-text-fit-padding"),U,J)));const Ze=(Pe,We,Ye)=>{if(We.x<0||We.x>=Pt||We.y<0||We.y>=Pt)return;const{x:zt,y:pn,z:Vt}=A.projectTilePoint(We.x,We.y,Ye),jt=new ha(zt,pn,Vt,0,void 0);!function(Ne,Jt,qt,Xn,Ln,Tr,Rr,Yt,Ot,zn,or,On,sr,Cr,di,Hi,Zt,Mr,ns,br,un,dr,kn,pi,ar){const Lr=Ne.addToLineVertexArray(Jt,Xn);let fi,zr,wr,rs,Qc,hh,dh,Jm=0,ph=0,tc=0,Ym=0,nc=-1,pf=-1;const Ts={};let Dd=Lu(""),Co=0,rc=0;if(void 0===Ot._unevaluatedLayout.getValue("text-radial-offset")?[Co,rc]=Ot.layout.get("text-offset").evaluate(un,{},ar).map(Vn=>24*Vn):(Co=24*Ot.layout.get("text-radial-offset").evaluate(un,{},ar),rc=ld),Ne.allowVerticalPlacement&&Ln.vertical){const Vn=Ln.vertical;if(di)hh=Rm(Vn),Yt&&(dh=Rm(Yt));else{const Ii=Ot.layout.get("text-rotate").evaluate(un,{},ar)+90;wr=Xc(zn,qt,Jt,or,On,sr,Vn,Cr,Ii,Hi),Yt&&(rs=Xc(zn,qt,Jt,or,On,sr,Yt,Mr,Ii))}}if(Tr){const Vn=Ot.layout.get("icon-rotate").evaluate(un,{},ar),Ii="none"!==Ot.layout.get("icon-text-fit"),Cs=Pm(Tr,Vn,kn,Ii),rl=Yt?Pm(Yt,Vn,kn,Ii):void 0;zr=Xc(zn,qt,Jt,or,On,sr,Tr,Mr,Vn),Jm=4*Cs.length;const ic=Ne.iconSizeData;let Mo=null;"source"===ic.kind?(Mo=[es*Ot.layout.get("icon-size").evaluate(un,{},ar)],Mo[0]>ui&&Mn(`${Ne.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===ic.kind&&(Mo=[es*dr.compositeIconSizes[0].evaluate(un,{},ar),es*dr.compositeIconSizes[1].evaluate(un,{},ar)],(Mo[0]>ui||Mo[1]>ui)&&Mn(`${Ne.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ne.addSymbols(Ne.icon,Cs,Mo,br,ns,un,!1,qt,Jt,Lr.lineStartIndex,Lr.lineLength,-1,pi,ar),nc=Ne.icon.placedSymbolArray.length-1,rl&&(ph=4*rl.length,Ne.addSymbols(Ne.icon,rl,Mo,br,ns,un,ci.vertical,qt,Jt,Lr.lineStartIndex,Lr.lineLength,-1,pi,ar),pf=Ne.icon.placedSymbolArray.length-1)}for(const Vn in Ln.horizontal){const Ii=Ln.horizontal[Vn];fi||(Dd=Lu(Ii.text),di?Qc=Rm(Ii):fi=Xc(zn,qt,Jt,or,On,sr,Ii,Cr,Ot.layout.get("text-rotate").evaluate(un,{},ar),Hi));const Cs=1===Ii.positionedLines.length;if(tc+=ud(Ne,qt,Jt,Ii,Rr,Ot,di,un,Hi,Lr,Ln.vertical?ci.horizontal:ci.horizontalOnly,Cs?Object.keys(Ln.horizontal):[Vn],Ts,nc,dr,pi,ar),Cs)break}Ln.vertical&&(Ym+=ud(Ne,qt,Jt,Ln.vertical,Rr,Ot,di,un,Hi,Lr,ci.vertical,["vertical"],Ts,pf,dr,pi,ar));let Kn=-1;const fa=(Vn,Ii)=>Vn?Math.max(Vn,Ii):Ii;Kn=fa(Qc,Kn),Kn=fa(hh,Kn),Kn=fa(dh,Kn);const Td=Kn>-1?1:0;Ne.glyphOffsetArray.length>=Ja.MAX_GLYPHS&&Mn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==un.sortKey&&Ne.addToSortKeyRanges(Ne.symbolInstances.length,un.sortKey),Ne.symbolInstances.emplaceBack(qt.x,qt.y,qt.z,Jt.x,Jt.y,Ts.right>=0?Ts.right:-1,Ts.center>=0?Ts.center:-1,Ts.left>=0?Ts.left:-1,Ts.vertical>=0?Ts.vertical:-1,nc,pf,Dd,void 0!==fi?fi:Ne.collisionBoxArray.length,void 0!==fi?fi+1:Ne.collisionBoxArray.length,void 0!==wr?wr:Ne.collisionBoxArray.length,void 0!==wr?wr+1:Ne.collisionBoxArray.length,void 0!==zr?zr:Ne.collisionBoxArray.length,void 0!==zr?zr+1:Ne.collisionBoxArray.length,rs||Ne.collisionBoxArray.length,rs?rs+1:Ne.collisionBoxArray.length,or,tc,Ym,Jm,ph,Td,0,Co,rc,Kn)}(i,We,jt,Pe,s,l,u,Ve,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,he,De,w,0,pe,we,U,e,p,D,M,S)};if("line"===$e)for(const Pe of Op(e.geometry,0,0,Pt,Pt)){const We=Im(Pe,ce,de,s.vertical||q,l,24,ie,i.overscaling,Pt);for(const Ye of We){const zt=q;zt&&Lm(i,zt.text,Be,Ye)||Ze(Pe,Ye,S)}}else if("line-center"===$e){for(const Pe of e.geometry)if(Pe.length>1){const We=Pv(Pe,de,s.vertical||q,l,24,ie);We&&Ze(Pe,We,S)}}else if("Polygon"===e.type)for(const Pe of bp(e.geometry,0)){const We=Mt(Pe,16);Ze(Pe[0],new ha(We.x,We.y,0,0,void 0),S)}else if("LineString"===e.type)for(const Pe of e.geometry)Ze(Pe,new ha(Pe[0].x,Pe[0].y,0,0,void 0),S);else if("Point"===e.type)for(const Pe of e.geometry)for(const We of Pe)Ze([We],new ha(We.x,We.y,0,0,void 0),S)}const ui=32640;function ud(i,e,s,l,u,p,_,v,w,D,M,S,A,z,N,U,q){const J=function(he,pe,de,De,we,$e,Be,Te){const Ve=[];if(0===pe.positionedLines.length)return Ve;const Ze=De.layout.get("text-rotate").evaluate($e,{})*Math.PI/180,Pe=function(Vt){const jt=Vt[0],Ne=Vt[1],Jt=jt*Ne;return Jt>0?[jt,-Ne]:Jt<0?[-jt,Ne]:0===jt?[Ne,jt]:[Ne,-jt]}(de);let We=Math.abs(pe.top-pe.bottom);for(const Vt of pe.positionedLines)We-=Vt.lineOffset;const Ye=pe.positionedLines.length,zt=We/Ye;let pn=pe.top-de[1];for(let Vt=0;Vt<Ye;++Vt){const jt=pe.positionedLines[Vt];pn=k_(pe,zt,pn,Vt);for(const Ne of jt.positionedGlyphs){if(!Ne.rect)continue;const Jt=Ne.rect||{};let qt=4,Xn=!0,Ln=1,Tr=0;if(Ne.imageName){const kn=Be[Ne.imageName];if(!kn)continue;if(kn.sdf){Mn("SDF images are not supported in formatted text and will be ignored.");continue}Xn=!1,Ln=kn.pixelRatio,qt=1/Ln}const Rr=(we||Te)&&Ne.vertical,Yt=Ne.metrics.advance*Ne.scale/2,Ot=Ne.metrics,zn=Ne.rect;if(null===zn)continue;Te&&pe.verticalizable&&(Tr=Ne.imageName?Yt-Ne.metrics.width*Ne.scale/2:0);const or=we?[Ne.x+Yt,Ne.y]:[0,0];let On=[0,0],sr=[0,0],Cr=!1;we||(Rr?(sr=[Ne.x+Yt+Pe[0],Ne.y+Pe[1]-Tr],Cr=!0):On=[Ne.x+Yt+de[0],Ne.y+de[1]-Tr]);const di=zn.w*Ne.scale/(Ln*(Ne.localGlyph?2:1)),Hi=zn.h*Ne.scale/(Ln*(Ne.localGlyph?2:1));let Zt,Mr,ns,br;if(Rr){const kn=Ne.y-pn,pi=new Ke(-Yt,Yt-kn),ar=-Math.PI/2,Lr=new Ke(...sr);Zt=new Ke(-Yt+On[0],On[1]),Zt._rotateAround(ar,pi)._add(Lr),Zt.x+=-kn+Yt,Zt.y-=(Ot.left-qt)*Ne.scale;const fi=Ne.imageName?Ot.advance*Ne.scale:24*Ne.scale,zr=String.fromCharCode(Ne.glyph);Ku(zr)?Zt.x+=(1-qt)*Ne.scale:vm(zr)?Zt.x+=fi-Ot.height*Ne.scale+(-qt-1)*Ne.scale:Zt.x+=Ne.imageName||Ot.width+2*qt===zn.w&&Ot.height+2*qt===zn.h?(fi-Hi)/2:(fi-(Ot.height+2*qt)*Ne.scale)/2,Mr=new Ke(Zt.x,Zt.y-di),ns=new Ke(Zt.x+Hi,Zt.y),br=new Ke(Zt.x+Hi,Zt.y-di)}else{const kn=(Ot.left-qt)*Ne.scale-Yt+On[0],pi=(-Ot.top-qt)*Ne.scale+On[1],ar=kn+di,Lr=pi+Hi;Zt=new Ke(kn,pi),Mr=new Ke(ar,pi),ns=new Ke(kn,Lr),br=new Ke(ar,Lr)}if(Ze){let kn;kn=we?new Ke(0,0):Cr?new Ke(Pe[0],Pe[1]):new Ke(de[0],de[1]),Zt._rotateAround(Ze,kn),Mr._rotateAround(Ze,kn),ns._rotateAround(Ze,kn),br._rotateAround(Ze,kn)}const un=new Ke(0,0),dr=new Ke(0,0);Ve.push({tl:Zt,tr:Mr,bl:ns,br,tex:Jt,writingMode:pe.writingMode,glyphOffset:or,sectionIndex:Ne.sectionIndex,isSDF:Xn,pixelOffsetTL:un,pixelOffsetBR:dr,minFontScaleX:0,minFontScaleY:0})}}return Ve}(0,l,w,p,_,v,u,i.allowVerticalPlacement),ie=i.textSizeData;let ce=null;"source"===ie.kind?(ce=[es*p.layout.get("text-size").evaluate(v,{},q)],ce[0]>ui&&Mn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ie.kind&&(ce=[es*N.compositeTextSizes[0].evaluate(v,{},q),es*N.compositeTextSizes[1].evaluate(v,{},q)],(ce[0]>ui||ce[1]>ui)&&Mn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,J,ce,w,_,v,M,e,s,D.lineStartIndex,D.lineLength,z,U,q);for(const he of S)A[he]=i.text.placedSymbolArray.length-1;return 4*J.length}function jp(i){for(const e in i)return i[e];return null}function Xc(i,e,s,l,u,p,_,v,w,D){let M=_.top,S=_.bottom,A=_.left,z=_.right;const N=_.collisionPadding;if(N&&(A-=N[0],M-=N[1],z+=N[2],S+=N[3]),w){const U=new Ke(A,M),q=new Ke(z,M),J=new Ke(A,S),ie=new Ke(z,S),ce=Ft(w);let he=new Ke(0,0);D&&(he=new Ke(D[0],D[1])),U._rotateAround(ce,he),q._rotateAround(ce,he),J._rotateAround(ce,he),ie._rotateAround(ce,he),A=Math.min(U.x,q.x,J.x,ie.x),z=Math.max(U.x,q.x,J.x,ie.x),M=Math.min(U.y,q.y,J.y,ie.y),S=Math.max(U.y,q.y,J.y,ie.y)}return i.emplaceBack(e.x,e.y,e.z,s.x,s.y,A,M,z,S,v,l,u,p),i.length-1}function Rm(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function Lm(i,e,s,l){const u=i.compareText;if(e in u){const p=u[e];for(let _=p.length-1;_>=0;_--)if(l.dist(p[_])<s)return!0}else u[e]=[];return u[e].push(l),!1}const kv=Xa.VectorTileFeature.types,hd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ql(i,e,s,l,u,p,_,v,w,D,M,S,A,z,N,U){const q=M?Math.min(ui,Math.round(M[0])):0,J=M?Math.min(ui,Math.round(M[1])):0;i.emplaceBack(e,s,Math.round(32*_),Math.round(32*v),w,D,(q<<1)+(S?1:0),J,16*A,16*z,256*N,256*U,l,u,p,0)}function rh(i,e,s){i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s)}function Up(i){for(const e of i.sections)if(je(e.text))return!0;return!1}class ih{constructor(e){this.layoutVertexArray=new $a,this.indexArray=new Fr,this.programConfigurations=e,this.segments=new ht,this.dynamicLayoutVertexArray=new Pc,this.opacityVertexArray=new rp,this.placedSymbolArray=new Fc}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,s,l,u){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,b_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,w_.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,hd,!0),this.opacityVertexBuffer.itemSize=1),(l||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Xe("SymbolBuffers",ih);class zm{constructor(e,s,l){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new l,this.segments=new ht,this.collisionVertexArray=new Ha,this.collisionVertexArrayExt=new Pc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,E_.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,$c.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Xe("CollisionBuffers",zm);class Ja{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ti([]),this.placementViewportMatrix=ti([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ym(this.zoom,s["text-size"]),this.iconSizeData=ym(this.zoom,s["icon-size"]);const l=this.layers[0].layout,u=l.get("symbol-sort-key"),p=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==p&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===p||"auto"===p&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(_=>ci[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID}createArrays(){this.text=new ih(new ca(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new ih(new ca(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Lh,this.lineVertexArray=new Rc,this.symbolInstances=new vr}calculateGlyphDependencies(e,s,l,u,p){for(let _=0;_<e.length;_++)if(s[e.charCodeAt(_)]=!0,u&&p){const v=Gc[e.charAt(_)];v&&(s[v.charCodeAt(0)]=!0)}}populate(e,s,l,u){const p=this.layers[0],_=p.layout,v=_.get("text-font"),w=_.get("text-field"),D=_.get("icon-image"),M=("constant"!==w.value.kind||w.value.value instanceof Et&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&("constant"!==v.value.kind||v.value.value.length>0),S="constant"!==D.value.kind||!!D.value.value||Object.keys(D.parameters).length>0,A=_.get("symbol-sort-key");if(this.features=[],!M&&!S)return;const z=s.iconDependencies,N=s.glyphDependencies,U=s.availableImages,q=new pt(this.zoom);for(const{feature:J,id:ie,index:ce,sourceLayerIndex:he}of e){const pe=p._featureFilter.needGeometry,de=zl(J,pe);if(!p._featureFilter.filter(q,de,l))continue;let De,we;if(pe||(de.geometry=ro(J,l,u)),M){const Be=p.getValueAndResolveTokens("text-field",de,l,U),Te=Et.factory(Be);Up(Te)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===qr()||this.hasRTLText&&Nt.isParsed())&&(De=D_(Te,p,de))}if(S){const Be=p.getValueAndResolveTokens("icon-image",de,l,U);we=Be instanceof lr?Be:lr.fromString(Be)}if(!De&&!we)continue;const $e=this.sortFeaturesByKey?A.evaluate(de,{},l):void 0;if(this.features.push({id:ie,text:De,icon:we,index:ce,sourceLayerIndex:he,geometry:de.geometry,properties:J.properties,type:kv[J.type],sortKey:$e}),we&&(z[we.name]=!0),De){const Be=v.evaluate(de,{},l).join(","),Te="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ci.vertical)>=0;for(const Ve of De.sections)if(Ve.image)z[Ve.image.name]=!0;else{const Ze=be(De.toString()),Pe=Ve.fontStack||Be,We=N[Pe]=N[Pe]||{};this.calculateGlyphDependencies(Ve.text,We,Te,this.allowVerticalPlacement,Ze)}}}"line"===_.get("symbol-placement")&&(this.features=function(J){const ie={},ce={},he=[];let pe=0;function de(Be){he.push(J[Be]),pe++}function De(Be,Te,Ve){const Ze=ce[Be];return delete ce[Be],ce[Te]=Ze,he[Ze].geometry[0].pop(),he[Ze].geometry[0]=he[Ze].geometry[0].concat(Ve[0]),Ze}function we(Be,Te,Ve){const Ze=ie[Te];return delete ie[Te],ie[Be]=Ze,he[Ze].geometry[0].shift(),he[Ze].geometry[0]=Ve[0].concat(he[Ze].geometry[0]),Ze}function $e(Be,Te,Ve){const Ze=Ve?Te[0][Te[0].length-1]:Te[0][0];return`${Be}:${Ze.x}:${Ze.y}`}for(let Be=0;Be<J.length;Be++){const Te=J[Be],Ve=Te.geometry,Ze=Te.text?Te.text.toString():null;if(!Ze){de(Be);continue}const Pe=$e(Ze,Ve),We=$e(Ze,Ve,!0);if(Pe in ce&&We in ie&&ce[Pe]!==ie[We]){const Ye=we(Pe,We,Ve),zt=De(Pe,We,he[Ye].geometry);delete ie[Pe],delete ce[We],ce[$e(Ze,he[zt].geometry,!0)]=zt,he[Ye].geometry=null}else Pe in ce?De(Pe,We,Ve):We in ie?we(Pe,We,Ve):(de(Be),ie[Pe]=pe-1,ce[We]=pe-1)}return he.filter(Be=>Be.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ie)=>J.sortKey-ie.sortKey)}update(e,s,l,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,s,this.layers,l,u),this.icon.programConfigurations.updatePaintArrays(e,s,this.layers,l,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){const l=this.lineVertexArray.length;if(void 0!==e.segment){let u=e.dist(s[e.segment+1]),p=e.dist(s[e.segment]);const _={};for(let v=e.segment+1;v<s.length;v++)_[v]={x:s[v].x,y:s[v].y,tileUnitDistanceFromAnchor:u},v<s.length-1&&(u+=s[v+1].dist(s[v]));for(let v=e.segment||0;v>=0;v--)_[v]={x:s[v].x,y:s[v].y,tileUnitDistanceFromAnchor:p},v>0&&(p+=s[v-1].dist(s[v]));for(let v=0;v<s.length;v++){const w=_[v];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,s,l,u,p,_,v,w,D,M,S,A,z,N){const U=e.indexArray,q=e.layoutVertexArray,J=e.segments.prepareSegment(4*s.length,q,U,this.canOverlap?_.sortKey:void 0),ie=this.glyphOffsetArray.length,ce=J.vertexLength,he=this.allowVerticalPlacement&&v===ci.vertical?Math.PI/2:0,pe=_.text&&_.text.sections;for(let de=0;de<s.length;de++){const{tl:De,tr:we,bl:$e,br:Be,tex:Te,pixelOffsetTL:Ve,pixelOffsetBR:Ze,minFontScaleX:Pe,minFontScaleY:We,glyphOffset:Ye,isSDF:zt,sectionIndex:pn}=s[de],Vt=J.vertexLength,jt=Ye[1];ql(q,w.x,w.y,w.z,D.x,D.y,De.x,jt+De.y,Te.x,Te.y,l,zt,Ve.x,Ve.y,Pe,We),ql(q,w.x,w.y,w.z,D.x,D.y,we.x,jt+we.y,Te.x+Te.w,Te.y,l,zt,Ze.x,Ve.y,Pe,We),ql(q,w.x,w.y,w.z,D.x,D.y,$e.x,jt+$e.y,Te.x,Te.y+Te.h,l,zt,Ve.x,Ze.y,Pe,We),ql(q,w.x,w.y,w.z,D.x,D.y,Be.x,jt+Be.y,Te.x+Te.w,Te.y+Te.h,l,zt,Ze.x,Ze.y,Pe,We),rh(e.dynamicLayoutVertexArray,w,he),U.emplaceBack(Vt,Vt+1,Vt+2),U.emplaceBack(Vt+1,Vt+2,Vt+3),J.vertexLength+=4,J.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ye[0]),de!==s.length-1&&pn===s[de+1].sectionIndex||e.programConfigurations.populatePaintArrays(q.length,_,_.index,{},z,N,pe&&pe[pn])}e.placedSymbolArray.emplaceBack(w.x,w.y,w.z,D.x,D.y,ie,this.glyphOffsetArray.length-ie,ce,M,S,D.segment,l?l[0]:0,l?l[1]:0,u[0],u[1],v,0,!1,0,A,0)}_commitLayoutVertex(e,s,l,u,p,_,v){e.emplaceBack(s,l,u,p,_,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,s,l,u,p,_,v){const w=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),D=w.vertexLength,M=v.tileAnchorX,S=v.tileAnchorY;for(let z=0;z<4;z++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(s,-e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(s,e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(s,e.padding,e.padding),l.collisionVertexArrayExt.emplaceBack(s,-e.padding,e.padding),this._commitLayoutVertex(l.layoutVertexArray,u,p,_,M,S,new Ke(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,p,_,M,S,new Ke(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,p,_,M,S,new Ke(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,u,p,_,M,S,new Ke(e.x1,e.y2)),w.vertexLength+=4;const A=l.indexArray;A.emplaceBack(D,D+1),A.emplaceBack(D+1,D+2),A.emplaceBack(D+2,D+3),A.emplaceBack(D+3,D),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,s,l,u,p,_){for(let v=u;v<p;v++){const w=l.get(v),D=this.getSymbolInstanceTextSize(e,_,s,v);this._addCollisionDebugVertices(w,D,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,s,l,u,p,_){for(let v=u;v<p;v++){const w=l.get(v),D=this.getSymbolInstanceIconSize(e,s,v);this._addCollisionDebugVertices(w,D,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new zm(kc,Qo.members,kl),this.iconCollisionBox=new zm(kc,Qo.members,kl);const l=Ka(this.iconSizeData,e),u=Ka(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const _=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(u,e,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(u,e,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,e,s,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,e,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,s,l,u){const p=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:u),_=li(this.textSizeData,e,p)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,s,l){const u=this.icon.placedSymbolArray.get(l),p=li(this.iconSizeData,e,u);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,s,l){e.emplaceBack(s,-l,-l),e.emplaceBack(s,l,-l),e.emplaceBack(s,l,l),e.emplaceBack(s,-l,l)}_updateTextDebugCollisionBoxes(e,s,l,u,p,_){for(let v=u;v<p;v++){const w=l.get(v),D=this.getSymbolInstanceTextSize(e,_,s,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,w.padding)}}_updateIconDebugCollisionBoxes(e,s,l,u,p){for(let _=u;_<p;_++){const v=l.get(_),w=this.getSymbolInstanceIconSize(e,s,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,v.padding)}}updateCollisionDebugBuffers(e,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=Ka(this.iconSizeData,e),u=Ka(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const _=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(u,e,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(u,e,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(l,e,s,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(l,e,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,s,l,u,p,_,v,w,D){const M={};for(let S=s;S<l;S++){const A=e.get(S);M.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},M.textFeatureIndex=A.featureIndex;break}for(let S=u;S<p;S++){const A=e.get(S);M.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},M.verticalTextFeatureIndex=A.featureIndex;break}for(let S=_;S<v;S++){const A=e.get(S);M.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},M.iconFeatureIndex=A.featureIndex;break}for(let S=w;S<D;S++){const A=e.get(S);M.verticalIconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},M.verticalIconFeatureIndex=A.featureIndex;break}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,s){const l=e.placedSymbolArray.get(s),u=l.vertexStartIndex+4*l.numGlyphs;for(let p=l.vertexStartIndex;p<u;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(e),l=Math.cos(e),u=[],p=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const w=this.symbolInstances.get(v);u.push(0|Math.round(s*w.tileAnchorX+l*w.tileAnchorY)),p.push(w.featureIndex)}return _.sort((v,w)=>u[v]-u[w]||p[w]-p[v]),_}addToSortKeyRanges(e,s){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const l=this.symbolInstances.get(s);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((u,p,_)=>{u>=0&&_.indexOf(u)===p&&this.addIndicesForPlacedSymbol(this.text,u)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Xe("SymbolBucket",Ja,{omit:["layers","collisionBoxArray","features","compareText"]}),Ja.MAX_GLYPHS=65535,Ja.addDynamicAttributes=rh;const L_=new rr({"symbol-placement":new tt(Ee.layout_symbol["symbol-placement"]),"symbol-spacing":new tt(Ee.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new tt(Ee.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new st(Ee.layout_symbol["symbol-sort-key"]),"symbol-z-order":new tt(Ee.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new tt(Ee.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new tt(Ee.layout_symbol["icon-ignore-placement"]),"icon-optional":new tt(Ee.layout_symbol["icon-optional"]),"icon-rotation-alignment":new tt(Ee.layout_symbol["icon-rotation-alignment"]),"icon-size":new st(Ee.layout_symbol["icon-size"]),"icon-text-fit":new tt(Ee.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new tt(Ee.layout_symbol["icon-text-fit-padding"]),"icon-image":new st(Ee.layout_symbol["icon-image"]),"icon-rotate":new st(Ee.layout_symbol["icon-rotate"]),"icon-padding":new tt(Ee.layout_symbol["icon-padding"]),"icon-keep-upright":new tt(Ee.layout_symbol["icon-keep-upright"]),"icon-offset":new st(Ee.layout_symbol["icon-offset"]),"icon-anchor":new st(Ee.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new tt(Ee.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new tt(Ee.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new tt(Ee.layout_symbol["text-rotation-alignment"]),"text-field":new st(Ee.layout_symbol["text-field"]),"text-font":new st(Ee.layout_symbol["text-font"]),"text-size":new st(Ee.layout_symbol["text-size"]),"text-max-width":new st(Ee.layout_symbol["text-max-width"]),"text-line-height":new st(Ee.layout_symbol["text-line-height"]),"text-letter-spacing":new st(Ee.layout_symbol["text-letter-spacing"]),"text-justify":new st(Ee.layout_symbol["text-justify"]),"text-radial-offset":new st(Ee.layout_symbol["text-radial-offset"]),"text-variable-anchor":new tt(Ee.layout_symbol["text-variable-anchor"]),"text-anchor":new st(Ee.layout_symbol["text-anchor"]),"text-max-angle":new tt(Ee.layout_symbol["text-max-angle"]),"text-writing-mode":new tt(Ee.layout_symbol["text-writing-mode"]),"text-rotate":new st(Ee.layout_symbol["text-rotate"]),"text-padding":new tt(Ee.layout_symbol["text-padding"]),"text-keep-upright":new tt(Ee.layout_symbol["text-keep-upright"]),"text-transform":new st(Ee.layout_symbol["text-transform"]),"text-offset":new st(Ee.layout_symbol["text-offset"]),"text-allow-overlap":new tt(Ee.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new tt(Ee.layout_symbol["text-ignore-placement"]),"text-optional":new tt(Ee.layout_symbol["text-optional"])});var $p={paint:new rr({"icon-opacity":new st(Ee.paint_symbol["icon-opacity"]),"icon-color":new st(Ee.paint_symbol["icon-color"]),"icon-halo-color":new st(Ee.paint_symbol["icon-halo-color"]),"icon-halo-width":new st(Ee.paint_symbol["icon-halo-width"]),"icon-halo-blur":new st(Ee.paint_symbol["icon-halo-blur"]),"icon-translate":new tt(Ee.paint_symbol["icon-translate"]),"icon-translate-anchor":new tt(Ee.paint_symbol["icon-translate-anchor"]),"text-opacity":new st(Ee.paint_symbol["text-opacity"]),"text-color":new st(Ee.paint_symbol["text-color"],{runtimeType:Bo,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new st(Ee.paint_symbol["text-halo-color"]),"text-halo-width":new st(Ee.paint_symbol["text-halo-width"]),"text-halo-blur":new st(Ee.paint_symbol["text-halo-blur"]),"text-translate":new tt(Ee.paint_symbol["text-translate"]),"text-translate-anchor":new tt(Ee.paint_symbol["text-translate-anchor"])}),layout:L_};class Om{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ps,this.defaultValue=e}evaluate(e){if(e.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Xe("FormatSectionOverride",Om,{omit:["defaultValue"]});class oh extends Ti{constructor(e){super(e,$p)}recalculate(e,s){super.recalculate(e,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const u=[];for(const p of l)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,s,l,u){const p=this.layout.get(e).evaluate(s,{},l,u),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||La(_.value)||!p?p:(v=s.properties,p.replace(/{([^{}]+)}/g,(D,M)=>M in v?String(v[M]):""));var v}createBucket(e){return new Ja(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of $p.paint.overridableProperties){if(!oh.hasPaintOverride(this.layout,e))continue;const s=this.paint.get(e),l=new Om(s),u=new xu(l,s.property.specification);let p=null;p="constant"===s.value.kind||"source"===s.value.kind?new Oa("source",u):new bu("composite",u,s.value.zoomStops,s.value._interpolationType),this.paint._values[e]=new Wr(s.property,p,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,l){return!(!this.layout||s.isDataDriven()||l.isDataDriven())&&oh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){const l=e.get("text-field"),u=$p.paint.properties[s];let p=!1;const _=v=>{for(const w of v)if(u.overrides&&u.overrides.hasOverride(w))return void(p=!0)};if("constant"===l.value.kind&&l.value.value instanceof Et)_(l.value.value.sections);else if("source"===l.value.kind){const v=D=>{p||(D instanceof js&&vn(D.value)===Ns?_(D.value.sections):D instanceof fo?_(D.sections):D.eachChild(v))},w=l.value;w._styleExpression&&v(w._styleExpression.expression)}return p}getProgramConfiguration(e){return new no(this,e)}}var Fv={paint:new rr({"background-color":new tt(Ee.paint_background["background-color"]),"background-pattern":new qo(Ee.paint_background["background-pattern"]),"background-opacity":new tt(Ee.paint_background["background-opacity"])})},z_={paint:new rr({"raster-opacity":new tt(Ee.paint_raster["raster-opacity"]),"raster-hue-rotate":new tt(Ee.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new tt(Ee.paint_raster["raster-brightness-min"]),"raster-brightness-max":new tt(Ee.paint_raster["raster-brightness-max"]),"raster-saturation":new tt(Ee.paint_raster["raster-saturation"]),"raster-contrast":new tt(Ee.paint_raster["raster-contrast"]),"raster-resampling":new tt(Ee.paint_raster["raster-resampling"]),"raster-fade-duration":new tt(Ee.paint_raster["raster-fade-duration"])})};class Rv extends Ti{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Bm={paint:new rr({"sky-type":new tt(Ee.paint_sky["sky-type"]),"sky-atmosphere-sun":new tt(Ee.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new tt(Ee.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new tt(Ee.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new tt(Ee.paint_sky["sky-gradient-radius"]),"sky-gradient":new eo(Ee.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new tt(Ee.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new tt(Ee.paint_sky["sky-atmosphere-color"]),"sky-opacity":new tt(Ee.paint_sky["sky-opacity"])})};function dd(i,e,s){const l=Wi(0,0,1),u=iu(ks());return function(p,_,v){v*=.5;var w=_[0],D=_[1],M=_[2],S=_[3],A=Math.sin(v),z=Math.cos(v);p[0]=w*z-M*A,p[1]=D*z+S*A,p[2]=M*z+w*A,p[3]=S*z-D*A}(u,u,s?-Ft(i)+Math.PI:Ft(i)),dl(u,u,-Ft(e)),wa(l,l,u),As(l,l)}const O_={circle:class extends Ti{constructor(i){super(i,e_)}createBucket(i){return new jh(i)}queryRadius(i){const e=i;return Za("circle-radius",this,e)+Za("circle-stroke-width",this,e)+Bu(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,s,l,u,p,_,v){const w=fp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(e,s)+this.paint.get("circle-stroke-width").evaluate(e,s);return Yf(i,l,p,_,v,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),w,D)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new no(this,i)}},heatmap:class extends Ti{createBucket(i){return new r_(i)}constructor(i){super(i,o_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){"heatmap-color"===i&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Za("heatmap-radius",this,i)}queryIntersectsFeature(i,e,s,l,u,p,_,v){const w=this.paint.get("heatmap-radius").evaluate(e,s);return Yf(i,l,p,_,v,!0,!0,new Ke(0,0),w)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new no(this,i)}},hillshade:class extends Ti{constructor(i){super(i,s_)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(i){return new no(this,i)}},fill:class extends Ti{constructor(i){super(i,Hu)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),s=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(i){return new no(this,i)}recalculate(i,e){super.recalculate(i,e);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Dp(i)}queryRadius(){return Bu(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,s,l,u,p){return!i.queryGeometry.isAboveHorizon&&Xf(pp(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends Ti{constructor(i){super(i,f_)}createBucket(i){return new Wu(i)}queryRadius(){return Bu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new no(this,i)}queryIntersectsFeature(i,e,s,l,u,p,_,v,w){const D=fp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,s),S=this.paint.get("fill-extrusion-base").evaluate(e,s),A=[0,0],z=v&&p.elevation,N=p.elevation?p.elevation.exaggeration():1;if(z){const J=i.tile.getBucket(this).centroidVertexArray,ie=w+1;if(ie<J.length){const ce=J.get(ie);A[0]=ce.a_centroid_pos0,A[1]=ce.a_centroid_pos1}}if(0===A[0]&&1===A[1])return!1;const U=(J=l,ie=S,ce=M,he=D,pe=_,(de=z?v:null)?function(Be,Te,Ve,Ze,Pe,We,Ye,zt,pn){const Vt=[],jt=[],Ne=[0,0,0,1];for(const Jt of Be){const qt=[],Xn=[];for(const Ln of Jt){const Tr=Ln.x+Ze.x,Rr=Ln.y+Ze.y,Yt=Xu(Tr,Rr,Te,Ve,We,Ye,zt,pn);Ne[0]=Tr,Ne[1]=Rr,Ne[2]=Yt.base,Ne[3]=1,Vr(Ne,Ne,Pe),Ne[3]=Math.max(Ne[3],1e-5);const Ot=pm([Ne[0]/Ne[3],Ne[1]/Ne[3],Ne[2]/Ne[3]]);Ne[0]=Tr,Ne[1]=Rr,Ne[2]=Yt.top,Ne[3]=1,Vr(Ne,Ne,Pe),Ne[3]=Math.max(Ne[3],1e-5);const zn=pm([Ne[0]/Ne[3],Ne[1]/Ne[3],Ne[2]/Ne[3]]);qt.push(Ot),Xn.push(zn)}Vt.push(qt),jt.push(Xn)}return[Vt,jt]}(J,ie,ce,he,pe,de,A,N,p.center.lat):function(Be,Te,Ve,Ze,Pe){const We=[],Ye=[],zt=Pe[8]*Te,pn=Pe[9]*Te,Vt=Pe[10]*Te,jt=Pe[11]*Te,Ne=Pe[8]*Ve,Jt=Pe[9]*Ve,qt=Pe[10]*Ve,Xn=Pe[11]*Ve;for(const Ln of Be){const Tr=[],Rr=[];for(const Yt of Ln){const Ot=Yt.x+Ze.x,zn=Yt.y+Ze.y,or=Pe[0]*Ot+Pe[4]*zn+Pe[12],On=Pe[1]*Ot+Pe[5]*zn+Pe[13],sr=Pe[2]*Ot+Pe[6]*zn+Pe[14],Cr=Pe[3]*Ot+Pe[7]*zn+Pe[15],di=or+zt,Hi=On+pn,Zt=sr+Vt,Mr=Math.max(Cr+jt,1e-5),ns=or+Ne,br=On+Jt,un=sr+qt,dr=Math.max(Cr+Xn,1e-5),kn=new Ke(di/Mr,Hi/Mr);kn.z=Zt/Mr,Tr.push(kn);const pi=new Ke(ns/dr,br/dr);pi.z=un/dr,Rr.push(pi)}We.push(Tr),Ye.push(Rr)}return[We,Ye]}(J,ie,ce,he,pe)),q=i.queryGeometry;var J,ie,ce,he,pe,de;return function(J,ie,ce){let he=1/0;Xf(ce,ie)&&(he=dm(ce,ie[0]));for(let pe=0;pe<ie.length;pe++){const de=ie[pe],De=J[pe];for(let we=0;we<de.length-1;we++){const $e=de[we],Be=[$e,de[we+1],De[we+1],De[we],$e];Wf(ce,Be)&&(he=Math.min(he,dm(ce,Be)))}}return he!==1/0&&he}(U[0],U[1],q.isPointQuery()?q.screenBounds:q.screenGeometry)}},line:class extends Ti{constructor(i){super(i,mm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if("line-gradient"===i){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof gs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=gm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Xh(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new no(this,i)}queryRadius(i){const e=i,s=_m(Za("line-width",this,e),Za("line-gap-width",this,e)),l=Za("line-offset",this,e);return s/2+Math.abs(l)+Bu(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,s,l,u,p){if(i.queryGeometry.isAboveHorizon)return!1;const _=pp(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),v=i.pixelToTileUnitsFactor/2*_m(this.paint.get("line-width").evaluate(e,s),this.paint.get("line-gap-width").evaluate(e,s)),w=this.paint.get("line-offset").evaluate(e,s);return w&&(l=function(D,M){const S=[],A=new Ke(0,0);for(let z=0;z<D.length;z++){const N=D[z],U=[];for(let q=0;q<N.length;q++){const J=N[q-1],ie=N[q],ce=N[q+1],he=0===q?A:ie.sub(J)._unit()._perp(),pe=q===N.length-1?A:ce.sub(ie)._unit()._perp(),de=he._add(pe)._unit();de._mult(1/(de.x*pe.x+de.y*pe.y)),U.push(de._mult(M)._add(ie))}S.push(U)}return S}(l,w*i.pixelToTileUnitsFactor)),function(D,M,S){for(let A=0;A<M.length;A++){const z=M[A];if(D.length>=3)for(let N=0;N<z.length;N++)if(Vc(D,z[N]))return!0;if(Yg(D,z,S))return!0}return!1}(_,l,v)}isTileClipped(){return!0}},symbol:oh,background:class extends Ti{constructor(i){super(i,Fv)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ti{constructor(i){super(i,z_)}getProgramIds(){return["raster"]}},sky:class extends Ti{constructor(i){super(i,Bm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){"sky-gradient"===i?this._updateColorRamp():"sky-atmosphere-sun"!==i&&"sky-atmosphere-halo-color"!==i&&"sky-atmosphere-color"!==i&&"sky-atmosphere-sun-intensity"!==i||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=gp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(i,e){const s=this.paint.get("sky-type");if("atmosphere"===s){const l=this.paint.get("sky-atmosphere-sun"),u=!l,p=i.style.light,_=p.properties.get("position");return u&&"viewport"===p.properties.get("anchor")&&Mn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?dd(_.azimuthal,90-_.polar,e):dd(l[0],90-l[1],e)}if("gradient"===s){const l=this.paint.get("sky-gradient-center");return dd(l[0],90-l[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return"atmosphere"===i?["skyboxCapture","skybox"]:"gradient"===i?["skyboxGradient"]:null}}},{HTMLImageElement:pd,HTMLCanvasElement:B_,HTMLVideoElement:N_,ImageData:V_,ImageBitmap:Gp}=Ae;class Hp{constructor(e,s,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(s,u)}update(e,s,l){const{width:u,height:p}=e,{context:_}=this,{gl:v}=_;if(v.bindTexture(v.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!s||!1!==s.premultiply)),l||this.size&&this.size[0]===u&&this.size[1]===p){const{x:w,y:D}=l||{x:0,y:0};e instanceof pd||e instanceof B_||e instanceof N_||e instanceof V_||Gp&&e instanceof Gp?v.texSubImage2D(v.TEXTURE_2D,0,w,D,v.RGBA,v.UNSIGNED_BYTE,e):v.texSubImage2D(v.TEXTURE_2D,0,w,D,u,p,v.RGBA,v.UNSIGNED_BYTE,e.data)}else this.size=[u,p],e instanceof pd||e instanceof B_||e instanceof N_||e instanceof V_||Gp&&e instanceof Gp?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,e):v.texImage2D(v.TEXTURE_2D,0,this.format,u,p,0,this.format,v.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(e,s){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),s!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,s),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Nm{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.image=new Bl({width:e,height:s}),this.positions={},this.uploaded=!1}getDash(e,s){const l=this.getKey(e,s);return this.positions[l]}trim(){const e=this.width,s=this.height=Pi(this.nextRow);this.image.resize({width:e,height:s})}getKey(e,s){return e.join(",")+s}getDashRanges(e,s,l){const u=[];let p=e.length%2==1?-e[e.length-1]*l:0,_=e[0]*l,v=!0;u.push({left:p,right:_,isDash:v,zeroLength:0===e[0]});let w=e[0];for(let D=1;D<e.length;D++){v=!v;const M=e[D];p=w*l,w+=M,_=w*l,u.push({left:p,right:_,isDash:v,zeroLength:0===M})}return u}addRoundDash(e,s,l){const u=s/2;for(let p=-l;p<=l;p++){const _=this.width*(this.nextRow+l+p);let v=0,w=e[v];for(let D=0;D<this.width;D++){D/w.right>1&&(w=e[++v]);const M=Math.abs(D-w.left),S=Math.abs(D-w.right),A=Math.min(M,S);let z;const N=p/l*(u+1);if(w.isDash){const U=u-Math.abs(N);z=Math.sqrt(A*A+U*U)}else z=u-Math.sqrt(A*A+N*N);this.image.data[_+D]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(e,s){for(let w=e.length-1;w>=0;--w){const D=e[w],M=e[w+1];D.zeroLength?e.splice(w,1):M&&M.isDash===D.isDash&&(M.left=D.left,e.splice(w,1))}const l=e[0],u=e[e.length-1];l.isDash===u.isDash&&(l.left=u.left-this.width,u.right=l.right+this.width);const p=this.width*this.nextRow;let _=0,v=e[_];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++_]);const D=Math.abs(w-v.left),M=Math.abs(w-v.right),S=Math.min(D,M);this.image.data[p+w]=Math.max(0,Math.min(255,(v.isDash?S:-S)+s+128))}}addDash(e,s){const l=this.getKey(e,s);if(this.positions[l])return this.positions[l];const u="round"===s,p=u?7:0,_=2*p+1;if(this.nextRow+_>this.height)return Mn("LineAtlas out of space"),null;0===e.length&&e.push(1);let v=0;for(let M=0;M<e.length;M++)e[M]<0&&(Mn("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),v+=e[M];if(0!==v){const M=this.width/v,S=this.getDashRanges(e,this.width,M);u?this.addRoundDash(S,M,p):this.addRegularDash(S,"square"===s?.5*M:0)}const w=this.nextRow+p;this.nextRow+=_;const D={tl:[w,p],br:[v,0]};return this.positions[l]=D,D}}Xe("LineAtlas",Nm);class Lv{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const zv=Ae.performance;function j_(i){const e=i?i.url.toString():void 0;return zv.getEntriesByName(e)}class Ov{constructor(){this.tasks={},this.taskQueue=[],ml(["process"],this),this.invoker=new Lv(this.process),this.nextId=0}add(e,s){const l=this.nextId++,u=function({type:p,isSymbolTile:_,zoom:v}){return v=v||0,"message"===p?0:"maybePrepare"!==p||_?"parseTile"!==p||_?"parseTile"===p&&_?300-v:"maybePrepare"===p&&_?400-v:500:200-v:100-v}(s);if(0===u){Ki();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:e,metadata:s,priority:u,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){Ki();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const s=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let e=null,s=1/0;for(let u=0;u<this.taskQueue.length;u++){const p=this.tasks[this.taskQueue[u]];p.priority<s&&(s=p.priority,e=u)}if(null===e)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}function da(i,e,s){var l=2*Math.PI*6378137/256/Math.pow(2,s);return[i*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class Kc{constructor(e,s,l){this.z=e,this.x=s,this.y=l,this.key=Zl(0,e,e,s,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,s){const l=(_=this.y,v=this.z,w=da(256*(p=this.x),256*(_=Math.pow(2,v)-_-1),v),D=da(256*(p+1),256*(_+1),v),w[0]+","+w[1]+","+D[0]+","+D[1]),u=function(p,_,v){let w,D="";for(let M=p;M>0;M--)w=1<<M-1,D+=(_&w?1:0)+(v&w?2:0);return D}(this.z,this.x,this.y);var p,_,v,w,D;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===s?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class qp{constructor(e,s){this.wrap=e,this.canonical=s,this.key=Zl(e,s.z,s.z,s.x,s.y)}}class hi{constructor(e,s,l,u,p){this.overscaledZ=e,this.wrap=s,this.canonical=new Kc(l,+u,+p),this.key=0===s&&e===l?this.canonical.key:Zl(s,e,l,u,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const s=this.canonical.z-e;return e>this.canonical.z?new hi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hi(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s=!0){if(this.overscaledZ===e&&s)return this.key;if(e>this.canonical.z)return Zl(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return Zl(this.wrap*+s,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const s=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new hi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,l=2*this.canonical.x,u=2*this.canonical.y;return[new hi(s,this.wrap,s,l,u),new hi(s,this.wrap,s,l+1,u),new hi(s,this.wrap,s,l,u+1),new hi(s,this.wrap,s,l+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new hi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new hi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new qp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Zl(i,e,s,l,u){const p=1<<Math.min(s,22);let _=p*(u%p)+l%p;return i&&s<22&&(_+=p*p*((i<0?-2*i-1:2*i)%(1<<2*(22-s)))),16*(32*_+s)+(e-s)}Xe("CanonicalTileID",Kc),Xe("OverscaledTileID",hi,{omit:["projMatrix"]});class Wl{constructor(e,s,l){this.func=e,this.mask=s,this.range=l}}Wl.ReadOnly=!1,Wl.ReadWrite=!0,Wl.disabled=new Wl(519,Wl.ReadOnly,[0,1]);class Zp{constructor(e,s,l,u,p,_){this.test=e,this.ref=s,this.mask=l,this.fail=u,this.depthFail=p,this.pass=_}}Zp.disabled=new Zp({func:519,mask:0},0,0,7680,7680,7680);class Kr{constructor(e,s,l){this.blendFunction=e,this.blendColor=s,this.mask=l}}Kr.Replace=[1,0],Kr.disabled=new Kr(Kr.Replace,Ht.transparent,[!1,!1,!1,!1]),Kr.unblended=new Kr(Kr.Replace,Ht.transparent,[!0,!0,!0,!0]),Kr.alphaBlended=new Kr([1,771],Ht.transparent,[!0,!0,!0,!0]);class io{constructor(e,s,l){this.enable=e,this.mode=s,this.frontFace=l}}io.disabled=new io(!1,1029,2305),io.backCCW=new io(!0,1029,2305),io.backCW=new io(!0,1029,2304),io.frontCW=new io(!0,1028,2304),io.frontCCW=new io(!0,1028,2305);class Vm{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){const l=e[s];this._stringToNumber[l]=s,this._numberToString[s]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Xp{constructor(e,s,l,u,p){this.type="Feature",this._vectorTileFeature=e,e._z=s,e._x=l,e._y=u,this.properties=e.properties,this.id=p}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const s in this)"_geometry"!==s&&"_vectorTileFeature"!==s&&(e[s]=this[s]);return e}}class U_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,l){const u=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Nn(this.stateChanges[e][u],l),null===this.deletedStates[e]){this.deletedStates[e]={};for(const p in this.state[e])p!==u&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][u]){this.deletedStates[e][u]={};for(const p in this.state[e][u])l[p]||(this.deletedStates[e][u][p]=null)}else for(const p in l)this.deletedStates[e]&&this.deletedStates[e][u]&&null===this.deletedStates[e][u][p]&&delete this.deletedStates[e][u][p]}removeFeatureState(e,s,l){if(null===this.deletedStates[e])return;const u=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&void 0!==s)null!==this.deletedStates[e][u]&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(void 0!==s)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,s){const l=String(s),u=Nn({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const p=this.deletedStates[e][s];if(null===p)return{};for(const _ in p)delete u[_]}return u}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const _ in this.stateChanges[u])this.state[u][_]||(this.state[u][_]={}),Nn(this.state[u][_],this.stateChanges[u][_]),p[_]=this.state[u][_];l[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(null===this.deletedStates[u])for(const _ in this.state[u])p[_]={},this.state[u][_]={};else for(const _ in this.deletedStates[u]){if(null===this.deletedStates[u][_])this.state[u][_]={};else for(const v of Object.keys(this.deletedStates[u][_]))delete this.state[u][_][v];p[_]=this.state[u][_]}l[u]=l[u]||{},Nn(l[u],p)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(l).length)for(const u in e)e[u].setFeatureState(l,s)}}class jm{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,s){const l=this.toIdx(e,s);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,s){return this.leaves[this.toIdx(e,s)]}toIdx(e,s){return s*this.size+e}}function Jc(i,e,s,l){let u=0,p=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(l[_])<1e-15){if(s[_]<i[_]||s[_]>e[_])return null}else{const v=1/l[_];let w=(i[_]-s[_])*v,D=(e[_]-s[_])*v;if(w>D){const M=w;w=D,D=M}if(w>u&&(u=w),D<p&&(p=D),u>p)return null}return u}function Xl(i,e,s,l,u,p,_,v,w,D,M){const S=l-i,A=u-e,z=p-s,N=_-i,U=v-e,q=w-s,J=M[1]*q-M[2]*U,ie=M[2]*N-M[0]*q,ce=M[0]*U-M[1]*N,he=S*J+A*ie+z*ce;if(Math.abs(he)<1e-15)return null;const pe=1/he,de=D[0]-i,De=D[1]-e,we=D[2]-s,$e=(de*J+De*ie+we*ce)*pe;if($e<0||$e>1)return null;const Be=De*z-we*A,Te=we*S-de*z,Ve=de*A-De*S,Ze=(M[0]*Be+M[1]*Te+M[2]*Ve)*pe;return Ze<0||$e+Ze>1?null:(N*Be+U*Te+q*Ve)*pe}function md(i,e,s){return(i-e)/(s-e)}function Kl(i,e,s,l,u,p,_,v,w){const D=1<<s,M=p-l,S=_-u,A=(i+1)/D*M+l,z=(e+0)/D*S+u,N=(e+1)/D*S+u;v[0]=(i+0)/D*M+l,v[1]=z,w[0]=A,w[1]=N}class Yc{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(p){const _=Math.ceil(Math.log2(p.dim/8)),v=[];let w=Math.ceil(Math.pow(2,_));const D=1/w,M=(z,N,U,q,J)=>{const ie=q?1:0,ce=(z+1)*U-ie,he=N*U,pe=(N+1)*U-ie;J[0]=z*U,J[1]=he,J[2]=ce,J[3]=pe};let S=new jm(w);const A=[];for(let z=0;z<w*w;z++){M(z%w,Math.floor(z/w),D,!1,A);const N=Ya(A[0],A[1],p),U=Ya(A[2],A[1],p),q=Ya(A[2],A[3],p),J=Ya(A[0],A[3],p);S.minimums.push(Math.min(N,U,q,J)),S.maximums.push(Math.max(N,U,q,J)),S.leaves.push(1)}for(v.push(S),w/=2;w>=1;w/=2){const z=v[v.length-1];S=new jm(w);for(let N=0;N<w*w;N++){M(N%w,Math.floor(N/w),2,!0,A);const U=z.getElevation(A[0],A[1]),q=z.getElevation(A[2],A[1]),J=z.getElevation(A[2],A[3]),ie=z.getElevation(A[0],A[3]),ce=z.isLeaf(A[0],A[1]),he=z.isLeaf(A[2],A[1]),pe=z.isLeaf(A[2],A[3]),de=z.isLeaf(A[0],A[3]),De=Math.min(U.min,q.min,J.min,ie.min),we=Math.max(U.max,q.max,J.max,ie.max),$e=ce&&he&&pe&&de;S.maximums.push(we),S.minimums.push(De),S.leaves.push(we-De<=5&&$e?1:0)}v.push(S)}return v}(this.dem),l=s.length-1,u=s[l];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(s,0,0,l,0)}raycastRoot(e,s,l,u,p,_,v=1){return Jc([e,s,-100],[l,u,this.maximums[0]*v],p,_)}raycast(e,s,l,u,p,_,v=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,s,l,u,p,_,v);if(null==w)return null;const D=[],M=[],S=[],A=[],z=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:N,t:U,nodex:q,nodey:J,depth:ie}=z.pop();if(this.leaves[N]){Kl(q,J,ie,e,s,l,u,S,A);const he=1<<ie,pe=(q+0)/he,de=(q+1)/he,De=(J+0)/he,we=(J+1)/he,$e=Ya(pe,De,this.dem)*v,Be=Ya(de,De,this.dem)*v,Te=Ya(de,we,this.dem)*v,Ve=Ya(pe,we,this.dem)*v,Ze=Xl(S[0],S[1],$e,A[0],S[1],Be,A[0],A[1],Te,p,_),Pe=Xl(A[0],A[1],Te,S[0],A[1],Ve,S[0],S[1],$e,p,_),We=Math.min(null!==Ze?Ze:Number.MAX_VALUE,null!==Pe?Pe:Number.MAX_VALUE);if(We!==Number.MAX_VALUE)return We;{const Ye=wn([],p,_,U);if(Jl($e,Be,Ve,Te,md(Ye[0],S[0],A[0]),md(Ye[1],S[1],A[1]))>=Ye[2])return U}continue}let ce=0;for(let he=0;he<this._siblingOffset.length;he++){Kl((q<<1)+this._siblingOffset[he][0],(J<<1)+this._siblingOffset[he][1],ie+1,e,s,l,u,S,A),S[2]=-100,A[2]=this.maximums[this.childOffsets[N]+he]*v;const pe=Jc(S,A,p,_);if(null!=pe){const de=pe;D[he]=de;let De=!1;for(let we=0;we<ce&&!De;we++)de>=D[M[we]]&&(M.splice(we,0,he),De=!0);De||(M[ce]=he),ce++}}for(let he=0;he<ce;he++){const pe=M[he];z.push({idx:this.childOffsets[N]+pe,t:D[pe],nodex:(q<<1)+this._siblingOffset[pe][0],nodey:(J<<1)+this._siblingOffset[pe][1],depth:ie+1})}}return null}_addNode(e,s,l){return this.minimums.push(e),this.maximums.push(s),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,s,l,u,p){if(1===e[u].isLeaf(s,l))return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const _=u-1,v=e[_];let w,D=0;for(let M=0;M<this._siblingOffset.length;M++){const S=2*s+this._siblingOffset[M][0],A=2*l+this._siblingOffset[M][1],z=v.getElevation(S,A),N=v.isLeaf(S,A),U=this._addNode(z.min,z.max,N);N&&(D|=1<<M),w||(w=U)}for(let M=0;M<this._siblingOffset.length;M++)D&1<<M||this._construct(e,2*s+this._siblingOffset[M][0],2*l+this._siblingOffset[M][1],_,w+M)}}function Jl(i,e,s,l,u,p){return Rt(Rt(i,s,p),Rt(e,l,p),u)}function Ya(i,e,s){const l=s.dim,u=on(i*l-.5,0,l-1),p=on(e*l-.5,0,l-1),_=Math.floor(u),v=Math.floor(p),w=Math.min(_+1,l-1),D=Math.min(v+1,l-1);return Jl(s.get(_,v),s.get(w,v),s.get(_,D),s.get(w,D),u-_,p-v)}const Kp={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class ah{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,s,l,u=!1,p=!1){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&"mapbox"!==l&&"terrarium"!==l)return Mn(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const _=this.dim=s.height-2;if(this.data=new Uint32Array(s.data.buffer),this.encoding=l||"mapbox",this.borderReady=u,!u){for(let v=0;v<_;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(_,v)]=this.data[this._idx(_-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,_)]=this.data[this._idx(v,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Yc(this)}get(e,s,l=!1){const u=new Uint8Array(this.data.buffer);l&&(e=on(e,-1,this.dim),s=on(s,-1,this.dim));const p=4*this._idx(e,s);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(u[p],u[p+1],u[p+2])}static getUnpackVector(e){return Kp[e]}get unpackVector(){return Kp[this.encoding]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}_unpackMapbox(e,s,l){return(256*e*256+256*s+l)/10-1e4}_unpackTerrarium(e,s,l){return 256*e+s+l/256-32768}static pack(e,s){const l=[0,0,0,0],u=ah.getUnpackVector(s);let p=Math.floor((e+u[3])/u[2]);return l[2]=p%256,p=Math.floor(p/256),l[1]=p%256,p=Math.floor(p/256),l[0]=p,l}getPixels(){return new Ui({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,s,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=s*this.dim,p=s*this.dim+this.dim,_=l*this.dim,v=l*this.dim+this.dim;switch(s){case-1:u=p-1;break;case 1:p=u+1}switch(l){case-1:_=v-1;break;case 1:v=_+1}const w=-s*this.dim,D=-l*this.dim;for(let M=_;M<v;M++)for(let S=u;S<p;S++)this.data[this._idx(S,M)]=e.data[this._idx(S+w,M+D)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Xe("DEMData",ah),Xe("DemMinMaxQuadTree",Yc,{omit:["dem"]});class Jp{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,l){const u=e.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const p={value:s,timeout:void 0};if(void 0!==l&&(p.timeout=setTimeout(()=>{this.remove(e,p)},l)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const l=e.wrapped().key,u=void 0===s?0:this.data[l].indexOf(s),p=this.data[l][u];return this.data[l].splice(u,1),p.timeout&&clearTimeout(p.timeout),0===this.data[l].length&&delete this.data[l],this.onRemove(p.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||s.push(u);for(const l of s)this.remove(l.value.tileID,l)}}class pa extends hs{constructor(e,s,l){super(),this.id=e,this._onlySymbols=l,s.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new Jp(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new U_}onAdd(e){this.map=e,this._minTileCacheSize=e?e._minTileCacheSize:null,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const s=this._tiles[e];if("loaded"!==s.state&&"errored"!==s.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,s){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,s)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Ai(this._tiles).map(e=>e.tileID).sort(Yp).map(e=>e.key)}getRenderableIds(e){const s=[];for(const l in this._tiles)this._isIdRenderable(+l,e)&&s.push(this._tiles[l]);return e?s.sort((l,u)=>{const p=l.tileID,_=u.tileID,v=new Ke(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),w=new Ke(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-_.overscaledZ||w.y-v.y||w.x-v.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(Yp).map(l=>l.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,s){const l=this._tiles[e];l&&("loading"!==l.state&&(l.state=s),this._loadTile(l,this._tileLoaded.bind(this,l,e,s)))}_tileLoaded(e,s,l,u){if(u)if(e.state="errored",404!==u.status)this._source.fire(new au(u,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=vi.now(),"expired"===l&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Qn("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const p=s[u];if(e.neighboringTiles&&e.neighboringTiles[p]){const _=this.getTileByID(p);l(e,_),l(_,e)}}function l(u,p){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let _=p.tileID.canonical.x-u.tileID.canonical.x;const v=p.tileID.canonical.y-u.tileID.canonical.y,w=Math.pow(2,u.tileID.canonical.z),D=p.tileID.key;0===_&&0===v||Math.abs(v)>1||(Math.abs(_)>1&&(1===Math.abs(_+w)?_+=w:1===Math.abs(_-w)&&(_-=w)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,_,v),u.neighboringTiles&&u.neighboringTiles[D]&&(u.neighboringTiles[D].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,l,u){for(const p in this._tiles){let _=this._tiles[p];if(u[p]||!_.hasData()||_.tileID.overscaledZ<=s||_.tileID.overscaledZ>l)continue;let v=_.tileID;for(;_&&_.tileID.overscaledZ>s+1;){const D=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[D.key],_&&_.hasData()&&(v=D)}let w=v;for(;w.overscaledZ>s;)if(w=w.scaledTo(w.overscaledZ-1),e[w.key]){u[v.key]=v;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=e.overscaledZ-1;l>=s;l--){const u=e.scaledTo(l),p=this._getLoadedTile(u);if(p)return p}}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,s){s=s||this._source.tileSize;const l=Math.ceil(e.width/s)+1,u=Math.ceil(e.height/s)+1,p=Math.floor(l*u*5),_="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,p):p,v="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(v)}handleWrapJump(e){const s=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,s){const l={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),l[p.tileID.key]=p}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,s,l){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let u;this.updateCacheSize(e,s),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new hi(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(u=e.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(v=>this._source.hasTile(v)))):u=[];const p=this._updateRetainedTiles(u);if(lh(this._source.type)&&0!==u.length){const v={},w={},D=Object.keys(p);for(const S of D){const A=p[S],z=this._tiles[S];if(!z||z.fadeEndTime&&z.fadeEndTime<=vi.now())continue;const N=this.findLoadedParent(A,Math.max(A.overscaledZ-pa.maxOverzooming,this._source.minzoom));N&&(this._addTile(N.tileID),v[N.tileID.key]=N.tileID),w[S]=A}const M=u[u.length-1].overscaledZ;for(const S in this._tiles){const A=this._tiles[S];if(p[S]||!A.hasData())continue;let z=A.tileID;for(;z.overscaledZ>M;){z=z.scaledTo(z.overscaledZ-1);const N=this._tiles[z.key];if(N&&N.hasData()&&w[z.key]){p[S]=A.tileID;break}}}for(const S in v)p[S]||(this._coveredTiles[S]=!0,p[S]=v[S])}for(const v in p)this._tiles[v].clearFadeHold();const _=function(v,w){const D=[];for(const M in v)M in w||D.push(M);return D}(this._tiles,p);for(const v of _){const w=this._tiles[v];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const s={};if(0===e.length)return s;const l={},u=e.reduce((D,M)=>Math.min(D,M.overscaledZ),1/0),p=e[0].overscaledZ,_=Math.max(p-pa.maxOverzooming,this._source.minzoom),v=Math.max(p+pa.maxUnderzooming,this._source.minzoom),w={};for(const D of e){const M=this._addTile(D);s[D.key]=D,M.hasData()||u<this._source.maxzoom&&(w[D.key]=D)}this._retainLoadedChildren(w,u,v,s);for(const D of e){let M=this._tiles[D.key];if(M.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const A=D.children(this._source.maxzoom)[0],z=this.getTile(A);if(z&&z.hasData()){s[A.key]=A;continue}}else{const A=D.children(this._source.maxzoom);if(s[A[0].key]&&s[A[1].key]&&s[A[2].key]&&s[A[3].key])continue}let S=M.wasRequested();for(let A=D.overscaledZ-1;A>=_;--A){const z=D.scaledTo(A);if(l[z.key]||(l[z.key]=!0,M=this.getTile(z),!M&&S&&(M=this._addTile(z)),M&&(s[z.key]=z,S=M.wasRequested(),M.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}s.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(p),l)break;u=p}for(const p of s)this._loadedParentTiles[p]=l}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const l=Boolean(s);if(!l){const u=this.map?this.map.painter:null,p="raster"===this._source.type||"raster-dem"===this._source.type;s=new yd(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,p),this._loadTile(s,this._tileLoaded.bind(this,s,e.key,s.state))}return s?(s.uses++,this._tiles[e.key]=s,l||this._source.fire(new Qn("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=s.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&"reloading"!==s.state?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,s,l){const u=[],p=this.transform;if(!p)return u;for(const _ in this._tiles){const v=this._tiles[_];if(l&&v.clearQueryDebugViz(),v.holdingForFade())continue;const w=e.containsTile(v,p,s);w&&u.push(w)}return u}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of s)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(lh(this._source.type))for(const e in this._tiles){const s=this._tiles[e];if(void 0!==s.fadeEndTime&&s.fadeEndTime>=vi.now())return!0}return!1}setFeatureState(e,s,l){this._state.updateState(e=e||"_geojsonTileLayer",s,l)}removeFeatureState(e,s,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,l)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,l){const u=this._tiles[e];u&&u.setDependencies(s,l)}reloadTilesForDependencies(e,s){for(const l in this._tiles)this._tiles[l].hasDependency(e,s)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(e,s))}_preloadTiles(e,s){const l=new Map,u=Array.isArray(e)?e:[e],p=this.map.painter.terrain,_=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const D of u){const M=D.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of M)l.set(S.key,S);this.usedForTerrain&&D.updateElevation(!1)}const v=Array.from(l.values()),w="raster"===this._source.type||"raster-dem"===this._source.type;Ca(v,(D,M)=>{const S=new yd(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,w);this._loadTile(S,A=>{"raster-dem"===this._source.type&&S.dem&&this._backfillDEM(S),M(A,S)})},s)}}function Yp(i,e){const s=Math.abs(2*i.wrap)-+(i.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||l-s||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function lh(i){return"raster"===i||"image"===i||"video"===i}pa.maxOverzooming=10,pa.maxUnderzooming=3;class gd{constructor(e,s,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=s,this._offset=l}static create(e,s,l){const u=l||e.findDEMTileFor(s);if(!u||!u.dem)return;const p=u.dem,_=u.tileID,v=1<<s.canonical.z-_.canonical.z;return new gd(u,u.tileSize/Pt/v,[(s.canonical.x/v-_.canonical.x)*p.dim,(s.canonical.y/v-_.canonical.y)*p.dim])}tileCoordToPixel(e,s){const l=s*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(l);return new Ke(u,p)}getElevationAt(e,s,l,u){const p=e*this._scale+this._offset[0],_=s*this._scale+this._offset[1],v=Math.floor(p),w=Math.floor(_),D=this._dem;return u=!!u,l?Rt(Rt(D.get(v,w,u),D.get(v,w+1,u),_-w),Rt(D.get(v+1,w,u),D.get(v+1,w+1,u),_-w),p-v):D.get(v,w,u)}getElevationAtPixel(e,s,l){return this._dem.get(e,s,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ji(1,e)*this._dem.stride}}class Qp{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ic(Pt,16,0),this.featureIndexArray=new Nf,this.promoteId=s}insert(e,s,l,u,p,_=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,u,p,_);const w=this.grid;for(let D=0;D<s.length;D++){const M=s[D],S=[1/0,1/0,-1/0,-1/0];for(let A=0;A<M.length;A++){const z=M[A];S[0]=Math.min(S[0],z.x),S[1]=Math.min(S[1],z.y),S[2]=Math.max(S[2],z.x),S[3]=Math.max(S[3],z.y)}S[0]<Pt&&S[1]<Pt&&S[2]>=0&&S[3]>=0&&w.insert(v,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Xa.VectorTile(new Vl(this.rawTileData)).layers,this.sourceLayerCoder=new Vm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,s,l,u){this.loadVTLayers();const p=e.params||{},_=Eu(p.filter),v=e.tileResult,w=e.transform,D=v.bufferedTilespaceBounds,M=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(N,U,q,J)=>Qg(v.bufferedTilespaceGeometry,N,U,q,J));M.sort(Um);let S=null;w.elevation&&M.length>0&&(S=gd.create(w.elevation,this.tileID));const A={};let z;for(let N=0;N<M.length;N++){const U=M[N];if(U===z)continue;z=U;const q=this.featureIndexArray.get(U);let J=null;this.loadMatchingFeature(A,q,_,p.layers,p.availableImages,s,l,u,(ie,ce,he,pe=0)=>(J||(J=ro(ie,this.tileID.canonical,e.tileTransform)),ce.queryIntersectsFeature(v,ie,he,J,this.z,e.transform,e.pixelPosMatrix,S,pe)))}return A}loadMatchingFeature(e,s,l,u,p,_,v,w,D){const{featureIndex:M,bucketIndex:S,sourceLayerIndex:A,layoutVertexArrayOffset:z}=s,N=this.bucketLayerIDs[S];if(u&&!function(ie,ce){for(let he=0;he<ie.length;he++)if(ce.indexOf(ie[he])>=0)return!0;return!1}(u,N))return;const U=this.sourceLayerCoder.decode(A),q=this.vtLayers[U].feature(M);if(l.needGeometry){const ie=zl(q,!0);if(!l.filter(new pt(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!l.filter(new pt(this.tileID.overscaledZ),q))return;const J=this.getId(q,U);for(let ie=0;ie<N.length;ie++){const ce=N[ie];if(u&&u.indexOf(ce)<0)continue;const he=_[ce];if(!he)continue;let pe={};void 0!==J&&w&&(pe=w.getState(he.sourceLayer||"_geojsonTileLayer",J));const de=Nn({},v[ce]);de.paint=$_(de.paint,he.paint,q,pe,p),de.layout=$_(de.layout,he.layout,q,pe,p);const De=!D||D(q,he,pe,z);if(!De)continue;const we=new Xp(q,this.z,this.x,this.y,J);we.layer=de;let $e=e[ce];void 0===$e&&($e=e[ce]=[]),$e.push({featureIndex:M,feature:we,intersectionZ:De})}}lookupSymbolFeatures(e,s,l,u,p,_,v,w){const D={};this.loadVTLayers();const M=Eu(p);for(const S of e)this.loadMatchingFeature(D,{bucketIndex:l,sourceLayerIndex:u,featureIndex:S,layoutVertexArrayOffset:0},M,_,v,w,s);return D}loadFeature(e){const{featureIndex:s,sourceLayerIndex:l}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(l),p=this.vtFeatures[u];if(p[s])return p[s];const _=this.vtLayers[u].feature(s);return p[s]=_,_}hasLayer(e){for(const s of this.bucketLayerIDs)for(const l of s)if(e===l)return!0;return!1}getId(e,s){let l=e.id;return this.promoteId&&(l=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[s]],"boolean"==typeof l&&(l=Number(l))),l}}function $_(i,e,s,l,u){return Rs(i,(p,_)=>{const v=e instanceof ia?e.get(_):null;return v&&v.evaluate?v.evaluate(s,l,u):v})}function Um(i,e){return e-i}Xe("FeatureIndex",Qp,{omit:["rawTileData","sourceLayerCoder"]});var $m=Pn([{name:"a_pos",type:"Int16",components:2}]);const Qa=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,s=0,l=0,u=0,p=0,_=0,v=0;for(1&e?u=p=_=32:s=l=v=32;(e>>=1)>1;){const D=s+u>>1,M=l+p>>1;1&e?(u=s,p=l,s=_,l=v):(s=u,l=p,u=_,p=v),_=D,v=M}const w=4*i;Qa[w+0]=s,Qa[w+1]=l,Qa[w+2]=u,Qa[w+3]=p}const Ds=new Uint16Array(2178),xr=new Uint8Array(1089),_d=new Uint16Array(1089);function Gm(i){return 0===i?-.03125:32===i?.03125:0}var Hm=Pn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const G_={type:2,extent:Pt,loadGeometry:()=>[[new Ke(0,0),new Ke(8193,0),new Ke(8193,8193),new Ke(0,8193),new Ke(0,0)]]};class yd{constructor(e,s,l,u,p){this.tileID=e,this.uid=fl(),this.uses=0,this.tileSize=s,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const s=e+this.timeAdded;s<vi.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=tl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,s,l){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,p){const _={};if(!p)return _;for(const v of u){const w=v.layerIds.map(D=>p.getLayer(D)).filter(Boolean);if(0!==w.length){v.layers=w,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(D=>w.filter(M=>M.id===D)[0]));for(const D of w)_[D.id]=v}}return _}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof Ja){if(this.hasSymbolBuckets=!0,!l)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof Ja&&p.hasRTLText){this.hasRTLText=!0,Nt.isLoading()||Nt.isLoaded()||"deferred"!==qr()||Bi();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Bf}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Hp(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Hp(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Hp(e,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,l,u,p,_,v,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:v,transform:_,params:p,tileTransform:this.tileTransform},e,s,l):{}}querySourceFeatures(e,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),p=s?s.sourceLayer:"",_=u._geojsonTileLayer||u[p];if(!_)return;const v=Eu(s&&s.filter),{z:w,x:D,y:M}=this.tileID.canonical,S={z:w,x:D,y:M};for(let A=0;A<_.length;A++){const z=_.feature(A);if(v.needGeometry){const q=zl(z,!0);if(!v.filter(new pt(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!v.filter(new pt(this.tileID.overscaledZ),z))continue;const N=l.getId(z,p),U=new Xp(z,w,D,M,N);U.tile=S,e.push(U)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const l=zs(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const p=this.expirationTime-s;p?this.expirationTime=l+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!s)return;const l=this.latestFeatureIndex.loadVTLayers(),u=s.style.listImages();for(const p in this.buckets){if(!s.style.hasLayer(p))continue;const _=this.buckets[p],v=_.layers[0].sourceLayer||"_geojsonTileLayer",w=l[v],D=e[v];if(!w||!D||0===Object.keys(D).length)continue;if(_.update(D,w,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof Xh||_ instanceof Dp){const S=s.style._getSourceCache(_.layers[0].source);s._terrain&&s._terrain.enabled&&S&&_.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(S.id,this.tileID)}const M=s&&s.style&&s.style.getLayer(p);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<vi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=vi.now()+e}setDependencies(e,s){const l={};for(const u of s)l[u]=!0;this.dependencies[e]=l}hasDependency(e,s){for(const l of e){const u=this.dependencies[l];if(u)for(const p of s)if(u[p])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,s){if(!s||"mercator"===s.name||this._tileDebugBuffer)return;const l=ro(G_,this.tileID.canonical,this.tileTransform)[0],u=new Ac,p=new ip;for(let _=0;_<l.length;_++){const{x:v,y:w}=l[_];u.emplaceBack(v,w),p.emplaceBack(_)}p.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(u,Hm.members),this._tileDebugSegments=ht.simpleSegment(0,0,u.length,p.length)}_makeTileBoundsBuffers(e,s){if(this._tileBoundsBuffer||!s||"mercator"===s.name)return;const l=ro(G_,this.tileID.canonical,this.tileTransform)[0];let u,p;if(this.isRaster){const _=function(v,w){const D=tl(v,w),M=Math.pow(2,v.z);for(let q=0;q<33;q++)for(let J=0;J<33;J++){const ie=ws((v.x+(J+Gm(J))/32)/M),ce=Ci((v.y+(q+Gm(q))/32)/M),he=w.project(ie,ce),pe=33*q+J;Ds[2*pe+0]=Math.round((he.x*D.scale-D.x)*Pt),Ds[2*pe+1]=Math.round((he.y*D.scale-D.y)*Pt)}xr.fill(0),_d.fill(0);for(let q=2045;q>=0;q--){const J=4*q,ie=Qa[J+0],ce=Qa[J+1],he=Qa[J+2],pe=Qa[J+3],de=ie+he>>1,De=ce+pe>>1,we=de+De-ce,$e=De+ie-de,Be=33*ce+ie,Te=33*pe+he,Ve=33*De+de,Ze=Math.hypot((Ds[2*Be+0]+Ds[2*Te+0])/2-Ds[2*Ve+0],(Ds[2*Be+1]+Ds[2*Te+1])/2-Ds[2*Ve+1])>=16;if(xr[Ve]=xr[Ve]||(Ze?1:0),q<1022){const Pe=33*(ce+$e>>1)+(ie+we>>1),We=33*(pe+$e>>1)+(he+we>>1);xr[Ve]=xr[Ve]||xr[Pe]||xr[We]}}const S=new oa,A=new Fr;let z=0;function N(q,J){const ie=33*J+q;return 0===_d[ie]&&(S.emplaceBack(Ds[2*ie+0],Ds[2*ie+1],q*Pt/32,J*Pt/32),_d[ie]=++z),_d[ie]-1}function U(q,J,ie,ce,he,pe){const de=q+ie>>1,De=J+ce>>1;if(Math.abs(q-he)+Math.abs(J-pe)>1&&xr[33*De+de])U(he,pe,q,J,de,De),U(ie,ce,he,pe,de,De);else{const we=N(q,J),$e=N(ie,ce),Be=N(he,pe);A.emplaceBack(we,$e,Be)}}return U(0,0,32,32,32,0),U(32,32,0,0,0,32),{vertices:S,indices:A}}(this.tileID.canonical,s);u=_.vertices,p=_.indices}else{u=new oa,p=new Fr;for(const{x:v,y:w}of l)u.emplaceBack(v,w,0,0);const _=Gh(u.int16,void 0,4);for(let v=0;v<_.length;v+=3)p.emplaceBack(_[v],_[v+1],_[v+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,Hm.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(p),this._tileBoundsSegments=ht.simpleSegment(0,0,u.length,p.length)}}const Bv=Pn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),H_=Pn([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:vd}=Bv;function el(i,e){const s=i.fovAboveCenter,l=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,u=(i._camera.position[2]*i.worldSize-l)/Math.cos(i._pitch),p=Math.sin(s)*u/Math.sin(Math.max(Math.PI/2-i._pitch-s,.01)),_=Math.sin(i._pitch)*p+u;return Math.min(1.01*_,u*(1/i._horizonShift))}const ef=Pt/Math.PI/2,$i=-ef,Gi=ef,qm=[new Jo([$i,$i,$i],[Gi,Gi,Gi]),new Jo([$i,$i,$i],[0,0,Gi]),new Jo([0,$i,$i],[Gi,0,Gi]),new Jo([$i,0,$i],[0,Gi,Gi]),new Jo([0,0,$i],[Gi,Gi,Gi])];function xd(i){if(i.z<=1)return qm[i.z+2*i.y+i.x];const[e,s]=tf(i),l=[bd(e[0],e[1]),bd(e[0],s[1]),bd(s[0],e[1]),bd(s[0],s[1])],u=[Gi,Gi,Gi],p=[$i,$i,$i];for(const _ of l)u[0]=Math.min(u[0],_[0]),u[1]=Math.min(u[1],_[1]),u[2]=Math.min(u[2],_[2]),p[0]=Math.max(p[0],_[0]),p[1]=Math.max(p[1],_[1]),p[2]=Math.max(p[2],_[2]);return new Jo(u,p)}function tf(i){const e=Math.pow(2,i.z),s=i.x/e,l=(i.x+1)/e,u=(i.y+1)/e;return[[Ci(i.y/e),ws(s)],[Ci(u),ws(l)]]}function nf(i,e,s,l){return s=Ft(s),l||(l=ef),[i*Math.sin(s)*l,-e*l,i*Math.cos(s)*l]}function bd(i,e,s){return nf(Math.cos(Ft(i)),Math.sin(Ft(i)),e,s)}function rf(i){return 16383/Math.max(...Ps([],i.max,i.min))}function of(i){const e=ti(new Float64Array(16)),s=1/rf(i);return Zi(e,e,i.min),fr(e,e,[s,s,s]),e}function Zm(i,e,s){const l=e/(2*Math.PI),u=function(_){const v=Pt/(2*Math.PI);return _/(2*Math.PI)/v}(e);if(!s){const _=on(i.center.lat,-85.051129,Ko);s=[zc(i.center.lng)*e,qa(_)*e]}const p=ti(new Float64Array(16));return Zi(p,p,[s[0],s[1],-l]),fr(p,p,[u,u,u]),Po(p,p,Ft(-i._center.lat)),ao(p,p,Ft(-i._center.lng)),p}class To{constructor(e){const s=this._createGridIndices();this.gridIndexBuffer=e.createIndexBuffer(s,!0),this.gridSegments=ht.simpleSegment(0,0,4225,8192);const l=this._createPoleTriangleIndices();this.poleIndexBuffer=e.createIndexBuffer(l,!0),this.poleSegments=ht.simpleSegment(0,0,66,64);const u=new Ru;u.emplaceBack(-1,1,1,0,0,0,0),u.emplaceBack(1,1,1,0,0,1,0),u.emplaceBack(1,-1,1,0,0,1,1),u.emplaceBack(-1,-1,1,0,0,0,1);const p=new Fr;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.atmosphereVertexBuffer=e.createVertexBuffer(u,H_.members),this.atmosphereIndexBuffer=e.createIndexBuffer(p),this.atmosphereSegments=ht.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(e,s,l){const u=new Ru,p=s/Math.PI/2;u.emplaceBack(0,-p,0,0,0,.5,l?0:1);const _=360/e,v=Math.cos(Ft(85)),w=Math.sin(Ft(85));for(let M=0;M<=64;M++){const S=M/64,A=nf(v,w,0*(1-(D=S))+_*D,p);u.emplaceBack(A[0],A[1],A[2],0,0,S,l?0:1)}var D;return u}_createPoleTriangleIndices(){const e=new Fr;for(let s=0;s<=64;s++)e.emplaceBack(0,s+1,s+2);return e}static createGridVertices(e){const s=Math.pow(2,e.z),l=(w,D,M)=>w*(1-M)+D*M,[u,p]=tf(e),_=new Ru,v=function(w){const D=ti(new Float64Array(16)),M=rf(w);var S,A;return fr(D,D,[M,M,M]),Zi(D,D,((S=[])[0]=-(A=w.min)[0],S[1]=-A[1],S[2]=-A[2],S)),D}(xd(e));_.reserve(4096);for(let w=0;w<65;w++){const D=l(u[0],p[0],w/64),M=qa(D),S=M*s-e.y,A=Math.sin(Ft(D)),z=Math.cos(Ft(D));for(let N=0;N<65;N++){const U=N/64,q=l(u[1],p[1],U),J=nf(z,A,q);Ut(J,J,v);const ie=zc(q);_.emplaceBack(J[0],J[1],J[2],ie,M,U,S)}}return _}_createGridIndices(){const e=new Fr,s=(l,u)=>{const p=65*u+l;e.emplaceBack(p+1,p,p+65),e.emplaceBack(p+65,p+65+1,p+1)};for(let l=0;l<64;l++)for(let u=0;u<64;u++)s(u,l);return e}getWirefameBuffer(e){if(!this.wireframeSegments){const s=this._createWireframeGrid();this.wireframeIndexBuffer=e.createIndexBuffer(s),this.wireframeSegments=ht.simpleSegment(0,0,4096,s.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const e=new kl,s=(l,u)=>{const p=65*u+l;e.emplaceBack(p,p+1),e.emplaceBack(p,p+65),e.emplaceBack(p,p+65+1)};for(let l=0;l<64;l++)for(let u=0;u<64;u++)s(u,l);return e}}function tl(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const s=Math.pow(2,-i.z),l=i.x*s,u=(i.x+1)*s,p=i.y*s,_=(i.y+1)*s,v=ws(l),w=ws(u),D=Ci(p),M=Ci(_),S=e.project(v,D),A=e.project(w,D),z=e.project(w,M),N=e.project(v,M);let U=Math.min(S.x,A.x,z.x,N.x),q=Math.min(S.y,A.y,z.y,N.y),J=Math.max(S.x,A.x,z.x,N.x),ie=Math.max(S.y,A.y,z.y,N.y);const ce=s/16;function he(de,De,we,$e,Be,Te){const Ve=(we+Be)/2,Ze=($e+Te)/2,Pe=e.project(ws(Ve),Ci(Ze)),We=Math.max(0,U-Pe.x,q-Pe.y,Pe.x-J,Pe.y-ie);U=Math.min(U,Pe.x),J=Math.max(J,Pe.x),q=Math.min(q,Pe.y),ie=Math.max(ie,Pe.y),We>ce&&(he(de,Pe,we,$e,Ve,Ze),he(Pe,De,Ve,Ze,Be,Te))}he(S,A,l,p,u,p),he(A,z,u,p,u,_),he(z,N,u,_,l,_),he(N,S,l,_,l,p),U-=ce,q-=ce,J+=ce,ie+=ce;const pe=1/Math.max(J-U,ie-q);return{scale:pe,x:U*pe,y:q*pe,x2:J*pe,y2:ie*pe,projection:e}}class Wm{constructor(e){const s={},l=[];for(const v in e){const w=e[v],D=s[v]={};for(const M in w.glyphs){const S=w.glyphs[+M];if(!S||0===S.bitmap.width||0===S.bitmap.height)continue;const A=S.metrics.localGlyph?2:1,z={x:0,y:0,w:S.bitmap.width+2*A,h:S.bitmap.height+2*A};l.push(z),D[M]=z}}const{w:u,h:p}=Qh(l),_=new Bl({width:u||1,height:p||1});for(const v in e){const w=e[v];for(const D in w.glyphs){const M=w.glyphs[+D];if(!M||0===M.bitmap.width||0===M.bitmap.height)continue;const S=s[v][D],A=M.metrics.localGlyph?2:1;Bl.copy(M.bitmap,_,{x:0,y:0},{x:S.x+A,y:S.y+A},M.bitmap)}}this.image=_,this.positions=s}}Xe("GlyphAtlas",Wm);class q_{constructor(e){this.tileID=new hi(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=tl(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,s,l,u,p){this.status="parsing",this.data=e,this.collisionBoxArray=new Bf;const _=new Vm(Object.keys(e.layers).sort()),v=new Qp(this.tileID,this.promoteId);v.bucketLayerIDs=[];const w={},D=new Nm(256,256),M={featureIndex:v,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:l},S=s.familiesBySource[this.source];for(const pe in S){const de=e.layers[pe];if(!de)continue;let De=!1,we=!1;for(const Te of S[pe])"symbol"===Te[0].type?De=!0:we=!0;if(!0===this.isSymbolTile&&!De||!1===this.isSymbolTile&&!we)continue;1===de.version&&Mn(`Vector tile source "${this.source}" layer "${pe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const $e=_.encode(pe),Be=[];for(let Te=0;Te<de.length;Te++){const Ve=de.feature(Te),Ze=v.getId(Ve,pe);Be.push({feature:Ve,id:Ze,index:Te,sourceLayerIndex:$e})}for(const Te of S[pe]){const Ve=Te[0];void 0!==this.isSymbolTile&&"symbol"===Ve.type!==this.isSymbolTile||Ve.minzoom&&this.zoom<Math.floor(Ve.minzoom)||Ve.maxzoom&&this.zoom>=Ve.maxzoom||"none"!==Ve.visibility&&(Xm(Te,this.zoom,l),(w[Ve.id]=Ve.createBucket({index:v.bucketLayerIDs.length,layers:Te,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:$e,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:l})).populate(Be,M,this.tileID.canonical,this.tileTransform),v.bucketLayerIDs.push(Te.map(Ze=>Ze.id)))}}let A,z,N,U;D.trim();const q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},J=Rs(M.glyphDependencies,pe=>Object.keys(pe).map(Number));Object.keys(J).length?u.send("getGlyphs",{uid:this.uid,stacks:J},(pe,de)=>{A||(A=pe,z=de,he.call(this))},void 0,!1,q):z={};const ie=Object.keys(M.iconDependencies);ie.length?u.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"icons"},(pe,de)=>{A||(A=pe,N=de,he.call(this))},void 0,!1,q):N={};const ce=Object.keys(M.patternDependencies);function he(){if(A)return p(A);if(z&&N&&U){const pe=new Wm(z),de=new Cm(N,U);for(const De in w){const we=w[De];we instanceof Ja?(Xm(we.layers,this.zoom,l),Fm(we,z,pe.positions,N,de.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom,this.projection),we.projection=this.projection.name):we.hasPattern&&(we instanceof Xh||we instanceof Dp||we instanceof Wu)&&(Xm(we.layers,this.zoom,l),we.addFeatures(M,this.tileID.canonical,de.patternPositions,l))}this.status="done",p(null,{buckets:Ai(w).filter(De=>!De.isEmpty()),featureIndex:v,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pe.image,lineAtlas:D,imageAtlas:de,glyphMap:this.returnDependencies?z:null,iconMap:this.returnDependencies?N:null,glyphPositions:this.returnDependencies?pe.positions:null})}}ce.length?u.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"patterns"},(pe,de)=>{A||(A=pe,U=de,he.call(this))},void 0,!1,q):U={},he.call(this)}}function Xm(i,e,s){const l=new pt(e);for(const u of i)u.recalculate(l,s)}class sf{constructor(e){this.entries={},this.scheduler=e}request(e,s,l,u){const p=this.entries[e]=this.entries[e]||{callbacks:[]};if(p.result){const[_,v]=p.result;return this.scheduler?this.scheduler.add(()=>{u(_,v)},s):u(_,v),()=>{}}return p.callbacks.push(u),p.cancel||(p.cancel=l((_,v)=>{p.result=[_,v];for(const w of p.callbacks)this.scheduler?this.scheduler.add(()=>{w(_,v)},s):w(_,v);setTimeout(()=>delete this.entries[e],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(_=>_!==u),p.callbacks.length||(p.cancel(),delete this.entries[e]))}}}function Km(i,e,s){const l=JSON.stringify(i.request);return i.data&&(this.deduped.entries[l]={result:[null,i.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},u=>{const p=Aa(i.request,(_,v,w,D)=>{_?u(_):v&&u(null,{vectorTile:s?void 0:new Xa.VectorTile(new Vl(v)),rawData:v,cacheControl:w,expires:D})});return()=>{p.cancel(),u()}},e)}const Z_=ti(new Float64Array(16));class Yl{constructor(e,s){this._tr=e,this._worldSize=s}createInversionMatrix(){return Z_}createTileMatrix(e){let s,l,u;const p=e.canonical,_=ti(new Float64Array(16)),v=this._tr.projection;if(v.isReprojectedInTileSpace){const w=tl(p,v);s=1,l=w.x+e.wrap*w.scale,u=w.y,fr(_,_,[s/w.scale,s/w.scale,this._tr.pixelsPerMeter/this._worldSize])}else s=this._worldSize/this._tr.zoomScale(p.z),l=(p.x+Math.pow(2,p.z)*e.wrap)*s,u=p.y*s;return Zi(_,_,[l,u,0]),fr(_,_,[s/Pt,s/Pt,1]),_}pointCoordinate(e,s,l){const u=this._tr.horizonLineFromTop(!1),p=new Ke(e,Math.max(u,s));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(p,l))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var af={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&hc(this.parallels,this.constants.parallels))return;const i=Math.sin(Ft(this.parallels[0])),e=(i+Math.sin(Ft(this.parallels[1])))/2,s=1+i*(2*e-i),l=Math.sqrt(s)/e;this.constants={n:e,c:s,r0:l,parallels:this.parallels}},project(i,e){this.initializeConstants();const s=Ft(i-this.center[0]),l=Ft(e),{n:u,c:p,r0:_}=this.constants,v=Math.sqrt(p-2*u*Math.sin(l))/u;return{x:v*Math.sin(s*u),y:v*Math.cos(s*u)-_,z:0}},unproject(i,e){this.initializeConstants();const{n:s,c:l,r0:u}=this.constants,p=u+e;let _=Math.atan2(i,Math.abs(p))*Math.sign(p);p*s<0&&(_-=Math.PI*Math.sign(i)*Math.sign(p));const v=Ft(this.center[0])*s;_=as(_,-Math.PI-v,Math.PI-v);const w=gi(_/s)+this.center[0],D=Math.asin(on((l-(i*i+p*p)*s*s)/(2*s),-1,1)),M=on(gi(D),-85.051129,Ko);return new Kt(w,M)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ji(1,i)*e,farthestPixelDistance(i){return el(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new Yl(i,e)};const ch=1.340264,uh=-.081106,nl=893e-6,Ql=.003796,wd=Math.sqrt(3)/2;var lf={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(i,e){e=e/180*Math.PI,i=i/180*Math.PI;const s=Math.asin(wd*Math.sin(e)),l=s*s,u=l*l*l;return{x:.5*(i*Math.cos(s)/(wd*(ch+3*uh*l+u*(7*nl+9*Ql*l)))/Math.PI+.5),y:1-.5*(s*(ch+uh*l+u*(nl+Ql*l))/Math.PI+1),z:0}},unproject(i,e){i=(2*i-.5)*Math.PI;let s=e=(2*(1-e)-1)*Math.PI,l=s*s,u=l*l*l;for(let D,M,S,A=0;A<12&&(M=s*(ch+uh*l+u*(nl+Ql*l))-e,S=ch+3*uh*l+u*(7*nl+9*Ql*l),D=M/S,s=on(s-D,-Math.PI/3,Math.PI/3),l=s*s,u=l*l*l,!(Math.abs(D)<1e-12));++A);const p=wd*i*(ch+3*uh*l+u*(7*nl+9*Ql*l))/Math.cos(s),_=Math.asin(Math.sin(s)/wd),v=on(180*p/Math.PI,-180,180),w=on(180*_/Math.PI,-85.051129,Ko);return new Kt(v,w)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ji(1,i)*e,farthestPixelDistance(i){return el(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new Yl(i,e)},cf={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(i,e)=>({x:.5+i/360,y:.5-e/360,z:0}),unproject(i,e){const s=360*(i-.5),l=on(360*(.5-e),-85.051129,Ko);return new Kt(s,l)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ji(1,i)*e,farthestPixelDistance(i){return el(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new Yl(i,e)};const ec=Math.PI/2;function Ed(i){return Math.tan((ec+i)/2)}var W_={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&hc(this.parallels,this.constants.parallels))return;const i=Ft(this.parallels[0]),e=Ft(this.parallels[1]),s=Math.cos(i),l=i===e?Math.sin(i):Math.log(s/Math.cos(e))/Math.log(Ed(e)/Ed(i)),u=s*Math.pow(Ed(i),l)/l;this.constants={n:l,f:u,parallels:this.parallels}},project(i,e){this.initializeConstants(),e=Ft(e),i=Ft(i-this.center[0]);const s=1e-6,{n:l,f:u}=this.constants;u>0?e<-ec+s&&(e=-ec+s):e>ec-s&&(e=ec-s);const p=u/Math.pow(Ed(e),l),_=p*Math.sin(l*i),v=u-p*Math.cos(l*i);return{x:.5*(_/Math.PI+.5),y:1-.5*(v/Math.PI+.5),z:0}},unproject(i,e){this.initializeConstants(),i=(2*i-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:s,f:l}=this.constants,u=l-e,p=Math.sign(u),_=Math.sign(s)*Math.sqrt(i*i+u*u);let v=Math.atan2(i,Math.abs(u))*p;u*s<0&&(v-=Math.PI*Math.sign(i)*p);const w=on(gi(v/s)+this.center[0],-180,180),D=on(gi(2*Math.atan(Math.pow(l/_,1/s))-ec),-85.051129,Ko);return new Kt(w,D)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ji(1,i)*e,farthestPixelDistance(i){return el(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new Yl(i,e)},uf={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(i,e)=>({x:zc(i),y:qa(e),z:0}),unproject(i,e){const s=ws(i),l=Ci(e);return new Kt(s,l)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ji(1,i)*e,farthestPixelDistance(i){return el(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new Yl(i,e)};const X_=Ft(Ko);var K_={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(i,e){const s=(e=Ft(e))*e,l=s*s;return{x:.5*((i=Ft(i))*(.8707-.131979*s+l*(l*(.003971*s-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+s*(.015085+l*(.028874*s-.044475-.005916*l)))/Math.PI+1),z:0}},unproject(i,e){i=(2*i-.5)*Math.PI;let s=e=(2*(1-e)-1)*Math.PI,l=25,u=0,p=s*s;do{p=s*s;const w=p*p;u=(s*(1.007226+p*(.015085+w*(.028874*p-.044475-.005916*w)))-e)/(1.007226+p*(.045255+w*(.259866*p-.311325-.005916*11*w))),s=on(s-u,-X_,X_)}while(Math.abs(u)>1e-6&&--l>0);p=s*s;const _=on(gi(i/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),v=gi(s);return new Kt(_,v)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ji(1,i)*e,farthestPixelDistance(i){return el(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new Yl(i,e)};const hf=Ft(Ko),df={albers:af,equalEarth:lf,equirectangular:cf,lambertConformalConic:W_,mercator:uf,naturalEarth:K_,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(i,e){e=Ft(e),i=Ft(i);const s=Math.cos(e),l=2/Math.PI,u=Math.acos(s*Math.cos(i/2)),p=Math.sin(u)/u,_=.5*(i*l+2*s*Math.sin(i/2)/p)||0,v=.5*(e+Math.sin(e)/p)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}},unproject(i,e){let s=i=(2*i-.5)*Math.PI,l=e=(2*(1-e)-1)*Math.PI,u=25;const p=1e-6;let _=0,v=0;do{const w=Math.cos(l),D=Math.sin(l),M=2*D*w,S=D*D,A=w*w,z=Math.cos(s/2),N=Math.sin(s/2),U=2*z*N,q=N*N,J=1-A*z*z,ie=J?1/J:0,ce=J?Math.acos(w*z)*Math.sqrt(1/J):0,he=.5*(2*ce*w*N+2*s/Math.PI)-i,pe=.5*(ce*D+l)-e,de=.5*ie*(A*q+ce*w*z*S)+1/Math.PI,De=ie*(U*M/4-ce*D*N),we=.125*ie*(M*N-ce*D*A*U),$e=.5*ie*(S*z+ce*q*w)+.5,Be=De*we-$e*de;_=(pe*De-he*$e)/Be,v=(he*we-pe*de)/Be,s=on(s-_,-Math.PI,Math.PI),l=on(l-v,-hf,hf)}while((Math.abs(_)>p||Math.abs(v)>p)&&--u>0);return new Kt(gi(s),gi(l))},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ji(1,i)*e,farthestPixelDistance(i){return el(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new Yl(i,e)}};d.ARRAY_TYPE=Tn,d.AUTH_ERR_MSG=ye,d.Aabb=Jo,d.Actor=class{constructor(i,e,s){this.target=i,this.parent=e,this.mapId=s,this.callbacks={},this.cancelCallbacks={},ml(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ki()?i:Ae,this.scheduler=new Ov}send(i,e,s,l,u=!1,p){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=p,this.callbacks[_]=s);const v=uo(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:i,hasCallback:!!s,targetMapId:l,mustQueue:u,sourceMapId:this.mapId,data:Di(e,v)},v),{cancel:()=>{s&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(i){const e=i.data,s=e.id;if(s&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const l=this.cancelCallbacks[s];delete this.cancelCallbacks[s],l&&l.cancel()}else if(e.mustQueue||Ki()){const l=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,e),l&&l.metadata||{type:"message"})}else this.processTask(s,e)}processTask(i,e){if("<response>"===e.type){const s=this.callbacks[i];delete this.callbacks[i],s&&(e.error?s(bs(e.error)):s(null,bs(e.data)))}else{const s=uo(this.globalScope)?void 0:[],l=e.hasCallback?(p,_)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:p?Di(p):null,data:Di(_,s)},s)}:p=>{},u=bs(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,l);else if(this.parent.getWorkerSource){const p=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,p[0],u.source)[p[1]](u,l)}else l(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},d.CanonicalTileID=Kc,d.Color=Ht,d.ColorMode=Kr,d.CullFaceMode=io,d.DEMData=ah,d.DataConstantProperty=tt,d.DedupedRequest=sf,d.DepthMode=Wl,d.EXTENT=Pt,d.Elevation=class{getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,s=!0){null==e&&(e=null);const l=this._source();if(!l||i.y<0||i.y>1)return e;const u=l.getSource().maxzoom,p=1<<u,_=Math.floor(i.x),v=i.x-_,w=new hi(u,_,u,Math.floor(v*p),Math.floor(i.y*p)),D=this.findDEMTileFor(w);if(!D||!D.dem)return e;const M=D.dem,S=1<<D.tileID.canonical.z,A=(v*S-D.tileID.canonical.x)*M.dim,z=(i.y*S-D.tileID.canonical.y)*M.dim,N=Math.floor(A),U=Math.floor(z);return(s?this.exaggeration():1)*Rt(Rt(M.get(N,U),M.get(N,U+1),z-U),Rt(M.get(N+1,U),M.get(N+1,U+1),z-U),A-N)}getAtTileOffset(i,e,s){const l=1<<i.canonical.z;return this.getAtPointOrZero(new Oc(i.wrap+(i.canonical.x+e/Pt)/l,(i.canonical.y+s/Pt)/l))}getAtTileOffsetFunc(i,e){return s=>{const l=this.getAtTileOffset(i,s.x,s.y),u=e.upVector(i.canonical,s.x,s.y);return Xi(u,u,l*e.upVectorScale(i.canonical)),u}}getForTilePoints(i,e,s,l){const u=gd.create(this,i,l);return!!u&&(e.forEach(p=>{p[2]=this.exaggeration()*u.getElevationAt(p[0],p[1],s)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const s=e.dem.tree,l=e.tileID,u=1<<i.canonical.z-l.canonical.z;let p=i.canonical.x/u-l.canonical.x,_=i.canonical.y/u-l.canonical.y,v=0;for(let w=0;w<i.canonical.z-l.canonical.z&&!s.leaves[v];w++){p*=2,_*=2;const D=2*Math.floor(_)+Math.floor(p);v=s.childOffsets[v]+D,p%=1,_%=1}return{min:this.exaggeration()*s.minimums[v],max:this.exaggeration()*s.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,s){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},d.ErrorEvent=au,d.EvaluationParameters=pt,d.Event=Qn,d.Evented=hs,d.Frustum=mp,d.GLOBE_ZOOM_THRESHOLD_MAX=6,d.GlobeSharedBuffers=To,d.GlyphManager=Gl,d.ImagePosition=ed,d.LineAtlas=Nm,d.LngLat=Kt,d.LngLatBounds=Ll,d.LocalGlyphMode=Bp,d.MAX_MERCATOR_LATITUDE=Ko,d.MercatorCoordinate=Oc,d.ONE_EM=24,d.OverscaledTileID=hi,d.Properties=rr,d.RGBAImage=Ui,d.Ray=class{constructor(i,e){this.pos=i,this.dir=e}intersectsPlane(i,e,s){const l=lo(e,this.dir);if(Math.abs(l)<1e-6)return!1;const u=((i[0]-this.pos[0])*e[0]+(i[1]-this.pos[1])*e[1]+(i[2]-this.pos[2])*e[2])/l;return s[0]=this.pos[0]+this.dir[0]*u,s[1]=this.pos[1]+this.dir[1]*u,s[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(i,e,s){if(N=(A=this.pos)[0],U=A[1],q=A[2],J=(z=i)[0],ie=z[1],ce=z[2],Math.abs(N-J)<=mi*Math.max(1,Math.abs(N),Math.abs(J))&&Math.abs(U-ie)<=mi*Math.max(1,Math.abs(U),Math.abs(ie))&&Math.abs(q-ce)<=mi*Math.max(1,Math.abs(q),Math.abs(ce))||0===e)return s[0]=s[1]=s[2]=0,!1;var A,z,N,U,q,J,ie,ce;const[l,u,p]=this.dir,_=this.pos[0]-i[0],v=this.pos[1]-i[1],w=this.pos[2]-i[2],D=l*l+u*u+p*p,M=2*(_*l+v*u+w*p),S=M*M-4*D*(_*_+v*v+w*w-e*e);if(S<0){const A=Math.max(-M/2,0),z=_+l*A,N=v+u*A,U=w+p*A,q=Math.hypot(z,N,U);return s[0]=z*e/q,s[1]=N*e/q,s[2]=U*e/q,!1}{const A=(-M-Math.sqrt(S))/(2*D);if(A<0){const z=Math.hypot(_,v,w);return s[0]=_*e/z,s[1]=v*e/z,s[2]=w*e/z,!1}return s[0]=_+l*A,s[1]=v+u*A,s[2]=w+p*A,!0}}},d.RequestManager=class{constructor(i,e,s){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let s=0;s<10;s++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ue,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!Me(i))return i;const s=nt(i);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!Me(i))return i;const s=nt(i);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||e)}normalizeSourceURL(i,e){if(!Me(i))return i;const s=nt(i);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||e)}normalizeSpriteURL(i,e,s,l){const u=nt(i);return Me(i)?(u.path=`/styles/v1${u.path}/sprite${e}${s}`,this._makeAPIURL(u,this._customAccessToken||l)):(u.path+=`${e}${s}`,ct(u))}normalizeTileURL(i,e,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Me(i))return i;const l=nt(i);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||s&&"raster"!==l.authority&&512===s?"@2x":""}${V.supported?".webp":"$1"}`),"raster"===l.authority?l.path=`/${L.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${L.TILE_URL_VERSION}${l.path}`);const u=this._customAccessToken||function(p){for(const _ of p){const v=_.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(l.params)||L.ACCESS_TOKEN;return L.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,u)}canonicalizeTileURL(i,e){const s=nt(i);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return i;let l="mapbox://";s.path.match(/^\/raster\/v1\//)?l+=`raster/${s.path.replace(`/${L.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${s.path.replace(`/${L.TILE_URL_VERSION}/`,"")}`;let u=s.params;return e&&(u=u.filter(p=>!p.match(/^access_token=/))),u.length&&(l+=`?${u.join("&")}`),l}canonicalizeTileset(i,e){const s=!!e&&Me(e),l=[];for(const u of i.tiles||[])Se(u)?l.push(this.canonicalizeTileURL(u,s)):l.push(u);return l}_makeAPIURL(i,e){const s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",l=nt(L.API_URL);if(i.protocol=l.protocol,i.authority=l.authority,"http"===i.protocol){const u=i.params.indexOf("secure");u>=0&&i.params.splice(u,1)}if("/"!==l.path&&(i.path=`${l.path}${i.path}`),!L.REQUIRE_ACCESS_TOKEN)return ct(i);if(e=e||L.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return i.params=i.params.filter(u=>-1===u.indexOf("access_token")),i.params.push(`access_token=${e||""}`),ct(i)}},d.ResourceType=Sa,d.SegmentVector=ht,d.SourceCache=pa,d.StencilMode=Zp,d.StructArrayLayout1ui2=ip,d.StructArrayLayout2f1f2i16=Ga,d.StructArrayLayout2i4=Ac,d.StructArrayLayout2ui4=kl,d.StructArrayLayout3f12=Pc,d.StructArrayLayout3ui6=Fr,d.StructArrayLayout4i8=oa,d.Texture=Hp,d.Tile=yd,d.Transitionable=Zr,d.Uniform1f=la,d.Uniform1i=class extends Wo{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},d.Uniform2f=class extends Wo{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},d.Uniform3f=class extends Wo{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},d.Uniform4f=Gg,d.UniformColor=ap,d.UniformMatrix2f=class extends Wo{constructor(i,e){super(i,e),this.current=Zg}set(i){for(let e=0;e<4;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},d.UniformMatrix3f=class extends Wo{constructor(i,e){super(i,e),this.current=qg}set(i){for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},d.UniformMatrix4f=class extends Wo{constructor(i,e){super(i,e),this.current=Hg}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},d.UnwrappedTileID=qp,d.ValidationError=qe,d.VectorTileWorkerSource=class extends hs{constructor(i,e,s,l,u){super(),this.actor=i,this.layerIndex=e,this.availableImages=s,this.loadVectorData=u||Km,this.loading={},this.loaded={},this.deduped=new sf(i.scheduler),this.isSpriteLoaded=l,this.scheduler=i.scheduler}loadTile(i,e){const s=i.uid,l=i&&i.request,u=l&&l.collectResourceTiming,p=this.loading[s]=new q_(i);p.abort=this.loadVectorData(i,(_,v)=>{const w=!this.loading[s];if(delete this.loading[s],w||_||!v)return p.status="done",w||(this.loaded[s]=p),e(_);const D=v.rawData,M={};v.expires&&(M.expires=v.expires),v.cacheControl&&(M.cacheControl=v.cacheControl),p.vectorTile=v.vectorTile||new Xa.VectorTile(new Vl(D));const S=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(A,z)=>{if(A||!z)return e(A);const N={};if(u){const U=j_(l);U.length>0&&(N.resourceTiming=JSON.parse(JSON.stringify(U)))}e(null,Nn({rawTileData:D.slice(0)},z,M,N))})};this.isSpriteLoaded?S():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(S,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):S()}),this.loaded=this.loaded||{},this.loaded[s]=p})}reloadTile(i,e){const s=this.loaded,l=i.uid,u=this;if(s&&s[l]){const p=s[l];p.showCollisionBoxes=i.showCollisionBoxes,p.enableTerrain=!!i.enableTerrain,p.projection=i.projection;const _=(v,w)=>{const D=p.reloadCallback;D&&(delete p.reloadCallback,p.parse(p.vectorTile,u.layerIndex,this.availableImages,u.actor,D)),e(v,w)};"parsing"===p.status?p.reloadCallback=_:"done"===p.status&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(i,e){const s=i.uid,l=this.loading[s];l&&(l.abort&&l.abort(),delete this.loading[s]),e()}removeTile(i,e){const s=this.loaded,l=i.uid;s&&s[l]&&delete s[l],e()}},d.WritingMode=ci,d.ZoomHistory=f,d.add=hl,d.addDynamicAttributes=rh,d.adjoint=function(i,e){var s=e[0],l=e[1],u=e[2],p=e[3],_=e[4],v=e[5],w=e[6],D=e[7],M=e[8];return i[0]=_*M-v*D,i[1]=u*D-l*M,i[2]=l*v-u*_,i[3]=v*w-p*M,i[4]=s*M-u*w,i[5]=u*p-s*v,i[6]=p*D-_*w,i[7]=l*w-s*D,i[8]=s*_-l*p,i},d.asyncAll=Ca,d.bezier=dc,d.bindAll=ml,d.boundsAttributes=Hm,d.bufferConvexPolygon=function(i,e){const s=[];for(let l=0;l<i.length;l++){const u=as(l-1,-1,i.length-1),p=as(l+1,-1,i.length-1),_=i[l],v=i[p],w=i[u].sub(_).unit(),D=v.sub(_).unit(),M=D.angleWithSep(w.x,w.y),S=w.add(D).unit().mult(-1*e/Math.sin(M/2));s.push(_.add(S))}return s},d.cacheEntryPossiblyAdded=function(i){nn++,nn>yl&&(i.getActor().send("enforceCacheSizeLimit",vh),nn=0)},d.calculateGlobeMatrix=Zm,d.calculateGlobeMercatorMatrix=function(i){const e=i.worldSize,s=on(i.center.lat,-85.051129,Ko),l=new Ke(zc(i.center.lng)*e,qa(s)*e),u=ji(1,i.center.lat)*e,p=i.pixelsPerMeter,_=e/(u/i.pixelsPerMeter),v=ti(new Float64Array(16));return Zi(v,v,[l.x,l.y,0]),fr(v,v,[_,_,p]),v},d.clamp=on,d.clearTileCache=function(i){const e=Ae.caches.delete($n);i&&e.catch(i).then(()=>i())},d.clipLine=Op,d.clone=function(i){var e=new Tn(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},d.clone$1=_i,d.collisionCircleLayout=Av,d.config=L,d.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},d.create=function(){var i=new Tn(16);return Tn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},d.create$1=ll,d.createExpression=za,d.createLayout=Pn,d.createStyleLayer=function(i){return"custom"===i.type?new Rv(i):new O_[i.type](i)},d.cross=ba,d.degToRad=Ft,d.div=function(i,e,s){return i[0]=e[0]/s[0],i[1]=e[1]/s[1],i[2]=e[2]/s[2],i},d.dot=lo,d.ease=Ta,d.easeCubicInOut=Da,d.emitValidationErrors=Mc,d.endsWith=gl,d.enforceCacheSizeLimit=function(i){sn(),ho&&ho.then(e=>{e.keys().then(s=>{for(let l=0;l<s.length-i;l++)e.delete(s[l])})})},d.evaluateSizeForFeature=li,d.evaluateSizeForZoom=Ka,d.evaluateVariableOffset=Eo,d.evented=kr,d.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},d.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},d.exported=vi,d.exported$1=V,d.extend=Nn,d.extend$1=Bs,d.filterObject=Ls,d.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},d.fromQuat=function(i,e){var s=e[0],l=e[1],u=e[2],p=e[3],_=s+s,v=l+l,w=u+u,D=s*_,M=l*_,S=l*v,A=u*_,z=u*v,N=u*w,U=p*_,q=p*v,J=p*w;return i[0]=1-S-N,i[1]=M+J,i[2]=A-q,i[3]=0,i[4]=M-J,i[5]=1-D-N,i[6]=z+U,i[7]=0,i[8]=A+q,i[9]=z-U,i[10]=1-D-S,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},d.fromRotation=function(i,e){var s=Math.sin(e),l=Math.cos(e);return i[0]=l,i[1]=s,i[2]=0,i[3]=-s,i[4]=l,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},d.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},d.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return Ea[e]},d.getAABBPointSquareDist=function(i,e,s){let l=0;for(let u=0;u<2;++u){const p=s?s[u]:0;i[u]>p&&(l+=(i[u]-p)*(i[u]-p)),e[u]<p&&(l+=(p-e[u])*(p-e[u]))}return l},d.getAnchorAlignment=eh,d.getAnchorJustification=Np,d.getBounds=function(i){let e=1/0,s=1/0,l=-1/0,u=-1/0;for(const p of i)e=Math.min(e,p.x),s=Math.min(s,p.y),l=Math.max(l,p.x),u=Math.max(u,p.y);return{min:new Ke(e,s),max:new Ke(l,u)}},d.getColumn=function(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]},d.getImage=Gd,d.getJSON=function(i,e){return mt(Nn(i,{type:"json"}),e)},d.getMapSessionAPI=us,d.getPerformanceMeasurement=j_,d.getProjection=function(i){const e=df[i.name];if(!e)throw new Error(`Invalid projection name: ${i.name}`);return e.conic?function(s,l){if(l.parallels&&Math.abs(l.parallels[0]+l.parallels[1])<.01){let u=function(p){const _=Math.max(.01,Math.cos(Ft(p))),v=1/(2*Math.max(Math.PI*_,1/_));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(w,D){const M=Ft(w)*_,S=Math.sin(Ft(D))/_;return{x:M*v+.5,y:-S*v+.5,z:0}},unproject(w,D){const M=-(D-.5)/v,S=on(gi((w-.5)/v)/_,-180,180),A=Math.asin(on(M*_,-1,1)),z=on(gi(A),-85.051129,Ko);return new Kt(S,z)}}}(l.parallels[0]);if("lambertConformalConic"===l.name){const{project:p,unproject:_}=df.mercator;u={wrap:!0,supportsWorldCopies:!0,project:p,unproject:_}}return Nn({},s,l,u)}return Nn({},s,l)}(e,i):e},d.getRTLTextPluginStatus=qr,d.getReferrer=bl,d.getTilePoint=function(i,{x:e,y:s},l=0){return new Ke(((e-l)*i.scale-i.x)*Pt,(s*i.scale-i.y)*Pt)},d.getTileVec3=function(i,e,s=0){return Wi(((e.x-s)*i.scale-i.x)*Pt,(e.y*i.scale-i.y)*Pt,Hf(e.z,e.y))},d.getVideo=function(i,e){const s=Ae.document.createElement("video");s.muted=!0,s.onloadstart=function(){e(null,s)};for(let l=0;l<i.length;l++){const u=Ae.document.createElement("source");gc(i[l])||(s.crossOrigin="Anonymous"),u.src=i[l],s.appendChild(u)}return{cancel:()=>{}}},d.globeBuffersForTileMesh=function(i,e,s,l){const u=i.context,p=i.transform;let _=e.globeGridBuffer,v=e.globePoleBuffer;if(!_){const w=To.createGridVertices(s.canonical);_=e.globeGridBuffer=u.createVertexBuffer(w,vd,!1)}if(!v){const w=To.createPoleTriangleVertices(l,p.tileSize*l,0===s.canonical.y);v=e.globePoleBuffer=u.createVertexBuffer(w,vd,!1)}return[_,v]},d.globeDenormalizeECEF=of,d.globeMatrixForTile=function(i,e){const s=of(xd(i)),l=((u=new Float64Array(16))[0]=(p=e)[0],u[1]=p[1],u[2]=p[2],u[3]=p[3],u[4]=p[4],u[5]=p[5],u[6]=p[6],u[7]=p[7],u[8]=p[8],u[9]=p[9],u[10]=p[10],u[11]=p[11],u[12]=p[12],u[13]=p[13],u[14]=p[14],u[15]=p[15],u);var u,p;return ko(l,l,s),l},d.globePoleMatrixForTile=function(i,e,s){const l=ti(new Float64Array(16)),u=Math.pow(2,i.z),p=(i.x-u/2)/u*Math.PI*2,_=s.point,v=s.worldSize/(s.tileSize*u);return Zi(l,l,[_.x,_.y,-s.worldSize/Math.PI/2]),fr(l,l,[v,v,v]),Po(l,l,Ft(-s._center.lat)),ao(l,l,Ft(-s._center.lng)),ao(l,l,p),e&&fr(l,l,[1,-1,1]),l},d.globeTileBounds=xd,d.globeToMercatorTransition=function(i){return Fs(5,6,i)},d.identity=ti,d.identity$1=iu,d.invert=function(i,e){var s=e[0],l=e[1],u=e[2],p=e[3],_=e[4],v=e[5],w=e[6],D=e[7],M=e[8],S=e[9],A=e[10],z=e[11],N=e[12],U=e[13],q=e[14],J=e[15],ie=s*v-l*_,ce=s*w-u*_,he=s*D-p*_,pe=l*w-u*v,de=l*D-p*v,De=u*D-p*w,we=M*U-S*N,$e=M*q-A*N,Be=M*J-z*N,Te=S*q-A*U,Ve=S*J-z*U,Ze=A*J-z*q,Pe=ie*Ze-ce*Ve+he*Te+pe*Be-de*$e+De*we;return Pe?(i[0]=(v*Ze-w*Ve+D*Te)*(Pe=1/Pe),i[1]=(u*Ve-l*Ze-p*Te)*Pe,i[2]=(U*De-q*de+J*pe)*Pe,i[3]=(A*de-S*De-z*pe)*Pe,i[4]=(w*Be-_*Ze-D*$e)*Pe,i[5]=(s*Ze-u*Be+p*$e)*Pe,i[6]=(q*he-N*De-J*ce)*Pe,i[7]=(M*De-A*he+z*ce)*Pe,i[8]=(_*Ve-v*Be+D*we)*Pe,i[9]=(l*Be-s*Ve-p*we)*Pe,i[10]=(N*de-U*he+J*ie)*Pe,i[11]=(S*he-M*de-z*ie)*Pe,i[12]=(v*$e-_*Te-w*we)*Pe,i[13]=(s*Te-l*$e+u*we)*Pe,i[14]=(U*ce-N*pe-q*ie)*Pe,i[15]=(M*pe-S*ce+A*ie)*Pe,i):null},d.isMapAuthenticated=function(i){return zo.has(i)},d.isMapboxURL=Me,d.latFromMercatorY=Ci,d.len=Si,d.length=ul,d.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},d.loadVectorTile=Km,d.makeRequest=mt,d.mercatorXfromLng=zc,d.mercatorYfromLat=qa,d.mercatorZfromAltitude=ji,d.mul=ko,d.mul$1=Lo,d.multiply=function(i,e,s){var l=e[0],u=e[1],p=e[2],_=e[3],v=e[4],w=e[5],D=e[6],M=e[7],S=e[8],A=s[0],z=s[1],N=s[2],U=s[3],q=s[4],J=s[5],ie=s[6],ce=s[7],he=s[8];return i[0]=A*l+z*_+N*D,i[1]=A*u+z*v+N*M,i[2]=A*p+z*w+N*S,i[3]=U*l+q*_+J*D,i[4]=U*u+q*v+J*M,i[5]=U*p+q*w+J*S,i[6]=ie*l+ce*_+he*D,i[7]=ie*u+ce*v+he*M,i[8]=ie*p+ce*w+he*S,i},d.multiply$1=cl,d.multiply$2=Ro,d.nextPowerOfTwo=Pi,d.normalize=As,d.normalize$1=function(i,e){var s=e[0],l=e[1],u=e[2],p=e[3],_=s*s+l*l+u*u+p*p;return _>0&&(_=1/Math.sqrt(_)),i[0]=s*_,i[1]=l*_,i[2]=u*_,i[3]=p*_,i},d.number=Rt,d.ortho=function(i,e,s,l,u,p,_){var v=1/(e-s),w=1/(l-u),D=1/(p-_);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*D,i[11]=0,i[12]=(e+s)*v,i[13]=(u+l)*w,i[14]=(_+p)*D,i[15]=1,i},d.pbf=Vl,d.perspective=function(i,e,s,l,u){var p,_=1/Math.tan(e/2);return i[0]=_/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,null!=u&&u!==1/0?(i[10]=(u+l)*(p=1/(l-u)),i[14]=2*u*l*p):(i[10]=-1,i[14]=-2*l),i},d.pick=function(i,e){const s={};for(let l=0;l<e.length;l++){const u=e[l];u in i&&(s[u]=i[u])}return s},d.plugin=Nt,d.pointGeometry=Ke,d.polygonIntersectsBox=Qg,d.polygonIntersectsPolygon=Wf,d.polygonizeBounds=function(i,e,s=0,l=!0){const u=new Ke(s,s),p=i.sub(u),_=e.add(u),v=[p,new Ke(_.x,p.y),_,new Ke(p.x,_.y)];return l&&v.push(p),v},d.posAttributes=$m,d.postMapLoadEvent=fn,d.postTurnstileEvent=yn,d.potpack=Qh,d.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},d.radToDeg=gi,d.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.registerForPluginStateChange=function(i){return i({pluginStatus:_t,pluginURL:kt}),kr.on("pluginStateChange",i),i},d.removeAuthState=function(i){zo.delete(i)},d.renderColorRamp=gp,d.rotateX=Po,d.rotateX$1=dl,d.rotateY=ao,d.rotateZ=function(i,e,s){var l=Math.sin(s),u=Math.cos(s),p=e[0],_=e[1],v=e[2],w=e[3],D=e[4],M=e[5],S=e[6],A=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*u+D*l,i[1]=_*u+M*l,i[2]=v*u+S*l,i[3]=w*u+A*l,i[4]=D*u-p*l,i[5]=M*u-_*l,i[6]=S*u-v*l,i[7]=A*u-w*l,i},d.rotateZ$1=function(i,e,s){s*=.5;var l=e[0],u=e[1],p=e[2],_=e[3],v=Math.sin(s),w=Math.cos(s);return i[0]=l*w+u*v,i[1]=u*w-l*v,i[2]=p*w+_*v,i[3]=_*w-p*v,i},d.scale=fr,d.scale$1=function(i,e,s){return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i},d.scale$2=Xi,d.scaleAndAdd=wn,d.setCacheLimits=function(i,e){vh=i,yl=e},d.setColumn=function(i,e,s){i[4*e+0]=s[0],i[4*e+1]=s[1],i[4*e+2]=s[2],i[4*e+3]=s[3]},d.setRTLTextPlugin=function(i,e,s=!1){if(_t===ot||_t===ft||_t===rn)throw new Error("setRTLTextPlugin cannot be called multiple times.");kt=vi.resolveURL(i),_t=ot,mn=e,Zn(),s||Bi()},d.smoothstep=Fs,d.spec=Ee,d.storeAuthState=function(i,e){e?zo.add(i):zo.delete(i)},d.sub=Ps,d.subtract=os,d.symbolSize=Ip,d.tileAABB=function(i,e,s,l,u,p,_,v,w){if("globe"===w.name){const z=xd(new qp(p,new Kc(s,l,u)).canonical).getCorners(),N=Number.MAX_VALUE,U=[-N,-N,-N],q=[N,N,N],J=Zm(i,e);for(let ie=0;ie<z.length;ie++)Ut(z[ie],z[ie],J),M=q,S=z[ie],(D=q)[0]=Math.min(M[0],S[0]),D[1]=Math.min(M[1],S[1]),D[2]=Math.min(M[2],S[2]),yh(U,U,z[ie]);return new Jo(q,U)}var D,M,S;const A=tl({z:s,x:l,y:u},w);return new Jo([(p+A.x/A.scale)*e,e*(A.y/A.scale),_],[(p+A.x2/A.scale)*e,e*(A.y2/A.scale),v])},d.tileTransform=tl,d.transformMat3=function(i,e,s){var l=e[0],u=e[1],p=e[2];return i[0]=l*s[0]+u*s[3]+p*s[6],i[1]=l*s[1]+u*s[4]+p*s[7],i[2]=l*s[2]+u*s[5]+p*s[8],i},d.transformMat4=Ut,d.transformMat4$1=Vr,d.transformQuat=wa,d.translate=Zi,d.transpose=function(i,e){if(i===e){var s=e[1],l=e[2],u=e[5];i[1]=e[3],i[2]=e[6],i[3]=s,i[5]=e[7],i[6]=l,i[7]=u}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},d.triggerPluginCompletionEvent=gn,d.uniqueId=fl,d.validateCustomStyleLayer=function(i){const e=[],s=i.id;return void 0===s&&e.push({message:`layers.${s}: missing required property "id"`}),void 0===i.render&&e.push({message:`layers.${s}: missing required method "render"`}),i.renderingMode&&"2d"!==i.renderingMode&&"3d"!==i.renderingMode&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},d.validateFog=Al,d.validateLight=ta,d.validateStyle=Rn,d.values=Ai,d.vectorTile=Xa,d.version="2.7.0",d.warnOnce=Mn,d.window=Ae,d.wrap=as}),_h(0,function(d){function Jn(K){const L=typeof K;if("number"===L||"boolean"===L||"string"===L||null==K)return JSON.stringify(K);if(Array.isArray(K)){let Y="[";for(const le of K)Y+=`${Jn(le)},`;return`${Y}]`}const V=Object.keys(K).sort();let X="{";for(let Y=0;Y<V.length;Y++)X+=`${JSON.stringify(V[Y])}:${Jn(K[V[Y]])},`;return`${X}}`}function Ao(K){let L="";for(const V of d.refProperties)L+=`/${Jn(K[V])}`;return L}class ei{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,V){for(const Y of L)this._layerConfigs[Y.id]=Y,(this._layers[Y.id]=d.createStyleLayer(Y)).compileFilter(),this.keyCache[Y.id]&&delete this.keyCache[Y.id];for(const Y of V)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const X=function(Y,le){const me={};for(let ue=0;ue<Y.length;ue++){const ye=le&&le[Y[ue].id]||Ao(Y[ue]);le&&(le[Y[ue].id]=ye);let Me=me[ye];Me||(Me=me[ye]=[]),Me.push(Y[ue])}const fe=[];for(const ue in me)fe.push(me[ue]);return fe}(d.values(this._layerConfigs),this.keyCache);for(const Y of X){const le=Y.map(Se=>this._layers[Se.id]),me=le[0];if("none"===me.visibility)continue;const fe=me.source||"";let ue=this.familiesBySource[fe];ue||(ue=this.familiesBySource[fe]={});const ye=me.sourceLayer||"_geojsonTileLayer";let Me=ue[ye];Me||(Me=ue[ye]=[]),Me.push(le)}}}const{ImageBitmap:Ke}=d.window;class yt{loadTile(L,V){const{uid:X,encoding:Y,rawImageData:le,padding:me,buildQuadTree:fe}=L,ue=Ke&&le instanceof Ke?this.getImageData(le,me):le;V(null,new d.DEMData(X,ue,Y,me<1,fe))}getImageData(L,V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(L.width,L.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=L.width,this.offscreenCanvas.height=L.height,this.offscreenCanvasContext.drawImage(L,0,0,L.width,L.height);const X=this.offscreenCanvasContext.getImageData(-V,-V,L.width+2*V,L.height+2*V);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new d.RGBAImage({width:X.width,height:X.height},X.data)}}var Ae=function K(L,V){var X,Y=L&&L.type;if("FeatureCollection"===Y)for(X=0;X<L.features.length;X++)K(L.features[X],V);else if("GeometryCollection"===Y)for(X=0;X<L.geometries.length;X++)K(L.geometries[X],V);else if("Feature"===Y)K(L.geometry,V);else if("Polygon"===Y)mi(L.coordinates,V);else if("MultiPolygon"===Y)for(X=0;X<L.coordinates.length;X++)mi(L.coordinates[X],V);return L};function mi(K,L){if(0!==K.length){Tn(K[0],L);for(var V=1;V<K.length;V++)Tn(K[V],!L)}}function Tn(K,L){for(var V=0,X=0,Y=0,le=K.length,me=le-1;Y<le;me=Y++){var fe=(K[Y][0]-K[me][0])*(K[me][1]+K[Y][1]),ue=V+fe;X+=Math.abs(V)>=Math.abs(fe)?V-ue+fe:fe-ue+V,V=ue}V+X>=0!=!!L&&K.reverse()}const ll=d.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ti{constructor(L){this._feature=L,this.extent=d.EXTENT,this.type=L.type,this.properties=L.tags,"id"in L&&!isNaN(L.id)&&(this.id=parseInt(L.id,10))}loadGeometry(){if(1===this._feature.type){const L=[];for(const V of this._feature.geometry)L.push([new d.pointGeometry(V[0],V[1])]);return L}{const L=[];for(const V of this._feature.geometry){const X=[];for(const Y of V)X.push(new d.pointGeometry(Y[0],Y[1]));L.push(X)}return L}}toGeoJSON(L,V,X){return ll.call(this,L,V,X)}}class cl{constructor(L){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.EXTENT,this.length=L.length,this._features=L}feature(L){return new ti(this._features[L])}}var Zi=d.vectorTile.VectorTileFeature,fr=Po;function Po(K,L){this.options=L||{},this.features=K,this.length=K.length}function ao(K,L){this.id="number"==typeof K.id?K.id:void 0,this.type=K.type,this.rawGeometry=1===K.type?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=L||4096}Po.prototype.feature=function(K){return new ao(this.features[K],this.options.extent)},ao.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var L=0;L<K.length;L++){for(var V=K[L],X=[],Y=0;Y<V.length;Y++)X.push(new d.pointGeometry(V[Y][0],V[Y][1]));this.geometry.push(X)}return this.geometry},ao.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,L=1/0,V=-1/0,X=1/0,Y=-1/0,le=0;le<K.length;le++)for(var me=K[le],fe=0;fe<me.length;fe++){var ue=me[fe];L=Math.min(L,ue.x),V=Math.max(V,ue.x),X=Math.min(X,ue.y),Y=Math.max(Y,ue.y)}return[L,X,V,Y]},ao.prototype.toGeoJSON=Zi.prototype.toGeoJSON;var ko=Fo,Ss=fr;function Fo(K){var L=new d.pbf;return function(V,X){for(var Y in V.layers)X.writeMessage(3,ul,V.layers[Y])}(K,L),L.finish()}function ul(K,L){var V;L.writeVarintField(15,K.version||1),L.writeStringField(1,K.name||""),L.writeVarintField(5,K.extent||4096);var X={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<K.length;V++)X.feature=K.feature(V),L.writeMessage(2,Wi,X);var Y=X.keys;for(V=0;V<Y.length;V++)L.writeStringField(3,Y[V]);var le=X.values;for(V=0;V<le.length;V++)L.writeMessage(4,Xi,le[V])}function Wi(K,L){var V=K.feature;void 0!==V.id&&L.writeVarintField(1,V.id),L.writeMessage(2,hl,K),L.writeVarintField(3,V.type),L.writeMessage(4,yh,V)}function hl(K,L){var V=K.feature,X=K.keys,Y=K.values,le=K.keycache,me=K.valuecache;for(var fe in V.properties){var ue=V.properties[fe],ye=le[fe];if(null!==ue){void 0===ye&&(X.push(fe),le[fe]=ye=X.length-1),L.writeVarint(ye);var Me=typeof ue;"string"!==Me&&"boolean"!==Me&&"number"!==Me&&(ue=JSON.stringify(ue));var Se=Me+":"+ue,ze=me[Se];void 0===ze&&(Y.push(ue),me[Se]=ze=Y.length-1),L.writeVarint(ze)}}}function os(K,L){return(L<<3)+(7&K)}function Ro(K){return K<<1^K>>31}function yh(K,L){for(var V=K.loadGeometry(),X=K.type,Y=0,le=0,me=V.length,fe=0;fe<me;fe++){var ue=V[fe],ye=1;1===X&&(ye=ue.length),L.writeVarint(os(1,ye));for(var Me=3===X?ue.length-1:ue.length,Se=0;Se<Me;Se++){1===Se&&1!==X&&L.writeVarint(os(2,Me-1));var ze=ue[Se].x-Y,nt=ue[Se].y-le;L.writeVarint(Ro(ze)),L.writeVarint(Ro(nt)),Y+=ze,le+=nt}3===X&&L.writeVarint(os(7,1))}}function Xi(K,L){var V=typeof K;"string"===V?L.writeStringField(1,K):"boolean"===V?L.writeBooleanField(7,K):"number"===V&&(K%1!=0?L.writeDoubleField(3,K):K<0?L.writeSVarintField(6,K):L.writeVarintField(5,K))}function wn(K,L,V,X,Y,le){if(Y-X<=V)return;const me=X+Y>>1;As(K,L,me,X,Y,le%2),wn(K,L,V,X,me-1,le+1),wn(K,L,V,me+1,Y,le+1)}function As(K,L,V,X,Y,le){for(;Y>X;){if(Y-X>600){const ye=Y-X+1,Me=V-X+1,Se=Math.log(ye),ze=.5*Math.exp(2*Se/3),nt=.5*Math.sqrt(Se*ze*(ye-ze)/ye)*(Me-ye/2<0?-1:1);As(K,L,V,Math.max(X,Math.floor(V-Me*ze/ye+nt)),Math.min(Y,Math.floor(V+(ye-Me)*ze/ye+nt)),le)}const me=L[2*V+le];let fe=X,ue=Y;for(lo(K,L,X,V),L[2*Y+le]>me&&lo(K,L,X,Y);fe<ue;){for(lo(K,L,fe,ue),fe++,ue--;L[2*fe+le]<me;)fe++;for(;L[2*ue+le]>me;)ue--}L[2*X+le]===me?lo(K,L,X,ue):(ue++,lo(K,L,ue,Y)),ue<=V&&(X=ue+1),V<=ue&&(Y=ue-1)}}function lo(K,L,V,X){ba(K,V,X),ba(L,2*V,2*X),ba(L,2*V+1,2*X+1)}function ba(K,L,V){const X=K[L];K[L]=K[V],K[V]=X}function Ut(K,L,V,X){const Y=K-V,le=L-X;return Y*Y+le*le}ko.fromVectorTileJs=Fo,ko.fromGeojsonVt=function(K,L){L=L||{};var V={};for(var X in K)V[X]=new fr(K[X].features,L),V[X].name=X,V[X].version=L.version,V[X].extent=L.extent;return Fo({layers:V})},ko.GeoJSONWrapper=Ss;const wa=K=>K[0],ss=K=>K[1];class Ps{constructor(L,V=wa,X=ss,Y=64,le=Float64Array){this.nodeSize=Y,this.points=L;const me=L.length<65536?Uint16Array:Uint32Array,fe=this.ids=new me(L.length),ue=this.coords=new le(2*L.length);for(let ye=0;ye<L.length;ye++)fe[ye]=ye,ue[2*ye]=V(L[ye]),ue[2*ye+1]=X(L[ye]);wn(fe,ue,Y,0,fe.length-1,0)}range(L,V,X,Y){return function(le,me,fe,ue,ye,Me,Se){const ze=[0,le.length-1,0],nt=[];let ct,lt;for(;ze.length;){const ut=ze.pop(),It=ze.pop(),yn=ze.pop();if(It-yn<=Se){for(let En=yn;En<=It;En++)ct=me[2*En],lt=me[2*En+1],ct>=fe&&ct<=ye&&lt>=ue&&lt<=Me&&nt.push(le[En]);continue}const Cn=Math.floor((yn+It)/2);ct=me[2*Cn],lt=me[2*Cn+1],ct>=fe&&ct<=ye&&lt>=ue&&lt<=Me&&nt.push(le[Cn]);const fn=(ut+1)%2;(0===ut?fe<=ct:ue<=lt)&&(ze.push(yn),ze.push(Cn-1),ze.push(fn)),(0===ut?ye>=ct:Me>=lt)&&(ze.push(Cn+1),ze.push(It),ze.push(fn))}return nt}(this.ids,this.coords,L,V,X,Y,this.nodeSize)}within(L,V,X){return function(Y,le,me,fe,ue,ye){const Me=[0,Y.length-1,0],Se=[],ze=ue*ue;for(;Me.length;){const nt=Me.pop(),ct=Me.pop(),lt=Me.pop();if(ct-lt<=ye){for(let fn=lt;fn<=ct;fn++)Ut(le[2*fn],le[2*fn+1],me,fe)<=ze&&Se.push(Y[fn]);continue}const ut=Math.floor((lt+ct)/2),It=le[2*ut],yn=le[2*ut+1];Ut(It,yn,me,fe)<=ze&&Se.push(Y[ut]);const Cn=(nt+1)%2;(0===nt?me-ue<=It:fe-ue<=yn)&&(Me.push(lt),Me.push(ut-1),Me.push(Cn)),(0===nt?me+ue>=It:fe+ue>=yn)&&(Me.push(ut+1),Me.push(ct),Me.push(Cn))}return Se}(this.ids,this.coords,L,V,X,this.nodeSize)}}const Lo={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},Si=Math.fround||(Vr=new Float32Array(1),K=>(Vr[0]=+K,Vr[0]));var Vr;class ks{constructor(L){this.options=Ea(Object.create(Lo),L),this.trees=new Array(this.options.maxZoom+1)}load(L){const{log:V,minZoom:X,maxZoom:Y,nodeSize:le}=this.options;V&&console.time("total time");const me=`prepare ${L.length} points`;V&&console.time(me),this.points=L;let fe=[];for(let ue=0;ue<L.length;ue++)L[ue].geometry&&fe.push(dl(L[ue],ue));this.trees[Y+1]=new Ps(fe,Da,dc,le,Float32Array),V&&console.timeEnd(me);for(let ue=Y;ue>=X;ue--){const ye=+Date.now();fe=this._cluster(fe,ue),this.trees[ue]=new Ps(fe,Da,dc,le,Float32Array),V&&console.log("z%d: %d clusters in %dms",ue,fe.length,+Date.now()-ye)}return V&&console.timeEnd("total time"),this}getClusters(L,V){let X=((L[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,L[1]));let le=180===L[2]?180:((L[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)X=-180,le=180;else if(X>le){const Me=this.getClusters([X,Y,180,me],V),Se=this.getClusters([-180,Y,le,me],V);return Me.concat(Se)}const fe=this.trees[this._limitZoom(V)],ue=fe.range(pl(X),Ft(me),pl(le),Ft(Y)),ye=[];for(const Me of ue){const Se=fe.points[Me];ye.push(Se.numPoints?hc(Se):this.points[Se.index])}return ye}getChildren(L){const V=this._getOriginId(L),X=this._getOriginZoom(L),Y="No cluster with the specified id.",le=this.trees[X];if(!le)throw new Error(Y);const me=le.points[V];if(!me)throw new Error(Y);const fe=this.options.radius/(this.options.extent*Math.pow(2,X-1)),ue=le.within(me.x,me.y,fe),ye=[];for(const Me of ue){const Se=le.points[Me];Se.parentId===L&&ye.push(Se.numPoints?hc(Se):this.points[Se.index])}if(0===ye.length)throw new Error(Y);return ye}getLeaves(L,V,X){const Y=[];return this._appendLeaves(Y,L,V=V||10,X=X||0,0),Y}getTile(L,V,X){const Y=this.trees[this._limitZoom(L)],le=Math.pow(2,L),{extent:me,radius:fe}=this.options,ue=fe/me,ye=(X-ue)/le,Me=(X+1+ue)/le,Se={features:[]};return this._addTileFeatures(Y.range((V-ue)/le,ye,(V+1+ue)/le,Me),Y.points,V,X,le,Se),0===V&&this._addTileFeatures(Y.range(1-ue/le,ye,1,Me),Y.points,le,X,le,Se),V===le-1&&this._addTileFeatures(Y.range(0,ye,ue/le,Me),Y.points,-1,X,le,Se),Se.features.length?Se:null}getClusterExpansionZoom(L){let V=this._getOriginZoom(L)-1;for(;V<=this.options.maxZoom;){const X=this.getChildren(L);if(V++,1!==X.length)break;L=X[0].properties.cluster_id}return V}_appendLeaves(L,V,X,Y,le){const me=this.getChildren(V);for(const fe of me){const ue=fe.properties;if(ue&&ue.cluster?le+ue.point_count<=Y?le+=ue.point_count:le=this._appendLeaves(L,ue.cluster_id,X,Y,le):le<Y?le++:L.push(fe),L.length===X)break}return le}_addTileFeatures(L,V,X,Y,le,me){for(const fe of L){const ue=V[fe],ye=ue.numPoints;let Me,Se,ze;if(ye)Me=ou(ue),Se=ue.x,ze=ue.y;else{const lt=this.points[ue.index];Me=lt.properties,Se=pl(lt.geometry.coordinates[0]),ze=Ft(lt.geometry.coordinates[1])}const nt={type:1,geometry:[[Math.round(this.options.extent*(Se*le-X)),Math.round(this.options.extent*(ze*le-Y))]],tags:Me};let ct;ye?ct=ue.id:this.options.generateId?ct=ue.index:this.points[ue.index].id&&(ct=this.points[ue.index].id),void 0!==ct&&(nt.id=ct),me.features.push(nt)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(+L,this.options.maxZoom+1))}_cluster(L,V){const X=[],{radius:Y,extent:le,reduce:me,minPoints:fe}=this.options,ue=Y/(le*Math.pow(2,V));for(let ye=0;ye<L.length;ye++){const Me=L[ye];if(Me.zoom<=V)continue;Me.zoom=V;const Se=this.trees[V+1],ze=Se.within(Me.x,Me.y,ue),nt=Me.numPoints||1;let ct=nt;for(const lt of ze){const ut=Se.points[lt];ut.zoom>V&&(ct+=ut.numPoints||1)}if(ct>nt&&ct>=fe){let lt=Me.x*nt,ut=Me.y*nt,It=me&&nt>1?this._map(Me,!0):null;const yn=(ye<<5)+(V+1)+this.points.length;for(const Cn of ze){const fn=Se.points[Cn];if(fn.zoom<=V)continue;fn.zoom=V;const En=fn.numPoints||1;lt+=fn.x*En,ut+=fn.y*En,fn.parentId=yn,me&&(It||(It=this._map(Me,!0)),me(It,this._map(fn)))}Me.parentId=yn,X.push(iu(lt/ct,ut/ct,yn,ct,It))}else if(X.push(Me),ct>1)for(const lt of ze){const ut=Se.points[lt];ut.zoom<=V||(ut.zoom=V,X.push(ut))}}return X}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,V){if(L.numPoints)return V?Ea({},L.properties):L.properties;const X=this.points[L.index].properties,Y=this.options.map(X);return V&&Y===X?Ea({},Y):Y}}function iu(K,L,V,X,Y){return{x:Si(K),y:Si(L),zoom:1/0,id:V,parentId:-1,numPoints:X,properties:Y}}function dl(K,L){const[V,X]=K.geometry.coordinates;return{x:Si(pl(V)),y:Si(Ft(X)),zoom:1/0,index:L,parentId:-1}}function hc(K){return{type:"Feature",id:K.id,properties:ou(K),geometry:{type:"Point",coordinates:[(L=K.x,360*(L-.5)),gi(K.y)]}};var L}function ou(K){const L=K.numPoints,V=L>=1e4?`${Math.round(L/1e3)}k`:L>=1e3?Math.round(L/100)/10+"k":L;return Ea(Ea({},K.properties),{cluster:!0,cluster_id:K.id,point_count:L,point_count_abbreviated:V})}function pl(K){return K/360+.5}function Ft(K){const L=Math.sin(K*Math.PI/180),V=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return V<0?0:V>1?1:V}function gi(K){const L=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function Ea(K,L){for(const V in L)K[V]=L[V];return K}function Da(K){return K.x}function dc(K){return K.y}function Ta(K,L,V,X){for(var Y,le=X,me=V-L>>1,fe=V-L,ue=K[L],ye=K[L+1],Me=K[V],Se=K[V+1],ze=L+3;ze<V;ze+=3){var nt=on(K[ze],K[ze+1],ue,ye,Me,Se);if(nt>le)Y=ze,le=nt;else if(nt===le){var ct=Math.abs(ze-me);ct<fe&&(Y=ze,fe=ct)}}le>X&&(Y-L>3&&Ta(K,L,Y,X),K[Y+2]=le,V-Y>3&&Ta(K,Y,V,X))}function on(K,L,V,X,Y,le){var me=Y-V,fe=le-X;if(0!==me||0!==fe){var ue=((K-V)*me+(L-X)*fe)/(me*me+fe*fe);ue>1?(V=Y,X=le):ue>0&&(V+=me*ue,X+=fe*ue)}return(me=K-V)*me+(fe=L-X)*fe}function Fs(K,L,V,X){var Y={id:void 0===K?null:K,type:L,geometry:V,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(le){var me=le.geometry,fe=le.type;if("Point"===fe||"MultiPoint"===fe||"LineString"===fe)as(le,me);else if("Polygon"===fe||"MultiLineString"===fe)for(var ue=0;ue<me.length;ue++)as(le,me[ue]);else if("MultiPolygon"===fe)for(ue=0;ue<me.length;ue++)for(var ye=0;ye<me[ue].length;ye++)as(le,me[ue][ye])}(Y),Y}function as(K,L){for(var V=0;V<L.length;V+=3)K.minX=Math.min(K.minX,L[V]),K.minY=Math.min(K.minY,L[V+1]),K.maxX=Math.max(K.maxX,L[V]),K.maxY=Math.max(K.maxY,L[V+1])}function Ca(K,L,V,X){if(L.geometry){var Y=L.geometry.coordinates,le=L.geometry.type,me=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),fe=[],ue=L.id;if(V.promoteId?ue=L.properties[V.promoteId]:V.generateId&&(ue=X||0),"Point"===le)Ai(Y,fe);else if("MultiPoint"===le)for(var ye=0;ye<Y.length;ye++)Ai(Y[ye],fe);else if("LineString"===le)Nn(Y,fe,me,!1);else if("MultiLineString"===le){if(V.lineMetrics){for(ye=0;ye<Y.length;ye++)Nn(Y[ye],fe=[],me,!1),K.push(Fs(ue,"LineString",fe,L.properties));return}pc(Y,fe,me,!1)}else if("Polygon"===le)pc(Y,fe,me,!0);else{if("MultiPolygon"!==le){if("GeometryCollection"===le){for(ye=0;ye<L.geometry.geometries.length;ye++)Ca(K,{id:ue,geometry:L.geometry.geometries[ye],properties:L.properties},V,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ye=0;ye<Y.length;ye++){var Me=[];pc(Y[ye],Me,me,!0),fe.push(Me)}}K.push(Fs(ue,le,fe,L.properties))}}function Ai(K,L){L.push(fl(K[0])),L.push(fc(K[1])),L.push(0)}function Nn(K,L,V,X){for(var Y,le,me=0,fe=0;fe<K.length;fe++){var ue=fl(K[fe][0]),ye=fc(K[fe][1]);L.push(ue),L.push(ye),L.push(0),fe>0&&(me+=X?(Y*ye-ue*le)/2:Math.sqrt(Math.pow(ue-Y,2)+Math.pow(ye-le,2))),Y=ue,le=ye}var Me=L.length-3;L[2]=1,Ta(L,0,Me,V),L[Me+2]=1,L.size=Math.abs(me),L.start=0,L.end=L.size}function pc(K,L,V,X){for(var Y=0;Y<K.length;Y++){var le=[];Nn(K[Y],le,V,X),L.push(le)}}function fl(K){return K/360+.5}function fc(K){var L=Math.sin(K*Math.PI/180),V=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return V<0?0:V>1?1:V}function Pi(K,L,V,X,Y,le,me,fe){if(X/=L,le>=(V/=L)&&me<X)return K;if(me<V||le>=X)return null;for(var ue=[],ye=0;ye<K.length;ye++){var Me=K[ye],Se=Me.geometry,ze=Me.type,nt=0===Y?Me.minX:Me.minY,ct=0===Y?Me.maxX:Me.maxY;if(nt>=V&&ct<X)ue.push(Me);else if(!(ct<V||nt>=X)){var lt=[];if("Point"===ze||"MultiPoint"===ze)su(Se,lt,V,X,Y);else if("LineString"===ze)ml(Se,lt,V,X,Y,!1,fe.lineMetrics);else if("MultiLineString"===ze)Rs(Se,lt,V,X,Y,!1);else if("Polygon"===ze)Rs(Se,lt,V,X,Y,!0);else if("MultiPolygon"===ze)for(var ut=0;ut<Se.length;ut++){var It=[];Rs(Se[ut],It,V,X,Y,!0),It.length&&lt.push(It)}if(lt.length){if(fe.lineMetrics&&"LineString"===ze){for(ut=0;ut<lt.length;ut++)ue.push(Fs(Me.id,ze,lt[ut],Me.tags));continue}"LineString"!==ze&&"MultiLineString"!==ze||(1===lt.length?(ze="LineString",lt=lt[0]):ze="MultiLineString"),"Point"!==ze&&"MultiPoint"!==ze||(ze=3===lt.length?"Point":"MultiPoint"),ue.push(Fs(Me.id,ze,lt,Me.tags))}}}return ue.length?ue:null}function su(K,L,V,X,Y){for(var le=0;le<K.length;le+=3){var me=K[le+Y];me>=V&&me<=X&&(L.push(K[le]),L.push(K[le+1]),L.push(K[le+2]))}}function ml(K,L,V,X,Y,le,me){for(var fe,ue,ye=gl(K),Me=0===Y?_i:_l,Se=K.start,ze=0;ze<K.length-3;ze+=3){var nt=K[ze],ct=K[ze+1],lt=K[ze+2],ut=K[ze+3],It=K[ze+4],yn=0===Y?nt:ct,Cn=0===Y?ut:It,fn=!1;me&&(fe=Math.sqrt(Math.pow(nt-ut,2)+Math.pow(ct-It,2))),yn<V?Cn>V&&(ue=Me(ye,nt,ct,ut,It,V),me&&(ye.start=Se+fe*ue)):yn>X?Cn<X&&(ue=Me(ye,nt,ct,ut,It,X),me&&(ye.start=Se+fe*ue)):Ls(ye,nt,ct,lt),Cn<V&&yn>=V&&(ue=Me(ye,nt,ct,ut,It,V),fn=!0),Cn>X&&yn<=X&&(ue=Me(ye,nt,ct,ut,It,X),fn=!0),!le&&fn&&(me&&(ye.end=Se+fe*ue),L.push(ye),ye=gl(K)),me&&(Se+=fe)}var En=K.length-3;nt=K[En],ct=K[En+1],lt=K[En+2],(yn=0===Y?nt:ct)>=V&&yn<=X&&Ls(ye,nt,ct,lt),En=ye.length-3,le&&En>=3&&(ye[En]!==ye[0]||ye[En+1]!==ye[1])&&Ls(ye,ye[0],ye[1],ye[2]),ye.length&&L.push(ye)}function gl(K){var L=[];return L.size=K.size,L.start=K.start,L.end=K.end,L}function Rs(K,L,V,X,Y,le){for(var me=0;me<K.length;me++)ml(K[me],L,V,X,Y,le,!1)}function Ls(K,L,V,X){K.push(L),K.push(V),K.push(X)}function _i(K,L,V,X,Y,le){var me=(le-L)/(X-L);return K.push(le),K.push(V+(Y-V)*me),K.push(1),me}function _l(K,L,V,X,Y,le){var me=(le-V)/(Y-V);return K.push(L+(X-L)*me),K.push(le),K.push(1),me}function Mn(K,L){for(var V=[],X=0;X<K.length;X++){var Y,le=K[X],me=le.type;if("Point"===me||"MultiPoint"===me||"LineString"===me)Y=yi(le.geometry,L);else if("MultiLineString"===me||"Polygon"===me){Y=[];for(var fe=0;fe<le.geometry.length;fe++)Y.push(yi(le.geometry[fe],L))}else if("MultiPolygon"===me)for(Y=[],fe=0;fe<le.geometry.length;fe++){for(var ue=[],ye=0;ye<le.geometry[fe].length;ye++)ue.push(yi(le.geometry[fe][ye],L));Y.push(ue)}V.push(Fs(le.id,me,Y,le.tags))}return V}function yi(K,L){var V=[];V.size=K.size,void 0!==K.start&&(V.start=K.start,V.end=K.end);for(var X=0;X<K.length;X+=3)V.push(K[X]+L,K[X+1],K[X+2]);return V}function Ma(K,L){if(K.transformed)return K;var V,X,Y,le=1<<K.z,me=K.x,fe=K.y;for(V=0;V<K.features.length;V++){var ue=K.features[V],ye=ue.geometry,Me=ue.type;if(ue.geometry=[],1===Me)for(X=0;X<ye.length;X+=2)ue.geometry.push(Ki(ye[X],ye[X+1],L,le,me,fe));else for(X=0;X<ye.length;X++){var Se=[];for(Y=0;Y<ye[X].length;Y+=2)Se.push(Ki(ye[X][Y],ye[X][Y+1],L,le,me,fe));ue.geometry.push(Se)}}return K.transformed=!0,K}function Ki(K,L,V,X,Y,le){return[Math.round(V*(K*X-Y)),Math.round(V*(L*X-le))]}function zs(K,L,V,X,Y){for(var le=L===Y.maxZoom?0:Y.tolerance/((1<<L)*Y.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:X,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},fe=0;fe<K.length;fe++){me.numFeatures++,ls(me,K[fe],le,Y);var ue=K[fe].minX,ye=K[fe].minY,Me=K[fe].maxX,Se=K[fe].maxY;ue<me.minX&&(me.minX=ue),ye<me.minY&&(me.minY=ye),Me>me.maxX&&(me.maxX=Me),Se>me.maxY&&(me.maxY=Se)}return me}function ls(K,L,V,X){var Y=L.geometry,le=L.type,me=[];if("Point"===le||"MultiPoint"===le)for(var fe=0;fe<Y.length;fe+=3)me.push(Y[fe]),me.push(Y[fe+1]),K.numPoints++,K.numSimplified++;else if("LineString"===le)co(me,Y,K,V,!1,!1);else if("MultiLineString"===le||"Polygon"===le)for(fe=0;fe<Y.length;fe++)co(me,Y[fe],K,V,"Polygon"===le,0===fe);else if("MultiPolygon"===le)for(var ue=0;ue<Y.length;ue++){var ye=Y[ue];for(fe=0;fe<ye.length;fe++)co(me,ye[fe],K,V,!0,0===fe)}if(me.length){var Me=L.tags||null;if("LineString"===le&&X.lineMetrics){for(var Se in Me={},L.tags)Me[Se]=L.tags[Se];Me.mapbox_clip_start=Y.start/Y.size,Me.mapbox_clip_end=Y.end/Y.size}var ze={geometry:me,type:"Polygon"===le||"MultiPolygon"===le?3:"LineString"===le||"MultiLineString"===le?2:1,tags:Me};null!==L.id&&(ze.id=L.id),K.features.push(ze)}}function co(K,L,V,X,Y,le){var me=X*X;if(X>0&&L.size<(Y?me:X))V.numPoints+=L.length/3;else{for(var fe=[],ue=0;ue<L.length;ue+=3)(0===X||L[ue+2]>me)&&(V.numSimplified++,fe.push(L[ue]),fe.push(L[ue+1])),V.numPoints++;Y&&function(ye,Me){for(var Se=0,ze=0,nt=ye.length,ct=nt-2;ze<nt;ct=ze,ze+=2)Se+=(ye[ze]-ye[ct])*(ye[ze+1]+ye[ct+1]);if(Se>0===Me)for(ze=0,nt=ye.length;ze<nt/2;ze+=2){var lt=ye[ze],ut=ye[ze+1];ye[ze]=ye[nt-2-ze],ye[ze+1]=ye[nt-1-ze],ye[nt-2-ze]=lt,ye[nt-1-ze]=ut}}(fe,le),K.push(fe)}}function Sr(K,L){var V=(L=this.options=function(Y,le){for(var me in le)Y[me]=le[me];return Y}(Object.create(this.options),L)).debug;if(V&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");var Y,le,me,fe,ue,ye,X=function(Y,le){var me=[];if("FeatureCollection"===Y.type)for(var fe=0;fe<Y.features.length;fe++)Ca(me,Y.features[fe],le,fe);else Ca(me,"Feature"===Y.type?Y:{geometry:Y},le);return me}(K,L);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Y=X,le=L,me=le.buffer/le.extent,fe=Y,ue=Pi(Y,1,-1-me,me,0,-1,2,le),ye=Pi(Y,1,1-me,2+me,0,-1,2,le),(ue||ye)&&(fe=Pi(Y,1,-me,1+me,0,-1,2,le)||[],ue&&(fe=Mn(ue,1).concat(fe)),ye&&(fe=fe.concat(Mn(ye,-1)))),X=fe).length&&this.splitTile(X,0,0,0),V&&(X.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function cs(K,L,V){return 32*((1<<K)*V+L)+K}function uo(K,L){const V=K.tileID.canonical;if(!this._geoJSONIndex)return L(null,null);const X=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!X)return L(null,null);const Y=new cl(X.features);let le=ko(Y);0===le.byteOffset&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),L(null,{vectorTile:Y,rawData:le.buffer})}Sr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Sr.prototype.splitTile=function(K,L,V,X,Y,le,me){for(var fe=[K,L,V,X],ue=this.options,ye=ue.debug;fe.length;){X=fe.pop(),V=fe.pop(),L=fe.pop(),K=fe.pop();var Me=1<<L,Se=cs(L,V,X),ze=this.tiles[Se];if(!ze&&(ye>1&&console.time("creation"),ze=this.tiles[Se]=zs(K,L,V,X,ue),this.tileCoords.push({z:L,x:V,y:X}),ye)){ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,V,X,ze.numFeatures,ze.numPoints,ze.numSimplified),console.timeEnd("creation"));var nt="z"+L;this.stats[nt]=(this.stats[nt]||0)+1,this.total++}if(ze.source=K,Y){if(L===ue.maxZoom||L===Y)continue;var ct=1<<Y-L;if(V!==Math.floor(le/ct)||X!==Math.floor(me/ct))continue}else if(L===ue.indexMaxZoom||ze.numPoints<=ue.indexMaxPoints)continue;if(ze.source=null,0!==K.length){ye>1&&console.time("clipping");var lt,ut,It,yn,Cn,fn,En=.5*ue.buffer/ue.extent,us=.5-En,zo=.5+En,$n=1+En;lt=ut=It=yn=null,Cn=Pi(K,Me,V-En,V+zo,0,ze.minX,ze.maxX,ue),fn=Pi(K,Me,V+us,V+$n,0,ze.minX,ze.maxX,ue),K=null,Cn&&(lt=Pi(Cn,Me,X-En,X+zo,1,ze.minY,ze.maxY,ue),ut=Pi(Cn,Me,X+us,X+$n,1,ze.minY,ze.maxY,ue),Cn=null),fn&&(It=Pi(fn,Me,X-En,X+zo,1,ze.minY,ze.maxY,ue),yn=Pi(fn,Me,X+us,X+$n,1,ze.minY,ze.maxY,ue),fn=null),ye>1&&console.timeEnd("clipping"),fe.push(lt||[],L+1,2*V,2*X),fe.push(ut||[],L+1,2*V,2*X+1),fe.push(It||[],L+1,2*V+1,2*X),fe.push(yn||[],L+1,2*V+1,2*X+1)}}},Sr.prototype.getTile=function(K,L,V){var X=this.options,Y=X.extent,le=X.debug;if(K<0||K>24)return null;var me=1<<K,fe=cs(K,L=(L%me+me)%me,V);if(this.tiles[fe])return Ma(this.tiles[fe],Y);le>1&&console.log("drilling down to z%d-%d-%d",K,L,V);for(var ue,ye=K,Me=L,Se=V;!ue&&ye>0;)ye--,Me=Math.floor(Me/2),Se=Math.floor(Se/2),ue=this.tiles[cs(ye,Me,Se)];return ue&&ue.source?(le>1&&console.log("found parent tile z%d-%d-%d",ye,Me,Se),le>1&&console.time("drilling down"),this.splitTile(ue.source,ye,Me,Se,K,L,V),le>1&&console.timeEnd("drilling down"),this.tiles[fe]?Ma(this.tiles[fe],Y):null):null};class Ia extends d.VectorTileWorkerSource{constructor(L,V,X,Y,le){super(L,V,X,Y,uo),le&&(this.loadGeoJSON=le)}loadData(L,V){const X=L&&L.request,Y=X&&X.collectResourceTiming;this.loadGeoJSON(L,(le,me)=>{if(le||!me)return V(le);if("object"!=typeof me)return V(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));{Ae(me,!0);try{if(L.filter){const ue=d.createExpression(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ue.result)throw new Error(ue.value.map(Me=>`${Me.key}: ${Me.message}`).join(", "));const ye=me.features.filter(Me=>ue.value.evaluate({zoom:0},Me));me={type:"FeatureCollection",features:ye}}this._geoJSONIndex=L.cluster?new ks(function({superclusterOptions:ue,clusterProperties:ye}){if(!ye||!ue)return ue;const Me={},Se={},ze={accumulated:null,zoom:0},nt={properties:null},ct=Object.keys(ye);for(const lt of ct){const[ut,It]=ye[lt],yn=d.createExpression(It),Cn=d.createExpression("string"==typeof ut?[ut,["accumulated"],["get",lt]]:ut);Me[lt]=yn.value,Se[lt]=Cn.value}return ue.map=lt=>{nt.properties=lt;const ut={};for(const It of ct)ut[It]=Me[It].evaluate(ze,nt);return ut},ue.reduce=(lt,ut)=>{nt.properties=ut;for(const It of ct)ze.accumulated=lt[It],lt[It]=Se[It].evaluate(ze,nt)},ue}(L)).load(me.features):new Sr(ue=me,L.geojsonVtOptions)}catch(ue){return V(ue)}this.loaded={};const fe={};if(Y){const ue=d.getPerformanceMeasurement(X);ue&&(fe.resourceTiming={},fe.resourceTiming[L.source]=JSON.parse(JSON.stringify(ue)))}V(null,fe)}var ue})}reloadTile(L,V){const X=this.loaded;return X&&X[L.uid]?super.reloadTile(L,V):this.loadTile(L,V)}loadGeoJSON(L,V){if(L.request)d.getJSON(L.request,V);else{if("string"!=typeof L.data)return V(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));try{return V(null,JSON.parse(L.data))}catch(X){return V(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(L,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(L.clusterId))}catch(X){V(X)}}getClusterChildren(L,V){try{V(null,this._geoJSONIndex.getChildren(L.clusterId))}catch(X){V(X)}}getClusterLeaves(L,V){try{V(null,this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset))}catch(X){V(X)}}}class vi{constructor(L){this.self=L,this.actor=new d.Actor(L,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=d.getProjection({name:"mercator"}),this.workerSourceTypes={vector:d.VectorTileWorkerSource,geojson:Ia},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,X)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=X},this.self.registerRTLTextPlugin=V=>{if(d.plugin.isParsed())throw new Error("RTL text plugin already registered.");d.plugin.applyArabicShaping=V.applyArabicShaping,d.plugin.processBidirectionalText=V.processBidirectionalText,d.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}clearCaches(L,V,X){delete this.layerIndexes[L],delete this.availableImages[L],delete this.workerSources[L],delete this.demWorkerSources[L],X()}checkIfReady(L,V,X){X()}setReferrer(L,V){this.referrer=V}spriteLoaded(L,V){this.isSpriteLoaded[L]=V;for(const X in this.workerSources[L]){const Y=this.workerSources[L][X];for(const le in Y)Y[le]instanceof d.VectorTileWorkerSource&&(Y[le].isSpriteLoaded=V,Y[le].fire(new d.Event("isSpriteLoaded")))}}setImages(L,V,X){this.availableImages[L]=V;for(const Y in this.workerSources[L]){const le=this.workerSources[L][Y];for(const me in le)le[me].availableImages=V}X()}enableTerrain(L,V,X){this.terrain=V,X()}setProjection(L,V){this.projections[L]=d.getProjection(V)}setLayers(L,V,X){this.getLayerIndex(L).replace(V),X()}updateLayers(L,V,X){this.getLayerIndex(L).update(V.layers,V.removedIds),X()}loadTile(L,V,X){const Y=this.enableTerrain?d.extend({enableTerrain:this.terrain},V):V;Y.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,V.type,V.source).loadTile(Y,X)}loadDEMTile(L,V,X){const Y=this.enableTerrain?d.extend({buildQuadTree:this.terrain},V):V;this.getDEMWorkerSource(L,V.source).loadTile(Y,X)}reloadTile(L,V,X){const Y=this.enableTerrain?d.extend({enableTerrain:this.terrain},V):V;Y.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,V.type,V.source).reloadTile(Y,X)}abortTile(L,V,X){this.getWorkerSource(L,V.type,V.source).abortTile(V,X)}removeTile(L,V,X){this.getWorkerSource(L,V.type,V.source).removeTile(V,X)}removeSource(L,V,X){if(!this.workerSources[L]||!this.workerSources[L][V.type]||!this.workerSources[L][V.type][V.source])return;const Y=this.workerSources[L][V.type][V.source];delete this.workerSources[L][V.type][V.source],void 0!==Y.removeSource?Y.removeSource(V,X):X()}loadWorkerSource(L,V,X){try{this.self.importScripts(V.url),X()}catch(Y){X(Y.toString())}}syncRTLPluginState(L,V,X){try{d.plugin.setState(V);const Y=d.plugin.getPluginURL();if(d.plugin.isLoaded()&&!d.plugin.isParsed()&&null!=Y){this.self.importScripts(Y);const le=d.plugin.isParsed();X(le?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Y}`),le)}}catch(Y){X(Y.toString())}}getAvailableImages(L){let V=this.availableImages[L];return V||(V=[]),V}getLayerIndex(L){let V=this.layerIndexes[L];return V||(V=this.layerIndexes[L]=new ei),V}getWorkerSource(L,V,X){return this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][V]||(this.workerSources[L][V]={}),this.workerSources[L][V][X]||(this.workerSources[L][V][X]=new this.workerSourceTypes[V]({send:(Y,le,me,fe,ue,ye)=>{this.actor.send(Y,le,me,L,ue,ye)},scheduler:this.actor.scheduler},this.getLayerIndex(L),this.getAvailableImages(L),this.isSpriteLoaded[L])),this.workerSources[L][V][X]}getDEMWorkerSource(L,V){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][V]||(this.demWorkerSources[L][V]=new yt),this.demWorkerSources[L][V]}enforceCacheSizeLimit(L,V){d.enforceCacheSizeLimit(V)}getWorkerPerformanceMetrics(L,V,X){X(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new vi(self)),vi}),_h(0,function(d){var Jn=Ao;function Ao(f){return o=f,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,y,x=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(x);try{y=new Worker(E),m=!0}catch(C){m=!1}return y&&y.terminate(),URL.revokeObjectURL(E),m}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var m=document.createElement("canvas");m.width=m.height=1;var y=m.getContext("2d");if(!y)return!1;var x=y.getImageData(0,0,1,1);return x&&x.width===m.width}()||(void 0===ei[c=o&&o.failIfMajorPerformanceCaveat]&&(ei[c]=function(m){var y,E,C,P,x=(E=m,C=document.createElement("canvas"),(P=Object.create(Ao.webGLContextAttributes)).failIfMajorPerformanceCaveat=E,C.getContext("webgl",P)||C.getContext("experimental-webgl",P));if(!x)return!1;try{y=x.createShader(x.VERTEX_SHADER)}catch(E){return!1}return!(!y||x.isContextLost())&&(x.shaderSource(y,"void main() {}"),x.compileShader(y),!0===x.getShaderParameter(y,x.COMPILE_STATUS))}(c)),!ei[c]||document.documentMode));var o,c}var ei={};function Ke(f,o){var c=o[0],m=o[1],y=o[2],x=o[3],E=c*x-y*m;return E?(f[0]=x*(E=1/E),f[1]=-m*E,f[2]=-y*E,f[3]=c*E,f):null}function yt(f,o){if(Array.isArray(f)){if(!Array.isArray(o)||f.length!==o.length)return!1;for(let c=0;c<f.length;c++)if(!yt(f[c],o[c]))return!1;return!0}if("object"==typeof f&&null!==f&&null!==o){if("object"!=typeof o||Object.keys(f).length!==Object.keys(o).length)return!1;for(const c in f)if(!yt(f[c],o[c]))return!1;return!0}return f===o}Ao.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ae={create:function(f,o,c){const m=d.window.document.createElement(f);return void 0!==o&&(m.className=o),c&&c.appendChild(m),m},createSVG:function(f,o,c){const m=d.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const y of Object.keys(o))m.setAttributeNS(null,y,o[y]);return c&&c.appendChild(m),m}},mi=d.window.document&&d.window.document.documentElement.style,Tn=mi&&void 0!==mi.userSelect?"userSelect":"WebkitUserSelect";let ll;Ae.disableDrag=function(){mi&&Tn&&(ll=mi[Tn],mi[Tn]="none")},Ae.enableDrag=function(){mi&&Tn&&(mi[Tn]=ll)};const ti=function(f){f.preventDefault(),f.stopPropagation(),d.window.removeEventListener("click",ti,!0)};function cl(f,o,c){const m=f.offsetWidth===o.width?1:f.offsetWidth/o.width;return new d.pointGeometry((c.clientX-o.left)*m,(c.clientY-o.top)*m)}function Zi(f){const{userImage:o}=f;return!!(o&&o.render&&o.render())&&(f.data.replace(new Uint8Array(o.data.buffer)),!0)}Ae.suppressClick=function(){d.window.addEventListener("click",ti,!0),d.window.setTimeout(()=>{d.window.removeEventListener("click",ti,!0)},0)},Ae.mousePos=function(f,o){const c=f.getBoundingClientRect();return cl(f,c,o)},Ae.touchPos=function(f,o){const c=f.getBoundingClientRect(),m=[];for(let y=0;y<o.length;y++)m.push(cl(f,c,o[y]));return m},Ae.mouseButton=function(f){return void 0!==d.window.InstallTrigger&&2===f.button&&f.ctrlKey&&d.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button};class fr extends d.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:c,callback:m}of this.requestors)this._notify(c,m);this.requestors=[]}}getImage(o){return this.images[o]}addImage(o,c){this._validate(o,c)&&(this.images[o]=c)}_validate(o,c){let m=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new d.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),m=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new d.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),m=!1),this._validateContent(c.content,c)||(this.fire(new d.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),m=!1),m}_validateStretch(o,c){if(!o)return!0;let m=0;for(const y of o){if(y[0]<m||y[1]<y[0]||c<y[1])return!1;m=y[1]}return!0}_validateContent(o,c){return!(o&&(4!==o.length||o[0]<0||c.data.width<o[0]||o[1]<0||c.data.height<o[1]||o[2]<0||c.data.width<o[2]||o[3]<0||c.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,c){c.version=this.images[o].version+1,this.images[o]=c,this.updatedImages[o]=!0}removeImage(o){const c=this.images[o];delete this.images[o],delete this.patterns[o],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,c){let m=!0;if(!this.isLoaded())for(const y of o)this.images[y]||(m=!1);this.isLoaded()||m?this._notify(o,c):this.requestors.push({ids:o,callback:c})}_notify(o,c){const m={};for(const y of o){this.images[y]||this.fire(new d.Event("styleimagemissing",{id:y}));const x=this.images[y];x?m[y]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:Boolean(x.userImage&&x.userImage.render)}:d.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,m)}getPixelSize(){const{width:o,height:c}=this.atlasImage;return{width:o,height:c}}getPattern(o){const c=this.patterns[o],m=this.getImage(o);if(!m)return null;if(c&&c.position.version===m.version)return c.position;if(c)c.position.version=m.version;else{const y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},x=new d.ImagePosition(y,m);this.patterns[o]={bin:y,position:x}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const c=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.Texture(o,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const x in this.patterns)o.push(this.patterns[x].bin);const{w:c,h:m}=d.potpack(o),y=this.atlasImage;y.resize({width:c||1,height:m||1});for(const x in this.patterns){const{bin:E}=this.patterns[x],C=E.x+1,P=E.y+1,F=this.images[x].data,R=F.width,O=F.height;d.RGBAImage.copy(F,y,{x:0,y:0},{x:C,y:P},{width:R,height:O}),d.RGBAImage.copy(F,y,{x:0,y:O-1},{x:C,y:P-1},{width:R,height:1}),d.RGBAImage.copy(F,y,{x:0,y:0},{x:C,y:P+O},{width:R,height:1}),d.RGBAImage.copy(F,y,{x:R-1,y:0},{x:C-1,y:P},{width:1,height:O}),d.RGBAImage.copy(F,y,{x:0,y:0},{x:C+R,y:P},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const c of o){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const m=this.images[c];Zi(m)&&this.updateImage(c,m)}}}const Po=new d.Properties({anchor:new d.DataConstantProperty(d.spec.light.anchor),position:new class{constructor(){this.specification=d.spec.light.position}possiblyEvaluate(f,o){return function([c,m,y]){const x=d.degToRad(m+90),E=d.degToRad(y);return{x:c*Math.cos(x)*Math.sin(E),y:c*Math.sin(x)*Math.sin(E),z:c*Math.cos(E),azimuthal:m,polar:y}}(f.expression.evaluate(o))}interpolate(f,o,c){return{x:d.number(f.x,o.x,c),y:d.number(f.y,o.y,c),z:d.number(f.z,o.z,c),azimuthal:d.number(f.azimuthal,o.azimuthal,c),polar:d.number(f.polar,o.polar,c)}}},color:new d.DataConstantProperty(d.spec.light.color),intensity:new d.DataConstantProperty(d.spec.light.intensity)}),ao="-transition";class ko extends d.Evented{constructor(o){super(),this._transitionable=new d.Transitionable(Po),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,c={}){if(!this._validate(d.validateLight,o,c))for(const m in o){const y=o[m];d.endsWith(m,ao)?this._transitionable.setTransition(m.slice(0,-ao.length),y):this._transitionable.setValue(m,y)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,m){return(!m||!1!==m.validate)&&d.emitValidationErrors(this,o.call(d.validateStyle,d.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}const Ss=new d.Properties({source:new d.DataConstantProperty(d.spec.terrain.source),exaggeration:new d.DataConstantProperty(d.spec.terrain.exaggeration)}),Fo="-transition";class ul extends d.Evented{constructor(o,c){super(),this._transitionable=new d.Transitionable(Ss),this.set(o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(o){for(const c in o){const m=o[c];d.endsWith(c,Fo)?this._transitionable.setTransition(c.slice(0,-Fo.length),m):this._transitionable.setValue(c,m)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}}function Wi(f,o,c,m){const y=d.smoothstep(45,65,c),[x,E]=hl(f,m),C=d.length(o);let P=1-Math.min(1,Math.exp((C-x)/(E-x)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*y*f.alpha}function hl(f,o){const c=.5/Math.tan(.5*o);return[f.range[0]+c,f.range[1]+c]}const os=new d.Properties({range:new d.DataConstantProperty(d.spec.fog.range),color:new d.DataConstantProperty(d.spec.fog.color),"horizon-blend":new d.DataConstantProperty(d.spec.fog["horizon-blend"])}),Ro="-transition";class yh extends d.Evented{constructor(o,c){super(),this._transitionable=new d.Transitionable(os),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,c={}){if(!this._validate(d.validateFog,o,c))for(const m in o){const y=o[m];d.endsWith(m,Ro)?this._transitionable.setTransition(m.slice(0,-Ro.length),y):this._transitionable.setValue(m,y)}}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return d.smoothstep(45,65,o)*c.a}getOpacityAtLatLng(o,c){return this._transform.projection.supportsFog?function(m,y,x){const E=d.MercatorCoordinate.fromLngLat(y),C=x.elevation?x.elevation.getAtPointOrZero(E):0,P=[E.x,E.y,C];return d.transformMat4(P,P,x.mercatorFogMatrix),Wi(m,P,x.pitch,x._fov)}(this.state,o,c):0}getFovAdjustedRange(o){return this._transform.projection.supportsFog?hl(this.state,o):[0,1]}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,m){return(!m||!1!==m.validate)&&d.emitValidationErrors(this,o.call(d.validateStyle,d.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}class Xi{constructor(o,c){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=d.uniqueId();const m=this.workerPool.acquire(this.id);for(let y=0;y<m.length;y++){const x=new Xi.Actor(m[y],c,this.id);x.name=`Worker ${y}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,c,m){d.asyncAll(this.actors,(y,x)=>{y.send(o,c,x)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function wn(f,o,c){return o*(d.EXTENT/(f.tileSize*Math.pow(2,c-f.tileID.overscaledZ)))}Xi.Actor=d.Actor;class As{constructor(o,c,m){this.context=o;const y=o.gl;this.buffer=y.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const lo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ba{constructor(o,c,m,y){this.length=c.length,this.attributes=m,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.context=o;const x=o.gl;this.buffer=x.createBuffer(),o.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,c){for(let m=0;m<this.attributes.length;m++){const y=c.attributes[this.attributes[m].name];void 0!==y&&o.enableVertexAttribArray(y)}}setVertexAttribPointers(o,c,m){for(let y=0;y<this.attributes.length;y++){const x=this.attributes[y],E=c.attributes[x.name];void 0!==E&&o.vertexAttribPointer(E,x.components,o[lo[x.type]],!1,this.itemSize,x.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ut{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class wa extends Ut{getDefault(){return d.Color.transparent}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class ss extends Ut{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Ps extends Ut{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Lo extends Ut{getDefault(){return[!0,!0,!0,!0]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Si extends Ut{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Vr extends Ut{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class ks extends Ut{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const c=this.current;(o.func!==c.func||o.ref!==c.ref||o.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class iu extends Ut{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class dl extends Ut{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=o,this.dirty=!1}}class hc extends Ut{getDefault(){return[0,1]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class ou extends Ut{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=o,this.dirty=!1}}class pl extends Ut{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Ft extends Ut{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.BLEND):c.disable(c.BLEND),this.current=o,this.dirty=!1}}class gi extends Ut{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Ea extends Ut{getDefault(){return d.Color.transparent}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Da extends Ut{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class dc extends Ut{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=o,this.dirty=!1}}class Ta extends Ut{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class on extends Ut{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Fs extends Ut{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class as extends Ut{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Ca extends Ut{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Ai extends Ut{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Nn extends Ut{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class pc extends Ut{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class fl extends Ut{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class fc extends Ut{getDefault(){return null}set(o){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Pi extends Ut{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class su extends Ut{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class ml extends Ut{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class gl extends Ut{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Rs extends Ut{constructor(o,c){super(o),this.context=o,this.parent=c}getDefault(){return null}}class Ls extends Rs{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class _i extends Rs{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class _l extends _i{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Mn{constructor(o,c,m,y){this.context=o,this.width=c,this.height=m;const x=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new Ls(o,x),y&&(this.depthAttachment=new _i(o,x))}destroy(){const o=this.context.gl,c=this.colorAttachment.get();if(c&&o.deleteTexture(c),this.depthAttachment){const m=this.depthAttachment.get();m&&o.deleteRenderbuffer(m)}o.deleteFramebuffer(this.framebuffer)}}class yi{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new wa(this),this.clearDepth=new ss(this),this.clearStencil=new Ps(this),this.colorMask=new Lo(this),this.depthMask=new Si(this),this.stencilMask=new Vr(this),this.stencilFunc=new ks(this),this.stencilOp=new iu(this),this.stencilTest=new dl(this),this.depthRange=new hc(this),this.depthTest=new ou(this),this.depthFunc=new pl(this),this.blend=new Ft(this),this.blendFunc=new gi(this),this.blendColor=new Ea(this),this.blendEquation=new Da(this),this.cullFace=new dc(this),this.cullFaceSide=new Ta(this),this.frontFace=new on(this),this.program=new Fs(this),this.activeTexture=new as(this),this.viewport=new Ca(this),this.bindFramebuffer=new Ai(this),this.bindRenderbuffer=new Nn(this),this.bindTexture=new pc(this),this.bindVertexBuffer=new fl(this),this.bindElementBuffer=new fc(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Pi(this),this.pixelStoreUnpack=new su(this),this.pixelStoreUnpackPremultiplyAlpha=new ml(this),this.pixelStoreUnpackFlipY=new gl(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,c){return new As(this,o,c)}createVertexBuffer(o,c,m){return new ba(this,o,c,m)}createRenderbuffer(o,c,m){const y=this.gl,x=y.createRenderbuffer();return this.bindRenderbuffer.set(x),y.renderbufferStorage(y.RENDERBUFFER,o,c,m),this.bindRenderbuffer.set(null),x}createFramebuffer(o,c,m){return new Mn(this,o,c,m)}clear({color:o,depth:c,stencil:m}){const y=this.gl;let x=0;o&&(x|=y.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(x|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==m&&(x|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),y.clear(x)}setCullFace(o){!1===o.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){yt(o.blendFunction,d.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ma{constructor(o,c,m,y){this.screenBounds=o,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(x=>y.pointCoordinate3D(x)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(o,c){let m,y;if(o instanceof d.pointGeometry||"number"==typeof o[0]){const x=d.pointGeometry.convert(o);m=[d.pointGeometry.convert(o)],y=c.isPointAboveHorizon(x)}else{const x=d.pointGeometry.convert(o[0]),E=d.pointGeometry.convert(o[1]);m=[x,E],y=d.polygonizeBounds(x,E).every(C=>c.isPointAboveHorizon(C))}return new Ma(m,c.getCameraPoint(),y,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(o){return d.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const c=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new d.pointGeometry(1,1)):this.screenBounds[1],y=d.polygonizeBounds(c,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<m.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),d.bufferConvexPolygon(y,o)}containsTile(o,c,m){const y=o.queryPadding+1,x=o.tileID.wrap,E=m?this._bufferedCameraMercator(y,c).map(H=>d.getTilePoint(o.tileTransform,H,x)):this._bufferedScreenMercator(y,c).map(H=>d.getTilePoint(o.tileTransform,H,x)),C=this.screenGeometryMercator.map(H=>d.getTileVec3(o.tileTransform,H,x)),P=C.map(H=>new d.pointGeometry(H[0],H[1])),F=c.getFreeCameraOptions().position||new d.MercatorCoordinate(0,0,0),R=d.getTileVec3(o.tileTransform,F,x),O=C.map(H=>{const W=d.sub(H,H,R);return d.normalize(W,W),new d.Ray(R,W)}),j=wn(o,1,c.zoom);if(d.polygonIntersectsBox(E,0,0,d.EXTENT,d.EXTENT))return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:O,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(Z=d.getBounds(E),Z.min.x=d.clamp(Z.min.x,0,d.EXTENT),Z.min.y=d.clamp(Z.min.y,0,d.EXTENT),Z.max.x=d.clamp(Z.max.x,0,d.EXTENT),Z.max.y=d.clamp(Z.max.y,0,d.EXTENT),Z),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:j};var Z}_bufferedScreenMercator(o,c){const m=Ki(o);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{const y=this.bufferedScreenGeometry(o).map(x=>c.pointCoordinate3D(x));return this._screenRaycastCache[m]=y,y}}_bufferedCameraMercator(o,c){const m=Ki(o);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{const y=this.bufferedCameraGeometry(o).map(x=>c.pointCoordinate3D(x));return this._cameraRaycastCache[m]=y,y}}}function Ki(f){return 100*f|0}function zs(f,o,c){const m=function(y,x){if(y)return c(y);if(x){const E=d.pick(d.extend(x,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(E.vectorLayers=x.vector_layers,E.vectorLayerIds=E.vectorLayers.map(C=>C.id)),E.tiles=o.canonicalizeTileset(E,f.url),c(null,E)}};return f.url?d.getJSON(o.transformRequest(o.normalizeSourceURL(f.url),d.ResourceType.Source),m):d.exported.frame(()=>m(null,f))}class ls{constructor(o,c,m){this.bounds=d.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=c||0,this.maxzoom=m||24}validateBounds(o){return Array.isArray(o)&&4===o.length?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const c=Math.pow(2,o.z),m=Math.floor(d.mercatorXfromLng(this.bounds.getWest())*c),y=Math.floor(d.mercatorYfromLat(this.bounds.getNorth())*c),x=Math.ceil(d.mercatorXfromLng(this.bounds.getEast())*c),E=Math.ceil(d.mercatorYfromLat(this.bounds.getSouth())*c);return o.x>=m&&o.x<x&&o.y>=y&&o.y<E}}class co extends d.Evented{constructor(o,c,m,y){super(),this.id=o,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.extend({type:"raster"},c),d.extend(this,d.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=zs(this._options,this.map._requestManager,(o,c)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new d.ErrorEvent(o)):c&&(d.extend(this,c),c.bounds&&(this.tileBounds=new ls(c.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(c.tiles),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,c){const m=d.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);o.request=d.getImage(this.map._requestManager.transformRequest(y,d.ResourceType.Tile),(x,E,C,P)=>{if(delete o.request,o.aborted)o.state="unloaded",c(null);else if(x)o.state="errored",c(x);else if(E){this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:C,expires:P});const F=this.map.painter.context,R=F.gl;o.texture=this.map.painter.getTileTexture(E.width),o.texture?o.texture.update(E,{useMipmap:!0}):(o.texture=new d.Texture(F,E,R.RGBA,{useMipmap:!0}),o.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE),F.extTextureFilterAnisotropic&&R.texParameterf(R.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax)),o.state="loaded",d.cacheEntryPossiblyAdded(this.dispatcher),c(null)}})}abortTile(o,c){o.request&&(o.request.cancel(),delete o.request),c()}unloadTile(o,c){o.texture&&this.map.painter.saveTileTexture(o.texture),c()}hasTransition(){return!1}}let Sr;function cs(f,o,c,m,y,x,E,C){const P=[f,c,y,o,m,x,1,1,1],F=[E,C,1],R=d.adjoint([],P),[O,j,Z]=d.transformMat3(F,F,d.transpose(R,R));return d.multiply(P,[O,0,0,0,j,0,0,0,Z],P)}class uo extends d.Evented{constructor(o,c,m,y){super(),this.id=o,this.dispatcher=m,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=c}load(o,c){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this.url=this.options.url,d.getImage(this.map._requestManager.transformRequest(this.url,d.ResourceType.Image),(m,y)=>{this._loaded=!0,m?this.fire(new d.ErrorEvent(m)):y&&(this.image=d.exported.getImageData(y),this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),c&&c(),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}setCoordinates(o){this.coordinates=o,delete this._boundsArray;const c=o.map(d.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let y=1/0,x=1/0,E=-1/0,C=-1/0;for(const O of m)y=Math.min(y,O.x),x=Math.min(x,O.y),E=Math.max(E,O.x),C=Math.max(C,O.y);const P=Math.max(E-y,C-x),F=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),R=Math.pow(2,F);return new d.CanonicalTileID(F,Math.floor((y+E)/2*R),Math.floor((x+C)/2*R))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const o=d.tileTransform(this.tileID,this.map.transform.projection),[c,m,y,x]=this.coordinates.map(E=>{const C=o.projection.project(E[0],E[1]);return d.getTilePoint(o,C)._round()});return this.perspectiveTransform=function(E,C,P,F,R,O,j,Z,H,W){const se=cs(0,0,E,0,0,C,E,C),G=cs(P,F,R,O,j,Z,H,W);return d.multiply(G,d.adjoint(se,se),G),[G[6]/G[8]*E/d.EXTENT,G[7]/G[8]*C/d.EXTENT]}(this.width,this.height,c.x,c.y,m.x,m.y,x.x,x.y,y.x,y.y),this._boundsArray=new d.StructArrayLayout4i8,this._boundsArray.emplaceBack(c.x,c.y,0,0),this._boundsArray.emplaceBack(m.x,m.y,d.EXTENT,0),this._boundsArray.emplaceBack(x.x,x.y,0,d.EXTENT),this._boundsArray.emplaceBack(y.x,y.y,d.EXTENT,d.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const o=this.map.painter.context,c=o.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,d.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new d.Texture(o,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));for(const m in this.tiles){const y=this.tiles[m];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}loadTile(o,c){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},c(null)):(o.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ia={vector:class extends d.Evented{constructor(f,o,c,m){if(super(),this.id=f,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.extend(this,d.pick(o,["url","scheme","tileSize","promoteId"])),this._options=d.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new d.DedupedRequest}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=zs(this._options,this.map._requestManager,(f,o)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new d.ErrorEvent(f)):o&&(d.extend(this,o),o.bounds&&(this.tileBounds=new ls(o.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}onAdd(f){this.map=f,this.load()}setSourceProperty(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f();const o=this.map.style._getSourceCaches(this.id);for(const c of o)c.clearTiles();this.load()}setTiles(f){return this.setSourceProperty(()=>{this._options.tiles=f}),this}setUrl(f){return this.setSourceProperty(()=>{this.url=f,this._options.url=f}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}loadTile(f,o){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(c,d.ResourceType.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:f.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,f.actor&&"expired"!==f.state)"loading"===f.state?f.reloadCallback=o:f.request=f.actor.send("reloadTile",m,y.bind(this));else if(f.actor=this._tileWorkers[c]=this._tileWorkers[c]||this.dispatcher.getActor(),this.dispatcher.ready)f.request=f.actor.send("loadTile",m,y.bind(this),void 0,!0);else{const x=d.loadVectorTile.call({deduped:this._deduped},m,(E,C)=>{E||!C?y.call(this,E):(m.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},f.actor&&f.actor.send("loadTile",m,y.bind(this),void 0,!0))},!0);f.request={cancel:x}}function y(x,E){return delete f.request,f.aborted?o(null):x&&404!==x.status?o(x):(E&&E.resourceTiming&&(f.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&f.setExpiryData(E),f.loadVectorData(E,this.map.painter),d.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id})}unloadTile(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:co,"raster-dem":class extends co{constructor(f,o,c,m){super(f,o,c,m),this.type="raster-dem",this.maxzoom=22,this._options=d.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(f,o){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(y,x){y&&(f.state="errored",o(y)),x&&(f.dem=x,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",o(null))}f.request=d.getImage(this.map._requestManager.transformRequest(c,d.ResourceType.Tile),function(y,x,E,C){if(delete f.request,f.aborted)f.state="unloaded",o(null);else if(y)f.state="errored",o(y);else if(x){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:E,expires:C});const P=d.window.ImageBitmap&&x instanceof d.window.ImageBitmap&&(null==Sr&&(Sr=d.window.OffscreenCanvas&&new d.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof d.window.createImageBitmap),Sr),F=1-(x.width-d.prevPowerOfTwo(x.width))/2;F<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const R=P?x:d.exported.getImageData(x,F),O={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:R,encoding:this.encoding,padding:F};f.actor&&"expired"!==f.state||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",O,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const o=f.canonical,c=Math.pow(2,o.z),m=(o.x-1+c)%c,y=0===o.x?f.wrap-1:f.wrap,x=(o.x+1+c)%c,E=o.x+1===c?f.wrap+1:f.wrap,C={};return C[new d.OverscaledTileID(f.overscaledZ,y,o.z,m,o.y).key]={backfilled:!1},C[new d.OverscaledTileID(f.overscaledZ,E,o.z,x,o.y).key]={backfilled:!1},o.y>0&&(C[new d.OverscaledTileID(f.overscaledZ,y,o.z,m,o.y-1).key]={backfilled:!1},C[new d.OverscaledTileID(f.overscaledZ,f.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},C[new d.OverscaledTileID(f.overscaledZ,E,o.z,x,o.y-1).key]={backfilled:!1}),o.y+1<c&&(C[new d.OverscaledTileID(f.overscaledZ,y,o.z,m,o.y+1).key]={backfilled:!1},C[new d.OverscaledTileID(f.overscaledZ,f.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},C[new d.OverscaledTileID(f.overscaledZ,E,o.z,x,o.y+1).key]={backfilled:!1}),C}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends d.Evented{constructor(f,o,c,m){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(m),this._data=o.data,this._options=d.extend({},o),this._collectResourceTiming=o.collectResourceTiming,void 0!==o.maxzoom&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const y=d.EXTENT/this.tileSize;this.workerOptions=d.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(void 0!==o.buffer?o.buffer:128)*y,tolerance:(void 0!==o.tolerance?o.tolerance:.375)*y,extent:d.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:void 0!==o.clusterMaxZoom?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:d.EXTENT,radius:(void 0!==o.clusterRadius?o.clusterRadius:50)*y,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},o),this}getClusterChildren(f,o){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},o),this}getClusterLeaves(f,o,c,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:o,offset:c},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new d.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=d.extend({},this.workerOptions),o=this._data;"string"==typeof o?(f.request=this.map._requestManager.transformRequest(d.exported.resolveURL(o),d.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(c,m)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new d.ErrorEvent(c));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(y.resourceTiming=m.resourceTiming[this.id]),this.fire(new d.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,o){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(c,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,y)=>(delete f.request,f.unloadVectorData(),f.aborted?o(null):m?o(m):(f.loadVectorData(y,this.map.painter,"reloadTile"===c),o(null))),void 0,"loadTile"===c)}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return d.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends uo{constructor(f,o,c,m){super(f,o,c,m),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const o of f.urls)this.urls.push(this.map._requestManager.transformRequest(o,d.ResourceType.Source).url);d.getVideo(this.urls,(o,c)=>{this._loaded=!0,o?this.fire(new d.ErrorEvent(o)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const o=this.video.seekable;f<o.start(0)||f>o.end(0)?this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const f=this.map.painter.context,o=f.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new d.Texture(f,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,d.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2));for(const c in this.tiles){const m=this.tiles[c];"loaded"!==m.state&&(m.state="loaded",m.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:uo,canvas:class extends uo{constructor(f,o,c,m){super(f,o,c,m),o.coordinates?Array.isArray(o.coordinates)&&4===o.coordinates.length&&!o.coordinates.some(y=>!Array.isArray(y)||2!==y.length||y.some(x=>"number"!=typeof x))||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),o.animate&&"boolean"!=typeof o.animate&&this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),o.canvas?"string"==typeof o.canvas||o.canvas instanceof d.window.HTMLCanvasElement||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=o,this.animate=void 0===o.animate||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof d.window.HTMLCanvasElement?this.options.canvas:d.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const o=this.map.painter.context,c=o.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,d.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.Texture(o,this.canvas,c.RGBA,{premultiply:!0});for(const m in this.tiles){const y=this.tiles[m];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}}},vi=function(f,o,c,m){const y=new Ia[o.type](f,o,c,m);if(y.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${y.id}`);return d.bindAll(["load","abort","unload","serialize","prepare"],y),y};function K(f,o){const c=d.identity([]);return d.scale(c,c,[.5*f.width,.5*-f.height,1]),d.translate(c,c,[1,-1,0]),d.multiply$1(c,c,f.calculateProjMatrix(o.toUnwrapped()))}function L(f,o,c,m,y,x,E,C=!1){const P=f.tilesIn(m,E,C);P.sort(X);const F=[];for(const O of P)F.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(o,c,f._state,O,y,x,K(f.transform,O.tile.tileID),C)});const R=function(O){const j={},Z={};for(const H of O){const W=H.queryResults,se=H.wrappedTileID,G=Z[se]=Z[se]||{};for(const ne in W){const Q=W[ne],te=G[ne]=G[ne]||{},re=j[ne]=j[ne]||[];for(const ae of Q)te[ae.featureIndex]||(te[ae.featureIndex]=!0,re.push(ae))}}return j}(F);for(const O in R)R[O].forEach(j=>{const Z=j.feature,H=f.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=H});return R}function V(f,o){const c=f.getRenderableIds().map(x=>f.getTileByID(x)),m=[],y={};for(let x=0;x<c.length;x++){const E=c[x],C=E.tileID.canonical.key;y[C]||(y[C]=!0,E.querySourceFeatures(m,o))}return m}function X(f,o){const c=f.tileID,m=o.tileID;return c.overscaledZ-m.overscaledZ||c.canonical.y-m.canonical.y||c.wrap-m.wrap||c.canonical.x-m.canonical.x}function Y(){return null!=bs.workerClass?new bs.workerClass:new d.window.Worker(bs.workerUrl)}const le="mapboxgl_preloaded_worker_pool";class me{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<me.workerCount;)this.workers.push(new Y);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[le]}numActive(){return Object.keys(this.active).length}}let fe;function ue(){return fe||(fe=new me),fe}function ye(f,o){const c={};for(const m in f)"ref"!==m&&(c[m]=f[m]);return d.refProperties.forEach(m=>{m in o&&(c[m]=o[m])}),c}function Me(f){f=f.slice();const o=Object.create(null);for(let c=0;c<f.length;c++)o[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=ye(f[c],o[f[c].ref]));return f}me.workerCount=2;const Se={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function ze(f,o,c){c.push({command:Se.addSource,args:[f,o[f]]})}function nt(f,o,c){o.push({command:Se.removeSource,args:[f]}),c[f]=!0}function ct(f,o,c,m){nt(f,c,m),ze(f,o,c)}function lt(f,o,c){let m;for(m in f[c])if(f[c].hasOwnProperty(m)&&"data"!==m&&!yt(f[c][m],o[c][m]))return!1;for(m in o[c])if(o[c].hasOwnProperty(m)&&"data"!==m&&!yt(f[c][m],o[c][m]))return!1;return!0}function ut(f,o,c,m,y,x){let E;for(E in o=o||{},f=f||{})f.hasOwnProperty(E)&&(yt(f[E],o[E])||c.push({command:x,args:[m,E,o[E],y]}));for(E in o)o.hasOwnProperty(E)&&!f.hasOwnProperty(E)&&(yt(f[E],o[E])||c.push({command:x,args:[m,E,o[E],y]}))}function It(f){return f.id}function yn(f,o){return f[o.id]=o,f}class Cn{constructor(o,c){this.reset(o,c)}reset(o,c){this.points=o||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(1===this.points.length)return this.points[0];o=d.clamp(o,0,1);let c=1,m=this._distances[c];const y=o*this.paddedLength+this.padding;for(;m<y&&c<this._distances.length;)m=this._distances[++c];const x=c-1,E=this._distances[x],C=m-E,P=C>0?(y-E)/C:0;return this.points[x].mult(1-P).add(this.points[c].mult(P))}}class fn{constructor(o,c,m){const y=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(o/m),this.yCellCount=Math.ceil(c/m);for(let E=0;E<this.xCellCount*this.yCellCount;E++)y.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=c,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,c,m,y,x){this._forEachCell(c,m,y,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(x)}insertCircle(o,c,m,y){this._forEachCell(c-y,m-y,c+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(c),this.circles.push(m),this.circles.push(y)}_insertBoxCell(o,c,m,y,x,E){this.boxCells[x].push(E)}_insertCircleCell(o,c,m,y,x,E){this.circleCells[x].push(E)}_query(o,c,m,y,x,E){if(m<0||o>this.width||y<0||c>this.height)return!x&&[];const C=[];if(o<=0&&c<=0&&this.width<=m&&this.height<=y){if(x)return!0;for(let P=0;P<this.boxKeys.length;P++)C.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const F=this.circles[3*P],R=this.circles[3*P+1],O=this.circles[3*P+2];C.push({key:this.circleKeys[P],x1:F-O,y1:R-O,x2:F+O,y2:R+O})}return E?C.filter(E):C}return this._forEachCell(o,c,m,y,this._queryCell,C,{hitTest:x,seenUids:{box:{},circle:{}}},E),x?C.length>0:C}_queryCircle(o,c,m,y,x){const E=o-m,C=o+m,P=c-m,F=c+m;if(C<0||E>this.width||F<0||P>this.height)return!y&&[];const R=[];return this._forEachCell(E,P,C,F,this._queryCellCircle,R,{hitTest:y,circle:{x:o,y:c,radius:m},seenUids:{box:{},circle:{}}},x),y?R.length>0:R}query(o,c,m,y,x){return this._query(o,c,m,y,!1,x)}hitTest(o,c,m,y,x){return this._query(o,c,m,y,!0,x)}hitTestCircle(o,c,m,y){return this._queryCircle(o,c,m,!0,y)}_queryCell(o,c,m,y,x,E,C,P){const F=C.seenUids,R=this.boxCells[x];if(null!==R){const j=this.bboxes;for(const Z of R)if(!F.box[Z]){F.box[Z]=!0;const H=4*Z;if(o<=j[H+2]&&c<=j[H+3]&&m>=j[H+0]&&y>=j[H+1]&&(!P||P(this.boxKeys[Z]))){if(C.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[Z],x1:j[H],y1:j[H+1],x2:j[H+2],y2:j[H+3]})}}}const O=this.circleCells[x];if(null!==O){const j=this.circles;for(const Z of O)if(!F.circle[Z]){F.circle[Z]=!0;const H=3*Z;if(this._circleAndRectCollide(j[H],j[H+1],j[H+2],o,c,m,y)&&(!P||P(this.circleKeys[Z]))){if(C.hitTest)return E.push(!0),!0;{const W=j[H],se=j[H+1],G=j[H+2];E.push({key:this.circleKeys[Z],x1:W-G,y1:se-G,x2:W+G,y2:se+G})}}}}}_queryCellCircle(o,c,m,y,x,E,C,P){const F=C.circle,R=C.seenUids,O=this.boxCells[x];if(null!==O){const Z=this.bboxes;for(const H of O)if(!R.box[H]){R.box[H]=!0;const W=4*H;if(this._circleAndRectCollide(F.x,F.y,F.radius,Z[W+0],Z[W+1],Z[W+2],Z[W+3])&&(!P||P(this.boxKeys[H])))return E.push(!0),!0}}const j=this.circleCells[x];if(null!==j){const Z=this.circles;for(const H of j)if(!R.circle[H]){R.circle[H]=!0;const W=3*H;if(this._circlesCollide(Z[W],Z[W+1],Z[W+2],F.x,F.y,F.radius)&&(!P||P(this.circleKeys[H])))return E.push(!0),!0}}}_forEachCell(o,c,m,y,x,E,C,P){const F=this._convertToXCellCoord(o),R=this._convertToYCellCoord(c),O=this._convertToXCellCoord(m),j=this._convertToYCellCoord(y);for(let Z=F;Z<=O;Z++)for(let H=R;H<=j;H++)if(x.call(this,o,c,m,y,this.xCellCount*H+Z,E,C,P))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,c,m,y,x,E){const C=y-o,P=x-c,F=m+E;return F*F>C*C+P*P}_circleAndRectCollide(o,c,m,y,x,E,C){const P=(E-y)/2,F=Math.abs(o-(y+P));if(F>P+m)return!1;const R=(C-x)/2,O=Math.abs(c-(x+R));if(O>R+m)return!1;if(F<=P||O<=R)return!0;const j=F-P,Z=O-R;return j*j+Z*Z<=m*m}}const En=Math.tan(85*Math.PI/180);function us(f,o,c,m,y,x){let E=d.create();if(c){if("globe"===y.projection.name)E=d.calculateGlobeMatrix(y,y.worldSize/y._projectionScaler,[0,0]),d.multiply$1(E,E,d.globeDenormalizeECEF(d.globeTileBounds(o)));else{const C=Ke([],x);E[0]=C[0],E[1]=C[1],E[4]=C[2],E[5]=C[3]}m||d.rotateZ(E,E,y.angle)}else d.multiply$1(E,y.labelPlaneMatrix,f);return E}function zo(f,o,c,m,y,x){if(c){if("globe"===y.projection.name){const E=us(f,o,c,m,y,x);return d.invert(E,E),d.multiply$1(E,f,E),E}{const E=d.clone(f),C=d.identity([]);return C[0]=x[0],C[1]=x[1],C[4]=x[2],C[5]=x[3],d.multiply$1(E,E,C),m||d.rotateZ(E,E,-y.angle),E}}return y.glCoordMatrix}function $n(f,o,c=0){const m=[f.x,f.y,c,1];c?d.transformMat4$1(m,m,o):Aa(m,m,o);const y=m[3];return{point:new d.pointGeometry(m[0]/y,m[1]/y),signedDistanceFromCamera:y}}function ho(f,o){return Math.min(.5+f/o*.5,1.5)}function mc(f,o){const c=f[0]/f[3],m=f[1]/f[3];return c>=-o[0]&&c<=o[0]&&m>=-o[1]&&m<=o[1]}function vh(f,o,c,m,y,x,E,C,P,F){const R=c.transform,O=m?f.textSizeData:f.iconSizeData,j=d.evaluateSizeForZoom(O,c.transform.zoom),Z=[256/c.width*2+1,256/c.height*2+1],H=m?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;H.clear();const W=f.lineVertexArray,se=m?f.text.placedSymbolArray:f.icon.placedSymbolArray,G=c.transform.width/c.transform.height;let ne=!1;for(let Q=0;Q<se.length;Q++){const te=se.get(Q);if(te.writingMode!==d.WritingMode.vertical||ne||0!==Q&&se.get(Q-1).writingMode===d.WritingMode.horizontal||(ne=!0),te.hidden||te.writingMode===d.WritingMode.vertical&&!ne){mt(te.numGlyphs,H);continue}ne=!1;const re=new d.pointGeometry(te.tileAnchorX,te.tileAnchorY),ae=P?P(re):[0,0,0],_e=R.projection.projectTilePoint(re.x,re.y,F.canonical),xe=[_e.x+ae[0],_e.y+ae[1],_e.z+ae[2]],Ue=[...xe,1];if(d.transformMat4$1(Ue,Ue,o),!mc(Ue,Z)){mt(te.numGlyphs,H);continue}const Le=ho(c.transform.cameraToCenterDistance,Ue[3]),ke=d.evaluateSizeForFeature(O,j,te),be=E?ke/Le:ke*Le,ve=$n(new d.pointGeometry(xe[0],xe[1]),y,xe[2]);if(ve.signedDistanceFromCamera<=0){mt(te.numGlyphs,H);continue}let Fe={};const Ie=E?null:P,et=vl(te,be,!1,C,o,y,x,f.glyphOffsetArray,W,H,ve.point,re,Fe,G,Ie,R.projection,F);ne=et.useVertical,Ie&&et.needsFlipping&&(Fe={}),(et.notEnoughRoom||ne||et.needsFlipping&&vl(te,be,!0,C,o,y,x,f.glyphOffsetArray,W,H,ve.point,re,Fe,G,Ie,R.projection,F).notEnoughRoom)&&mt(te.numGlyphs,H)}m?f.text.dynamicLayoutVertexBuffer.updateData(H):f.icon.dynamicLayoutVertexBuffer.updateData(H)}function yl(f,o,c,m,y,x,E,C,P,F,R,O,j,Z,H){const W=C.glyphStartIndex+C.numGlyphs,se=C.lineStartIndex,G=C.lineStartIndex+C.lineLength,ne=o.getoffsetX(C.glyphStartIndex),Q=o.getoffsetX(W-1),te=xl(f*ne,c,m,y,x,E,C.segment,se,G,P,F,R,O,j,!0,Z,H);if(!te)return null;const re=xl(f*Q,c,m,y,x,E,C.segment,se,G,P,F,R,O,j,!0,Z,H);return re?{first:te,last:re}:null}function sn(f,o,c,m){return f.writingMode===d.WritingMode.horizontal&&Math.abs(c.y-o.y)>Math.abs(c.x-o.x)*m?{useVertical:!0}:f.writingMode===d.WritingMode.vertical?o.y<c.y?{needsFlipping:!0}:null:0!==f.flipState&&function(y,x,E){const C=(x.x-y.x)*E;return 0===C||Math.abs((x.y-y.y)/C)>En}(o,c,m)?1===f.flipState?{needsFlipping:!0}:null:o.x>c.x?{needsFlipping:!0}:null}function vl(f,o,c,m,y,x,E,C,P,F,R,O,j,Z,H,W,se){const G=o/24,ne=f.lineOffsetX*G,Q=f.lineOffsetY*G;let te;if(f.numGlyphs>1){const re=f.glyphStartIndex+f.numGlyphs,ae=f.lineStartIndex,_e=f.lineStartIndex+f.lineLength,xe=yl(G,C,ne,Q,c,R,O,f,P,x,j,H,!1,W,se);if(!xe)return{notEnoughRoom:!0};const Ue=$n(xe.first.point,E).point,Le=$n(xe.last.point,E).point;if(m&&!c){const ke=sn(f,Ue,Le,Z);if(f.flipState=ke&&ke.needsFlipping?1:2,ke)return ke}te=[xe.first];for(let ke=f.glyphStartIndex+1;ke<re-1;ke++)te.push(xl(G*C.getoffsetX(ke),ne,Q,c,R,O,f.segment,ae,_e,P,x,j,H,!1,!1,W,se));te.push(xe.last)}else{if(m&&!c){const ae=$n(O,y).point,_e=f.lineStartIndex+f.segment+1,xe=new d.pointGeometry(P.getx(_e),P.gety(_e)),Ue=$n(xe,y),Le=sn(f,ae,Ue.signedDistanceFromCamera>0?Ue.point:Sa(O,xe,ae,1,y,void 0,W,se.canonical),Z);if(f.flipState=Le&&Le.needsFlipping?1:2,Le)return Le}const re=xl(G*C.getoffsetX(f.glyphStartIndex),ne,Q,c,R,O,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,P,x,j,H,!1,!1,W,se);if(!re)return{notEnoughRoom:!0};te=[re]}for(const re of te)d.addDynamicAttributes(F,re.point,re.angle);return{}}function nn(f,o,c,m,y){const x=m.projectTilePoint(f.x,f.y,o);if(!y)return $n(x,c,x.z);const E=y(f);return $n(new d.pointGeometry(x.x+E[0],x.y+E[1]),c,x.z+E[2])}function Sa(f,o,c,m,y,x,E,C){const P=nn(f.add(f.sub(o)._unit()),C,y,E,x).point,F=c.sub(P);return c.add(F._mult(m/F.mag()))}function xl(f,o,c,m,y,x,E,C,P,F,R,O,j,Z,H,W,se){const G=m?f-o:f+o;let ne=G>0?1:-1,Q=0;m&&(ne*=-1,Q=Math.PI),ne<0&&(Q+=Math.PI);let te=ne>0?C+E:C+E+1,re=y,ae=y,_e=0,xe=0;const Ue=Math.abs(G),Le=[],ke=[];let be=x;const ve=()=>{const je=te-ne;return 0===_e?x:new d.pointGeometry(F.getx(je),F.gety(je))},Fe=()=>Sa(ve(),be,ae,Ue-_e+1,R,j,W,se.canonical);for(;_e+xe<=Ue;){if(te+=ne,te<C||te>=P)return null;if(ae=re,Le.push(re),Z&&ke.push(be||ve()),re=O[te],void 0===re){be=new d.pointGeometry(F.getx(te),F.gety(te));const je=nn(be,se.canonical,R,W,j);re=je.signedDistanceFromCamera>0?O[te]=je.point:Fe()}else be=null;_e+=xe,xe=ae.dist(re)}H&&j&&(be=be||new d.pointGeometry(F.getx(te),F.gety(te)),O[te]=re=void 0===O[te]?re:Fe(),xe=ae.dist(re));const Ie=(Ue-_e)/xe,et=re.sub(ae),at=et.mult(Ie)._add(ae);c&&at._add(et._unit()._perp()._mult(c*ne));const Tt=Q+Math.atan2(re.y-ae.y,re.x-ae.x);return Le.push(at),Z&&(be=be||new d.pointGeometry(F.getx(te),F.gety(te)),ke.push(function(je,ot,ft){const rn=1-ft;return new d.pointGeometry(je.x*rn+ot.x*ft,je.y*rn+ot.y*ft)}(ke.length>0?ke[ke.length-1]:be,be,Ie))),{point:at,angle:Tt,path:Le,tilePath:ke}}const bl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function mt(f,o){for(let c=0;c<f;c++){const m=o.length;o.resize(m+4),o.float32.set(bl,3*m)}}function Aa(f,o,c){const m=o[0],y=o[1];return f[0]=c[0]*m+c[4]*y+c[12],f[1]=c[1]*m+c[5]*y+c[13],f[3]=c[3]*m+c[7]*y+c[15],f}const Oo=100;class an{constructor(o,c,m=new fn(o.width+200,o.height+200,25),y=new fn(o.width+200,o.height+200,25)){this.transform=o,this.grid=m,this.ignoredGrid=y,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Oo,this.screenBottomBoundary=o.height+Oo,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=c}placeCollisionBox(o,c,m,y,x,E,C){let P=c.projectedAnchorX,F=c.projectedAnchorY,R=c.projectedAnchorZ;const O=c.elevation,j=c.tileID;if(O&&j){const te=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),re=te.upVector(j.canonical,c.tileAnchorX,c.tileAnchorY),ae=te.upVectorScale(j.canonical);P+=re[0]*O*ae,F+=re[1]*O*ae,R+=re[2]*O*ae}const Z=this.projectAndGetPerspectiveRatio(E,P,F,R,c.tileID),H=x*Z.perspectiveRatio,W=(c.x1*o+m.x-c.padding)*H+Z.point.x,se=(c.y1*o+m.y-c.padding)*H+Z.point.y,G=(c.x2*o+m.x+c.padding)*H+Z.point.x,ne=(c.y2*o+m.y+c.padding)*H+Z.point.y,Q=Z.perspectiveRatio<=.55||Z.aboveHorizon;return!this.isInsideGrid(W,se,G,ne)||!y&&this.grid.hitTest(W,se,G,ne,C)||Q?{box:[],offscreen:!1}:{box:[W,se,G,ne],offscreen:this.isOffscreen(W,se,G,ne)}}placeCollisionCircles(o,c,m,y,x,E,C,P,F,R,O,j,Z,H){const W=[],se=this.transform.elevation,G=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),ne=se?se.getAtTileOffsetFunc(H,G):Ie=>[0,0,0],Q=new d.pointGeometry(c.tileAnchorX,c.tileAnchorY),te=this.transform.projection.projectTilePoint(c.tileAnchorX,c.tileAnchorY,H.canonical),re=ne(Q),ae=[te.x+re[0],te.y+re[1],te.z+re[2]],_e=this.projectAndGetPerspectiveRatio(E,ae[0],ae[1],ae[2],H),{perspectiveRatio:xe}=_e,Ue=(R?x/xe:x*xe)/d.ONE_EM,Le=$n(new d.pointGeometry(ae[0],ae[1]),C,ae[2]).point,ke=_e.signedDistanceFromCamera>0?yl(Ue,y,c.lineOffsetX*Ue,c.lineOffsetY*Ue,!1,Le,Q,c,m,C,{},se&&!R?ne:null,R&&!!se,this.transform.projection,H):null;let be=!1,ve=!1,Fe=!0;if(ke&&!_e.aboveHorizon){const Ie=.5*j*xe+Z,et=new d.pointGeometry(-100,-100),at=new d.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Tt=new Cn,je=ke.first,ot=ke.last;let ft=[];for(let _t=je.path.length-1;_t>=1;_t--)ft.push(je.path[_t]);for(let _t=1;_t<ot.path.length;_t++)ft.push(ot.path[_t]);const rn=2.5*Ie;if(P){const _t=ft.map(se?(kt,gn)=>{const Zn=ne(gn<je.path.length-1?je.tilePath[je.path.length-1-gn]:ot.tilePath[gn-je.path.length+2]);return $n(kt,P,Zn[2])}:kt=>$n(kt,P));ft=_t.some(kt=>kt.signedDistanceFromCamera<=0)?[]:_t.map(kt=>kt.point)}let mn=[];if(ft.length>0){const _t=ft[0].clone(),kt=ft[0].clone();for(let gn=1;gn<ft.length;gn++)_t.x=Math.min(_t.x,ft[gn].x),_t.y=Math.min(_t.y,ft[gn].y),kt.x=Math.max(kt.x,ft[gn].x),kt.y=Math.max(kt.y,ft[gn].y);mn=_t.x>=et.x&&kt.x<=at.x&&_t.y>=et.y&&kt.y<=at.y?[ft]:kt.x<et.x||_t.x>at.x||kt.y<et.y||_t.y>at.y?[]:d.clipLine([ft],et.x,et.y,at.x,at.y)}for(const _t of mn){Tt.reset(_t,.25*Ie);let kt=0;kt=Tt.length<=.5*Ie?1:Math.ceil(Tt.paddedLength/rn)+1;for(let gn=0;gn<kt;gn++){const Zn=gn/Math.max(kt-1,1),kr=Tt.lerp(Zn),qr=kr.x+Oo,Bi=kr.y+Oo;W.push(qr,Bi,Ie,0);const Nt=qr-Ie,pt=Bi-Ie,Lt=qr+Ie,bn=Bi+Ie;if(Fe=Fe&&this.isOffscreen(Nt,pt,Lt,bn),ve=ve||this.isInsideGrid(Nt,pt,Lt,bn),!o&&this.grid.hitTestCircle(qr,Bi,Ie,O)&&(be=!0,!F))return{circles:[],offscreen:!1,collisionDetected:be}}}}return{circles:!F&&be||!ve?[]:W,offscreen:Fe,collisionDetected:be}}queryRenderedSymbols(o){if(0===o.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let m=1/0,y=1/0,x=-1/0,E=-1/0;for(const R of o){const O=new d.pointGeometry(R.x+Oo,R.y+Oo);m=Math.min(m,O.x),y=Math.min(y,O.y),x=Math.max(x,O.x),E=Math.max(E,O.y),c.push(O)}const C=this.grid.query(m,y,x,E).concat(this.ignoredGrid.query(m,y,x,E)),P={},F={};for(const R of C){const O=R.key;if(void 0===P[O.bucketInstanceId]&&(P[O.bucketInstanceId]={}),P[O.bucketInstanceId][O.featureIndex])continue;const j=[new d.pointGeometry(R.x1,R.y1),new d.pointGeometry(R.x2,R.y1),new d.pointGeometry(R.x2,R.y2),new d.pointGeometry(R.x1,R.y2)];d.polygonIntersectsPolygon(c,j)&&(P[O.bucketInstanceId][O.featureIndex]=!0,void 0===F[O.bucketInstanceId]&&(F[O.bucketInstanceId]=[]),F[O.bucketInstanceId].push(O.featureIndex))}return F}insertCollisionBox(o,c,m,y,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:x},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,c,m,y,x){const E=c?this.ignoredGrid:this.grid,C={bucketInstanceId:m,featureIndex:y,collisionGroupID:x};for(let P=0;P<o.length;P+=4)E.insertCircle(C,o[P],o[P+1],o[P+2])}projectAndGetPerspectiveRatio(o,c,m,y,x){const E=[c,m,y||0,1];let C=!1;if(y||this.transform.pitch>0){d.transformMat4$1(E,E,o);let P=!1;this.fogState&&x&&(P=function(F,R,O,j,Z,H){const W=H.calculateFogTileMatrix(Z),se=[R,O,j];return d.transformMat4(se,se,W),Wi(F,se,H.pitch,H._fov)}(this.fogState,c,m,y||0,x.toUnwrapped(),this.transform)>.9),C=E[2]>E[3]||P}else Aa(E,E,o);return{point:new d.pointGeometry((E[0]/E[3]+1)/2*this.transform.width+Oo,(-E[1]/E[3]+1)/2*this.transform.height+Oo),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/E[3]*.5,1.5),signedDistanceFromCamera:E[3],aboveHorizon:C}}isOffscreen(o,c,m,y){return m<Oo||o>=this.screenRightBoundary||y<Oo||c>this.screenBottomBoundary}isInsideGrid(o,c,m,y){return m>=0&&o<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const o=d.identity([]);return d.translate(o,o,[-100,-100,0]),o}}class gc{constructor(o,c,m,y){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?c:-c))):y&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class vt{constructor(o,c,m,y,x,E=!1){this.text=new gc(o?o.text:null,c,m,x),this.icon=new gc(o?o.icon:null,c,y,x),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Yn{constructor(o,c,m,y=!1){this.text=o,this.icon=c,this.skipFade=m,this.clipped=y}}class wl{constructor(){this.invProjMatrix=d.create(),this.viewportMatrix=d.create(),this.circles=[]}}class Gd{constructor(o,c,m,y,x){this.bucketInstanceId=o,this.featureIndex=c,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=x}}class Hd{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const c=++this.maxGroupID;this.collisionGroups[o]={ID:c,predicate:m=>m.collisionGroupID===c}}return this.collisionGroups[o]}}function Os(f,o,c,m,y){const{horizontalAlign:x,verticalAlign:E}=d.getAnchorAlignment(f),C=-(x-.5)*o,P=-(E-.5)*c,F=d.evaluateVariableOffset(f,m);return new d.pointGeometry(C+F[0]*y,P+F[1]*y)}function Qn(f,o,c,m,y){const x=new d.pointGeometry(f,o);return c&&x._rotate(m?y:-y),x}class au{constructor(o,c,m,y,x){this.transform=o.clone(),this.collisionIndex=new an(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Hd(m),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,c,m,y){const x=m.getBucket(c),E=m.latestFeatureIndex;if(!x||!E||c.id!==x.layerIds[0])return;const C=x.layers[0].layout,P=m.collisionBoxArray,F=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),R=m.tileSize/d.EXTENT,O=m.tileID.toUnwrapped(),j=this.transform.calculateProjMatrix(O),Z="map"===C.get("text-pitch-alignment"),H="map"===C.get("text-rotation-alignment");c.compileFilter();const W=c.dynamicFilter(),se=c.dynamicFilterNeedsFeature(),G=this.transform.calculatePixelsToTileUnitsMatrix(m),ne=us(j,m.tileID.canonical,Z,H,this.transform,G);let Q=null;if(Z){const ae=zo(j,m.tileID.canonical,Z,H,this.transform,G);Q=d.multiply$1([],this.transform.labelPlaneMatrix,ae)}let te=null;W&&m.latestFeatureIndex&&(te={unwrappedTileID:O,dynamicFilter:W,dynamicFilterNeedsFeature:se,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new Gd(x.bucketInstanceId,E,x.sourceLayerIndex,x.index,m.tileID);const re={bucket:x,layout:C,posMatrix:j,textLabelPlaneMatrix:ne,labelToScreenMatrix:Q,clippingData:te,scale:F,textPixelRatio:R,holdingForFade:m.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:d.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:d.evaluateSizeForZoom(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(y)for(const ae of x.sortKeyRanges){const{sortKey:_e,symbolInstanceStart:xe,symbolInstanceEnd:Ue}=ae;o.push({sortKey:_e,symbolInstanceStart:xe,symbolInstanceEnd:Ue,parameters:re})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:re})}attemptAnchorPlacement(o,c,m,y,x,E,C,P,F,R,O,j,Z,H,W,se,G,ne){const Q=[j.textOffset0,j.textOffset1],te=Os(o,m,y,Q,x),re=this.collisionIndex.placeCollisionBox(x,c,Qn(te.x,te.y,E,C,this.transform.angle),O,P,F,R.predicate);if((!se||0!==this.collisionIndex.placeCollisionBox(H.getSymbolInstanceIconSize(ne,this.transform.zoom,Z),se,Qn(te.x,te.y,E,C,this.transform.angle),O,P,F,R.predicate).box.length)&&re.box.length>0){let ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(ae=this.prevPlacement.variableOffsets[j.crossTileID].anchor),this.variableOffsets[j.crossTileID]={textOffset:Q,width:m,height:y,anchor:o,textScale:x,prevAnchor:ae},this.markUsedJustification(H,o,j,W),H.allowVerticalPlacement&&(this.markUsedOrientation(H,W,j),this.placedOrientations[j.crossTileID]=W),{shift:te,placedGlyphBoxes:re}}}placeLayerBucketPart(o,c,m,y){const{bucket:x,layout:E,posMatrix:C,textLabelPlaneMatrix:P,labelToScreenMatrix:F,clippingData:R,textPixelRatio:O,holdingForFade:j,collisionBoxArray:Z,partiallyEvaluatedTextSize:H,partiallyEvaluatedIconSize:W,collisionGroup:se}=o.parameters,G=E.get("text-optional"),ne=E.get("icon-optional"),Q=E.get("text-allow-overlap"),te=E.get("icon-allow-overlap"),re="map"===E.get("text-rotation-alignment"),ae="map"===E.get("text-pitch-alignment"),_e="none"!==E.get("icon-text-fit"),xe="viewport-y"===E.get("symbol-z-order"),Ue=Q&&(te||!x.hasIconData()||ne),Le=te&&(Q||!x.hasTextData()||G);!x.collisionArrays&&Z&&x.deserializeCollisionBoxes(Z),m&&y&&x.updateCollisionDebugBuffers(this.transform.zoom,Z);const ke=(be,ve,Fe)=>{if(R){const Nt={zoom:this.transform.zoom,pitch:this.transform.pitch};let pt=null;if(R.dynamicFilterNeedsFeature){const Lt=this.retainedQueryData[x.bucketInstanceId];pt=R.featureIndex.loadFeature({featureIndex:be.featureIndex,bucketIndex:Lt.bucketIndex,sourceLayerIndex:Lt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,R.dynamicFilter)(Nt,pt,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new d.pointGeometry(be.tileAnchorX,be.tileAnchorY),this.transform.calculateDistanceTileData(R.unwrappedTileID)))return this.placements[be.crossTileID]=new Yn(!1,!1,!1,!0),void(c[be.crossTileID]=!0)}if(c[be.crossTileID])return;if(j)return void(this.placements[be.crossTileID]=new Yn(!1,!1,!1));let Ie=!1,et=!1,at=!0,Tt=null,je={box:null,offscreen:null},ot={box:null,offscreen:null},ft=null,rn=null,mn=null,_t=0,kt=0,gn=0;Fe.textFeatureIndex?_t=Fe.textFeatureIndex:be.useRuntimeCollisionCircles&&(_t=be.featureIndex),Fe.verticalTextFeatureIndex&&(kt=Fe.verticalTextFeatureIndex);const Zn=Nt=>{Nt.tileID=this.retainedQueryData[x.bucketInstanceId].tileID,(this.transform.elevation||Nt.elevation)&&(Nt.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[x.bucketInstanceId].tileID,Nt.tileAnchorX,Nt.tileAnchorY):0)},kr=Fe.textBox;if(kr){Zn(kr);const Nt=Lt=>{let bn=d.WritingMode.horizontal;if(x.allowVerticalPlacement&&!Lt&&this.prevPlacement){const Zr=this.prevPlacement.placedOrientations[be.crossTileID];Zr&&(this.placedOrientations[be.crossTileID]=Zr,bn=Zr,this.markUsedOrientation(x,bn,be))}return bn},pt=(Lt,bn)=>{if(x.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&Fe.verticalTextBox){for(const Zr of x.writingModes)if(Zr===d.WritingMode.vertical?(je=bn(),ot=je):je=Lt(),je&&je.box&&je.box.length)break}else je=Lt()};if(E.get("text-variable-anchor")){let Lt=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[be.crossTileID]){const hn=this.prevPlacement.variableOffsets[be.crossTileID];Lt.indexOf(hn.anchor)>0&&(Lt=Lt.filter(Ni=>Ni!==hn.anchor),Lt.unshift(hn.anchor))}const bn=(hn,Ni,Ua)=>{const Wr=x.getSymbolInstanceTextSize(H,be,this.transform.zoom,ve),ia=(hn.x2-hn.x1)*Wr+2*hn.padding,tt=(hn.y2-hn.y1)*Wr+2*hn.padding,st=_e&&!te?Ni:null;st&&Zn(st);let nr={box:[],offscreen:!1};const qo=Q?2*Lt.length:Lt.length;for(let eo=0;eo<qo;++eo){const rr=this.attemptAnchorPlacement(Lt[eo%Lt.length],hn,ia,tt,Wr,re,ae,O,C,se,eo>=Lt.length,be,ve,x,Ua,st,H,W);if(rr&&(nr=rr.placedGlyphBoxes,nr&&nr.box&&nr.box.length)){Ie=!0,Tt=rr.shift;break}}return nr};pt(()=>bn(kr,Fe.iconBox,d.WritingMode.horizontal),()=>{const hn=Fe.verticalTextBox;return hn&&Zn(hn),x.allowVerticalPlacement&&!(je&&je.box&&je.box.length)&&be.numVerticalGlyphVertices>0&&hn?bn(hn,Fe.verticalIconBox,d.WritingMode.vertical):{box:null,offscreen:null}}),je&&(Ie=je.box,at=je.offscreen);const Zr=Nt(je&&je.box);if(!Ie&&this.prevPlacement){const hn=this.prevPlacement.variableOffsets[be.crossTileID];hn&&(this.variableOffsets[be.crossTileID]=hn,this.markUsedJustification(x,hn.anchor,be,Zr))}}else{const Lt=(bn,Zr)=>{const hn=x.getSymbolInstanceTextSize(H,be,this.transform.zoom,ve),Ni=this.collisionIndex.placeCollisionBox(hn,bn,new d.pointGeometry(0,0),Q,O,C,se.predicate);return Ni&&Ni.box&&Ni.box.length&&(this.markUsedOrientation(x,Zr,be),this.placedOrientations[be.crossTileID]=Zr),Ni};pt(()=>Lt(kr,d.WritingMode.horizontal),()=>{const bn=Fe.verticalTextBox;return x.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&bn?(Zn(bn),Lt(bn,d.WritingMode.vertical)):{box:null,offscreen:null}}),Nt(je&&je.box&&je.box.length)}}if(ft=je,Ie=ft&&ft.box&&ft.box.length>0,at=ft&&ft.offscreen,be.useRuntimeCollisionCircles){const Nt=x.text.placedSymbolArray.get(be.centerJustifiedTextSymbolIndex>=0?be.centerJustifiedTextSymbolIndex:be.verticalPlacedTextSymbolIndex),pt=d.evaluateSizeForFeature(x.textSizeData,H,Nt),Lt=E.get("text-padding");rn=this.collisionIndex.placeCollisionCircles(Q,Nt,x.lineVertexArray,x.glyphOffsetArray,pt,C,P,F,m,ae,se.predicate,be.collisionCircleDiameter*pt/d.ONE_EM,Lt,this.retainedQueryData[x.bucketInstanceId].tileID),Ie=Q||rn.circles.length>0&&!rn.collisionDetected,at=at&&rn.offscreen}if(Fe.iconFeatureIndex&&(gn=Fe.iconFeatureIndex),Fe.iconBox){const Nt=pt=>{Zn(pt);const Lt=_e&&Tt?Qn(Tt.x,Tt.y,re,ae,this.transform.angle):new d.pointGeometry(0,0),bn=x.getSymbolInstanceIconSize(W,this.transform.zoom,ve);return this.collisionIndex.placeCollisionBox(bn,pt,Lt,te,O,C,se.predicate)};ot&&ot.box&&ot.box.length&&Fe.verticalIconBox?(mn=Nt(Fe.verticalIconBox),et=mn.box.length>0):(mn=Nt(Fe.iconBox),et=mn.box.length>0),at=at&&mn.offscreen}const qr=G||0===be.numHorizontalGlyphVertices&&0===be.numVerticalGlyphVertices,Bi=ne||0===be.numIconVertices;if(qr||Bi?Bi?qr||(et=et&&Ie):Ie=et&&Ie:et=Ie=et&&Ie,Ie&&ft&&ft.box&&this.collisionIndex.insertCollisionBox(ft.box,E.get("text-ignore-placement"),x.bucketInstanceId,ot&&ot.box&&kt?kt:_t,se.ID),et&&mn&&this.collisionIndex.insertCollisionBox(mn.box,E.get("icon-ignore-placement"),x.bucketInstanceId,gn,se.ID),rn&&(Ie&&this.collisionIndex.insertCollisionCircles(rn.circles,E.get("text-ignore-placement"),x.bucketInstanceId,_t,se.ID),m)){const Nt=x.bucketInstanceId;let pt=this.collisionCircleArrays[Nt];void 0===pt&&(pt=this.collisionCircleArrays[Nt]=new wl);for(let Lt=0;Lt<rn.circles.length;Lt+=4)pt.circles.push(rn.circles[Lt+0]),pt.circles.push(rn.circles[Lt+1]),pt.circles.push(rn.circles[Lt+2]),pt.circles.push(rn.collisionDetected?1:0)}this.placements[be.crossTileID]=new Yn(Ie||Ue,et||Le,at||x.justReloaded),c[be.crossTileID]=!0};if(xe){const be=x.getSortedSymbolIndexes(this.transform.angle);for(let ve=be.length-1;ve>=0;--ve){const Fe=be[ve];ke(x.symbolInstances.get(Fe),Fe,x.collisionArrays[Fe])}}else for(let be=o.symbolInstanceStart;be<o.symbolInstanceEnd;be++)ke(x.symbolInstances.get(be),be,x.collisionArrays[be]);if(m&&x.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[x.bucketInstanceId];d.invert(be.invProjMatrix,C),be.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(o,c,m,y){let x;x=y===d.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[d.getAnchorJustification(c)];const E=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const C of E)C>=0&&(o.text.placedSymbolArray.get(C).crossTileID=x>=0&&C!==x?0:m.crossTileID)}markUsedOrientation(o,c,m){const y=c===d.WritingMode.horizontal||c===d.WritingMode.horizontalOnly?c:0,x=c===d.WritingMode.vertical?c:0,E=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const C of E)o.text.placedSymbolArray.get(C).placedOrientation=y;m.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let m=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const y=c?c.symbolFadeChange(o):1,x=c?c.opacities:{},E=c?c.variableOffsets:{},C=c?c.placedOrientations:{};for(const P in this.placements){const F=this.placements[P],R=x[P];R?(this.opacities[P]=new vt(R,y,F.text,F.icon,null,F.clipped),m=m||F.text!==R.text.placed||F.icon!==R.icon.placed):(this.opacities[P]=new vt(null,y,F.text,F.icon,F.skipFade,F.clipped),m=m||F.text||F.icon)}for(const P in x){const F=x[P];if(!this.opacities[P]){const R=new vt(F,y,!1,!1);R.isHidden()||(this.opacities[P]=R,m=m||F.text.placed||F.icon.placed)}}for(const P in E)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=E[P]);for(const P in C)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=C[P]);m?this.lastPlacementChangeTime=o:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:o)}updateLayerOpacities(o,c){const m={};for(const y of c){const x=y.getBucket(o);x&&y.latestFeatureIndex&&o.id===x.layerIds[0]&&this.updateBucketOpacities(x,m,y.collisionBoxArray)}}updateBucketOpacities(o,c,m){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const y=o.layers[0].layout,x=!!o.layers[0].dynamicFilter(),E=new vt(null,0,!1,!1,!0),C=y.get("text-allow-overlap"),P=y.get("icon-allow-overlap"),F=y.get("text-variable-anchor"),R="map"===y.get("text-rotation-alignment"),O="map"===y.get("text-pitch-alignment"),j="none"!==y.get("icon-text-fit"),Z=new vt(null,0,C&&(P||!o.hasIconData()||y.get("icon-optional")),P&&(C||!o.hasTextData()||y.get("text-optional")),!0);!o.collisionArrays&&m&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(m);const H=(se,G,ne)=>{for(let Q=0;Q<G/4;Q++)se.opacityVertexArray.emplaceBack(ne)};let W=0;for(let se=0;se<o.symbolInstances.length;se++){const G=o.symbolInstances.get(se),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:Q,crossTileID:te}=G;let re=this.opacities[te];c[te]?re=E:re||(re=Z,this.opacities[te]=re),c[te]=!0;const ae=ne>0||Q>0,_e=G.numIconVertices>0,xe=this.placedOrientations[G.crossTileID],Ue=xe===d.WritingMode.vertical,Le=xe===d.WritingMode.horizontal||xe===d.WritingMode.horizontalOnly;if(!ae&&!_e||re.isHidden()||W++,ae){const ke=lu(re.text);H(o.text,ne,Ue?ps:ke),H(o.text,Q,Le?ps:ke);const be=re.text.isHidden();[G.rightJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.leftJustifiedTextSymbolIndex].forEach(Ie=>{Ie>=0&&(o.text.placedSymbolArray.get(Ie).hidden=be||Ue?1:0)}),G.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(G.verticalPlacedTextSymbolIndex).hidden=be||Le?1:0);const ve=this.variableOffsets[G.crossTileID];ve&&this.markUsedJustification(o,ve.anchor,G,xe);const Fe=this.placedOrientations[G.crossTileID];Fe&&(this.markUsedJustification(o,"left",G,Fe),this.markUsedOrientation(o,Fe,G))}if(_e){const ke=lu(re.icon);G.placedIconSymbolIndex>=0&&(H(o.icon,G.numIconVertices,Ue?ps:ke),o.icon.placedSymbolArray.get(G.placedIconSymbolIndex).hidden=re.icon.isHidden()),G.verticalPlacedIconSymbolIndex>=0&&(H(o.icon,G.numVerticalIconVertices,Le?ps:ke),o.icon.placedSymbolArray.get(G.verticalPlacedIconSymbolIndex).hidden=re.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const ke=o.collisionArrays[se];if(ke){let be=new d.pointGeometry(0,0),ve=!0;if(ke.textBox||ke.verticalTextBox){if(F){const Ie=this.variableOffsets[te];Ie?(be=Os(Ie.anchor,Ie.width,Ie.height,Ie.textOffset,Ie.textScale),R&&be._rotate(O?this.transform.angle:-this.transform.angle)):ve=!1}x&&(ve=!re.clipped),ke.textBox&&hs(o.textCollisionBox.collisionVertexArray,re.text.placed,!ve||Ue,be.x,be.y),ke.verticalTextBox&&hs(o.textCollisionBox.collisionVertexArray,re.text.placed,!ve||Le,be.x,be.y)}const Fe=ve&&Boolean(!Le&&ke.verticalIconBox);ke.iconBox&&hs(o.iconCollisionBox.collisionVertexArray,re.icon.placed,Fe,j?be.x:0,j?be.y:0),ke.verticalIconBox&&hs(o.iconCollisionBox.collisionVertexArray,re.icon.placed,!Fe,j?be.x:0,j?be.y:0)}}}if(o.fullyClipped=0===W,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=se.invProjMatrix,o.placementViewportMatrix=se.viewportMatrix,o.collisionCircleArray=se.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return 0===this.fadeDuration?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,c){const m=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*m>o}setStale(){this.stale=!0}}function hs(f,o,c,m,y){f.emplaceBack(o?1:0,c?1:0,m||0,y||0),f.emplaceBack(o?1:0,c?1:0,m||0,y||0),f.emplaceBack(o?1:0,c?1:0,m||0,y||0),f.emplaceBack(o?1:0,c?1:0,m||0,y||0)}const Ee=Math.pow(2,25),qe=Math.pow(2,24),qd=Math.pow(2,17),Bs=Math.pow(2,16),Gn=Math.pow(2,9),ds=Math.pow(2,8),po=Math.pow(2,1);function lu(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const o=f.placed?1:0,c=Math.floor(127*f.opacity);return c*Ee+o*qe+c*qd+o*Bs+c*Gn+o*ds+c*po+o}const ps=0;class Je{constructor(o){this._sortAcrossTiles="viewport-y"!==o.layout.get("symbol-z-order")&&void 0!==o.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,c,m,y,x){const E=this._bucketParts;for(;this._currentTileIndex<o.length;)if(c.getBucketParts(E,y,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((C,P)=>C.sortKey-P.sortKey));this._currentPartIndex<E.length;){const C=E[this._currentPartIndex];if(c.placeLayerBucketPart(C,this._seenCrossTileIDs,m,0===C.symbolInstanceStart),this._currentPartIndex++,x())return!0}return!1}}class gt{constructor(o,c,m,y,x,E,C,P){this.placement=new au(o,x,E,C,P),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(o,c,m){const y=d.exported.now(),x=()=>{const E=d.exported.now()-y;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=c[o[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if("symbol"===E.type&&(!E.minzoom||E.minzoom<=C)&&(!E.maxzoom||E.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Je(E)),this._inProgressLayer.continuePlacement(m[E.source],this.placement,this._showCollisionBoxes,E,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const it=512/d.EXTENT/2;class Bo{constructor(o,c,m){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let y=0;y<c.length;y++){const x=c.get(y),E=x.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,o)})}}getScaledCoordinates(o,c){const m=it/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*d.EXTENT+o.tileAnchorX)*m),y:Math.floor((c.canonical.y*d.EXTENT+o.tileAnchorY)*m)}}findMatches(o,c,m){const y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let x=0;x<o.length;x++){const E=o.get(x);if(E.crossTileID)continue;const C=this.indexedSymbolInstances[E.key];if(!C)continue;const P=this.getScaledCoordinates(E,c);for(const F of C)if(Math.abs(F.coord.x-P.x)<=y&&Math.abs(F.coord.y-P.y)<=y&&!m[F.crossTileID]){m[F.crossTileID]=!0,E.crossTileID=F.crossTileID;break}}}}class El{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class St{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const c=Math.round((o-this.lng)/360);if(0!==c)for(const m in this.indexes){const y=this.indexes[m],x={};for(const E in y){const C=y[E];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+c),x[C.tileID.key]=C}this.indexes[m]=x}this.lng=o}addBucket(o,c,m){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let x=0;x<c.symbolInstances.length;x++)c.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const y=this.usedCrossTileIDs[o.overscaledZ];for(const x in this.indexes){const E=this.indexes[x];if(Number(x)>o.overscaledZ)for(const C in E){const P=E[C];P.tileID.isChildOf(o)&&P.findMatches(c.symbolInstances,o,y)}else{const C=E[o.scaledTo(Number(x)).key];C&&C.findMatches(c.symbolInstances,o,y)}}for(let x=0;x<c.symbolInstances.length;x++){const E=c.symbolInstances.get(x);E.crossTileID||(E.crossTileID=m.generate(),y[E.crossTileID]=!0)}return void 0===this.indexes[o.overscaledZ]&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Bo(o,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(o,c){for(const m in c.indexedSymbolInstances)for(const y of c.indexedSymbolInstances[m])delete this.usedCrossTileIDs[o][y.crossTileID]}removeStaleBuckets(o){let c=!1;for(const m in this.indexes){const y=this.indexes[m];for(const x in y)o[y[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[x]),delete y[x],c=!0)}return c}}class en{constructor(){this.layerIndexes={},this.crossTileIDs=new El,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,c,m,y){let x=this.layerIndexes[o.id];void 0===x&&(x=this.layerIndexes[o.id]=new St);let E=!1;const C={};"globe"!==y.name&&x.handleWrapJump(m);for(const P of c){const F=P.getBucket(o);F&&o.id===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(P.tileID,F,this.crossTileIDs)&&(E=!0),C[F.bucketInstanceId]=!0)}return x.removeStaleBuckets(C)&&(E=!0),E}pruneUnusedLayers(o){const c={};o.forEach(m=>{c[m]=!0});for(const m in this.layerIndexes)c[m]||delete this.layerIndexes[m]}}const Ns=(f,o)=>d.emitValidationErrors(f,o&&o.filter(c=>"source.canvas"!==c.identifier)),ki=d.pick(Se,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ni=d.pick(Se,["setCenter","setZoom","setBearing","setPitch"]),In=function(){const f={},o=d.spec.$version;for(const c in d.spec.$root){const m=d.spec.$root[c];if(m.required){let y=null;y="version"===c?o:"array"===m.type?[]:{},null!=y&&(f[c]=y)}}return f}(),Zd={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ri extends d.Evented{constructor(o,c={}){super(),this.map=o,this.dispatcher=new Xi(ue(),this),this.imageManager=new fr,this.imageManager.setEventedParent(this),this.glyphManager=new d.GlyphManager(o._requestManager,c.localFontFamily?d.LocalGlyphMode.all:c.localIdeographFontFamily?d.LocalGlyphMode.ideographs:d.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.lineAtlas=new d.LineAtlas(256,512),this.crossTileSymbolIndex=new en,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new d.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.getReferrer());const m=this;this._rtlTextPluginCallback=ri.registerForPluginStateChange(y=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(x,E)=>{if(d.triggerPluginCompletionEvent(x),E&&E.every(C=>C))for(const C in m._sourceCaches){const P=m._sourceCaches[C],F=P.getSource().type;"vector"!==F&&"geojson"!==F||P.reload()}})}),this.on("data",y=>{if("source"!==y.dataType||"metadata"!==y.sourceDataType)return;const x=this.getSource(y.sourceId);if(x&&x.vectorLayerIds)for(const E in this._layers){const C=this._layers[E];C.source===x.id&&this._validateLayer(C)}})}loadURL(o,c={}){this.fire(new d.Event("dataloading",{dataType:"style"}));const m="boolean"==typeof c.validate?c.validate:!d.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,c.accessToken);const y=this.map._requestManager.transformRequest(o,d.ResourceType.Style);this._request=d.getJSON(y,(x,E)=>{this._request=null,x?this.fire(new d.ErrorEvent(x)):E&&this._load(E,m)})}loadJSON(o,c={}){this.fire(new d.Event("dataloading",{dataType:"style"})),this._request=d.exported.frame(()=>{this._request=null,this._load(o,!1!==c.validate)})}loadEmpty(){this.fire(new d.Event("dataloading",{dataType:"style"})),this._load(In,!1)}_updateLayerCount(o,c){const m=c?1:-1;o.is3D()&&(this._num3DLayers+=m),"circle"===o.type&&(this._numCircleLayers+=m),"symbol"===o.type&&(this._numSymbolLayers+=m)}_load(o,c){if(c&&Ns(this,d.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o,this.updateProjection();for(const y in o.sources)this.addSource(y,o.sources[y],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const m=Me(this.stylesheet.layers);this._order=m.map(y=>y.id),this._layers={},this._serializedLayers={};for(let y of m)y=d.createStyleLayer(y),y.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=y,this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ko(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new d.Event("data",{dataType:"style"})),this.fire(new d.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&0===this.terrain.drapeRenderMode}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const o=this.map.transform.projection,c=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),m=this.map.transform.projection;if(this._loaded&&(m.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),c){if(m.isReprojectedInTileSpace||o.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(o){this._spriteRequest=function(c,m,y){let x,E,C;const P=d.exported.devicePixelRatio>1?"@2x":"";let F=d.getJSON(m.transformRequest(m.normalizeSpriteURL(c,P,".json"),d.ResourceType.SpriteJSON),(j,Z)=>{F=null,C||(C=j,x=Z,O())}),R=d.getImage(m.transformRequest(m.normalizeSpriteURL(c,P,".png"),d.ResourceType.SpriteImage),(j,Z)=>{R=null,C||(C=j,E=Z,O())});function O(){if(C)y(C);else if(x&&E){const j=d.exported.getImageData(E),Z={};for(const H in x){const{width:W,height:se,x:G,y:ne,sdf:Q,pixelRatio:te,stretchX:re,stretchY:ae,content:_e}=x[H],xe=new d.RGBAImage({width:W,height:se});d.RGBAImage.copy(j,xe,{x:G,y:ne},{x:0,y:0},{width:W,height:se}),Z[H]={data:xe,pixelRatio:te,sdf:Q,stretchX:re,stretchY:ae,content:_e}}y(null,Z)}}return{cancel(){F&&(F.cancel(),F=null),R&&(R.cancel(),R=null)}}}(o,this.map._requestManager,(c,m)=>{if(this._spriteRequest=null,c)this.fire(new d.ErrorEvent(c));else if(m)for(const y in m)this.imageManager.addImage(y,m[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new d.Event("data",{dataType:"style"}))})}_validateLayer(o){const c=this.getSource(o.source);if(!c)return;const m=o.sourceLayer;m&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(m))&&this.fire(new d.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${c.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const c=[];for(const m of o){const y=this._layers[m];"custom"!==y.type&&c.push(y.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&Zd[o.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const c=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(y.length||x.length)&&this._updateWorkerLayers(y,x);for(const E in this._updatedSources){const C=this._updatedSources[E];"reload"===C?this._reloadSource(E):"clear"===C&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const m={};for(const y in this._sourceCaches){const x=this._sourceCaches[y];m[y]=x.used,x.used=!1}for(const y of this._order){const x=this._layers[y];if(x.recalculate(o,this._availableImages),!x.isHidden(o.zoom)){const C=this._getLayerSourceCache(x);C&&(C.used=!0)}const E=this.map.painter;if(E){const C=x.getProgramIds();if(!C)continue;const P=x.getProgramConfiguration(o.zoom);for(const F of C)E.useProgram(F,P)}}for(const y in m){const x=this._sourceCaches[y];m[y]!==x.used&&x.getSource().fire(new d.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new d.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),Ns(this,d.validateStyle(o)))return!1;(o=d.clone$1(o)).layers=Me(o.layers);const c=function(y,x){if(!y)return[{command:Se.setStyle,args:[x]}];let E=[];try{if(!yt(y.version,x.version))return[{command:Se.setStyle,args:[x]}];yt(y.center,x.center)||E.push({command:Se.setCenter,args:[x.center]}),yt(y.zoom,x.zoom)||E.push({command:Se.setZoom,args:[x.zoom]}),yt(y.bearing,x.bearing)||E.push({command:Se.setBearing,args:[x.bearing]}),yt(y.pitch,x.pitch)||E.push({command:Se.setPitch,args:[x.pitch]}),yt(y.sprite,x.sprite)||E.push({command:Se.setSprite,args:[x.sprite]}),yt(y.glyphs,x.glyphs)||E.push({command:Se.setGlyphs,args:[x.glyphs]}),yt(y.transition,x.transition)||E.push({command:Se.setTransition,args:[x.transition]}),yt(y.light,x.light)||E.push({command:Se.setLight,args:[x.light]}),yt(y.fog,x.fog)||E.push({command:Se.setFog,args:[x.fog]}),yt(y.projection,x.projection)||E.push({command:Se.setProjection,args:[x.projection]});const C={},P=[];!function(O,j,Z,H){let W;for(W in j=j||{},O=O||{})O.hasOwnProperty(W)&&(j.hasOwnProperty(W)||nt(W,Z,H));for(W in j)j.hasOwnProperty(W)&&(O.hasOwnProperty(W)?yt(O[W],j[W])||("geojson"===O[W].type&&"geojson"===j[W].type&&lt(O,j,W)?Z.push({command:Se.setGeoJSONSourceData,args:[W,j[W].data]}):ct(W,j,Z,H)):ze(W,j,Z))}(y.sources,x.sources,P,C);const F=[];y.layers&&y.layers.forEach(O=>{C[O.source]?E.push({command:Se.removeLayer,args:[O.id]}):F.push(O)});let R=y.terrain;R&&C[R.source]&&(E.push({command:Se.setTerrain,args:[void 0]}),R=void 0),E=E.concat(P),yt(R,x.terrain)||E.push({command:Se.setTerrain,args:[x.terrain]}),function(O,j,Z){j=j||[];const H=(O=O||[]).map(It),W=j.map(It),se=O.reduce(yn,{}),G=j.reduce(yn,{}),ne=H.slice(),Q=Object.create(null);let te,re,ae,_e,xe,Ue,Le;for(te=0,re=0;te<H.length;te++)ae=H[te],G.hasOwnProperty(ae)?re++:(Z.push({command:Se.removeLayer,args:[ae]}),ne.splice(ne.indexOf(ae,re),1));for(te=0,re=0;te<W.length;te++)ae=W[W.length-1-te],ne[ne.length-1-te]!==ae&&(se.hasOwnProperty(ae)?(Z.push({command:Se.removeLayer,args:[ae]}),ne.splice(ne.lastIndexOf(ae,ne.length-re),1)):re++,Ue=ne[ne.length-te],Z.push({command:Se.addLayer,args:[G[ae],Ue]}),ne.splice(ne.length-te,0,ae),Q[ae]=!0);for(te=0;te<W.length;te++)if(ae=W[te],_e=se[ae],xe=G[ae],!Q[ae]&&!yt(_e,xe))if(yt(_e.source,xe.source)&&yt(_e["source-layer"],xe["source-layer"])&&yt(_e.type,xe.type)){for(Le in ut(_e.layout,xe.layout,Z,ae,null,Se.setLayoutProperty),ut(_e.paint,xe.paint,Z,ae,null,Se.setPaintProperty),yt(_e.filter,xe.filter)||Z.push({command:Se.setFilter,args:[ae,xe.filter]}),yt(_e.minzoom,xe.minzoom)&&yt(_e.maxzoom,xe.maxzoom)||Z.push({command:Se.setLayerZoomRange,args:[ae,xe.minzoom,xe.maxzoom]}),_e)_e.hasOwnProperty(Le)&&"layout"!==Le&&"paint"!==Le&&"filter"!==Le&&"metadata"!==Le&&"minzoom"!==Le&&"maxzoom"!==Le&&(0===Le.indexOf("paint.")?ut(_e[Le],xe[Le],Z,ae,Le.slice(6),Se.setPaintProperty):yt(_e[Le],xe[Le])||Z.push({command:Se.setLayerProperty,args:[ae,Le,xe[Le]]}));for(Le in xe)xe.hasOwnProperty(Le)&&!_e.hasOwnProperty(Le)&&"layout"!==Le&&"paint"!==Le&&"filter"!==Le&&"metadata"!==Le&&"minzoom"!==Le&&"maxzoom"!==Le&&(0===Le.indexOf("paint.")?ut(_e[Le],xe[Le],Z,ae,Le.slice(6),Se.setPaintProperty):yt(_e[Le],xe[Le])||Z.push({command:Se.setLayerProperty,args:[ae,Le,xe[Le]]}))}else Z.push({command:Se.removeLayer,args:[ae]}),Ue=ne[ne.lastIndexOf(ae)+1],Z.push({command:Se.addLayer,args:[xe,Ue]})}(F,x.layers,E)}catch(C){console.warn("Unable to compute style diff:",C),E=[{command:Se.setStyle,args:[x]}]}return E}(this.serialize(),o).filter(y=>!(y.command in ni));if(0===c.length)return!1;const m=c.filter(y=>!(y.command in ki));if(m.length>0)throw new Error(`Unimplemented: ${m.map(y=>y.command).join(", ")}.`);return c.forEach(y=>{"setTransition"!==y.command&&this[y.command].apply(this,y.args)}),this.stylesheet=o,this.updateProjection(),!0}addImage(o,c){if(this.getImage(o))return this.fire(new d.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(o,c),this._afterImageUpdated(o)}updateImage(o,c){this.imageManager.updateImage(o,c)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new d.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(o,c,m={}){if(this._checkLoaded(),void 0!==this.getSource(o))throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(d.validateStyle.source,`sources.${o}`,c,null,m))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const y=vi(o,c,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:y.serialize(),sourceId:o}));const x=E=>{const C=(E?"symbol:":"other:")+o,P=this._sourceCaches[C]=new d.SourceCache(C,y,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[o]=P,P.style=this,P.onAdd(this.map)};x(!1),"vector"!==c.type&&"geojson"!==c.type||x(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const c=this.getSource(o);if(void 0===c)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===o)return this.fire(new d.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new d.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(o);for(const y of m)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new d.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,c){this._checkLoaded(),this.getSource(o).setData(c),this._changed=!0}getSource(o){const c=this._getSourceCache(o);return c&&c.getSource()}addLayer(o,c,m={}){this._checkLoaded();const y=o.id;if(this.getLayer(y))return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let x;if("custom"===o.type){if(Ns(this,d.validateCustomStyleLayer(o)))return;x=d.createStyleLayer(o)}else{if("object"==typeof o.source&&(this.addSource(y,o.source),o=d.clone$1(o),o=d.extend(o,{source:y})),this._validate(d.validateStyle.layer,`layers.${y}`,o,{arrayIndex:-1},m))return;x=d.createStyleLayer(o),this._validateLayer(x),x.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}const E=c?this._order.indexOf(c):this._order.length;if(c&&-1===E)return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(E,0,y),this._layerOrderChanged=!0,this._layers[y]=x;const C=this._getLayerSourceCache(x);if(this._removedLayers[y]&&x.source&&C&&"custom"!==x.type){const P=this._removedLayers[y];delete this._removedLayers[y],P.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",C.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,c){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===c)return;const m=this._order.indexOf(o);this._order.splice(m,1);const y=c?this._order.indexOf(c):this._order.length;c&&-1===y?this.fire(new d.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(y,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const c=this._layers[o];if(!c)return void this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const m=this._order.indexOf(o);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=c,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const c in this._layers)if(this._layers[c].type===o)return!0;return!1}setLayerZoomRange(o,c,m){this._checkLoaded();const y=this.getLayer(o);y?y.minzoom===c&&y.maxzoom===m||(null!=c&&(y.minzoom=c),null!=m&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,c,m={}){this._checkLoaded();const y=this.getLayer(o);if(y){if(!yt(y.filter,c))return null==c?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(d.validateStyle.filter,`layers.${y.id}.filter`,c,{layerType:y.type},m)||(y.filter=d.clone$1(c),this._updateLayer(y)))}else this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){return d.clone$1(this.getLayer(o).filter)}setLayoutProperty(o,c,m,y={}){this._checkLoaded();const x=this.getLayer(o);x?yt(x.getLayoutProperty(c),m)||(x.setLayoutProperty(c,m,y),this._updateLayer(x)):this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,c){const m=this.getLayer(o);if(m)return m.getLayoutProperty(c);this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,c,m,y={}){this._checkLoaded();const x=this.getLayer(o);x?yt(x.getPaintProperty(c),m)||(x.setPaintProperty(c,m,y)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,c){return this.getLayer(o).getPaintProperty(c)}setFeatureState(o,c){this._checkLoaded();const m=o.source,y=o.sourceLayer,x=this.getSource(m);if(void 0===x)return void this.fire(new d.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const E=x.type;if("geojson"===E&&y)return void this.fire(new d.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===E&&!y)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===o.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided.")));const C=this._getSourceCaches(m);for(const P of C)P.setFeatureState(y,o.id,c)}removeFeatureState(o,c){this._checkLoaded();const m=o.source,y=this.getSource(m);if(void 0===y)return void this.fire(new d.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const x=y.type,E="vector"===x?o.sourceLayer:void 0;if("vector"===x&&!E)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof o.id&&"number"!=typeof o.id)return void this.fire(new d.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const C=this._getSourceCaches(m);for(const P of C)P.removeFeatureState(E,o.id,c)}getFeatureState(o){this._checkLoaded();const c=o.source,m=o.sourceLayer,y=this.getSource(c);if(void 0!==y){if("vector"!==y.type||m)return void 0===o.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(m,o.id);this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return d.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const c in this._sourceCaches){const m=this._sourceCaches[c].getSource();o[m.id]||(o[m.id]=m.serialize())}return d.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:o,layers:this._serializeLayers(this._order)},c=>void 0!==c)}_updateLayer(o){this._updatedLayers[o.id]=!0;const c=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&c&&"raster"!==c.getSource().type&&(this._updatedSources[o.source]="reload",c.pause()),this._changed=!0,o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const c=E=>"fill-extrusion"===this._layers[E].type,m={},y=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(c(C)){m[C]=E;for(const P of o){const F=P[C];if(F)for(const R of F)y.push(R)}}}y.sort((E,C)=>C.intersectionZ-E.intersectionZ);const x=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(c(C))for(let P=y.length-1;P>=0;P--){const F=y[P].feature;if(m[F.layer.id]<E)break;x.push(F),y.pop()}else for(const P of o){const F=P[C];if(F)for(const R of F)x.push(R.feature)}}return x}queryRenderedFeatures(o,c,m){c&&c.filter&&this._validate(d.validateStyle.filter,"queryRenderedFeatures.filter",c.filter,null,c);const y={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new d.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of c.layers){const F=this._layers[P];if(!F)return this.fire(new d.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];y[F.source]=!0}}const x=[];c.availableImages=this._availableImages;const E=c&&c.layers?c.layers.some(P=>{const F=this.getLayer(P);return F&&F.is3D()}):this.has3DLayers(),C=Ma.createFromScreenPoints(o,m);for(const P in this._sourceCaches){const F=this._sourceCaches[P].getSource().id;c.layers&&!y[F]||x.push(L(this._sourceCaches[P],this._layers,this._serializedLayers,C,c,m,E,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(P,F,R,O,j,Z,H){const W={},se=Z.queryRenderedSymbols(O),G=[];for(const ne of Object.keys(se).map(Number))G.push(H[ne]);G.sort(X);for(const ne of G){const Q=ne.featureIndex.lookupSymbolFeatures(se[ne.bucketInstanceId],F,ne.bucketIndex,ne.sourceLayerIndex,j.filter,j.layers,j.availableImages,P);for(const te in Q){const re=W[te]=W[te]||[],ae=Q[te];ae.sort((_e,xe)=>{const Ue=ne.featureSortOrder;if(Ue){const Le=Ue.indexOf(_e.featureIndex);return Ue.indexOf(xe.featureIndex)-Le}return xe.featureIndex-_e.featureIndex});for(const _e of ae)re.push(_e)}}for(const ne in W)W[ne].forEach(Q=>{const te=Q.feature,re=R(P[ne]).getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=re});return W}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),C.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(o,c){c&&c.filter&&this._validate(d.validateStyle.filter,"querySourceFeatures.filter",c.filter,null,c);const m=this._getSourceCaches(o);let y=[];for(const x of m)y=y.concat(V(x,c));return y}addSourceType(o,c,m){return ri.getSourceType(o)?m(new Error(`A source type called "${o}" already exists.`)):(ri.setSourceType(o,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:c.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(o,c={}){this._checkLoaded();const m=this.light.getLight();let y=!1;for(const E in o)if(!yt(o[E],m[E])){y=!0;break}if(!y)return;const x={now:d.exported.now(),transition:d.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,c),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,c=1){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===c){if("object"==typeof o.source){const m="terrain-dem-src";this.addSource(m,o.source),o=d.clone$1(o),o=d.extend(o,{source:m})}if(this._validate(d.validateStyle.terrain,"terrain",o))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode)this._createTerrain(o,c);else{const m=this.terrain,y=m.get();for(const x in o)if(!yt(o[x],y[x])){m.set(o),this.stylesheet.terrain=o;const E={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};m.updateTransitions(E);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const c=this.fog=new yh(o,this.map.transform);this.stylesheet.fog=o;const m={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(m)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,m=c.get();for(const y in o)if(!yt(o[y],m[y])){c.set(o),this.stylesheet.fog=o;const x={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(x);break}}else this._createFog(o);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(m=>this.isLayerDraped(this._layers[m])),c=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...c)}_createTerrain(o,c){const m=this.terrain=new ul(o,c);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const y={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};m.updateTransitions(y)}_force3DLayerUpdate(){for(const o in this._layers){const c=this._layers[o];"fill-extrusion"===c.type&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const c=this._layers[o];"symbol"===c.type&&this._updateLayer(c)}}_validate(o,c,m,y,x={}){return(!x||!1!==x.validate)&&Ns(this,o.call(d.validateStyle,d.extend({key:c,style:this.serialize(),value:m,styleSpec:d.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const c=this._getSourceCaches(o);for(const m of c)m.clearTiles()}_reloadSource(o){const c=this._getSourceCaches(o);for(const m of c)m.resume(),m.reload()}_updateSources(o){for(const c in this._sourceCaches)this._sourceCaches[c].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const c=this._sourceCaches[o];c.resume(),c.reload()}}_updatePlacement(o,c,m,y,x=!1){let E=!1,C=!1;const P={};for(const F of this._order){const R=this._layers[F];if("symbol"!==R.type)continue;if(!P[R.source]){const j=this._getLayerSourceCache(R);if(!j)continue;P[R.source]=j.getRenderableIds(!0).map(Z=>j.getTileByID(Z)).sort((Z,H)=>H.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(H.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(R,P[R.source],o.center.lng,o.projection);E=E||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),x=x||this._layerOrderChanged||0===m,this._layerOrderChanged&&this.fire(new d.Event("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.exported.now(),o.zoom))&&(this.pauseablePlacement=new gt(o,this._order,x,c,m,y,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.exported.now()),C=!0),E&&this.pauseablePlacement.placement.setStale()),C||E)for(const F of this._order){const R=this._layers[F];"symbol"===R.type&&this.placement.updateLayerOpacities(R,P[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,c,m){this.imageManager.getImages(c.icons,m),this._updateTilesForChangedImages();const y=x=>{x&&x.setDependencies(c.tileID.key,c.type,c.icons)};y(this._otherSourceCaches[c.source]),y(this._symbolSourceCaches[c.source])}getGlyphs(o,c,m){this.glyphManager.getGlyphs(c.stacks,m)}getResource(o,c,m){return d.makeRequest(c,m)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return"symbol"===o.type?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const c=[];return this._otherSourceCaches[o]&&c.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&c.push(this._symbolSourceCaches[o]),c}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ri.getSourceType=function(f){return Ia[f]},ri.setSourceType=function(f,o){Ia[f]=o},ri.registerForPluginStateChange=d.registerForPluginStateChange;var Dl="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",No="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let fs={},Vs={};fs=Et("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Vs=Et("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Ht=Et("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}\n#ifdef PROJECTION_GLOBE_VIEW\nmat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),wt=Dl;var Tl={background:Et("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Et("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Et("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Et("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Et("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Et("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Et("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Et("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Et("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Et("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Et("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Et("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Et("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Et("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Et("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Et("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Et("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Et("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Et("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Et("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Et("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Et("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Et("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Et("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Et("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Et("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",No),skyboxGradient:Et("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",No),skyboxCapture:Et("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Et("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:Et("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function Et(f,o,c){const m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,x=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),E=f.match(y),C=o.match(y),P=Dl.match(y);let F=C?C.concat(E):E;c||(fs.staticUniforms&&(F=fs.staticUniforms.concat(F)),Vs.staticUniforms&&(F=Vs.staticUniforms.concat(F))),F&&(F=F.concat(P));const R={};return{fragmentSource:f=f.replace(m,(O,j,Z,H,W)=>(R[W]=!0,"define"===j?`\n#ifndef HAS_UNIFORM_u_${W}\nvarying ${Z} ${H} ${W};\n#else\nuniform ${Z} ${H} u_${W};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${W}\n    ${Z} ${H} ${W} = u_${W};\n#endif\n`)),vertexSource:o=o.replace(m,(O,j,Z,H,W)=>{const se="float"===H?"vec2":"vec4",G=W.match(/color/)?"color":se;return R[W]?"define"===j?`\n#ifndef HAS_UNIFORM_u_${W}\nuniform lowp float u_${W}_t;\nattribute ${Z} ${se} a_${W};\nvarying ${Z} ${H} ${W};\n#else\nuniform ${Z} ${H} u_${W};\n#endif\n`:"vec4"===G?`\n#ifndef HAS_UNIFORM_u_${W}\n    ${W} = a_${W};\n#else\n    ${Z} ${H} ${W} = u_${W};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${W}\n    ${W} = unpack_mix_${G}(a_${W}, u_${W}_t);\n#else\n    ${Z} ${H} ${W} = u_${W};\n#endif\n`:"define"===j?`\n#ifndef HAS_UNIFORM_u_${W}\nuniform lowp float u_${W}_t;\nattribute ${Z} ${se} a_${W};\n#else\nuniform ${Z} ${H} u_${W};\n#endif\n`:"vec4"===G?`\n#ifndef HAS_UNIFORM_u_${W}\n    ${Z} ${H} ${W} = a_${W};\n#else\n    ${Z} ${H} ${W} = u_${W};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${W}\n    ${Z} ${H} ${W} = unpack_mix_${G}(a_${W}, u_${W}_t);\n#else\n    ${Z} ${H} ${W} = u_${W};\n#endif\n`}),staticAttributes:x,staticUniforms:F}}class lr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,c,m,y,x,E,C,P){this.context=o;let F=this.boundPaintVertexBuffers.length!==y.length;for(let R=0;!F&&R<y.length;R++)this.boundPaintVertexBuffers[R]!==y[R]&&(F=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===m&&!F&&this.boundIndexBuffer===x&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===C&&this.boundDynamicVertexBuffer2===P?(o.bindVertexArrayOES.set(this.vao),C&&C.bind(),x&&x.dynamicDraw&&x.bind(),P&&P.bind()):this.freshBind(c,m,y,x,E,C,P)}freshBind(o,c,m,y,x,E,C){let P;const F=o.numAttributes,R=this.context,O=R.gl;if(R.extVertexArrayObject)this.vao&&this.destroy(),this.vao=R.extVertexArrayObject.createVertexArrayOES(),R.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=o,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=C;else{P=R.currentNumAttributes||0;for(let j=F;j<P;j++)O.disableVertexAttribArray(j)}c.enableAttributes(O,o);for(const j of m)j.enableAttributes(O,o);E&&E.enableAttributes(O,o),C&&C.enableAttributes(O,o),c.bind(),c.setVertexAttribPointers(O,o,x);for(const j of m)j.bind(),j.setVertexAttribPointers(O,o,x);E&&(E.bind(),E.setVertexAttribPointers(O,o,x)),y&&y.bind(),C&&(C.bind(),C.setVertexAttribPointers(O,o,x)),R.currentNumAttributes=F}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function cu(f,o){const c=Math.pow(2,o.canonical.z),m=o.canonical.y;return[new d.MercatorCoordinate(0,m/c).toLngLat().lat,new d.MercatorCoordinate(0,(m+1)/c).toLngLat().lat]}function uu(f,o,c,m,y,x,E){const C=f.context,P=C.gl,F=c.fbo;if(!F)return;f.prepareDrawTile(o);const R=f.useProgram("hillshade");C.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,F.colorAttachment.get());const O=((W,se,G,ne)=>{const Q=G.paint.get("hillshade-shadow-color"),te=G.paint.get("hillshade-highlight-color"),re=G.paint.get("hillshade-accent-color");let ae=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===G.paint.get("hillshade-illumination-anchor")&&(ae-=W.transform.angle);const _e=!W.options.moving;return{u_matrix:ne||W.transform.calculateProjMatrix(se.tileID.toUnwrapped(),_e),u_image:0,u_latrange:cu(0,se.tileID),u_light:[G.paint.get("hillshade-exaggeration"),ae],u_shadow:Q,u_highlight:te,u_accent:re}})(f,c,m,f.terrain?o.projMatrix:null);f.prepareDrawProgram(C,R,o.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:Z,tileBoundsSegments:H}=f.getTileBoundsBuffers(c);R.draw(C,P.TRIANGLES,y,x,E,d.CullFaceMode.disabled,O,m.id,j,Z,H)}function vn(f,o,c){if(!o.needsDEMTextureUpload)return;const m=f.context,y=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||f.getTileTexture(c.stride);const x=c.getPixels();o.demTexture?o.demTexture.update(x,{premultiply:!1}):o.demTexture=new d.Texture(m,x,y.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function jr(f,o,c,m,y,x){const E=f.context,C=E.gl;if(!o.dem)return;const P=o.dem;if(E.activeTexture.set(C.TEXTURE1),vn(f,o,P),!o.demTexture)return;o.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);const F=P.dim;E.activeTexture.set(C.TEXTURE0);let R=o.fbo;if(!R){const H=new d.Texture(E,{width:F,height:F,data:null},C.RGBA);H.bind(C.LINEAR,C.CLAMP_TO_EDGE),R=o.fbo=E.createFramebuffer(F,F,!0),R.colorAttachment.set(H.texture)}E.bindFramebuffer.set(R.framebuffer),E.viewport.set([0,0,F,F]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:j,tileBoundsSegments:Z}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(E,C.TRIANGLES,m,y,x,d.CullFaceMode.disabled,((H,W)=>{const se=W.stride,G=d.create();return d.ortho(G,0,d.EXTENT,-d.EXTENT,0,0,1),d.translate(G,G,[0,-d.EXTENT,0]),{u_matrix:G,u_image:1,u_dimension:[se,se],u_zoom:H.overscaledZ,u_unpack:W.unpackVector}})(o.tileID,P),c.id,O,j,Z),o.needsHillshadePrepare=!1}const js=(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_image0:new d.Uniform1i(f,o.u_image0),u_skirt_height:new d.Uniform1f(f,o.u_skirt_height)}),Dr=(f,o)=>({u_matrix:f,u_image0:0,u_skirt_height:o}),xi=(f,o,c,m,y)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:o,u_merc_matrix:c,u_zoom_transition:m,u_merc_center:y,u_image0:0});function Fi(f,o){return null!=f&&null!=o&&!(!f.hasData()||!o.hasData())&&null!=f.demTexture&&null!=o.demTexture&&f.tileID.key!==o.tileID.key}const fo=new class{constructor(){this.operations={}}newMorphing(f,o,c,m,y){if(f in this.operations){const x=this.operations[f];x.to.tileID.key!==c.tileID.key&&(x.queued=c)}else this.operations[f]={startTime:m,phase:0,duration:y,from:o,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const o=this.operations[f];return{from:o.from,to:o.to,phase:o.phase}}update(f){for(const o in this.operations){const c=this.operations[o];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[o];break}}}_nextOp(f,o){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=o,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Us={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function kf(f,o){const c=1<<f.z;return!o&&(0===f.x||f.x===c-1)||0===f.y||f.y===c-1}const $t=f=>({u_matrix:f});function Wd(f,o,c,m,y){if(y>0){const x=d.exported.now(),E=(x-f.timeAdded)/y,C=o?(x-o.timeAdded)/y:-1,P=c.getSource(),F=m.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),R=!o||Math.abs(o.tileID.overscaledZ-F)>Math.abs(f.tileID.overscaledZ-F),O=R&&f.refreshedUponExpiration?1:d.clamp(R?E:1-C,0,1);return f.refreshedUponExpiration&&E>=1&&(f.refreshedUponExpiration=!1),o?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}class Xd extends d.SourceCache{constructor(o){const c={type:"raster-dem",maxzoom:o.transform.maxZoom},m=new Xi(ue(),null),y=vi("mock-dem",c,m,o.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,c){o.state="loaded",c(null)}}class mr extends d.SourceCache{constructor(o){const c=vi("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new Xi(ue(),null),o.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,c,m){if(o.freezeTileCoverage)return;this.transform=o;const y=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,E)=>{if(x[E.key]="",!this._tiles[E.key]){const C=new d.Tile(E,this._source.tileSize*E.overscaleFactor(),o.tileZoom);C.state="loaded",this._tiles[E.key]=C}return x},{});for(const x in this._tiles)x in y||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(o){const c=this.proxyCachedFBO[o];if(void 0!==c){const m=Object.values(c);this.renderCachePool.push(...m),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ln extends d.OverscaledTileID{constructor(o,c,m){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=c,this.projMatrix=m}}class Ji extends d.Elevation{constructor(o,c){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,y,x]=function(P){const F=new d.StructArrayLayout4i8,R=new d.StructArrayLayout3ui6,O=131;F.reserve(17161),R.reserve(33800);const j=d.EXTENT/128,Z=d.EXTENT+j/2,H=Z+j;for(let se=-j;se<H;se+=j)for(let G=-j;G<H;G+=j){const ne=G<0||G>Z||se<0||se>Z?24575:0,Q=d.clamp(Math.round(G),0,d.EXTENT),te=d.clamp(Math.round(se),0,d.EXTENT);F.emplaceBack(Q+ne,te,Q,te)}const W=(se,G)=>{const ne=G*O+se;R.emplaceBack(ne+1,ne,ne+O),R.emplaceBack(ne+O,ne+O+1,ne+1)};for(let se=1;se<129;se++)for(let G=1;G<129;G++)W(G,se);return[0,129].forEach(se=>{for(let G=0;G<130;G++)W(G,se),W(se,G)}),[F,R,32768]}(),E=o.context;this.gridBuffer=E.createVertexBuffer(m,d.boundsAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(y),this.gridSegments=d.SegmentVector.simpleSegment(0,0,m.length,y.length),this.gridNoSkirtSegments=d.SegmentVector.simpleSegment(0,0,m.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new mr(c.map),this.orthoMatrix=d.create(),d.ortho(this.orthoMatrix,0,d.EXTENT,0,d.EXTENT,0,1);const C=E.gl;this._overlapStencilMode=new d.StencilMode({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Xd(c.map)}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency()}update(o,c,m){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const y=o.terrain.properties;this.sourceCache=0===o.terrain.drapeRenderMode?this._mockSourceCache:o._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const x=()=>{this.sourceCache.used&&d.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.getScaledDemTileSize();this.sourceCache.update(c,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),c.updateElevation(!m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==o.efficiency&&d.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&"source"===o.dataType?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):"style"===o.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=0===m._centerAltitude&&-1===this.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(m.center),-1),this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=c.getIds().map(P=>{const F=c.getTileByID(P).tileID;return F.projMatrix=m.calculateProjMatrix(F.toUnwrapped()),F});(function(P,F){const R=F.transform.pointCoordinate(F.transform.getCameraPoint()),O=new d.pointGeometry(R.x,R.y);P.sort((j,Z)=>{if(Z.overscaledZ-j.overscaledZ)return Z.overscaledZ-j.overscaledZ;const H=new d.pointGeometry(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),W=new d.pointGeometry(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),se=O.mult(1<<j.canonical.z);return se.x-=.5,se.y-=.5,se.distSqr(H)-se.distSqr(W)})})(y,this.painter),this._previousZoom=m.zoom;const x=this.proxyToSource||{};this.proxyToSource={},y.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const P in E){const F=E[P];if(!F.used||(F!==this.sourceCache&&this.resetTileLookupCache(F.id),this._setupProxiedCoordsForOrtho(F,o[P],x),F.usedForTerrain))continue;const R=o[P];F.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[c.id]=y.map(P=>new ln(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1,this._updateTimestamp=d.exported.now();const C={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const F=this.terrainTileForTile[P.key];if(!F)continue;const R=F.tileID.key;R in C||(this._visibleDemTiles.push(F),C[R]=R)}}_assignTerrainTiles(o){this._initializing||o.forEach(c=>{if(this.terrainTileForTile[c.key])return;const m=this._findTileCoveringTileID(c,this.sourceCache);m&&(this.terrainTileForTile[c.key]=m)})}_prepareDEMTextures(){const o=this.painter.context,c=o.gl;for(const m in this.terrainTileForTile){const y=this.terrainTileForTile[m],x=y.dem;!x||y.demTexture&&!y.needsDEMTextureUpload||(o.activeTexture.set(c.TEXTURE1),vn(this.painter,y,x))}}_prepareDemTileUniforms(o,c,m,y){if(!c||null==c.demTexture)return!1;const x=o.tileID.canonical,E=Math.pow(2,c.tileID.canonical.z-x.z),C=y||"";return m[`u_dem_tl${C}`]=[x.x*E%1,x.y*E%1],m[`u_dem_scale${C}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,c=o.gl;if(!this._emptyDepthBufferTexture){const m={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new d.Texture(o,m,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const c=this._visibleDemTiles.reduce((m,y)=>{if(!y.dem)return m;const x=y.dem.tree.minimums[0];return x>0&&o++,m+x},0);return o?c/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,c=o.gl;o.activeTexture.set(c.TEXTURE2);const m=this._getLoadedAreaMinimum(),y={width:1,height:1,data:new Uint8Array(d.DEMData.pack(m,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(y,{premultiply:!1}):x=this._emptyDEMTexture=new d.Texture(o,y,c.RGBA,{premultiply:!1}),x}setupElevationDraw(o,c,m){const y=this.painter.context,x=y.gl,E=(C=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:d.DEMData.getUnpackVector(C),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var C;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();const P=this.painter.transform,F=P.projection.createTileTransform(P,P.worldSize),R=o.tileID.canonical;E.u_tile_tl_up=F.upVector(R,0,0),E.u_tile_tr_up=F.upVector(R,d.EXTENT,0),E.u_tile_br_up=F.upVector(R,d.EXTENT,d.EXTENT),E.u_tile_bl_up=F.upVector(R,0,d.EXTENT),E.u_tile_up_scale=F.upVectorScale(R);let O=null,j=null,Z=1;if(m&&m.morphing&&this._useVertexMorphing){const H=m.morphing.srcDemTile,W=m.morphing.dstDemTile;Z=m.morphing.phase,H&&W&&(this._prepareDemTileUniforms(o,H,E,"_prev")&&(j=H),this._prepareDemTileUniforms(o,W,E)&&(O=W))}if(j&&O?(y.activeTexture.set(x.TEXTURE2),O.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),y.activeTexture.set(x.TEXTURE4),j.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),E.u_dem_lerp=Z):(O=this.terrainTileForTile[o.tileID.key],y.activeTexture.set(x.TEXTURE2),(this._prepareDemTileUniforms(o,O,E)?O.demTexture:this.emptyDEMTexture).bind(x.NEAREST,x.CLAMP_TO_EDGE)),y.activeTexture.set(x.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&O){const H=(1<<O.tileID.canonical.z)*d.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=H}m&&m.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),c.setTerrainUniformValues(y,E)}renderToBackBuffer(o){const c=this.painter,m=this.painter.context;0!==o.length&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),this.renderingToTexture=!1,function(y,x,E,C,P){if("globe"===y.transform.projection.name)!function(F,R,O,j,Z){const H=F.context,W=H.gl;let se,G;const ne=F.options.showTerrainWireframe?2:0,Q=(ke,be)=>{if(G===ke)return;const ve=[];be&&ve.push(Us[ne]),ve.push(Us[ke]),ve.push("PROJECTION_GLOBE_VIEW"),se=F.useProgram("globeRaster",null,ve),G=ke},te=F.colorModeForRenderPass(),re=new d.DepthMode(W.LEQUAL,d.DepthMode.ReadWrite,F.depthRangeFor3D);fo.update(Z);const ae=F.transform,_e=d.calculateGlobeMatrix(ae,ae.worldSize),xe=d.calculateGlobeMercatorMatrix(ae),Ue=[d.mercatorXfromLng(ae.center.lng),d.mercatorYfromLat(ae.center.lat)],Le=F.globeSharedBuffers;(ne?[!1,!0]:[!1]).forEach(ke=>{G=-1;const be=ke?W.LINES:W.TRIANGLES;for(const ve of j){const Fe=O.getTile(ve),Ie=Math.pow(2,ve.canonical.z),[et,at]=d.globeBuffersForTileMesh(F,Fe,ve,Ie),Tt=d.StencilMode.disabled,je=R.prevTerrainTileForTile[ve.key],ot=R.terrainTileForTile[ve.key];Fi(je,ot)&&fo.newMorphing(ve.key,je,ot,Z,250),H.activeTexture.set(W.TEXTURE0),Fe.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const ft=fo.getMorphValuesForProxy(ve.key),rn=ft?1:0,mn={};ft&&d.extend$1(mn,{morphing:{srcDemTile:ft.from,dstDemTile:ft.to,phase:d.easeCubicInOut(ft.phase)}});const _t=d.globeMatrixForTile(ve.canonical,_e),kt=xi(ae.projMatrix,_t,xe,d.globeToMercatorTransition(ae.zoom),Ue);if(Q(rn,ke),R.setupElevationDraw(Fe,se,mn),F.prepareDrawProgram(H,se,ve.toUnwrapped()),Le){const[gn,Zn]=ke?Le.getWirefameBuffer(F.context):[Le.gridIndexBuffer,Le.gridSegments];se.draw(H,be,re,Tt,te,d.CullFaceMode.backCCW,kt,"globe_raster",et,gn,Zn)}if(!ke){const gn=[0===ve.canonical.y?d.globePoleMatrixForTile(ve.canonical,!1,ae):null,ve.canonical.y===Ie-1?d.globePoleMatrixForTile(ve.canonical,!0,ae):null];for(const Zn of gn){if(!Zn)continue;const kr=xi(ae.projMatrix,Zn,Zn,0,Ue);Le&&se.draw(H,be,re,Tt,te,d.CullFaceMode.disabled,kr,"globe_pole_raster",at,Le.poleIndexBuffer,Le.poleSegments)}}}})}(y,x,E,C,P);else{const F=y.context,R=F.gl;let O,j;const Z=y.options.showTerrainWireframe?2:0,H=(Q,te)=>{if(j===Q)return;const re=[Us[Q]];te&&re.push(Us[Z]),O=y.useProgram("terrainRaster",null,re),j=Q},W=y.colorModeForRenderPass(),se=new d.DepthMode(R.LEQUAL,d.DepthMode.ReadWrite,y.depthRangeFor3D);fo.update(P);const G=y.transform,ne=6*Math.pow(1.5,22-G.zoom)*x.exaggeration();(Z?[!1,!0]:[!1]).forEach(Q=>{j=-1;const te=Q?R.LINES:R.TRIANGLES,[re,ae]=Q?x.getWirefameBuffer():[x.gridIndexBuffer,x.gridSegments];for(const _e of C){const xe=E.getTile(_e),Ue=d.StencilMode.disabled,Le=x.prevTerrainTileForTile[_e.key],ke=x.terrainTileForTile[_e.key];Fi(Le,ke)&&fo.newMorphing(_e.key,Le,ke,P,250),F.activeTexture.set(R.TEXTURE0),xe.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST);const be=fo.getMorphValuesForProxy(_e.key),ve=be?1:0;let Fe;be&&(Fe={morphing:{srcDemTile:be.from,dstDemTile:be.to,phase:d.easeCubicInOut(be.phase)}});const Ie=Dr(_e.projMatrix,kf(_e.canonical,G.renderWorldCopies)?ne/10:ne);H(ve,Q),x.setupElevationDraw(xe,O,Fe),y.prepareDrawProgram(F,O,_e.toUnwrapped()),O.draw(F,te,se,Ue,W,d.CullFaceMode.backCCW,Ie,"terrain_raster",x.gridBuffer,re,ae)}})}}(c,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,o.splice(0,o.length))}renderBatch(o){if(0===this._drapedRenderBatches.length)return o+1;this.renderingToTexture=!0;const c=this.painter,m=this.painter.context,y=this.proxySourceCache,x=this.proxiedCoords[y.id],E=this._drapedRenderBatches.shift(),C=[],P=c.style.order;let F=0;for(const R of x){const O=y.getTileByID(R.proxyTileKey),j=y.proxyCachedFBO[R.key]?y.proxyCachedFBO[R.key][o]:void 0,Z=void 0!==j?y.renderCache[j]:this.pool[F++],H=void 0!==j;if(O.texture=Z.tex,H&&!Z.dirty){C.push(O.tileID);continue}let W;m.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(m.clear({color:d.Color.transparent,stencil:0}),Z.dirty=!1);for(let se=E.start;se<=E.end;++se){const G=c.style._layers[P[se]];if(G.isHidden(c.transform.zoom))continue;const ne=c.style._getLayerSourceCache(G),Q=ne?this.proxyToSource[R.key][ne.id]:[R];if(!Q)continue;const te=Q;m.viewport.set([0,0,Z.fb.width,Z.fb.height]),W!==(ne?ne.id:null)&&(this._setupStencil(Z,Q,G,ne),W=ne?ne.id:null),c.renderLayer(c,ne,G,te)}this.renderedToTile?(Z.dirty=!0,C.push(O.tileID)):H||--F,5===F&&(F=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),E.end+1}postRender(){}renderCacheEfficiency(o){const c=o.order.length;if(0===c)return{efficiency:100};let m,y=0,x=0,E=!1;for(let C=0;C<c;++C){const P=o._layers[o.order[C]];this._style.isLayerDraped(P)?(E&&++y,++x):E||(E=!0,m=P.id)}return 0===x?{efficiency:100}:{efficiency:100*(1-y/x),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{o=Math.min(o,c.dem.tree.minimums[0])}),0===o?o:(o-30)*this._exaggeration}raycast(o,c,m){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const E=x.tileID,C=Math.pow(2,E.overscaledZ),{x:P,y:F}=E.canonical,R=P/C,O=(P+1)/C,j=F/C,Z=(F+1)/C;return{minx:R,miny:j,maxx:O,maxy:Z,t:x.dem.tree.raycastRoot(R,j,O,Z,o,c,m),tile:x}});y.sort((x,E)=>(null!==x.t?x.t:Number.MAX_VALUE)-(null!==E.t?E.t:Number.MAX_VALUE));for(const x of y){if(null==x.t)return null;const E=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,o,c,m);if(null!=E)return E}return null}_createFBO(){const o=this.painter.context,c=o.gl,m=this.drapeBufferSize;o.activeTexture.set(c.TEXTURE0);const y=new d.Texture(o,{width:m[0],height:m[1],data:null},c.RGBA);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);const x=o.createFramebuffer(m[0],m[1],!1);return x.colorAttachment.set(y.texture),x.depthAttachment=new _l(o,x.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:x,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const c=this._style._layers[o],m=c.isHidden(this.painter.transform.zoom),y=c.getCrossfadeParameters(),x=!!y&&1!==y.t,E=c.hasTransition();return"custom"!==c.type&&!m&&(x||E)})}_clearRasterFadeFromRenderCache(){let o=!1;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c]._source instanceof co){o=!0;break}if(o)for(let c=0;c<this._style.order.length;++c){const m=this._style._layers[this._style.order[c]],y=m.isHidden(this.painter.transform.zoom),x=this._style._getLayerSourceCache(m);if("raster"!==m.type||y||!x)continue;const E=m.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const P=this.proxyToSource[C.key][x.id];if(P)for(const F of P){const R=Wd(x.getTile(F),x.findLoadedParent(F,0),x,this.painter.transform,E);(1!==R.opacity||0!==R.mix)&&this._clearRenderCacheForTile(x.id,F)}}}}_setupDrapedRenderBatches(){const o=this._style.order,c=o.length;if(0===c)return;const m=[];let y,x=0,E=this._style._layers[o[x]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++x<c;)E=this._style._layers[o[x]];for(;x<c;++x){const C=this._style._layers[o[x]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?void 0===y&&(y=x):void 0!==y&&(m.push({start:y,end:x-1}),y=void 0))}void 0!==y&&m.push({start:y,end:x-1}),this._drapedRenderBatches=m}_setupRenderCache(o){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const E=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let C=0;C<E.length;++C){const P=Object.values(E[C]);c.renderCachePool.push(...P)}}return}this._clearRasterFadeFromRenderCache();const m=this.proxyCoords,y=this._tilesDirty;for(let E=m.length-1;E>=0;E--){const C=m[E];if(c.getTileByID(C.key),void 0!==c.proxyCachedFBO[C.key]){const P=o[C.key],F=this.proxyToSource[C.key];let R=0;for(const O in F){const j=F[O],Z=P[O];if(!Z||Z.length!==j.length||j.some((H,W)=>H!==Z[W]||y[O]&&y[O].hasOwnProperty(H.key))){R=-1;break}++R}for(const O in c.proxyCachedFBO[C.key])c.renderCache[c.proxyCachedFBO[C.key][O]].dirty=R<0||R!==Object.values(P).length}}const x=[...this._drapedRenderBatches];x.sort((E,C)=>C.end-C.start-(E.end-E.start));for(const E of x)for(const C of m){if(c.proxyCachedFBO[C.key])continue;let P=c.renderCachePool.pop();void 0===P&&c.renderCache.length<50&&(P=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==P&&(c.proxyCachedFBO[C.key]={},c.proxyCachedFBO[C.key][E.start]=P,c.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(o,c,m,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,E=x.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let C;if(m.isTileClipped())C=c.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):d.StencilMode.disabled}_renderTileClippingMasks(o,c){const m=this.painter,y=this.painter.context,x=y.gl;m._tileClippingMaskIDs={},y.setColorMode(d.ColorMode.disabled),y.setDepthMode(d.DepthMode.disabled);const E=m.useProgram("clippingMask");for(const C of o){const P=m._tileClippingMaskIDs[C.key]=--c;E.draw(y,x.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:x.ALWAYS,mask:0},P,255,x.KEEP,x.KEEP,x.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,$t(C.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(o){const c=this.painter.transform;if(o.x<0||o.x>c.width||o.y<0||o.y>c.height)return null;const m=[o.x,o.y,1,1];d.transformMat4$1(m,m,c.pixelMatrixInverse),d.scale$1(m,m,1/m[3]),m[0]/=c.worldSize,m[1]/=c.worldSize;const y=c._camera.position,x=d.mercatorZfromAltitude(1,c.center.lat),E=[y[0],y[1],y[2]/x,0],C=d.subtract([],m.slice(0,3),E);d.normalize(C,C);const P=this.raycast(E,C,this._exaggeration);return null!==P&&P?(d.scaleAndAdd(E,E,C,P),E[3]=E[2],E[2]*=x,E):null}drawDepth(){const o=this.painter,c=o.context,m=this.proxySourceCache,y=Math.ceil(o.width),x=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===x||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const E=c.gl,C=c.createFramebuffer(y,x,!0);c.activeTexture.set(E.TEXTURE0);const P=new d.Texture(c,{width:y,height:x,data:null},E.RGBA);P.bind(E.NEAREST,E.CLAMP_TO_EDGE),C.colorAttachment.set(P.texture);const F=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,y,x);C.depthAttachment.set(F),this._depthFBO=C,this._depthTexture=P}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,y,x]),function(E,C,P,F){if("globe"===E.transform.projection.name)return;const R=E.context,O=R.gl;R.clear({depth:1});const j=E.useProgram("terrainDepth"),Z=new d.DepthMode(O.LESS,d.DepthMode.ReadWrite,E.depthRangeFor3D);for(const H of F){const W=P.getTile(H),se=Dr(H.projMatrix,0);C.setupElevationDraw(W,j),j.draw(R,O.TRIANGLES,Z,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.backCCW,se,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(o,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,c,m){if(o.getSource()instanceof uo)return this._setupProxiedCoordsForImageSource(o,c,m);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const y=this.proxiedCoords[o.id]=[],x=this.proxyCoords;for(let C=0;C<x.length;C++){const P=x[C],F=this._findTileCoveringTileID(P,o);if(F){const R=this._createProxiedId(P,F,m[P.key]&&m[P.key][o.id]);y.push(R),this.proxyToSource[P.key][o.id]=[R]}}let E=!1;for(let C=0;C<c.length;C++){const P=o.getTile(c[C]);if(!P||!P.hasData())continue;const F=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==P.tileID.canonical.z){const R=this.proxyToSource[F.tileID.key][o.id],O=this._createProxiedId(F.tileID,P,m[F.tileID.key]&&m[F.tileID.key][o.id]);R?R.splice(R.length-1,0,O):this.proxyToSource[F.tileID.key][o.id]=[O],y.push(O),E=!0}}this._sourceTilesOverlap[o.id]=E}_setupProxiedCoordsForImageSource(o,c,m){if(!o.getSource().loaded())return;const y=this.proxiedCoords[o.id]=[],x=this.proxyCoords,E=o.getSource(),C=new d.pointGeometry(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),P=E.coordinates.map(d.MercatorCoordinate.fromLngLat).reduce((R,O)=>(R.min.x=Math.min(R.min.x,O.x-C.x),R.min.y=Math.min(R.min.y,O.y-C.y),R.max.x=Math.max(R.max.x,O.x-C.x),R.max.y=Math.max(R.max.y,O.y-C.y),R),{min:new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new d.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(R,O)=>{const j=R.wrap+R.canonical.x/(1<<R.canonical.z),Z=R.canonical.y/(1<<R.canonical.z),H=d.EXTENT/(1<<R.canonical.z),W=O.wrap+O.canonical.x/(1<<O.canonical.z),se=O.canonical.y/(1<<O.canonical.z);return j+H<W+P.min.x||j>W+P.max.x||Z+H<se+P.min.y||Z>se+P.max.y};for(let R=0;R<x.length;R++){const O=x[R];for(let j=0;j<c.length;j++){const Z=o.getTile(c[j]);if(!Z||!Z.hasData()||F(O,Z.tileID))continue;const H=this._createProxiedId(O,Z,m[O.key]&&m[O.key][o.id]),W=this.proxyToSource[O.key][o.id];W?W.push(H):this.proxyToSource[O.key][o.id]=[H],y.push(H)}}}_createProxiedId(o,c,m){let y=this.orthoMatrix;if(m){const x=m.find(E=>E.key===c.tileID.key);if(x)return x}if(c.tileID.key!==o.key){const x=o.canonical.z-c.tileID.canonical.z;let E,C,P;y=d.create();const F=c.tileID.wrap-o.wrap<<o.overscaledZ;x>0?(E=d.EXTENT>>x,C=E*((c.tileID.canonical.x<<x)-o.canonical.x+F),P=E*((c.tileID.canonical.y<<x)-o.canonical.y)):(E=d.EXTENT<<-x,C=d.EXTENT*(c.tileID.canonical.x-(o.canonical.x+F<<-x)),P=d.EXTENT*(c.tileID.canonical.y-(o.canonical.y<<-x))),d.ortho(y,0,E,0,E,0,1),d.translate(y,y,[C,P,0])}return new ln(c.tileID,o.key,y)}_findTileCoveringTileID(o,c){let m=c.getTile(o);if(m&&m.hasData())return m;const y=this._findCoveringTileCache[c.id],x=y[o.key];if(m=x?c.getTileByID(x):null,m&&m.hasData()||null===x)return m;let E=m?m.tileID:o,C=E.overscaledZ;const P=c.getSource().minzoom,F=[];if(!x){const O=c.getSource().maxzoom;if(o.canonical.z>=O){const j=o.canonical.z-O;c.getSource().reparseOverscaled?(C=Math.max(o.canonical.z+2,c.transform.tileZoom),E=new d.OverscaledTileID(C,o.wrap,O,o.canonical.x>>j,o.canonical.y>>j)):0!==j&&(C=O,E=new d.OverscaledTileID(C,o.wrap,O,o.canonical.x>>j,o.canonical.y>>j))}E.key!==o.key&&(F.push(E.key),m=c.getTile(E))}const R=O=>{F.forEach(j=>{y[j]=O}),F.length=0};for(C-=1;C>=P&&(!m||!m.hasData());C--){m&&R(m.tileID.key);const O=E.calculateScaledKey(C);if(m=c.getTileByID(O),m&&m.hasData())break;const j=y[O];if(null===j)break;void 0===j?F.push(O):m=c.getTileByID(j)}return R(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(o){this.renderedToTile=!0}_clearRenderCacheForTile(o,c){let m=this._tilesDirty[o];m||(m=this._tilesDirty[o]={}),m[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(c){let m,y,x;const E=new d.StructArrayLayout2ui4,C=131;for(y=1;y<129;y++){for(m=1;m<129;m++)x=y*C+m,E.emplaceBack(x,x+1),E.emplaceBack(x,x+C),E.emplaceBack(x+1,x+C),128===y&&E.emplaceBack(x+C,x+C+1);E.emplaceBack(x+1,x+1+C)}return E}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=d.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Pa(f){const o=[];for(let c=0;c<f.length;c++){if(null===f[c])continue;const m=f[c].split(" ");o.push(m.pop())}return o}class $s{static cacheKey(o,c,m){let y=`${o}${m?m.cacheKey:""}`;for(const x of c)y+=`/${x}`;return y}constructor(o,c,m,y,x,E){const C=o.gl;this.program=C.createProgram();const P=Pa(m.staticAttributes),F=y?y.getBinderAttributes():[],R=P.concat(F),O=m.staticUniforms?Pa(m.staticUniforms):[],j=y?y.getBinderUniforms():[],Z=O.concat(j),H=[];for(const re of Z)H.indexOf(re)<0&&H.push(re);let W=y?y.defines():[];W=W.concat(E.map(re=>`#define ${re}`));const se=W.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",wt,Ht.fragmentSource,Vs.fragmentSource,m.fragmentSource).join("\n"),G=W.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",wt,Ht.vertexSource,Vs.vertexSource,fs.vertexSource,m.vertexSource).join("\n"),ne=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(ne,se),C.compileShader(ne),C.attachShader(this.program,ne);const Q=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(Q,G),C.compileShader(Q),C.attachShader(this.program,Q),this.attributes={};const te={};this.numAttributes=R.length;for(let re=0;re<this.numAttributes;re++)R[re]&&(C.bindAttribLocation(this.program,re,R[re]),this.attributes[R[re]]=re);C.linkProgram(this.program),C.deleteShader(Q),C.deleteShader(ne);for(let re=0;re<H.length;re++){const ae=H[re];if(ae&&!te[ae]){const _e=C.getUniformLocation(this.program,ae);_e&&(te[ae]=_e)}}var re,ae;this.fixedUniforms=x(o,te),this.binderUniforms=y?y.getUniforms(o,te):[],-1!==E.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new d.Uniform1i(re=o,(ae=te).u_dem),u_dem_prev:new d.Uniform1i(re,ae.u_dem_prev),u_dem_unpack:new d.Uniform4f(re,ae.u_dem_unpack),u_dem_tl:new d.Uniform2f(re,ae.u_dem_tl),u_dem_scale:new d.Uniform1f(re,ae.u_dem_scale),u_dem_tl_prev:new d.Uniform2f(re,ae.u_dem_tl_prev),u_dem_scale_prev:new d.Uniform1f(re,ae.u_dem_scale_prev),u_dem_size:new d.Uniform1f(re,ae.u_dem_size),u_dem_lerp:new d.Uniform1f(re,ae.u_dem_lerp),u_exaggeration:new d.Uniform1f(re,ae.u_exaggeration),u_depth:new d.Uniform1i(re,ae.u_depth),u_depth_size_inv:new d.Uniform2f(re,ae.u_depth_size_inv),u_meter_to_dem:new d.Uniform1f(re,ae.u_meter_to_dem),u_label_plane_matrix_inv:new d.UniformMatrix4f(re,ae.u_label_plane_matrix_inv),u_tile_tl_up:new d.Uniform3f(re,ae.u_tile_tl_up),u_tile_tr_up:new d.Uniform3f(re,ae.u_tile_tr_up),u_tile_br_up:new d.Uniform3f(re,ae.u_tile_br_up),u_tile_bl_up:new d.Uniform3f(re,ae.u_tile_bl_up),u_tile_up_scale:new d.Uniform1f(re,ae.u_tile_up_scale)}),-1!==E.indexOf("FOG")&&(this.fogUniforms=((re,ae)=>({u_fog_matrix:new d.UniformMatrix4f(re,ae.u_fog_matrix),u_fog_range:new d.Uniform2f(re,ae.u_fog_range),u_fog_color:new d.Uniform4f(re,ae.u_fog_color),u_fog_horizon_blend:new d.Uniform1f(re,ae.u_fog_horizon_blend),u_fog_temporal_offset:new d.Uniform1f(re,ae.u_fog_temporal_offset)}))(o,te))}setTerrainUniformValues(o,c){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const y in c)m[y].set(c[y])}}setFogUniformValues(o,c){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const y in c)m[y].location&&m[y].set(c[y])}}draw(o,c,m,y,x,E,C,P,F,R,O,j,Z,H,W,se){const G=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(m),o.setStencilMode(y),o.setColorMode(x),o.setCullFace(E);for(const Q of Object.keys(this.fixedUniforms))this.fixedUniforms[Q].set(C[Q]);H&&H.setUniforms(o,this.binderUniforms,j,{zoom:Z});const ne={[G.LINES]:2,[G.TRIANGLES]:3,[G.LINE_STRIP]:1}[c];for(const Q of O.get()){const te=Q.vaos||(Q.vaos={});(te[P]||(te[P]=new lr)).bind(o,this,F,H?H.getPaintVertexBuffers():[],R,Q.vertexOffset,W,se),G.drawElements(c,Q.primitiveLength*ne,G.UNSIGNED_SHORT,Q.primitiveOffset*ne*2)}}}function hu(f,o,c){const m=1/wn(c,1,o.transform.tileZoom),y=Math.pow(2,c.tileID.overscaledZ),x=c.tileSize*Math.pow(2,o.transform.tileZoom)/y,E=x*(c.tileID.canonical.x+c.tileID.wrap*y),C=x*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[m,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[E>>16,C>>16],u_pixel_coord_lower:[65535&E,65535&C]}}const mo=(f,o,c,m)=>{const y=o.style.light,x=y.properties.get("position"),E=[x.x,x.y,x.z],C=d.create$1();"viewport"===y.properties.get("anchor")&&(d.fromRotation(C,-o.transform.angle),d.transformMat3(E,E,C));const P=y.properties.get("color");return{u_matrix:f,u_lightpos:E,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+c,u_opacity:m}},Gs=(f,o,c,m,y,x,E)=>d.extend(mo(f,o,c,m),hu(x,o,E),{u_height_factor:-Math.pow(2,y.overscaledZ)/E.tileSize/8}),xh=f=>({u_matrix:f}),ka=(f,o,c,m)=>d.extend(xh(f),hu(c,o,m)),Kd=(f,o)=>({u_matrix:f,u_world:o}),du=(f,o,c,m,y)=>d.extend(ka(f,o,c,m),{u_world:y}),bh=(f,o,c,m)=>{const y=f.transform;let x;return x="map"===m.paint.get("circle-pitch-alignment")?y.calculatePixelsToTileUnitsMatrix(c):new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]),{u_camera_to_center_distance:y.cameraToCenterDistance,u_matrix:f.translatePosMatrix(o.projMatrix,c,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:d.exported.devicePixelRatio,u_extrude_scale:x}},_c=f=>{const o=[];return"map"===f.paint.get("circle-pitch-alignment")&&o.push("PITCH_WITH_MAP"),"map"===f.paint.get("circle-pitch-scale")&&o.push("SCALE_WITH_MAP"),o},ms=(f,o,c)=>{const m=d.EXTENT/c.tileSize;return{u_matrix:f,u_camera_to_center_distance:o.cameraToCenterDistance,u_extrude_scale:[o.pixelsToGLUnits[0]/m,o.pixelsToGLUnits[1]/m]}},pu=(f,o,c=1)=>({u_matrix:f,u_color:o,u_overlay:0,u_overlay_scale:c}),fu=(f,o,c,m)=>({u_matrix:f,u_extrude_scale:wn(o,1,c),u_intensity:m}),bi=(f,o,c,m,y,x)=>{const E=f.transform,C=E.calculatePixelsToTileUnitsMatrix(o),P={u_matrix:Ri(f,o,c,y),u_pixels_to_tile_units:C,u_device_pixel_ratio:d.exported.devicePixelRatio,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Yi(c)){const F=Hn(o,f.transform);P.u_texsize=o.lineAtlasTexture.size,P.u_scale=[F,m.fromScale,m.toScale],P.u_mix=m.t}return P},er=(f,o,c,m,y)=>{const x=f.transform,E=Hn(o,x);return{u_matrix:Ri(f,o,c,y),u_texsize:o.imageAtlasTexture.size,u_pixels_to_tile_units:x.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:d.exported.devicePixelRatio,u_image:0,u_scale:[E,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Hn(f,o){return 1/wn(f,1,o.tileZoom)}function Ri(f,o,c,m){return f.translatePosMatrix(m||o.tileID.projMatrix,o,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function Yi(f){const o=f.paint.get("line-dasharray").value;return o.value||"constant"!==o.kind}const Ur=(f,o,c,m,y,x)=>{return{u_matrix:f,u_tl_parent:o,u_scale_parent:c,u_fade_t:m.mix,u_opacity:m.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(C=y.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(E=y.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:Hs(y.paint.get("raster-hue-rotate")),u_perspective_transform:x};var E,C};function Hs(f){f*=Math.PI/180;const o=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*o-c+1)/3,(Math.sqrt(3)*o-c+1)/3]}const Fa=(f,o,c,m,y,x,E,C,P,F,R,O,j,Z)=>{const H=y.transform;return{u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:H.width/H.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:E,u_coord_matrix:C,u_is_text:+P,u_pitch_with_map:+m,u_texsize:F,u_tile_id:R,u_zoom_transition:O,u_inv_rot_matrix:j,u_merc_center:Z,u_texture:0}},Vo=(f,o,c,m,y,x,E,C,P,F,R,O,j,Z,H)=>{const{cameraToCenterDistance:W,_pitch:se}=y.transform;return d.extend(Fa(f,o,c,m,y,x,E,C,P,F,O,j,Z,H),{u_gamma_scale:m?W*Math.cos(y.terrain?0:se):1,u_device_pixel_ratio:d.exported.devicePixelRatio,u_is_halo:+R})},gs=(f,o,c,m,y,x,E,C,P,F,R,O,j,Z)=>d.extend(Vo(f,o,c,m,y,x,E,C,!0,P,!0,R,O,j,Z),{u_texsize_icon:F,u_texture_icon:1}),Rt=(f,o,c)=>({u_matrix:f,u_opacity:o,u_color:c}),cr=(f,o,c,m,y,x)=>d.extend(function(E,C,P,F){const R=P.imageManager.getPattern(E.from.toString()),O=P.imageManager.getPattern(E.to.toString()),{width:j,height:Z}=P.imageManager.getPixelSize(),H=Math.pow(2,F.tileID.overscaledZ),W=F.tileSize*Math.pow(2,P.transform.tileZoom)/H,se=W*(F.tileID.canonical.x+F.tileID.wrap*H),G=W*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[j,Z],u_mix:C.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/wn(F,1,P.transform.tileZoom),u_pixel_coord_upper:[se>>16,G>>16],u_pixel_coord_lower:[65535&se,65535&G]}}(m,x,c,y),{u_matrix:f,u_opacity:o}),wh={fillExtrusion:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_lightpos:new d.Uniform3f(f,o.u_lightpos),u_lightintensity:new d.Uniform1f(f,o.u_lightintensity),u_lightcolor:new d.Uniform3f(f,o.u_lightcolor),u_vertical_gradient:new d.Uniform1f(f,o.u_vertical_gradient),u_opacity:new d.Uniform1f(f,o.u_opacity)}),fillExtrusionPattern:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_lightpos:new d.Uniform3f(f,o.u_lightpos),u_lightintensity:new d.Uniform1f(f,o.u_lightintensity),u_lightcolor:new d.Uniform3f(f,o.u_lightcolor),u_vertical_gradient:new d.Uniform1f(f,o.u_vertical_gradient),u_height_factor:new d.Uniform1f(f,o.u_height_factor),u_image:new d.Uniform1i(f,o.u_image),u_texsize:new d.Uniform2f(f,o.u_texsize),u_pixel_coord_upper:new d.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(f,o.u_pixel_coord_lower),u_scale:new d.Uniform3f(f,o.u_scale),u_fade:new d.Uniform1f(f,o.u_fade),u_opacity:new d.Uniform1f(f,o.u_opacity)}),fill:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix)}),fillPattern:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_image:new d.Uniform1i(f,o.u_image),u_texsize:new d.Uniform2f(f,o.u_texsize),u_pixel_coord_upper:new d.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(f,o.u_pixel_coord_lower),u_scale:new d.Uniform3f(f,o.u_scale),u_fade:new d.Uniform1f(f,o.u_fade)}),fillOutline:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_world:new d.Uniform2f(f,o.u_world)}),fillOutlinePattern:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_world:new d.Uniform2f(f,o.u_world),u_image:new d.Uniform1i(f,o.u_image),u_texsize:new d.Uniform2f(f,o.u_texsize),u_pixel_coord_upper:new d.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(f,o.u_pixel_coord_lower),u_scale:new d.Uniform3f(f,o.u_scale),u_fade:new d.Uniform1f(f,o.u_fade)}),circle:(f,o)=>({u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_extrude_scale:new d.UniformMatrix2f(f,o.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(f,o.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(f,o.u_matrix)}),collisionBox:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_extrude_scale:new d.Uniform2f(f,o.u_extrude_scale)}),collisionCircle:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_inv_matrix:new d.UniformMatrix4f(f,o.u_inv_matrix),u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_viewport_size:new d.Uniform2f(f,o.u_viewport_size)}),debug:(f,o)=>({u_color:new d.UniformColor(f,o.u_color),u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_overlay:new d.Uniform1i(f,o.u_overlay),u_overlay_scale:new d.Uniform1f(f,o.u_overlay_scale)}),clippingMask:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix)}),heatmap:(f,o)=>({u_extrude_scale:new d.Uniform1f(f,o.u_extrude_scale),u_intensity:new d.Uniform1f(f,o.u_intensity),u_matrix:new d.UniformMatrix4f(f,o.u_matrix)}),heatmapTexture:(f,o)=>({u_image:new d.Uniform1i(f,o.u_image),u_color_ramp:new d.Uniform1i(f,o.u_color_ramp),u_opacity:new d.Uniform1f(f,o.u_opacity)}),hillshade:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_image:new d.Uniform1i(f,o.u_image),u_latrange:new d.Uniform2f(f,o.u_latrange),u_light:new d.Uniform2f(f,o.u_light),u_shadow:new d.UniformColor(f,o.u_shadow),u_highlight:new d.UniformColor(f,o.u_highlight),u_accent:new d.UniformColor(f,o.u_accent)}),hillshadePrepare:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_image:new d.Uniform1i(f,o.u_image),u_dimension:new d.Uniform2f(f,o.u_dimension),u_zoom:new d.Uniform1f(f,o.u_zoom),u_unpack:new d.Uniform4f(f,o.u_unpack)}),line:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_pixels_to_tile_units:new d.UniformMatrix2f(f,o.u_pixels_to_tile_units),u_device_pixel_ratio:new d.Uniform1f(f,o.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(f,o.u_units_to_pixels),u_dash_image:new d.Uniform1i(f,o.u_dash_image),u_gradient_image:new d.Uniform1i(f,o.u_gradient_image),u_image_height:new d.Uniform1f(f,o.u_image_height),u_texsize:new d.Uniform2f(f,o.u_texsize),u_scale:new d.Uniform3f(f,o.u_scale),u_mix:new d.Uniform1f(f,o.u_mix),u_alpha_discard_threshold:new d.Uniform1f(f,o.u_alpha_discard_threshold)}),linePattern:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_texsize:new d.Uniform2f(f,o.u_texsize),u_pixels_to_tile_units:new d.UniformMatrix2f(f,o.u_pixels_to_tile_units),u_device_pixel_ratio:new d.Uniform1f(f,o.u_device_pixel_ratio),u_image:new d.Uniform1i(f,o.u_image),u_units_to_pixels:new d.Uniform2f(f,o.u_units_to_pixels),u_scale:new d.Uniform3f(f,o.u_scale),u_fade:new d.Uniform1f(f,o.u_fade),u_alpha_discard_threshold:new d.Uniform1f(f,o.u_alpha_discard_threshold)}),raster:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_tl_parent:new d.Uniform2f(f,o.u_tl_parent),u_scale_parent:new d.Uniform1f(f,o.u_scale_parent),u_fade_t:new d.Uniform1f(f,o.u_fade_t),u_opacity:new d.Uniform1f(f,o.u_opacity),u_image0:new d.Uniform1i(f,o.u_image0),u_image1:new d.Uniform1i(f,o.u_image1),u_brightness_low:new d.Uniform1f(f,o.u_brightness_low),u_brightness_high:new d.Uniform1f(f,o.u_brightness_high),u_saturation_factor:new d.Uniform1f(f,o.u_saturation_factor),u_contrast_factor:new d.Uniform1f(f,o.u_contrast_factor),u_spin_weights:new d.Uniform3f(f,o.u_spin_weights),u_perspective_transform:new d.Uniform2f(f,o.u_perspective_transform)}),symbolIcon:(f,o)=>({u_is_size_zoom_constant:new d.Uniform1i(f,o.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(f,o.u_is_size_feature_constant),u_size_t:new d.Uniform1f(f,o.u_size_t),u_size:new d.Uniform1f(f,o.u_size),u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_pitch:new d.Uniform1f(f,o.u_pitch),u_rotate_symbol:new d.Uniform1i(f,o.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(f,o.u_aspect_ratio),u_fade_change:new d.Uniform1f(f,o.u_fade_change),u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(f,o.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(f,o.u_coord_matrix),u_is_text:new d.Uniform1i(f,o.u_is_text),u_pitch_with_map:new d.Uniform1i(f,o.u_pitch_with_map),u_texsize:new d.Uniform2f(f,o.u_texsize),u_tile_id:new d.Uniform3f(f,o.u_tile_id),u_zoom_transition:new d.Uniform1f(f,o.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(f,o.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(f,o.u_merc_center),u_texture:new d.Uniform1i(f,o.u_texture)}),symbolSDF:(f,o)=>({u_is_size_zoom_constant:new d.Uniform1i(f,o.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(f,o.u_is_size_feature_constant),u_size_t:new d.Uniform1f(f,o.u_size_t),u_size:new d.Uniform1f(f,o.u_size),u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_pitch:new d.Uniform1f(f,o.u_pitch),u_rotate_symbol:new d.Uniform1i(f,o.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(f,o.u_aspect_ratio),u_fade_change:new d.Uniform1f(f,o.u_fade_change),u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(f,o.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(f,o.u_coord_matrix),u_is_text:new d.Uniform1i(f,o.u_is_text),u_pitch_with_map:new d.Uniform1i(f,o.u_pitch_with_map),u_texsize:new d.Uniform2f(f,o.u_texsize),u_texture:new d.Uniform1i(f,o.u_texture),u_gamma_scale:new d.Uniform1f(f,o.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(f,o.u_device_pixel_ratio),u_tile_id:new d.Uniform3f(f,o.u_tile_id),u_zoom_transition:new d.Uniform1f(f,o.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(f,o.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(f,o.u_merc_center),u_is_halo:new d.Uniform1i(f,o.u_is_halo)}),symbolTextAndIcon:(f,o)=>({u_is_size_zoom_constant:new d.Uniform1i(f,o.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(f,o.u_is_size_feature_constant),u_size_t:new d.Uniform1f(f,o.u_size_t),u_size:new d.Uniform1f(f,o.u_size),u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_pitch:new d.Uniform1f(f,o.u_pitch),u_rotate_symbol:new d.Uniform1i(f,o.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(f,o.u_aspect_ratio),u_fade_change:new d.Uniform1f(f,o.u_fade_change),u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(f,o.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(f,o.u_coord_matrix),u_is_text:new d.Uniform1i(f,o.u_is_text),u_pitch_with_map:new d.Uniform1i(f,o.u_pitch_with_map),u_texsize:new d.Uniform2f(f,o.u_texsize),u_texsize_icon:new d.Uniform2f(f,o.u_texsize_icon),u_texture:new d.Uniform1i(f,o.u_texture),u_texture_icon:new d.Uniform1i(f,o.u_texture_icon),u_gamma_scale:new d.Uniform1f(f,o.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(f,o.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(f,o.u_is_halo)}),background:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_opacity:new d.Uniform1f(f,o.u_opacity),u_color:new d.UniformColor(f,o.u_color)}),backgroundPattern:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_opacity:new d.Uniform1f(f,o.u_opacity),u_image:new d.Uniform1i(f,o.u_image),u_pattern_tl_a:new d.Uniform2f(f,o.u_pattern_tl_a),u_pattern_br_a:new d.Uniform2f(f,o.u_pattern_br_a),u_pattern_tl_b:new d.Uniform2f(f,o.u_pattern_tl_b),u_pattern_br_b:new d.Uniform2f(f,o.u_pattern_br_b),u_texsize:new d.Uniform2f(f,o.u_texsize),u_mix:new d.Uniform1f(f,o.u_mix),u_pattern_size_a:new d.Uniform2f(f,o.u_pattern_size_a),u_pattern_size_b:new d.Uniform2f(f,o.u_pattern_size_b),u_scale_a:new d.Uniform1f(f,o.u_scale_a),u_scale_b:new d.Uniform1f(f,o.u_scale_b),u_pixel_coord_upper:new d.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(f,o.u_pixel_coord_lower),u_tile_units_to_pixels:new d.Uniform1f(f,o.u_tile_units_to_pixels)}),terrainRaster:js,terrainDepth:js,skybox:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_sun_direction:new d.Uniform3f(f,o.u_sun_direction),u_cubemap:new d.Uniform1i(f,o.u_cubemap),u_opacity:new d.Uniform1f(f,o.u_opacity),u_temporal_offset:new d.Uniform1f(f,o.u_temporal_offset)}),skyboxGradient:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_color_ramp:new d.Uniform1i(f,o.u_color_ramp),u_center_direction:new d.Uniform3f(f,o.u_center_direction),u_radius:new d.Uniform1f(f,o.u_radius),u_opacity:new d.Uniform1f(f,o.u_opacity),u_temporal_offset:new d.Uniform1f(f,o.u_temporal_offset)}),skyboxCapture:(f,o)=>({u_matrix_3f:new d.UniformMatrix3f(f,o.u_matrix_3f),u_sun_direction:new d.Uniform3f(f,o.u_sun_direction),u_sun_intensity:new d.Uniform1f(f,o.u_sun_intensity),u_color_tint_r:new d.Uniform4f(f,o.u_color_tint_r),u_color_tint_m:new d.Uniform4f(f,o.u_color_tint_m),u_luminance:new d.Uniform1f(f,o.u_luminance)}),globeRaster:(f,o)=>({u_proj_matrix:new d.UniformMatrix4f(f,o.u_proj_matrix),u_globe_matrix:new d.UniformMatrix4f(f,o.u_globe_matrix),u_merc_matrix:new d.UniformMatrix4f(f,o.u_merc_matrix),u_zoom_transition:new d.Uniform1f(f,o.u_zoom_transition),u_merc_center:new d.Uniform2f(f,o.u_merc_center),u_image0:new d.Uniform1i(f,o.u_image0)}),globeAtmosphere:(f,o)=>({u_center:new d.Uniform2f(f,o.u_center),u_radius:new d.Uniform1f(f,o.u_radius),u_screen_size:new d.Uniform2f(f,o.u_screen_size),u_pixel_ratio:new d.Uniform1f(f,o.u_pixel_ratio),u_opacity:new d.Uniform1f(f,o.u_opacity),u_fadeout_range:new d.Uniform1f(f,o.u_fadeout_range),u_start_color:new d.Uniform3f(f,o.u_start_color),u_end_color:new d.Uniform3f(f,o.u_end_color)})};let Ar;function Qe(f,o,c,m,y,x,E){const C=f.context,P=C.gl,F=f.useProgram("collisionBox"),R=[];let O=0,j=0;for(let Q=0;Q<m.length;Q++){const te=m[Q],re=o.getTile(te),ae=re.getBucket(c);if(!ae)continue;let _e=te.projMatrix;0===y[0]&&0===y[1]||(_e=f.translatePosMatrix(te.projMatrix,re,y,x));const xe=E?ae.textCollisionBox:ae.iconCollisionBox,Ue=ae.collisionCircleArray;if(Ue.length>0){const Le=d.create(),ke=_e;d.mul(Le,ae.placementInvProjMatrix,f.transform.glCoordMatrix),d.mul(Le,Le,ae.placementViewportMatrix),R.push({circleArray:Ue,circleOffset:j,transform:ke,invTransform:Le}),O+=Ue.length/4,j=O}xe&&(f.terrain&&f.terrain.setupElevationDraw(re,F),F.draw(C,P.LINES,d.DepthMode.disabled,d.StencilMode.disabled,f.colorModeForRenderPass(),d.CullFaceMode.disabled,ms(_e,f.transform,re),c.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,null,f.transform.zoom,null,xe.collisionVertexBuffer,xe.collisionVertexBufferExt))}if(!E||!R.length)return;const Z=f.useProgram("collisionCircle"),H=new d.StructArrayLayout2f1f2i16;H.resize(4*O),H._trim();let W=0;for(const Q of R)for(let te=0;te<Q.circleArray.length/4;te++){const re=4*te,ae=Q.circleArray[re+0],_e=Q.circleArray[re+1],xe=Q.circleArray[re+2],Ue=Q.circleArray[re+3];H.emplace(W++,ae,_e,xe,Ue,0),H.emplace(W++,ae,_e,xe,Ue,1),H.emplace(W++,ae,_e,xe,Ue,2),H.emplace(W++,ae,_e,xe,Ue,3)}(!Ar||Ar.length<2*O)&&(Ar=function(Q){const te=2*Q,re=new d.StructArrayLayout3ui6;re.resize(te),re._trim();for(let ae=0;ae<te;ae++){const _e=6*ae;re.uint16[_e+0]=4*ae+0,re.uint16[_e+1]=4*ae+1,re.uint16[_e+2]=4*ae+2,re.uint16[_e+3]=4*ae+2,re.uint16[_e+4]=4*ae+3,re.uint16[_e+5]=4*ae+0}return re}(O));const se=C.createIndexBuffer(Ar,!0),G=C.createVertexBuffer(H,d.collisionCircleLayout.members,!0);for(const Q of R){const te={u_matrix:Q.transform,u_inv_matrix:Q.invTransform,u_camera_to_center_distance:(ne=f.transform).cameraToCenterDistance,u_viewport_size:[ne.width,ne.height]};Z.draw(C,P.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,f.colorModeForRenderPass(),d.CullFaceMode.disabled,te,c.id,G,se,d.SegmentVector.simpleSegment(0,2*Q.circleOffset,Q.circleArray.length,Q.circleArray.length/2),null,f.transform.zoom,null,null,null)}var ne;G.destroy(),se.destroy()}const At=d.identity(new Float32Array(16));function Sn(f,o,c,m,y,x){const{horizontalAlign:E,verticalAlign:C}=d.getAnchorAlignment(f),P=-(E-.5)*o,F=-(C-.5)*c,R=d.evaluateVariableOffset(f,m);return new d.pointGeometry((P/y+R[0])*x,(F/y+R[1])*x)}function wi(f,o,c,m,y,x,E,C,P,F,R,O){const j=f.text.placedSymbolArray,Z=f.text.dynamicLayoutVertexArray,H=f.icon.dynamicLayoutVertexArray,W={},se=C.projMatrix,G=x.elevation,ne=G?G.getAtTileOffsetFunc(C,O):Q=>[0,0,0];Z.clear();for(let Q=0;Q<j.length;Q++){const te=j.get(Q),re=f.allowVerticalPlacement&&!te.placedOrientation,ae=te.hidden||!te.crossTileID||re?null:m[te.crossTileID];if(ae){const _e=new d.pointGeometry(te.tileAnchorX,te.tileAnchorY),xe=ne(_e),Ue=$n(_e,c?se:E,xe[2]),Le=ho(x.cameraToCenterDistance,Ue.signedDistanceFromCamera);let ke=y.evaluateSizeForFeature(f.textSizeData,F,te)*Le/d.ONE_EM;c&&(ke*=f.tilePixelRatio/P);const{width:be,height:ve,anchor:Fe,textOffset:Ie,textScale:et}=ae,at=Sn(Fe,be,ve,Ie,et,ke),Tt=c?$n(_e.add(at),E,xe[2]).point:Ue.point.add(o?at.rotate(-x.angle):at),je=f.allowVerticalPlacement&&te.placedOrientation===d.WritingMode.vertical?Math.PI/2:0;for(let ot=0;ot<te.numGlyphs;ot++)d.addDynamicAttributes(Z,Tt,je);R&&te.associatedIconIndex>=0&&(W[te.associatedIconIndex]={shiftedAnchor:Tt,angle:je})}else mt(te.numGlyphs,Z)}if(R){H.clear();const Q=f.icon.placedSymbolArray;for(let te=0;te<Q.length;te++){const re=Q.get(te);if(re.hidden)mt(re.numGlyphs,H);else{const ae=W[te];if(ae)for(let _e=0;_e<re.numGlyphs;_e++)d.addDynamicAttributes(H,ae.shiftedAnchor,ae.angle);else mt(re.numGlyphs,H)}}f.icon.dynamicLayoutVertexBuffer.updateData(H)}f.text.dynamicLayoutVertexBuffer.updateData(Z)}function qs(f,o,c){return c.iconsInText&&o?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function qn(f,o,c,m,y,x,E,C,P,F,R,O){const j=f.context,Z=j.gl,H=f.transform,W=H.projection.createTileTransform(H,H.worldSize),se="map"===C,G="map"===P,ne=se&&"point"!==c.layout.get("symbol-placement"),Q=se&&!G&&!ne,te=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let re=!1;const ae=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),_e=[d.mercatorXfromLng(H.center.lng),d.mercatorYfromLat(H.center.lat)],xe=c.layout.get("text-variable-anchor"),Ue="globe"===H.projection.name,Le=Ue?d.globeToMercatorTransition(H.zoom):0,ke=[],be=[];f.terrain&&G&&be.push("PITCH_WITH_MAP_TERRAIN"),Ue&&be.push("PROJECTION_GLOBE_VIEW"),ne&&be.push("PROJECTED_POS_ON_VIEWPORT");for(const ve of m){const Fe=o.getTile(ve),Ie=Fe.getBucket(c);if(!Ie||Ie.projection!==H.projection.name)continue;const et=y?Ie.text:Ie.icon;if(!et||Ie.fullyClipped||!et.segments.get().length)continue;const at=et.programConfigurations.get(c.id),Tt=y||Ie.sdfIcons,je=y?Ie.textSizeData:Ie.iconSizeData,ot=G||0!==H.pitch,ft=f.useProgram(qs(Tt,y,Ie),at,be),rn=d.evaluateSizeForZoom(je,H.zoom),mn=[ve.canonical.x,ve.canonical.y,1<<ve.canonical.z];let _t,kt,gn,Zn,kr=[0,0],qr=null;if(y){if(kt=Fe.glyphAtlasTexture,gn=Z.LINEAR,_t=Fe.glyphAtlasTexture.size,Ie.iconsInText){kr=Fe.imageAtlasTexture.size,qr=Fe.imageAtlasTexture;const nr="composite"===je.kind||"camera"===je.kind;Zn=ot||f.options.rotating||f.options.zooming||nr?Z.LINEAR:Z.NEAREST}}else{const nr=1!==c.layout.get("icon-size").constantOr(0)||Ie.iconsNeedLinear;kt=Fe.imageAtlasTexture,gn=Tt||f.options.rotating||f.options.zooming||nr||ot?Z.LINEAR:Z.NEAREST,_t=Fe.imageAtlasTexture.size}const Bi=f.transform.calculatePixelsToTileUnitsMatrix(Fe),Nt=us(ve.projMatrix,Fe.tileID.canonical,G,se,f.transform,Bi),pt=f.terrain&&G&&ne?d.invert(new Float32Array(16),Nt):At,Lt=zo(ve.projMatrix,Fe.tileID.canonical,G,se,f.transform,Bi),bn=xe&&Ie.hasTextData(),Zr="none"!==c.layout.get("icon-text-fit")&&bn&&Ie.hasIconData();if(ne){const nr=H.elevation,qo=nr?nr.getAtTileOffsetFunc(ve,W):eo=>[0,0,0];vh(Ie,ve.projMatrix,f,y,Nt,Lt,G,F,qo,ve)}const hn=f.translatePosMatrix(ve.projMatrix,Fe,x,E),Ni=ne||y&&xe||Zr?At:Nt,Ua=f.translatePosMatrix(Lt,Fe,x,E,!0),Wr=Tt&&0!==c.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1);let ia;const tt=W.createInversionMatrix(ve.toUnwrapped());ia=Tt?Ie.iconsInText?gs(je.kind,rn,Q,G,f,hn,Ni,Ua,_t,kr,mn,Le,tt,_e):Vo(je.kind,rn,Q,G,f,hn,Ni,Ua,y,_t,!0,mn,Le,tt,_e):Fa(je.kind,rn,Q,G,f,hn,Ni,Ua,y,_t,mn,Le,tt,_e);const st={program:ft,buffers:et,uniformValues:ia,atlasTexture:kt,atlasTextureIcon:qr,atlasInterpolation:gn,atlasInterpolationIcon:Zn,isSDF:Tt,hasHalo:Wr,tile:Fe,labelPlaneMatrixInv:pt};if(te&&Ie.canOverlap){re=!0;const nr=et.segments.get();for(const qo of nr)ke.push({segments:new d.SegmentVector([qo]),sortKey:qo.sortKey,state:st})}else ke.push({segments:et.segments,sortKey:0,state:st})}re&&ke.sort((ve,Fe)=>ve.sortKey-Fe.sortKey);for(const ve of ke){const Fe=ve.state;if(f.terrain&&f.terrain.setupElevationDraw(Fe.tile,Fe.program,{useDepthForOcclusion:!Ue,labelPlaneMatrixInv:Fe.labelPlaneMatrixInv}),j.activeTexture.set(Z.TEXTURE0),Fe.atlasTexture.bind(Fe.atlasInterpolation,Z.CLAMP_TO_EDGE),Fe.atlasTextureIcon&&(j.activeTexture.set(Z.TEXTURE1),Fe.atlasTextureIcon&&Fe.atlasTextureIcon.bind(Fe.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Fe.isSDF){const Ie=Fe.uniformValues;Fe.hasHalo&&(Ie.u_is_halo=1,go(Fe.buffers,ve.segments,c,f,Fe.program,ae,R,O,Ie)),Ie.u_is_halo=0}go(Fe.buffers,ve.segments,c,f,Fe.program,ae,R,O,Fe.uniformValues)}}function go(f,o,c,m,y,x,E,C,P){const F=m.context;y.draw(F,F.gl.TRIANGLES,x,E,C,d.CullFaceMode.disabled,P,c.id,f.layoutVertexBuffer,f.indexBuffer,o,c.paint,m.transform.zoom,f.programConfigurations.get(c.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Fn(f,o,c,m,y,x,E){const C=f.context.gl,P=c.paint.get("fill-pattern"),F=P&&P.constantOr(1),R=c.getCrossfadeParameters();let O,j,Z,H,W;E?(j=F&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=C.LINES):(j=F?"fillPattern":"fill",O=C.TRIANGLES);for(const se of m){const G=o.getTile(se);if(F&&!G.patternsLoaded())continue;const ne=G.getBucket(c);if(!ne)continue;f.prepareDrawTile(se);const Q=ne.programConfigurations.get(c.id),te=f.useProgram(j,Q);F&&(f.context.activeTexture.set(C.TEXTURE0),G.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),Q.updatePaintBuffers(R));const re=P.constantOr(null);if(re&&G.imageAtlas){const _e=G.imageAtlas,xe=_e.patternPositions[re.to.toString()],Ue=_e.patternPositions[re.from.toString()];xe&&Ue&&Q.setConstantPatternPositions(xe,Ue)}const ae=f.translatePosMatrix(se.projMatrix,G,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(E){H=ne.indexBuffer2,W=ne.segments2;const _e=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];Z="fillOutlinePattern"===j&&F?du(ae,f,R,G,_e):Kd(ae,_e)}else H=ne.indexBuffer,W=ne.segments,Z=F?ka(ae,f,R,G):xh(ae);f.prepareDrawProgram(f.context,te,se.toUnwrapped()),te.draw(f.context,O,y,f.stencilModeForClipping(se),x,d.CullFaceMode.disabled,Z,c.id,ne.layoutVertexBuffer,H,W,c.paint,f.transform.zoom,Q)}}function jo(f,o,c,m,y,x,E){const C=f.context,P=C.gl,F=c.paint.get("fill-extrusion-pattern"),R=F.constantOr(1),O=c.getCrossfadeParameters(),j=c.paint.get("fill-extrusion-opacity");for(const Z of m){const H=o.getTile(Z),W=H.getBucket(c);if(!W)continue;const se=W.programConfigurations.get(c.id),G=f.useProgram(R?"fillExtrusionPattern":"fillExtrusion",se);if(f.terrain){const ae=f.terrain;if(!W.enableTerrain)continue;if(ae.setupElevationDraw(H,G,{useMeterToDem:!0}),Zs(C,o,Z,W,c,ae),!W.centroidVertexBuffer){const _e=G.attributes.a_centroid_pos;void 0!==_e&&P.vertexAttrib2f(_e,0,0)}}R&&(f.context.activeTexture.set(P.TEXTURE0),H.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),se.updatePaintBuffers(O));const ne=F.constantOr(null);if(ne&&H.imageAtlas){const ae=H.imageAtlas,_e=ae.patternPositions[ne.to.toString()],xe=ae.patternPositions[ne.from.toString()];_e&&xe&&se.setConstantPatternPositions(_e,xe)}const Q=f.translatePosMatrix(Z.projMatrix,H,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),te=c.paint.get("fill-extrusion-vertical-gradient"),re=R?Gs(Q,f,te,j,Z,O,H):mo(Q,f,te,j);f.prepareDrawProgram(C,G,Z.toUnwrapped()),G.draw(C,C.gl.TRIANGLES,y,x,E,d.CullFaceMode.backCCW,re,c.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,c.paint,f.transform.zoom,se,f.terrain?W.centroidVertexBuffer:null)}}function Zs(f,o,c,m,y,x){const E=[G=>{let ne=G.canonical.x-1,Q=G.wrap;return ne<0&&(ne=(1<<G.canonical.z)-1,Q--),new d.OverscaledTileID(G.overscaledZ,Q,G.canonical.z,ne,G.canonical.y)},G=>{let ne=G.canonical.x+1,Q=G.wrap;return ne===1<<G.canonical.z&&(ne=0,Q++),new d.OverscaledTileID(G.overscaledZ,Q,G.canonical.z,ne,G.canonical.y)},G=>new d.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,(0===G.canonical.y?1<<G.canonical.z:G.canonical.y)-1),G=>new d.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y===(1<<G.canonical.z)-1?0:G.canonical.y+1)],C=G=>{const ne=o.getSource().maxzoom,Q=_e=>{const xe=o.getTileByID(_e);if(xe&&xe.hasData())return xe.getBucket(y)};let te,re,ae;return(G.overscaledZ===G.canonical.z||G.overscaledZ>=ne)&&(te=Q(G.key)),G.overscaledZ>=ne&&(re=Q(G.calculateScaledKey(G.overscaledZ+1))),G.overscaledZ>ne&&(ae=Q(G.calculateScaledKey(G.overscaledZ-1))),te||re||ae},P=[0,0,0],F=(G,ne)=>(P[0]=Math.min(G.min.y,ne.min.y),P[1]=Math.max(G.max.y,ne.max.y),P[2]=d.EXTENT-ne.min.x>G.max.x?ne.min.x-d.EXTENT:G.max.x,P),R=(G,ne)=>(P[0]=Math.min(G.min.x,ne.min.x),P[1]=Math.max(G.max.x,ne.max.x),P[2]=d.EXTENT-ne.min.y>G.max.y?ne.min.y-d.EXTENT:G.max.y,P),O=[(G,ne)=>F(G,ne),(G,ne)=>F(ne,G),(G,ne)=>R(G,ne),(G,ne)=>R(ne,G)],j=new d.pointGeometry(0,0);let Z,H,W;const se=(G,ne,Q,te,re)=>{const ae=[[te?Q:G,te?G:Q,0],[te?Q:ne,te?ne:Q,0]],_e=re<0?d.EXTENT+re:re,xe=[te?_e:(G+ne)/2,te?(G+ne)/2:_e,0];return 0===Q&&re<0||0!==Q&&re>0?x.getForTilePoints(W,[xe],!0,H):ae.push(xe),x.getForTilePoints(c,ae,!0,Z),Math.max(ae[0][2],ae[1][2],xe[2])/x.exaggeration()};for(let G=0;G<4;G++){const ne=m.borders[G];if(0===ne.length&&(m.borderDone[G]=!0),m.borderDone[G])continue;const Q=W=E[G](c),te=C(Q);if(!(te&&te.enableTerrain&&(H=x.findDEMTileFor(Q),H&&H.dem)))continue;if(!Z){const xe=x.findDEMTileFor(c);if(!xe||!xe.dem)return;Z=xe}const re=(G<2?1:5)-G,ae=te.borders[re];let _e=0;for(let xe=0;xe<ne.length;xe++){const Ue=m.featuresOnBorder[ne[xe]],Le=Ue.borders[G];let ke;for(;_e<ae.length&&(ke=te.featuresOnBorder[ae[_e]],!(ke.borders[re][1]>Le[0]+3));)te.borderDone[re]||te.encodeCentroid(void 0,ke,!1),_e++;if(ke&&_e<ae.length){const be=_e;let ve=0;for(;!(ke.borders[re][0]>Le[1]-3)&&(ve++,++_e!==ae.length);)ke=te.featuresOnBorder[ae[_e]];if(ke=te.featuresOnBorder[ae[be]],Ue.intersectsCount()>1||ke.intersectsCount()>1||1!==ve){1!==ve&&(_e=be),m.encodeCentroid(void 0,Ue,!1),te.borderDone[re]||te.encodeCentroid(void 0,ke,!1);continue}const Fe=O[G](Ue,ke),Ie=G%2?d.EXTENT-1:0;j.x=se(Fe[0],Math.min(d.EXTENT-1,Fe[1]),Ie,G<2,Fe[2]),j.y=0,m.encodeCentroid(j,Ue,!1),te.borderDone[re]||te.encodeCentroid(j,ke,!1)}else m.encodeCentroid(void 0,Ue,!1)}m.borderDone[G]=m.needsCentroidUpdate=!0,te.borderDone[re]||(te.borderDone[re]=te.needsCentroidUpdate=!0)}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&0!==m.centroidVertexArray.length)&&m.uploadCentroid(f)}const Ct=new d.Color(1,0,0,1),yc=new d.Color(0,1,0,1),_o=new d.Color(0,0,1,1),Ws=new d.Color(1,0,1,1),Xs=new d.Color(0,1,1,1);function Dn(f,o,c,m){Li(f,0,o+c/2,f.transform.width,c,m)}function _s(f,o,c,m){Li(f,o-c/2,0,c,f.transform.height,m)}function Li(f,o,c,m,y,x){const E=f.context,C=E.gl;C.enable(C.SCISSOR_TEST),C.scissor(o*d.exported.devicePixelRatio,c*d.exported.devicePixelRatio,m*d.exported.devicePixelRatio,y*d.exported.devicePixelRatio),E.clear({color:x}),C.disable(C.SCISSOR_TEST)}function ii(f,o,c){const m=f.context,y=m.gl,x=c.projMatrix,E=f.useProgram("debug"),C=o.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(C,E);const P=d.DepthMode.disabled,F=d.StencilMode.disabled,R=f.colorModeForRenderPass(),O="$debug";m.activeTexture.set(y.TEXTURE0),f.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),C._makeDebugTileBoundsBuffers(f.context,f.transform.projection);const j=C._tileDebugBuffer||f.debugBuffer,Z=C._tileDebugIndexBuffer||f.debugIndexBuffer,H=C._tileDebugSegments||f.debugSegments;E.draw(m,y.LINE_STRIP,P,F,R,d.CullFaceMode.disabled,pu(x,d.Color.red),O,j,Z,H);const W=C.latestRawTileData,se=Math.floor((W&&W.byteLength||0)/1024),G=o.getTile(c).tileSize,ne=512/Math.min(G,512)*(c.overscaledZ/f.transform.zoom)*.5;let Q=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Q+=` => ${c.overscaledZ}`),function(te,re){te.initDebugOverlayCanvas();const ae=te.debugOverlayCanvas,_e=te.context.gl,xe=te.debugOverlayCanvas.getContext("2d");xe.clearRect(0,0,ae.width,ae.height),xe.shadowColor="white",xe.shadowBlur=2,xe.lineWidth=1.5,xe.strokeStyle="white",xe.textBaseline="top",xe.font="bold 36px Open Sans, sans-serif",xe.fillText(re,5,5),xe.strokeText(re,5,5),te.debugOverlayTexture.update(ae),te.debugOverlayTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}(f,`${Q} ${se}kb`),E.draw(m,y.TRIANGLES,P,F,d.ColorMode.alphaBlended,d.CullFaceMode.disabled,pu(x,d.Color.transparent,ne),O,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}const xn=d.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:mu}=xn;function Qi(f,o,c,m){f.emplaceBack(o,c,m)}class Ei{constructor(o){this.vertexArray=new d.StructArrayLayout3f12,this.indices=new d.StructArrayLayout3ui6,Qi(this.vertexArray,-1,-1,1),Qi(this.vertexArray,1,-1,1),Qi(this.vertexArray,-1,1,1),Qi(this.vertexArray,1,1,1),Qi(this.vertexArray,-1,-1,-1),Qi(this.vertexArray,1,-1,-1),Qi(this.vertexArray,-1,1,-1),Qi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,mu),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=d.SegmentVector.simpleSegment(0,0,36,12)}}function gr(f,o,c,m,y,x){const E=f.gl,C=o.paint.get("sky-atmosphere-color"),P=o.paint.get("sky-atmosphere-halo-color"),F=o.paint.get("sky-atmosphere-sun-intensity"),R={u_matrix_3f:d.fromMat4([],m),u_sun_direction:y,u_sun_intensity:F,u_color_tint_r:[(H=C).r,H.g,H.b,H.a],u_color_tint_m:[(W=P).r,W.g,W.b,W.a],u_luminance:5e-5};var H,W;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+x,o.skyboxTexture,0),c.draw(f,E.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.frontCW,R,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const Ks={symbol:function(f,o,c,m,y){if("translucent"!==f.renderPass)return;const x=d.StencilMode.disabled,E=f.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(C,P,F,R,O,j,Z){const H=P.transform,W="map"===O,se="map"===j,G=H.projection.createTileTransform(H,H.worldSize);for(const ne of C){const Q=R.getTile(ne),te=Q.getBucket(F);if(!te||te.projection!==H.projection.name||!te.text||!te.text.segments.get().length)continue;const re=d.evaluateSizeForZoom(te.textSizeData,H.zoom),ae=P.transform.calculatePixelsToTileUnitsMatrix(Q),_e=us(ne.projMatrix,Q.tileID.canonical,se,W,P.transform,ae),xe="none"!==F.layout.get("icon-text-fit")&&te.hasIconData();if(re){const Ue=Math.pow(2,H.zoom-Q.tileID.overscaledZ);wi(te,W,se,Z,d.symbolSize,H,_e,ne,Ue,re,xe,G)}}}(m,f,c,o,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y),0!==c.paint.get("icon-opacity").constantOr(1)&&qn(f,o,c,m,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),x,E),0!==c.paint.get("text-opacity").constantOr(1)&&qn(f,o,c,m,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),x,E),o.map.showCollisionBoxes&&(Qe(f,o,c,m,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Qe(f,o,c,m,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,o,c,m){if("translucent"!==f.renderPass)return;const y=c.paint.get("circle-opacity"),x=c.paint.get("circle-stroke-width"),E=c.paint.get("circle-stroke-opacity"),C=void 0!==c.layout.get("circle-sort-key").constantOr(1);if(0===y.constantOr(1)&&(0===x.constantOr(1)||0===E.constantOr(1)))return;const P=f.context,F=P.gl,R=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),O=d.StencilMode.disabled,j=f.colorModeForRenderPass(),Z=[];for(let W=0;W<m.length;W++){const se=m[W],G=o.getTile(se),ne=G.getBucket(c);if(!ne)continue;const Q=ne.programConfigurations.get(c.id),te=_c(c),re={programConfiguration:Q,program:f.useProgram("circle",Q,te),layoutVertexBuffer:ne.layoutVertexBuffer,indexBuffer:ne.indexBuffer,uniformValues:bh(f,se,G,c),tile:G};if(C){const ae=ne.segments.get();for(const _e of ae)Z.push({segments:new d.SegmentVector([_e]),sortKey:_e.sortKey,state:re})}else Z.push({segments:ne.segments,sortKey:0,state:re})}C&&Z.sort((W,se)=>W.sortKey-se.sortKey);const H={useDepthForOcclusion:"globe"!==f.transform.projection.name};for(const W of Z){const{programConfiguration:se,program:G,layoutVertexBuffer:ne,indexBuffer:Q,uniformValues:te,tile:re}=W.state,ae=W.segments;f.terrain&&f.terrain.setupElevationDraw(re,G,H),f.prepareDrawProgram(P,G,re.tileID.toUnwrapped()),G.draw(P,F.TRIANGLES,R,O,j,d.CullFaceMode.disabled,te,c.id,ne,Q,ae,c.paint,f.transform.zoom,se)}},heatmap:function(f,o,c,m){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const y=f.context,x=y.gl,E=d.StencilMode.disabled,C=new d.ColorMode([x.ONE,x.ONE],d.Color.transparent,[!0,!0,!0,!0]);(function(P,F,R){const O=P.gl;P.activeTexture.set(O.TEXTURE1),P.viewport.set([0,0,F.width/4,F.height/4]);let j=R.heatmapFbo;if(j)O.bindTexture(O.TEXTURE_2D,j.colorAttachment.get()),P.bindFramebuffer.set(j.framebuffer);else{const Z=O.createTexture();O.bindTexture(O.TEXTURE_2D,Z),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.LINEAR),j=R.heatmapFbo=P.createFramebuffer(F.width/4,F.height/4,!1),function(H,W,se,G){const ne=H.gl;ne.texImage2D(ne.TEXTURE_2D,0,ne.RGBA,W.width/4,W.height/4,0,ne.RGBA,H.extRenderToTextureHalfFloat?H.extTextureHalfFloat.HALF_FLOAT_OES:ne.UNSIGNED_BYTE,null),G.colorAttachment.set(se)}(P,F,Z,j)}})(y,f,c),y.clear({color:d.Color.transparent});for(let P=0;P<m.length;P++){const F=m[P];if(o.hasRenderableParent(F))continue;const R=o.getTile(F),O=R.getBucket(c);if(!O)continue;const j=O.programConfigurations.get(c.id),Z=f.useProgram("heatmap",j),{zoom:H}=f.transform;f.terrain&&f.terrain.setupElevationDraw(R,Z),f.prepareDrawProgram(y,Z,F.toUnwrapped()),Z.draw(y,x.TRIANGLES,d.DepthMode.disabled,E,C,d.CullFaceMode.disabled,fu(F.projMatrix,R,H,c.paint.get("heatmap-intensity")),c.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,c.paint,f.transform.zoom,j)}y.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(y,x){const E=y.context,C=E.gl,P=x.heatmapFbo;if(!P)return;E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,P.colorAttachment.get()),E.activeTexture.set(C.TEXTURE1);let F=x.colorRampTexture;F||(F=x.colorRampTexture=new d.Texture(E,x.colorRamp,C.RGBA)),F.bind(C.LINEAR,C.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(E,C.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,y.colorModeForRenderPass(),d.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:x.paint.get("heatmap-opacity")},x.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,x.paint,y.transform.zoom)}(f,c))},line:function(f,o,c,m){if("translucent"!==f.renderPass)return;const y=c.paint.get("line-opacity"),x=c.paint.get("line-width");if(0===y.constantOr(1)||0===x.constantOr(1))return;const E=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),C=f.colorModeForRenderPass(),P=c.paint.get("line-dasharray"),F=P.constantOr(1),R=c.layout.get("line-cap"),O=c.paint.get("line-pattern"),j=O.constantOr(1),Z=c.paint.get("line-gradient"),H=c.getCrossfadeParameters(),W=j?"linePattern":"line",se=f.context,G=se.gl,ne=(te=>{const re=[];Yi(te)&&re.push("RENDER_LINE_DASH"),te.paint.get("line-gradient")&&re.push("RENDER_LINE_GRADIENT");const ae=te.paint.get("line-pattern").constantOr(1),_e=1!==te.paint.get("line-opacity").constantOr(1);return!ae&&_e&&re.push("RENDER_LINE_ALPHA_DISCARD"),re})(c);let Q=ne.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(Q=!1);for(const te of m){const re=o.getTile(te);if(j&&!re.patternsLoaded())continue;const ae=re.getBucket(c);if(!ae)continue;f.prepareDrawTile(te);const _e=ae.programConfigurations.get(c.id),xe=f.useProgram(W,_e,ne),Ue=O.constantOr(null);if(Ue&&re.imageAtlas){const Ie=re.imageAtlas,et=Ie.patternPositions[Ue.to.toString()],at=Ie.patternPositions[Ue.from.toString()];et&&at&&_e.setConstantPatternPositions(et,at)}const Le=P.constantOr(null),ke=R.constantOr(null);if(!j&&Le&&ke&&re.lineAtlas){const Ie=re.lineAtlas,et=Ie.getDash(Le.to,ke),at=Ie.getDash(Le.from,ke);et&&at&&_e.setConstantPatternPositions(et,at)}const be=f.terrain?te.projMatrix:null,ve=j?er(f,re,c,H,be):bi(f,re,c,H,be,ae.lineClipsArray.length);if(Z){const Ie=ae.gradients[c.id];let et=Ie.texture;if(c.gradientVersion!==Ie.version){let at=256;if(c.stepInterpolant){const Tt=o.getSource().maxzoom,je=te.canonical.z===Tt?Math.ceil(1<<f.transform.maxZoom-te.canonical.z):1;at=d.clamp(d.nextPowerOfTwo(ae.maxLineLength/d.EXTENT*1024*je),256,se.maxTextureSize)}Ie.gradient=d.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:at,image:Ie.gradient||void 0,clips:ae.lineClipsArray}),Ie.texture?Ie.texture.update(Ie.gradient):Ie.texture=new d.Texture(se,Ie.gradient,G.RGBA),Ie.version=c.gradientVersion,et=Ie.texture}se.activeTexture.set(G.TEXTURE1),et.bind(c.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}F&&(se.activeTexture.set(G.TEXTURE0),re.lineAtlasTexture.bind(G.LINEAR,G.REPEAT),_e.updatePaintBuffers(H)),j&&(se.activeTexture.set(G.TEXTURE0),re.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),_e.updatePaintBuffers(H)),f.prepareDrawProgram(se,xe,te.toUnwrapped());const Fe=Ie=>{xe.draw(se,G.TRIANGLES,E,Ie,C,d.CullFaceMode.disabled,ve,c.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,c.paint,f.transform.zoom,_e,ae.layoutVertexBuffer2)};if(Q){const Ie=f.stencilModeForClipping(te).ref;0===Ie&&f.terrain&&se.clear({stencil:0});const et={func:G.EQUAL,mask:255};ve.u_alpha_discard_threshold=.8,Fe(new d.StencilMode(et,Ie,255,G.KEEP,G.KEEP,G.INVERT)),ve.u_alpha_discard_threshold=0,Fe(new d.StencilMode(et,Ie,255,G.KEEP,G.KEEP,G.KEEP))}else Fe(f.stencilModeForClipping(te))}Q&&(f.resetStencilClippingMasks(),f.terrain&&se.clear({stencil:0}))},fill:function(f,o,c,m){const y=c.paint.get("fill-color"),x=c.paint.get("fill-opacity");if(0===x.constantOr(1))return;const E=f.colorModeForRenderPass(),C=c.paint.get("fill-pattern"),P=f.opaquePassEnabledForLayer()&&!C.constantOr(1)&&1===y.constantOr(d.Color.transparent).a&&1===x.constantOr(0)?"opaque":"translucent";if(f.renderPass===P){const F=f.depthModeForSublayer(1,"opaque"===f.renderPass?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly);Fn(f,o,c,m,F,E,!1)}if("translucent"===f.renderPass&&c.paint.get("fill-antialias")){const F=f.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,d.DepthMode.ReadOnly);Fn(f,o,c,m,F,E,!0)}},"fill-extrusion":function(f,o,c,m){const y=c.paint.get("fill-extrusion-opacity");if(0!==y&&"translucent"===f.renderPass){const x=new d.DepthMode(f.context.gl.LEQUAL,d.DepthMode.ReadWrite,f.depthRangeFor3D);if(1!==y||c.paint.get("fill-extrusion-pattern").constantOr(1))jo(f,o,c,m,x,d.StencilMode.disabled,d.ColorMode.disabled),jo(f,o,c,m,x,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const E=f.colorModeForRenderPass();jo(f,o,c,m,x,d.StencilMode.disabled,E)}}},hillshade:function(f,o,c,m){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass)return;const y=f.context,x=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),E=f.colorModeForRenderPass(),C=f.terrain&&f.terrain.renderingToTexture,[P,F]="translucent"!==f.renderPass||C?[{},m]:f.stencilConfigForOverlap(m);for(const R of F){const O=o.getTile(R);if(O.needsHillshadePrepare&&"offscreen"===f.renderPass)jr(f,O,c,x,d.StencilMode.disabled,E);else if("translucent"===f.renderPass){const j=C&&f.terrain?f.terrain.stencilModeForRTTOverlap(R):P[R.overscaledZ];uu(f,R,O,c,x,j,E)}}y.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,o,c,m,y,x){if("translucent"!==f.renderPass||0===c.paint.get("raster-opacity")||!m.length)return;const E=f.context,C=E.gl,P=o.getSource(),F=f.useProgram("raster"),R=f.colorModeForRenderPass(),O=f.terrain&&f.terrain.renderingToTexture,[j,Z]=P instanceof uo||O?[{},m]:f.stencilConfigForOverlap(m),H=Z[Z.length-1].overscaledZ,W=!f.options.moving;for(const se of Z){const G=O?d.DepthMode.disabled:f.depthModeForSublayer(se.overscaledZ-H,1===c.paint.get("raster-opacity")?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly,C.LESS),ne=se.toUnwrapped(),Q=o.getTile(se);if(O&&(!Q||!Q.hasData()))continue;const te=O?se.projMatrix:f.transform.calculateProjMatrix(ne,W),re=f.terrain&&O?f.terrain.stencilModeForRTTOverlap(se):j[se.overscaledZ],ae=x?0:c.paint.get("raster-fade-duration");Q.registerFadeDuration(ae);const _e=o.findLoadedParent(se,0),xe=Wd(Q,_e,o,f.transform,ae);let Ue,Le;f.terrain&&f.terrain.prepareDrawTile(se);const ke="nearest"===c.paint.get("raster-resampling")?C.NEAREST:C.LINEAR;E.activeTexture.set(C.TEXTURE0),Q.texture.bind(ke,C.CLAMP_TO_EDGE),E.activeTexture.set(C.TEXTURE1),_e?(_e.texture.bind(ke,C.CLAMP_TO_EDGE),Ue=Math.pow(2,_e.tileID.overscaledZ-Q.tileID.overscaledZ),Le=[Q.tileID.canonical.x*Ue%1,Q.tileID.canonical.y*Ue%1]):Q.texture.bind(ke,C.CLAMP_TO_EDGE);const be=Ur(te,Le||[0,0],Ue||1,xe,c,P instanceof uo?P.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(E,F,ne),P instanceof uo)F.draw(E,C.TRIANGLES,G,d.StencilMode.disabled,R,d.CullFaceMode.disabled,be,c.id,P.boundsBuffer,f.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:ve,tileBoundsIndexBuffer:Fe,tileBoundsSegments:Ie}=f.getTileBoundsBuffers(Q);F.draw(E,C.TRIANGLES,G,re,R,d.CullFaceMode.disabled,be,c.id,ve,Fe,Ie)}}f.resetStencilClippingMasks()},background:function(f,o,c,m){const y=c.paint.get("background-color"),x=c.paint.get("background-opacity");if(0===x)return;const E=f.context,C=E.gl,P=f.transform,F=P.tileSize,R=c.paint.get("background-pattern");if(f.isPatternMissing(R))return;const O=!R&&1===y.a&&1===x&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==O)return;const j=d.StencilMode.disabled,Z=f.depthModeForSublayer(0,"opaque"===O?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly),H=f.colorModeForRenderPass(),W=f.useProgram(R?"backgroundPattern":"background");let se,G=m;G||(se=f.getBackgroundTiles(),G=Object.values(se).map(Q=>Q.tileID)),R&&(E.activeTexture.set(C.TEXTURE0),f.imageManager.bind(f.context));const ne=c.getCrossfadeParameters();for(const Q of G){const te=Q.toUnwrapped(),re=m?Q.projMatrix:f.transform.calculateProjMatrix(te);f.prepareDrawTile(Q);const ae=o?o.getTile(Q):se?se[Q.key]:new d.Tile(Q,F,P.zoom,f),_e=R?cr(re,x,f,R,{tileID:Q,tileSize:F},ne):Rt(re,x,y);f.prepareDrawProgram(E,W,te);const{tileBoundsBuffer:xe,tileBoundsIndexBuffer:Ue,tileBoundsSegments:Le}=f.getTileBoundsBuffers(ae);W.draw(E,C.TRIANGLES,Z,j,H,d.CullFaceMode.disabled,_e,c.id,xe,Ue,Le)}},sky:function(f,o,c){const m=f.transform,y="mercator"===m.projection.name||"globe"===m.projection.name?1:d.smoothstep(7,8,m.zoom),x=c.paint.get("sky-opacity")*y;if(0===x)return;const E=f.context,C=c.paint.get("sky-type"),P=new d.DepthMode(E.gl.LEQUAL,d.DepthMode.ReadOnly,[0,1]),F=f.frameCounter/1e3%1;"atmosphere"===C?"offscreen"===f.renderPass?c.needsSkyboxCapture(f)&&(function(R,O,j,Z){const H=R.context,W=H.gl;let se=O.skyboxFbo;if(!se){se=O.skyboxFbo=H.createFramebuffer(32,32,!1),O.skyboxGeometry=new Ei(H),O.skyboxTexture=H.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,O.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let te=0;te<6;++te)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(se.framebuffer),H.viewport.set([0,0,32,32]);const G=O.getCenter(R,!0),ne=R.useProgram("skyboxCapture"),Q=new Float64Array(16);d.identity(Q),d.rotateY(Q,Q,.5*-Math.PI),gr(H,O,ne,Q,G,0),d.identity(Q),d.rotateY(Q,Q,.5*Math.PI),gr(H,O,ne,Q,G,1),d.identity(Q),d.rotateX(Q,Q,.5*-Math.PI),gr(H,O,ne,Q,G,2),d.identity(Q),d.rotateX(Q,Q,.5*Math.PI),gr(H,O,ne,Q,G,3),d.identity(Q),gr(H,O,ne,Q,G,4),d.identity(Q),d.rotateY(Q,Q,Math.PI),gr(H,O,ne,Q,G,5),H.viewport.set([0,0,R.width,R.height])}(f,c),c.markSkyboxValid(f)):"sky"===f.renderPass&&function(R,O,j,Z,H){const W=R.context,se=W.gl,G=R.transform,ne=R.useProgram("skybox");W.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_CUBE_MAP,O.skyboxTexture);const Q={u_matrix:G.skyboxMatrix,u_sun_direction:O.getCenter(R,!1),u_cubemap:0,u_opacity:Z,u_temporal_offset:H};R.prepareDrawProgram(W,ne),ne.draw(W,se.TRIANGLES,j,d.StencilMode.disabled,R.colorModeForRenderPass(),d.CullFaceMode.backCW,Q,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(f,c,P,x,F):"gradient"===C&&"sky"===f.renderPass&&function(R,O,j,Z,H){const W=R.context,se=W.gl,G=R.transform,ne=R.useProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new Ei(W)),W.activeTexture.set(se.TEXTURE0);let Q=O.colorRampTexture;Q||(Q=O.colorRampTexture=new d.Texture(W,O.colorRamp,se.RGBA)),Q.bind(se.LINEAR,se.CLAMP_TO_EDGE);const te=(re=G.skyboxMatrix,ae=O.getCenter(R,!1),_e=O.paint.get("sky-gradient-radius"),xe=Z,Ue=H,{u_matrix:re,u_color_ramp:0,u_center_direction:ae,u_radius:d.degToRad(_e),u_opacity:xe,u_temporal_offset:Ue});var re,ae,_e,xe,Ue;R.prepareDrawProgram(W,ne),ne.draw(W,se.TRIANGLES,j,d.StencilMode.disabled,R.colorModeForRenderPass(),d.CullFaceMode.backCW,te,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(f,c,P,x,F)},debug:function(f,o,c){for(let m=0;m<c.length;m++)ii(f,o,c[m])},custom:function(f,o,c){const m=f.context,y=c.implementation;if(f.transform.projection.unsupportedLayers&&f.transform.projection.unsupportedLayers.includes("custom"))d.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===f.renderPass){const x=y.prerender;x&&(f.setCustomLayerDefaults(),m.setColorMode(f.colorModeForRenderPass()),x.call(y,m.gl,f.transform.customLayerMatrix()),m.setDirty(),f.setBaseState())}else if("translucent"===f.renderPass){f.setCustomLayerDefaults(),m.setColorMode(f.colorModeForRenderPass()),m.setStencilMode(d.StencilMode.disabled);const x="3d"===y.renderingMode?new d.DepthMode(f.context.gl.LEQUAL,d.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,d.DepthMode.ReadOnly);m.setDepthMode(x),y.render(m.gl,f.transform.customLayerMatrix()),m.setDirty(),f.setBaseState(),m.bindFramebuffer.set(null)}}};class Cl{constructor(o,c){this.context=new yi(o),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=d.SourceCache.maxUnderzooming+d.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new en,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(o,c){const m=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ji(this,o));const y=this._terrain;this.transform.elevation=m?y:null,y.update(o,this.transform,c)}_updateFog(o){const c=o.fog;if(!c||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,y]=c.getFovAdjustedRange(this.transform._fov);if(m>y)return void(this.transform.fogCullDistSq=null);const x=m+.78*(y-m);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,c){if(this.width=o*d.exported.devicePixelRatio,this.height=c*d.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const o=this.context,c=new d.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(d.EXTENT,0),c.emplaceBack(0,d.EXTENT),c.emplaceBack(d.EXTENT,d.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(c,d.posAttributes.members),this.tileExtentSegments=d.SegmentVector.simpleSegment(0,0,4,2);const m=new d.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(d.EXTENT,0),m.emplaceBack(0,d.EXTENT),m.emplaceBack(d.EXTENT,d.EXTENT),this.debugBuffer=o.createVertexBuffer(m,d.posAttributes.members),this.debugSegments=d.SegmentVector.simpleSegment(0,0,4,5);const y=new d.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(y,d.posAttributes.members),this.viewportSegments=d.SegmentVector.simpleSegment(0,0,4,2);const x=new d.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(d.EXTENT,0,d.EXTENT,0),x.emplaceBack(0,d.EXTENT,0,d.EXTENT),x.emplaceBack(d.EXTENT,d.EXTENT,d.EXTENT,d.EXTENT),this.mercatorBoundsBuffer=o.createVertexBuffer(x,d.boundsAttributes.members),this.mercatorBoundsSegments=d.SegmentVector.simpleSegment(0,0,4,2);const E=new d.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(E);const C=new d.StructArrayLayout1ui2;for(const F of[0,1,3,2,0])C.emplaceBack(F);this.debugIndexBuffer=o.createIndexBuffer(C),this.emptyTexture=new d.Texture(o,{width:1,height:1,data:new Uint8Array([0,0,0,0])},o.gl.RGBA),this.identityMat=d.create();const P=this.context.gl;this.stencilClearMode=new d.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(d.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context,c=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(o,c.TRIANGLES,d.DepthMode.disabled,this.stencilClearMode,d.ColorMode.disabled,d.CullFaceMode.disabled,$t(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,c,m){if(!c||this.currentStencilSource===c.id||!o.isTileClipped()||!m||0===m.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const P of m)if(void 0===this._tileClippingMaskIDs[P.key]){C=!0;break}if(!C)return}this.currentStencilSource=c.id;const y=this.context,x=y.gl;this.nextStencilID+m.length>256&&this.clearStencil(),y.setColorMode(d.ColorMode.disabled),y.setDepthMode(d.DepthMode.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of m){const P=c.getTile(C),F=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:O,tileBoundsSegments:j}=this.getTileBoundsBuffers(P);E.draw(y,x.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:x.ALWAYS,mask:0},F,255,x.KEEP,x.KEEP,x.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,$t(C.projMatrix),"$clipping",R,O,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,c=this.context.gl;return new d.StencilMode({func:c.NOTEQUAL,mask:255},o,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const c=this.context.gl;return new d.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(o){const c=this.context.gl,m=o.sort((E,C)=>C.overscaledZ-E.overscaledZ),y=m[m.length-1].overscaledZ,x=m[0].overscaledZ-y+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const E={};for(let C=0;C<x;C++)E[C+y]=new d.StencilMode({func:c.GEQUAL,mask:255},C+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=x,[E,m]}return[{[y]:d.StencilMode.disabled},m]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new d.ColorMode([o.CONSTANT_COLOR,o.ONE],new d.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?d.ColorMode.unblended:d.ColorMode.alphaBlended}depthModeForSublayer(o,c,m){if(!this.opaquePassEnabledForLayer())return d.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new d.DepthMode(m||this.context.gl.LEQUAL,c,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,c){this.style=o,this.options=c,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(d.exported.now()),this.imageManager.beginFrame();const m=this.style.order,y=this.style._sourceCaches;for(const F in y){const R=y[F];R.used&&R.prepare(this.context)}const x={},E={},C={};for(const F in y){const R=y[F];x[F]=R.getVisibleCoordinates(),E[F]=x[F].slice().reverse(),C[F]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<m.length;F++)if(this.style._layers[m[F]].is3D()){this.opaquePassCutoff=F;break}if(this.terrain&&(this.terrain.updateTileBinding(C),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new d.GlobeSharedBuffers(this.context)),!d.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const F of m){const R=this.style._layers[F],O=o._getLayerSourceCache(R);if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const j=O?E[O.id]:void 0;("custom"===R.type||R.isSky()||j&&j.length)&&this.renderLayer(this,O,R,j)}this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let P=d.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(P=this.style.fog.properties.get("color")),this.context.clear({color:c.showOverdrawInspector?d.Color.black:P,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[m[this.currentLayer]],R=o._getLayerSourceCache(F);if(F.isSky())continue;const O=R?E[R.id]:void 0;this._renderTileClippingMasks(F,R,O),this.renderLayer(this,R,F,O)}if(this.renderPass="sky",(d.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const F=this.style._layers[m[this.currentLayer]],R=o._getLayerSourceCache(F);F.isSky()&&this.renderLayer(this,R,F,R?E[R.id]:void 0)}for("globe"===this.transform.projection.name&&function(F){const R=F.context,O=R.gl,j=F.transform,Z=new d.DepthMode(O.LEQUAL,d.DepthMode.ReadOnly,[0,1]),H=F.useProgram("globeAtmosphere"),W=j._camera.getWorldToCamera(j.worldSize,1),se=j._camera.getCameraToClipPerspective(j._fov,j.width/j.height,j._nearZ,j._farZ),G=d.mul([],W,d.calculateGlobeMatrix(j,j.worldSize)),ne=d.mul([],j.labelPlaneMatrix,se),Q=d.transformMat4([],[0,0,0],G),te=d.add([],Q,[j.worldSize/Math.PI/2,0,0]),re=d.transformMat4([],Q,ne),ae=d.transformMat4([],te,ne),_e=d.length(d.sub([],ae,re)),xe=1-d.globeToMercatorTransition(j.zoom),Ue={u_center:re,u_radius:_e,u_screen_size:[j.width,j.height],u_pixel_ratio:d.exported.devicePixelRatio,u_opacity:xe,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};F.prepareDrawProgram(R,H);const Le=F.globeSharedBuffers;Le&&H.draw(R,O.TRIANGLES,Z,d.StencilMode.disabled,d.ColorMode.alphaBlended,d.CullFaceMode.backCW,Ue,"skybox",Le.atmosphereVertexBuffer,Le.atmosphereIndexBuffer,Le.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const F=this.style._layers[m[this.currentLayer]],R=o._getLayerSourceCache(F);if(F.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(F)){if(F.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const O=R?("symbol"===F.type?C:E)[R.id]:void 0;this._renderTileClippingMasks(F,R,R?x[R.id]:void 0),this.renderLayer(this,R,F,O),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let F=null;d.values(this.style._layers).forEach(R=>{const O=o._getLayerSourceCache(R);O&&!R.isHidden(this.transform.zoom)&&(!F||F.getSource().maxzoom<O.getSource().maxzoom)&&(F=O)}),F&&this.options.showTileBoundaries&&Ks.debug(this,F,F.getVisibleCoordinates())}this.options.showPadding&&function(F){const R=F.transform.padding;Dn(F,F.transform.height-(R.top||0),3,Ct),Dn(F,R.bottom||0,3,yc),_s(F,R.left||0,3,_o),_s(F,F.transform.width-(R.right||0),3,Ws);const O=F.transform.centerPoint;var j,Z,H,W;Li(j=F,(Z=O.x)-1,(H=F.transform.height-O.y)-10,2,20,W=Xs),Li(j,Z-10,H-1,20,2,W)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(d.window.performance.now()),this.saveCanvasCopy())}renderLayer(o,c,m,y){m.isHidden(this.transform.zoom)||("background"===m.type||"sky"===m.type||"custom"===m.type||y&&y.length)&&(this.id=m.id,this.gpuTimingStart(m),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(m.type)||Ks[m.type](o,c,m,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let m=this.gpuTimers[o.id];m||(m=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),m.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,m.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const c={};for(const m in o){const y=o[m],x=this.context.extTimerQuery,E=x.getQueryObjectEXT(y.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(y.query),c[m]=E}return c}translatePosMatrix(o,c,m,y,x){if(!m[0]&&!m[1])return o;const E=x?"map"===y?this.transform.angle:0:"viewport"===y?-this.transform.angle:0;if(E){const F=Math.sin(E),R=Math.cos(E);m=[m[0]*R-m[1]*F,m[0]*F+m[1]*R]}const C=[x?m[0]:wn(c,m[0],this.transform.zoom),x?m[1]:wn(c,m[1],this.transform.zoom),0],P=new Float32Array(16);return d.translate(P,o,C),P}saveTileTexture(o){const c=this._tileTextures[o.size[0]];c?c.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const c=this._tileTextures[o];return c&&c.length>0?c.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const c=this.imageManager.getPattern(o.from.toString()),m=this.imageManager.getPattern(o.to.toString());return!c||!m}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,c=this.style&&this.style.fog,m=[];return this.terrain&&!this.terrain.renderingToTexture&&m.push("TERRAIN"),c&&!o&&0!==c.getOpacity(this.transform.pitch)&&m.push("FOG"),o&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}useProgram(o,c,m){this.cache=this.cache||{};const y=m||[],x=this.currentGlobalDefines().concat(y),E=$s.cacheKey(o,x,c);return this.cache[E]||(this.cache[E]=new $s(this.context,o,Tl[o],c,wh[o],x)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=d.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(o){this.terrain&&this.terrain.prepareDrawTile(o)}prepareDrawProgram(o,c,m){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const x=y.getOpacity(this.transform.pitch);0!==x&&c.setFogUniformValues(o,((E,C,P,F)=>{const R=C.properties.get("color"),O=E.frameCounter/1e3%1,j=[R.r/R.a,R.g/R.a,R.b/R.a,F];return{u_fog_matrix:P?E.transform.calculateFogTileMatrix(P):E.identityMat,u_fog_range:C.getFovAdjustedRange(E.transform._fov),u_fog_color:j,u_fog_horizon_blend:C.properties.get("horizon-blend"),u_fog_temporal_offset:O}})(this,y,m,x))}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const o=this.context.gl,c=o.createTexture();return o.bindTexture(o.TEXTURE_2D,c),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&0!==o.getOpacity(this.transform.pitch)}getBackgroundTiles(){const o=this._backgroundTiles,c=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const y of m)c[y.key]=o[y.key]||new d.Tile(y,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class Js{constructor(o=0,c=0,m=0,y=0){if(isNaN(o)||o<0||isNaN(c)||c<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=c,this.left=m,this.right=y}interpolate(o,c,m){return null!=c.top&&null!=o.top&&(this.top=d.number(o.top,c.top,m)),null!=c.bottom&&null!=o.bottom&&(this.bottom=d.number(o.bottom,c.bottom,m)),null!=c.left&&null!=o.left&&(this.left=d.number(o.left,c.left,m)),null!=c.right&&null!=o.right&&(this.right=d.number(o.right,c.right,m)),this}getCenter(o,c){const m=d.clamp((this.left+o-this.right)/2,0,o),y=d.clamp((this.top+c-this.bottom)/2,0,c);return new d.pointGeometry(m,y)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Js(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function _r(f,o){const c=d.getColumn(f,3);d.fromQuat(f,o),d.setColumn(f,3,c)}function Eh(f,o){d.setColumn(f,3,[o[0],o[1],o[2],1])}function Dh(f,o){const c=d.identity$1([]);return d.rotateZ$1(c,c,-o),d.rotateX$1(c,c,-f),c}function gu(f,o){const c=[f[0],f[1],0],m=[o[0],o[1],0];if(d.length(c)>=1e-15){const E=d.normalize([],c);d.scale$2(m,E,d.dot(m,E)),o[0]=m[0],o[1]=m[1]}const y=d.cross([],o,f);if(d.len(y)<1e-15)return null;const x=Math.atan2(-y[1],y[0]);return Dh(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),x)}class Th{constructor(o,c){this.position=o,this.orientation=c}get position(){return this._position}set position(o){this._position=this._renderWorldCopies?function(c){if(!c)return;const m=Array.isArray(c)?new d.MercatorCoordinate(c[0],c[1],c[2]):c;return m.x=d.wrap(m.x,0,1),m}(o):o}lookAtPoint(o,c){if(this.orientation=null,!this.position)return;const m=this._elevation?this._elevation.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(o)):0,y=this.position,x=d.MercatorCoordinate.fromLngLat(o,m),E=[x.x-y.x,x.y-y.y,x.z-y.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=gu(E,c)}setPitchBearing(o,c){this.orientation=Dh(d.degToRad(o),d.degToRad(-c))}}class Ch{constructor(o,c){this._transform=d.identity([]),this._orientation=d.identity$1([]),c&&(this._orientation=c,_r(this._transform,this._orientation)),o&&Eh(this._transform,o)}get mercatorPosition(){const o=this.position;return new d.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=d.getColumn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){Eh(this._transform,o)}get orientation(){return this._orientation}set orientation(o){this._orientation=o,_r(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,c){this._orientation=Dh(o,c),_r(this._transform,this._orientation)}forward(){const o=d.getColumn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=d.getColumn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=d.getColumn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,c){const m=new Float64Array(16);return d.invert(m,this.getWorldToCamera(o,c)),m}getWorldToCameraPosition(o,c,m){const y=this.position;d.scale$2(y,y,-o);const x=new Float64Array(16);return d.fromScaling(x,[m,m,m]),d.translate(x,x,y),x[10]*=c,x}getWorldToCamera(o,c){const m=new Float64Array(16),y=new Float64Array(4),x=this.position;return d.conjugate(y,this._orientation),d.scale$2(x,x,-o),d.fromQuat(m,y),d.translate(m,m,x),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=c,m[9]*=c,m[10]*=c,m[11]*=c,m}getCameraToClipPerspective(o,c,m,y){const x=new Float64Array(16);return d.perspective(x,o,c,m,y),x}getDistanceToElevation(o){const c=0===o?0:d.mercatorZfromAltitude(o,this.position[1]),m=this.forward();return(c-this.position[2])/m[2]}clone(){return new Ch([...this.position],[...this.orientation])}}function Jd(f,o){const c=yu(f),m=function(x,E,C,P,F){const R=new d.LngLat(C.lng-180*yo,C.lat),O=new d.LngLat(C.lng+180*yo,C.lat),j=x.project(R.lng,R.lat),Z=x.project(O.lng,O.lat),H=-Math.atan2(Z.y-j.y,Z.x-j.x),W=d.MercatorCoordinate.fromLngLat(C);W.y=d.clamp(W.y,-.999975,.999975);const se=W.toLngLat(),G=x.project(se.lng,se.lat),ne=d.MercatorCoordinate.fromLngLat(se);ne.x+=yo;const Q=ne.toLngLat(),te=x.project(Q.lng,Q.lat),re=Ih(te.x-G.x,te.y-G.y,H),ae=d.MercatorCoordinate.fromLngLat(se);ae.y+=yo;const _e=ae.toLngLat(),xe=x.project(_e.lng,_e.lat),Ue=Ih(xe.x-G.x,xe.y-G.y,H),Le=Math.abs(re.x)/Math.abs(Ue.y),ke=d.identity([]);d.rotateZ(ke,ke,-H*(1-(F?0:P)));const be=d.identity([]);return d.scale(be,be,[1,1-(1-Le)*P,1]),be[4]=-Ue.x/Ue.y*P,d.rotateZ(be,be,H),d.multiply$1(be,ke,be),be}(f.projection,0,f.center,c,o),y=_u(f);return d.scale(m,m,[y,y,1]),m}function _u(f){const o=f.projection,c=yu(f),m=Mh(o,f.center),y=Mh(o,d.LngLat.convert(o.center));return Math.pow(2,m*c+(1-c)*y)}function yu(f){const o=f.projection.range;if(!o)return 0;const c=Math.max(f.width,f.height),m=Math.log(c/1024)/Math.LN2;return d.smoothstep(o[0]+m,o[1]+m,f.zoom)}const yo=1/4e4;function Mh(f,o){const c=d.clamp(o.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),m=new d.LngLat(o.lng-180*yo,c),y=new d.LngLat(o.lng+180*yo,c),x=f.project(m.lng,c),E=f.project(y.lng,c),C=d.MercatorCoordinate.fromLngLat(m),P=d.MercatorCoordinate.fromLngLat(y),F=E.x-x.x,R=E.y-x.y,O=P.x-C.x,j=P.y-C.y,Z=Math.sqrt((O*O+j*j)/(F*F+R*R));return Math.log(Z)/Math.LN2}function Ih(f,o,c){const m=Math.cos(c),y=Math.sin(c);return{x:f*m-o*y,y:f*y+o*m}}class vc{constructor(o,c,m,y,x){this.tileSize=512,this._renderWorldCopies=void 0===x||x,this._minZoom=o||0,this._maxZoom=c||22,this._minPitch=null==m?0:m,this._maxPitch=null==y?60:y,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Js,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Ch,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const o=new vc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.setProjection(this.getProjection()),o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o.tileSize=this.tileSize,o.setMaxBounds(this.getMaxBounds()),o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._cameraZoom=this._cameraZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,o?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(o){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),o&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return d.pick(this.projection,["name","center","parallels"])}setProjection(o){null==o&&(o={name:"mercator"}),this.projectionOptions=o;const c=this.projection?this.getProjection():void 0;return this.projection=d.getProjection(o),!yt(c,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(o){void 0===o?o=!0:null===o&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.pointGeometry(this.width,this.height)}get bearing(){return d.wrap(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const c=-o*Math.PI/180;var m,y,x,E,C,P,F,R,O,j;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(m=new d.ARRAY_TYPE(4),d.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),y=this.rotationMatrix,E=this.angle,C=(x=this.rotationMatrix)[0],P=x[1],F=x[2],R=x[3],O=Math.sin(E),j=Math.cos(E),y[0]=C*j+F*O,y[1]=P*j+R*O,y[2]=C*-O+F*j,y[3]=P*-O+R*j)}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const c=d.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(o){const c=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===o?(this._cameraZoom=null,!1):(this._centerAltitude=o,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let y=0,x=0;for(let E=0;E<c.length;E++){const C=new d.pointGeometry(c[E][0]*this.width,m+c[E][1]*(this.height-m)),P=o.pointCoordinate(C);if(!P)continue;const F=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);y+=P[3]*F,x+=F}return 0===x?NaN:y/x}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const o=this._cameraZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*c,y=this._mercatorZfromZoom(o),x=this._mercatorZfromZoom(this._maxZoom),E=Math.max(y-m,x);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let m;m=o.z<this._camera.position[2]?[c.x,c.y,c.z]:[o.x,o.y,o.z];const y=d.length(d.sub([],this._camera.position,m));return d.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let c=!1;if(o.orientation&&!d.exactEquals(o.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(o.orientation)),o.position){const m=[o.position.x,o.position.y,o.position.z];d.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,c=new Th;return c.position=new d.MercatorCoordinate(o[0],o[1],o[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(o){if(!d.length$1(o))return!1;d.normalize$1(o,o);const c=d.transformQuat([],[0,0,-1],o),m=d.transformQuat([],[0,-1,0],o);if(m[2]<0)return!1;const y=gu(c,m);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(o){const c=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;o[2]=d.clamp(o[2],y/m,y/c),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,c,m){this._unmodified=!1,this._edgeInsets.interpolate(o,c,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const c=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(o){const c=[new d.UnwrappedTileID(0,o)];if(this.renderWorldCopies){const m=this.pointCoordinate(new d.pointGeometry(0,0)),y=this.pointCoordinate(new d.pointGeometry(this.width,0)),x=this.pointCoordinate(new d.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new d.pointGeometry(0,this.height)),C=Math.floor(Math.min(m.x,y.x,x.x,E.x)),P=Math.floor(Math.max(m.x,y.x,x.x,E.x)),F=1;for(let R=C-F;R<=P+F;R++)0!==R&&c.push(new d.UnwrappedTileID(R,o))}return c}coveringTiles(o){let c=this.coveringZoomLevel(o);const m=c,y=this.elevation&&!o.isTerrainDEM,x="mercator"===this.projection.name;if(void 0!==o.minzoom&&c<o.minzoom)return[];void 0!==o.maxzoom&&c>o.maxzoom&&(c=o.maxzoom);const E=this.locationCoordinate(this.center),C=1<<c,P=[C*E.x,C*E.y,0],F=d.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,"globe"!==this.projection.name),R=this.pointCoordinate(this.getCameraPoint()),O=C*d.mercatorZfromAltitude(1,this.center.lat),j=this._camera.position[2]/d.mercatorZfromAltitude(1,this.center.lat),Z=[C*R.x,C*R.y,j],H=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),W=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,se=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,G=o.isTerrainDEM?-se:this._elevation?this._elevation.getMinElevationBelowMSL():0,ne=this.projection.isReprojectedInTileSpace?_u(this):1,Q=ve=>{const Ie=new d.MercatorCoordinate(ve.x+25e-6,ve.y,ve.z),et=new d.MercatorCoordinate(ve.x,ve.y+25e-6,ve.z),at=ve.toLngLat(),Tt=Ie.toLngLat(),je=et.toLngLat(),ot=this.locationCoordinate(at),ft=this.locationCoordinate(Tt),rn=this.locationCoordinate(je),mn=Math.hypot(ft.x-ot.x,ft.y-ot.y),_t=Math.hypot(rn.x-ot.x,rn.y-ot.y);return Math.sqrt(mn*_t)*ne/25e-6},te=ve=>{const Fe=se,Ie=G;return{aabb:d.tileAABB(this,C,0,0,0,ve,Ie,Fe,this.projection),zoom:0,x:0,y:0,minZ:Ie,maxZ:Fe,wrap:ve,fullyVisible:!1}},re=[];let ae=[];const _e=c,xe=o.reparseOverscaled?m:c,Ue=ve=>ve*ve,Le=Ue((j-this._centerAltitude)*O),ke=ve=>{if(!this._elevation||!ve.tileID||!x)return;const Fe=this._elevation.getMinMaxForTile(ve.tileID),Ie=ve.aabb;Fe?(Ie.min[2]=Fe.min,Ie.max[2]=Fe.max,Ie.center[2]=(Ie.min[2]+Ie.max[2])/2):(ve.shouldSplit=be(ve),ve.shouldSplit||(Ie.min[2]=Ie.max[2]=Ie.center[2]=this._centerAltitude))},be=ve=>{if(ve.zoom<W)return!0;if(ve.zoom===_e)return!1;if(null!=ve.shouldSplit)return ve.shouldSplit;const Fe=ve.aabb.distanceX(Z),Ie=ve.aabb.distanceY(Z);let et=Le;y&&(et=Ue(ve.aabb.distanceZ(Z)*O));let at=1;if(this.projection.isReprojectedInTileSpace&&m<=5){const je=Math.pow(2,ve.zoom),ot=Q(new d.MercatorCoordinate((ve.x+.5)/je,(ve.y+.5)/je));at=ot>.85?1:ot}const Tt=Fe*Fe+Ie*Ie+et;return Tt<Ue((1<<_e-ve.zoom)*H*at*((je,ot)=>{if(ot*Ue(.707)<je)return 1;const ft=Math.sqrt(ot/je);return ft/(1.4144271570014144+(Math.pow(1.1,ft-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(et,Le),Tt))};if(this.renderWorldCopies)for(let ve=1;ve<=3;ve++)re.push(te(-ve)),re.push(te(ve));for(re.push(te(0));re.length>0;){const ve=re.pop(),Fe=ve.x,Ie=ve.y;let et=ve.fullyVisible;if(!et){const at=ve.aabb.intersects(F);if(0===at)continue;et=2===at}if(ve.zoom!==_e&&be(ve))for(let at=0;at<4;at++){const Tt=(Fe<<1)+at%2,je=(Ie<<1)+(at>>1),ot={aabb:x?ve.aabb.quadrant(at):d.tileAABB(this,C,ve.zoom+1,Tt,je,ve.wrap,ve.minZ,ve.maxZ,this.projection),zoom:ve.zoom+1,x:Tt,y:je,wrap:ve.wrap,fullyVisible:et,tileID:void 0,shouldSplit:void 0,minZ:ve.minZ,maxZ:ve.maxZ};y&&(ot.tileID=new d.OverscaledTileID(ve.zoom+1===_e?xe:ve.zoom+1,ve.wrap,ve.zoom+1,Tt,je),ke(ot)),re.push(ot)}else{const at=ve.zoom===_e?xe:ve.zoom;if(o.minzoom&&o.minzoom>at)continue;const Tt=P[0]-(.5+Fe+(ve.wrap<<ve.zoom))*(1<<c-ve.zoom),je=P[1]-.5-Ie,ot=ve.tileID?ve.tileID:new d.OverscaledTileID(at,ve.wrap,ve.zoom,Fe,Ie);ae.push({tileID:ot,distanceSq:Tt*Tt+je*je})}}if(this.fogCullDistSq){const ve=this.fogCullDistSq,Fe=this.horizonLineFromTop();ae=ae.filter(Ie=>{const et=[0,0,0,1],at=[d.EXTENT,d.EXTENT,0,1],Tt=this.calculateFogTileMatrix(Ie.tileID.toUnwrapped());d.transformMat4$1(et,et,Tt),d.transformMat4$1(at,at,Tt);const je=d.getAABBPointSquareDist(et,at);if(0===je)return!0;let ot=!1;const ft=this._elevation;if(ft&&je>ve&&0!==Fe){const rn=this.calculateProjMatrix(Ie.tileID.toUnwrapped());let mn;o.isTerrainDEM||(mn=ft.getMinMaxForTile(Ie.tileID)),mn||(mn={min:G,max:se});const _t=d.furthestTileCorner(this.rotation),kt=[_t[0]*d.EXTENT,_t[1]*d.EXTENT,mn.max];d.transformMat4(kt,kt,rn),ot=(1-kt[1])*this.height*.5<Fe}return je<ve||ot})}return ae.sort((ve,Fe)=>ve.distanceSq-Fe.distanceSq).map(ve=>ve.tileID)}resize(o,c){this.width=o,this.height=c,this.pixelsToGLUnits=[2/o,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const c=d.clamp(o.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),m=this.projection.project(o.lng,c);return new d.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(o,c){const m=this.pointCoordinate(c),y=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(o);this.setLocation(new d.MercatorCoordinate(x.x-(m.x-y.x),x.y-(m.y-y.y)))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this._coordinatePoint(this.locationCoordinate(o),!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,c){const m=c?d.mercatorZfromAltitude(c,o.lat):void 0,y=this.projection.project(o.lng,o.lat);return new d.MercatorCoordinate(y.x,y.y,m)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,c){const m=null!=c?c:this._centerAltitude,y=[o.x,o.y,0,1],x=[o.x,o.y,1,1];d.transformMat4$1(y,y,this.pixelMatrixInverse),d.transformMat4$1(x,x,this.pixelMatrixInverse);const E=x[3];d.scale$1(y,y,1/y[3]),d.scale$1(x,x,1/E);const C=y[2],P=x[2];return{p0:y,p1:x,t:C===P?0:(m-C)/(P-C)}}screenPointToMercatorRay(o){const c=[o.x,o.y,0,1],m=[o.x,o.y,1,1];return d.transformMat4$1(c,c,this.pixelMatrixInverse),d.transformMat4$1(m,m,this.pixelMatrixInverse),d.scale$1(c,c,1/c[3]),d.scale$1(m,m,1/m[3]),c[2]=d.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,m[2]=d.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,d.scale$1(c,c,1/this.worldSize),d.scale$1(m,m,1/this.worldSize),new d.Ray([c[0],c[1],c[2]],d.normalize([],d.sub([],m,c)))}rayIntersectionCoordinate(o){const{p0:c,p1:m,t:y}=o,x=d.mercatorZfromAltitude(c[2],this._center.lat),E=d.mercatorZfromAltitude(m[2],this._center.lat);return new d.MercatorCoordinate(d.number(c[0],m[0],y)/this.worldSize,d.number(c[1],m[1],y)/this.worldSize,d.number(x,E,y))}pointCoordinate(o,c=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(o.x,o.y,c)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);const c=this.elevation;let m=this.elevation.pointCoordinate(o);if(m)return new d.MercatorCoordinate(m[0],m[1],m[2]);let y=0,x=this.horizonLineFromTop();if(o.y>x)return this.pointCoordinate(o);const E=.02*x,C=o.clone();for(let P=0;P<10&&x-y>E;P++){C.y=d.number(y,x,.66);const F=c.pointCoordinate(C);F?(x=C.y,m=F):y=C.y}return m?new d.MercatorCoordinate(m[0],m[1],m[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){if(this.elevation)return!this.elevation.pointCoordinate(o);{const c=this.horizonLineFromTop();return o.y<c}}_coordinatePoint(o,c){const m=c&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,y=[o.x*this.worldSize,o.y*this.worldSize,m+o.toAltitude(),1];return d.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new d.pointGeometry(y[0]/y[3],y[1]/y[3]):new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(o,c){const m=new d.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),y=new d.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),x=new d.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),E=new d.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let C=this.pointCoordinate(m,o),P=this.pointCoordinate(y,o);const F=this.pointCoordinate(x,c),R=this.pointCoordinate(E,c),O=(j,Z)=>(Z.y-j.y)/(Z.x-j.x);return C.y>1&&P.y>=0?C=new d.MercatorCoordinate((1-R.y)/O(R,C)+R.x,1):C.y<0&&P.y<=1&&(C=new d.MercatorCoordinate(-R.y/O(R,C)+R.x,0)),P.y>1&&C.y>=0?P=new d.MercatorCoordinate((1-F.y)/O(F,P)+F.x,1):P.y<0&&C.y<=1&&(P=new d.MercatorCoordinate(-F.y/O(F,P)+F.x,0)),(new d.LngLatBounds).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(P)).extend(this.coordinateLocation(R)).extend(this.coordinateLocation(F))}_getBounds3D(){const o=this.elevation;if(!o.visibleDemTiles.length)return this._getBounds(0,0);const c=o.visibleDemTiles.reduce((m,y)=>{if(y.dem){const x=y.dem.tree;m.min=Math.min(m.min,x.minimums[0]),m.max=Math.max(m.max,x.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(c.min*o.exaggeration(),c.max*o.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(o=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-c*(1-this._horizonShift);return o?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-d.MAX_MERCATOR_LATITUDE,this.maxLat=d.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=d.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=d.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=d.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=d.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,c){return this.projection.createTileTransform(this,c).createTileMatrix(o)}calculateDistanceTileData(o){const c=o.key,m=this._distanceTileDataCache;if(m[c])return m[c];const y=o.canonical,x=1/this.height,E=this.cameraWorldSize/this.zoomScale(y.z),C=(y.x+Math.pow(2,y.z)*o.wrap)*E,P=y.y*E,F=this.point,R=this.angle,O=Math.sin(-R),j=-Math.cos(-R);return m[c]={bearing:[O,j],center:[(F.x-C)*x,(F.y-P)*x],scale:E/d.EXTENT*x},m[c]}calculateFogTileMatrix(o){const c=o.key,m=this._fogTileMatrixCache;if(m[c])return m[c];const y=this.calculatePosMatrix(o,this.cameraWorldSize);return d.multiply$1(y,this.worldToFogMatrix,y),m[c]=new Float32Array(y),m[c]}calculateProjMatrix(o,c=!1){const m=o.key,y=c?this._alignedProjMatrixCache:this._projMatrixCache;if(y[m])return y[m];const x=this.calculatePosMatrix(o,this.worldSize);return d.multiply$1(x,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,x),y[m]=new Float32Array(x),y[m]}calculatePixelsToTileUnitsMatrix(o){const c=o.tileID.key,m=this._pixelsToTileUnitsCache;if(m[c])return m[c];const y=function(x,E){const{scale:C}=x.tileTransform,P=C*d.EXTENT/(x.tileSize*Math.pow(2,E.zoom-x.tileID.overscaledZ+x.tileID.canonical.z));return F=new Float32Array(4),j=(R=E.inverseAdjustmentMatrix)[1],Z=R[2],H=R[3],se=(O=[P,P])[1],F[0]=R[0]*(W=O[0]),F[1]=j*W,F[2]=Z*se,F[3]=H*se,F;var F,R,O,j,Z,H,W,se}(o,this);return m[c]=y,m[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const c=d.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),y=this._camera.forward(),x=d.mercatorZfromAltitude(1,this._center.lat);m[2]/=x,y[2]/=x,d.normalize(y,y);const E=o.raycast(m,y,o.exaggeration());if(E){const C=d.scaleAndAdd([],m,y,E),P=new d.MercatorCoordinate(C[0],C[1],d.mercatorZfromAltitude(C[2],d.latFromMercatorY(C[1]))),F=(P.z+d.length([P.x-m[0],P.y-m[1],P.z-m[2]*x]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(F),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const c=d.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),y=o.getAtPointOrZero(new d.MercatorCoordinate(...m)),x=this._minimumHeightOverTerrain()*Math.cos(d.degToRad(this._maxPitch)),E=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*y;if(E<x){const C=this.locationCoordinate(this._center,this._centerAltitude),P=[C.x-m[0],C.y-m[1],C.z-m[2]],F=d.length(P);P[2]-=(x-E)/this._projectionScaler;const R=d.length(P);if(0===R)return;d.scale$2(P,P,F/R*this._projectionScaler),this._camera.position=[C.x-P[0],C.y-P[1],C.z*this._projectionScaler-P[2]],this._camera.orientation=gu(P,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const O=this.center;return O.lat=d.clamp(O.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(O.lng=d.clamp(O.lng,this.minLng,this.maxLng)),this.center=O,void(this._constraining=!1)}const o=this._unmodified,{x:c,y:m}=this.point;let y=0,x=c,E=m;const C=this.width/2,P=this.height/2,F=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(m-P<F&&(E=F+P),m+P>R&&(E=R-P),R-F<this.height&&(y=Math.max(y,this.height/(R-F)),E=(R+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const O=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,Z=this.worldSize/2-(O+j)/2;x=(c+Z+this.worldSize)%this.worldSize-Z,x-C<O&&(x=O+C),x+C>j&&(x=j-C),j-O<this.width&&(y=Math.max(y,this.width/(j-O)),x=(j+O)/2)}x===c&&E===m||(this.center=this.unproject(new d.pointGeometry(x,E))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCameraAltitude(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this._fov/2,c=this.centerOffset,m=this.pixelsPerMeter;this._projectionScaler=m/(d.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(o)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?m:1),x=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);x[8]=2*-c.x/this.width,x[9]=2*c.y/this.height;let E=d.mul([],x,y);if(this.projection.isReprojectedInTileSpace){const te=this.locationCoordinate(this.center),re=d.identity([]);d.translate(re,re,[te.x*this.worldSize,te.y*this.worldSize,0]),d.multiply$1(re,re,Jd(this)),d.translate(re,re,[-te.x*this.worldSize,-te.y*this.worldSize,0]),d.multiply$1(E,E,re),this.inverseAdjustmentMatrix=function(ae){const _e=Jd(ae,!0);return Ke([],[_e[0],_e[1],_e[4],_e[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=d.scale([],E,[this.worldSize,this.worldSize,this.worldSize/m,1]),this.projMatrix=E,this.invProjMatrix=d.invert(new Float64Array(16),this.projMatrix);const C=new Float32Array(16);d.identity(C),d.scale(C,C,[1,-1,1]),d.rotateX(C,C,this._pitch),d.rotateZ(C,C,this.angle);const P=d.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),F=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;P[8]=2*-c.x/this.width,P[9]=2*(c.y+F)/this.height,this.skyboxMatrix=d.multiply$1(C,P,C);const R=this.point,O=R.x,j=R.y,Z=this.width%2/2,H=this.height%2/2,W=Math.cos(this.angle),se=Math.sin(this.angle),G=O-Math.round(O)+W*Z+se*H,ne=j-Math.round(j)+W*H+se*Z,Q=new Float64Array(E);if(d.translate(Q,Q,[G>.5?G-1:G,ne>.5?ne-1:ne,0]),this.alignedProjMatrix=Q,E=d.create(),d.scale(E,E,[this.width/2,-this.height/2,1]),d.translate(E,E,[1,-1,0]),this.labelPlaneMatrix=E,E=d.create(),d.scale(E,E,[1,-1,1]),d.translate(E,E,[-1,-1,0]),d.scale(E,E,[2/this.width,2/this.height,1]),this.glCoordMatrix=E,this.pixelMatrix=d.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},E=d.invert(new Float64Array(16),this.pixelMatrix),!E)throw new Error("failed to invert matrix");this.pixelMatrixInverse=E,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSize,c=this.cameraPixelsPerMeter,m=this._camera.position,y=1/this.height,x=[o,o,c];d.scale$2(x,x,y),d.scale$2(m,m,-1),d.multiply$2(m,m,x);const E=d.create();d.translate(E,E,m),d.scale(E,E,x),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,c,y)}_computeCameraPosition(o){const c=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),y=this.point,x=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*c-o/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-m[0]*x,y.y/this.worldSize-m[1]*x,o/this.worldSize*this._centerAltitude-m[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=o[2];let y=1;m>0&&(y=Math.min((c-this._camera.position[2])/m,1)),this._camera.position=d.scaleAndAdd([],this._camera.position,o,y),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,c=this._camera.forward(),{pitch:m,bearing:y}=this._camera.getPitchBearing(),x=d.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(d.degToRad(this._maxPitch)),C=Math.max((o[2]-x)/Math.cos(m),E),P=this._zoomFromMercatorZ(C);d.scaleAndAdd(o,o,c,C),this._pitch=d.clamp(m,d.degToRad(this.minPitch),d.degToRad(this.maxPitch)),this.angle=d.wrap(y,-Math.PI,Math.PI),this._setZoom(d.clamp(P,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new d.MercatorCoordinate(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(d.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(o,c){const m=Math.min(o.x,c.x),y=Math.max(o.x,c.x),x=Math.min(o.y,c.y),E=Math.max(o.y,c.y);if(x<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const C=[new d.pointGeometry(m,x),new d.pointGeometry(y,E),new d.pointGeometry(m,E),new d.pointGeometry(y,x)],P=this.renderWorldCopies?-3:0,F=this.renderWorldCopies?4:1;for(const R of C){const O=this.pointRayIntersection(R);if(O.t<0)return!0;const j=this.rayIntersectionCoordinate(O);if(j.x<P||j.y<0||j.x>F||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+d.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new d.pointGeometry(0,0),new d.pointGeometry(this.width,this.height))}zoomDeltaToMovement(o,c){const m=d.length(d.sub([],this._camera.position,o)),y=this._zoomFromMercatorZ(m)+c;return m-this._mercatorZfromZoom(y)}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.pointGeometry(0,o))}}function Ys(f,o){let c=!1,m=null;const y=()=>{m=null,c&&(f(),m=setTimeout(y,o),c=!1)};return()=>(c=!0,m||y(),m)}class Yd{constructor(o){this._hashName=o&&encodeURIComponent(o),d.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ys(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,d.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return d.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const c=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,y),E=Math.round(c.lng*x)/x,C=Math.round(c.lat*x)/x,P=this._map.getBearing(),F=this._map.getPitch();let R="";if(R+=o?`/${E}/${C}/${m}`:`${m}/${C}/${E}`,(P||F)&&(R+="/"+Math.round(10*P)/10),F&&(R+=`/${Math.round(F)}`),this._hashName){const O=this._hashName;let j=!1;const Z=d.window.location.hash.slice(1).split("&").map(H=>{const W=H.split("=")[0];return W===O?(j=!0,`${W}=${R}`):H}).filter(H=>H);return j||Z.push(`${O}=${R}`),`#${Z.join("&")}`}return`#${R}`}_getCurrentHash(){const o=d.window.location.hash.replace("#","");if(this._hashName){let c;return o.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(c=m)}),(c&&c[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._getCurrentHash();if(o.length>=3&&!o.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:c,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=d.window.location.href.replace(/(#.+)?$/,this.getHashString());d.window.history.replaceState(d.window.history.state,null,o)}}const ys={linearity:.3,easing:d.bezier(0,0,.3,1)},Ml=d.extend({deceleration:2500,maxSpeed:1400},ys),Qd=d.extend({deceleration:20,maxSpeed:1400},ys),Sh=d.extend({deceleration:1e3,maxSpeed:360},ys),Wt=d.extend({deceleration:1e3,maxSpeed:90},ys);class Ra{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,c=d.exported.now();for(;o.length>0&&c-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new d.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)c.zoom+=x.zoomDelta||0,c.bearing+=x.bearingDelta||0,c.pitch+=x.pitchDelta||0,x.panDelta&&c.pan._add(x.panDelta),x.around&&(c.around=x.around),x.pinchAround&&(c.pinchAround=x.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){const x=xc(c.pan.mag(),m,d.extend({},Ml,o||{}));y.offset=c.pan.mult(x.amount/c.pan.mag()),y.center=this._map.transform.center,vu(y,x)}if(c.zoom){const x=xc(c.zoom,m,Qd);y.zoom=this._map.transform.zoom+x.amount,vu(y,x)}if(c.bearing){const x=xc(c.bearing,m,Sh);y.bearing=this._map.transform.bearing+d.clamp(x.amount,-179,179),vu(y,x)}if(c.pitch){const x=xc(c.pitch,m,Wt);y.pitch=this._map.transform.pitch+x.amount,vu(y,x)}if(y.zoom||y.bearing){const x=void 0===c.pinchAround?c.around:c.pinchAround;y.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),d.extend(y,{noMoveStart:!0})}}function vu(f,o){(!f.duration||f.duration<o.duration)&&(f.duration=o.duration,f.easing=o.easing)}function xc(f,o,c){const{maxSpeed:m,linearity:y,deceleration:x}=c,E=d.clamp(f*y/(o/1e3),-m,m),C=Math.abs(E)/(x*y);return{easing:c.easing,duration:1e3*C,amount:E*(C/2)}}class Pr extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,m,y={}){const x=Ae.mousePos(c.getCanvasContainer(),m),E=c.unproject(x);super(o,d.extend({point:x,lngLat:E,originalEvent:m},y)),this._defaultPrevented=!1,this.target=c}}class vo extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,m){const y="touchend"===o?m.changedTouches:m.touches,x=Ae.touchPos(c.getCanvasContainer(),y),E=x.map(P=>c.unproject(P)),C=x.reduce((P,F,R,O)=>P.add(F.div(O.length)),new d.pointGeometry(0,0));super(o,{points:x,point:C,lngLats:E,lngLat:c.unproject(C),originalEvent:m}),this._defaultPrevented=!1}}class ep extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,m){super(o,{originalEvent:m}),this._defaultPrevented=!1}}class Il{constructor(o,c){this._map=o,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new ep(o.type,this._map,o))}mousedown(o,c){return this._mousedownPos=c,this._firePreventable(new Pr(o.type,this._map,o))}mouseup(o){this._map.fire(new Pr(o.type,this._map,o))}preclick(o){const c=d.extend({},o);c.type="preclick",this._map.fire(new Pr(c.type,this._map,c))}click(o,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Pr(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Pr(o.type,this._map,o))}mouseover(o){this._map.fire(new Pr(o.type,this._map,o))}mouseout(o){this._map.fire(new Pr(o.type,this._map,o))}touchstart(o){return this._firePreventable(new vo(o.type,this._map,o))}touchmove(o){this._map.fire(new vo(o.type,this._map,o))}touchend(o){this._map.fire(new vo(o.type,this._map,o))}touchcancel(o){this._map.fire(new vo(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ah{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(o){this._map.fire(new Pr(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Pr(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xu{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,c){this.isEnabled()&&o.shiftKey&&0===o.button&&(Ae.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(o,c){if(!this._active)return;const m=c;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=m,this._box||(this._box=Ae.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const x=Math.min(y.x,m.x),E=Math.max(y.x,m.x),C=Math.min(y.y,m.y),P=Math.max(y.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${C}px)`,this._box.style.width=E-x+"px",this._box.style.height=P-C+"px")})}mouseupWindow(o,c){if(!this._active||0!==o.button)return;const m=this._startPos,y=c;if(this.reset(),Ae.suppressClick(),m.x!==y.x||m.y!==y.y)return this._map.fire(new d.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:x=>x.fitScreenCoordinates(m,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&27===o.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ae.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,c){return this._map.fire(new d.Event(o,{originalEvent:c}))}}function La(f,o){const c={};for(let m=0;m<f.length;m++)c[f[m].identifier]=o[m];return c}class za{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,c,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=o.timeStamp),m.length===this.numTouches&&(this.centroid=function(y){const x=new d.pointGeometry(0,0);for(const E of y)x._add(E);return x.div(y.length)}(c),this.touches=La(m,c)))}touchmove(o,c,m){if(this.aborted||!this.centroid)return;const y=La(m,c);for(const x in this.touches){const E=this.touches[x],C=y[x];(!C||C.dist(E)>30)&&(this.aborted=!0)}}touchend(o,c,m){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Oa{constructor(o){this.singleTap=new za(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,c,m){this.singleTap.touchstart(o,c,m)}touchmove(o,c,m){this.singleTap.touchmove(o,c,m)}touchend(o,c,m){const y=this.singleTap.touchend(o,c,m);if(y){const x=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(y)<30;if(x&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class bu{constructor(){this._zoomIn=new Oa({numTouches:1,numTaps:2}),this._zoomOut=new Oa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,c,m){this._zoomIn.touchstart(o,c,m),this._zoomOut.touchstart(o,c,m)}touchmove(o,c,m){this._zoomIn.touchmove(o,c,m),this._zoomOut.touchmove(o,c,m)}touchend(o,c,m){const y=this._zoomIn.touchend(o,c,m),x=this._zoomOut.touchend(o,c,m);return y?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(y)},{originalEvent:o})}):x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(x)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const bc={0:1,2:2};class Ba{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(o,c){return!1}_move(o,c){return{}}mousedown(o,c){if(this._lastPoint)return;const m=Ae.mouseButton(o);this._correctButton(o,m)&&(this._lastPoint=c,this._eventButton=m)}mousemoveWindow(o,c){const m=this._lastPoint;if(m)if(o.preventDefault(),function(y,x){const E=bc[x];return void 0===y.buttons||(y.buttons&E)!==E}(o,this._eventButton))this.reset();else if(this._moved||!(c.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(m,c)}mouseupWindow(o){this._lastPoint&&Ae.mouseButton(o)===this._eventButton&&(this._moved&&Ae.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $r extends Ba{mousedown(o,c){super.mousedown(o,c),this._lastPoint&&(this._active=!0)}_correctButton(o,c){return 0===c&&!o.ctrlKey}_move(o,c){return{around:c,panDelta:c.sub(o)}}}class oi extends Ba{_correctButton(o,c){return 0===c&&o.ctrlKey||2===c}_move(o,c){const m=.8*(c.x-o.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(o){o.preventDefault()}}class wu extends Ba{_correctButton(o,c){return 0===c&&o.ctrlKey||2===c}_move(o,c){const m=-.5*(c.y-o.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(o){o.preventDefault()}}class wc{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),d.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new d.pointGeometry(0,0)}touchstart(o,c,m){return this._calculateTransform(o,c,m)}touchmove(o,c,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===m.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.preventDefault(),this._calculateTransform(o,c,m)}}touchend(o,c,m){this._calculateTransform(o,c,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,c,m){m.length>0&&(this._active=!0);const y=La(m,c),x=new d.pointGeometry(0,0),E=new d.pointGeometry(0,0);let C=0;for(const F in y){const R=y[F],O=this._touches[F];O&&(x._add(R),E._add(R.sub(O)),C++,y[F]=R)}if(this._touches=y,C<this._minTouches||!E.mag())return;const P=E.div(C);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(C),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ae.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Ec{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(o){}_move(o,c,m){return{}}touchstart(o,c,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([c[0],c[1]]))}touchmove(o,c,m){if(!this._firstTwoTouches)return;o.preventDefault();const[y,x]=this._firstTwoTouches,E=Uo(m,c,y),C=Uo(m,c,x);if(!E||!C)return;const P=this._aroundCenter?null:E.add(C).div(2);return this._move([E,C],P,o)}touchend(o,c,m){if(!this._firstTwoTouches)return;const[y,x]=this._firstTwoTouches,E=Uo(m,c,y),C=Uo(m,c,x);E&&C||(this._active&&Ae.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Uo(f,o,c){for(let m=0;m<f.length;m++)if(f[m].identifier===c)return o[m]}function Sl(f,o){return Math.log(f/o)/Math.LN2}class Dc extends Ec{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,c){const m=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Sl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Sl(this._distance,m),pinchAround:c}}}function Na(f,o){return 180*f.angleWith(o)/Math.PI}class Eu extends Ec{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,c){const m=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Na(this._vector,m),pinchAround:c}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const c=25/(Math.PI*this._minDiameter)*360,m=Na(o,this._startVector);return Math.abs(m)<c}}function An(f){return Math.abs(f.y)>Math.abs(f.x)}class Du extends Ec{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(o){this._lastPoints=o,An(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,c,m){const y=o[0].sub(this._lastPoints[0]),x=o[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&m.touches.length<3)&&(this._valid=this.gestureBeginsVertically(y,x,m.timeStamp),this._valid))return this._lastPoints=o,this._active=!0,{pitchDelta:(y.y+x.y)/2*-.5}}gestureBeginsVertically(o,c,m){if(void 0!==this._valid)return this._valid;const y=o.mag()>=2,x=c.mag()>=2;if(!y&&!x)return;if(!y||!x)return void 0===this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const E=o.y>0==c.y>0;return An(o)&&An(c)&&E}}const Va={panStep:100,bearingStep:15,pitchStep:10};class tr{constructor(){const o=Va;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let c=0,m=0,y=0,x=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:o.shiftKey?m=-1:(o.preventDefault(),x=-1);break;case 39:o.shiftKey?m=1:(o.preventDefault(),x=1);break;case 38:o.shiftKey?y=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?y=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:C=>{const P=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:tp,zoom:c?Math.round(P)+c*(o.shiftKey?2:1):P,bearing:C.getBearing()+m*this._bearingStep,pitch:C.getPitch()+y*this._pitchStep,offset:[-x*this._panStep,-E*this._panStep],center:C.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function tp(f){return f*(2-f)}const Ph=4.000244140625;class Qs{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,d.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=o.deltaMode===d.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const m=d.exported.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==c&&c%Ph==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),o.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=o,this._delta-=c,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Ae.mousePos(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform,c=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(0!==this._delta){const P="wheel"===this._type&&Math.abs(this._delta)>Ph?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&0!==F&&(F=1/F);const R=c(),O=Math.pow(2,R),j="number"==typeof this._targetZoom?o.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(j*F))),"wheel"===this._type&&(this._startZoom=c(),this._easing=this._smoothOutEasing(200)),this._delta=0}const m="number"==typeof this._targetZoom?this._targetZoom:c(),y=this._startZoom,x=this._easing;let E,C=!1;if("wheel"===this._type&&y&&x){const P=Math.min((d.exported.now()-this._lastWheelEventTime)/200,1),F=x(P);E=d.number(y,m,F),P<1?this._frameId||(this._frameId=!0):C=!0}else E=m,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:E-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let c=d.ease;if(this._prevEase){const m=this._prevEase,y=(d.exported.now()-m.start)/m.duration,x=m.easing(y+.01)-m.easing(y),E=.27/Math.sqrt(x*x+1e-4)*.01,C=Math.sqrt(.0729-E*E);c=d.bezier(E,C,.25,1)}return this._prevEase={start:d.exported.now(),duration:o,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ae.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(d.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!d.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class si{constructor(o,c){this._clickZoom=o,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class kh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,c){return o.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(o.shiftKey?-1:1),around:m.unproject(c)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tc{constructor(){this._tap=new Oa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(o,c,m){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=c[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(o,c,m))}touchmove(o,c,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=c[0],x=y.y-this._swipePoint.y;return this._swipePoint=y,o.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(o,c,m)}touchend(o,c,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(o,c,m)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $o{constructor(o,c,m){this._el=o,this._mousePan=c,this._touchPan=m}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gr{constructor(o,c,m){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=c,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Tu{constructor(o,c,m,y){this._el=o,this._touchZoom=c,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ea=f=>f.zoom||f.drag||f.pitch||f.rotate;class Fh extends d.Event{}class Go{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,c){const m=d.sub([],c,o);this.radius=d.length(m[2]<0?d.div([],m,this.constants):[m[0],m[1],0])}projectRay(o){d.div(o,o,this.constants),d.normalize(o,o),d.mul$1(o,o,this.constants);const c=d.scale$2([],o,this.radius);if(c[2]>0){const m=d.scale$2([],[0,0,1],d.dot(c,[0,0,1])),y=d.scale$2([],d.normalize([],[c[0],c[1],0]),this.radius),x=d.add([],c,d.scale$2([],d.sub([],d.add([],y,m),c),2));c[0]=x[0],c[1]=x[1]}return c}}function ja(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class vs{constructor(o,c){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ra(o),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Go,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),d.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[d.window.document,"mousemove",{capture:!0}],[d.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[d.window,"blur",void 0]];for(const[y,x,E]of this._listeners)y.addEventListener(x,y===d.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[o,c,m]of this._listeners)o.removeEventListener(c,o===d.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(o){const c=this._map,m=c.getCanvasContainer();this._add("mapEvent",new Il(c,o));const y=c.boxZoom=new xu(c,o);this._add("boxZoom",y);const x=new bu,E=new kh;c.doubleClickZoom=new si(E,x),this._add("tapZoom",x),this._add("clickZoom",E);const C=new Tc;this._add("tapDragZoom",C);const P=c.touchPitch=new Du(c);this._add("touchPitch",P);const F=new oi(o),R=new wu(o);c.dragRotate=new Gr(o,F,R),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const O=new $r(o),j=new wc(c,o);c.dragPan=new $o(m,O,j),this._add("mousePan",O),this._add("touchPan",j,["touchZoom","touchRotate"]);const Z=new Eu,H=new Dc;c.touchZoomRotate=new Tu(m,H,Z,C),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ah(c));const W=c.scrollZoom=new Qs(c,this);this._add("scrollZoom",W,["mousePan"]);const se=c.keyboard=new tr;this._add("keyboard",se);for(const G of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[G]&&c[G].enable(o[G])}_add(o,c,m){this._handlers.push({handlerName:o,handler:c,allowed:m}),this._handlersById[o]=c}stop(o){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(ea(this._eventsInProgress))||this.isZooming()}_blockedByActive(o,c,m){for(const y in o)if(y!==m&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const c=[];for(const m of o)this._el.contains(m.target)&&c.push(m);return c}handleEvent(o,c){this._updatingCamera=!0;const m="renderFrame"===o.type,y=m?void 0:o,x={needsRenderFrame:!1},E={},C={},P=o.touches?this._getMapTouches(o.touches):void 0,F=P?Ae.touchPos(this._el,P):m?void 0:Ae.mousePos(this._el,o);for(const{handlerName:j,handler:Z,allowed:H}of this._handlers){if(!Z.isEnabled())continue;let W;this._blockedByActive(C,H,j)?Z.reset():Z[c||o.type]&&(W=Z[c||o.type](o,F,P),this.mergeHandlerResult(x,E,W,j,y),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||Z.isActive())&&(C[j]=Z)}const R={};for(const j in this._previousActiveHandlers)C[j]||(R[j]=y);this._previousActiveHandlers=C,(Object.keys(R).length||ja(x))&&(this._changes.push([x,E,R]),this._triggerRenderFrame()),(Object.keys(C).length||ja(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:O}=x;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(o,c,m,y,x){if(!m)return;d.extend(o,m);const E={handlerName:y,originalEvent:m.originalEvent||x};void 0!==m.zoomDelta&&(c.zoom=E),void 0!==m.panDelta&&(c.drag=E),void 0!==m.pitchDelta&&(c.pitch=E),void 0!==m.bearingDelta&&(c.rotate=E)}_applyChanges(){const o={},c={},m={};for(const[y,x,E]of this._changes)y.panDelta&&(o.panDelta=(o.panDelta||new d.pointGeometry(0,0))._add(y.panDelta)),y.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+y.pitchDelta),void 0!==y.around&&(o.around=y.around),void 0!==y.aroundCoord&&(o.aroundCoord=y.aroundCoord),void 0!==y.pinchAround&&(o.pinchAround=y.pinchAround),y.noInertia&&(o.noInertia=y.noInertia),d.extend(c,x),d.extend(m,E);this._updateMapTransform(o,c,m),this._changes=[]}_updateMapTransform(o,c,m){const y=this._map,x=y.transform,E=ne=>[ne.x,ne.y,ne.z];if((ne=>{const Q=this._eventsInProgress.drag;return Q&&!this._handlersById[Q.handlerName].isActive()})()&&!ja(o)){const ne=x.zoom;x.cameraElevationReference="sea",x.recenterOnTerrain(),x.cameraElevationReference="ground",ne!==x.zoom&&this._map._update(!0)}if(!ja(o))return this._fireEvents(c,m,!0);let{panDelta:C,zoomDelta:P,bearingDelta:F,pitchDelta:R,around:O,aroundCoord:j,pinchAround:Z}=o;void 0!==Z&&(O=Z),(ne=>c.drag&&!this._eventsInProgress.drag)()&&O&&(this._dragOrigin=E(x.pointCoordinate3D(O)),this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",y._stop(!0),O=O||y.transform.centerPoint,F&&(x.bearing+=F),R&&(x.pitch+=R),x._updateCameraState();const H=[0,0,0];if(C){const ne=x.pointCoordinate(O),Q=x.pointCoordinate(O.sub(C));ne&&Q&&(H[0]=Q.x-ne.x,H[1]=Q.y-ne.y)}const W=x.zoom,se=[0,0,0];if(P){const ne=E(j||x.pointCoordinate3D(O)),Q={dir:d.normalize([],d.sub([],ne,x._camera.position))};if(Q.dir[2]<0){const te=x.zoomDeltaToMovement(ne,P);d.scale$2(se,Q.dir,te)}}const G=d.add(H,H,se);x._translateCameraConstrained(G),P&&Math.abs(x.zoom-W)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(c,m,!0)}_fireEvents(o,c,m){const y=ea(this._eventsInProgress),x=ea(o),E={};for(const R in o){const{originalEvent:O}=o[R];this._eventsInProgress[R]||(E[`${R}start`]=O),this._eventsInProgress[R]=o[R]}!y&&x&&this._fireEvent("movestart",x.originalEvent);for(const R in E)this._fireEvent(R,E[R]);x&&this._fireEvent("move",x.originalEvent);for(const R in o){const{originalEvent:O}=o[R];this._fireEvent(R,O)}const C={};let P;for(const R in this._eventsInProgress){const{handlerName:O,originalEvent:j}=this._eventsInProgress[R];this._handlersById[O].isActive()||(delete this._eventsInProgress[R],P=c[O]||j,C[`${R}end`]=P)}for(const R in C)this._fireEvent(R,C[R]);const F=ea(this._eventsInProgress);if(m&&(y||x)&&!F){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=j=>0!==j&&-this._bearingSnap<j&&j<this._bearingSnap;R?(O(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:P})):(this._map.fire(new d.Event("moveend",{originalEvent:P})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,c){this._map.fire(new d.Event(o,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new Fh("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const xt="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class np extends d.Evented{constructor(o,c){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=c.bearingSnap,d.bindAll(["_renderFrameCallback"],this)}getCenter(){return new d.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,c){return this.jumpTo({center:o},c)}panBy(o,c,m){return o=d.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,d.extend({offset:o},c),m)}panTo(o,c,m){return this.easeTo(d.extend({center:o},c),m)}getZoom(){return this.transform.zoom}setZoom(o,c){return this.jumpTo({zoom:o},c),this}zoomTo(o,c,m){return this.easeTo(d.extend({zoom:o},c),m)}zoomIn(o,c){return this.zoomTo(this.getZoom()+1,o,c),this}zoomOut(o,c){return this.zoomTo(this.getZoom()-1,o,c),this}getBearing(){return this.transform.bearing}setBearing(o,c){return this.jumpTo({bearing:o},c),this}getPadding(){return this.transform.padding}setPadding(o,c){return this.jumpTo({padding:o},c),this}rotateTo(o,c,m){return this.easeTo(d.extend({bearing:o},c),m)}resetNorth(o,c){return this.rotateTo(0,d.extend({duration:1e3},o),c),this}resetNorthPitch(o,c){return this.easeTo(d.extend({bearing:0,pitch:0,duration:1e3},o),c),this}snapToNorth(o,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,c):this}getPitch(){return this.transform.pitch}setPitch(o,c){return this.jumpTo({pitch:o},c),this}cameraForBounds(o,c){o=d.LngLatBounds.convert(o);const m=c&&c.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),m,c)}_extendCameraOptions(o){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(o=d.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding){const m=o.padding;o.padding={top:m,bottom:m,right:m,left:m}}return o.padding=d.extend(c,o.padding),o}_cameraForBoxAndBearing(o,c,m,y){const x=this._extendCameraOptions(y),E=this.transform,C=E.padding,P=E.project(d.LngLat.convert(o)),F=E.project(d.LngLat.convert(c)),R=P.rotate(-d.degToRad(m)),O=F.rotate(-d.degToRad(m)),j=new d.pointGeometry(Math.max(R.x,O.x),Math.max(R.y,O.y)),Z=new d.pointGeometry(Math.min(R.x,O.x),Math.min(R.y,O.y)),H=j.sub(Z),W=(E.width-(C.left+C.right+x.padding.left+x.padding.right))/H.x,se=(E.height-(C.top+C.bottom+x.padding.top+x.padding.bottom))/H.y;if(se<0||W<0)return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const G=Math.min(E.scaleZoom(E.scale*Math.min(W,se)),x.maxZoom),ne="number"==typeof x.offset.x?new d.pointGeometry(x.offset.x,x.offset.y):d.pointGeometry.convert(x.offset),Q=new d.pointGeometry((x.padding.left-x.padding.right)/2,(x.padding.top-x.padding.bottom)/2).rotate(m*Math.PI/180),te=ne.add(Q).mult(E.scale/E.zoomScale(G));return{center:E.unproject(P.add(F).div(2).sub(te)),zoom:G,bearing:m}}_cameraForBox(o,c,m,y,x){const E=this._extendCameraOptions(x);m=m||0,y=y||0,o=d.LngLat.convert(o),c=d.LngLat.convert(c);const C=this.transform.clone();C.padding=E.padding;const P=this.getFreeCameraOptions(),F=new d.LngLat(.5*(o.lng+c.lng),.5*(o.lat+c.lat)),R=.5*(m+y);if(C._camera.position[2]<d.mercatorZfromAltitude(R,F.lat))return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");P.lookAtPoint(F),C.setFreeCameraOptions(P);const O=d.MercatorCoordinate.fromLngLat(o),j=d.MercatorCoordinate.fromLngLat(c),Z=C.pointRayIntersection(C.centerPoint,R),H=[(W=C.rayIntersectionCoordinate(Z)).x,W.y,W.z];var W;const se=C.screenPointToMercatorRay(C.centerPoint),G="globe"!==C.projection.name;let ne,Q=0;do{const te=Math.floor(C.zoom),re=1<<te,ae=Math.min(re*O.x,re*j.x),_e=Math.min(re*O.y,re*j.y),xe=Math.max(re*O.x,re*j.x),Ue=Math.max(re*O.y,re*j.y),Le=new d.Aabb([ae,_e,m],[xe,Ue,y]),ke=d.Frustum.fromInvProjectionMatrix(C.invProjMatrix,C.worldSize,te,G);if(2!==Le.intersects(ke)){ne&&(C._camera.position=d.scaleAndAdd([],C._camera.position,se.dir,-ne),C._updateStateFromCamera());break}const be=d.sub([],C._camera.position,H);ne=.5*d.length(be),C._camera.position=d.scaleAndAdd([],C._camera.position,se.dir,ne);try{C._updateStateFromCamera()}catch(ve){return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++Q<10);return{center:C.center,zoom:C.zoom,bearing:C.bearing,pitch:C.pitch}}fitBounds(o,c,m){return this._fitInternal(this.cameraForBounds(o,c),c,m)}_raycastElevationBox(o,c){const m=this.transform.elevation;if(!m)return;const y=new d.pointGeometry(o.x,c.y),x=new d.pointGeometry(c.x,o.y),E=m.pointCoordinate(o);if(!E)return;const C=m.pointCoordinate(c);if(!C)return;const P=m.pointCoordinate(y);if(!P)return;const F=m.pointCoordinate(x);if(!F)return;const R=new d.MercatorCoordinate(E[0],E[1]).toLngLat(),O=new d.MercatorCoordinate(C[0],C[1]).toLngLat(),j=new d.MercatorCoordinate(P[0],P[1]).toLngLat(),Z=new d.MercatorCoordinate(F[0],F[1]).toLngLat(),H=Math.min(R.lng,Math.min(O.lng,Math.min(j.lng,Z.lng))),W=Math.min(R.lat,Math.min(O.lat,Math.min(j.lat,Z.lat))),se=Math.max(R.lng,Math.max(O.lng,Math.max(j.lng,Z.lng))),G=Math.max(R.lat,Math.max(O.lat,Math.max(j.lat,Z.lat))),ne=Math.min(E[3],Math.min(C[3],Math.min(P[3],F[3]))),Q=Math.max(E[3],Math.max(C[3],Math.max(P[3],F[3])));return{minLngLat:new d.LngLat(H,W),maxLngLat:new d.LngLat(se,G),minAltitude:ne,maxAltitude:Q}}fitScreenCoordinates(o,c,m,y,x){let E,C,P,F;const R=d.pointGeometry.convert(o),O=d.pointGeometry.convert(c),j=this._raycastElevationBox(R,O);if(j)E=j.minLngLat,C=j.maxLngLat,P=j.minAltitude,F=j.maxAltitude;else{if(this.transform.anyCornerOffEdge(R,O))return this;E=this.transform.pointLocation(R),C=this.transform.pointLocation(O)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(d.pointGeometry.convert(o)),this.transform.pointLocation(d.pointGeometry.convert(c)),m,y):this._cameraForBox(E,C,P,F,y),y,x)}_fitInternal(o,c,m){return o?(delete(c=d.extend(o,c)).padding,c.linear?this.easeTo(c,m):this.flyTo(c,m)):this}jumpTo(o,c){this.stop();const m=o.preloadOnly?this.transform.clone():this.transform;let y=!1,x=!1,E=!1;return"zoom"in o&&m.zoom!==+o.zoom&&(y=!0,m.zoom=+o.zoom),void 0!==o.center&&(m.center=d.LngLat.convert(o.center)),"bearing"in o&&m.bearing!==+o.bearing&&(x=!0,m.bearing=+o.bearing),"pitch"in o&&m.pitch!==+o.pitch&&(E=!0,m.pitch=+o.pitch),null==o.padding||m.isPaddingEqual(o.padding)||(m.padding=o.padding),o.preloadOnly?(this._preloadTiles(m),this):(this.fire(new d.Event("movestart",c)).fire(new d.Event("move",c)),y&&this.fire(new d.Event("zoomstart",c)).fire(new d.Event("zoom",c)).fire(new d.Event("zoomend",c)),x&&this.fire(new d.Event("rotatestart",c)).fire(new d.Event("rotate",c)).fire(new d.Event("rotateend",c)),E&&this.fire(new d.Event("pitchstart",c)).fire(new d.Event("pitch",c)).fire(new d.Event("pitchend",c)),this.fire(new d.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||d.warnOnce(xt),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,c){const m=this.transform;if(!m.projection.supportsFreeCamera)return void d.warnOnce(xt);this.stop();const y=m.zoom,x=m.pitch,E=m.bearing;m.setFreeCameraOptions(o);const C=y!==m.zoom,P=x!==m.pitch,F=E!==m.bearing;return this.fire(new d.Event("movestart",c)).fire(new d.Event("move",c)),C&&this.fire(new d.Event("zoomstart",c)).fire(new d.Event("zoom",c)).fire(new d.Event("zoomend",c)),F&&this.fire(new d.Event("rotatestart",c)).fire(new d.Event("rotate",c)).fire(new d.Event("rotateend",c)),P&&this.fire(new d.Event("pitchstart",c)).fire(new d.Event("pitch",c)).fire(new d.Event("pitchend",c)),this.fire(new d.Event("moveend",c)),this}easeTo(o,c){this._stop(!1,o.easeId),(!1===(o=d.extend({offset:[0,0],duration:500,easing:d.ease},o)).animate||!o.essential&&d.exported.prefersReducedMotion)&&(o.duration=0);const m=this.transform,y=this.getZoom(),x=this.getBearing(),E=this.getPitch(),C=this.getPadding(),P="zoom"in o?+o.zoom:y,F="bearing"in o?this._normalizeBearing(o.bearing,x):x,R="pitch"in o?+o.pitch:E,O="padding"in o?o.padding:m.padding,j=d.pointGeometry.convert(o.offset);let Z=m.centerPoint.add(j);const H="globe"===m.projection.name?m.pointCoordinate(Z).toLngLat():m.pointLocation(Z),W=d.LngLat.convert(o.center||H);this._normalizeCenter(W);const se=m.project(H),G=m.project(W).sub(se),ne=m.zoomScale(P-y);let Q,te;o.around&&(Q=d.LngLat.convert(o.around),te=m.locationPoint(Q));const re=this._zooming||P!==y,ae=this._rotating||x!==F,_e=this._pitching||R!==E,xe=!m.isPaddingEqual(O),Ue=ke=>be=>{if(re&&(ke.zoom=d.number(y,P,be)),ae&&(ke.bearing=d.number(x,F,be)),_e&&(ke.pitch=d.number(E,R,be)),xe&&(ke.interpolatePadding(C,O,be),Z=ke.centerPoint.add(j)),Q)ke.setLocationAtPoint(Q,te);else{const ve=ke.zoomScale(ke.zoom-y),Fe=P>y?Math.min(2,ne):Math.max(.5,ne),Ie=Math.pow(Fe,1-be),et=ke.unproject(se.add(G.mult(be*Ie)).mult(ve));ke.setLocationAtPoint(ke.renderWorldCopies?et.wrap():et,Z)}return o.preloadOnly||this._fireMoveEvents(c),ke};if(o.preloadOnly){const ke=this._emulate(Ue,o.duration,m);return this._preloadTiles(ke),this}const Le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=ae,this._pitching=_e,this._padding=xe,this._easeId=o.easeId,this._prepareEase(c,o.noMoveStart,Le),this._ease(Ue(m),ke=>{m.recenterOnTerrain(),this._afterEase(c,ke)},o),this}_prepareEase(o,c,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||m.moving||this.fire(new d.Event("movestart",o)),this._zooming&&!m.zooming&&this.fire(new d.Event("zoomstart",o)),this._rotating&&!m.rotating&&this.fire(new d.Event("rotatestart",o)),this._pitching&&!m.pitching&&this.fire(new d.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new d.Event("move",o)),this._zooming&&this.fire(new d.Event("zoom",o)),this._rotating&&this.fire(new d.Event("rotate",o)),this._pitching&&this.fire(new d.Event("pitch",o))}_afterEase(o,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId,this.transform.cameraElevationReference="ground";const m=this._zooming,y=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new d.Event("zoomend",o)),y&&this.fire(new d.Event("rotateend",o)),x&&this.fire(new d.Event("pitchend",o)),this.fire(new d.Event("moveend",o))}flyTo(o,c){if(!o.essential&&d.exported.prefersReducedMotion){const je=d.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(je,c)}this.stop(),o=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},o);const m=this.transform,y=this.getZoom(),x=this.getBearing(),E=this.getPitch(),C=this.getPadding(),P="zoom"in o?d.clamp(+o.zoom,m.minZoom,m.maxZoom):y,F="bearing"in o?this._normalizeBearing(o.bearing,x):x,R="pitch"in o?+o.pitch:E,O="padding"in o?o.padding:m.padding,j=m.zoomScale(P-y),Z=d.pointGeometry.convert(o.offset);let H=m.centerPoint.add(Z);const W=m.pointLocation(H),se=d.LngLat.convert(o.center||W);this._normalizeCenter(se);const G=m.project(W),ne=m.project(se).sub(G);let Q=o.curve;const te=Math.max(m.width,m.height),re=te/j,ae=ne.mag();if("minZoom"in o){const je=d.clamp(Math.min(o.minZoom,y,P),m.minZoom,m.maxZoom),ot=te/m.zoomScale(je-y);Q=Math.sqrt(ot/ae*2)}const _e=Q*Q;function xe(je){const ot=(re*re-te*te+(je?-1:1)*_e*_e*ae*ae)/(2*(je?re:te)*_e*ae);return Math.log(Math.sqrt(ot*ot+1)-ot)}function Ue(je){return(Math.exp(je)-Math.exp(-je))/2}function Le(je){return(Math.exp(je)+Math.exp(-je))/2}const ke=xe(0);let be=function(je){return Le(ke)/Le(ke+Q*je)},ve=function(je){return te*((Le(ke)*(Ue(ot=ke+Q*je)/Le(ot))-Ue(ke))/_e)/ae;var ot},Fe=(xe(1)-ke)/Q;if(Math.abs(ae)<1e-6||!isFinite(Fe)){if(Math.abs(te-re)<1e-6)return this.easeTo(o,c);const je=re<te?-1:1;Fe=Math.abs(Math.log(re/te))/Q,ve=function(){return 0},be=function(ot){return Math.exp(je*Q*ot)}}o.duration="duration"in o?+o.duration:1e3*Fe/("screenSpeed"in o?+o.screenSpeed/Q:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const Ie=x!==F,et=R!==E,at=!m.isPaddingEqual(O),Tt=je=>ot=>{const ft=ot*Fe,rn=1/be(ft);je.zoom=1===ot?P:y+je.scaleZoom(rn),Ie&&(je.bearing=d.number(x,F,ot)),et&&(je.pitch=d.number(E,R,ot)),at&&(je.interpolatePadding(C,O,ot),H=je.centerPoint.add(Z));const mn=1===ot?se:je.unproject(G.add(ne.mult(ve(ft))).mult(rn));return je.setLocationAtPoint(je.renderWorldCopies?mn.wrap():mn,H),je._updateCenterElevation(),o.preloadOnly||this._fireMoveEvents(c),je};if(o.preloadOnly){const je=this._emulate(Tt,o.duration,m);return this._preloadTiles(je),this}return this._zooming=!0,this._rotating=Ie,this._pitching=et,this._padding=at,this._prepareEase(c,!1),this._ease(Tt(m),()=>this._afterEase(c),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,c)}if(!o){const m=this.handlers;m&&m.stop(!1)}return this}_ease(o,c,m){!1===m.animate||0===m.duration?(o(1),c()):(this._easeStart=d.exported.now(),this._easeOptions=m,this._onEaseFrame=o,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((d.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,c){o=d.wrap(o,-180,180);const m=Math.abs(o-c);return Math.abs(o-360-c)<m&&(o-=360),Math.abs(o+360-c)<m&&(o+=360),o}_normalizeCenter(o){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const m=o.lng-c.center.lng;o.lng+=m>180?-360:m<-180?360:0}_emulate(o,c,m){const y=Math.ceil(15*c/1e3),x=[],E=o(m.clone());for(let C=0;C<=y;C++){const P=E(C/y);x.push(P.clone())}return x}}class Cu{constructor(o={}){this.options=o,d.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const c=this.options&&this.options.compact;return this._map=o,this._container=Ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ae.create("button","mapboxgl-ctrl-attrib-button",this._container),Ae.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ae.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,c){const m=this._map._getUIString(`AttributionControl.${c}`);o.setAttribute("aria-label",m),o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.config.ACCESS_TOKEN}];if(o){const m=c.reduce((y,x,E)=>(x.value&&(y+=`${x.key}=${x.value}${E<c.length-1?"&":""}`),y),"?");o.href=`${d.config.FEEDBACK_URL}/${m}${this._map._hash?this._map._hash.getHashString(!0):""}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||"metadata"!==o.sourceDataType&&"visibility"!==o.sourceDataType&&"style"!==o.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const c=this._map.style._sourceCaches;for(const y in c){const x=c[y];if(x.used){const E=x.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o.sort((y,x)=>y.length-x.length),o=o.filter((y,x)=>{for(let E=x+1;E<o.length;E++)if(o[E].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const m=o.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,o.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Mu{constructor(){d.bindAll(["_updateLogo"],this),d.bindAll(["_updateCompact"],this)}onAdd(o){this._map=o,this._container=Ae.create("div","mapboxgl-ctrl");const c=Ae.create("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&"metadata"!==o.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(0===Object.entries(o).length)return!0;for(const c in o){const m=o[c].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const c=o[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Iu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const c=++this._id;return this._queue.push({callback:o,id:c,cancelled:!1}),c}remove(o){const c=this._currentlyRunning,m=c?this._queue.concat(c):this._queue;for(const y of m)if(y.id===o)return void(y.cancelled=!0)}run(o=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const m of c)if(!m.cancelled&&(m.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Cc(f,o,c){if(f=new d.LngLat(f.lng,f.lat),o){const m=new d.LngLat(f.lng-360,f.lat),y=new d.LngLat(f.lng+360,f.lat),x=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),E=c.locationPoint(f).distSqr(o),C=o.x<0||o.y<0||o.x>c.width||o.y>c.height;c.locationPoint(m).distSqr(o)<E&&(C||Math.abs(m.lng-c.center.lng)<x)?f=m:c.locationPoint(y).distSqr(o)<E&&(C||Math.abs(y.lng-c.center.lng)<x)&&(f=y)}for(;Math.abs(f.lng-c.center.lng)>180;){const m=c.locationPoint(f);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const yr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Su extends d.Evented{constructor(o,c){if(super(),(o instanceof d.window.HTMLElement||c)&&(o=d.extend({element:o},c)),d.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&"auto"!==o.pitchAlignment?o.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),o&&o.element)this._element=o.element,this._offset=d.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ae.create("div");const y=41,x=27,E=Ae.createSVG("svg",{display:"block",height:y*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${y}`},this._element),C=Ae.createSVG("radialGradient",{id:"shadowGradient"},Ae.createSVG("defs",{},E));Ae.createSVG("stop",{offset:"10%","stop-opacity":.4},C),Ae.createSVG("stop",{offset:"100%","stop-opacity":.05},C),Ae.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),Ae.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),Ae.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),Ae.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=d.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const m=this._element.classList;for(const y in yr)m.remove(`mapboxgl-marker-anchor-${y}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=d.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(24.6+y)],"bottom-right":[-y,-1*(24.6+y)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const c=o.code,m=o.charCode||o.keyCode;"Space"!==c&&"Enter"!==c&&32!==m&&13!==m||this.togglePopup()}_onMapClick(o){const c=o.originalEvent.target,m=this._element;this._popup&&(c===m||m.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const o=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(o))return void this._clearFadeTimer();const c=this._map.unproject(o);let m=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const x=this._map.getFreeCameraOptions();if(x.position){const E=x.position.toLngLat();m=E.distanceTo(c)<.9*E.distanceTo(this._lngLat)}}const y=(1-this._map._queryFogOpacity(c))*(m?.2:1);this._element.style.opacity=`${y}`,this._popup&&this._popup._setOpacity(`${y}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(o){const c=this._map.transform;return!!o&&o.x>=0&&o.x<c.width&&o.y>=0&&o.y<c.height}_updateDOM(){const o=this._pos||new d.pointGeometry(0,0),c=this._calculatePitch(),m=this._calculateRotation();this._element.style.transform=`${yr[this._anchor]} translate(${o.x}px, ${o.y}px) rotateX(${c}deg) rotateZ(${m}deg)`}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(o){d.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=Cc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),!0===o?this._updateFrameId=d.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const o=this._map.transform,c=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&c._rotate(o.angle),"map"===this._pitchAlignment&&(c.y*=Math.cos(o._pitch)),c}getOffset(){return this._offset}setOffset(o){return this._offset=d.pointGeometry.convert(o),this._update(),this}_onMove(o){if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new d.Event("dragstart"))),this.fire(new d.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new d.Event("dragend")),this._state="inactive"}_addDragHandler(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&"auto"!==o?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Oe{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const c=d.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,c,m){this._start=this.getValue(c),this._end=o,this._startTime=c,this._endTime=c+m}}const Xt={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:zi,HTMLElement:Rn,ImageBitmap:ta}=d.window,Al={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Oi(f){f.parentNode&&f.parentNode.removeChild(f)}const Au={showCompass:!0,showZoom:!0,visualizePitch:!1};class Mc{constructor(o,c,m=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new oi({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,m&&(this.mousePitch=new wu({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),d.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(o,c){this.mouseRotate.mousedown(o,c),this.mousePitch&&this.mousePitch.mousedown(o,c),Ae.disableDrag()}move(o,c){const m=this.map,y=this.mouseRotate.mousemoveWindow(o,c);if(y&&y.bearingDelta&&m.setBearing(m.getBearing()+y.bearingDelta),this.mousePitch){const x=this.mousePitch.mousemoveWindow(o,c);x&&x.pitchDelta&&m.setPitch(m.getPitch()+x.pitchDelta)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ae.enableDrag(),d.window.removeEventListener("mousemove",this.mousemove),d.window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(d.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),Ae.mousePos(this.element,o)),d.window.addEventListener("mousemove",this.mousemove),d.window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,Ae.mousePos(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){1!==o.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ae.touchPos(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){1!==o.targetTouches.length?this.reset():(this._lastPos=Ae.touchPos(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){0===o.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Ic={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Hr,xs=0,Ho=!1;const ur={maxWidth:100,unit:"metric"};function Xe(f,o,c){const m=c&&c.maxWidth||100,y=f._containerHeight/2,x=f.unproject([0,y]),E=f.unproject([m,y]),C=x.distanceTo(E);if(c&&"imperial"===c.unit){const P=3.2808*C;P>5280?na(o,m,P/5280,f._getUIString("ScaleControl.Miles"),f):na(o,m,P,f._getUIString("ScaleControl.Feet"),f)}else c&&"nautical"===c.unit?na(o,m,C/1852,f._getUIString("ScaleControl.NauticalMiles"),f):C>=1e3?na(o,m,C/1e3,f._getUIString("ScaleControl.Kilometers"),f):na(o,m,C,f._getUIString("ScaleControl.Meters"),f)}function na(f,o,c,m,y){const x=function(C){const P=Math.pow(10,`${Math.floor(C)}`.length-1);let F=C/P;return F=F>=10?10:F>=5?5:F>=3?3:F>=2?2:F>=1?1:function(R){const O=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*O)/O}(F),P*F}(c),E=x/c;y._requestDomTask(()=>{f.style.width=o*E+"px",f.innerHTML=`${x}&nbsp;${m}`})}const ra={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Di=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),bs={version:d.version,supported:Jn,setRTLTextPlugin:d.setRTLTextPlugin,getRTLTextPluginStatus:d.getRTLTextPluginStatus,Map:class extends np{constructor(f){if(null!=(f=d.extend({},Al,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new vc(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._renderTaskQueue=new Iu,this._domRenderTaskQueue=new Iu,this._controls=[],this._markers=[],this._mapId=d.uniqueId(),this._locale=d.extend({},Xt,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Oe(0),this._requestManager=new d.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,"string"==typeof f.container){if(this._container=d.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof Rn))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&d.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),d.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==d.window&&(d.window.addEventListener("online",this._onWindowOnline,!1),d.window.addEventListener("resize",this._onWindowResize,!1),d.window.addEventListener("orientationchange",this._onWindowResize,!1),d.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new vs(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new Yd("string"==typeof f.hash&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,d.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new Cu({customAttribution:f.customAttribution})),this._logoControl=new Mu,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update("style"===o.dataType),this.fire(new d.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new d.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(f,o){if(void 0===o&&(o=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const m=this._controlPositions[o];return-1!==o.indexOf("bottom")?m.insertBefore(c,m.firstChild):m.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(f);return o>-1&&this._controls.splice(o,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new d.Event("movestart",f)).fire(new d.Event("move",f)),this.fire(new d.Event("resize",f)),o&&this.fire(new d.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(d.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=null==f?-2:f)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=null==f?22:f)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=null==f?0:f)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=null==f?85:f)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getProjection(){return this.transform.getProjection()}setProjection(f){return this._lazyInitEmptyStyle(),"string"==typeof f&&(f={name:f}),this._runtimeProjection=f,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(f){return this.transform.locationPoint3D(d.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(d.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(f,o,c){if("mouseenter"===f||"mouseover"===f){let m=!1;const y=E=>{const C=o.filter(F=>this.getLayer(F)),P=C.length?this.queryRenderedFeatures(E.point,{layers:C}):[];P.length?m||(m=!0,c.call(this,new Pr(f,this,E.originalEvent,{features:P}))):m=!1},x=()=>{m=!1};return{layers:new Set(o),listener:c,delegates:{mousemove:y,mouseout:x}}}if("mouseleave"===f||"mouseout"===f){let m=!1;const y=E=>{const C=o.filter(P=>this.getLayer(P));(C.length?this.queryRenderedFeatures(E.point,{layers:C}):[]).length?m=!0:m&&(m=!1,c.call(this,new Pr(f,this,E.originalEvent)))},x=E=>{m&&(m=!1,c.call(this,new Pr(f,this,E.originalEvent)))};return{layers:new Set(o),listener:c,delegates:{mousemove:y,mouseout:x}}}{const m=y=>{const x=o.filter(C=>this.getLayer(C)),E=x.length?this.queryRenderedFeatures(y.point,{layers:x}):[];E.length&&(y.features=E,c.call(this,y),delete y.features)};return{layers:new Set(o),listener:c,delegates:{[f]:m}}}}on(f,o,c){if(void 0===c)return super.on(f,o);Array.isArray(o)||(o=[o]);const m=this._createDelegatedListener(f,o,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(m);for(const y in m.delegates)this.on(y,m.delegates[y]);return this}once(f,o,c){if(void 0===c)return super.once(f,o);Array.isArray(o)||(o=[o]);const m=this._createDelegatedListener(f,o,c);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(f,o,c){if(void 0===c)return super.off(f,o);o=new Set(Array.isArray(o)?o:[o]);const m=(x,E)=>{if(x.size!==E.size)return!1;for(const C of x)if(!E.has(C))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[f]:void 0;return y&&(x=>{for(let E=0;E<x.length;E++){const C=x[E];if(C.listener===c&&m(C.layers,o)){for(const P in C.delegates)this.off(P,C.delegates[P]);return x.splice(E,1),this}}})(y),this}queryRenderedFeatures(f,o){return this.style?(void 0!==o||void 0===f||f instanceof d.pointGeometry||Array.isArray(f)||(o=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(f,o){return this.style.querySourceFeatures(f,o)}queryTerrainElevation(f,o){const c=this.transform.elevation;return c?(o=d.extend({},{exaggerated:!0},o),c.getAtPoint(d.MercatorCoordinate.fromLngLat(f),null,o.exaggerated)):null}setStyle(f,o){return!1!==(o=d.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(f,o))}_getUIString(f){const o=this._locale[f];if(null==o)throw new Error(`Missing UI string '${f}'`);return o}_updateStyle(f,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),f&&(this.style=new ri(this,o||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof f?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ri(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,o){if("string"==typeof f){const c=this._requestManager.normalizeStyleURL(f),m=this._requestManager.transformRequest(c,d.ResourceType.Style);d.getJSON(m,(y,x)=>{y?this.fire(new d.ErrorEvent(y)):x&&this._updateDiff(x,o)})}else"object"==typeof f&&this._updateDiff(f,o)}_updateDiff(f,o){try{this.style.setState(f)&&this._update(!0)}catch(c){d.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(f,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.warnOnce("There is no style added to the map.")}addSource(f,o){return this._lazyInitEmptyStyle(),this.style.addSource(f,o),this._update(!0)}isSourceLoaded(f){const o=this.style&&this.style._getSourceCaches(f);if(0!==o.length)return o.every(c=>c.loaded());this.fire(new d.ErrorEvent(new Error(`There is no source with ID '${f}'`)))}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const o in f){const c=f[o]._tiles;for(const m in c){const y=c[m];if("loaded"!==y.state&&"errored"!==y.state)return!1}}return!0}addSourceType(f,o,c){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,o,c)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,o,{pixelRatio:c=1,sdf:m=!1,stretchX:y,stretchY:x,content:E}={}){if(this._lazyInitEmptyStyle(),o instanceof zi||ta&&o instanceof ta){const{width:C,height:P,data:F}=d.exported.getImageData(o);this.style.addImage(f,{data:new d.RGBAImage({width:C,height:P},F),pixelRatio:c,stretchX:y,stretchY:x,content:E,sdf:m,version:0})}else{if(void 0===o.width||void 0===o.height)return this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:C,height:P,data:F}=o,R=o;this.style.addImage(f,{data:new d.RGBAImage({width:C,height:P},new Uint8Array(F)),pixelRatio:c,stretchX:y,stretchY:x,content:E,sdf:m,version:0,userImage:R}),R.onAdd&&R.onAdd(this,f)}}}updateImage(f,o){const c=this.style.getImage(f);if(!c)return this.fire(new d.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=o instanceof zi||ta&&o instanceof ta?d.exported.getImageData(o):o,{width:y,height:x,data:E}=m;return void 0===y||void 0===x?this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):y!==c.data.width||x!==c.data.height?this.fire(new d.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(c.data.replace(E,!(o instanceof zi||ta&&o instanceof ta)),void this.style.updateImage(f,c))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new d.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,o){d.getImage(this._requestManager.transformRequest(f,d.ResourceType.Image),(c,m)=>{o(c,m instanceof zi?d.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(f,o){return this._lazyInitEmptyStyle(),this.style.addLayer(f,o),this._update(!0)}moveLayer(f,o){return this.style.moveLayer(f,o),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,o,c){return this.style.setLayerZoomRange(f,o,c),this._update(!0)}setFilter(f,o,c={}){return this.style.setFilter(f,o,c),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,o,c,m={}){return this.style.setPaintProperty(f,o,c,m),this._update(!0)}getPaintProperty(f,o){return this.style.getPaintProperty(f,o)}setLayoutProperty(f,o,c,m={}){return this.style.setLayoutProperty(f,o,c,m),this._update(!0)}getLayoutProperty(f,o){return this.style.getLayoutProperty(f,o)}setLight(f,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){"globe"===this.transform.projection.name&&this.transform.zoom>=d.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(d.LngLat.convert(f),this.transform):0}setFeatureState(f,o){return this.style.setFeatureState(f,o),this._update()}removeFeatureState(f,o){return this.style.removeFeatureState(f,o),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let c,m=this._container;for(;m&&!c;){const y=d.window.getComputedStyle(m).transform;y&&"none"!==y&&(c=y.match(/matrix.*\((.+)\)/)[1].split(", ")),m=m.parentElement}c?(this._containerWidth=c[0]&&"0"!==c[0]?Math.abs(f/c[0]):f,this._containerHeight=c[3]&&"0"!==c[3]?Math.abs(o/c[3]):o):(this._containerWidth=f,this._containerHeight=o)}_detectMissingCSS(){"rgb(250, 128, 114)"!==d.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&d.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ae.create("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=Ae.create("div","mapboxgl-canvas-container",f);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=Ae.create("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=Ae.create("div","mapboxgl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=Ae.create("div",`mapboxgl-ctrl-${y}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,o){const c=d.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(o),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${o}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const o=this._markers.indexOf(f);-1!==o&&this._markers.splice(o,1)}_setupPainter(){const f=d.extend({},Jn.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);o?(d.storeAuthState(o,!0),this.painter=new Cl(o,this.transform),this.on("data",c=>{"source"===c.dataType&&this.painter.setTileLoadedFlag(!0)}),d.exported$1.testSupport(o)):this.fire(new d.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new d.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let o;const c=this.painter.context.extTimerQuery,m=d.exported.now();this.listens("gpu-timing-frame")&&(o=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,o));let y=this._updateAverageElevation(m);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjection();let x=!1;const E=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,F=this.transform.pitch,R=d.exported.now();this.style.zoomHistory.update(P,R);const O=new d.EvaluationParameters(P,{now:R,fadeDuration:E,pitch:F,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),j=O.crossFadingFactor();1===j&&j===this._crossFadingFactor||(x=!0,this._crossFadingFactor=j),this.style.update(O)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,E,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new d.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new d.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const P=d.exported.now()-m;c.endQueryEXT(c.TIME_ELAPSED_EXT,o),setTimeout(()=>{const F=c.getQueryObjectEXT(o,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(o),this.fire(new d.Event("gpu-timing-frame",{cpuTime:P,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(P);this.fire(new d.Event("gpu-timing-layer",{layerTimes:F}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(C||this._repaint)this.triggerRepaint();else{const P=!this.isMoving()&&this.loaded();if(P&&(y=this._updateAverageElevation(m,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new d.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new d.Event("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const f of this._markers)f._update()}_updateAverageElevation(f,o=!1){const c=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);if((o||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const m=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();isNaN(y)?y=0:this._averageElevationLastSampledAt=f;const x=Math.abs(m-y);if(x>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(y),c(y);this._averageElevation.easeTo(y,f,300)}else if(x>1e-4)return this._averageElevation.jumpTo(y),c(y)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){d.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===d.AUTH_ERR_MSG||401===f.status)){const o=this.painter.context.gl;d.storeAuthState(o,!1),this._logoControl instanceof Mu&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new d.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),d.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const c=this.painter.context.gl,m=c.createFramebuffer();function y(x){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,x,0);const E=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,E),E}return c.bindFramebuffer(c.FRAMEBUFFER,m),this._canvasPixelComparison(y(f),o.canvasCopies.map(y),o.timeStamps)}_canvasPixelComparison(f,o,c){let m=c[1]-c[0];const y=f.length/4;for(let x=0;x<o.length;x++){const E=o[x];let C=0;for(let P=0;P<E.length;P+=4)E[P]===f[P]&&E[P+1]===f[P+1]&&E[P+2]===f[P+2]&&E[P+3]===f[P+3]&&(C+=1);m+=(c[x+2]-c[x+1])*(1-C/y)}return m}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==d.window&&(d.window.removeEventListener("resize",this._onWindowResize,!1),d.window.removeEventListener("orientationchange",this._onWindowResize,!1),d.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),d.window.removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),Oi(this._canvasContainer),Oi(this._controlContainer),Oi(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),d.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new d.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=d.exported.frame(o=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(o)}))}_preloadTiles(f){const o=this.style&&Object.values(this.style._sourceCaches)||[];return d.asyncAll(o,(c,m)=>c._preloadTiles(f,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,o){d.setCacheLimits(f,o)}get version(){return d.version}},NavigationControl:class{constructor(f){this.options=d.extend({},Au,f),this._container=Ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(d.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),Ae.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),Ae.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(d.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=Ae.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const f=this._map.getZoom(),o=f===this._map.getMaxZoom(),c=f===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const f=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=f)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Mc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,o){const c=Ae.create("button",f,this._container);return c.type="button",c.addEventListener("click",o),c}_setButtonTitle(f,o){const c=this._map._getUIString(`NavigationControl.${o}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends d.Evented{constructor(f){super(),this.options=d.extend({},Ic,f),d.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Ys(this._updateMarkerRotation,20)}onAdd(f){var o;return this._map=f,this._container=Ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,void 0!==Hr?o(Hr):void 0!==d.window.navigator.permissions?d.window.navigator.permissions.query({name:"geolocation"}).then(c=>{Hr="denied"!==c.state,o(Hr)}):(Hr=!!d.window.navigator.geolocation,o(Hr)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,xs=0,Ho=!1}_isOutOfMapMaxBounds(f){const o=this._map.getMaxBounds(),c=f.coords;return o&&(c.longitude<o.getWest()||c.longitude>o.getEast()||c.latitude<o.getSouth()||c.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new d.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("geolocate",f)),this._finish()}}_updateCamera(f){const o=new d.LngLat(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,m=this._map.getBearing(),y=d.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(c),y,{geolocateSource:!0})}_updateMarker(f){if(f){const o=new d.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map._containerHeight/2,o=this._map.unproject([0,f]),c=this._map.unproject([100,f]),m=o.distanceTo(c)/100,y=Math.ceil(2*this._accuracy/m);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&Ho)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=Ae.create("button","mapboxgl-ctrl-geolocate",this._container),Ae.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===f){d.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ae.create("div","mapboxgl-user-location"),this._dotElement.appendChild(Ae.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ae.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Su({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ae.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Su({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||"ACTIVE_LOCK"!==this._watchState||o.originalEvent&&"resize"===o.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new d.Event("trackuserlocationend")))})}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:!0===f.absolute&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return d.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":xs--,Ho=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),xs++,xs>1?(f={maximumAge:6e5,timeout:0},Ho=!0):(f=this.options.positionOptions,Ho=!1),this._geolocationWatchID=d.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else d.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{d.window.addEventListener("ondeviceorientationabsolute"in d.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==d.window.DeviceMotionEvent&&"function"==typeof d.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(o=>{"granted"===o&&f()}).catch(console.error):f()}_clearWatch(){d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),d.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),d.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Cu,ScaleControl:class{constructor(f){this.options=d.extend({},ur,f),d.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Xe(this._map,this._container,this.options)}onAdd(f){return this._map=f,this._container=Ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(f){this.options.unit=f,Xe(this._map,this._container,this.options)}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof d.window.HTMLElement?this._container=f.container:d.warnOnce("Full screen control 'container' must be a DOM element.")),d.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in d.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in d.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,d.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!d.window.document.fullscreenEnabled&&!d.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Ae.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ae.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),d.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(d.window.document.fullscreenElement||d.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?d.window.document.exitFullscreen?d.window.document.exitFullscreen():d.window.document.webkitCancelFullScreen&&d.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends d.Evented{constructor(f){super(),this.options=d.extend(Object.create(ra),f),d.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new d.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new d.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=d.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(d.window.document.createTextNode(f))}setHTML(f){const o=d.window.document.createDocumentFragment(),c=d.window.document.createElement("body");let m;for(c.innerHTML=f;m=c.firstChild,m;)o.appendChild(m);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Ae.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._container&&this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._container&&this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let o;return this._classList.delete(f)?o=!1:(this._classList.add(f),o=!0),this._container&&this._updateClassList(),o}_createCloseButton(){this.options.closeButton&&(this._closeButton=Ae.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(f){this._update(f.point)}_onMouseMove(f){this._update(f.point)}_onDrag(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const o=this._pos,c=this._container.offsetWidth,m=this._container.offsetHeight;let y;return y=o.y+f.bottom.y<m?["top"]:o.y>this._map.transform.height-m?["bottom"]:[],o.x<c/2?y.push("left"):o.x>this._map.transform.width-c/2&&y.push("right"),0===y.length?"bottom":y.join("-")}_updateClassList(){const f=[...this._classList];f.push("mapboxgl-popup"),this._anchor&&f.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&f.push("mapboxgl-popup-track-pointer"),this._container.className=f.join(" ")}_update(f){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=Ae.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Ae.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Cc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f){const o=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),c=function(x){if(x||(x=new d.pointGeometry(0,0)),"number"==typeof x){const E=Math.round(Math.sqrt(.5*Math.pow(x,2)));return{center:new d.pointGeometry(0,0),top:new d.pointGeometry(0,x),"top-left":new d.pointGeometry(E,E),"top-right":new d.pointGeometry(-E,E),bottom:new d.pointGeometry(0,-x),"bottom-left":new d.pointGeometry(E,-E),"bottom-right":new d.pointGeometry(-E,-E),left:new d.pointGeometry(x,0),right:new d.pointGeometry(-x,0)}}if(x instanceof d.pointGeometry||Array.isArray(x)){const E=d.pointGeometry.convert(x);return{center:E,top:E,"top-left":E,"top-right":E,bottom:E,"bottom-left":E,"bottom-right":E,left:E,right:E}}return{center:d.pointGeometry.convert(x.center||[0,0]),top:d.pointGeometry.convert(x.top||[0,0]),"top-left":d.pointGeometry.convert(x["top-left"]||[0,0]),"top-right":d.pointGeometry.convert(x["top-right"]||[0,0]),bottom:d.pointGeometry.convert(x.bottom||[0,0]),"bottom-left":d.pointGeometry.convert(x["bottom-left"]||[0,0]),"bottom-right":d.pointGeometry.convert(x["bottom-right"]||[0,0]),left:d.pointGeometry.convert(x.left||[0,0]),right:d.pointGeometry.convert(x.right||[0,0])}}(this.options.offset),m=this._anchor=this._getAnchor(c),y=o.add(c[m]).round();this._map._requestDomTask(()=>{this._container&&m&&(this._container.style.transform=`${yr[m]} translate(${y.x}px,${y.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Di);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._content&&(this._content.style.opacity=f),this._tip&&(this._tip.style.opacity=f)}},Marker:Su,Style:ri,LngLat:d.LngLat,LngLatBounds:d.LngLatBounds,Point:d.pointGeometry,MercatorCoordinate:d.MercatorCoordinate,FreeCameraOptions:Th,Evented:d.Evented,config:d.config,prewarm:function(){ue().acquire(le)},clearPrewarmedResources:function(){const f=fe;f&&(f.isPreloaded()&&1===f.numActive()?(f.release(le),fe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return d.config.ACCESS_TOKEN},set accessToken(f){d.config.ACCESS_TOKEN=f},get baseApiUrl(){return d.config.API_URL},set baseApiUrl(f){d.config.API_URL=f},get workerCount(){return me.workerCount},set workerCount(f){me.workerCount=f},get maxParallelImageRequests(){return d.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){d.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){d.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:d.exported.setNow,restoreNow:d.exported.restoreNow};return bs}),Bn}()}},Ud=>{Ud(Ud.s=196)}]);