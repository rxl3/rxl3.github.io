(self.webpackChunkpcmap=self.webpackChunkpcmap||[]).push([[179],{89:(rp,yc,vc)=>{"use strict";function jn(e){return"function"==typeof e}function Fh(e){const r=e(a=>{Error.call(a),a.stack=(new Error).stack});return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}const ip=Fh(e=>function(r){e(this),this.message=r?`${r.length} errors occurred during unsubscription:\n${r.map((a,u)=>`${u+1}) ${a.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=r});function d(e,t){if(e){const r=e.indexOf(t);0<=r&&e.splice(r,1)}}class Zn{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:r}=this;if(r)if(this._parentage=null,Array.isArray(r))for(const m of r)m.remove(this);else r.remove(this);const{initialTeardown:a}=this;if(jn(a))try{a()}catch(m){t=m instanceof ip?m.errors:[m]}const{_teardowns:u}=this;if(u){this._teardowns=null;for(const m of u)try{Ke(m)}catch(b){t=null!=t?t:[],b instanceof ip?t=[...t,...b.errors]:t.push(b)}}if(t)throw new ip(t)}}add(t){var r;if(t&&t!==this)if(this.closed)Ke(t);else{if(t instanceof Zn){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=null!==(r=this._teardowns)&&void 0!==r?r:[]).push(t)}}_hasParent(t){const{_parentage:r}=this;return r===t||Array.isArray(r)&&r.includes(t)}_addParent(t){const{_parentage:r}=this;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t}_removeParent(t){const{_parentage:r}=this;r===t?this._parentage=null:Array.isArray(r)&&d(r,t)}remove(t){const{_teardowns:r}=this;r&&d(r,t),t instanceof Zn&&t._removeParent(this)}}Zn.EMPTY=(()=>{const e=new Zn;return e.closed=!0,e})();const jo=Zn.EMPTY;function ui(e){return e instanceof Zn||e&&"closed"in e&&jn(e.remove)&&jn(e.add)&&jn(e.unsubscribe)}function Ke(e){jn(e)?e():e.unsubscribe()}const vt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ae={setTimeout(...e){const{delegate:t}=Ae;return((null==t?void 0:t.setTimeout)||setTimeout)(...e)},clearTimeout(e){const{delegate:t}=Ae;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Ti(e){Ae.setTimeout(()=>{const{onUnhandledError:t}=vt;if(!t)throw e;t(e)})}function Sn(){}const xl=eo("C",void 0,void 0);function eo(e,t,r){return{kind:e,value:t,error:r}}let xr=null;function Uo(e){if(vt.useDeprecatedSynchronousErrorHandling){const t=!xr;if(t&&(xr={errorThrown:!1,error:null}),e(),t){const{errorThrown:r,error:a}=xr;if(xr=null,r)throw a}}else e()}class Go extends Zn{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,ui(t)&&t.add(this)):this.destination=El}static create(t,r,a){return new Bs(t,r,a)}next(t){this.isStopped?to(function bl(e){return eo("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?to(function hi(e){return eo("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?to(xl,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class Bs extends Go{constructor(t,r,a){let u;if(super(),jn(t))u=t;else if(t){let m;({next:u,error:r,complete:a}=t),this&&vt.useDeprecatedNextContext?(m=Object.create(t),m.unsubscribe=()=>this.unsubscribe()):m=t,u=null==u?void 0:u.bind(m),r=null==r?void 0:r.bind(m),a=null==a?void 0:a.bind(m)}this.destination={next:u?$o(u):Sn,error:$o(null!=r?r:wl),complete:a?$o(a):Sn}}}function $o(e,t){return(...r)=>{try{e(...r)}catch(a){vt.useDeprecatedSynchronousErrorHandling?function yo(e){vt.useDeprecatedSynchronousErrorHandling&&xr&&(xr.errorThrown=!0,xr.error=e)}(a):Ti(a)}}}function wl(e){throw e}function to(e,t){const{onStoppedNotification:r}=vt;r&&Ae.setTimeout(()=>r(e,t))}const El={closed:!0,next:Sn,error:wl,complete:Sn},fs="function"==typeof Symbol&&Symbol.observable||"@@observable";function vo(e){return e}let xn=(()=>{class e{constructor(r){r&&(this._subscribe=r)}lift(r){const a=new e;return a.source=this,a.operator=r,a}subscribe(r,a,u){const m=function Ra(e){return e&&e instanceof Go||function xo(e){return e&&jn(e.next)&&jn(e.error)&&jn(e.complete)}(e)&&ui(e)}(r)?r:new Bs(r,a,u);return Uo(()=>{const{operator:b,source:D}=this;m.add(b?b.call(m,D):D?this._subscribe(m):this._trySubscribe(m))}),m}_trySubscribe(r){try{return this._subscribe(r)}catch(a){r.error(a)}}forEach(r,a){return new(a=Ns(a))((u,m)=>{let b;b=this.subscribe(D=>{try{r(D)}catch(M){m(M),null==b||b.unsubscribe()}},m,u)})}_subscribe(r){var a;return null===(a=this.source)||void 0===a?void 0:a.subscribe(r)}[fs](){return this}pipe(...r){return function no(e){return 0===e.length?vo:1===e.length?e[0]:function(r){return e.reduce((a,u)=>u(a),r)}}(r)(this)}toPromise(r){return new(r=Ns(r))((a,u)=>{let m;this.subscribe(b=>m=b,b=>u(b),()=>a(m))})}}return e.create=t=>new e(t),e})();function Ns(e){var t;return null!==(t=null!=e?e:vt.Promise)&&void 0!==t?t:Promise}const Ht=Fh(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Vs=(()=>{class e extends xn{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(r){const a=new ms(this,this);return a.operator=r,a}_throwIfClosed(){if(this.closed)throw new Ht}next(r){Uo(()=>{if(this._throwIfClosed(),!this.isStopped){const a=this.observers.slice();for(const u of a)u.next(r)}})}error(r){Uo(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=r;const{observers:a}=this;for(;a.length;)a.shift().error(r)}})}complete(){Uo(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:r}=this;for(;r.length;)r.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var r;return(null===(r=this.observers)||void 0===r?void 0:r.length)>0}_trySubscribe(r){return this._throwIfClosed(),super._trySubscribe(r)}_subscribe(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)}_innerSubscribe(r){const{hasError:a,isStopped:u,observers:m}=this;return a||u?jo:(m.push(r),new Zn(()=>d(m,r)))}_checkFinalizedStatuses(r){const{hasError:a,thrownError:u,isStopped:m}=this;a?r.error(u):m&&r.complete()}asObservable(){const r=new xn;return r.source=this,r}}return e.create=(t,r)=>new ms(t,r),e})();class ms extends Vs{constructor(t,r){super(),this.destination=t,this.source=r}next(t){var r,a;null===(a=null===(r=this.destination)||void 0===r?void 0:r.next)||void 0===a||a.call(r,t)}error(t){var r,a;null===(a=null===(r=this.destination)||void 0===r?void 0:r.error)||void 0===a||a.call(r,t)}complete(){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===r||r.call(t)}_subscribe(t){var r,a;return null!==(a=null===(r=this.source)||void 0===r?void 0:r.subscribe(t))&&void 0!==a?a:jo}}function ro(e){return t=>{if(function js(e){return jn(null==e?void 0:e.lift)}(t))return t.lift(function(r){try{return e(r,this)}catch(a){this.error(a)}});throw new TypeError("Unable to lift unknown Observable type")}}class Wr extends Go{constructor(t,r,a,u,m){super(t),this.onFinalize=m,this._next=r?function(b){try{r(b)}catch(D){t.error(D)}}:super._next,this._error=u?function(b){try{u(b)}catch(D){t.error(D)}finally{this.unsubscribe()}}:super._error,this._complete=a?function(){try{a()}catch(b){t.error(b)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;const{closed:r}=this;super.unsubscribe(),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}function zr(e,t){return ro((r,a)=>{let u=0;r.subscribe(new Wr(a,m=>{a.next(e.call(t,m,u++))}))})}function Bi(e){return this instanceof Bi?(this.v=e,this):new Bi(e)}function Un(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,a=r.apply(e,t||[]),m=[];return u={},b("next"),b("throw"),b("return"),u[Symbol.asyncIterator]=function(){return this},u;function b(Y){a[Y]&&(u[Y]=function(ae){return new Promise(function(ye,Oe){m.push([Y,ae,ye,Oe])>1||D(Y,ae)})})}function D(Y,ae){try{!function M(Y){Y.value instanceof Bi?Promise.resolve(Y.value.v).then(k,B):G(m[0][2],Y)}(a[Y](ae))}catch(ye){G(m[0][3],ye)}}function k(Y){D("next",Y)}function B(Y){D("throw",Y)}function G(Y,ae){Y(ae),m.shift(),m.length&&D(m[0][0],m[0][1])}}function Tl(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function za(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],a=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r);function a(m){r[m]=e[m]&&function(b){return new Promise(function(D,M){!function u(m,b,D,M){Promise.resolve(M).then(function(k){m({value:k,done:D})},b)}(D,M,(b=e[m](b)).done,b.value)})}}}const Hs=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Si(e){return jn(null==e?void 0:e.then)}function Il(e){return jn(e[fs])}function An(e){return Symbol.asyncIterator&&jn(null==e?void 0:e[Symbol.asyncIterator])}function Ii(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const io=function Na(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function qs(e){return jn(null==e?void 0:e[io])}function _s(e){return Un(this,arguments,function*(){const r=e.getReader();try{for(;;){const{value:a,done:u}=yield Bi(r.read());if(u)return yield Bi(void 0);yield yield Bi(a)}}finally{r.releaseLock()}})}function bo(e){return jn(null==e?void 0:e.getReader)}function Pr(e){if(e instanceof xn)return e;if(null!=e){if(Il(e))return function ys(e){return new xn(t=>{const r=e[fs]();if(jn(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Hs(e))return function wo(e){return new xn(t=>{for(let r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}(e);if(Si(e))return function Va(e){return new xn(t=>{e.then(r=>{t.closed||(t.next(r),t.complete())},r=>t.error(r)).then(null,Ti)})}(e);if(An(e))return K(e);if(qs(e))return function Ai(e){return new xn(t=>{for(const r of e)if(t.next(r),t.closed)return;t.complete()})}(e);if(bo(e))return function L(e){return K(_s(e))}(e)}throw Ii(e)}function K(e){return new xn(t=>{(function V(e,t){var r,a,u,m;return function Mi(e,t,r,a){return new(r||(r=Promise))(function(m,b){function D(B){try{k(a.next(B))}catch(G){b(G)}}function M(B){try{k(a.throw(B))}catch(G){b(G)}}function k(B){B.done?m(B.value):function u(m){return m instanceof r?m:new r(function(b){b(m)})}(B.value).then(D,M)}k((a=a.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(r=Tl(e);!(a=yield r.next()).done;)if(t.next(a.value),t.closed)return}catch(b){u={error:b}}finally{try{a&&!a.done&&(m=r.return)&&(yield m.call(r))}finally{if(u)throw u.error}}t.complete()})})(e,t).catch(r=>t.error(r))})}function X(e,t,r,a=0,u=!1){const m=t.schedule(function(){r(),u?e.add(this.schedule(null,a)):this.unsubscribe()},a);if(e.add(m),!u)return m}function le(e,t,r=1/0){return jn(t)?le((a,u)=>zr((m,b)=>t(a,m,u,b))(Pr(e(a,u))),r):("number"==typeof t&&(r=t),ro((a,u)=>function Q(e,t,r,a,u,m,b,D){const M=[];let k=0,B=0,G=!1;const Y=()=>{G&&!M.length&&!k&&t.complete()},ae=Oe=>k<a?ye(Oe):M.push(Oe),ye=Oe=>{m&&t.next(Oe),k++;let He=!1;Pr(r(Oe,B++)).subscribe(new Wr(t,$e=>{null==u||u($e),m?ae($e):t.next($e)},()=>{He=!0},void 0,()=>{if(He)try{for(k--;M.length&&k<a;){const $e=M.shift();b?X(t,b,()=>ye($e)):ye($e)}Y()}catch($e){t.error($e)}}))};return e.subscribe(new Wr(t,ae,()=>{G=!0,Y()})),()=>{null==D||D()}}(a,u,e,r)))}const fe=new xn(e=>e.complete());function Ie(e){return e[e.length-1]}function Le(e){return jn(Ie(e))?e.pop():void 0}function rt(e){return function Te(e){return e&&jn(e.schedule)}(Ie(e))?e.pop():void 0}function ct(e,t=0){return ro((r,a)=>{r.subscribe(new Wr(a,u=>X(a,e,()=>a.next(u),t),()=>X(a,e,()=>a.complete(),t),u=>X(a,e,()=>a.error(u),t)))})}function ht(e,t=0){return ro((r,a)=>{a.add(e.schedule(()=>r.subscribe(a),t))})}function Tn(e,t){if(!e)throw new Error("Iterable cannot be null");return new xn(r=>{X(r,t,()=>{const a=e[Symbol.asyncIterator]();X(r,t,()=>{a.next().then(u=>{u.done?r.complete():r.next(u.value)})},0,!0)})})}function $n(e,t){return t?function Ho(e,t){if(null!=e){if(Il(e))return function Pt(e,t){return Pr(e).pipe(ht(t),ct(t))}(e,t);if(Hs(e))return function In(e,t){return new xn(r=>{let a=0;return t.schedule(function(){a===e.length?r.complete():(r.next(e[a++]),r.closed||this.schedule())})})}(e,t);if(Si(e))return function bn(e,t){return Pr(e).pipe(ht(t),ct(t))}(e,t);if(An(e))return Tn(e,t);if(qs(e))return function gn(e,t){return new xn(r=>{let a;return X(r,t,()=>{a=e[io](),X(r,t,()=>{let u,m;try{({value:u,done:m}=a.next())}catch(b){return void r.error(b)}m?r.complete():r.next(u)},0,!0)}),()=>jn(null==a?void 0:a.return)&&a.return()})}(e,t);if(bo(e))return function vs(e,t){return Tn(_s(e),t)}(e,t)}throw Ii(e)}(e,t):Pr(e)}function Al(e,t,...r){return!0===t?(e(),null):!1===t?null:t(...r).pipe(function Cc(e){return e<=0?()=>fe:ro((t,r)=>{let a=0;t.subscribe(new Wr(r,u=>{++a<=e&&(r.next(u),e<=a&&r.complete())}))})}(1)).subscribe(()=>e())}function un(e){for(let t in e)if(e[t]===un)return t;throw Error("Could not find renamed property on target object.")}function Pl(e,t){for(const r in t)t.hasOwnProperty(r)&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function an(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(an).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const r=t.indexOf("\n");return-1===r?t:t.substring(0,r)}function ja(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const kl=un({__forward_ref__:un});function wn(e){return e.__forward_ref__=wn,e.toString=function(){return an(this())},e}function gt(e){return Ua(e)?e():e}function Ua(e){return"function"==typeof e&&e.hasOwnProperty(kl)&&e.__forward_ref__===wn}class en extends Error{constructor(t,r){super(function Dc(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,r)),this.code=t}}function xt(e){return"string"==typeof e?e:null==e?"":String(e)}function tr(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():xt(e)}function Zs(e,t){const r=t?` in ${t}`:"";throw new en(-201,`No provider for ${tr(e)} found${r}`)}function _t(e,t){null==e&&function ot(e,t,r,a){throw new Error(`ASSERTION ERROR: ${e}`+(null==a?"":` [Expected=> ${r} ${a} ${t} <=Actual]`))}(t,e,null,"!=")}function tn(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Xr(e){return{providers:e.providers||[],imports:e.imports||[]}}function di(e){return Pn(e,Wo)||Pn(e,Ks)}function Pn(e,t){return e.hasOwnProperty(t)?e[t]:null}function Ll(e){return e&&(e.hasOwnProperty(Es)||e.hasOwnProperty(Wt))?e[Es]:null}const Wo=un({\u0275prov:un}),Es=un({\u0275inj:un}),Ks=un({ngInjectableDef:un}),Wt=un({ngInjectorDef:un});var Et=(()=>((Et=Et||{})[Et.Default=0]="Default",Et[Et.Host=1]="Host",Et[Et.Self=2]="Self",Et[Et.SkipSelf=4]="SkipSelf",Et[Et.Optional=8]="Optional",Et))();let Ol;function pr(e){const t=Ol;return Ol=e,t}function bu(e,t,r){const a=di(e);return a&&"root"==a.providedIn?void 0===a.value?a.value=a.factory():a.value:r&Et.Optional?null:void 0!==t?t:void Zs(an(e),"Injector")}function En(e){return{toString:e}.toString()}var Kr=(()=>((Kr=Kr||{})[Kr.OnPush=0]="OnPush",Kr[Kr.Default=1]="Default",Kr))(),Pi=(()=>{return(e=Pi||(Pi={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",Pi;var e})();const Vi="undefined"!=typeof globalThis&&globalThis,Do="undefined"!=typeof window&&window,Ys="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,qt=Vi||"undefined"!=typeof global&&global||Do||Ys,br={},hn=[],oo=un({\u0275cmp:un}),Ga=un({\u0275dir:un}),Qs=un({\u0275pipe:un}),Eu=un({\u0275mod:un}),To=un({\u0275fac:un}),ea=un({__NG_ELEMENT_ID__:un});let Oh=0;function $a(e){return En(()=>{const r={},a={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:r,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Kr.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||hn,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||Pi.Emulated,id:"c",styles:e.styles||hn,_:null,setInput:null,schemas:e.schemas||null,tView:null},u=e.directives,m=e.features,b=e.pipes;return a.id+=Oh++,a.inputs=Tu(e.inputs,r),a.outputs=Tu(e.outputs),m&&m.forEach(D=>D(a)),a.directiveDefs=u?()=>("function"==typeof u?u():u).map(Cu):null,a.pipeDefs=b?()=>("function"==typeof b?b():b).map(zh):null,a})}function Cu(e){return Xn(e)||function ji(e){return e[Ga]||null}(e)}function zh(e){return function ao(e){return e[Qs]||null}(e)}const Tc={};function so(e){return En(()=>{const t={type:e.type,bootstrap:e.bootstrap||hn,declarations:e.declarations||hn,imports:e.imports||hn,exports:e.exports||hn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(Tc[e.id]=e.type),t})}function Tu(e,t){if(null==e)return br;const r={};for(const a in e)if(e.hasOwnProperty(a)){let u=e[a],m=u;Array.isArray(u)&&(m=u[1],u=u[0]),r[u]=a,t&&(t[u]=m)}return r}const Dt=$a;function Xn(e){return e[oo]||null}function Jr(e,t){const r=e[Eu]||null;if(!r&&!0===t)throw new Error(`Type ${an(e)} does not have '\u0275mod' property.`);return r}function Fi(e){return Array.isArray(e)&&"object"==typeof e[1]}function wr(e){return Array.isArray(e)&&!0===e[1]}function sa(e){return 0!=(8&e.flags)}function zl(e){return 2==(2&e.flags)}function aa(e){return 1==(1&e.flags)}function Er(e){return null!==e.template}function Nh(e){return 0!=(512&e[2])}function Ao(e,t){return e.hasOwnProperty(To)?e[To]:null}class mp{constructor(t,r,a){this.previousValue=t,this.currentValue=r,this.firstChange=a}isFirstChange(){return this.firstChange}}function Po(){return qh}function qh(e){return e.type.prototype.ngOnChanges&&(e.setInput=Za),ku}function ku(){const e=Xa(this),t=null==e?void 0:e.current;if(t){const r=e.previous;if(r===br)e.previous=t;else for(let a in t)r[a]=t[a];e.current=null,this.ngOnChanges(t)}}function Za(e,t,r,a){const u=Xa(e)||function Fu(e,t){return e[Wa]=t}(e,{previous:br,current:null}),m=u.current||(u.current={}),b=u.previous,D=this.declaredInputs[r],M=b[D];m[D]=new mp(M&&M.currentValue,t,b===br),e[a]=t}Po.ngInherit=!0;const Wa="__ngSimpleChanges__";function Xa(e){return e[Wa]||null}let Nl;function Fn(e){return!!e.listen}const Ou={createRenderer:(e,t)=>function Ja(){return void 0!==Nl?Nl:"undefined"!=typeof document?document:void 0}()};function ir(e){for(;Array.isArray(e);)e=e[0];return e}function ca(e,t){return ir(t[e])}function gi(e,t){return ir(t[e.index])}function Rc(e,t){return e.data[t]}function Qr(e,t){const r=t[e];return Fi(r)?r:r[0]}function ua(e){return 128==(128&e[2])}function Qo(e,t){return null==t?null:e[t]}function Qa(e){e[18]=0}function Ms(e,t){e[5]+=t;let r=e,a=e[3];for(;null!==a&&(1===t&&1===r[5]||-1===t&&0===r[5]);)a[5]+=t,r=a,a=a[3]}const bt={lFrame:z(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Lc(){return bt.bindingsEnabled}function ze(){return bt.lFrame.lView}function Qt(){return bt.lFrame.tView}function ei(e){return bt.lFrame.contextLView=e,e[8]}function zn(){let e=ha();for(;null!==e&&64===e.type;)e=e.parent;return e}function ha(){return bt.lFrame.currentTNode}function Gi(e,t){const r=bt.lFrame;r.currentTNode=e,r.isParent=t}function Uu(){return bt.lFrame.isParent}function Oc(){bt.lFrame.isParent=!1}function Ss(){return bt.isInCheckNoChangesMode}function es(e){bt.isInCheckNoChangesMode=e}function pa(){return bt.lFrame.bindingIndex++}function o(e,t){const r=bt.lFrame;r.bindingIndex=r.bindingRootIndex=e,g(t)}function g(e){bt.lFrame.currentDirectiveIndex=e}function E(e){bt.lFrame.currentQueryIndex=e}function T(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function P(e,t,r){if(r&Et.SkipSelf){let u=t,m=e;for(;!(u=u.parent,null!==u||r&Et.Host||(u=T(m),null===u||(m=m[15],10&u.type))););if(null===u)return!1;t=u,e=m}const a=bt.lFrame=R();return a.currentTNode=t,a.lView=e,!0}function F(e){const t=R(),r=e[1];bt.lFrame=t,t.currentTNode=r.firstChild,t.lView=e,t.tView=r,t.contextLView=e,t.bindingIndex=r.bindingStartIndex,t.inI18n=!1}function R(){const e=bt.lFrame,t=null===e?null:e.child;return null===t?z(e):t}function z(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function j(){const e=bt.lFrame;return bt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Z=j;function H(){const e=j();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function $(){return bt.lFrame.selectedIndex}function ne(e){bt.lFrame.selectedIndex=e}function Re(e,t){for(let r=t.directiveStart,a=t.directiveEnd;r<a;r++){const m=e.data[r].type.prototype,{ngAfterContentInit:b,ngAfterContentChecked:D,ngAfterViewInit:M,ngAfterViewChecked:k,ngOnDestroy:B}=m;b&&(e.contentHooks||(e.contentHooks=[])).push(-r,b),D&&((e.contentHooks||(e.contentHooks=[])).push(r,D),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(r,D)),M&&(e.viewHooks||(e.viewHooks=[])).push(-r,M),k&&((e.viewHooks||(e.viewHooks=[])).push(r,k),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(r,k)),null!=B&&(e.destroyHooks||(e.destroyHooks=[])).push(r,B)}}function ke(e,t,r){Fe(e,t,3,r)}function be(e,t,r,a){(3&e[2])===r&&Fe(e,t,r,a)}function ve(e,t){let r=e[2];(3&r)===t&&(r&=2047,r+=1,e[2]=r)}function Fe(e,t,r,a){const m=null!=a?a:-1,b=t.length-1;let D=0;for(let M=void 0!==a?65535&e[18]:0;M<b;M++)if("number"==typeof t[M+1]){if(D=t[M],null!=a&&D>=a)break}else t[M]<0&&(e[18]+=65536),(D<m||-1==m)&&(Me(e,r,t,M),e[18]=(4294901760&e[18])+M+2),M++}function Me(e,t,r,a){const u=r[a]<0,m=r[a+1],D=e[u?-r[a]:r[a]];if(u){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{m.call(D)}finally{}}}else try{m.call(D)}finally{}}class lt{constructor(t,r,a){this.factory=t,this.resolving=!1,this.canSeeViewProviders=r,this.injectImpl=a}}function yn(e,t,r){const a=Fn(e);let u=0;for(;u<r.length;){const m=r[u];if("number"==typeof m){if(0!==m)break;u++;const b=r[u++],D=r[u++],M=r[u++];a?e.setAttribute(t,D,M,b):t.setAttributeNS(b,D,M)}else{const b=m,D=r[++u];Vr(b)?a&&e.setProperty(t,b,D):a?e.setAttribute(t,b,D):t.setAttribute(b,D),u++}}return u}function Jn(e){return 3===e||4===e||6===e}function Vr(e){return 64===e.charCodeAt(0)}function ni(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let r=-1;for(let a=0;a<t.length;a++){const u=t[a];"number"==typeof u?r=u:0===r||$i(e,r,u,null,-1===r||2===r?t[++a]:null)}}return e}function $i(e,t,r,a,u){let m=0,b=e.length;if(-1===t)b=-1;else for(;m<e.length;){const D=e[m++];if("number"==typeof D){if(D===t){b=-1;break}if(D>t){b=m-1;break}}}for(;m<e.length;){const D=e[m];if("number"==typeof D)break;if(D===r){if(null===a)return void(null!==u&&(e[m+1]=u));if(a===e[m+1])return void(e[m+2]=u)}m++,null!==a&&m++,null!==u&&m++}-1!==b&&(e.splice(b,0,t),m=b+1),e.splice(m++,0,r),null!==a&&e.splice(m++,0,a),null!==u&&e.splice(m++,0,u)}function Ut(e){return-1!==e}function ft(e){return 32767&e}function Dn(e,t){let r=function Bt(e){return e>>16}(e),a=t;for(;r>0;)a=a[15],r--;return a}let ri=!0;function pn(e){const t=ri;return ri=e,t}let fa=0;function at(e,t){const r=ts(e,t);if(-1!==r)return r;const a=t[1];a.firstCreatePass&&(e.injectorIndex=t.length,or(a.data,e),or(t,null),or(a.blueprint,null));const u=co(e,t),m=e.injectorIndex;if(Ut(u)){const b=ft(u),D=Dn(u,t),M=D[1].data;for(let k=0;k<8;k++)t[m+k]=D[b+k]|M[b+k]}return t[m+8]=u,m}function or(e,t){e.push(0,0,0,0,0,0,0,0,t)}function ts(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function co(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let r=0,a=null,u=t;for(;null!==u;){const m=u[1],b=m.type;if(a=2===b?m.declTNode:1===b?u[6]:null,null===a)return-1;if(r++,u=u[15],-1!==a.injectorIndex)return a.injectorIndex|r<<16}return-1}function sr(e,t,r){!function nt(e,t,r){let a;"string"==typeof r?a=r.charCodeAt(0)||0:r.hasOwnProperty(ea)&&(a=r[ea]),null==a&&(a=r[ea]=fa++);const u=255&a;t.data[e+(u>>5)]|=1<<u}(e,t,r)}function nm(e,t,r){if(r&Et.Optional)return e;Zs(t,"NodeInjector")}function Bc(e,t,r,a){if(r&Et.Optional&&void 0===a&&(a=null),0==(r&(Et.Self|Et.Host))){const u=e[9],m=pr(void 0);try{return u?u.get(t,a,r&Et.Optional):bu(t,a,r&Et.Optional)}finally{pr(m)}}return nm(a,t,r)}function Hn(e,t,r,a=Et.Default,u){if(null!==e){const m=function Vc(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(ea)?e[ea]:void 0;return"number"==typeof t?t>=0?255&t:rm:t}(r);if("function"==typeof m){if(!P(t,e,a))return a&Et.Host?nm(u,r,a):Bc(t,r,a,u);try{const b=m(a);if(null!=b||a&Et.Optional)return b;Zs(r)}finally{Z()}}else if("number"==typeof m){let b=null,D=ts(e,t),M=-1,k=a&Et.Host?t[16][6]:null;for((-1===D||a&Et.SkipSelf)&&(M=-1===D?co(e,t):t[D+8],-1!==M&&Gu(a,!1)?(b=t[1],D=ft(M),t=Dn(M,t)):D=-1);-1!==D;){const B=t[1];if(ga(m,D,B.data)){const G=Nc(D,t,r,b,a,k);if(G!==Rn)return G}M=t[D+8],-1!==M&&Gu(a,t[1].data[D+8]===k)&&ga(m,D,t)?(b=B,D=ft(M),t=Dn(M,t)):D=-1}}}return Bc(t,r,a,u)}const Rn={};function rm(){return new tl(zn(),ze())}function Nc(e,t,r,a,u,m){const b=t[1],D=b.data[e+8],B=function ma(e,t,r,a,u){const m=e.providerIndexes,b=t.data,D=1048575&m,M=e.directiveStart,B=m>>20,Y=u?D+B:e.directiveEnd;for(let ae=a?D:D+B;ae<Y;ae++){const ye=b[ae];if(ae<M&&r===ye||ae>=M&&ye.type===r)return ae}if(u){const ae=b[M];if(ae&&Er(ae)&&ae.type===r)return M}return null}(D,b,r,null==a?zl(D)&&ri:a!=b&&0!=(3&D.type),u&Et.Host&&m===D);return null!==B?jl(t,b,B,D):Rn}function jl(e,t,r,a){let u=e[r];const m=t.data;if(function Mt(e){return e instanceof lt}(u)){const b=u;b.resolving&&function Fl(e,t){const r=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new en(-200,`Circular dependency in DI detected for ${e}${r}`)}(tr(m[r]));const D=pn(b.canSeeViewProviders);b.resolving=!0;const M=b.injectImpl?pr(b.injectImpl):null;P(e,a,Et.Default);try{u=e[r]=b.factory(void 0,m,e,a),t.firstCreatePass&&r>=a.directiveStart&&function Ue(e,t,r){const{ngOnChanges:a,ngOnInit:u,ngDoCheck:m}=t.type.prototype;if(a){const b=qh(t);(r.preOrderHooks||(r.preOrderHooks=[])).push(e,b),(r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(e,b)}u&&(r.preOrderHooks||(r.preOrderHooks=[])).push(0-e,u),m&&((r.preOrderHooks||(r.preOrderHooks=[])).push(e,m),(r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(e,m))}(r,m[r],t)}finally{null!==M&&pr(M),pn(D),b.resolving=!1,Z()}}return u}function ga(e,t,r){return!!(r[t+(e>>5)]&1<<e)}function Gu(e,t){return!(e&Et.Self||e&Et.Host&&t)}class tl{constructor(t,r){this._tNode=t,this._lView=r}get(t,r,a){return Hn(this._tNode,this._lView,t,a,r)}}function $u(e){return Ua(e)?()=>{const t=$u(gt(e));return t&&t()}:Ao(e)}const rl="__parameters__";function _a(e,t,r){return En(()=>{const a=function Hu(e){return function(...r){if(e){const a=e(...r);for(const u in a)this[u]=a[u]}}}(t);function u(...m){if(this instanceof u)return a.apply(this,m),this;const b=new u(...m);return D.annotation=b,D;function D(M,k,B){const G=M.hasOwnProperty(rl)?M[rl]:Object.defineProperty(M,rl,{value:[]})[rl];for(;G.length<=B;)G.push(null);return(G[B]=G[B]||[]).push(b),M}}return r&&(u.prototype=Object.create(r.prototype)),u.prototype.ngMetadataName=e,u.annotationCls=u,u})}class Xt{constructor(t,r){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof r?this.__NG_ELEMENT_ID__=r:void 0!==r&&(this.\u0275prov=tn({token:this,providedIn:r.providedIn||"root",factory:r.factory}))}toString(){return`InjectionToken ${this._desc}`}}function ns(e,t){e.forEach(r=>Array.isArray(r)?ns(r,t):t(r))}function lm(e,t,r){t>=e.length?e.push(r):e.splice(t,0,r)}function Yh(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function _i(e,t,r){let a=ya(e,t);return a>=0?e[1|a]=r:(a=~a,function x_(e,t,r,a){let u=e.length;if(u==t)e.push(r,a);else if(1===u)e.push(a,e[0]),e[0]=r;else{for(u--,e.push(e[u-1],e[u]);u>t;)e[u]=e[u-2],u--;e[t]=r,e[t+1]=a}}(e,a,t,r)),a}function rs(e,t){const r=ya(e,t);if(r>=0)return e[1|r]}function ya(e,t){return function bp(e,t,r){let a=0,u=e.length>>r;for(;u!==a;){const m=a+(u-a>>1),b=e[m<<r];if(t===b)return m<<r;b>t?u=m:a=m+1}return~(u<<r)}(e,t,1)}const ho={},va="__NG_DI_FLAG__",ed="ngTempTokenPath",M_=/\n/gm,Ep="__source",td=un({provide:String,useValue:un});let Li;function um(e){const t=Li;return Li=e,t}function I_(e,t=Et.Default){if(void 0===Li)throw new en(203,"");return null===Li?bu(e,void 0,t):Li.get(e,t&Et.Optional?null:void 0,t)}function dt(e,t=Et.Default){return(function Ct(){return Ol}()||I_)(gt(e),t)}const Hl=dt;function nd(e){const t=[];for(let r=0;r<e.length;r++){const a=gt(e[r]);if(Array.isArray(a)){if(0===a.length)throw new en(900,"");let u,m=Et.Default;for(let b=0;b<a.length;b++){const D=a[b],M=hm(D);"number"==typeof M?-1===M?u=D.token:m|=M:u=D}t.push(dt(u,m))}else t.push(dt(a))}return t}function nn(e,t){return e[va]=t,e.prototype[va]=t,e}function hm(e){return e[va]}const Zi=nn(_a("Optional"),8),Oi=nn(_a("SkipSelf"),4);const Vp="__ngContext__";function gr(e,t){e[Vp]=t}function jp(e){const t=function ih(e){return e[Vp]||null}(e);return t?Array.isArray(t)?t:t.lView:null}function Xl(e){return e.ngOriginalError}function Lm(e,...t){e.error(...t)}class ah{constructor(){this._console=console}handleError(t){const r=this._findOriginalError(t),a=function Rm(e){return e&&e.ngErrorLogger||Lm}(t);a(this._console,"ERROR",t),r&&a(this._console,"ORIGINAL ERROR",r)}_findOriginalError(t){let r=t&&Xl(t);for(;r&&Xl(r);)r=Xl(r);return r||null}}const Nm=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(qt))();function ls(e){return e instanceof Function?e():e}var yi=(()=>((yi=yi||{})[yi.Important=1]="Important",yi[yi.DashCase=2]="DashCase",yi))();function Up(e,t){return undefined(e,t)}function lh(e){const t=e[3];return wr(t)?t[3]:t}function dd(e){return fn(e[13])}function Kl(e){return fn(e[4])}function fn(e){for(;null!==e&&!wr(e);)e=e[4];return e}function Jl(e,t,r,a,u){if(null!=a){let m,b=!1;wr(a)?m=a:Fi(a)&&(b=!0,a=a[0]);const D=ir(a);0===e&&null!==r?null==u?md(t,r,D):Yl(t,r,D,u||null,!0):1===e&&null!==r?Yl(t,r,D,u||null,!0):2===e?function xd(e,t,r){const a=vi(e,t);a&&function Wm(e,t,r,a){Fn(e)?e.removeChild(t,r,a):t.removeChild(r)}(e,a,t,r)}(t,D,b):3===e&&t.destroyNode(D),null!=m&&function ba(e,t,r,a,u){const m=r[7];m!==ir(r)&&Jl(t,e,a,m,u);for(let D=10;D<r.length;D++){const M=r[D];ru(M[1],M,e,t,a,m)}}(t,e,m,r,u)}}function fd(e,t,r){if(Fn(e))return e.createElement(t,r);{const a=null!==r?function Jo(e){const t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(r):null;return null===a?e.createElement(t):e.createElementNS(a,t)}}function Gm(e,t){const r=e[9],a=r.indexOf(t),u=t[3];1024&t[2]&&(t[2]&=-1025,Ms(u,-1)),r.splice(a,1)}function $p(e,t){if(e.length<=10)return;const r=10+t,a=e[r];if(a){const u=a[17];null!==u&&u!==e&&Gm(u,a),t>0&&(e[r-1][4]=a[4]);const m=Yh(e,10+t);!function ry(e,t){ru(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(a[1],a);const b=m[19];null!==b&&b.detachView(m[1]),a[3]=null,a[4]=null,a[2]&=-129}return a}function $m(e,t){if(!(256&t[2])){const r=t[11];Fn(r)&&r.destroyNode&&ru(e,t,r,3,null,null),function sy(e){let t=e[13];if(!t)return tu(e[1],e);for(;t;){let r=null;if(Fi(t))r=t[13];else{const a=t[10];a&&(r=a)}if(!r){for(;t&&!t[4]&&t!==e;)Fi(t)&&tu(t[1],t),t=t[3];null===t&&(t=e),Fi(t)&&tu(t[1],t),r=t&&t[4]}t=r}}(t)}}function tu(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function Hm(e,t){let r;if(null!=e&&null!=(r=e.destroyHooks))for(let a=0;a<r.length;a+=2){const u=t[r[a]];if(!(u instanceof lt)){const m=r[a+1];if(Array.isArray(m))for(let b=0;b<m.length;b+=2){const D=u[m[b]],M=m[b+1];try{M.call(D)}finally{}}else try{m.call(u)}finally{}}}}(e,t),function nu(e,t){const r=e.cleanup,a=t[7];let u=-1;if(null!==r)for(let m=0;m<r.length-1;m+=2)if("string"==typeof r[m]){const b=r[m+1],D="function"==typeof b?b(t):ir(t[b]),M=a[u=r[m+2]],k=r[m+3];"boolean"==typeof k?D.removeEventListener(r[m],M,k):k>=0?a[u=k]():a[u=-k].unsubscribe(),m+=2}else{const b=a[u=r[m+1]];r[m].call(b)}if(null!==a){for(let m=u+1;m<a.length;m++)a[m]();t[7]=null}}(e,t),1===t[1].type&&Fn(t[11])&&t[11].destroy();const r=t[17];if(null!==r&&wr(t[3])){r!==t[3]&&Gm(r,t);const a=t[19];null!==a&&a.detachView(e)}}}function qm(e,t,r){return function Zm(e,t,r){let a=t;for(;null!==a&&40&a.type;)a=(t=a).parent;if(null===a)return r[0];if(2&a.flags){const u=e.data[a.directiveStart].encapsulation;if(u===Pi.None||u===Pi.Emulated)return null}return gi(a,r)}(e,t.parent,r)}function Yl(e,t,r,a,u){Fn(e)?e.insertBefore(t,r,a,u):t.insertBefore(r,a,u)}function md(e,t,r){Fn(e)?e.appendChild(t,r):t.appendChild(r)}function gd(e,t,r,a,u){null!==a?Yl(e,t,r,a,u):md(e,t,r)}function vi(e,t){return Fn(e)?e.parentNode(t):t.parentNode}let uh=function _d(e,t,r){return 40&e.type?gi(e,r):null};function hh(e,t,r,a){const u=qm(e,a,t),m=t[11],D=function Ql(e,t,r){return uh(e,t,r)}(a.parent||t[6],a,t);if(null!=u)if(Array.isArray(r))for(let M=0;M<r.length;M++)gd(m,u,r[M],D,!1);else gd(m,u,r,D,!1)}function yd(e,t){if(null!==t){const r=t.type;if(3&r)return gi(t,e);if(4&r)return vd(-1,e[t.index]);if(8&r){const a=t.child;if(null!==a)return yd(e,a);{const u=e[t.index];return wr(u)?vd(-1,u):ir(u)}}if(32&r)return Up(t,e)()||ir(e[t.index]);{const a=Zp(e,t);return null!==a?Array.isArray(a)?a[0]:yd(lh(e[16]),a):yd(e,t.next)}}return null}function Zp(e,t){return null!==t?e[16][6].projection[t.projection]:null}function vd(e,t){const r=10+e+1;if(r<t.length){const a=t[r],u=a[1].firstChild;if(null!==u)return yd(a,u)}return t[7]}function dh(e,t,r,a,u,m,b){for(;null!=r;){const D=a[r.index],M=r.type;if(b&&0===t&&(D&&gr(ir(D),a),r.flags|=4),64!=(64&r.flags))if(8&M)dh(e,t,r.child,a,u,m,!1),Jl(t,e,u,D,m);else if(32&M){const k=Up(r,a);let B;for(;B=k();)Jl(t,e,u,B,m);Jl(t,e,u,D,m)}else 16&M?Wp(e,t,a,r,u,m):Jl(t,e,u,D,m);r=b?r.projectionNext:r.next}}function ru(e,t,r,a,u,m){dh(r,a,e.firstChild,t,u,m,!1)}function Wp(e,t,r,a,u,m){const b=r[16],M=b[6].projection[a.projection];if(Array.isArray(M))for(let k=0;k<M.length;k++)Jl(t,e,u,M[k],m);else dh(e,t,M,b[3],u,m,!0)}function Xp(e,t,r){Fn(e)?e.setAttribute(t,"style",r):t.style.cssText=r}function bd(e,t,r){Fn(e)?""===r?e.removeAttribute(t,"class"):e.setAttribute(t,"class",r):t.className=r}function Kp(e,t,r){let a=e.length;for(;;){const u=e.indexOf(t,r);if(-1===u)return u;if(0===u||e.charCodeAt(u-1)<=32){const m=t.length;if(u+m===a||e.charCodeAt(u+m)<=32)return u}r=u+1}}const Km="ng-template";function Jm(e,t,r){let a=0;for(;a<e.length;){let u=e[a++];if(r&&"class"===u){if(u=e[a],-1!==Kp(u.toLowerCase(),t,0))return!0}else if(1===u){for(;a<e.length&&"string"==typeof(u=e[a++]);)if(u.toLowerCase()===t)return!0;return!1}}return!1}function Jp(e){return 4===e.type&&e.value!==Km}function ph(e,t,r){return t===(4!==e.type||r?e.value:Km)}function Ym(e,t,r){let a=4;const u=e.attrs||[],m=function wd(e){for(let t=0;t<e.length;t++)if(Jn(e[t]))return t;return e.length}(u);let b=!1;for(let D=0;D<t.length;D++){const M=t[D];if("number"!=typeof M){if(!b)if(4&a){if(a=2|1&a,""!==M&&!ph(e,M,r)||""===M&&1===t.length){if(Fo(a))return!1;b=!0}}else{const k=8&a?M:t[++D];if(8&a&&null!==e.attrs){if(!Jm(e.attrs,k,r)){if(Fo(a))return!1;b=!0}continue}const G=Yp(8&a?"class":M,u,Jp(e),r);if(-1===G){if(Fo(a))return!1;b=!0;continue}if(""!==k){let Y;Y=G>m?"":u[G+1].toLowerCase();const ae=8&a?Y:null;if(ae&&-1!==Kp(ae,k,0)||2&a&&k!==Y){if(Fo(a))return!1;b=!0}}}}else{if(!b&&!Fo(a)&&!Fo(M))return!1;if(b&&Fo(M))continue;b=!1,a=M|1&a}}return Fo(a)||b}function Fo(e){return 0==(1&e)}function Yp(e,t,r,a){if(null===t)return-1;let u=0;if(a||!r){let m=!1;for(;u<t.length;){const b=t[u];if(b===e)return u;if(3===b||6===b)m=!0;else{if(1===b||2===b){let D=t[++u];for(;"string"==typeof D;)D=t[++u];continue}if(4===b)break;if(0===b){u+=4;continue}}u+=m?1:2}return-1}return function eg(e,t){let r=e.indexOf(4);if(r>-1)for(r++;r<e.length;){const a=e[r];if("number"==typeof a)return-1;if(a===t)return r;r++}return-1}(t,e)}function ec(e,t,r=!1){for(let a=0;a<t.length;a++)if(Ym(e,t[a],r))return!0;return!1}function fh(e,t){return e?":not("+t.trim()+")":t}function uy(e){let t=e[0],r=1,a=2,u="",m=!1;for(;r<e.length;){let b=e[r];if("string"==typeof b)if(2&a){const D=e[++r];u+="["+b+(D.length>0?'="'+D+'"':"")+"]"}else 8&a?u+="."+b:4&a&&(u+=" "+b);else""!==u&&!Fo(b)&&(t+=fh(m,u),u=""),a=b,m=m||!Fo(a);r++}return""!==u&&(t+=fh(m,u)),t}const At={};function si(e){tc(Qt(),ze(),$()+e,Ss())}function tc(e,t,r,a){if(!a)if(3==(3&t[2])){const m=e.preOrderCheckHooks;null!==m&&ke(t,m,r)}else{const m=e.preOrderHooks;null!==m&&be(t,m,0,r)}ne(r)}function Dd(e,t){return e<<17|t<<2}function Ro(e){return e>>17&32767}function ef(e){return 2|e}function xi(e){return(131068&e)>>2}function Td(e,t){return-131069&e|t<<2}function iu(e){return 1|e}function uf(e,t){const r=e.contentQueries;if(null!==r)for(let a=0;a<r.length;a+=2){const u=r[a],m=r[a+1];if(-1!==m){const b=e.data[m];E(u),b.contentQueries(2,t[m],m)}}}function su(e,t,r,a,u,m,b,D,M,k){const B=t.blueprint.slice();return B[0]=u,B[2]=140|a,Qa(B),B[3]=B[15]=e,B[8]=r,B[10]=b||e&&e[10],B[11]=D||e&&e[11],B[12]=M||e&&e[12]||null,B[9]=k||e&&e[9]||null,B[6]=m,B[16]=2==t.type?e[16]:B,B}function oc(e,t,r,a,u){let m=e.data[t];if(null===m)m=function Pd(e,t,r,a,u){const m=ha(),b=Uu(),M=e.data[t]=function Lo(e,t,r,a,u,m){return{type:r,index:a,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:u,attrs:m,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,b?m:m&&m.parent,r,t,a,u);return null===e.firstChild&&(e.firstChild=M),null!==m&&(b?null==m.child&&null!==M.parent&&(m.child=M):null===m.next&&(m.next=M)),M}(e,t,r,a,u),function Is(){return bt.lFrame.inI18n}()&&(m.flags|=64);else if(64&m.type){m.type=r,m.value=a,m.attrs=u;const b=function Vl(){const e=bt.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();m.injectorIndex=null===b?-1:b.injectorIndex}return Gi(m,!0),m}function sc(e,t,r,a){if(0===r)return-1;const u=t.length;for(let m=0;m<r;m++)t.push(a),e.blueprint.push(a),e.data.push(null);return u}function au(e,t,r){F(t);try{const a=e.viewQuery;null!==a&&Cf(1,a,r);const u=e.template;null!==u&&hf(e,t,u,1,r),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&uf(e,t),e.staticViewQueries&&Cf(2,e.viewQuery,r);const m=e.components;null!==m&&function cg(e,t){for(let r=0;r<t.length;r++)bh(e,t[r])}(t,m)}catch(a){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),a}finally{t[2]&=-5,H()}}function ac(e,t,r,a){const u=t[2];if(256==(256&u))return;F(t);const m=Ss();try{Qa(t),function da(e){return bt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==r&&hf(e,t,r,2,a);const b=3==(3&u);if(!m)if(b){const k=e.preOrderCheckHooks;null!==k&&ke(t,k,null)}else{const k=e.preOrderHooks;null!==k&&be(t,k,0,null),ve(t,0)}if(function Dy(e){for(let t=dd(e);null!==t;t=Kl(t)){if(!t[2])continue;const r=t[9];for(let a=0;a<r.length;a++){const u=r[a],m=u[3];0==(1024&u[2])&&Ms(m,1),u[2]|=1024}}}(t),function yg(e){for(let t=dd(e);null!==t;t=Kl(t))for(let r=10;r<t.length;r++){const a=t[r],u=a[1];ua(a)&&ac(u,a,u.template,a[8])}}(t),null!==e.contentQueries&&uf(e,t),!m)if(b){const k=e.contentCheckHooks;null!==k&&ke(t,k)}else{const k=e.contentHooks;null!==k&&be(t,k,1),ve(t,1)}!function lg(e,t){const r=e.hostBindingOpCodes;if(null!==r)try{for(let a=0;a<r.length;a++){const u=r[a];if(u<0)ne(~u);else{const m=u,b=r[++a],D=r[++a];o(b,m),D(2,t[m])}}}finally{ne(-1)}}(e,t);const D=e.components;null!==D&&function xy(e,t){for(let r=0;r<t.length;r++)lc(e,t[r])}(t,D);const M=e.viewQuery;if(null!==M&&Cf(2,M,a),!m)if(b){const k=e.viewCheckHooks;null!==k&&ke(t,k)}else{const k=e.viewHooks;null!==k&&be(t,k,2),ve(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),m||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,Ms(t[3],-1))}finally{H()}}function ul(e,t,r,a){const u=t[10],m=!Ss(),b=function zu(e){return 4==(4&e[2])}(t);try{m&&!b&&u.begin&&u.begin(),b&&au(e,t,a),ac(e,t,r,a)}finally{m&&!b&&u.end&&u.end()}}function hf(e,t,r,a,u){const m=$(),b=2&a;try{ne(-1),b&&t.length>20&&tc(e,t,20,Ss()),r(a,u)}finally{ne(m)}}function vh(e,t,r){if(sa(t)){const u=t.directiveEnd;for(let m=t.directiveStart;m<u;m++){const b=e.data[m];b.contentQueries&&b.contentQueries(1,r[m],m)}}}function df(e,t,r){!Lc()||(function Xi(e,t,r,a){const u=r.directiveStart,m=r.directiveEnd;e.firstCreatePass||at(r,t),gr(a,t);const b=r.initialInputs;for(let D=u;D<m;D++){const M=e.data[D],k=Er(M);k&&mg(t,r,M);const B=jl(t,e,D,r);gr(B,t),null!==b&&gg(0,D-u,B,M,0,b),k&&(Qr(r.index,t)[8]=B)}}(e,t,r,gi(r,t)),128==(128&r.flags)&&function Ki(e,t,r){const a=r.directiveStart,u=r.directiveEnd,b=r.index,D=function c(){return bt.lFrame.currentDirectiveIndex}();try{ne(b);for(let M=a;M<u;M++){const k=e.data[M],B=t[M];g(M),(null!==k.hostBindings||0!==k.hostVars||null!==k.hostAttrs)&&fg(k,B)}}finally{ne(-1),g(D)}}(e,t,r))}function Ea(e,t,r=gi){const a=t.localNames;if(null!==a){let u=t.index+1;for(let m=0;m<a.length;m+=2){const b=a[m+1],D=-1===b?r(t,e):e[b];e[u++]=D}}}function pf(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=xh(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function xh(e,t,r,a,u,m,b,D,M,k){const B=20+a,G=B+u,Y=function kd(e,t){const r=[];for(let a=0;a<t;a++)r.push(a<e?null:At);return r}(B,G),ae="function"==typeof k?k():k;return Y[1]={type:e,blueprint:Y,template:r,queries:null,viewQuery:D,declTNode:t,data:Y.slice().fill(null,B),bindingStartIndex:B,expandoStartIndex:G,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof m?m():m,pipeRegistry:"function"==typeof b?b():b,firstChild:null,schemas:M,consts:ae,incompleteFirstPass:!1}}function us(e,t,r){for(let a in e)if(e.hasOwnProperty(a)){const u=e[a];(r=null===r?{}:r).hasOwnProperty(a)?r[a].push(t,u):r[a]=[t,u]}return r}function Ld(e,t,r,a){let u=!1;if(Lc()){const m=function Od(e,t,r){const a=e.directiveRegistry;let u=null;if(a)for(let m=0;m<a.length;m++){const b=a[m];ec(r,b.selectors,!1)&&(u||(u=[]),sr(at(r,t),e,b.type),Er(b)?(gf(e,r),u.unshift(b)):u.push(b))}return u}(e,t,r),b=null===a?null:{"":-1};if(null!==m){u=!0,yf(r,e.data.length,m.length);for(let B=0;B<m.length;B++){const G=m[B];G.providersResolver&&G.providersResolver(G)}let D=!1,M=!1,k=sc(e,t,m.length,null);for(let B=0;B<m.length;B++){const G=m[B];r.mergedAttrs=ni(r.mergedAttrs,G.hostAttrs),vf(e,r,t,k,G),zd(k,G,b),null!==G.contentQueries&&(r.flags|=8),(null!==G.hostBindings||null!==G.hostAttrs||0!==G.hostVars)&&(r.flags|=128);const Y=G.type.prototype;!D&&(Y.ngOnChanges||Y.ngOnInit||Y.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(r.index),D=!0),!M&&(Y.ngOnChanges||Y.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(r.index),M=!0),k++}!function hl(e,t){const a=t.directiveEnd,u=e.data,m=t.attrs,b=[];let D=null,M=null;for(let k=t.directiveStart;k<a;k++){const B=u[k],G=B.inputs,Y=null===m||Jp(t)?null:Cy(G,m);b.push(Y),D=us(G,k,D),M=us(B.outputs,k,M)}null!==D&&(D.hasOwnProperty("class")&&(t.flags|=16),D.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=b,t.inputs=D,t.outputs=M}(e,r)}b&&function _f(e,t,r){if(t){const a=e.localNames=[];for(let u=0;u<t.length;u+=2){const m=r[t[u+1]];if(null==m)throw new en(-301,!1);a.push(t[u],m)}}}(r,a,b)}return r.mergedAttrs=ni(r.mergedAttrs,r.attrs),u}function dl(e,t,r,a,u,m){const b=m.hostBindings;if(b){let D=e.hostBindingOpCodes;null===D&&(D=e.hostBindingOpCodes=[]);const M=~t.index;(function mf(e){let t=e.length;for(;t>0;){const r=e[--t];if("number"==typeof r&&r<0)return r}return 0})(D)!=M&&D.push(M),D.push(a,u,b)}}function fg(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function gf(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function zd(e,t,r){if(r){if(t.exportAs)for(let a=0;a<t.exportAs.length;a++)r[t.exportAs[a]]=e;Er(t)&&(r[""]=e)}}function yf(e,t,r){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+r,e.providerIndexes=t}function vf(e,t,r,a,u){e.data[a]=u;const m=u.factory||(u.factory=Ao(u.type)),b=new lt(m,Er(u),null);e.blueprint[a]=b,r[a]=b,dl(e,t,0,a,sc(e,r,u.hostVars,At),u)}function mg(e,t,r){const a=gi(t,e),u=pf(r),m=e[10],b=fl(e,su(e,u,null,r.onPush?64:16,a,t,m,m.createRenderer(a,r),null,null));e[t.index]=b}function gg(e,t,r,a,u,m){const b=m[t];if(null!==b){const D=a.setInput;for(let M=0;M<b.length;){const k=b[M++],B=b[M++],G=b[M++];null!==D?a.setInput(r,G,k,B):r[B]=G}}}function Cy(e,t){let r=null,a=0;for(;a<t.length;){const u=t[a];if(0!==u)if(5!==u){if("number"==typeof u)break;e.hasOwnProperty(u)&&(null===r&&(r=[]),r.push(u,e[u],t[a+1])),a+=2}else a+=2;else a+=4}return r}function xf(e,t,r,a){return new Array(e,!0,!1,t,null,0,a,r,null,null)}function lc(e,t){const r=Qr(t,e);if(ua(r)){const a=r[1];80&r[2]?ac(a,r,a.template,r[8]):r[5]>0&&bf(r)}}function bf(e){for(let a=dd(e);null!==a;a=Kl(a))for(let u=10;u<a.length;u++){const m=a[u];if(1024&m[2]){const b=m[1];ac(b,m,b.template,m[8])}else m[5]>0&&bf(m)}const r=e[1].components;if(null!==r)for(let a=0;a<r.length;a++){const u=Qr(r[a],e);ua(u)&&u[5]>0&&bf(u)}}function bh(e,t){const r=Qr(t,e),a=r[1];(function wh(e,t){for(let r=t.length;r<e.blueprint.length;r++)t.push(e.blueprint[r])})(a,r),au(a,r,r[8])}function fl(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function cc(e){for(;e;){e[2]|=64;const t=lh(e);if(Nh(e)&&!t)return e;e=t}return null}function Ef(e,t,r){const a=t[10];a.begin&&a.begin();try{ac(e,t,e.template,r)}catch(u){throw n(t,u),u}finally{a.end&&a.end()}}function uc(e){!function wf(e){for(let t=0;t<e.components.length;t++){const r=e.components[t],a=jp(r),u=a[1];ul(u,a,u.template,r)}}(e[8])}function Cf(e,t,r){E(0),t(e,r)}const Sy=(()=>Promise.resolve(null))();function Df(e){return e[7]||(e[7]=[])}function Tf(e){return e.cleanup||(e.cleanup=[])}function n(e,t){const r=e[9],a=r?r.get(ah,null):null;a&&a.handleError(t)}function s(e,t,r,a,u){for(let m=0;m<r.length;){const b=r[m++],D=r[m++],M=t[b],k=e.data[b];null!==k.setInput?k.setInput(M,u,a,D):M[D]=u}}function l(e,t,r){const a=ca(t,e);!function Ps(e,t,r){Fn(e)?e.setValue(t,r):t.textContent=r}(e[11],a,r)}function h(e,t,r){let a=r?e.styles:null,u=r?e.classes:null,m=0;if(null!==t)for(let b=0;b<t.length;b++){const D=t[b];"number"==typeof D?m=D:1==m?u=ja(u,D):2==m&&(a=ja(a,D+": "+t[++b]+";"))}r?e.styles=a:e.stylesWithoutHost=a,r?e.classes=u:e.classesWithoutHost=u}const w=new Xt("INJECTOR",-1);class C{get(t,r=ho){if(r===ho){const a=new Error(`NullInjectorError: No provider for ${an(t)}!`);throw a.name="NullInjectorError",a}return r}}const S=new Xt("Set Injector scope."),I={},A={};let O;function N(){return void 0===O&&(O=new C),O}function U(e,t=null,r=null,a){const u=q(e,t,r,a);return u._resolveInjectorDefTypes(),u}function q(e,t=null,r=null,a){return new J(e,r,t||N(),a)}class J{constructor(t,r,a,u=null){this.parent=a,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const m=[];r&&ns(r,D=>this.processProvider(D,t,r)),ns([t],D=>this.processInjectorType(D,[],m)),this.records.set(w,de(void 0,this));const b=this.records.get(S);this.scope=null!=b?b.value:null,this.source=u||("object"==typeof t?null:an(t))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(t=>t.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(t,r=ho,a=Et.Default){this.assertNotDestroyed();const u=um(this),m=pr(void 0);try{if(!(a&Et.SkipSelf)){let D=this.records.get(t);if(void 0===D){const M=function Pe(e){return"function"==typeof e||"object"==typeof e&&e instanceof Xt}(t)&&di(t);D=M&&this.injectableDefInScope(M)?de(ie(t),I):null,this.records.set(t,D)}if(null!=D)return this.hydrate(t,D)}return(a&Et.Self?N():this.parent).get(t,r=a&Et.Optional&&r===ho?null:r)}catch(b){if("NullInjectorError"===b.name){if((b[ed]=b[ed]||[]).unshift(an(t)),u)throw b;return function dm(e,t,r,a){const u=e[ed];throw t[Ep]&&u.unshift(t[Ep]),e.message=function Hc(e,t,r,a=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let u=an(t);if(Array.isArray(t))u=t.map(an).join(" -> ");else if("object"==typeof t){let m=[];for(let b in t)if(t.hasOwnProperty(b)){let D=t[b];m.push(b+":"+("string"==typeof D?JSON.stringify(D):an(D)))}u=`{${m.join(", ")}}`}return`${r}${a?"("+a+")":""}[${u}]: ${e.replace(M_,"\n  ")}`}("\n"+e.message,u,r,a),e.ngTokenPath=u,e[ed]=null,e}(b,t,"R3InjectorError",this.source)}throw b}finally{pr(m),um(u)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(t=>this.get(t))}toString(){const t=[];return this.records.forEach((a,u)=>t.push(an(u))),`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new en(205,!1)}processInjectorType(t,r,a){if(!(t=gt(t)))return!1;let u=Ll(t);const m=null==u&&t.ngModule||void 0,b=void 0===m?t:m,D=-1!==a.indexOf(b);if(void 0!==m&&(u=Ll(m)),null==u)return!1;if(null!=u.imports&&!D){let B;a.push(b);try{ns(u.imports,G=>{this.processInjectorType(G,r,a)&&(void 0===B&&(B=[]),B.push(G))})}finally{}if(void 0!==B)for(let G=0;G<B.length;G++){const{ngModule:Y,providers:ae}=B[G];ns(ae,ye=>this.processProvider(ye,Y,ae||hn))}}this.injectorDefTypes.add(b);const M=Ao(b)||(()=>new b);this.records.set(b,de(M,I));const k=u.providers;if(null!=k&&!D){const B=t;ns(k,G=>this.processProvider(G,B,k))}return void 0!==m&&void 0!==t.providers}processProvider(t,r,a){let u=Be(t=gt(t))?t:gt(t&&t.provide);const m=function he(e,t,r){return Ce(e)?de(void 0,e.useValue):de(pe(e),I)}(t);if(Be(t)||!0!==t.multi)this.records.get(u);else{let b=this.records.get(u);b||(b=de(void 0,I,!0),b.factory=()=>nd(b.multi),this.records.set(u,b)),u=t,b.multi.push(t)}this.records.set(u,m)}hydrate(t,r){return r.value===I&&(r.value=A,r.value=r.factory()),"object"==typeof r.value&&r.value&&function Ze(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(r.value)&&this.onDestroy.add(r.value),r.value}injectableDefInScope(t){if(!t.providedIn)return!1;const r=gt(t.providedIn);return"string"==typeof r?"any"===r||r===this.scope:this.injectorDefTypes.has(r)}}function ie(e){const t=di(e),r=null!==t?t.factory:Ao(e);if(null!==r)return r;if(e instanceof Xt)throw new en(204,!1);if(e instanceof Function)return function ce(e){const t=e.length;if(t>0)throw function $c(e,t){const r=[];for(let a=0;a<e;a++)r.push(t);return r}(t,"?"),new en(204,!1);const r=function lp(e){const t=e&&(e[Wo]||e[Ks]);if(t){const r=function pi(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${r}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${r}" class.`),t}return null}(e);return null!==r?()=>r.factory(e):()=>new e}(e);throw new en(204,!1)}function pe(e,t,r){let a;if(Be(e)){const u=gt(e);return Ao(u)||ie(u)}if(Ce(e))a=()=>gt(e.useValue);else if(function Ge(e){return!(!e||!e.useFactory)}(e))a=()=>e.useFactory(...nd(e.deps||[]));else if(function we(e){return!(!e||!e.useExisting)}(e))a=()=>dt(gt(e.useExisting));else{const u=gt(e&&(e.useClass||e.provide));if(!function Ve(e){return!!e.deps}(e))return Ao(u)||ie(u);a=()=>new u(...nd(e.deps))}return a}function de(e,t,r=!1){return{factory:e,value:t,multi:r?[]:void 0}}function Ce(e){return null!==e&&"object"==typeof e&&td in e}function Be(e){return"function"==typeof e}let We=(()=>{class e{static create(r,a){var u;if(Array.isArray(r))return U({name:""},a,r,"");{const m=null!==(u=r.name)&&void 0!==u?u:"";return U({name:m},r.parent,r.providers,m)}}}return e.THROW_IF_NOT_FOUND=ho,e.NULL=new C,e.\u0275prov=tn({token:e,providedIn:"any",factory:()=>dt(w)}),e.__NG_ELEMENT_ID__=-1,e})();function Ln(e,t){Re(jp(e)[1],zn())}function St(e){let t=function ur(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),r=!0;const a=[e];for(;t;){let u;if(Er(e))u=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new en(903,"");u=t.\u0275dir}if(u){if(r){a.push(u);const b=e;b.inputs=$r(e.inputs),b.declaredInputs=$r(e.declaredInputs),b.outputs=$r(e.outputs);const D=u.hostBindings;D&&lu(e,D);const M=u.viewQuery,k=u.contentQueries;if(M&&Sr(e,M),k&&ds(e,k),Pl(e.inputs,u.inputs),Pl(e.declaredInputs,u.declaredInputs),Pl(e.outputs,u.outputs),Er(u)&&u.data.animation){const B=e.data;B.animation=(B.animation||[]).concat(u.data.animation)}}const m=u.features;if(m)for(let b=0;b<m.length;b++){const D=m[b];D&&D.ngInherit&&D(e),D===St&&(r=!1)}}t=Object.getPrototypeOf(t)}!function Ci(e){let t=0,r=null;for(let a=e.length-1;a>=0;a--){const u=e[a];u.hostVars=t+=u.hostVars,u.hostAttrs=ni(u.hostAttrs,r=ni(r,u.hostAttrs))}}(a)}function $r(e){return e===br?{}:e===hn?[]:e}function Sr(e,t){const r=e.viewQuery;e.viewQuery=r?(a,u)=>{t(a,u),r(a,u)}:t}function ds(e,t){const r=e.contentQueries;e.contentQueries=r?(a,u,m)=>{t(a,u,m),r(a,u,m)}:t}function lu(e,t){const r=e.hostBindings;e.hostBindings=r?(a,u)=>{t(a,u),r(a,u)}:t}let Dh=null;function hc(){if(!Dh){const e=qt.Symbol;if(e&&e.iterator)Dh=e.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let r=0;r<t.length;++r){const a=t[r];"entries"!==a&&"size"!==a&&Map.prototype[a]===Map.prototype.entries&&(Dh=a)}}}return Dh}function dc(e){return!!function Vd(e){return null!==e&&("function"==typeof e||"object"==typeof e)}(e)&&(Array.isArray(e)||!(e instanceof Map)&&hc()in e)}function er(e,t,r){return!Object.is(e[t],r)&&(e[t]=r,!0)}function cu(e,t,r,a,u,m,b,D){const M=ze(),k=Qt(),B=e+20,G=k.firstCreatePass?function OE(e,t,r,a,u,m,b,D,M){const k=t.consts,B=oc(t,e,4,b||null,Qo(k,D));Ld(t,r,B,Qo(k,M)),Re(t,B);const G=B.tViews=xh(2,B,a,u,m,t.directiveRegistry,t.pipeRegistry,null,t.schemas,k);return null!==t.queries&&(t.queries.template(t,B),G.queries=t.queries.embeddedTView(B)),B}(B,k,M,t,r,a,u,m,b):k.data[B];Gi(G,!1);const Y=M[11].createComment("");hh(k,M,Y,G),gr(Y,M),fl(M,M[B]=xf(Y,M,Y,G)),aa(G)&&df(k,M,G),null!=b&&Ea(M,G,D)}function Ye(e,t=Et.Default){const r=ze();return null===r?dt(e,t):Hn(zn(),r,gt(e),t)}function Ls(e,t,r){const a=ze();return er(a,pa(),t)&&function Tr(e,t,r,a,u,m,b,D){const M=gi(t,r);let B,k=t.inputs;!D&&null!=k&&(B=k[a])?(s(e,r,B,a,u),zl(t)&&function Fd(e,t){const r=Qr(t,e);16&r[2]||(r[2]|=64)}(r,t.index)):3&t.type&&(a=function ks(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(a),u=null!=b?b(u,t.value||"",a):u,Fn(m)?m.setProperty(M,a,u):Vr(a)||(M.setProperty?M.setProperty(a,u):M[a]=u))}(Qt(),function ee(){const e=bt.lFrame;return Rc(e.tView,e.selectedIndex)}(),a,e,t,a[11],r,!1),Ls}function Fy(e,t,r,a,u){const b=u?"class":"style";s(e,r,t.inputs[b],b,a)}function Ir(e,t,r,a){const u=ze(),m=Qt(),b=20+e,D=u[11],M=u[b]=fd(D,t,function xe(){return bt.lFrame.currentNamespace}()),k=m.firstCreatePass?function oC(e,t,r,a,u,m,b){const D=t.consts,k=oc(t,e,2,u,Qo(D,m));return Ld(t,r,k,Qo(D,b)),null!==k.attrs&&h(k,k.attrs,!1),null!==k.mergedAttrs&&h(k,k.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,k),k}(b,m,u,0,t,r,a):m.data[b];Gi(k,!0);const B=k.mergedAttrs;null!==B&&yn(D,M,B);const G=k.classes;null!==G&&bd(D,M,G);const Y=k.styles;return null!==Y&&Xp(D,M,Y),64!=(64&k.flags)&&hh(m,u,M,k),0===function Bu(){return bt.lFrame.elementDepthCount}()&&gr(M,u),function Nu(){bt.lFrame.elementDepthCount++}(),aa(k)&&(df(m,u,k),vh(m,k,u)),null!==a&&Ea(u,k),Ir}function yr(){let e=zn();Uu()?Oc():(e=e.parent,Gi(e,!1));const t=e;!function Vu(){bt.lFrame.elementDepthCount--}();const r=Qt();return r.firstCreatePass&&(Re(r,e),sa(e)&&r.queries.elementEnd(e)),null!=t.classesWithoutHost&&function ln(e){return 0!=(16&e.flags)}(t)&&Fy(r,t,ze(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function _n(e){return 0!=(32&e.flags)}(t)&&Fy(r,t,ze(),t.stylesWithoutHost,!1),yr}function wg(e,t,r,a){return Ir(e,t,r,a),yr(),wg}function Sf(e,t,r){const a=ze(),u=Qt(),m=e+20,b=u.firstCreatePass?function sC(e,t,r,a,u){const m=t.consts,b=Qo(m,a),D=oc(t,e,8,"ng-container",b);return null!==b&&h(D,b,!0),Ld(t,r,D,Qo(m,u)),null!==t.queries&&t.queries.elementStart(t,D),D}(m,u,a,t,r):u.data[m];Gi(b,!0);const D=a[m]=a[11].createComment("");return hh(u,a,D,b),gr(D,a),aa(b)&&(df(u,a,b),vh(u,b,a)),null!=r&&Ea(a,b),Sf}function If(){let e=zn();const t=Qt();return Uu()?Oc():(e=e.parent,Gi(e,!1)),t.firstCreatePass&&(Re(t,e),sa(e)&&t.queries.elementEnd(e)),If}function Af(){return ze()}function Eg(e){return!!e&&"function"==typeof e.then}const o0=function r0(e){return!!e&&"function"==typeof e.subscribe};function Di(e,t,r,a){const u=ze(),m=Qt(),b=zn();return function a0(e,t,r,a,u,m,b,D){const M=aa(a),B=e.firstCreatePass&&Tf(e),G=t[8],Y=Df(t);let ae=!0;if(3&a.type||D){const He=gi(a,t),$e=D?D(He):He,Se=Y.length,pt=D?jt=>D(ir(jt[a.index])):a.index;if(Fn(r)){let jt=null;if(!D&&M&&(jt=function aC(e,t,r,a){const u=e.cleanup;if(null!=u)for(let m=0;m<u.length-1;m+=2){const b=u[m];if(b===r&&u[m+1]===a){const D=t[7],M=u[m+2];return D.length>M?D[M]:null}"string"==typeof b&&(m+=2)}return null}(e,t,u,a.index)),null!==jt)(jt.__ngLastListenerFn__||jt).__ngNextListenerFn__=m,jt.__ngLastListenerFn__=m,ae=!1;else{m=Ry(a,t,G,m,!1);const vn=r.listen($e,u,m);Y.push(m,vn),B&&B.push(u,pt,Se,Se+1)}}else m=Ry(a,t,G,m,!0),$e.addEventListener(u,m,b),Y.push(m),B&&B.push(u,pt,Se,b)}else m=Ry(a,t,G,m,!1);const ye=a.outputs;let Oe;if(ae&&null!==ye&&(Oe=ye[u])){const He=Oe.length;if(He)for(let $e=0;$e<He;$e+=2){const ps=t[Oe[$e]][Oe[$e+1]].subscribe(m),kh=Y.length;Y.push(m,ps),B&&B.push(u,a.index,kh,-(kh+1))}}}(m,u,u[11],b,e,t,!!r,a),Di}function l0(e,t,r,a){try{return!1!==r(a)}catch(u){return n(e,u),!1}}function Ry(e,t,r,a,u){return function m(b){if(b===Function)return a;const D=2&e.flags?Qr(e.index,t):t;0==(32&t[2])&&cc(D);let M=l0(t,0,a,b),k=m.__ngNextListenerFn__;for(;k;)M=l0(t,0,k,b)&&M,k=k.__ngNextListenerFn__;return u&&!1===M&&(b.preventDefault(),b.returnValue=!1),M}}function Da(e=1){return function W(e){return(bt.lFrame.contextLView=function oe(e,t){for(;e>0;)t=t[15],e--;return t}(e,bt.lFrame.contextLView))[8]}(e)}function y0(e,t,r,a,u){const m=e[r+1],b=null===t;let D=a?Ro(m):xi(m),M=!1;for(;0!==D&&(!1===M||b);){const B=e[D+1];pC(e[D],t)&&(M=!0,e[D+1]=a?iu(B):ef(B)),D=a?Ro(B):xi(B)}M&&(e[r+1]=a?ef(m):iu(m))}function pC(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&ya(e,t)>=0}function Cg(e,t){return function Ta(e,t,r,a){const u=ze(),m=Qt(),b=function Ri(e){const t=bt.lFrame,r=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,r}(2);m.firstUpdatePass&&function M0(e,t,r,a){const u=e.data;if(null===u[r+1]){const m=u[$()],b=function T0(e,t){return t>=e.expandoStartIndex}(e,r);(function P0(e,t){return 0!=(e.flags&(t?16:32))})(m,a)&&null===t&&!b&&(t=!1),t=function wC(e,t,r,a){const u=function y(e){const t=bt.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let m=a?t.residualClasses:t.residualStyles;if(null===u)0===(a?t.classBindings:t.styleBindings)&&(r=Pf(r=Oy(null,e,t,r,a),t.attrs,a),m=null);else{const b=t.directiveStylingLast;if(-1===b||e[b]!==u)if(r=Oy(u,e,t,r,a),null===m){let M=function EC(e,t,r){const a=r?t.classBindings:t.styleBindings;if(0!==xi(a))return e[Ro(a)]}(e,t,a);void 0!==M&&Array.isArray(M)&&(M=Oy(null,e,t,M[1],a),M=Pf(M,t.attrs,a),function CC(e,t,r,a){e[Ro(r?t.classBindings:t.styleBindings)]=a}(e,t,a,M))}else m=function DC(e,t,r){let a;const u=t.directiveEnd;for(let m=1+t.directiveStylingLast;m<u;m++)a=Pf(a,e[m].hostAttrs,r);return Pf(a,t.attrs,r)}(e,t,a)}return void 0!==m&&(a?t.residualClasses=m:t.residualStyles=m),r}(u,m,t,a),function hC(e,t,r,a,u,m){let b=m?t.classBindings:t.styleBindings,D=Ro(b),M=xi(b);e[a]=r;let B,k=!1;if(Array.isArray(r)){const G=r;B=G[1],(null===B||ya(G,B)>0)&&(k=!0)}else B=r;if(u)if(0!==M){const Y=Ro(e[D+1]);e[a+1]=Dd(Y,D),0!==Y&&(e[Y+1]=Td(e[Y+1],a)),e[D+1]=function Qp(e,t){return 131071&e|t<<17}(e[D+1],a)}else e[a+1]=Dd(D,0),0!==D&&(e[D+1]=Td(e[D+1],a)),D=a;else e[a+1]=Dd(M,0),0===D?D=a:e[M+1]=Td(e[M+1],a),M=a;k&&(e[a+1]=ef(e[a+1])),y0(e,B,a,!0),y0(e,B,a,!1),function dC(e,t,r,a,u){const m=u?e.residualClasses:e.residualStyles;null!=m&&"string"==typeof t&&ya(m,t)>=0&&(r[a+1]=iu(r[a+1]))}(t,B,e,a,m),b=Dd(D,M),m?t.classBindings=b:t.styleBindings=b}(u,m,t,r,b,a)}}(m,e,b,a),t!==At&&er(u,b,t)&&function I0(e,t,r,a,u,m,b,D){if(!(3&t.type))return;const M=e.data,k=M[D+1];Dg(function tf(e){return 1==(1&e)}(k)?A0(M,t,r,u,xi(k),b):void 0)||(Dg(m)||function tg(e){return 2==(2&e)}(k)&&(m=A0(M,null,r,u,D,b)),function Xm(e,t,r,a,u){const m=Fn(e);if(t)u?m?e.addClass(r,a):r.classList.add(a):m?e.removeClass(r,a):r.classList.remove(a);else{let b=-1===a.indexOf("-")?void 0:yi.DashCase;if(null==u)m?e.removeStyle(r,a,b):r.style.removeProperty(a);else{const D="string"==typeof u&&u.endsWith("!important");D&&(u=u.slice(0,-10),b|=yi.Important),m?e.setStyle(r,a,u,b):r.style.setProperty(a,u,D?"important":"")}}}(a,b,ca($(),r),u,m))}(m,m.data[$()],u,u[11],e,u[b+1]=function SC(e,t){return null==e||("string"==typeof t?e+=t:"object"==typeof e&&(e=an(function xa(e){return e instanceof class vm{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}?e.changingThisBreaksApplicationSecurity:e}(e)))),e}(t,r),a,b)}(e,t,null,!0),Cg}function Oy(e,t,r,a,u){let m=null;const b=r.directiveEnd;let D=r.directiveStylingLast;for(-1===D?D=r.directiveStart:D++;D<b&&(m=t[D],a=Pf(a,m.hostAttrs,u),m!==e);)D++;return null!==e&&(r.directiveStylingLast=D),a}function Pf(e,t,r){const a=r?1:2;let u=-1;if(null!==t)for(let m=0;m<t.length;m++){const b=t[m];"number"==typeof b?u=b:u===a&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),_i(e,b,!!r||t[++m]))}return void 0===e?null:e}function A0(e,t,r,a,u,m){const b=null===t;let D;for(;u>0;){const M=e[u],k=Array.isArray(M),B=k?M[1]:M,G=null===B;let Y=r[u+1];Y===At&&(Y=G?hn:void 0);let ae=G?rs(Y,a):B===a?Y:void 0;if(k&&!Dg(ae)&&(ae=rs(M,a)),Dg(ae)&&(D=ae,b))return D;const ye=e[u+1];u=b?Ro(ye):xi(ye)}if(null!==t){let M=m?t.residualClasses:t.residualStyles;null!=M&&(D=rs(M,a))}return D}function Dg(e){return void 0!==e}function Sa(e,t=""){const r=ze(),a=Qt(),u=e+20,m=a.firstCreatePass?oc(a,u,1,t,null):a.data[u],b=r[u]=function pd(e,t){return Fn(e)?e.createText(t):e.createTextNode(t)}(r[11],t);hh(a,r,b,m),Gi(m,!1)}function Xd(e){return kf("",e,""),Xd}function kf(e,t,r){const a=ze(),u=function ml(e,t,r,a){return er(e,pa(),r)?t+xt(r)+a:At}(a,e,t,r);return u!==At&&l(a,$(),u),kf}const Tg="en-US";let Q0=Tg;function Ny(e,t,r,a,u){if(e=gt(e),Array.isArray(e))for(let m=0;m<e.length;m++)Ny(e[m],t,r,a,u);else{const m=Qt(),b=ze();let D=Be(e)?e:gt(e.provide),M=pe(e);const k=zn(),B=1048575&k.providerIndexes,G=k.directiveStart,Y=k.providerIndexes>>20;if(Be(e)||!e.multi){const ae=new lt(M,u,Ye),ye=jy(D,t,u?B:B+Y,G);-1===ye?(sr(at(k,b),m,D),Vy(m,e,t.length),t.push(D),k.directiveStart++,k.directiveEnd++,u&&(k.providerIndexes+=1048576),r.push(ae),b.push(ae)):(r[ye]=ae,b[ye]=ae)}else{const ae=jy(D,t,B+Y,G),ye=jy(D,t,B,B+Y),Oe=ae>=0&&r[ae],He=ye>=0&&r[ye];if(u&&!He||!u&&!Oe){sr(at(k,b),m,D);const $e=function ZD(e,t,r,a,u){const m=new lt(e,r,Ye);return m.multi=[],m.index=t,m.componentProviders=0,E1(m,u,a&&!r),m}(u?qD:HD,r.length,u,a,M);!u&&He&&(r[ye].providerFactory=$e),Vy(m,e,t.length,0),t.push(D),k.directiveStart++,k.directiveEnd++,u&&(k.providerIndexes+=1048576),r.push($e),b.push($e)}else Vy(m,e,ae>-1?ae:ye,E1(r[u?ye:ae],M,!u&&a));!u&&a&&He&&r[ye].componentProviders++}}}function Vy(e,t,r,a){const u=Be(t),m=function De(e){return!!e.useClass}(t);if(u||m){const M=(m?gt(t.useClass):t).prototype.ngOnDestroy;if(M){const k=e.destroyHooks||(e.destroyHooks=[]);if(!u&&t.multi){const B=k.indexOf(r);-1===B?k.push(r,[a,M]):k[B+1].push(a,M)}else k.push(r,M)}}}function E1(e,t,r){return r&&e.componentProviders++,e.multi.push(t)-1}function jy(e,t,r,a){for(let u=r;u<a;u++)if(t[u]===e)return u;return-1}function HD(e,t,r,a){return Uy(this.multi,[])}function qD(e,t,r,a){const u=this.multi;let m;if(this.providerFactory){const b=this.providerFactory.componentProviders,D=jl(r,r[1],this.providerFactory.index,a);m=D.slice(0,b),Uy(u,m);for(let M=b;M<D.length;M++)m.push(D[M])}else m=[],Uy(u,m);return m}function Uy(e,t){for(let r=0;r<e.length;r++)t.push((0,e[r])());return t}function dr(e,t=[]){return r=>{r.providersResolver=(a,u)=>function $D(e,t,r){const a=Qt();if(a.firstCreatePass){const u=Er(e);Ny(r,a.data,a.blueprint,u,!0),Ny(t,a.data,a.blueprint,u,!1)}}(a,u?u(e):e,t)}}class C1{}class KD{resolveComponentFactory(t){throw function XD(e){const t=Error(`No component factory found for ${an(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(t)}}let Pg=(()=>{class e{}return e.NULL=new KD,e})();function JD(){return Yd(zn(),ze())}function Yd(e,t){return new Ia(gi(e,t))}let Ia=(()=>{class e{constructor(r){this.nativeElement=r}}return e.__NG_ELEMENT_ID__=JD,e})();class T1{}let Mh=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>function eT(){const e=ze(),r=Qr(zn().index,e);return function QD(e){return e[11]}(Fi(r)?r:e)}(),e})(),tT=(()=>{class e{}return e.\u0275prov=tn({token:e,providedIn:"root",factory:()=>null}),e})();class kg{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const nT=new kg("13.3.0"),Gy={};function Fg(e,t,r,a,u=!1){for(;null!==r;){const m=t[r.index];if(null!==m&&a.push(ir(m)),wr(m))for(let D=10;D<m.length;D++){const M=m[D],k=M[1].firstChild;null!==k&&Fg(M[1],M,k,a)}const b=r.type;if(8&b)Fg(e,t,r.child,a);else if(32&b){const D=Up(r,t);let M;for(;M=D();)a.push(M)}else if(16&b){const D=Zp(t,r);if(Array.isArray(D))a.push(...D);else{const M=lh(t[16]);Fg(M[1],M,D,a,!0)}}r=u?r.projectionNext:r.next}return a}class zf{constructor(t,r){this._lView=t,this._cdRefInjectingView=r,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,r=t[1];return Fg(r,t,r.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(wr(t)){const r=t[8],a=r?r.indexOf(this):-1;a>-1&&($p(t,a),Yh(r,a))}this._attachedToViewContainer=!1}$m(this._lView[1],this._lView)}onDestroy(t){!function hg(e,t,r,a){const u=Df(t);null===r?u.push(a):(u.push(r),e.firstCreatePass&&Tf(e).push(a,u.length-1))}(this._lView[1],this._lView,null,t)}markForCheck(){cc(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Ef(this._lView[1],this._lView,this.context)}checkNoChanges(){!function Nd(e,t,r){es(!0);try{Ef(e,t,r)}finally{es(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new en(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function oy(e,t){ru(e,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new en(902,"");this._appRef=t}}class rT extends zf{constructor(t){super(t),this._view=t}detectChanges(){uc(this._view)}checkNoChanges(){!function Ty(e){es(!0);try{uc(e)}finally{es(!1)}}(this._view)}get context(){return null}}class M1 extends Pg{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const r=Xn(t);return new $y(r,this.ngModule)}}function S1(e){const t=[];for(let r in e)e.hasOwnProperty(r)&&t.push({propName:e[r],templateName:r});return t}class $y extends C1{constructor(t,r){super(),this.componentDef=t,this.ngModule=r,this.componentType=t.type,this.selector=function hy(e){return e.map(uy).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!r}get inputs(){return S1(this.componentDef.inputs)}get outputs(){return S1(this.componentDef.outputs)}create(t,r,a,u){const m=(u=u||this.ngModule)?function oT(e,t){return{get:(r,a,u)=>{const m=e.get(r,Gy,u);return m!==Gy||a===Gy?m:t.get(r,a,u)}}}(t,u.injector):t,b=m.get(T1,Ou),D=m.get(tT,null),M=b.createRenderer(null,this.componentDef),k=this.componentDef.selectors[0][0]||"div",B=a?function ug(e,t,r){if(Fn(e))return e.selectRootElement(t,r===Pi.ShadowDom);let a="string"==typeof t?e.querySelector(t):t;return a.textContent="",a}(M,a,this.componentDef.encapsulation):fd(b.createRenderer(null,this.componentDef),k,function iT(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(k)),G=this.componentDef.onPush?576:528,Y=function _r(e,t){return{components:[],scheduler:e||Nm,clean:Sy,playerHandler:t||null,flags:0}}(),ae=xh(0,null,null,1,0,null,null,null,null,null),ye=su(null,ae,Y,G,null,null,b,M,D,m);let Oe,He;F(ye);try{const $e=function Mr(e,t,r,a,u,m){const b=r[1];r[20]=e;const M=oc(b,20,2,"#host",null),k=M.mergedAttrs=t.hostAttrs;null!==k&&(h(M,k,!0),null!==e&&(yn(u,e,k),null!==M.classes&&bd(u,e,M.classes),null!==M.styles&&Xp(u,e,M.styles)));const B=a.createRenderer(e,t),G=su(r,pf(t),null,t.onPush?64:16,r[20],M,a,B,m||null,null);return b.firstCreatePass&&(sr(at(M,r),b,t.type),gf(b,M),yf(M,r.length,1)),fl(r,G),r[20]=G}(B,this.componentDef,ye,b,M);if(B)if(a)yn(M,B,["ng-version",nT.full]);else{const{attrs:Se,classes:pt}=function dy(e){const t=[],r=[];let a=1,u=2;for(;a<e.length;){let m=e[a];if("string"==typeof m)2===u?""!==m&&t.push(m,e[++a]):8===u&&r.push(m);else{if(!Fo(u))break;u=m}a++}return{attrs:t,classes:r}}(this.componentDef.selectors[0]);Se&&yn(M,B,Se),pt&&pt.length>0&&bd(M,B,pt.join(" "))}if(He=Rc(ae,20),void 0!==r){const Se=He.projection=[];for(let pt=0;pt<this.ngContentSelectors.length;pt++){const jt=r[pt];Se.push(null!=jt?Array.from(jt):null)}}Oe=function dn(e,t,r,a,u){const m=r[1],b=function Ey(e,t,r){const a=zn();e.firstCreatePass&&(r.providersResolver&&r.providersResolver(r),vf(e,a,t,sc(e,t,1,null),r));const u=jl(t,e,a.directiveStart,a);gr(u,t);const m=gi(a,t);return m&&gr(m,t),u}(m,r,t);if(a.components.push(b),e[8]=b,u&&u.forEach(M=>M(b,t)),t.contentQueries){const M=zn();t.contentQueries(1,b,M.directiveStart)}const D=zn();return!m.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(ne(D.index),dl(r[1],D,0,D.directiveStart,D.directiveEnd,t),fg(t,b)),b}($e,this.componentDef,ye,Y,[Ln]),au(ae,ye,null)}finally{H()}return new aT(this.componentType,Oe,Yd(He,ye),ye,He)}}class aT extends class WD{}{constructor(t,r,a,u,m){super(),this.location=a,this._rootLView=u,this._tNode=m,this.instance=r,this.hostView=this.changeDetectorRef=new rT(u),this.componentType=t}get injector(){return new tl(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}class Qd{}const ep=new Map;class P1 extends Qd{constructor(t,r){super(),this._parent=r,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new M1(this);const a=Jr(t);this._bootstrapComponents=ls(a.bootstrap),this._r3Injector=q(t,r,[{provide:Qd,useValue:this},{provide:Pg,useValue:this.componentFactoryResolver}],an(t)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(t)}get(t,r=We.THROW_IF_NOT_FOUND,a=Et.Default){return t===We||t===Qd||t===w?this:this._r3Injector.get(t,r,a)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(r=>r()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class Hy extends class cT{}{constructor(t){super(),this.moduleType=t,null!==Jr(t)&&function uT(e){const t=new Set;!function r(a){const u=Jr(a,!0),m=u.id;null!==m&&(function I1(e,t,r){if(t&&t!==r)throw new Error(`Duplicate module registered for ${e} - ${an(t)} vs ${an(t.name)}`)}(m,ep.get(m),a),ep.set(m,a));const b=ls(u.imports);for(const D of b)t.has(D)||(t.add(D),r(D))}(e)}(t)}create(t){return new P1(this.moduleType,t)}}function qy(e){return t=>{setTimeout(e,void 0,t)}}const Yi=class ST extends Vs{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,r,a){var u,m,b;let D=t,M=r||(()=>null),k=a;if(t&&"object"==typeof t){const G=t;D=null===(u=G.next)||void 0===u?void 0:u.bind(G),M=null===(m=G.error)||void 0===m?void 0:m.bind(G),k=null===(b=G.complete)||void 0===b?void 0:b.bind(G)}this.__isAsync&&(M=qy(M),D&&(D=qy(D)),k&&(k=qy(k)));const B=super.subscribe({next:D,error:M,complete:k});return t instanceof Zn&&t.add(B),B}};Symbol;let mc=(()=>{class e{}return e.__NG_ELEMENT_ID__=kT,e})();const AT=mc,PT=class extends AT{constructor(t,r,a){super(),this._declarationLView=t,this._declarationTContainer=r,this.elementRef=a}createEmbeddedView(t){const r=this._declarationTContainer.tViews,a=su(this._declarationLView,r,t,16,null,r.declTNode,null,null,null,null);a[17]=this._declarationLView[this._declarationTContainer.index];const m=this._declarationLView[19];return null!==m&&(a[19]=m.createEmbeddedView(r)),au(r,a,t),new zf(a)}};function kT(){return function Rg(e,t){return 4&e.type?new PT(t,e,Yd(e,t)):null}(zn(),ze())}let yl=(()=>{class e{}return e.__NG_ELEMENT_ID__=FT,e})();function FT(){return function N1(e,t){let r;const a=t[e.index];if(wr(a))r=a;else{let u;if(8&e.type)u=ir(a);else{const m=t[11];u=m.createComment("");const b=gi(e,t);Yl(m,vi(m,b),u,function ch(e,t){return Fn(e)?e.nextSibling(t):t.nextSibling}(m,b),!1)}t[e.index]=r=xf(a,t,u,e),fl(t,r)}return new z1(r,e,t)}(zn(),ze())}const RT=yl,z1=class extends RT{constructor(t,r,a){super(),this._lContainer=t,this._hostTNode=r,this._hostLView=a}get element(){return Yd(this._hostTNode,this._hostLView)}get injector(){return new tl(this._hostTNode,this._hostLView)}get parentInjector(){const t=co(this._hostTNode,this._hostLView);if(Ut(t)){const r=Dn(t,this._hostLView),a=ft(t);return new tl(r[1].data[a+8],r)}return new tl(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const r=B1(this._lContainer);return null!==r&&r[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,r,a){const u=t.createEmbeddedView(r||{});return this.insert(u,a),u}createComponent(t,r,a,u,m){const b=t&&!function Gc(e){return"function"==typeof e}(t);let D;if(b)D=r;else{const G=r||{};D=G.index,a=G.injector,u=G.projectableNodes,m=G.ngModuleRef}const M=b?t:new $y(Xn(t)),k=a||this.parentInjector;if(!m&&null==M.ngModule){const Y=(b?k:this.parentInjector).get(Qd,null);Y&&(m=Y)}const B=M.create(k,u,void 0,m);return this.insert(B.hostView,D),B}insert(t,r){const a=t._lView,u=a[1];if(function Xh(e){return wr(e[3])}(a)){const B=this.indexOf(t);if(-1!==B)this.detach(B);else{const G=a[3],Y=new z1(G,G[6],G[3]);Y.detach(Y.indexOf(t))}}const m=this._adjustIndex(r),b=this._lContainer;!function ay(e,t,r,a){const u=10+a,m=r.length;a>0&&(r[u-1][4]=t),a<m-10?(t[4]=r[u],lm(r,10+a,t)):(r.push(t),t[4]=null),t[3]=r;const b=t[17];null!==b&&r!==b&&function ly(e,t){const r=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===r?e[9]=[t]:r.push(t)}(b,t);const D=t[19];null!==D&&D.insertView(e),t[2]|=128}(u,a,b,m);const D=vd(m,b),M=a[11],k=vi(M,b[7]);return null!==k&&function iy(e,t,r,a,u,m){a[0]=u,a[6]=t,ru(e,a,r,1,u,m)}(u,b[6],M,a,k,D),t.attachToViewContainerRef(),lm(Wy(b),m,t),t}move(t,r){return this.insert(t,r)}indexOf(t){const r=B1(this._lContainer);return null!==r?r.indexOf(t):-1}remove(t){const r=this._adjustIndex(t,-1),a=$p(this._lContainer,r);a&&(Yh(Wy(this._lContainer),r),$m(a[1],a))}detach(t){const r=this._adjustIndex(t,-1),a=$p(this._lContainer,r);return a&&null!=Yh(Wy(this._lContainer),r)?new zf(a):null}_adjustIndex(t,r=0){return null==t?this.length+r:t}};function B1(e){return e[8]}function Wy(e){return e[8]||(e[8]=[])}function zg(...e){}const ab=new Xt("Application Initializer");let ov=(()=>{class e{constructor(r){this.appInits=r,this.resolve=zg,this.reject=zg,this.initialized=!1,this.done=!1,this.donePromise=new Promise((a,u)=>{this.resolve=a,this.reject=u})}runInitializers(){if(this.initialized)return;const r=[],a=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let u=0;u<this.appInits.length;u++){const m=this.appInits[u]();if(Eg(m))r.push(m);else if(o0(m)){const b=new Promise((D,M)=>{m.subscribe({complete:D,error:M})});r.push(b)}}Promise.all(r).then(()=>{a()}).catch(u=>{this.reject(u)}),0===r.length&&a(),this.initialized=!0}}return e.\u0275fac=function(r){return new(r||e)(dt(ab,8))},e.\u0275prov=tn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const jf=new Xt("AppId",{providedIn:"root",factory:function lb(){return`${sv()}${sv()}${sv()}`}});function sv(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const cb=new Xt("Platform Initializer"),Bg=new Xt("Platform ID"),uM=new Xt("appBootstrapListener");let hM=(()=>{class e{log(r){console.log(r)}warn(r){console.warn(r)}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=tn({token:e,factory:e.\u0275fac}),e})();const uu=new Xt("LocaleId",{providedIn:"root",factory:()=>Hl(uu,Et.Optional|Et.SkipSelf)||function dM(){return"undefined"!=typeof $localize&&$localize.locale||Tg}()}),gM=(()=>Promise.resolve(0))();function av(e){"undefined"==typeof Zone?gM.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class No{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:a=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Yi(!1),this.onMicrotaskEmpty=new Yi(!1),this.onStable=new Yi(!1),this.onError=new Yi(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const u=this;u._nesting=0,u._outer=u._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(u._inner=u._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(u._inner=u._inner.fork(Zone.longStackTraceZoneSpec)),u.shouldCoalesceEventChangeDetection=!a&&r,u.shouldCoalesceRunChangeDetection=a,u.lastRequestAnimationFrameId=-1,u.nativeRequestAnimationFrame=function _M(){let e=qt.requestAnimationFrame,t=qt.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r);const a=t[Zone.__symbol__("OriginalDelegate")];a&&(t=a)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function xM(e){const t=()=>{!function vM(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(qt,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,cv(e),e.isCheckStableRunning=!0,lv(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),cv(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(r,a,u,m,b,D)=>{try{return ub(e),r.invokeTask(u,m,b,D)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===m.type||e.shouldCoalesceRunChangeDetection)&&t(),hb(e)}},onInvoke:(r,a,u,m,b,D,M)=>{try{return ub(e),r.invoke(u,m,b,D,M)}finally{e.shouldCoalesceRunChangeDetection&&t(),hb(e)}},onHasTask:(r,a,u,m)=>{r.hasTask(u,m),a===u&&("microTask"==m.change?(e._hasPendingMicrotasks=m.microTask,cv(e),lv(e)):"macroTask"==m.change&&(e.hasPendingMacrotasks=m.macroTask))},onHandleError:(r,a,u,m)=>(r.handleError(u,m),e.runOutsideAngular(()=>e.onError.emit(m)),!1)})}(u)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!No.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(No.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,r,a){return this._inner.run(t,r,a)}runTask(t,r,a,u){const m=this._inner,b=m.scheduleEventTask("NgZoneEvent: "+u,t,yM,zg,zg);try{return m.runTask(b,r,a)}finally{m.cancelTask(b)}}runGuarded(t,r,a){return this._inner.runGuarded(t,r,a)}runOutsideAngular(t){return this._outer.run(t)}}const yM={};function lv(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function cv(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function ub(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function hb(e){e._nesting--,lv(e)}class bM{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Yi,this.onMicrotaskEmpty=new Yi,this.onStable=new Yi,this.onError=new Yi}run(t,r,a){return t.apply(r,a)}runGuarded(t,r,a){return t.apply(r,a)}runOutsideAngular(t){return t()}runTask(t,r,a,u){return t.apply(r,a)}}let uv=(()=>{class e{constructor(r){this._ngZone=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),r.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{No.assertNotInAngularZone(),av(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())av(()=>{for(;0!==this._callbacks.length;){let r=this._callbacks.pop();clearTimeout(r.timeoutId),r.doneCb(this._didWork)}this._didWork=!1});else{let r=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>!a.updateCb||!a.updateCb(r)||(clearTimeout(a.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(r=>({source:r.source,creationLocation:r.creationLocation,data:r.data})):[]}addCallback(r,a,u){let m=-1;a&&a>0&&(m=setTimeout(()=>{this._callbacks=this._callbacks.filter(b=>b.timeoutId!==m),r(this._didWork,this.getPendingTasks())},a)),this._callbacks.push({doneCb:r,timeoutId:m,updateCb:u})}whenStable(r,a,u){if(u&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(r,a,u),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(r,a,u){return[]}}return e.\u0275fac=function(r){return new(r||e)(dt(No))},e.\u0275prov=tn({token:e,factory:e.\u0275fac}),e})(),db=(()=>{class e{constructor(){this._applications=new Map,hv.addToWindow(this)}registerApplication(r,a){this._applications.set(r,a)}unregisterApplication(r){this._applications.delete(r)}unregisterAllApplications(){this._applications.clear()}getTestability(r){return this._applications.get(r)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(r,a=!0){return hv.findTestabilityInTree(this,r,a)}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=tn({token:e,factory:e.\u0275fac}),e})();class wM{addToWindow(t){}findTestabilityInTree(t,r,a){return null}}let Aa,hv=new wM;const pb=new Xt("AllowMultipleToken");function fb(e,t,r=[]){const a=`Platform: ${t}`,u=new Xt(a);return(m=[])=>{let b=mb();if(!b||b.injector.get(pb,!1))if(e)e(r.concat(m).concat({provide:u,useValue:!0}));else{const D=r.concat(m).concat({provide:u,useValue:!0},{provide:S,useValue:"platform"});!function TM(e){if(Aa&&!Aa.destroyed&&!Aa.injector.get(pb,!1))throw new en(400,"");Aa=e.get(gb);const t=e.get(cb,null);t&&t.forEach(r=>r())}(We.create({providers:D,name:a}))}return function MM(e){const t=mb();if(!t)throw new en(401,"");return t}()}}function mb(){return Aa&&!Aa.destroyed?Aa:null}let gb=(()=>{class e{constructor(r){this._injector=r,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(r,a){const D=function SM(e,t){let r;return r="noop"===e?new bM:("zone.js"===e?void 0:e)||new No({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)}),r}(a?a.ngZone:void 0,{ngZoneEventCoalescing:a&&a.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:a&&a.ngZoneRunCoalescing||!1}),M=[{provide:No,useValue:D}];return D.run(()=>{const k=We.create({providers:M,parent:this.injector,name:r.moduleType.name}),B=r.create(k),G=B.injector.get(ah,null);if(!G)throw new en(402,"");return D.runOutsideAngular(()=>{const Y=D.onError.subscribe({next:ae=>{G.handleError(ae)}});B.onDestroy(()=>{dv(this._modules,B),Y.unsubscribe()})}),function IM(e,t,r){try{const a=r();return Eg(a)?a.catch(u=>{throw t.runOutsideAngular(()=>e.handleError(u)),u}):a}catch(a){throw t.runOutsideAngular(()=>e.handleError(a)),a}}(G,D,()=>{const Y=B.injector.get(ov);return Y.runInitializers(),Y.donePromise.then(()=>(function QC(e){_t(e,"Expected localeId to be defined"),"string"==typeof e&&(Q0=e.toLowerCase().replace(/_/g,"-"))}(B.injector.get(uu,Tg)||Tg),this._moduleDoBootstrap(B),B))})})}bootstrapModule(r,a=[]){const u=_b({},a);return function CM(e,t,r){const a=new Hy(r);return Promise.resolve(a)}(0,0,r).then(m=>this.bootstrapModuleFactory(m,u))}_moduleDoBootstrap(r){const a=r.injector.get(yb);if(r._bootstrapComponents.length>0)r._bootstrapComponents.forEach(u=>a.bootstrap(u));else{if(!r.instance.ngDoBootstrap)throw new en(403,"");r.instance.ngDoBootstrap(a)}this._modules.push(r)}onDestroy(r){this._destroyListeners.push(r)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new en(404,"");this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(r){return new(r||e)(dt(We))},e.\u0275prov=tn({token:e,factory:e.\u0275fac}),e})();function _b(e,t){return Array.isArray(t)?t.reduce(_b,e):Object.assign(Object.assign({},e),t)}let yb=(()=>{class e{constructor(r,a,u,m,b){this._zone=r,this._injector=a,this._exceptionHandler=u,this._componentFactoryResolver=m,this._initStatus=b,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const D=new xn(k=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{k.next(this._stable),k.complete()})}),M=new xn(k=>{let B;this._zone.runOutsideAngular(()=>{B=this._zone.onStable.subscribe(()=>{No.assertNotInAngularZone(),av(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,k.next(!0))})})});const G=this._zone.onUnstable.subscribe(()=>{No.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{k.next(!1)}))});return()=>{B.unsubscribe(),G.unsubscribe()}});this.isStable=function Eo(...e){const t=rt(e),r=function ut(e,t){return"number"==typeof Ie(e)?e.pop():t}(e,1/0),a=e;return a.length?1===a.length?Pr(a[0]):function me(e=1/0){return le(vo,e)}(r)($n(a,t)):fe}(D,M.pipe(function Lh(e={}){const{connector:t=(()=>new Vs),resetOnError:r=!0,resetOnComplete:a=!0,resetOnRefCountZero:u=!0}=e;return m=>{let b=null,D=null,M=null,k=0,B=!1,G=!1;const Y=()=>{null==D||D.unsubscribe(),D=null},ae=()=>{Y(),b=M=null,B=G=!1},ye=()=>{const Oe=b;ae(),null==Oe||Oe.unsubscribe()};return ro((Oe,He)=>{k++,!G&&!B&&Y();const $e=M=null!=M?M:t();He.add(()=>{k--,0===k&&!G&&!B&&(D=Al(ye,u))}),$e.subscribe(He),b||(b=new Bs({next:Se=>$e.next(Se),error:Se=>{G=!0,Y(),D=Al(ae,r,Se),$e.error(Se)},complete:()=>{B=!0,Y(),D=Al(ae,a),$e.complete()}}),$n(Oe).subscribe(b))})(m)}}()))}bootstrap(r,a){if(!this._initStatus.done)throw new en(405,"");let u;u=r instanceof C1?r:this._componentFactoryResolver.resolveComponentFactory(r),this.componentTypes.push(u.componentType);const m=function DM(e){return e.isBoundToModule}(u)?void 0:this._injector.get(Qd),D=u.create(We.NULL,[],a||u.selector,m),M=D.location.nativeElement,k=D.injector.get(uv,null),B=k&&D.injector.get(db);return k&&B&&B.registerApplication(M,k),D.onDestroy(()=>{this.detachView(D.hostView),dv(this.components,D),B&&B.unregisterApplication(M)}),this._loadComponent(D),D}tick(){if(this._runningTick)throw new en(101,"");try{this._runningTick=!0;for(let r of this._views)r.detectChanges()}catch(r){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(r))}finally{this._runningTick=!1}}attachView(r){const a=r;this._views.push(a),a.attachToAppRef(this)}detachView(r){const a=r;dv(this._views,a),a.detachFromAppRef()}_loadComponent(r){this.attachView(r.hostView),this.tick(),this.components.push(r),this._injector.get(uM,[]).concat(this._bootstrapListeners).forEach(u=>u(r))}ngOnDestroy(){this._views.slice().forEach(r=>r.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return e.\u0275fac=function(r){return new(r||e)(dt(No),dt(We),dt(ah),dt(Pg),dt(ov))},e.\u0275prov=tn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function dv(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}let xb=!0,Eb=(()=>{class e{}return e.__NG_ELEMENT_ID__=kM,e})();function kM(e){return function FM(e,t,r){if(zl(e)&&!r){const a=Qr(e.index,t);return new zf(a,a)}return 47&e.type?new zf(t[16],t):null}(zn(),ze(),16==(16&e))}class Tb{constructor(){}supports(t){return dc(t)}create(t){return new NM(t)}}const BM=(e,t)=>t;class NM{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||BM}forEachItem(t){let r;for(r=this._itHead;null!==r;r=r._next)t(r)}forEachOperation(t){let r=this._itHead,a=this._removalsHead,u=0,m=null;for(;r||a;){const b=!a||r&&r.currentIndex<Sb(a,u,m)?r:a,D=Sb(b,u,m),M=b.currentIndex;if(b===a)u--,a=a._nextRemoved;else if(r=r._next,null==b.previousIndex)u++;else{m||(m=[]);const k=D-u,B=M-u;if(k!=B){for(let Y=0;Y<k;Y++){const ae=Y<m.length?m[Y]:m[Y]=0,ye=ae+Y;B<=ye&&ye<k&&(m[Y]=ae+1)}m[b.previousIndex]=B-k}}D!==M&&t(b,D,M)}}forEachPreviousItem(t){let r;for(r=this._previousItHead;null!==r;r=r._nextPrevious)t(r)}forEachAddedItem(t){let r;for(r=this._additionsHead;null!==r;r=r._nextAdded)t(r)}forEachMovedItem(t){let r;for(r=this._movesHead;null!==r;r=r._nextMoved)t(r)}forEachRemovedItem(t){let r;for(r=this._removalsHead;null!==r;r=r._nextRemoved)t(r)}forEachIdentityChange(t){let r;for(r=this._identityChangesHead;null!==r;r=r._nextIdentityChange)t(r)}diff(t){if(null==t&&(t=[]),!dc(t))throw new en(900,"");return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let u,m,b,r=this._itHead,a=!1;if(Array.isArray(t)){this.length=t.length;for(let D=0;D<this.length;D++)m=t[D],b=this._trackByFn(D,m),null!==r&&Object.is(r.trackById,b)?(a&&(r=this._verifyReinsertion(r,m,b,D)),Object.is(r.item,m)||this._addIdentityChange(r,m)):(r=this._mismatch(r,m,b,D),a=!0),r=r._next}else u=0,function Fs(e,t){if(Array.isArray(e))for(let r=0;r<e.length;r++)t(e[r]);else{const r=e[hc()]();let a;for(;!(a=r.next()).done;)t(a.value)}}(t,D=>{b=this._trackByFn(u,D),null!==r&&Object.is(r.trackById,b)?(a&&(r=this._verifyReinsertion(r,D,b,u)),Object.is(r.item,D)||this._addIdentityChange(r,D)):(r=this._mismatch(r,D,b,u),a=!0),r=r._next,u++}),this.length=u;return this._truncate(r),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,r,a,u){let m;return null===t?m=this._itTail:(m=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null))?(Object.is(t.item,r)||this._addIdentityChange(t,r),this._reinsertAfter(t,m,u)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(a,u))?(Object.is(t.item,r)||this._addIdentityChange(t,r),this._moveAfter(t,m,u)):t=this._addAfter(new VM(r,a),m,u),t}_verifyReinsertion(t,r,a,u){let m=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null);return null!==m?t=this._reinsertAfter(m,t._prev,u):t.currentIndex!=u&&(t.currentIndex=u,this._addToMoves(t,u)),t}_truncate(t){for(;null!==t;){const r=t._next;this._addToRemovals(this._unlink(t)),t=r}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,r,a){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const u=t._prevRemoved,m=t._nextRemoved;return null===u?this._removalsHead=m:u._nextRemoved=m,null===m?this._removalsTail=u:m._prevRemoved=u,this._insertAfter(t,r,a),this._addToMoves(t,a),t}_moveAfter(t,r,a){return this._unlink(t),this._insertAfter(t,r,a),this._addToMoves(t,a),t}_addAfter(t,r,a){return this._insertAfter(t,r,a),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,r,a){const u=null===r?this._itHead:r._next;return t._next=u,t._prev=r,null===u?this._itTail=t:u._prev=t,null===r?this._itHead=t:r._next=t,null===this._linkedRecords&&(this._linkedRecords=new Mb),this._linkedRecords.put(t),t.currentIndex=a,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const r=t._prev,a=t._next;return null===r?this._itHead=a:r._next=a,null===a?this._itTail=r:a._prev=r,t}_addToMoves(t,r){return t.previousIndex===r||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Mb),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,r){return t.item=r,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class VM{constructor(t,r){this.item=t,this.trackById=r,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class jM{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,r){let a;for(a=this._head;null!==a;a=a._nextDup)if((null===r||r<=a.currentIndex)&&Object.is(a.trackById,t))return a;return null}remove(t){const r=t._prevDup,a=t._nextDup;return null===r?this._head=a:r._nextDup=a,null===a?this._tail=r:a._prevDup=r,null===this._head}}class Mb{constructor(){this.map=new Map}put(t){const r=t.trackById;let a=this.map.get(r);a||(a=new jM,this.map.set(r,a)),a.add(t)}get(t,r){const u=this.map.get(t);return u?u.get(t,r):null}remove(t){const r=t.trackById;return this.map.get(r).remove(t)&&this.map.delete(r),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Sb(e,t,r){const a=e.previousIndex;if(null===a)return a;let u=0;return r&&a<r.length&&(u=r[a]),a+t+u}function Ab(){return new jg([new Tb])}let jg=(()=>{class e{constructor(r){this.factories=r}static create(r,a){if(null!=a){const u=a.factories.slice();r=r.concat(u)}return new e(r)}static extend(r){return{provide:e,useFactory:a=>e.create(r,a||Ab()),deps:[[e,new Oi,new Zi]]}}find(r){const a=this.factories.find(u=>u.supports(r));if(null!=a)return a;throw new en(901,"")}}return e.\u0275prov=tn({token:e,providedIn:"root",factory:Ab}),e})();const qM=fb(null,"core",[{provide:Bg,useValue:"unknown"},{provide:gb,deps:[We]},{provide:db,deps:[]},{provide:hM,deps:[]}]);let ZM=(()=>{class e{constructor(r){}}return e.\u0275fac=function(r){return new(r||e)(dt(yb))},e.\u0275mod=so({type:e}),e.\u0275inj=Xr({}),e})(),Ug=null;function Ih(){return Ug}const Pa=new Xt("DocumentToken");function Ub(e,t){t=encodeURIComponent(t);for(const r of e.split(";")){const a=r.indexOf("="),[u,m]=-1==a?[r,""]:[r.slice(0,a),r.slice(a+1)];if(u.trim()===t)return decodeURIComponent(m)}return null}class BS{constructor(t,r,a,u){this.$implicit=t,this.ngForOf=r,this.index=a,this.count=u}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Gb=(()=>{class e{constructor(r,a,u){this._viewContainer=r,this._template=a,this._differs=u,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(r){this._ngForOf=r,this._ngForOfDirty=!0}set ngForTrackBy(r){this._trackByFn=r}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(r){r&&(this._template=r)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const r=this._ngForOf;!this._differ&&r&&(this._differ=this._differs.find(r).create(this.ngForTrackBy))}if(this._differ){const r=this._differ.diff(this._ngForOf);r&&this._applyChanges(r)}}_applyChanges(r){const a=this._viewContainer;r.forEachOperation((u,m,b)=>{if(null==u.previousIndex)a.createEmbeddedView(this._template,new BS(u.item,this._ngForOf,-1,-1),null===b?void 0:b);else if(null==b)a.remove(null===m?void 0:m);else if(null!==m){const D=a.get(m);a.move(D,b),$b(D,u)}});for(let u=0,m=a.length;u<m;u++){const D=a.get(u).context;D.index=u,D.count=m,D.ngForOf=this._ngForOf}r.forEachIdentityChange(u=>{$b(a.get(u.currentIndex),u)})}static ngTemplateContextGuard(r,a){return!0}}return e.\u0275fac=function(r){return new(r||e)(Ye(yl),Ye(mc),Ye(jg))},e.\u0275dir=Dt({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),e})();function $b(e,t){e.context.$implicit=t.item}let Hb=(()=>{class e{constructor(r,a){this._viewContainer=r,this._context=new NS,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=a}set ngIf(r){this._context.$implicit=this._context.ngIf=r,this._updateView()}set ngIfThen(r){qb("ngIfThen",r),this._thenTemplateRef=r,this._thenViewRef=null,this._updateView()}set ngIfElse(r){qb("ngIfElse",r),this._elseTemplateRef=r,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(r,a){return!0}}return e.\u0275fac=function(r){return new(r||e)(Ye(yl),Ye(mc))},e.\u0275dir=Dt({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e})();class NS{constructor(){this.$implicit=null,this.ngIf=null}}function qb(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${an(t)}'.`)}let dI=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=so({type:e}),e.\u0275inj=Xr({}),e})();class Jb{}class Av extends class _I extends class KM{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function XM(e){Ug||(Ug=e)}(new Av)}onAndCancel(t,r,a){return t.addEventListener(r,a,!1),()=>{t.removeEventListener(r,a,!1)}}dispatchEvent(t,r){t.dispatchEvent(r)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,r){return(r=r||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,r){return"window"===r?window:"document"===r?t:"body"===r?t.body:null}getBaseHref(t){const r=function yI(){return Hf=Hf||document.querySelector("base"),Hf?Hf.getAttribute("href"):null}();return null==r?null:function vI(e){Yg=Yg||document.createElement("a"),Yg.setAttribute("href",e);const t=Yg.pathname;return"/"===t.charAt(0)?t:`/${t}`}(r)}resetBaseElement(){Hf=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return Ub(document.cookie,t)}}let Yg,Hf=null;const Yb=new Xt("TRANSITION_ID"),bI=[{provide:ab,useFactory:function xI(e,t,r){return()=>{r.get(ov).donePromise.then(()=>{const a=Ih(),u=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let m=0;m<u.length;m++)a.remove(u[m])})}},deps:[Yb,Pa,We],multi:!0}];class Pv{static init(){!function EM(e){hv=e}(new Pv)}addToWindow(t){qt.getAngularTestability=(a,u=!0)=>{const m=t.findTestabilityInTree(a,u);if(null==m)throw new Error("Could not find testability for element.");return m},qt.getAllAngularTestabilities=()=>t.getAllTestabilities(),qt.getAllAngularRootElements=()=>t.getAllRootElements(),qt.frameworkStabilizers||(qt.frameworkStabilizers=[]),qt.frameworkStabilizers.push(a=>{const u=qt.getAllAngularTestabilities();let m=u.length,b=!1;const D=function(M){b=b||M,m--,0==m&&a(b)};u.forEach(function(M){M.whenStable(D)})})}findTestabilityInTree(t,r,a){if(null==r)return null;const u=t.getTestability(r);return null!=u?u:a?Ih().isShadowRoot(r)?this.findTestabilityInTree(t,r.host,!0):this.findTestabilityInTree(t,r.parentElement,!0):null}}let wI=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=tn({token:e,factory:e.\u0275fac}),e})();const Qg=new Xt("EventManagerPlugins");let e_=(()=>{class e{constructor(r,a){this._zone=a,this._eventNameToPlugin=new Map,r.forEach(u=>u.manager=this),this._plugins=r.slice().reverse()}addEventListener(r,a,u){return this._findPluginFor(a).addEventListener(r,a,u)}addGlobalEventListener(r,a,u){return this._findPluginFor(a).addGlobalEventListener(r,a,u)}getZone(){return this._zone}_findPluginFor(r){const a=this._eventNameToPlugin.get(r);if(a)return a;const u=this._plugins;for(let m=0;m<u.length;m++){const b=u[m];if(b.supports(r))return this._eventNameToPlugin.set(r,b),b}throw new Error(`No event manager plugin found for event ${r}`)}}return e.\u0275fac=function(r){return new(r||e)(dt(Qg),dt(No))},e.\u0275prov=tn({token:e,factory:e.\u0275fac}),e})();class Qb{constructor(t){this._doc=t}addGlobalEventListener(t,r,a){const u=Ih().getGlobalEventTarget(this._doc,t);if(!u)throw new Error(`Unsupported event target ${u} for event ${r}`);return this.addEventListener(u,r,a)}}let ew=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(r){const a=new Set;r.forEach(u=>{this._stylesSet.has(u)||(this._stylesSet.add(u),a.add(u))}),this.onStylesAdded(a)}onStylesAdded(r){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=tn({token:e,factory:e.\u0275fac}),e})(),qf=(()=>{class e extends ew{constructor(r){super(),this._doc=r,this._hostNodes=new Map,this._hostNodes.set(r.head,[])}_addStylesToHost(r,a,u){r.forEach(m=>{const b=this._doc.createElement("style");b.textContent=m,u.push(a.appendChild(b))})}addHost(r){const a=[];this._addStylesToHost(this._stylesSet,r,a),this._hostNodes.set(r,a)}removeHost(r){const a=this._hostNodes.get(r);a&&a.forEach(tw),this._hostNodes.delete(r)}onStylesAdded(r){this._hostNodes.forEach((a,u)=>{this._addStylesToHost(r,u,a)})}ngOnDestroy(){this._hostNodes.forEach(r=>r.forEach(tw))}}return e.\u0275fac=function(r){return new(r||e)(dt(Pa))},e.\u0275prov=tn({token:e,factory:e.\u0275fac}),e})();function tw(e){Ih().remove(e)}const kv={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Fv=/%COMP%/g;function t_(e,t,r){for(let a=0;a<t.length;a++){let u=t[a];Array.isArray(u)?t_(e,u,r):(u=u.replace(Fv,e),r.push(u))}return r}function iw(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let Rv=(()=>{class e{constructor(r,a,u){this.eventManager=r,this.sharedStylesHost=a,this.appId=u,this.rendererByCompId=new Map,this.defaultRenderer=new Lv(r)}createRenderer(r,a){if(!r||!a)return this.defaultRenderer;switch(a.encapsulation){case Pi.Emulated:{let u=this.rendererByCompId.get(a.id);return u||(u=new SI(this.eventManager,this.sharedStylesHost,a,this.appId),this.rendererByCompId.set(a.id,u)),u.applyToHost(r),u}case 1:case Pi.ShadowDom:return new II(this.eventManager,this.sharedStylesHost,r,a);default:if(!this.rendererByCompId.has(a.id)){const u=t_(a.id,a.styles,[]);this.sharedStylesHost.addStyles(u),this.rendererByCompId.set(a.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(r){return new(r||e)(dt(e_),dt(qf),dt(jf))},e.\u0275prov=tn({token:e,factory:e.\u0275fac}),e})();class Lv{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,r){return r?document.createElementNS(kv[r]||r,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,r){t.appendChild(r)}insertBefore(t,r,a){t&&t.insertBefore(r,a)}removeChild(t,r){t&&t.removeChild(r)}selectRootElement(t,r){let a="string"==typeof t?document.querySelector(t):t;if(!a)throw new Error(`The selector "${t}" did not match any elements`);return r||(a.textContent=""),a}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,r,a,u){if(u){r=u+":"+r;const m=kv[u];m?t.setAttributeNS(m,r,a):t.setAttribute(r,a)}else t.setAttribute(r,a)}removeAttribute(t,r,a){if(a){const u=kv[a];u?t.removeAttributeNS(u,r):t.removeAttribute(`${a}:${r}`)}else t.removeAttribute(r)}addClass(t,r){t.classList.add(r)}removeClass(t,r){t.classList.remove(r)}setStyle(t,r,a,u){u&(yi.DashCase|yi.Important)?t.style.setProperty(r,a,u&yi.Important?"important":""):t.style[r]=a}removeStyle(t,r,a){a&yi.DashCase?t.style.removeProperty(r):t.style[r]=""}setProperty(t,r,a){t[r]=a}setValue(t,r){t.nodeValue=r}listen(t,r,a){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,r,iw(a)):this.eventManager.addEventListener(t,r,iw(a))}}class SI extends Lv{constructor(t,r,a,u){super(t),this.component=a;const m=t_(u+"-"+a.id,a.styles,[]);r.addStyles(m),this.contentAttr=function DI(e){return"_ngcontent-%COMP%".replace(Fv,e)}(u+"-"+a.id),this.hostAttr=function TI(e){return"_nghost-%COMP%".replace(Fv,e)}(u+"-"+a.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,r){const a=super.createElement(t,r);return super.setAttribute(a,this.contentAttr,""),a}}class II extends Lv{constructor(t,r,a,u){super(t),this.sharedStylesHost=r,this.hostEl=a,this.shadowRoot=a.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const m=t_(u.id,u.styles,[]);for(let b=0;b<m.length;b++){const D=document.createElement("style");D.textContent=m[b],this.shadowRoot.appendChild(D)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,r){return super.appendChild(this.nodeOrShadowRoot(t),r)}insertBefore(t,r,a){return super.insertBefore(this.nodeOrShadowRoot(t),r,a)}removeChild(t,r){return super.removeChild(this.nodeOrShadowRoot(t),r)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let AI=(()=>{class e extends Qb{constructor(r){super(r)}supports(r){return!0}addEventListener(r,a,u){return r.addEventListener(a,u,!1),()=>this.removeEventListener(r,a,u)}removeEventListener(r,a,u){return r.removeEventListener(a,u)}}return e.\u0275fac=function(r){return new(r||e)(dt(Pa))},e.\u0275prov=tn({token:e,factory:e.\u0275fac}),e})();const sw=["alt","control","meta","shift"],kI={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},aw={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},FI={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let RI=(()=>{class e extends Qb{constructor(r){super(r)}supports(r){return null!=e.parseEventName(r)}addEventListener(r,a,u){const m=e.parseEventName(a),b=e.eventCallback(m.fullKey,u,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ih().onAndCancel(r,m.domEventName,b))}static parseEventName(r){const a=r.toLowerCase().split("."),u=a.shift();if(0===a.length||"keydown"!==u&&"keyup"!==u)return null;const m=e._normalizeKey(a.pop());let b="";if(sw.forEach(M=>{const k=a.indexOf(M);k>-1&&(a.splice(k,1),b+=M+".")}),b+=m,0!=a.length||0===m.length)return null;const D={};return D.domEventName=u,D.fullKey=b,D}static getEventFullKey(r){let a="",u=function LI(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&aw.hasOwnProperty(t)&&(t=aw[t]))}return kI[t]||t}(r);return u=u.toLowerCase()," "===u?u="space":"."===u&&(u="dot"),sw.forEach(m=>{m!=u&&FI[m](r)&&(a+=m+".")}),a+=u,a}static eventCallback(r,a,u){return m=>{e.getEventFullKey(m)===r&&u.runGuarded(()=>a(m))}}static _normalizeKey(r){return"esc"===r?"escape":r}}return e.\u0275fac=function(r){return new(r||e)(dt(Pa))},e.\u0275prov=tn({token:e,factory:e.\u0275fac}),e})();const NI=fb(qM,"browser",[{provide:Bg,useValue:"browser"},{provide:cb,useValue:function OI(){Av.makeCurrent(),Pv.init()},multi:!0},{provide:Pa,useFactory:function BI(){return function Fc(e){Nl=e}(document),document},deps:[]}]),VI=[{provide:S,useValue:"root"},{provide:ah,useFactory:function zI(){return new ah},deps:[]},{provide:Qg,useClass:AI,multi:!0,deps:[Pa,No,Bg]},{provide:Qg,useClass:RI,multi:!0,deps:[Pa]},{provide:Rv,useClass:Rv,deps:[e_,qf,jf]},{provide:T1,useExisting:Rv},{provide:ew,useExisting:qf},{provide:qf,useClass:qf,deps:[Pa]},{provide:uv,useClass:uv,deps:[No]},{provide:e_,useClass:e_,deps:[Qg,No]},{provide:Jb,useClass:wI,deps:[]}];let jI=(()=>{class e{constructor(r){if(r)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(r){return{ngModule:e,providers:[{provide:jf,useValue:r.appId},{provide:Yb,useExisting:jf},bI]}}}return e.\u0275fac=function(r){return new(r||e)(dt(e,12))},e.\u0275mod=so({type:e}),e.\u0275inj=Xr({providers:VI,imports:[dI,ZM]}),e})();"undefined"!=typeof window&&window;class uw{}class hw{}class _c{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(r=>{const a=r.indexOf(":");if(a>0){const u=r.slice(0,a),m=u.toLowerCase(),b=r.slice(a+1).trim();this.maybeSetNormalizedName(u,m),this.headers.has(m)?this.headers.get(m).push(b):this.headers.set(m,[b])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(r=>{let a=t[r];const u=r.toLowerCase();"string"==typeof a&&(a=[a]),a.length>0&&(this.headers.set(u,a),this.maybeSetNormalizedName(r,u))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const r=this.headers.get(t.toLowerCase());return r&&r.length>0?r[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,r){return this.clone({name:t,value:r,op:"a"})}set(t,r){return this.clone({name:t,value:r,op:"s"})}delete(t,r){return this.clone({name:t,value:r,op:"d"})}maybeSetNormalizedName(t,r){this.normalizedNames.has(r)||this.normalizedNames.set(r,t)}init(){this.lazyInit&&(this.lazyInit instanceof _c?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(r=>{this.headers.set(r,t.headers.get(r)),this.normalizedNames.set(r,t.normalizedNames.get(r))})}clone(t){const r=new _c;return r.lazyInit=this.lazyInit&&this.lazyInit instanceof _c?this.lazyInit:this,r.lazyUpdate=(this.lazyUpdate||[]).concat([t]),r}applyUpdate(t){const r=t.name.toLowerCase();switch(t.op){case"a":case"s":let a=t.value;if("string"==typeof a&&(a=[a]),0===a.length)return;this.maybeSetNormalizedName(t.name,r);const u=("a"===t.op?this.headers.get(r):void 0)||[];u.push(...a),this.headers.set(r,u);break;case"d":const m=t.value;if(m){let b=this.headers.get(r);if(!b)return;b=b.filter(D=>-1===m.indexOf(D)),0===b.length?(this.headers.delete(r),this.normalizedNames.delete(r)):this.headers.set(r,b)}else this.headers.delete(r),this.normalizedNames.delete(r)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(r=>t(this.normalizedNames.get(r),this.headers.get(r)))}}class tA{encodeKey(t){return dw(t)}encodeValue(t){return dw(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const rA=/%(\d[a-f0-9])/gi,iA={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function dw(e){return encodeURIComponent(e).replace(rA,(t,r)=>{var a;return null!==(a=iA[r])&&void 0!==a?a:t})}function pw(e){return`${e}`}class du{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new tA,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function nA(e,t){const r=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(u=>{const m=u.indexOf("="),[b,D]=-1==m?[t.decodeKey(u),""]:[t.decodeKey(u.slice(0,m)),t.decodeValue(u.slice(m+1))],M=r.get(b)||[];M.push(D),r.set(b,M)}),r}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(r=>{const a=t.fromObject[r];this.map.set(r,Array.isArray(a)?a:[a])})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const r=this.map.get(t);return r?r[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,r){return this.clone({param:t,value:r,op:"a"})}appendAll(t){const r=[];return Object.keys(t).forEach(a=>{const u=t[a];Array.isArray(u)?u.forEach(m=>{r.push({param:a,value:m,op:"a"})}):r.push({param:a,value:u,op:"a"})}),this.clone(r)}set(t,r){return this.clone({param:t,value:r,op:"s"})}delete(t,r){return this.clone({param:t,value:r,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const r=this.encoder.encodeKey(t);return this.map.get(t).map(a=>r+"="+this.encoder.encodeValue(a)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const r=new du({encoder:this.encoder});return r.cloneFrom=this.cloneFrom||this,r.updates=(this.updates||[]).concat(t),r}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const r=("a"===t.op?this.map.get(t.param):void 0)||[];r.push(pw(t.value)),this.map.set(t.param,r);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let a=this.map.get(t.param)||[];const u=a.indexOf(pw(t.value));-1!==u&&a.splice(u,1),a.length>0?this.map.set(t.param,a):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class oA{constructor(){this.map=new Map}set(t,r){return this.map.set(t,r),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function fw(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function mw(e){return"undefined"!=typeof Blob&&e instanceof Blob}function gw(e){return"undefined"!=typeof FormData&&e instanceof FormData}class Zf{constructor(t,r,a,u){let m;if(this.url=r,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function sA(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||u?(this.body=void 0!==a?a:null,m=u):m=a,m&&(this.reportProgress=!!m.reportProgress,this.withCredentials=!!m.withCredentials,m.responseType&&(this.responseType=m.responseType),m.headers&&(this.headers=m.headers),m.context&&(this.context=m.context),m.params&&(this.params=m.params)),this.headers||(this.headers=new _c),this.context||(this.context=new oA),this.params){const b=this.params.toString();if(0===b.length)this.urlWithParams=r;else{const D=r.indexOf("?");this.urlWithParams=r+(-1===D?"?":D<r.length-1?"&":"")+b}}else this.params=new du,this.urlWithParams=r}serializeBody(){return null===this.body?null:fw(this.body)||mw(this.body)||gw(this.body)||function aA(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof du?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||gw(this.body)?null:mw(this.body)?this.body.type||null:fw(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof du?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var r;const a=t.method||this.method,u=t.url||this.url,m=t.responseType||this.responseType,b=void 0!==t.body?t.body:this.body,D=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,M=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let k=t.headers||this.headers,B=t.params||this.params;const G=null!==(r=t.context)&&void 0!==r?r:this.context;return void 0!==t.setHeaders&&(k=Object.keys(t.setHeaders).reduce((Y,ae)=>Y.set(ae,t.setHeaders[ae]),k)),t.setParams&&(B=Object.keys(t.setParams).reduce((Y,ae)=>Y.set(ae,t.setParams[ae]),B)),new Zf(a,u,b,{params:B,headers:k,context:G,reportProgress:M,responseType:m,withCredentials:D})}}var Zr=(()=>((Zr=Zr||{})[Zr.Sent=0]="Sent",Zr[Zr.UploadProgress=1]="UploadProgress",Zr[Zr.ResponseHeader=2]="ResponseHeader",Zr[Zr.DownloadProgress=3]="DownloadProgress",Zr[Zr.Response=4]="Response",Zr[Zr.User=5]="User",Zr))();class zv{constructor(t,r=200,a="OK"){this.headers=t.headers||new _c,this.status=void 0!==t.status?t.status:r,this.statusText=t.statusText||a,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class Bv extends zv{constructor(t={}){super(t),this.type=Zr.ResponseHeader}clone(t={}){return new Bv({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class n_ extends zv{constructor(t={}){super(t),this.type=Zr.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new n_({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class _w extends zv{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function Nv(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let yw=(()=>{class e{constructor(r){this.handler=r}request(r,a,u={}){let m;if(r instanceof Zf)m=r;else{let M,k;M=u.headers instanceof _c?u.headers:new _c(u.headers),u.params&&(k=u.params instanceof du?u.params:new du({fromObject:u.params})),m=new Zf(r,a,void 0!==u.body?u.body:null,{headers:M,context:u.context,params:k,reportProgress:u.reportProgress,responseType:u.responseType||"json",withCredentials:u.withCredentials})}const b=function YI(...e){return $n(e,rt(e))}(m).pipe(function QI(e,t){return jn(t)?le(e,t,1):le(e,1)}(M=>this.handler.handle(M)));if(r instanceof Zf||"events"===u.observe)return b;const D=b.pipe(function eA(e,t){return ro((r,a)=>{let u=0;r.subscribe(new Wr(a,m=>e.call(t,m,u++)&&a.next(m)))})}(M=>M instanceof n_));switch(u.observe||"body"){case"body":switch(m.responseType){case"arraybuffer":return D.pipe(zr(M=>{if(null!==M.body&&!(M.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return M.body}));case"blob":return D.pipe(zr(M=>{if(null!==M.body&&!(M.body instanceof Blob))throw new Error("Response is not a Blob.");return M.body}));case"text":return D.pipe(zr(M=>{if(null!==M.body&&"string"!=typeof M.body)throw new Error("Response is not a string.");return M.body}));default:return D.pipe(zr(M=>M.body))}case"response":return D;default:throw new Error(`Unreachable: unhandled observe type ${u.observe}}`)}}delete(r,a={}){return this.request("DELETE",r,a)}get(r,a={}){return this.request("GET",r,a)}head(r,a={}){return this.request("HEAD",r,a)}jsonp(r,a){return this.request("JSONP",r,{params:(new du).append(a,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(r,a={}){return this.request("OPTIONS",r,a)}patch(r,a,u={}){return this.request("PATCH",r,Nv(u,a))}post(r,a,u={}){return this.request("POST",r,Nv(u,a))}put(r,a,u={}){return this.request("PUT",r,Nv(u,a))}}return e.\u0275fac=function(r){return new(r||e)(dt(uw))},e.\u0275prov=tn({token:e,factory:e.\u0275fac}),e})();class vw{constructor(t,r){this.next=t,this.interceptor=r}handle(t){return this.interceptor.intercept(t,this.next)}}const xw=new Xt("HTTP_INTERCEPTORS");let lA=(()=>{class e{intercept(r,a){return a.handle(r)}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=tn({token:e,factory:e.\u0275fac}),e})();const cA=/^\)\]\}',?\n/;let bw=(()=>{class e{constructor(r){this.xhrFactory=r}handle(r){if("JSONP"===r.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new xn(a=>{const u=this.xhrFactory.build();if(u.open(r.method,r.urlWithParams),r.withCredentials&&(u.withCredentials=!0),r.headers.forEach((ae,ye)=>u.setRequestHeader(ae,ye.join(","))),r.headers.has("Accept")||u.setRequestHeader("Accept","application/json, text/plain, */*"),!r.headers.has("Content-Type")){const ae=r.detectContentTypeHeader();null!==ae&&u.setRequestHeader("Content-Type",ae)}if(r.responseType){const ae=r.responseType.toLowerCase();u.responseType="json"!==ae?ae:"text"}const m=r.serializeBody();let b=null;const D=()=>{if(null!==b)return b;const ae=u.statusText||"OK",ye=new _c(u.getAllResponseHeaders()),Oe=function uA(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(u)||r.url;return b=new Bv({headers:ye,status:u.status,statusText:ae,url:Oe}),b},M=()=>{let{headers:ae,status:ye,statusText:Oe,url:He}=D(),$e=null;204!==ye&&($e=void 0===u.response?u.responseText:u.response),0===ye&&(ye=$e?200:0);let Se=ye>=200&&ye<300;if("json"===r.responseType&&"string"==typeof $e){const pt=$e;$e=$e.replace(cA,"");try{$e=""!==$e?JSON.parse($e):null}catch(jt){$e=pt,Se&&(Se=!1,$e={error:jt,text:$e})}}Se?(a.next(new n_({body:$e,headers:ae,status:ye,statusText:Oe,url:He||void 0})),a.complete()):a.error(new _w({error:$e,headers:ae,status:ye,statusText:Oe,url:He||void 0}))},k=ae=>{const{url:ye}=D(),Oe=new _w({error:ae,status:u.status||0,statusText:u.statusText||"Unknown Error",url:ye||void 0});a.error(Oe)};let B=!1;const G=ae=>{B||(a.next(D()),B=!0);let ye={type:Zr.DownloadProgress,loaded:ae.loaded};ae.lengthComputable&&(ye.total=ae.total),"text"===r.responseType&&!!u.responseText&&(ye.partialText=u.responseText),a.next(ye)},Y=ae=>{let ye={type:Zr.UploadProgress,loaded:ae.loaded};ae.lengthComputable&&(ye.total=ae.total),a.next(ye)};return u.addEventListener("load",M),u.addEventListener("error",k),u.addEventListener("timeout",k),u.addEventListener("abort",k),r.reportProgress&&(u.addEventListener("progress",G),null!==m&&u.upload&&u.upload.addEventListener("progress",Y)),u.send(m),a.next({type:Zr.Sent}),()=>{u.removeEventListener("error",k),u.removeEventListener("abort",k),u.removeEventListener("load",M),u.removeEventListener("timeout",k),r.reportProgress&&(u.removeEventListener("progress",G),null!==m&&u.upload&&u.upload.removeEventListener("progress",Y)),u.readyState!==u.DONE&&u.abort()}})}}return e.\u0275fac=function(r){return new(r||e)(dt(Jb))},e.\u0275prov=tn({token:e,factory:e.\u0275fac}),e})();const Vv=new Xt("XSRF_COOKIE_NAME"),jv=new Xt("XSRF_HEADER_NAME");class ww{}let hA=(()=>{class e{constructor(r,a,u){this.doc=r,this.platform=a,this.cookieName=u,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const r=this.doc.cookie||"";return r!==this.lastCookieString&&(this.parseCount++,this.lastToken=Ub(r,this.cookieName),this.lastCookieString=r),this.lastToken}}return e.\u0275fac=function(r){return new(r||e)(dt(Pa),dt(Bg),dt(Vv))},e.\u0275prov=tn({token:e,factory:e.\u0275fac}),e})(),Uv=(()=>{class e{constructor(r,a){this.tokenService=r,this.headerName=a}intercept(r,a){const u=r.url.toLowerCase();if("GET"===r.method||"HEAD"===r.method||u.startsWith("http://")||u.startsWith("https://"))return a.handle(r);const m=this.tokenService.getToken();return null!==m&&!r.headers.has(this.headerName)&&(r=r.clone({headers:r.headers.set(this.headerName,m)})),a.handle(r)}}return e.\u0275fac=function(r){return new(r||e)(dt(ww),dt(jv))},e.\u0275prov=tn({token:e,factory:e.\u0275fac}),e})(),dA=(()=>{class e{constructor(r,a){this.backend=r,this.injector=a,this.chain=null}handle(r){if(null===this.chain){const a=this.injector.get(xw,[]);this.chain=a.reduceRight((u,m)=>new vw(u,m),this.backend)}return this.chain.handle(r)}}return e.\u0275fac=function(r){return new(r||e)(dt(hw),dt(We))},e.\u0275prov=tn({token:e,factory:e.\u0275fac}),e})(),pA=(()=>{class e{static disable(){return{ngModule:e,providers:[{provide:Uv,useClass:lA}]}}static withOptions(r={}){return{ngModule:e,providers:[r.cookieName?{provide:Vv,useValue:r.cookieName}:[],r.headerName?{provide:jv,useValue:r.headerName}:[]]}}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=so({type:e}),e.\u0275inj=Xr({providers:[Uv,{provide:xw,useExisting:Uv,multi:!0},{provide:ww,useClass:hA},{provide:Vv,useValue:"XSRF-TOKEN"},{provide:jv,useValue:"X-XSRF-TOKEN"}]}),e})(),fA=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=so({type:e}),e.\u0275inj=Xr({providers:[yw,{provide:uw,useClass:dA},bw,{provide:hw,useExisting:bw}],imports:[[pA.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),e})();const{isArray:mA}=Array,{getPrototypeOf:gA,prototype:_A,keys:yA}=Object;function Ew(e){if(1===e.length){const t=e[0];if(mA(t))return{args:t,keys:null};if(function vA(e){return e&&"object"==typeof e&&gA(e)===_A}(t)){const r=yA(t);return{args:r.map(a=>t[a]),keys:r}}}return{args:e,keys:null}}const{isArray:xA}=Array;function Cw(e){return zr(t=>function bA(e,t){return xA(t)?e(...t):e(t)}(e,t))}function Dw(e,t){return e.reduce((r,a,u)=>(r[a]=t[u],r),{})}let Tw=(()=>{class e{constructor(r,a){this._renderer=r,this._elementRef=a,this.onChange=u=>{},this.onTouched=()=>{}}setProperty(r,a){this._renderer.setProperty(this._elementRef.nativeElement,r,a)}registerOnTouched(r){this.onTouched=r}registerOnChange(r){this.onChange=r}setDisabledState(r){this.setProperty("disabled",r)}}return e.\u0275fac=function(r){return new(r||e)(Ye(Mh),Ye(Ia))},e.\u0275dir=Dt({type:e}),e})(),Ah=(()=>{class e extends Tw{}return e.\u0275fac=function(){let t;return function(a){return(t||(t=function jr(e){return En(()=>{const t=e.prototype.constructor,r=t[To]||$u(t),a=Object.prototype;let u=Object.getPrototypeOf(e.prototype).constructor;for(;u&&u!==a;){const m=u[To]||$u(u);if(m&&m!==r)return m;u=Object.getPrototypeOf(u)}return m=>new m})}(e)))(a||e)}}(),e.\u0275dir=Dt({type:e,features:[St]}),e})();const vl=new Xt("NgValueAccessor"),CA={provide:vl,useExisting:wn(()=>r_),multi:!0},TA=new Xt("CompositionEventMode");let r_=(()=>{class e extends Tw{constructor(r,a,u){super(r,a),this._compositionMode=u,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function DA(){const e=Ih()?Ih().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(r){this.setProperty("value",null==r?"":r)}_handleInput(r){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(r)}_compositionStart(){this._composing=!0}_compositionEnd(r){this._composing=!1,this._compositionMode&&this.onChange(r)}}return e.\u0275fac=function(r){return new(r||e)(Ye(Mh),Ye(Ia),Ye(TA,8))},e.\u0275dir=Dt({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,a){1&r&&Di("input",function(m){return a._handleInput(m.target.value)})("blur",function(){return a.onTouched()})("compositionstart",function(){return a._compositionStart()})("compositionend",function(m){return a._compositionEnd(m.target.value)})},features:[dr([CA]),St]}),e})();const Qi=new Xt("NgValidators"),fu=new Xt("NgAsyncValidators");function zw(e){return null!=e}function Bw(e){const t=Eg(e)?$n(e):e;return o0(t),t}function Nw(e){let t={};return e.forEach(r=>{t=null!=r?Object.assign(Object.assign({},t),r):t}),0===Object.keys(t).length?null:t}function Vw(e,t){return t.map(r=>r(e))}function jw(e){return e.map(t=>function SA(e){return!e.validate}(t)?t:r=>t.validate(r))}function Gv(e){return null!=e?function Uw(e){if(!e)return null;const t=e.filter(zw);return 0==t.length?null:function(r){return Nw(Vw(r,t))}}(jw(e)):null}function $v(e){return null!=e?function Gw(e){if(!e)return null;const t=e.filter(zw);return 0==t.length?null:function(r){return function wA(...e){const t=Le(e),{args:r,keys:a}=Ew(e),u=new xn(m=>{const{length:b}=r;if(!b)return void m.complete();const D=new Array(b);let M=b,k=b;for(let B=0;B<b;B++){let G=!1;Pr(r[B]).subscribe(new Wr(m,Y=>{G||(G=!0,k--),D[B]=Y},()=>M--,void 0,()=>{(!M||!G)&&(k||m.next(a?Dw(a,D):D),m.complete())}))}});return t?u.pipe(Cw(t)):u}(Vw(r,t).map(Bw)).pipe(zr(Nw))}}(jw(e)):null}function $w(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}function Hv(e){return e?Array.isArray(e)?e:[e]:[]}function o_(e,t){return Array.isArray(e)?e.includes(t):e===t}function Zw(e,t){const r=Hv(t);return Hv(e).forEach(u=>{o_(r,u)||r.push(u)}),r}function Ww(e,t){return Hv(t).filter(r=>!o_(e,r))}class Xw{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=Gv(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=$v(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,r){return!!this.control&&this.control.hasError(t,r)}getError(t,r){return this.control?this.control.getError(t,r):null}}class mu extends Xw{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class _o extends Xw{get formDirective(){return null}get path(){return null}}let Jw=(()=>{class e extends class Kw{constructor(t){this._cd=t}is(t){var r,a,u;return"submitted"===t?!!(null===(r=this._cd)||void 0===r?void 0:r.submitted):!!(null===(u=null===(a=this._cd)||void 0===a?void 0:a.control)||void 0===u?void 0:u[t])}}{constructor(r){super(r)}}return e.\u0275fac=function(r){return new(r||e)(Ye(mu,2))},e.\u0275dir=Dt({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,a){2&r&&Cg("ng-untouched",a.is("untouched"))("ng-touched",a.is("touched"))("ng-pristine",a.is("pristine"))("ng-dirty",a.is("dirty"))("ng-valid",a.is("valid"))("ng-invalid",a.is("invalid"))("ng-pending",a.is("pending"))},features:[St]}),e})();function Wf(e,t){(function Wv(e,t){const r=function Hw(e){return e._rawValidators}(e);null!==t.validator?e.setValidators($w(r,t.validator)):"function"==typeof r&&e.setValidators([r]);const a=function qw(e){return e._rawAsyncValidators}(e);null!==t.asyncValidator?e.setAsyncValidators($w(a,t.asyncValidator)):"function"==typeof a&&e.setAsyncValidators([a]);const u=()=>e.updateValueAndValidity();c_(t._rawValidators,u),c_(t._rawAsyncValidators,u)})(e,t),t.valueAccessor.writeValue(e.value),function zA(e,t){t.valueAccessor.registerOnChange(r=>{e._pendingValue=r,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&Qw(e,t)})}(e,t),function NA(e,t){const r=(a,u)=>{t.valueAccessor.writeValue(a),u&&t.viewToModelUpdate(a)};e.registerOnChange(r),t._registerOnDestroy(()=>{e._unregisterOnChange(r)})}(e,t),function BA(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&Qw(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function OA(e,t){if(t.valueAccessor.setDisabledState){const r=a=>{t.valueAccessor.setDisabledState(a)};e.registerOnDisabledChange(r),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(r)})}}(e,t)}function c_(e,t){e.forEach(r=>{r.registerOnValidatorChange&&r.registerOnValidatorChange(t)})}function Qw(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function Jv(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}const Xf="VALID",h_="INVALID",np="PENDING",Kf="DISABLED";function Qv(e){return(d_(e)?e.validators:e)||null}function rE(e){return Array.isArray(e)?Gv(e):e||null}function ex(e,t){return(d_(t)?t.asyncValidators:e)||null}function iE(e){return Array.isArray(e)?$v(e):e||null}function d_(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}const tx=e=>e instanceof rx;function sE(e){return(e=>e instanceof cE)(e)?e.value:e.getRawValue()}function aE(e,t){const r=tx(e),a=e.controls;if(!(r?Object.keys(a):a).length)throw new en(1e3,"");if(!a[t])throw new en(1001,"")}function lE(e,t){tx(e),e._forEachChild((a,u)=>{if(void 0===t[u])throw new en(1002,"")})}class nx{constructor(t,r){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=r,this._composedValidatorFn=rE(this._rawValidators),this._composedAsyncValidatorFn=iE(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===Xf}get invalid(){return this.status===h_}get pending(){return this.status==np}get disabled(){return this.status===Kf}get enabled(){return this.status!==Kf}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=rE(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=iE(t)}addValidators(t){this.setValidators(Zw(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(Zw(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(Ww(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(Ww(t,this._rawAsyncValidators))}hasValidator(t){return o_(this._rawValidators,t)}hasAsyncValidator(t){return o_(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(r=>{r.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=np,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const r=this._parentMarkedDirty(t.onlySelf);this.status=Kf,this.errors=null,this._forEachChild(a=>{a.disable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:r})),this._onDisabledChange.forEach(a=>a(!0))}enable(t={}){const r=this._parentMarkedDirty(t.onlySelf);this.status=Xf,this._forEachChild(a=>{a.enable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:r})),this._onDisabledChange.forEach(a=>a(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Xf||this.status===np)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(r=>r._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Kf:Xf}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=np,this._hasOwnPendingAsyncValidator=!0;const r=Bw(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(a=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(a,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,r={}){this.errors=t,this._updateControlsErrors(!1!==r.emitEvent)}get(t){return function GA(e,t,r){if(null==t||(Array.isArray(t)||(t=t.split(r)),Array.isArray(t)&&0===t.length))return null;let a=e;return t.forEach(u=>{a=tx(a)?a.controls.hasOwnProperty(u)?a.controls[u]:null:(e=>e instanceof HA)(a)&&a.at(u)||null}),a}(this,t,".")}getError(t,r){const a=r?this.get(r):this;return a&&a.errors?a.errors[t]:null}hasError(t,r){return!!this.getError(t,r)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new Yi,this.statusChanges=new Yi}_calculateStatus(){return this._allControlsDisabled()?Kf:this.errors?h_:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(np)?np:this._anyControlsHaveStatus(h_)?h_:Xf}_anyControlsHaveStatus(t){return this._anyControls(r=>r.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_isBoxedValue(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){d_(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class cE extends nx{constructor(t=null,r,a){super(Qv(r),ex(a,r)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(r),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),d_(r)&&r.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(t)?t.value:t)}setValue(t,r={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==r.emitModelToViewChange&&this._onChange.forEach(a=>a(this.value,!1!==r.emitViewToModelChange)),this.updateValueAndValidity(r)}patchValue(t,r={}){this.setValue(t,r)}reset(t=this.defaultValue,r={}){this._applyFormState(t),this.markAsPristine(r),this.markAsUntouched(r),this.setValue(this.value,r),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){Jv(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){Jv(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){this._isBoxedValue(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}}class rx extends nx{constructor(t,r,a){super(Qv(r),ex(a,r)),this.controls=t,this._initObservables(),this._setUpdateStrategy(r),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,r){return this.controls[t]?this.controls[t]:(this.controls[t]=r,r.setParent(this),r._registerOnCollectionChange(this._onCollectionChange),r)}addControl(t,r,a={}){this.registerControl(t,r),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}removeControl(t,r={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}setControl(t,r,a={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],r&&this.registerControl(t,r),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,r={}){lE(this,t),Object.keys(t).forEach(a=>{aE(this,a),this.controls[a].setValue(t[a],{onlySelf:!0,emitEvent:r.emitEvent})}),this.updateValueAndValidity(r)}patchValue(t,r={}){null!=t&&(Object.keys(t).forEach(a=>{this.controls[a]&&this.controls[a].patchValue(t[a],{onlySelf:!0,emitEvent:r.emitEvent})}),this.updateValueAndValidity(r))}reset(t={},r={}){this._forEachChild((a,u)=>{a.reset(t[u],{onlySelf:!0,emitEvent:r.emitEvent})}),this._updatePristine(r),this._updateTouched(r),this.updateValueAndValidity(r)}getRawValue(){return this._reduceChildren({},(t,r,a)=>(t[a]=sE(r),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(r,a)=>!!a._syncPendingControls()||r);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(r=>{const a=this.controls[r];a&&t(a,r)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const r of Object.keys(this.controls)){const a=this.controls[r];if(this.contains(r)&&t(a))return!0}return!1}_reduceValue(){return this._reduceChildren({},(t,r,a)=>((r.enabled||this.disabled)&&(t[a]=r.value),t))}_reduceChildren(t,r){let a=t;return this._forEachChild((u,m)=>{a=r(a,u,m)}),a}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class HA extends nx{constructor(t,r,a){super(Qv(r),ex(a,r)),this.controls=t,this._initObservables(),this._setUpdateStrategy(r),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(t){return this.controls[t]}push(t,r={}){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}insert(t,r,a={}){this.controls.splice(t,0,r),this._registerControl(r),this.updateValueAndValidity({emitEvent:a.emitEvent})}removeAt(t,r={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),this.updateValueAndValidity({emitEvent:r.emitEvent})}setControl(t,r,a={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),r&&(this.controls.splice(t,0,r),this._registerControl(r)),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,r={}){lE(this,t),t.forEach((a,u)=>{aE(this,u),this.at(u).setValue(a,{onlySelf:!0,emitEvent:r.emitEvent})}),this.updateValueAndValidity(r)}patchValue(t,r={}){null!=t&&(t.forEach((a,u)=>{this.at(u)&&this.at(u).patchValue(a,{onlySelf:!0,emitEvent:r.emitEvent})}),this.updateValueAndValidity(r))}reset(t=[],r={}){this._forEachChild((a,u)=>{a.reset(t[u],{onlySelf:!0,emitEvent:r.emitEvent})}),this._updatePristine(r),this._updateTouched(r),this.updateValueAndValidity(r)}getRawValue(){return this.controls.map(t=>sE(t))}clear(t={}){this.controls.length<1||(this._forEachChild(r=>r._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:t.emitEvent}))}_syncPendingControls(){let t=this.controls.reduce((r,a)=>!!a._syncPendingControls()||r,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){this.controls.forEach((r,a)=>{t(r,a)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(r=>r.enabled&&t(r))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_allControlsDisabled(){for(const t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}}const WA={provide:mu,useExisting:wn(()=>ox)},dE=(()=>Promise.resolve(null))();let ox=(()=>{class e extends mu{constructor(r,a,u,m,b){super(),this._changeDetectorRef=b,this.control=new cE,this._registered=!1,this.update=new Yi,this._parent=r,this._setValidators(a),this._setAsyncValidators(u),this.valueAccessor=function Kv(e,t){if(!t)return null;let r,a,u;return Array.isArray(t),t.forEach(m=>{m.constructor===r_?r=m:function UA(e){return Object.getPrototypeOf(e.constructor)===Ah}(m)?a=m:u=m}),u||a||r||null}(0,m)}ngOnChanges(r){if(this._checkForErrors(),!this._registered||"name"in r){if(this._registered&&(this._checkName(),this.formDirective)){const a=r.name.previousValue;this.formDirective.removeControl({name:a,path:this._getPath(a)})}this._setUpControl()}"isDisabled"in r&&this._updateDisabled(r),function Xv(e,t){if(!e.hasOwnProperty("model"))return!1;const r=e.model;return!!r.isFirstChange()||!Object.is(t,r.currentValue)}(r,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Wf(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(r){dE.then(()=>{var a;this.control.setValue(r,{emitViewToModelChange:!1}),null===(a=this._changeDetectorRef)||void 0===a||a.markForCheck()})}_updateDisabled(r){const a=r.isDisabled.currentValue,u=""===a||a&&"false"!==a;dE.then(()=>{var m;u&&!this.control.disabled?this.control.disable():!u&&this.control.disabled&&this.control.enable(),null===(m=this._changeDetectorRef)||void 0===m||m.markForCheck()})}_getPath(r){return this._parent?function a_(e,t){return[...t.path,e]}(r,this._parent):[r]}}return e.\u0275fac=function(r){return new(r||e)(Ye(_o,9),Ye(Qi,10),Ye(fu,10),Ye(vl,10),Ye(Eb,8))},e.\u0275dir=Dt({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[dr([WA]),St,Po]}),e})(),fE=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=so({type:e}),e.\u0275inj=Xr({}),e})(),x2=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=so({type:e}),e.\u0275inj=Xr({imports:[[fE]]}),e})(),b2=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=so({type:e}),e.\u0275inj=Xr({imports:[x2]}),e})();var Yf=vc(898);const kE_mapbox_accessToken="pk.eyJ1IjoicnhsMyIsImEiOiJjbDBzOTZvOTkwYjNlM2puNTBmamZnbGRiIn0.Bxp9WUS69H7HKEESbWxBjw";class w2 extends Zn{constructor(t,r){super()}schedule(t,r=0){return this}}const p_={setInterval(...e){const{delegate:t}=p_;return((null==t?void 0:t.setInterval)||setInterval)(...e)},clearInterval(e){const{delegate:t}=p_;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},FE={now:()=>(FE.delegate||Date).now(),delegate:void 0};class Qf{constructor(t,r=Qf.now){this.schedulerActionCtor=t,this.now=r}schedule(t,r=0,a){return new this.schedulerActionCtor(this,t).schedule(a,r)}}Qf.now=FE.now;const D2=new class C2 extends Qf{constructor(t,r=Qf.now){super(t,r),this.actions=[],this._active=!1,this._scheduled=void 0}flush(t){const{actions:r}=this;if(this._active)return void r.push(t);let a;this._active=!0;do{if(a=t.execute(t.state,t.delay))break}while(t=r.shift());if(this._active=!1,a){for(;t=r.shift();)t.unsubscribe();throw a}}}(class E2 extends w2{constructor(t,r){super(t,r),this.scheduler=t,this.work=r,this.pending=!1}schedule(t,r=0){if(this.closed)return this;this.state=t;const a=this.id,u=this.scheduler;return null!=a&&(this.id=this.recycleAsyncId(u,a,r)),this.pending=!0,this.delay=r,this.id=this.id||this.requestAsyncId(u,this.id,r),this}requestAsyncId(t,r,a=0){return p_.setInterval(t.flush.bind(t,this),a)}recycleAsyncId(t,r,a=0){if(null!=a&&this.delay===a&&!1===this.pending)return r;p_.clearInterval(r)}execute(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const a=this._execute(t,r);if(a)return a;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,r){let u,a=!1;try{this.work(t)}catch(m){a=!0,u=m||new Error("Scheduled action threw falsy error")}if(a)return this.unsubscribe(),u}unsubscribe(){if(!this.closed){const{id:t,scheduler:r}=this,{actions:a}=r;this.work=this.state=this.scheduler=null,this.pending=!1,d(a,this),null!=t&&(this.id=this.recycleAsyncId(r,t,null)),this.delay=null,super.unsubscribe()}}});function S2(e,t){return e===t}function RE(e,t,r){e?X(r,e,t):t()}function P2(e,t){if(1&e){const r=Af();Ir(0,"div",13),Di("click",function(){const m=ei(r).$implicit;return Da(2).doSuburbFilter(m.Name)}),Sa(1),yr()}if(2&e){const r=t.$implicit;si(1),kf(" ",r.Name,"")}}function k2(e,t){if(1&e&&(Ir(0,"div",11),cu(1,P2,2,1,"div",12),yr()),2&e){const r=Da();si(1),Ls("ngForOf",r.filteredSuburbs)}}function F2(e,t){if(1&e){const r=Af();Ir(0,"span")(1,"label")(2,"input",14),Di("click",function(){const m=ei(r).$implicit;return Da().toggleOffenceFilter(m)}),yr(),Sa(3),yr()()}if(2&e){const r=t.$implicit,a=Da();si(2),Ls("checked",a.isOffenceSelected(r)),si(1),kf(" ",r," ")}}function R2(e,t){if(1&e){const r=Af();Ir(0,"div",17),Di("click",function(){const m=ei(r).$implicit;return Da(2).doSuburbFilter(m.properties.wa_local_2)}),Ir(1,"div"),Sa(2),yr(),Ir(3,"div"),Sa(4),yr()()}if(2&e){const r=t.$implicit,a=Da(2);si(2),Xd(a.toTitleCase(r.properties.wa_local_2)),si(2),Xd(r.properties["crime-rate"])}}function L2(e,t){if(1&e&&(Sf(0),Ir(1,"h3"),Sa(2,"Highest 10"),yr(),Ir(3,"div",15),cu(4,R2,5,2,"div",16),yr(),If()),2&e){const r=Da();si(4),Ls("ngForOf",r.highestCrimeRateLocalities)}}function O2(e,t){if(1&e){const r=Af();Ir(0,"div",17),Di("click",function(){const m=ei(r).$implicit;return Da(2).doSuburbFilter(m.properties.wa_local_2)}),Ir(1,"div"),Sa(2),yr(),Ir(3,"div"),Sa(4),yr()()}if(2&e){const r=t.$implicit,a=Da(2);si(2),Xd(a.toTitleCase(r.properties.wa_local_2)),si(2),Xd(r.properties["crime-rate"])}}function z2(e,t){if(1&e&&(Sf(0),Ir(1,"h3"),Sa(2,"Lowest 10"),yr(),Ir(3,"div",15),cu(4,O2,5,2,"div",16),yr(),If()),2&e){const r=Da();si(4),Ls("ngForOf",r.lowestCrimeRateLocalities)}}var f_=(()=>{return(e=f_||(f_={})).Homicide="Homicide",e.SexualOffences="Sexual Offences",e.AssaultFamily="Assault (Family)",e.AssaultNonFamily="Assault (Non-Family)",e.ThreateningFamily="Threatening Behaviour (Family)",e.ThreateningNonFamily="Threatening Behaviour (Non-Family)",e.Deprivation="Deprivation of Liberty",e.Robbery="Robbery",e.DwellingBurglary="Dwelling Burglary",e.NonDwellingBurglary="Non-Dwelling Burglary",e.StealingMotorVehicle="Stealing of Motor Vehicle",e.Stealing="Stealing",e.PropertyDamage="Property Damage",e.Arson="Arson",e.DrugOffences="Drug Offences",e.Graffiti="Graffiti",e.Fraud="Fraud & Related Offences",e.BreachOfRestraint="Breach of Violence Restraint Order",f_;var e})(),m_=(()=>{return(e=m_||(m_={}))["2011-12"]="2011-12",e["2012-13"]="2012-13",e["2013-14"]="2013-14",e["2014-15"]="2014-15",e["2015-16"]="2015-16",e["2016-17"]="2016-17",e["2017-18"]="2017-18",e["2018-19"]="2018-19",e["2019-20"]="2019-20",e["2020-21"]="2020-21",e["2021-22"]="2021-22",m_;var e})();let B2=(()=>{class e{constructor(r){this.http=r,this.style="mapbox://styles/mapbox/streets-v11",this.lat=-31.95,this.lng=115.86,this.minLat=-32.63,this.maxLat=-31.55,this.minLng=115.63,this.maxLng=116.08,this.geoJsonUrl="assets/suburbs.geojson",this.localitiesUrl="assets/localities.json",this.statsUrl="assets/locality_stats.json",this.populationsUrl="assets/population_data.json",this.hoveredSuburbId=null,this.localities=[],this.localityStats=[],this.offenceList=[],this.highestCrimeRateLocalities=[],this.lowestCrimeRateLocalities=[],this.searchText$=new Vs,this.filteredSuburbs=[],this.offenceList=Object.values(f_),this.selectedOffenceFilters=[...this.offenceList]}toTitleCase(r){let a=r.split(" ");return a=a.map(u=>u[0].toUpperCase()+u.slice(1).toLowerCase()),a.join(" ")}ngOnInit(){this.searchText$.pipe(function T2(e,t=D2){return ro((r,a)=>{let u=null,m=null,b=null;const D=()=>{if(u){u.unsubscribe(),u=null;const k=m;m=null,a.next(k)}};function M(){const k=b+e,B=t.now();if(B<k)return u=this.schedule(void 0,k-B),void a.add(u);D()}r.subscribe(new Wr(a,k=>{m=k,b=t.now(),u||(u=t.schedule(M,e),a.add(u))},()=>{D(),a.complete()},void 0,()=>{m=u=null}))})}(500),function M2(e,t=vo){return e=null!=e?e:S2,ro((r,a)=>{let u,m=!0;r.subscribe(new Wr(a,b=>{const D=t(b);(m||!e(u,D))&&(m=!1,u=D,a.next(b))}))})}()).subscribe(r=>{r.length>2&&this.filterSuburb(r)}),function I2(...e){const t=rt(e),r=Le(e),{args:a,keys:u}=Ew(e);if(0===a.length)return $n([],t);const m=new xn(function A2(e,t,r=vo){return a=>{RE(t,()=>{const{length:u}=e,m=new Array(u);let b=u,D=u;for(let M=0;M<u;M++)RE(t,()=>{const k=$n(e[M],t);let B=!1;k.subscribe(new Wr(a,G=>{m[M]=G,B||(B=!0,D--),D||a.next(r(m.slice()))},()=>{--b||a.complete()}))},a)},a)}}(a,t,u?b=>Dw(u,b):vo));return r?m.pipe(Cw(r)):m}([this.http.get(this.geoJsonUrl),this.http.get(this.localitiesUrl),this.http.get(this.statsUrl),this.http.get(this.populationsUrl)]).subscribe(([r,a,u,m])=>{this.geoJsonData=r,this.localities=a,this.localityStats=u,this.populations=m;let b=[];r.features.forEach(M=>{const k=M.geometry;let B=!1;for(let G=0;G<k.coordinates.length;G++)if(+k.coordinates[0][0][G][0]<this.maxLng&&+k.coordinates[0][0][G][0]>this.minLng&&+k.coordinates[0][0][G][1]<this.maxLat&&+k.coordinates[0][0][G][1]>this.minLat){B=!0;break}B&&b.push(M)}),this.geoJsonData.features=b,this.filteredGeoJsonData=this.geoJsonData,this.recalculateCrimeRates(),this.map=new Yf.Map({accessToken:kE_mapbox_accessToken,container:"map",style:this.style,zoom:12,center:[this.lng,this.lat]}),this.map.setMaxBounds([this.minLng,this.minLat,this.maxLng,this.maxLat]),this.map.addControl(new Yf.NavigationControl),this.map.on("load",()=>{this.map.addSource("westernAustralia",{type:"geojson",data:this.filteredGeoJsonData,generateId:!0}),this.map.addLayer({id:"suburb-fills",type:"fill",source:"westernAustralia",layout:{},paint:{"fill-color":["interpolate",["linear"],["get","crime-rate"],0,"#F6E7D8",4,"#F68989",6,"#C65D7B",10,"#874356",100,"#000"],"fill-opacity":["case",["boolean",["feature-state","hover"],!1],.85,.5]}}),this.map.addLayer({id:"outline",type:"line",source:"westernAustralia",layout:{},paint:{"line-color":"#627BC1","line-width":2}}),this.map.on("mousemove","suburb-fills",M=>{M&&M.features&&M.features.length>0&&(null!==this.hoveredSuburbId&&this.map.setFeatureState({source:"westernAustralia",id:this.hoveredSuburbId},{hover:!1}),this.hoveredSuburbId=M.features[0].id,this.hoveredSuburbName=M.features[0].properties.wa_local_2,this.map.setFeatureState({source:"westernAustralia",id:this.hoveredSuburbId},{hover:!0}))}),this.map.on("mouseleave","suburb-fills",()=>{null!==this.hoveredSuburbId&&this.map.setFeatureState({source:"westernAustralia",id:this.hoveredSuburbId},{hover:!1}),this.hoveredSuburbId=null,this.hoveredSuburbName=null}),this.map.on("click","suburb-fills",M=>{this.showPopup(M.lngLat)})})})}recalculateCrimeRates(){this.geoJsonData.features.forEach(m=>{const b=m.properties.wa_local_2,D=this.populations[b];let M=0;const k=this.localityStats.find(B=>B[0].Locality===this.toTitleCase(b));k&&k.filter(G=>G.FinancialYear===m_["2021-22"]).forEach(G=>{this.selectedOffenceFilters.includes(G.Offence)&&(M+=+G.TotalAnnual)}),m.properties["crime-rate"]=D>=100?+(100*M/D).toFixed(2):NaN});const r=this.geoJsonData.features.filter(m=>m.properties["crime-rate"]>=0);r.sort((m,b)=>+m.properties["crime-rate"]>+b.properties["crime-rate"]?1:+m.properties["crime-rate"]<+b.properties["crime-rate"]?-1:0),this.filteredGeoJsonData.features=r,r.map(m=>m.properties["crime-rate"]);const u=this.geoJsonData.features.filter(m=>m.properties["crime-rate"]>=0);this.highestCrimeRateLocalities=u.slice(-10).reverse(),this.lowestCrimeRateLocalities=u.slice(0,10),this.map&&this.map.getSource("westernAustralia").setData(this.geoJsonData)}toggleOffenceFilter(r){const a=this.selectedOffenceFilters.findIndex(m=>m===r);a>-1?this.selectedOffenceFilters.splice(a,1):this.selectedOffenceFilters.push(r),document.getElementById("selectAll").indeterminate=this.selectedOffenceFilters.length>0&&this.selectedOffenceFilters.length<this.offenceList.length,this.recalculateCrimeRates()}toggleAllFilters(){document.getElementById("selectAll").indeterminate=!1,this.selectedOffenceFilters=this.selectedOffenceFilters.length>0?[]:[...this.offenceList],this.recalculateCrimeRates()}isOffenceSelected(r){return this.selectedOffenceFilters.findIndex(a=>a===r)>-1}filterSuburb(r){this.filteredSuburbs=this.localities.filter(a=>a.Name.toUpperCase().startsWith(r.toUpperCase()))}doSuburbFilter(r){this.filteredSuburbs=[],this.searchText=r[0].toUpperCase()+r.slice(1).toLowerCase();const a=this.filteredGeoJsonData.features.find(u=>u.properties.wa_local_2===r.toUpperCase());if(a){const u=a.geometry.coordinates,m=new Yf.LngLatBounds;u[0][0].forEach(b=>{const D=new Yf.LngLat(b[0],b[1]);m.extend(D)}),this.map.fitBounds(m),this.hoveredSuburbName=r.toUpperCase(),this.showPopup(m.getCenter())}}showPopup(r){this.popup&&this.popup.remove();const a=this.localities.find(u=>u.Name.toUpperCase()===this.hoveredSuburbName);if(a){let u=0;const m=this.populations[a.Name.toUpperCase()],b=this.localityStats.find(Y=>Y[0].Locality===a.Name);b&&b.forEach(Y=>{this.selectedOffenceFilters.includes(Y.Offence)&&(u+=+Y.TotalAnnual)});const D=50,M=10,k=25,B={top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-D],"bottom-left":[k,-1*(D-M+k)],"bottom-right":[-k,-1*(D-M+k)],left:[M,-1*(D-M)],right:[-M,-1*(D-M)]},G=this.geoJsonData.features.findIndex(Y=>Y.properties.wa_local_2===a.Name.toUpperCase())+1;this.popup=new Yf.Popup({offset:B,className:"map-popup"}).setLngLat(r).setHTML(`<div style="padding:0.5rem"><h2 style="padding-left: 3px">${a.Name}</h2><table><tr><td style="font-weight: bold">Rank</td><td style="color: ${G<=50?"green":G<=200?"orange":"red"}">${G}${G%10==1?"st":G%10==2?"nd":G%10==3?"rd":"th"} of ${this.geoJsonData.features.length}</td></tr><tr><td style="font-weight: bold">Crime Rate</td><td>${m>100?(u/m).toFixed(2):"Insufficient data"}</td></tr></table></div>`).setMaxWidth("300px").addTo(this.map)}}onSearchTextChange(r){this.searchText$.next(r)}dismissSuburbs(r){r.currentTarget.contains(r.relatedTarget)}}return e.\u0275fac=function(r){return new(r||e)(Ye(yw))},e.\u0275cmp=$a({type:e,selectors:[["app-map"]],decls:15,vars:6,consts:[[1,"flex-container"],[1,"map-container"],["id","map",1,"match-parent"],["tabindex","0",1,"searchbox",3,"blur"],["type","text","placeholder","Search for a suburb",1,"input",3,"ngModel","ngModelChange"],["class","suburbs-list",4,"ngIf"],[1,"filters"],["type","checkbox","id","selectAll",3,"checked","click"],[4,"ngFor","ngForOf"],[1,"panel-container"],[4,"ngIf"],[1,"suburbs-list"],["class","suburb-row",3,"click",4,"ngFor","ngForOf"],[1,"suburb-row",3,"click"],["type","checkbox",3,"checked","click"],[1,"panel-column"],["class","panel-row",3,"click",4,"ngFor","ngForOf"],[1,"panel-row",3,"click"]],template:function(r,a){1&r&&(Ir(0,"div",0)(1,"div",1),wg(2,"div",2),Ir(3,"div",3),Di("blur",function(m){return a.dismissSuburbs(m)}),Ir(4,"input",4),Di("ngModelChange",function(m){return a.onSearchTextChange(m)}),yr(),cu(5,k2,2,1,"div",5),yr(),Ir(6,"div",6)(7,"span")(8,"label")(9,"input",7),Di("click",function(){return a.toggleAllFilters()}),yr(),Sa(10," Select All "),yr()(),cu(11,F2,4,2,"span",8),yr()(),Ir(12,"div",9),cu(13,L2,5,1,"ng-container",10),cu(14,z2,5,1,"ng-container",10),yr()()),2&r&&(si(4),Ls("ngModel",a.searchText),si(1),Ls("ngIf",a.filteredSuburbs.length>0),si(4),Ls("checked",a.selectedOffenceFilters.length===a.offenceList.length),si(2),Ls("ngForOf",a.offenceList),si(2),Ls("ngIf",a.highestCrimeRateLocalities.length>0),si(1),Ls("ngIf",a.lowestCrimeRateLocalities.length>0))},directives:[r_,Jw,ox,Hb,Gb],styles:['@media only screen and (max-width: 767px){[_nghost-%COMP%]{font-size:12px}}.flex-container[_ngcontent-%COMP%]{display:flex;height:max-content}.map-container[_ngcontent-%COMP%]{flex:2;height:100%;position:relative}.map-container[_ngcontent-%COMP%]   .searchbox[_ngcontent-%COMP%]{padding:.5rem;border-radius:8px;background:white;box-shadow:0 0 3px gray;width:10rem;position:absolute;top:1rem;left:1rem}.map-container[_ngcontent-%COMP%]   .searchbox[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-size:.8rem;padding:.25rem .75rem .25rem .5rem}.map-container[_ngcontent-%COMP%]   .suburbs-list[_ngcontent-%COMP%]{position:absolute;top:2.75rem;left:0rem;background:white;border-radius:4px;box-shadow:0 0 10px gray;padding:.2rem .5rem;width:10rem;max-height:15rem;overflow:auto}.map-container[_ngcontent-%COMP%]   .suburbs-list[_ngcontent-%COMP%]   .suburb-row[_ngcontent-%COMP%]{padding:.5rem 1rem;background:white;cursor:pointer}.map-container[_ngcontent-%COMP%]   .suburbs-list[_ngcontent-%COMP%]   .suburb-row[_ngcontent-%COMP%]:hover{background:lightgrey}.map-container[_ngcontent-%COMP%]   .suburbs-list[_ngcontent-%COMP%]   .suburb-row[_ngcontent-%COMP%]:not(:last-child){border-bottom:1px solid lightgrey}.panel-container[_ngcontent-%COMP%]{flex:1;padding:0 1rem}.panel-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem}.panel-container[_ngcontent-%COMP%]   .panel-column[_ngcontent-%COMP%]{column-count:2}@media only screen and (max-width: 767px){.panel-container[_ngcontent-%COMP%]   .panel-column[_ngcontent-%COMP%]{column-count:1}}.panel-container[_ngcontent-%COMP%]   .panel-column[_ngcontent-%COMP%]   .panel-row[_ngcontent-%COMP%]{border-radius:4px;margin-bottom:.5rem;cursor:pointer;position:relative}.panel-container[_ngcontent-%COMP%]   .panel-column[_ngcontent-%COMP%]   .panel-row[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:0;right:0;bottom:0;border-radius:4px;box-shadow:0 0 5px gray;opacity:0;transition:opacity .3s ease}.panel-container[_ngcontent-%COMP%]   .panel-column[_ngcontent-%COMP%]   .panel-row[_ngcontent-%COMP%]:hover:after{opacity:1}.panel-container[_ngcontent-%COMP%]   .panel-column[_ngcontent-%COMP%]   .panel-row[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2){font-weight:300}.match-parent[_ngcontent-%COMP%]{width:100%;height:60vh;max-width:1000px;margin:0 auto;min-height:400px}.filters[_ngcontent-%COMP%]{max-width:1000px;margin:1rem auto 0;display:flex;flex-wrap:wrap}.filters[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:inline-block;margin-top:.5rem;flex:1;min-width:16rem}.filters[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:not(:last-child){margin-right:.5rem}.filters[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:inline-block}']}),e})(),N2=(()=>{class e{constructor(){this.title="pcmap"}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=$a({type:e,selectors:[["app-root"]],decls:4,vars:0,consts:[[1,"app-main"]],template:function(r,a){1&r&&(Ir(0,"div",0)(1,"h1"),Sa(2,"Perth crime rates divided by suburb (# per 100 residents)"),yr(),wg(3,"app-map"),yr())},directives:[B2],styles:[".app-main[_ngcontent-%COMP%]{padding:1rem}.app-main[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{text-align:center;font-weight:600}"]}),e})(),V2=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=so({type:e,bootstrap:[N2]}),e.\u0275inj=Xr({providers:[],imports:[[jI,fA,b2]]}),e})();(function PM(){xb=!1})(),NI().bootstrapModule(V2).catch(e=>console.error(e))},898:function(rp){rp.exports=function(){"use strict";var yc,vc,jn;function Fh(d,Zn){if(yc)if(vc){var jo="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+yc+")(sharedChunk); ("+vc+")(sharedChunk); self.onerror = null;",ui={};yc(ui),jn=Zn(ui),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(jn.workerUrl=window.URL.createObjectURL(new Blob([jo],{type:"text/javascript"})))}else vc=Zn;else yc=Zn}return Fh(0,function(d){var jo=ui;function ui(i,n,s,l){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(l-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=l,this.p2x=s,this.p2y=l}ui.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},ui.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},ui.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},ui.prototype.solveCurveX=function(i,n){var s,l,h,p,_;for(void 0===n&&(n=1e-6),h=i,_=0;_<8;_++){if(p=this.sampleCurveX(h)-i,Math.abs(p)<n)return h;var v=this.sampleCurveDerivativeX(h);if(Math.abs(v)<1e-6)break;h-=p/v}if((h=i)<(s=0))return s;if(h>(l=1))return l;for(;s<l;){if(p=this.sampleCurveX(h),Math.abs(p-i)<n)return h;i>p?s=h:l=h,h=.5*(l-s)+s}return h},ui.prototype.solve=function(i,n){return this.sampleCurveY(this.solveCurveX(i,n))};var Ke=vt;function vt(i,n){this.x=i,this.y=n}vt.prototype={clone:function(){return new vt(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,n){return this.clone()._rotateAround(i,n)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var n=i.x-this.x,s=i.y-this.y;return n*n+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,n){return Math.atan2(this.x*n-this.y*i,this.x*i+this.y*n)},_matMult:function(i){var n=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=n,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var n=Math.cos(i),s=Math.sin(i),l=s*this.x+n*this.y;return this.x=n*this.x-s*this.y,this.y=l,this},_rotateAround:function(i,n){var s=Math.cos(i),l=Math.sin(i),h=n.y+l*(this.x-n.x)+s*(this.y-n.y);return this.x=n.x+s*(this.x-n.x)-l*(this.y-n.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},vt.convert=function(i){return i instanceof vt?i:Array.isArray(i)?new vt(i[0],i[1]):i};var Ae="undefined"!=typeof self?self:{},Ti=1e-6,Sn="undefined"!=typeof Float32Array?Float32Array:Array;function xl(){var i=new Sn(9);return Sn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function hi(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function bl(i,n,s){var l=n[0],h=n[1],p=n[2],_=n[3],v=n[4],w=n[5],C=n[6],S=n[7],I=n[8],A=n[9],O=n[10],N=n[11],U=n[12],q=n[13],J=n[14],ie=n[15],ce=s[0],he=s[1],pe=s[2],de=s[3];return i[0]=ce*l+he*v+pe*I+de*U,i[1]=ce*h+he*w+pe*A+de*q,i[2]=ce*p+he*C+pe*O+de*J,i[3]=ce*_+he*S+pe*N+de*ie,i[4]=(ce=s[4])*l+(he=s[5])*v+(pe=s[6])*I+(de=s[7])*U,i[5]=ce*h+he*w+pe*A+de*q,i[6]=ce*p+he*C+pe*O+de*J,i[7]=ce*_+he*S+pe*N+de*ie,i[8]=(ce=s[8])*l+(he=s[9])*v+(pe=s[10])*I+(de=s[11])*U,i[9]=ce*h+he*w+pe*A+de*q,i[10]=ce*p+he*C+pe*O+de*J,i[11]=ce*_+he*S+pe*N+de*ie,i[12]=(ce=s[12])*l+(he=s[13])*v+(pe=s[14])*I+(de=s[15])*U,i[13]=ce*h+he*w+pe*A+de*q,i[14]=ce*p+he*C+pe*O+de*J,i[15]=ce*_+he*S+pe*N+de*ie,i}function eo(i,n,s){var l,h,p,_,v,w,C,S,I,A,O,N,U=s[0],q=s[1],J=s[2];return n===i?(i[12]=n[0]*U+n[4]*q+n[8]*J+n[12],i[13]=n[1]*U+n[5]*q+n[9]*J+n[13],i[14]=n[2]*U+n[6]*q+n[10]*J+n[14],i[15]=n[3]*U+n[7]*q+n[11]*J+n[15]):(h=n[1],p=n[2],_=n[3],v=n[4],w=n[5],C=n[6],S=n[7],I=n[8],A=n[9],O=n[10],N=n[11],i[0]=l=n[0],i[1]=h,i[2]=p,i[3]=_,i[4]=v,i[5]=w,i[6]=C,i[7]=S,i[8]=I,i[9]=A,i[10]=O,i[11]=N,i[12]=l*U+v*q+I*J+n[12],i[13]=h*U+w*q+A*J+n[13],i[14]=p*U+C*q+O*J+n[14],i[15]=_*U+S*q+N*J+n[15]),i}function xr(i,n,s){var l=s[0],h=s[1],p=s[2];return i[0]=n[0]*l,i[1]=n[1]*l,i[2]=n[2]*l,i[3]=n[3]*l,i[4]=n[4]*h,i[5]=n[5]*h,i[6]=n[6]*h,i[7]=n[7]*h,i[8]=n[8]*p,i[9]=n[9]*p,i[10]=n[10]*p,i[11]=n[11]*p,i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i}function Uo(i,n,s){var l=Math.sin(s),h=Math.cos(s),p=n[4],_=n[5],v=n[6],w=n[7],C=n[8],S=n[9],I=n[10],A=n[11];return n!==i&&(i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[4]=p*h+C*l,i[5]=_*h+S*l,i[6]=v*h+I*l,i[7]=w*h+A*l,i[8]=C*h-p*l,i[9]=S*h-_*l,i[10]=I*h-v*l,i[11]=A*h-w*l,i}function yo(i,n,s){var l=Math.sin(s),h=Math.cos(s),p=n[0],_=n[1],v=n[2],w=n[3],C=n[8],S=n[9],I=n[10],A=n[11];return n!==i&&(i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[0]=p*h-C*l,i[1]=_*h-S*l,i[2]=v*h-I*l,i[3]=w*h-A*l,i[8]=p*l+C*h,i[9]=_*l+S*h,i[10]=v*l+I*h,i[11]=w*l+A*h,i}Math.hypot||(Math.hypot=function(){for(var i=0,n=arguments.length;n--;)i+=arguments[n]*arguments[n];return Math.sqrt(i)});var Go=bl;function Bs(){var i=new Sn(3);return Sn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function $o(i){var n=new Sn(3);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n}function wl(i){return Math.hypot(i[0],i[1],i[2])}function to(i,n,s){var l=new Sn(3);return l[0]=i,l[1]=n,l[2]=s,l}function El(i,n,s){return i[0]=n[0]+s[0],i[1]=n[1]+s[1],i[2]=n[2]+s[2],i}function fs(i,n,s){return i[0]=n[0]-s[0],i[1]=n[1]-s[1],i[2]=n[2]-s[2],i}function vo(i,n,s){return i[0]=n[0]*s[0],i[1]=n[1]*s[1],i[2]=n[2]*s[2],i}function Rh(i,n,s){return i[0]=Math.max(n[0],s[0]),i[1]=Math.max(n[1],s[1]),i[2]=Math.max(n[2],s[2]),i}function no(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i}function xn(i,n,s,l){return i[0]=n[0]+s[0]*l,i[1]=n[1]+s[1]*l,i[2]=n[2]+s[2]*l,i}function Ns(i,n){var s=n[0],l=n[1],h=n[2],p=s*s+l*l+h*h;return p>0&&(p=1/Math.sqrt(p)),i[0]=n[0]*p,i[1]=n[1]*p,i[2]=n[2]*p,i}function xo(i,n){return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]}function Ra(i,n,s){var l=n[0],h=n[1],p=n[2],_=s[0],v=s[1],w=s[2];return i[0]=h*w-p*v,i[1]=p*_-l*w,i[2]=l*v-h*_,i}function Ht(i,n,s){var l=n[0],h=n[1],p=n[2],_=s[3]*l+s[7]*h+s[11]*p+s[15];return i[0]=(s[0]*l+s[4]*h+s[8]*p+s[12])/(_=_||1),i[1]=(s[1]*l+s[5]*h+s[9]*p+s[13])/_,i[2]=(s[2]*l+s[6]*h+s[10]*p+s[14])/_,i}function Vs(i,n,s){var l=s[0],h=s[1],p=s[2],_=n[0],v=n[1],w=n[2],C=h*w-p*v,S=p*_-l*w,I=l*v-h*_,A=h*I-p*S,O=p*C-l*I,N=l*S-h*C,U=2*s[3];return S*=U,I*=U,O*=2,N*=2,i[0]=_+(C*=U)+(A*=2),i[1]=v+S+O,i[2]=w+I+N,i}var ms,i,js=fs,ro=vo,Wr=wl;function zr(i,n,s){var l=n[0],h=n[1],p=n[2],_=n[3];return i[0]=s[0]*l+s[4]*h+s[8]*p+s[12]*_,i[1]=s[1]*l+s[5]*h+s[9]*p+s[13]*_,i[2]=s[2]*l+s[6]*h+s[10]*p+s[14]*_,i[3]=s[3]*l+s[7]*h+s[11]*p+s[15]*_,i}function Us(){var i=new Sn(4);return Sn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function gu(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function Cl(i,n,s){s*=.5;var l=n[0],h=n[1],p=n[2],_=n[3],v=Math.sin(s),w=Math.cos(s);return i[0]=l*w+_*v,i[1]=h*w+p*v,i[2]=p*w-h*v,i[3]=_*w-l*v,i}function xc(i,n){return i[0]===n[0]&&i[1]===n[1]}Bs(),ms=new Sn(4),Sn!=Float32Array&&(ms[0]=0,ms[1]=0,ms[2]=0,ms[3]=0),Bs(),to(1,0,0),to(0,1,0),Us(),Us(),xl(),i=new Sn(2),Sn!=Float32Array&&(i[0]=0,i[1]=0);const _u=Math.PI/180,Dl=180/Math.PI;function Ot(i){return i*_u}function Mi(i){return i*Dl}const La=[[0,0],[1,0],[1,1],[0,1]];function Oa(i){if(i<=0)return 0;if(i>=1)return 1;const n=i*i,s=n*i;return 4*(i<.5?s:3*(i-n)+s-.75)}function bc(i,n,s,l){const h=new jo(i,n,s,l);return function(p){return h.solve(p)}}const za=bc(.25,.1,.25,1);function cn(i,n,s){return Math.min(s,Math.max(n,i))}function Gs(i,n,s){return(s=cn((s-i)/(n-i),0,1))*s*(3-2*s)}function gs(i,n,s){const l=s-n,h=((i-n)%l+l)%l+n;return h===n?s:h}function Ba(i,n,s){if(!i.length)return s(null,[]);let l=i.length;const h=new Array(i.length);let p=null;i.forEach((_,v)=>{n(_,(w,C)=>{w&&(p=w),h[v]=C,0==--l&&s(p,h)})})}function Bi(i){const n=[];for(const s in i)n.push(i[s]);return n}function Un(i,...n){for(const s of n)for(const l in s)i[l]=s[l];return i}let wc=1;function Tl(){return wc++}function Ec(){return function i(n){return n?(n^16*Math.random()>>n/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Ni(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function yu(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Ml(i,n){i.forEach(s=>{n[s]&&(n[s]=n[s].bind(n))})}function Sl(i,n){return-1!==i.indexOf(n,i.length-n.length)}function $s(i,n,s){const l={};for(const h in i)l[h]=n.call(s||this,i[h],h,i);return l}function Hs(i,n,s){const l={};for(const h in i)n.call(s||this,i[h],h,i)&&(l[h]=i[h]);return l}function Si(i){return Array.isArray(i)?i.map(Si):"object"==typeof i&&i?$s(i,Si):i}const Il={};function An(i){Il[i]||("undefined"!=typeof console&&console.warn(i),Il[i]=!0)}function Ii(i,n,s){return(s.y-i.y)*(n.x-i.x)>(n.y-i.y)*(s.x-i.x)}function Na(i){let n=0;for(let s,l,h=0,p=i.length,_=p-1;h<p;_=h++)s=i[h],l=i[_],n+=(l.x-s.x)*(s.y+l.y);return n}function io(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function qs(i){const n={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,l,h,p)=>{const _=h||p;return n[l]=!_||_.toLowerCase(),""}),n["max-age"]){const s=parseInt(n["max-age"],10);isNaN(s)?delete n["max-age"]:n["max-age"]=s}return n}let _s,bo,Pr,ys=null;function wo(i){if(null==ys){const n=i.navigator?i.navigator.userAgent:null;ys=!!i.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return ys}function Va(i){try{const n=Ae[i];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch(n){return!1}}const Ai={now:()=>void 0!==Pr?Pr:Ae.performance.now(),setNow(i){Pr=i},restoreNow(){Pr=void 0},frame(i){const n=Ae.requestAnimationFrame(i);return{cancel:()=>Ae.cancelAnimationFrame(n)}},getImageData(i,n=0){const s=Ae.document.createElement("canvas"),l=s.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return s.width=i.width,s.height=i.height,l.drawImage(i,0,0,i.width,i.height),l.getImageData(-n,-n,i.width+2*n,i.height+2*n)},resolveURL:i=>(_s||(_s=Ae.document.createElement("a")),_s.href=i,_s.href),get devicePixelRatio(){return Ae.devicePixelRatio},get prefersReducedMotion(){return!!Ae.matchMedia&&(null==bo&&(bo=Ae.matchMedia("(prefers-reduced-motion: reduce)")),bo.matches)}};let K;const L={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==K){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{K=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):i}catch(n){K=i}}return K},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},V={supported:!1,testSupport:function(i){!le&&Q&&(me?fe(i):X=i)}};let X,Q,le=!1,me=!1;function fe(i){const n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Q),i.isContextLost())return;V.supported=!0}catch(s){}i.deleteTexture(n),le=!0}Ae.document&&(Q=Ae.document.createElement("img"),Q.onload=function(){X&&fe(X),X=null,me=!0},Q.onerror=function(){le=!0,X=null},Q.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ue="01",_e="NO_ACCESS_TOKEN";function Te(i){return 0===i.indexOf("mapbox:")}function Ie(i){return L.API_URL_REGEX.test(i)}const Le=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function rt(i){const n=i.match(Le);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function ut(i){const n=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${n}`}function ct(i){if(!i)return null;const n=i.split(".");if(!n||3!==n.length)return null;try{return JSON.parse(decodeURIComponent(Ae.atob(n[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(s){return null}}class ht{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const s=ct(L.ACCESS_TOKEN);let l="";return l=s&&s.u?Ae.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(h,p)=>String.fromCharCode(Number("0x"+p)))):L.ACCESS_TOKEN||"",n?`mapbox.eventData.${n}:${l}`:`mapbox.eventData:${l}`}fetchEventData(){const n=Va("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(n)try{const h=Ae.localStorage.getItem(s);h&&(this.eventData=JSON.parse(h));const p=Ae.localStorage.getItem(l);p&&(this.anonId=p)}catch(h){An("Unable to read from LocalStorage")}}saveEventData(){const n=Va("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(n)try{Ae.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&Ae.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(h){An("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,s,l,h){if(!L.EVENTS_URL)return;const p=rt(L.EVENTS_URL);p.params.push(`access_token=${h||L.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(n).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.7.0",skuId:ue,userId:this.anonId},v=s?Un(_,s):_,w={url:ut(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=qo(w,C=>{this.pendingRequest=null,l(C),this.saveEventData(),this.processRequests(h)})}queueRequest(n,s){this.queue.push(n),this.processRequests(s)}}const Pt=new class extends ht{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,n){L.EVENTS_URL&&L.ACCESS_TOKEN&&Array.isArray(i)&&i.some(s=>Te(s)||Ie(s))&&this.queueRequest(Date.now(),n)}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=ct(L.ACCESS_TOKEN),s=n?n.u:L.ACCESS_TOKEN;let l=s!==this.eventData.tokenU;yu(this.anonId)||(this.anonId=Ec(),l=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),_=new Date(h),v=(h-this.eventData.lastSuccess)/864e5;l=l||v>=1||v<-1||p.getDate()!==_.getDate()}else l=!0;if(!l)return this.processRequests();this.postEvent(h,{"enabled.telemetry":!1},p=>{p||(this.eventData.lastSuccess=h,this.eventData.tokenU=s)},i)}},bn=Pt.postTurnstileEvent.bind(Pt),In=new class extends ht{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,n,s,l){this.skuToken=n,this.errorCb=l,L.EVENTS_URL&&(s||L.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},s):this.errorCb(new Error(_e)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{id:n,timestamp:s}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),yu(this.anonId)||(this.anonId=Ec()),this.postEvent(s,{skuToken:this.skuToken},l=>{l?this.errorCb(l):n&&(this.success[n]=!0)},i))}},gn=In.postMapLoadEvent.bind(In),Tn=new class extends ht{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,n,s,l){if(!L.API_URL||!L.SESSION_PATH)return;const h=rt(L.API_URL+L.SESSION_PATH);h.params.push(`sku=${n||""}`),h.params.push(`access_token=${l||L.ACCESS_TOKEN||""}`);const p={url:ut(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=en(p,_=>{this.pendingRequest=null,s(_),this.saveEventData(),this.processRequests(l)})}getSessionAPI(i,n,s,l){this.skuToken=n,this.errorCb=l,L.SESSION_PATH&&L.API_URL&&(s||L.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},s):this.errorCb(new Error(_e)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{id:n,timestamp:s}=this.queue.shift();n&&this.success[n]||this.getSession(s,this.skuToken,l=>{l?this.errorCb(l):n&&(this.success[n]=!0)},i)}},vs=Tn.getSessionAPI.bind(Tn),Ho=new Set,$n="mapbox-tiles";let Eo,Cc,Lh=500,Al=50;function un(){Ae.caches&&!Eo&&(Eo=Ae.caches.open($n))}function Pl(i){const n=i.indexOf("?");return n<0?i:i.slice(0,n)}let an=1/0;const ja={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ja);class kl extends Error{constructor(n,s,l){401===s&&Ie(l)&&(n+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(n),this.status=s,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const wn=io()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Ae.location.protocol?Ae.parent:Ae).location.href,gt=function(i,n){if(!(/^file:/.test(s=i.url)||/^file:/.test(wn())&&!/^\w+:/.test(s))){if(Ae.fetch&&Ae.Request&&Ae.AbortController&&Ae.Request.prototype.hasOwnProperty("signal"))return function(l,h){const p=new Ae.AbortController,_=new Ae.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:wn(),signal:p.signal});let v=!1,w=!1;const C=(S=_.url).indexOf("sku=")>0&&Ie(S);var S;"json"===l.type&&_.headers.set("Accept","application/json");const I=(O,N,U)=>{if(w)return;if(O&&"SecurityError"!==O.message&&An(O),N&&U)return A(N);const q=Date.now();Ae.fetch(_).then(J=>{if(J.ok){const ie=C?J.clone():null;return A(J,ie,q)}return h(new kl(J.statusText,J.status,l.url))}).catch(J=>{20!==J.code&&h(new Error(J.message))})},A=(O,N,U)=>{("arrayBuffer"===l.type?O.arrayBuffer():"json"===l.type?O.json():O.text()).then(q=>{w||(N&&U&&function(J,ie,ce){if(un(),!Eo)return;const he={status:ie.status,statusText:ie.statusText,headers:new Ae.Headers};ie.headers.forEach((de,Ce)=>he.headers.set(Ce,de));const pe=qs(ie.headers.get("Cache-Control")||"");pe["no-store"]||(pe["max-age"]&&he.headers.set("Expires",new Date(ce+1e3*pe["max-age"]).toUTCString()),new Date(he.headers.get("Expires")).getTime()-ce<42e4||function(de,Ce){if(void 0===Cc)try{new Response(new ReadableStream),Cc=!0}catch(we){Cc=!1}Cc?Ce(de.body):de.blob().then(Ce)}(ie,de=>{const Ce=new Ae.Response(de,he);un(),Eo&&Eo.then(we=>we.put(Pl(J.url),Ce)).catch(we=>An(we.message))}))}(_,N,U),v=!0,h(null,q,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(q=>{w||h(new Error(q.message))})};return C?function(O,N){if(un(),!Eo)return N(null);const U=Pl(O.url);Eo.then(q=>{q.match(U).then(J=>{const ie=function(ce){if(!ce)return!1;const he=new Date(ce.headers.get("Expires")||0),pe=qs(ce.headers.get("Cache-Control")||"");return he>Date.now()&&!pe["no-cache"]}(J);q.delete(U),ie&&q.put(U,J.clone()),N(null,J,ie)}).catch(N)}).catch(N)}(_,I):I(null,null),{cancel:()=>{w=!0,v||p.abort()}}}(i,n);if(io()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,n,void 0,!0)}var s;return function(l,h){const p=new Ae.XMLHttpRequest;p.open(l.method||"GET",l.url,!0),"arrayBuffer"===l.type&&(p.responseType="arraybuffer");for(const _ in l.headers)p.setRequestHeader(_,l.headers[_]);return"json"===l.type&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials="include"===l.credentials,p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||0===p.status)&&null!==p.response){let _=p.response;if("json"===l.type)try{_=JSON.parse(p.response)}catch(v){return h(v)}h(null,_,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new kl(p.statusText,p.status,l.url))},p.send(l.body),{cancel:()=>p.abort()}}(i,n)},Ua=function(i,n){return gt(Un(i,{type:"arrayBuffer"}),n)},qo=function(i,n){return gt(Un(i,{method:"POST"}),n)},en=function(i,n){return gt(Un(i,{method:"GET"}),n)};function Dc(i){const n=Ae.document.createElement("a");return n.href=i,n.protocol===Ae.document.location.protocol&&n.host===Ae.document.location.host}const xt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let tr,Fl;tr=[],Fl=0;const op=function(i,n){if(V.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Fl>=L.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:i,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return tr.push(p),p}Fl++;let s=!1;const l=()=>{if(!s)for(s=!0,Fl--;tr.length&&Fl<L.MAX_PARALLEL_IMAGE_REQUESTS;){const p=tr.shift(),{requestParameters:_,callback:v,cancelled:w}=p;w||(p.cancel=op(_,v).cancel)}},h=Ua(i,(p,_,v,w)=>{l(),p?n(p):_&&(Ae.createImageBitmap?function(C,S){const I=new Ae.Blob([new Uint8Array(C)],{type:"image/png"});Ae.createImageBitmap(I).then(A=>{S(null,A)}).catch(A=>{S(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(C,S)=>n(C,S,v,w)):function(C,S){const I=new Ae.Image,A=Ae.URL;I.onload=()=>{S(null,I),A.revokeObjectURL(I.src),I.onload=null,Ae.requestAnimationFrame(()=>{I.src=xt})},I.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const O=new Ae.Blob([new Uint8Array(C)],{type:"image/png"});I.src=C.byteLength?A.createObjectURL(O):xt}(_,(C,S)=>n(C,S,v,w)))});return{cancel:()=>{h.cancel(),l()}}};function sp(i,n,s){s[i]&&-1!==s[i].indexOf(n)||(s[i]=s[i]||[],s[i].push(n))}function Zs(i,n,s){if(s&&s[i]){const l=s[i].indexOf(n);-1!==l&&s[i].splice(l,1)}}class nr{constructor(n,s={}){Un(this,s),this.type=n}}class vu extends nr{constructor(n,s={}){super("error",Un({error:n},s))}}class xs{on(n,s){return this._listeners=this._listeners||{},sp(n,s,this._listeners),this}off(n,s){return Zs(n,s,this._listeners),Zs(n,s,this._oneTimeListeners),this}once(n,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},sp(n,s,this._oneTimeListeners),this):new Promise(l=>this.once(n,l))}fire(n,s){"string"==typeof n&&(n=new nr(n,s||{}));const l=n.type;if(this.listens(l)){n.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const v of h)v.call(this,n);const p=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const v of p)Zs(l,v,this._oneTimeListeners),v.call(this,n);const _=this._eventedParent;_&&(Un(n,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(n))}else n instanceof vu&&console.error(n.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,s){return this._eventedParent=n,this._eventedParentData=s,this}}var Ee=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class qe{constructor(n,s,l,h){this.message=(n?`${n}: `:"")+l,h&&(this.identifier=h),null!=s&&s.__line__&&(this.line=s.__line__)}}function ap(i){const n=i.value;return n?[new qe(i.key,n,"constants have been deprecated as of v8")]:[]}function Ws(i,...n){for(const s of n)for(const l in s)i[l]=s[l];return i}function Wn(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function bs(i){if(Array.isArray(i))return i.map(bs);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const n={};for(const s in i)n[s]=bs(i[s]);return n}return Wn(i)}class Co extends Error{constructor(n,s){super(s),this.message=s,this.key=n}}class xu{constructor(n,s=[]){this.parent=n,this.bindings={};for(const[l,h]of s)this.bindings[l]=h}concat(n){return new xu(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const ws={kind:"null"},Je={kind:"number"},_t={kind:"string"},ot={kind:"boolean"},Zo={kind:"color"},Rl={kind:"object"},kt={kind:"value"},tn={kind:"collator"},Xs={kind:"formatted"},Xr={kind:"resolvedImage"};function di(i,n){return{kind:"array",itemType:i,N:n}}function Pn(i){if("array"===i.kind){const n=Pn(i.itemType);return"number"==typeof i.N?`array<${n}, ${i.N}>`:"value"===i.itemType.kind?"array":`array<${n}>`}return i.kind}const lp=[ws,Je,_t,ot,Zo,Xs,Rl,di(kt),Xr];function pi(i,n){if("error"===n.kind)return null;if("array"===i.kind){if("array"===n.kind&&(0===n.N&&"value"===n.itemType.kind||!pi(i.itemType,n.itemType))&&("number"!=typeof i.N||i.N===n.N))return null}else{if(i.kind===n.kind)return null;if("value"===i.kind)for(const s of lp)if(!pi(s,n))return null}return`Expected ${Pn(i)} but found ${Pn(n)} instead.`}function Ll(i,n){return n.some(s=>s.kind===i.kind)}function Wo(i,n){return n.some(s=>"null"===s?null===i:"array"===s?Array.isArray(i):"object"===s?i&&!Array.isArray(i)&&"object"==typeof i:s===typeof i)}function Es(i){var n={exports:{}};return i(n,n.exports),n.exports}var Ks=Es(function(i,n){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function l(v){return(v=Math.round(v))<0?0:v>255?255:v}function h(v){return l("%"===v[v.length-1]?parseFloat(v)/100*255:parseInt(v))}function p(v){return(w="%"===v[v.length-1]?parseFloat(v)/100:parseFloat(v))<0?0:w>1?1:w;var w}function _(v,w,C){return C<0?C+=1:C>1&&(C-=1),6*C<1?v+(w-v)*C*6:2*C<1?w:3*C<2?v+(w-v)*(2/3-C)*6:v}try{n.parseCSSColor=function(v){var w,C=v.replace(/ /g,"").toLowerCase();if(C in s)return s[C].slice();if("#"===C[0])return 4===C.length?(w=parseInt(C.substr(1),16))>=0&&w<=4095?[(3840&w)>>4|(3840&w)>>8,240&w|(240&w)>>4,15&w|(15&w)<<4,1]:null:7===C.length&&(w=parseInt(C.substr(1),16))>=0&&w<=16777215?[(16711680&w)>>16,(65280&w)>>8,255&w,1]:null;var S=C.indexOf("("),I=C.indexOf(")");if(-1!==S&&I+1===C.length){var A=C.substr(0,S),O=C.substr(S+1,I-(S+1)).split(","),N=1;switch(A){case"rgba":if(4!==O.length)return null;N=p(O.pop());case"rgb":return 3!==O.length?null:[h(O[0]),h(O[1]),h(O[2]),N];case"hsla":if(4!==O.length)return null;N=p(O.pop());case"hsl":if(3!==O.length)return null;var U=(parseFloat(O[0])%360+360)%360/360,q=p(O[1]),J=p(O[2]),ie=J<=.5?J*(q+1):J+q-J*q,ce=2*J-ie;return[l(255*_(ce,ie,U+1/3)),l(255*_(ce,ie,U)),l(255*_(ce,ie,U-1/3)),N];default:return null}}return null}}catch(v){}});class Wt{constructor(n,s,l,h=1){this.r=n,this.g=s,this.b=l,this.a=h}static parse(n){if(!n)return;if(n instanceof Wt)return n;if("string"!=typeof n)return;const s=Ks.parseCSSColor(n);return s?new Wt(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[n,s,l,h]=this.toArray();return`rgba(${Math.round(n)},${Math.round(s)},${Math.round(l)},${h})`}toArray(){const{r:n,g:s,b:l,a:h}=this;return 0===h?[0,0,0,0]:[255*n/h,255*s/h,255*l/h,h]}}Wt.black=new Wt(0,0,0,1),Wt.white=new Wt(1,1,1,1),Wt.transparent=new Wt(0,0,0,0),Wt.red=new Wt(1,0,0,1),Wt.blue=new Wt(0,0,1,1);class Et{constructor(n,s,l){this.sensitivity=n?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,s){return this.collator.compare(n,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ol{constructor(n,s,l,h,p){this.text=n.normalize?n.normalize():n,this.image=s,this.scale=l,this.fontStack=h,this.textColor=p}}class Ct{constructor(n){this.sections=n}static fromString(n){return new Ct([new Ol(n,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(n=>0!==n.text.length||n.image&&0!==n.image.name.length)}static factory(n){return n instanceof Ct?n:Ct.fromString(n)}toString(){return 0===this.sections.length?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const s of this.sections){if(s.image){n.push(["image",s.image.name]);continue}n.push(s.text);const l={};s.fontStack&&(l["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(l["font-scale"]=s.scale),s.textColor&&(l["text-color"]=["rgba"].concat(s.textColor.toArray())),n.push(l)}return n}}class pr{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new pr({name:n,available:!1}):null}serialize(){return["image",this.name]}}function bu(i,n,s,l){return"number"==typeof i&&i>=0&&i<=255&&"number"==typeof n&&n>=0&&n<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===l||"number"==typeof l&&l>=0&&l<=1?null:`Invalid rgba value [${[i,n,s,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof l?[i,n,s,l]:[i,n,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function wu(i){if(null===i||"string"==typeof i||"boolean"==typeof i||"number"==typeof i||i instanceof Wt||i instanceof Et||i instanceof Ct||i instanceof pr)return!0;if(Array.isArray(i)){for(const n of i)if(!wu(n))return!1;return!0}if("object"==typeof i){for(const n in i)if(!wu(i[n]))return!1;return!0}return!1}function En(i){if(null===i)return ws;if("string"==typeof i)return _t;if("boolean"==typeof i)return ot;if("number"==typeof i)return Je;if(i instanceof Wt)return Zo;if(i instanceof Et)return tn;if(i instanceof Ct)return Xs;if(i instanceof pr)return Xr;if(Array.isArray(i)){const n=i.length;let s;for(const l of i){const h=En(l);if(s){if(s===h)continue;s=kt;break}s=h}return di(s||kt,n)}return Rl}function Kr(i){const n=typeof i;return null===i?"":"string"===n||"number"===n||"boolean"===n?String(i):i instanceof Wt||i instanceof Ct||i instanceof pr?i.toString():JSON.stringify(i)}class Js{constructor(n,s){this.type=n,this.value=s}static parse(n,s){if(2!==n.length)return s.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!wu(n[1]))return s.error("invalid value");const l=n[1];let h=En(l);const p=s.expectedType;return"array"!==h.kind||0!==h.N||!p||"array"!==p.kind||"number"==typeof p.N&&0!==p.N||(h=p),new Js(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Wt?["rgba"].concat(this.value.toArray()):this.value instanceof Ct?this.value.serialize():this.value}}class kr{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const Pi={string:_t,number:Je,boolean:ot,object:Rl};class Vi{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");let l,h=1;const p=n[0];if("array"===p){let v,w;if(n.length>2){const C=n[1];if("string"!=typeof C||!(C in Pi)||"object"===C)return s.error('The item type argument of "array" must be one of string, number, boolean',1);v=Pi[C],h++}else v=kt;if(n.length>3){if(null!==n[2]&&("number"!=typeof n[2]||n[2]<0||n[2]!==Math.floor(n[2])))return s.error('The length argument to "array" must be a positive integer literal',2);w=n[2],h++}l=di(v,w)}else l=Pi[p];const _=[];for(;h<n.length;h++){const v=s.parse(n[h],h,kt);if(!v)return null;_.push(v)}return new Vi(l,_)}evaluate(n){for(let s=0;s<this.args.length;s++){const l=this.args[s].evaluate(n);if(!pi(this.type,En(l)))return l;if(s===this.args.length-1)throw new kr(`Expected value to be of type ${Pn(this.type)}, but found ${Pn(En(l))} instead.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,s=[n.kind];if("array"===n.kind){const l=n.itemType;if("string"===l.kind||"number"===l.kind||"boolean"===l.kind){s.push(l.kind);const h=n.N;("number"==typeof h||this.args.length>1)&&s.push(h)}}return s.concat(this.args.map(l=>l.serialize()))}}class Do{constructor(n){this.type=Xs,this.sections=n}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const l=n[1];if(!Array.isArray(l)&&"object"==typeof l)return s.error("First argument must be an image or text section.");const h=[];let p=!1;for(let _=1;_<=n.length-1;++_){const v=n[_];if(p&&"object"==typeof v&&!Array.isArray(v)){p=!1;let w=null;if(v["font-scale"]&&(w=s.parse(v["font-scale"],1,Je),!w))return null;let C=null;if(v["text-font"]&&(C=s.parse(v["text-font"],1,di(_t)),!C))return null;let S=null;if(v["text-color"]&&(S=s.parse(v["text-color"],1,Zo),!S))return null;const I=h[h.length-1];I.scale=w,I.font=C,I.textColor=S}else{const w=s.parse(n[_],1,kt);if(!w)return null;const C=w.type.kind;if("string"!==C&&"value"!==C&&"null"!==C&&"resolvedImage"!==C)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new Do(h)}evaluate(n){return new Ct(this.sections.map(s=>{const l=s.content.evaluate(n);return En(l)===Xr?new Ol("",l,null,null,null):new Ol(Kr(l),null,s.scale?s.scale.evaluate(n):null,s.font?s.font.evaluate(n).join(","):null,s.textColor?s.textColor.evaluate(n):null)}))}eachChild(n){for(const s of this.sections)n(s.content),s.scale&&n(s.scale),s.font&&n(s.font),s.textColor&&n(s.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const s of this.sections){n.push(s.content.serialize());const l={};s.scale&&(l["font-scale"]=s.scale.serialize()),s.font&&(l["text-font"]=s.font.serialize()),s.textColor&&(l["text-color"]=s.textColor.serialize()),n.push(l)}return n}}class Ys{constructor(n){this.type=Xr,this.input=n}static parse(n,s){if(2!==n.length)return s.error("Expected two arguments.");const l=s.parse(n[1],1,_t);return l?new Ys(l):s.error("No image name provided.")}evaluate(n){const s=this.input.evaluate(n),l=pr.fromString(s);return l&&n.availableImages&&(l.available=n.availableImages.indexOf(s)>-1),l}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const em={"to-boolean":ot,"to-color":Zo,"to-number":Je,"to-string":_t};class qt{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const l=n[0];if(("to-boolean"===l||"to-string"===l)&&2!==n.length)return s.error("Expected one argument.");const h=em[l],p=[];for(let _=1;_<n.length;_++){const v=s.parse(n[_],_,kt);if(!v)return null;p.push(v)}return new qt(h,p)}evaluate(n){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(n));if("color"===this.type.kind){let s,l;for(const h of this.args){if(s=h.evaluate(n),l=null,s instanceof Wt)return s;if("string"==typeof s){const p=n.parseColor(s);if(p)return p}else if(Array.isArray(s)&&(l=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:bu(s[0],s[1],s[2],s[3]),!l))return new Wt(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new kr(l||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const l of this.args){if(s=l.evaluate(n),null===s)return 0;const h=Number(s);if(!isNaN(h))return h}throw new kr(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?Ct.fromString(Kr(this.args[0].evaluate(n))):"resolvedImage"===this.type.kind?pr.fromString(Kr(this.args[0].evaluate(n))):Kr(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Do([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ys(this.args[0]).serialize();const n=[`to-${this.type.kind}`];return this.eachChild(s=>{n.push(s.serialize())}),n}}const cp=["Unknown","Point","LineString","Polygon"];class up{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?cp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:l,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*s-n[0])+this.featureDistanceData.bearing[1]*(h*s-n[1])}return 0}parseColor(n){let s=this._parseColorCache[n];return s||(s=this._parseColorCache[n]=Wt.parse(n)),s}}class br{constructor(n,s,l,h){this.name=n,this.type=s,this._evaluate=l,this.args=h}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,s){const l=n[0],h=br.definitions[l];if(!h)return s.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=_.filter(([C])=>!Array.isArray(C)||C.length===n.length-1);let w=null;for(const[C,S]of v){w=new ta(s.registry,s.path,null,s.scope);const I=[];let A=!1;for(let O=1;O<n.length;O++){const N=n[O],U=Array.isArray(C)?C[O-1]:C.type,q=w.parse(N,1+I.length,U);if(!q){A=!0;break}I.push(q)}if(!A)if(Array.isArray(C)&&C.length!==I.length)w.error(`Expected ${C.length} arguments, but found ${I.length} instead.`);else{for(let O=0;O<I.length;O++){const N=Array.isArray(C)?C[O]:C.type,U=I[O];w.concat(O+1).checkSubtype(N,U.type)}if(0===w.errors.length)return new br(l,p,S,I)}}if(1===v.length)s.errors.push(...w.errors);else{const C=(v.length?v:_).map(([I])=>{return A=I,Array.isArray(A)?`(${A.map(Pn).join(", ")})`:`(${Pn(A.type)}...)`;var A}).join(" | "),S=[];for(let I=1;I<n.length;I++){const A=s.parse(n[I],1+S.length);if(!A)return null;S.push(Pn(A.type))}s.error(`Expected arguments of type ${C}, but found (${S.join(", ")}) instead.`)}return null}static register(n,s){br.definitions=s;for(const l in s)n[l]=br}}class hn{constructor(n,s,l){this.type=tn,this.locale=l,this.caseSensitive=n,this.diacriticSensitive=s}static parse(n,s){if(2!==n.length)return s.error("Expected one argument.");const l=n[1];if("object"!=typeof l||Array.isArray(l))return s.error("Collator options argument must be an object.");const h=s.parse(void 0!==l["case-sensitive"]&&l["case-sensitive"],1,ot);if(!h)return null;const p=s.parse(void 0!==l["diacritic-sensitive"]&&l["diacritic-sensitive"],1,ot);if(!p)return null;let _=null;return l.locale&&(_=s.parse(l.locale,1,_t),!_)?null:new hn(h,p,_)}evaluate(n){return new Et(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}const oo=8192;function Ga(i,n){i[0]=Math.min(i[0],n[0]),i[1]=Math.min(i[1],n[1]),i[2]=Math.max(i[2],n[0]),i[3]=Math.max(i[3],n[1])}function Qs(i,n){return!(i[0]<=n[0]||i[2]>=n[2]||i[1]<=n[1]||i[3]>=n[3])}function Eu(i,n){const s=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,n.z);return[Math.round(s*h*oo),Math.round(l*h*oo)]}function To(i,n,s){const l=i[0]-n[0],h=i[1]-n[1],p=i[0]-s[0],_=i[1]-s[1];return l*_-p*h==0&&l*p<=0&&h*_<=0}function ea(i,n){let s=!1;for(let _=0,v=n.length;_<v;_++){const w=n[_];for(let C=0,S=w.length;C<S-1;C++){if(To(i,w[C],w[C+1]))return!1;(h=w[C])[1]>(l=i)[1]!=(p=w[C+1])[1]>l[1]&&l[0]<(p[0]-h[0])*(l[1]-h[1])/(p[1]-h[1])+h[0]&&(s=!s)}}var l,h,p;return s}function Oh(i,n){for(let s=0;s<n.length;s++)if(ea(i,n[s]))return!0;return!1}function $a(i,n,s,l){const h=l[0]-s[0],p=l[1]-s[1],_=(i[0]-s[0])*p-h*(i[1]-s[1]),v=(n[0]-s[0])*p-h*(n[1]-s[1]);return _>0&&v<0||_<0&&v>0}function hp(i,n,s){for(const C of s)for(let S=0;S<C.length-1;++S)if((v=[(_=C[S+1])[0]-(p=C[S])[0],_[1]-p[1]])[0]*(w=[(h=n)[0]-(l=i)[0],h[1]-l[1]])[1]-v[1]*w[0]!=0&&$a(l,h,p,_)&&$a(p,_,l,h))return!0;var l,h,p,_,v,w;return!1}function Cu(i,n){for(let s=0;s<i.length;++s)if(!ea(i[s],n))return!1;for(let s=0;s<i.length-1;++s)if(hp(i[s],i[s+1],n))return!1;return!0}function zh(i,n){for(let s=0;s<n.length;s++)if(Cu(i,n[s]))return!0;return!1}function Tc(i,n,s){const l=[];for(let h=0;h<i.length;h++){const p=[];for(let _=0;_<i[h].length;_++){const v=Eu(i[h][_],s);Ga(n,v),p.push(v)}l.push(p)}return l}function so(i,n,s){const l=[];for(let h=0;h<i.length;h++){const p=Tc(i[h],n,s);l.push(p)}return l}function Du(i,n,s,l){if(i[0]<s[0]||i[0]>s[2]){const h=.5*l;let p=i[0]-s[0]>h?-l:s[0]-i[0]>h?l:0;0===p&&(p=i[0]-s[2]>h?-l:s[2]-i[0]>h?l:0),i[0]+=p}Ga(n,i)}function Tu(i,n,s,l){const h=Math.pow(2,l.z)*oo,p=[l.x*oo,l.y*oo],_=[];for(const v of i)for(const w of v){const C=[w.x+p[0],w.y+p[1]];Du(C,n,s,h),_.push(C)}return _}function Dt(i,n,s,l){const h=Math.pow(2,l.z)*oo,p=[l.x*oo,l.y*oo],_=[];for(const w of i){const C=[];for(const S of w){const I=[S.x+p[0],S.y+p[1]];Ga(n,I),C.push(I)}_.push(C)}if(n[2]-n[0]<=h/2){(v=n)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of _)for(const C of w)Du(C,n,s,h)}var v;return _}class rr{constructor(n,s){this.type=ot,this.geojson=n,this.geometries=s}static parse(n,s){if(2!==n.length)return s.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(wu(n[1])){const l=n[1];if("FeatureCollection"===l.type)for(let h=0;h<l.features.length;++h){const p=l.features[h].geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new rr(l,l.features[h].geometry)}else if("Feature"===l.type){const h=l.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new rr(l,l.geometry)}else if("Polygon"===l.type||"MultiPolygon"===l.type)return new rr(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(null!=n.geometry()&&null!=n.canonicalID()){if("Point"===n.geometryType())return function(s,l){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if("Polygon"===l.type){const v=Tc(l.coordinates,p,_),w=Tu(s.geometry(),h,p,_);if(!Qs(h,p))return!1;for(const C of w)if(!ea(C,v))return!1}if("MultiPolygon"===l.type){const v=so(l.coordinates,p,_),w=Tu(s.geometry(),h,p,_);if(!Qs(h,p))return!1;for(const C of w)if(!Oh(C,v))return!1}return!0}(n,this.geometries);if("LineString"===n.geometryType())return function(s,l){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if("Polygon"===l.type){const v=Tc(l.coordinates,p,_),w=Dt(s.geometry(),h,p,_);if(!Qs(h,p))return!1;for(const C of w)if(!Cu(C,v))return!1}if("MultiPolygon"===l.type){const v=so(l.coordinates,p,_),w=Dt(s.geometry(),h,p,_);if(!Qs(h,p))return!1;for(const C of w)if(!zh(C,v))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Xn(i){if(i instanceof br&&("get"===i.name&&1===i.args.length||"feature-state"===i.name||"has"===i.name&&1===i.args.length||"properties"===i.name||"geometry-type"===i.name||"id"===i.name||/^filter-/.test(i.name))||i instanceof rr)return!1;let n=!0;return i.eachChild(s=>{n&&!Xn(s)&&(n=!1)}),n}function ji(i){if(i instanceof br&&"feature-state"===i.name)return!1;let n=!0;return i.eachChild(s=>{n&&!ji(s)&&(n=!1)}),n}function ao(i,n){if(i instanceof br&&n.indexOf(i.name)>=0)return!1;let s=!0;return i.eachChild(l=>{s&&!ao(l,n)&&(s=!1)}),s}class Jr{constructor(n,s){this.type=s.type,this.name=n,this.boundExpression=s}static parse(n,s){if(2!==n.length||"string"!=typeof n[1])return s.error("'var' expression requires exactly one string literal argument.");const l=n[1];return s.scope.has(l)?new Jr(l,s.scope.get(l)):s.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ta{constructor(n,s=[],l,h=new xu,p=[]){this.registry=n,this.path=s,this.key=s.map(_=>`[${_}]`).join(""),this.scope=h,this.errors=p,this.expectedType=l}parse(n,s,l,h,p={}){return s?this.concat(s,l,h)._parse(n,p):this._parse(n,p)}_parse(n,s){function l(h,p,_){return"assert"===_?new Vi(p,[h]):"coerce"===_?new qt(p,[h]):h}if(null!==n&&"string"!=typeof n&&"boolean"!=typeof n&&"number"!=typeof n||(n=["literal",n]),Array.isArray(n)){if(0===n.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=n[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[h];if(p){let _=p.parse(n,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,w=_.type;if("string"!==v.kind&&"number"!==v.kind&&"boolean"!==v.kind&&"object"!==v.kind&&"array"!==v.kind||"value"!==w.kind)if("color"!==v.kind&&"formatted"!==v.kind&&"resolvedImage"!==v.kind||"value"!==w.kind&&"string"!==w.kind){if(this.checkSubtype(v,w))return null}else _=l(_,v,s.typeAnnotation||"coerce");else _=l(_,v,s.typeAnnotation||"assert")}if(!(_ instanceof Js)&&"resolvedImage"!==_.type.kind&&Ha(_)){const v=new up;try{_=new Js(_.type,_.evaluate(v))}catch(w){return this.error(w.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===n?"'undefined' value invalid. Use null instead.":"object"==typeof n?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,s,l){const h="number"==typeof n?this.path.concat(n):this.path,p=l?this.scope.concat(l):this.scope;return new ta(this.registry,h,s||null,p,this.errors)}error(n,...s){const l=`${this.key}${s.map(h=>`[${h}]`).join("")}`;this.errors.push(new Co(l,n))}checkSubtype(n,s){const l=pi(n,s);return l&&this.error(l),l}}function Ha(i){if(i instanceof Jr)return Ha(i.boundExpression);if(i instanceof br&&"error"===i.name||i instanceof hn||i instanceof rr)return!1;const n=i instanceof qt||i instanceof Vi;let s=!0;return i.eachChild(l=>{s=n?s&&Ha(l):s&&l instanceof Js}),!!s&&Xn(i)&&ao(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Xo(i,n){const s=i.length-1;let l,h,p=0,_=s,v=0;for(;p<=_;)if(v=Math.floor((p+_)/2),l=i[v],h=i[v+1],l<=n){if(v===s||n<h)return v;p=v+1}else{if(!(l>n))throw new kr("Input is not a number.");_=v-1}return 0}class Cs{constructor(n,s,l){this.type=n,this.input=s,this.labels=[],this.outputs=[];for(const[h,p]of l)this.labels.push(h),this.outputs.push(p)}static parse(n,s){if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");const l=s.parse(n[1],1,Je);if(!l)return null;const h=[];let p=null;s.expectedType&&"value"!==s.expectedType.kind&&(p=s.expectedType);for(let _=1;_<n.length;_+=2){const v=1===_?-1/0:n[_],w=n[_+1],C=_,S=_+1;if("number"!=typeof v)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(h.length&&h[h.length-1][0]>=v)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const I=s.parse(w,S,p);if(!I)return null;p=p||I.type,h.push([v,I])}return new Cs(p,l,h)}evaluate(n){const s=this.labels,l=this.outputs;if(1===s.length)return l[0].evaluate(n);const h=this.input.evaluate(n);if(h<=s[0])return l[0].evaluate(n);const p=s.length;return h>=s[p-1]?l[p-1].evaluate(n):l[Xo(s,h)].evaluate(n)}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&n.push(this.labels[s]),n.push(this.outputs[s].serialize());return n}}function zt(i,n,s){return i*(1-s)+n*s}var fr=Object.freeze({__proto__:null,number:zt,color:function(i,n,s){return new Wt(zt(i.r,n.r,s),zt(i.g,n.g,s),zt(i.b,n.b,s),zt(i.a,n.a,s))},array:function(i,n,s){return i.map((l,h)=>zt(l,n[h],s))}});const et=4/29,Ft=6/29,kn=3*Ft*Ft,ki=Math.PI/180,na=180/Math.PI;function Kn(i){return i>.008856451679035631?Math.pow(i,1/3):i/kn+et}function Mo(i){return i>Ft?i*i*i:kn*(i-et)}function On(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Ko(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ra(i){const n=Ko(i.r),s=Ko(i.g),l=Ko(i.b),h=Kn((.4124564*n+.3575761*s+.1804375*l)/.95047),p=Kn((.2126729*n+.7151522*s+.072175*l)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-Kn((.0193339*n+.119192*s+.9503041*l)/1.08883)),alpha:i.a}}function It(i){let n=(i.l+16)/116,s=isNaN(i.a)?n:n+i.a/500,l=isNaN(i.b)?n:n-i.b/200;return n=1*Mo(n),s=.95047*Mo(s),l=1.08883*Mo(l),new Wt(On(3.2404542*s-1.5371385*n-.4985314*l),On(-.969266*s+1.8760108*n+.041556*l),On(.0556434*s-.2040259*n+1.0572252*l),i.alpha)}function Mc(i,n,s){const l=n-i;return i+s*(l>180||l<-180?l-360*Math.round(l/360):l)}const So={forward:ra,reverse:It,interpolate:function(i,n,s){return{l:zt(i.l,n.l,s),a:zt(i.a,n.a,s),b:zt(i.b,n.b,s),alpha:zt(i.alpha,n.alpha,s)}}},ia={forward:function(i){const{l:n,a:s,b:l}=ra(i),h=Math.atan2(l,s)*na;return{h:h<0?h+360:h,c:Math.sqrt(s*s+l*l),l:n,alpha:i.a}},reverse:function(i){const n=i.h*ki,s=i.c;return It({l:i.l,a:Math.cos(n)*s,b:Math.sin(n)*s,alpha:i.alpha})},interpolate:function(i,n,s){return{h:Mc(i.h,n.h,s),c:zt(i.c,n.c,s),l:zt(i.l,n.l,s),alpha:zt(i.alpha,n.alpha,s)}}};var oa=Object.freeze({__proto__:null,lab:So,hcl:ia});class Mn{constructor(n,s,l,h,p){this.type=n,this.operator=s,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[_,v]of p)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(n,s,l,h){let p=0;if("exponential"===n.name)p=Ds(s,n.base,l,h);else if("linear"===n.name)p=Ds(s,1,l,h);else if("cubic-bezier"===n.name){const _=n.controlPoints;p=new jo(_[0],_[1],_[2],_[3]).solve(Ds(s,1,l,h))}return p}static parse(n,s){let[l,h,p,..._]=n;if(!Array.isArray(h)||0===h.length)return s.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const C=h[1];if("number"!=typeof C)return s.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:C}}else{if("cubic-bezier"!==h[0])return s.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const C=h.slice(1);if(4!==C.length||C.some(S=>"number"!=typeof S||S<0||S>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:C}}}if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(p=s.parse(p,2,Je),!p)return null;const v=[];let w=null;"interpolate-hcl"===l||"interpolate-lab"===l?w=Zo:s.expectedType&&"value"!==s.expectedType.kind&&(w=s.expectedType);for(let C=0;C<_.length;C+=2){const S=_[C],I=_[C+1],A=C+3,O=C+4;if("number"!=typeof S)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(v.length&&v[v.length-1][0]>=S)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const N=s.parse(I,O,w);if(!N)return null;w=w||N.type,v.push([S,N])}return"number"===w.kind||"color"===w.kind||"array"===w.kind&&"number"===w.itemType.kind&&"number"==typeof w.N?new Mn(w,l,h,p,v):s.error(`Type ${Pn(w)} is not interpolatable.`)}evaluate(n){const s=this.labels,l=this.outputs;if(1===s.length)return l[0].evaluate(n);const h=this.input.evaluate(n);if(h<=s[0])return l[0].evaluate(n);const p=s.length;if(h>=s[p-1])return l[p-1].evaluate(n);const _=Xo(s,h),v=Mn.interpolationFactor(this.interpolation,h,s[_],s[_+1]),w=l[_].evaluate(n),C=l[_+1].evaluate(n);return"interpolate"===this.operator?fr[this.type.kind.toLowerCase()](w,C,v):"interpolate-hcl"===this.operator?ia.reverse(ia.interpolate(ia.forward(w),ia.forward(C),v)):So.reverse(So.interpolate(So.forward(w),So.forward(C),v))}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,n,this.input.serialize()];for(let l=0;l<this.labels.length;l++)s.push(this.labels[l],this.outputs[l].serialize());return s}}function Ds(i,n,s,l){const h=l-s,p=i-s;return 0===h?0:1===n?p/h:(Math.pow(n,p)-1)/(Math.pow(n,h)-1)}class Ui{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expectected at least one argument.");let l=null;const h=s.expectedType;h&&"value"!==h.kind&&(l=h);const p=[];for(const v of n.slice(1)){const w=s.parse(v,1+p.length,l,void 0,{typeAnnotation:"omit"});if(!w)return null;l=l||w.type,p.push(w)}const _=h&&p.some(v=>pi(h,v.type));return new Ui(_?kt:l,p)}evaluate(n){let s,l=null,h=0;for(const p of this.args){if(h++,l=p.evaluate(n),l&&l instanceof pr&&!l.available&&(s||(s=l),l=null,h===this.args.length))return s;if(null!==l)break}return l}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(s=>{n.push(s.serialize())}),n}}class fi{constructor(n,s){this.type=s.type,this.bindings=[].concat(n),this.result=s}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const s of this.bindings)n(s[1]);n(this.result)}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const l=[];for(let p=1;p<n.length-1;p+=2){const _=n[p];if("string"!=typeof _)return s.error(`Expected string, but found ${typeof _} instead.`,p);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=s.parse(n[p+1],p+1);if(!v)return null;l.push([_,v])}const h=s.parse(n[n.length-1],n.length-1,s.expectedType,l);return h?new fi(l,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[s,l]of this.bindings)n.push(s,l.serialize());return n.push(this.result.serialize()),n}}class Cn{constructor(n,s,l){this.type=n,this.index=s,this.input=l}static parse(n,s){if(3!==n.length)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const l=s.parse(n[1],1,Je),h=s.parse(n[2],2,di(s.expectedType||kt));return l&&h?new Cn(h.type.itemType,l,h):null}evaluate(n){const s=this.index.evaluate(n),l=this.input.evaluate(n);if(s<0)throw new kr(`Array index out of bounds: ${s} < 0.`);if(s>=l.length)throw new kr(`Array index out of bounds: ${s} > ${l.length-1}.`);if(s!==Math.floor(s))throw new kr(`Array index must be an integer, but found ${s} instead.`);return l[s]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Mu{constructor(n,s){this.type=ot,this.needle=n,this.haystack=s}static parse(n,s){if(3!==n.length)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const l=s.parse(n[1],1,kt),h=s.parse(n[2],2,kt);return l&&h?Ll(l.type,[ot,_t,Je,ws,kt])?new Mu(l,h):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(l.type)} instead`):null}evaluate(n){const s=this.needle.evaluate(n),l=this.haystack.evaluate(n);if(!l)return!1;if(!Wo(s,["boolean","string","number","null"]))throw new kr(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(En(s))} instead.`);if(!Wo(l,["string","array"]))throw new kr(`Expected second argument to be of type array or string, but found ${Pn(En(l))} instead.`);return l.indexOf(s)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class lo{constructor(n,s,l){this.type=Je,this.needle=n,this.haystack=s,this.fromIndex=l}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const l=s.parse(n[1],1,kt),h=s.parse(n[2],2,kt);if(!l||!h)return null;if(!Ll(l.type,[ot,_t,Je,ws,kt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(l.type)} instead`);if(4===n.length){const p=s.parse(n[3],3,Je);return p?new lo(l,h,p):null}return new lo(l,h)}evaluate(n){const s=this.needle.evaluate(n),l=this.haystack.evaluate(n);if(!Wo(s,["boolean","string","number","null"]))throw new kr(`Expected first argument to be of type boolean, string, number or null, but found ${Pn(En(s))} instead.`);if(!Wo(l,["string","array"]))throw new kr(`Expected second argument to be of type array or string, but found ${Pn(En(l))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(n);return l.indexOf(s,h)}return l.indexOf(s)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Fi{constructor(n,s,l,h,p,_){this.inputType=n,this.type=s,this.input=l,this.cases=h,this.outputs=p,this.otherwise=_}static parse(n,s){if(n.length<5)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return s.error("Expected an even number of arguments.");let l,h;s.expectedType&&"value"!==s.expectedType.kind&&(h=s.expectedType);const p={},_=[];for(let C=2;C<n.length-1;C+=2){let S=n[C];const I=n[C+1];Array.isArray(S)||(S=[S]);const A=s.concat(C);if(0===S.length)return A.error("Expected at least one branch label.");for(const N of S){if("number"!=typeof N&&"string"!=typeof N)return A.error("Branch labels must be numbers or strings.");if("number"==typeof N&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof N&&Math.floor(N)!==N)return A.error("Numeric branch labels must be integer values.");if(l){if(A.checkSubtype(l,En(N)))return null}else l=En(N);if(void 0!==p[String(N)])return A.error("Branch labels must be unique.");p[String(N)]=_.length}const O=s.parse(I,C,h);if(!O)return null;h=h||O.type,_.push(O)}const v=s.parse(n[1],1,kt);if(!v)return null;const w=s.parse(n[n.length-1],n.length-1,h);return w?"value"!==v.type.kind&&s.concat(1).checkSubtype(l,v.type)?null:new Fi(l,h,v,p,_,w):null}evaluate(n){const s=this.input.evaluate(n);return(En(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),l=[],h={};for(const _ of s){const v=h[this.cases[_]];void 0===v?(h[this.cases[_]]=l.length,l.push([this.cases[_],[_]])):l[v][1].push(_)}const p=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,v]of l)n.push(1===v.length?p(v[0]):v.map(p)),n.push(this.outputs[_].serialize());return n.push(this.otherwise.serialize()),n}}class wr{constructor(n,s,l){this.type=n,this.branches=s,this.otherwise=l}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return s.error("Expected an odd number of arguments.");let l;s.expectedType&&"value"!==s.expectedType.kind&&(l=s.expectedType);const h=[];for(let _=1;_<n.length-1;_+=2){const v=s.parse(n[_],_,ot);if(!v)return null;const w=s.parse(n[_+1],_+1,l);if(!w)return null;h.push([v,w]),l=l||w.type}const p=s.parse(n[n.length-1],n.length-1,l);return p?new wr(l,h,p):null}evaluate(n){for(const[s,l]of this.branches)if(s.evaluate(n))return l.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[s,l]of this.branches)n(s),n(l);n(this.otherwise)}outputDefined(){return this.branches.every(([n,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(s=>{n.push(s.serialize())}),n}}class sa{constructor(n,s,l,h){this.type=n,this.input=s,this.beginIndex=l,this.endIndex=h}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const l=s.parse(n[1],1,kt),h=s.parse(n[2],2,Je);if(!l||!h)return null;if(!Ll(l.type,[di(kt),_t,kt]))return s.error(`Expected first argument to be of type array or string, but found ${Pn(l.type)} instead`);if(4===n.length){const p=s.parse(n[3],3,Je);return p?new sa(l.type,l,h,p):null}return new sa(l.type,l,h)}evaluate(n){const s=this.input.evaluate(n),l=this.beginIndex.evaluate(n);if(!Wo(s,["string","array"]))throw new kr(`Expected first argument to be of type array or string, but found ${Pn(En(s))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(n);return s.slice(l,h)}return s.slice(l)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function zl(i,n){return"=="===i||"!="===i?"boolean"===n.kind||"string"===n.kind||"number"===n.kind||"null"===n.kind||"value"===n.kind:"string"===n.kind||"number"===n.kind||"value"===n.kind}function aa(i,n,s,l){return 0===l.compare(n,s)}function Er(i,n,s){const l="=="!==i&&"!="!==i;return class LE{constructor(p,_,v){this.type=ot,this.lhs=p,this.rhs=_,this.collator=v,this.hasUntypedArgument="value"===p.type.kind||"value"===_.type.kind}static parse(p,_){if(3!==p.length&&4!==p.length)return _.error("Expected two or three arguments.");const v=p[0];let w=_.parse(p[1],1,kt);if(!w)return null;if(!zl(v,w.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${Pn(w.type)}'.`);let C=_.parse(p[2],2,kt);if(!C)return null;if(!zl(v,C.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${Pn(C.type)}'.`);if(w.type.kind!==C.type.kind&&"value"!==w.type.kind&&"value"!==C.type.kind)return _.error(`Cannot compare types '${Pn(w.type)}' and '${Pn(C.type)}'.`);l&&("value"===w.type.kind&&"value"!==C.type.kind?w=new Vi(C.type,[w]):"value"!==w.type.kind&&"value"===C.type.kind&&(C=new Vi(w.type,[C])));let S=null;if(4===p.length){if("string"!==w.type.kind&&"string"!==C.type.kind&&"value"!==w.type.kind&&"value"!==C.type.kind)return _.error("Cannot use collator to compare non-string types.");if(S=_.parse(p[3],3,tn),!S)return null}return new LE(w,C,S)}evaluate(p){const _=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(l&&this.hasUntypedArgument){const w=En(_),C=En(v);if(w.kind!==C.kind||"string"!==w.kind&&"number"!==w.kind)throw new kr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${w.kind}, ${C.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const w=En(_),C=En(v);if("string"!==w.kind||"string"!==C.kind)return n(p,_,v)}return this.collator?s(p,_,v,this.collator.evaluate(p)):n(p,_,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[i];return this.eachChild(_=>{p.push(_.serialize())}),p}}}const Nh=Er("==",function(i,n,s){return n===s},aa),Vh=Er("!=",function(i,n,s){return n!==s},function(i,n,s,l){return!aa(0,n,s,l)}),Su=Er("<",function(i,n,s){return n<s},function(i,n,s,l){return l.compare(n,s)<0}),jh=Er(">",function(i,n,s){return n>s},function(i,n,s,l){return l.compare(n,s)>0}),Uh=Er("<=",function(i,n,s){return n<=s},function(i,n,s,l){return l.compare(n,s)<=0}),dp=Er(">=",function(i,n,s){return n>=s},function(i,n,s,l){return l.compare(n,s)>=0});class Iu{constructor(n,s,l,h,p){this.type=_t,this.number=n,this.locale=s,this.currency=l,this.minFractionDigits=h,this.maxFractionDigits=p}static parse(n,s){if(3!==n.length)return s.error("Expected two arguments.");const l=s.parse(n[1],1,Je);if(!l)return null;const h=n[2];if("object"!=typeof h||Array.isArray(h))return s.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=s.parse(h.locale,1,_t),!p))return null;let _=null;if(h.currency&&(_=s.parse(h.currency,1,_t),!_))return null;let v=null;if(h["min-fraction-digits"]&&(v=s.parse(h["min-fraction-digits"],1,Je),!v))return null;let w=null;return h["max-fraction-digits"]&&(w=s.parse(h["max-fraction-digits"],1,Je),!w)?null:new Iu(l,p,_,v,w)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class Au{constructor(n){this.type=Je,this.input=n}static parse(n,s){if(2!==n.length)return s.error(`Expected 1 argument, but found ${n.length-1} instead.`);const l=s.parse(n[1],1);return l?"array"!==l.type.kind&&"string"!==l.type.kind&&"value"!==l.type.kind?s.error(`Expected argument of type string or array, but found ${Pn(l.type)} instead.`):new Au(l):null}evaluate(n){const s=this.input.evaluate(n);if("string"==typeof s||Array.isArray(s))return s.length;throw new kr(`Expected value to be of type string or array, but found ${Pn(En(s))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(s=>{n.push(s.serialize())}),n}}const Io={"==":Nh,"!=":Vh,">":jh,"<":Su,">=":dp,"<=":Uh,array:Vi,at:Cn,boolean:Vi,case:wr,coalesce:Ui,collator:hn,format:Do,image:Ys,in:Mu,"index-of":lo,interpolate:Mn,"interpolate-hcl":Mn,"interpolate-lab":Mn,length:Au,let:fi,literal:Js,match:Fi,number:Vi,"number-format":Iu,object:Vi,slice:sa,step:Cs,string:Vi,"to-boolean":qt,"to-color":qt,"to-number":qt,"to-string":qt,var:Jr,within:rr};function Gh(i,[n,s,l,h]){n=n.evaluate(i),s=s.evaluate(i),l=l.evaluate(i);const p=h?h.evaluate(i):1,_=bu(n,s,l,p);if(_)throw new kr(_);return new Wt(n/255*p,s/255*p,l/255*p,p)}function $h(i,n){return i in n}function Sc(i,n){const s=n[i];return void 0===s?null:s}function la(i){return{type:i}}function pp(i){return{result:"success",value:i}}function Ts(i){return{result:"error",value:i}}function Bl(i){return"data-driven"===i["property-type"]||"cross-faded-data-driven"===i["property-type"]}function fp(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Hh(i){return!!i.expression&&i.expression.interpolated}function Yt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":null===i?"null":typeof i}function qa(i){return"object"==typeof i&&null!==i&&!Array.isArray(i)}function Pu(i){return i}function Ic(i,n){const s="color"===n.type,l=i.stops&&"object"==typeof i.stops[0][0],h=l||!(l||void 0!==i.property),p=i.type||(Hh(n)?"exponential":"interval");if(s&&((i=Ws({},i)).stops&&(i.stops=i.stops.map(C=>[C[0],Wt.parse(C[1])])),i.default=Wt.parse(i.default?i.default:n.default)),i.colorSpace&&"rgb"!==i.colorSpace&&!oa[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let _,v,w;if("exponential"===p)_=Po;else if("interval"===p)_=mp;else if("categorical"===p){_=Ao,v=Object.create(null);for(const C of i.stops)v[C[0]]=C[1];w=typeof i.stops[0][0]}else{if("identity"!==p)throw new Error(`Unknown function type "${p}"`);_=qh}if(l){const C={},S=[];for(let O=0;O<i.stops.length;O++){const N=i.stops[O],U=N[0].zoom;void 0===C[U]&&(C[U]={zoom:U,type:i.type,property:i.property,default:i.default,stops:[]},S.push(U)),C[U].stops.push([N[0].value,N[1]])}const I=[];for(const O of S)I.push([C[O].zoom,Ic(C[O],n)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:Mn.interpolationFactor.bind(void 0,A),zoomStops:I.map(O=>O[0]),evaluate:({zoom:O},N)=>Po({stops:I,base:i.base},n,O).evaluate(O,N)}}if(h){const C="exponential"===p?{name:"exponential",base:void 0!==i.base?i.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Mn.interpolationFactor.bind(void 0,C),zoomStops:i.stops.map(S=>S[0]),evaluate:({zoom:S})=>_(i,n,S,v,w)}}return{kind:"source",evaluate(C,S){const I=S&&S.properties?S.properties[i.property]:void 0;return void 0===I?Nr(i.default,n.default):_(i,n,I,v,w)}}}function Nr(i,n,s){return void 0!==i?i:void 0!==n?n:void 0!==s?s:void 0}function Ao(i,n,s,l,h){return Nr(typeof s===h?l[s]:void 0,i.default,n.default)}function mp(i,n,s){if("number"!==Yt(s))return Nr(i.default,n.default);const l=i.stops.length;if(1===l||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[l-1][0])return i.stops[l-1][1];const h=Xo(i.stops.map(p=>p[0]),s);return i.stops[h][1]}function Po(i,n,s){const l=void 0!==i.base?i.base:1;if("number"!==Yt(s))return Nr(i.default,n.default);const h=i.stops.length;if(1===h||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[h-1][0])return i.stops[h-1][1];const p=Xo(i.stops.map(S=>S[0]),s),_=function(S,I,A,O){const N=O-A,U=S-A;return 0===N?0:1===I?U/N:(Math.pow(I,U)-1)/(Math.pow(I,N)-1)}(s,l,i.stops[p][0],i.stops[p+1][0]),v=i.stops[p][1],w=i.stops[p+1][1];let C=fr[n.type]||Pu;if(i.colorSpace&&"rgb"!==i.colorSpace){const S=oa[i.colorSpace];C=(I,A)=>S.reverse(S.interpolate(S.forward(I),S.forward(A),_))}return"function"==typeof v.evaluate?{evaluate(...S){const I=v.evaluate.apply(void 0,S),A=w.evaluate.apply(void 0,S);if(void 0!==I&&void 0!==A)return C(I,A,_)}}:C(v,w,_)}function qh(i,n,s){return"color"===n.type?s=Wt.parse(s):"formatted"===n.type?s=Ct.fromString(s.toString()):"resolvedImage"===n.type?s=pr.fromString(s.toString()):Yt(s)===n.type||"enum"===n.type&&n.values[s]||(s=void 0),Nr(s,i.default,n.default)}br.register(Io,{error:[{kind:"error"},[_t],(i,[n])=>{throw new kr(n.evaluate(i))}],typeof:[_t,[kt],(i,[n])=>Pn(En(n.evaluate(i)))],"to-rgba":[di(Je,4),[Zo],(i,[n])=>n.evaluate(i).toArray()],rgb:[Zo,[Je,Je,Je],Gh],rgba:[Zo,[Je,Je,Je,Je],Gh],has:{type:ot,overloads:[[[_t],(i,[n])=>$h(n.evaluate(i),i.properties())],[[_t,Rl],(i,[n,s])=>$h(n.evaluate(i),s.evaluate(i))]]},get:{type:kt,overloads:[[[_t],(i,[n])=>Sc(n.evaluate(i),i.properties())],[[_t,Rl],(i,[n,s])=>Sc(n.evaluate(i),s.evaluate(i))]]},"feature-state":[kt,[_t],(i,[n])=>Sc(n.evaluate(i),i.featureState||{})],properties:[Rl,[],i=>i.properties()],"geometry-type":[_t,[],i=>i.geometryType()],id:[kt,[],i=>i.id()],zoom:[Je,[],i=>i.globals.zoom],pitch:[Je,[],i=>i.globals.pitch||0],"distance-from-center":[Je,[],i=>i.distanceFromCenter()],"heatmap-density":[Je,[],i=>i.globals.heatmapDensity||0],"line-progress":[Je,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[Je,[],i=>i.globals.skyRadialProgress||0],accumulated:[kt,[],i=>void 0===i.globals.accumulated?null:i.globals.accumulated],"+":[Je,la(Je),(i,n)=>{let s=0;for(const l of n)s+=l.evaluate(i);return s}],"*":[Je,la(Je),(i,n)=>{let s=1;for(const l of n)s*=l.evaluate(i);return s}],"-":{type:Je,overloads:[[[Je,Je],(i,[n,s])=>n.evaluate(i)-s.evaluate(i)],[[Je],(i,[n])=>-n.evaluate(i)]]},"/":[Je,[Je,Je],(i,[n,s])=>n.evaluate(i)/s.evaluate(i)],"%":[Je,[Je,Je],(i,[n,s])=>n.evaluate(i)%s.evaluate(i)],ln2:[Je,[],()=>Math.LN2],pi:[Je,[],()=>Math.PI],e:[Je,[],()=>Math.E],"^":[Je,[Je,Je],(i,[n,s])=>Math.pow(n.evaluate(i),s.evaluate(i))],sqrt:[Je,[Je],(i,[n])=>Math.sqrt(n.evaluate(i))],log10:[Je,[Je],(i,[n])=>Math.log(n.evaluate(i))/Math.LN10],ln:[Je,[Je],(i,[n])=>Math.log(n.evaluate(i))],log2:[Je,[Je],(i,[n])=>Math.log(n.evaluate(i))/Math.LN2],sin:[Je,[Je],(i,[n])=>Math.sin(n.evaluate(i))],cos:[Je,[Je],(i,[n])=>Math.cos(n.evaluate(i))],tan:[Je,[Je],(i,[n])=>Math.tan(n.evaluate(i))],asin:[Je,[Je],(i,[n])=>Math.asin(n.evaluate(i))],acos:[Je,[Je],(i,[n])=>Math.acos(n.evaluate(i))],atan:[Je,[Je],(i,[n])=>Math.atan(n.evaluate(i))],min:[Je,la(Je),(i,n)=>Math.min(...n.map(s=>s.evaluate(i)))],max:[Je,la(Je),(i,n)=>Math.max(...n.map(s=>s.evaluate(i)))],abs:[Je,[Je],(i,[n])=>Math.abs(n.evaluate(i))],round:[Je,[Je],(i,[n])=>{const s=n.evaluate(i);return s<0?-Math.round(-s):Math.round(s)}],floor:[Je,[Je],(i,[n])=>Math.floor(n.evaluate(i))],ceil:[Je,[Je],(i,[n])=>Math.ceil(n.evaluate(i))],"filter-==":[ot,[_t,kt],(i,[n,s])=>i.properties()[n.value]===s.value],"filter-id-==":[ot,[kt],(i,[n])=>i.id()===n.value],"filter-type-==":[ot,[_t],(i,[n])=>i.geometryType()===n.value],"filter-<":[ot,[_t,kt],(i,[n,s])=>{const l=i.properties()[n.value],h=s.value;return typeof l==typeof h&&l<h}],"filter-id-<":[ot,[kt],(i,[n])=>{const s=i.id(),l=n.value;return typeof s==typeof l&&s<l}],"filter->":[ot,[_t,kt],(i,[n,s])=>{const l=i.properties()[n.value],h=s.value;return typeof l==typeof h&&l>h}],"filter-id->":[ot,[kt],(i,[n])=>{const s=i.id(),l=n.value;return typeof s==typeof l&&s>l}],"filter-<=":[ot,[_t,kt],(i,[n,s])=>{const l=i.properties()[n.value],h=s.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[ot,[kt],(i,[n])=>{const s=i.id(),l=n.value;return typeof s==typeof l&&s<=l}],"filter->=":[ot,[_t,kt],(i,[n,s])=>{const l=i.properties()[n.value],h=s.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[ot,[kt],(i,[n])=>{const s=i.id(),l=n.value;return typeof s==typeof l&&s>=l}],"filter-has":[ot,[kt],(i,[n])=>n.value in i.properties()],"filter-has-id":[ot,[],i=>null!==i.id()&&void 0!==i.id()],"filter-type-in":[ot,[di(_t)],(i,[n])=>n.value.indexOf(i.geometryType())>=0],"filter-id-in":[ot,[di(kt)],(i,[n])=>n.value.indexOf(i.id())>=0],"filter-in-small":[ot,[_t,di(kt)],(i,[n,s])=>s.value.indexOf(i.properties()[n.value])>=0],"filter-in-large":[ot,[_t,di(kt)],(i,[n,s])=>function(l,h,p,_){for(;p<=_;){const v=p+_>>1;if(h[v]===l)return!0;h[v]>l?_=v-1:p=v+1}return!1}(i.properties()[n.value],s.value,0,s.value.length-1)],all:{type:ot,overloads:[[[ot,ot],(i,[n,s])=>n.evaluate(i)&&s.evaluate(i)],[la(ot),(i,n)=>{for(const s of n)if(!s.evaluate(i))return!1;return!0}]]},any:{type:ot,overloads:[[[ot,ot],(i,[n,s])=>n.evaluate(i)||s.evaluate(i)],[la(ot),(i,n)=>{for(const s of n)if(s.evaluate(i))return!0;return!1}]]},"!":[ot,[ot],(i,[n])=>!n.evaluate(i)],"is-supported-script":[ot,[_t],(i,[n])=>{const s=i.globals&&i.globals.isSupportedScript;return!s||s(n.evaluate(i))}],upcase:[_t,[_t],(i,[n])=>n.evaluate(i).toUpperCase()],downcase:[_t,[_t],(i,[n])=>n.evaluate(i).toLowerCase()],concat:[_t,la(kt),(i,n)=>n.map(s=>Kr(s.evaluate(i))).join("")],"resolved-locale":[_t,[tn],(i,[n])=>n.evaluate(i).resolvedLocale()]});class ku{constructor(n,s){var l;this.expression=n,this._warningHistory={},this._evaluator=new up,this._defaultValue=s?"color"===(l=s).type&&qa(l.default)?new Wt(0,0,0,0):"color"===l.type?Wt.parse(l.default)||null:void 0===l.default?null:l.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(n,s,l,h,p,_,v,w){return this._evaluator.globals=n,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=h,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(n,s,l,h,p,_,v,w){this._evaluator.globals=n,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null;try{const C=this.expression.evaluate(this._evaluator);if(null==C||"number"==typeof C&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new kr(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,"undefined"!=typeof console&&console.warn(C.message)),this._defaultValue}}}function Za(i){return Array.isArray(i)&&i.length>0&&"string"==typeof i[0]&&i[0]in Io}function Wa(i,n){const s=new ta(Io,[],n?function(h){const p={color:Zo,string:_t,number:Je,enum:_t,boolean:ot,formatted:Xs,resolvedImage:Xr};return"array"===h.type?di(p[h.value]||kt,h.length):p[h.type]}(n):void 0),l=s.parse(i,void 0,void 0,void 0,n&&"string"===n.type?{typeAnnotation:"coerce"}:void 0);return l?pp(new ku(l,n)):Ts(s.errors)}class Xa{constructor(n,s){this.kind=n,this._styleExpression=s,this.isStateDependent="constant"!==n&&!ji(s.expression)}evaluateWithoutErrorHandling(n,s,l,h,p,_){return this._styleExpression.evaluateWithoutErrorHandling(n,s,l,h,p,_)}evaluate(n,s,l,h,p,_){return this._styleExpression.evaluate(n,s,l,h,p,_)}}class Fu{constructor(n,s,l,h){this.kind=n,this.zoomStops=l,this._styleExpression=s,this.isStateDependent="camera"!==n&&!ji(s.expression),this.interpolationType=h}evaluateWithoutErrorHandling(n,s,l,h,p,_){return this._styleExpression.evaluateWithoutErrorHandling(n,s,l,h,p,_)}evaluate(n,s,l,h,p,_){return this._styleExpression.evaluate(n,s,l,h,p,_)}interpolationFactor(n,s,l){return this.interpolationType?Mn.interpolationFactor(this.interpolationType,n,s,l):0}}function Ac(i,n){if("error"===(i=Wa(i,n)).result)return i;const s=i.value.expression,l=Xn(s);if(!l&&!Bl(n))return Ts([new Co("","data expressions not supported")]);const h=ao(s,["zoom","pitch","distance-from-center"]);if(!h&&!fp(n))return Ts([new Co("","zoom expressions not supported")]);const p=Yr(s);return p||h?p instanceof Co?Ts([p]):p instanceof Mn&&!Hh(n)?Ts([new Co("",'"interpolate" expressions cannot be used with this property')]):pp(p?new Fu(l?"camera":"composite",i.value,p.labels,p instanceof Mn?p.interpolation:void 0):new Xa(l?"constant":"source",i.value)):Ts([new Co("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ka{constructor(n,s){this._parameters=n,this._specification=s,Ws(this,Ic(this._parameters,this._specification))}static deserialize(n){return new Ka(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Yr(i){let n=null;if(i instanceof fi)n=Yr(i.result);else if(i instanceof Ui){for(const s of i.args)if(n=Yr(s),n)break}else(i instanceof Cs||i instanceof Mn)&&i.input instanceof br&&"zoom"===i.input.name&&(n=i);return n instanceof Co||i.eachChild(s=>{const l=Yr(s);l instanceof Co?n=l:!n&&l?n=new Co("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&l&&n!==l&&(n=new Co("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function mi(i){const n=i.key,s=i.value,l=i.valueSpec||{},h=i.objectElementValidators||{},p=i.style,_=i.styleSpec;let v=[];const w=Yt(s);if("object"!==w)return[new qe(n,s,`object expected, ${w} found`)];for(const C in s){const S=C.split(".")[0],I=l[S]||l["*"];let A;if(h[S])A=h[S];else if(l[S])A=Cr;else if(h["*"])A=h["*"];else{if(!l["*"]){v.push(new qe(n,s[C],`unknown property "${C}"`));continue}A=Cr}v=v.concat(A({key:(n&&`${n}.`)+C,value:s[C],valueSpec:I,style:p,styleSpec:_,object:s,objectKey:C},s))}for(const C in l)h[C]||l[C].required&&void 0===l[C].default&&void 0===s[C]&&v.push(new qe(n,s,`missing required property "${C}"`));return v}function Ru(i){const n=i.value,s=i.valueSpec,l=i.style,h=i.styleSpec,p=i.key,_=i.arrayElementValidator||Cr;if("array"!==Yt(n))return[new qe(p,n,`array expected, ${Yt(n)} found`)];if(s.length&&n.length!==s.length)return[new qe(p,n,`array length ${s.length} expected, length ${n.length} found`)];if(s["min-length"]&&n.length<s["min-length"])return[new qe(p,n,`array length at least ${s["min-length"]} expected, length ${n.length} found`)];let v={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum};h.$version<7&&(v.function=s.function),"object"===Yt(s.value)&&(v=s.value);let w=[];for(let C=0;C<n.length;C++)w=w.concat(_({array:n,arrayIndex:C,value:n[C],valueSpec:v,style:l,styleSpec:h,key:`${p}[${C}]`}));return w}function Pc(i){const n=i.key,s=i.value,l=i.valueSpec;let h=Yt(s);if("number"===h&&s!=s&&(h="NaN"),"number"!==h)return[new qe(n,s,`number expected, ${h} found`)];if("minimum"in l){let p=l.minimum;if("array"===Yt(l.minimum)&&(p=l.minimum[i.arrayIndex]),s<p)return[new qe(n,s,`${s} is less than the minimum value ${p}`)]}if("maximum"in l){let p=l.maximum;if("array"===Yt(l.maximum)&&(p=l.maximum[i.arrayIndex]),s>p)return[new qe(n,s,`${s} is greater than the maximum value ${p}`)]}return[]}function kc(i){const n=i.valueSpec,s=Wn(i.value.type);let l,h,p,_={};const v="categorical"!==s&&void 0===i.value.property,w=!v,C="array"===Yt(i.value.stops)&&"array"===Yt(i.value.stops[0])&&"object"===Yt(i.value.stops[0][0]),S=mi({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(O){if("identity"===s)return[new qe(O.key,O.value,'identity function may not have a "stops" property')];let N=[];const U=O.value;return N=N.concat(Ru({key:O.key,value:U,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:I})),"array"===Yt(U)&&0===U.length&&N.push(new qe(O.key,U,"array must have at least one stop")),N},default:function(O){return Cr({key:O.key,value:O.value,valueSpec:n,style:O.style,styleSpec:O.styleSpec})}}});return"identity"===s&&v&&S.push(new qe(i.key,i.value,'missing required property "property"')),"identity"===s||i.value.stops||S.push(new qe(i.key,i.value,'missing required property "stops"')),"exponential"===s&&i.valueSpec.expression&&!Hh(i.valueSpec)&&S.push(new qe(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(w&&!Bl(i.valueSpec)?S.push(new qe(i.key,i.value,"property functions not supported")):v&&!fp(i.valueSpec)&&S.push(new qe(i.key,i.value,"zoom functions not supported"))),"categorical"!==s&&!C||void 0!==i.value.property||S.push(new qe(i.key,i.value,'"property" property is required')),S;function I(O){let N=[];const U=O.value,q=O.key;if("array"!==Yt(U))return[new qe(q,U,`array expected, ${Yt(U)} found`)];if(2!==U.length)return[new qe(q,U,`array length 2 expected, length ${U.length} found`)];if(C){if("object"!==Yt(U[0]))return[new qe(q,U,`object expected, ${Yt(U[0])} found`)];if(void 0===U[0].zoom)return[new qe(q,U,"object stop key must have zoom")];if(void 0===U[0].value)return[new qe(q,U,"object stop key must have value")];if(p&&p>Wn(U[0].zoom))return[new qe(q,U[0].zoom,"stop zoom values must appear in ascending order")];Wn(U[0].zoom)!==p&&(p=Wn(U[0].zoom),h=void 0,_={}),N=N.concat(mi({key:`${q}[0]`,value:U[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:Pc,value:A}}))}else N=N.concat(A({key:`${q}[0]`,value:U[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},U));return Za(bs(U[1]))?N.concat([new qe(`${q}[1]`,U[1],"expressions are not allowed in function stops.")]):N.concat(Cr({key:`${q}[1]`,value:U[1],valueSpec:n,style:O.style,styleSpec:O.styleSpec}))}function A(O,N){const U=Yt(O.value),q=Wn(O.value),J=null!==O.value?O.value:N;if(l){if(U!==l)return[new qe(O.key,J,`${U} stop domain type must match previous stop domain type ${l}`)]}else l=U;if("number"!==U&&"string"!==U&&"boolean"!==U)return[new qe(O.key,J,"stop domain value must be a number, string, or boolean")];if("number"!==U&&"categorical"!==s){let ie=`number expected, ${U} found`;return Bl(n)&&void 0===s&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new qe(O.key,J,ie)]}return"categorical"!==s||"number"!==U||isFinite(q)&&Math.floor(q)===q?"categorical"!==s&&"number"===U&&void 0!==h&&q<h?[new qe(O.key,J,"stop domain values must appear in ascending order")]:(h=q,"categorical"===s&&q in _?[new qe(O.key,J,"stop domain values must be unique")]:(_[q]=!0,[])):[new qe(O.key,J,`integer expected, found ${q}`)]}}function Jo(i){const n=("property"===i.expressionContext?Ac:Wa)(bs(i.value),i.valueSpec);if("error"===n.result)return n.value.map(l=>new qe(`${i.key}${l.key}`,i.value,l.message));const s=n.value.expression||n.value._styleExpression.expression;if("property"===i.expressionContext&&"text-font"===i.propertyKey&&!s.outputDefined())return[new qe(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===i.expressionContext&&"layout"===i.propertyType&&!ji(s))return[new qe(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===i.expressionContext)return Nl(s,i);if(i.expressionContext&&0===i.expressionContext.indexOf("cluster")){if(!ao(s,["zoom","feature-state"]))return[new qe(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===i.expressionContext&&!Xn(s))return[new qe(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Nl(i,n){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const h of n.valueSpec.expression.parameters)s.delete(h);if(0===s.size)return[];const l=[];return i instanceof br&&s.has(i.name)?[new qe(n.key,n.value,`["${i.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(i.eachChild(h=>{l.push(...Nl(h,n))}),l)}function Fc(i){const n=i.key,s=i.value,l=i.valueSpec,h=[];return Array.isArray(l.values)?-1===l.values.indexOf(Wn(s))&&h.push(new qe(n,s,`expected one of [${l.values.join(", ")}], ${JSON.stringify(s)} found`)):-1===Object.keys(l.values).indexOf(Wn(s))&&h.push(new qe(n,s,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(s)} found`)),h}function Ja(i){if(!0===i||!1===i)return!0;if(!Array.isArray(i)||0===i.length)return!1;switch(i[0]){case"has":return i.length>=2&&"$id"!==i[1]&&"$type"!==i[1];case"in":return i.length>=3&&("string"!=typeof i[1]||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==i.length||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const n of i.slice(1))if(!Ja(n)&&"boolean"!=typeof n)return!1;return!0;default:return!0}}function Lu(i,n="fill"){if(null==i)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ja(i)||(i=ca(i));const s=i;let l=!0;try{l=function(C){if(!Ya(C))return C;let S=bs(C);return Ou(S),S=Fn(S),S}(s)}catch(C){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(s,null,2)}\n        `)}const h=Ee[`filter_${n}`],p=Wa(l,h);let _=null;if("error"===p.result)throw new Error(p.value.map(C=>`${C.key}: ${C.message}`).join(", "));_=(C,S,I)=>p.value.evaluate(C,S,{},I);let v=null,w=null;if(l!==s){const C=Wa(s,h);if("error"===C.result)throw new Error(C.value.map(S=>`${S.key}: ${S.message}`).join(", "));v=(S,I,A,O,N)=>C.value.evaluate(S,I,{},A,void 0,void 0,O,N),w=!Xn(C.value.expression)}return _=_,{filter:_,dynamicFilter:v||void 0,needGeometry:Zh(l),needFeature:!!w}}function Fn(i){if(!Array.isArray(i))return i;const n=function(s){if(ir.has(s[0]))for(let l=1;l<s.length;l++)if(Ya(s[l]))return!0;return s}(i);return!0===n?n:n.map(s=>Fn(s))}function Ou(i){let n=!1;const s=[];if("case"===i[0]){for(let l=1;l<i.length-1;l+=2)n=n||Ya(i[l]),s.push(i[l+1]);s.push(i[i.length-1])}else if("match"===i[0]){n=n||Ya(i[1]);for(let l=2;l<i.length-1;l+=2)s.push(i[l+1]);s.push(i[i.length-1])}else if("step"===i[0]){n=n||Ya(i[1]);for(let l=1;l<i.length-1;l+=2)s.push(i[l+1])}n&&(i.length=0,i.push("any",...s));for(let l=1;l<i.length;l++)Ou(i[l])}function Ya(i){if(!Array.isArray(i))return!1;if("pitch"===(n=i[0])||"distance-from-center"===n)return!0;var n;for(let s=1;s<i.length;s++)if(Ya(i[s]))return!0;return!1}const ir=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function gp(i,n){return i<n?-1:i>n?1:0}function Zh(i){if(!Array.isArray(i))return!1;if("within"===i[0])return!0;for(let n=1;n<i.length;n++)if(Zh(i[n]))return!0;return!1}function ca(i){if(!i)return!0;const n=i[0];return i.length<=1?"any"!==n:"=="===n?gi(i[1],i[2],"=="):"!="===n?Yo(gi(i[1],i[2],"==")):"<"===n||">"===n||"<="===n||">="===n?gi(i[1],i[2],n):"any"===n?(s=i.slice(1),["any"].concat(s.map(ca))):"all"===n?["all"].concat(i.slice(1).map(ca)):"none"===n?["all"].concat(i.slice(1).map(ca).map(Yo)):"in"===n?Wh(i[1],i.slice(2)):"!in"===n?Yo(Wh(i[1],i.slice(2))):"has"===n?Rc(i[1]):"!has"===n?Yo(Rc(i[1])):"within"!==n||i;var s}function gi(i,n,s){switch(i){case"$type":return[`filter-type-${s}`,n];case"$id":return[`filter-id-${s}`,n];default:return[`filter-${s}`,i,n]}}function Wh(i,n){if(0===n.length)return!1;switch(i){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(s=>typeof s!=typeof n[0])?["filter-in-large",i,["literal",n.sort(gp)]]:["filter-in-small",i,["literal",n]]}}function Rc(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Yo(i){return["!",i]}function Qr(i){if(Ja(bs(i.value))){const n=bs(i.layerType);return Jo(Ws({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${n||"fill"}`]}))}return zu(i)}function zu(i){const n=i.value,s=i.key;if("array"!==Yt(n))return[new qe(s,n,`array expected, ${Yt(n)} found`)];const l=i.styleSpec;let h,p=[];if(n.length<1)return[new qe(s,n,"filter array must have at least 1 element")];switch(p=p.concat(Fc({key:`${s}[0]`,value:n[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),Wn(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===Wn(n[1])&&p.push(new qe(s,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":3!==n.length&&p.push(new qe(s,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(h=Yt(n[1]),"string"!==h&&p.push(new qe(`${s}[1]`,n[1],`string expected, ${h} found`)));for(let _=2;_<n.length;_++)h=Yt(n[_]),"$type"===Wn(n[1])?p=p.concat(Fc({key:`${s}[${_}]`,value:n[_],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&p.push(new qe(`${s}[${_}]`,n[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<n.length;_++)p=p.concat(zu({key:`${s}[${_}]`,value:n[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=Yt(n[1]),2!==n.length?p.push(new qe(s,n,`filter array for "${n[0]}" operator must have 2 elements`)):"string"!==h&&p.push(new qe(`${s}[1]`,n[1],`string expected, ${h} found`));break;case"within":h=Yt(n[1]),2!==n.length?p.push(new qe(s,n,`filter array for "${n[0]}" operator must have 2 elements`)):"object"!==h&&p.push(new qe(`${s}[1]`,n[1],`object expected, ${h} found`))}return p}function ua(i,n){const s=i.key,l=i.style,h=i.styleSpec,p=i.value,_=i.objectKey,v=h[`${n}_${i.layerType}`];if(!v)return[];const w=_.match(/^(.*)-transition$/);if("paint"===n&&w&&v[w[1]]&&v[w[1]].transition)return Cr({key:s,value:p,valueSpec:h.transition,style:l,styleSpec:h});const C=i.valueSpec||v[_];if(!C)return[new qe(s,p,`unknown property "${_}"`)];let S;if("string"===Yt(p)&&Bl(C)&&!C.tokens&&(S=/^{([^}]+)}$/.exec(p)))return[new qe(s,p,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const I=[];return"symbol"===i.layerType&&("text-field"===_&&l&&!l.glyphs&&I.push(new qe(s,p,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&qa(bs(p))&&"identity"===Wn(p.type)&&I.push(new qe(s,p,'"text-font" does not support identity functions'))),I.concat(Cr({key:i.key,value:p,valueSpec:C,style:l,styleSpec:h,expressionContext:"property",propertyType:n,propertyKey:_}))}function Xh(i){return ua(i,"paint")}function Qo(i){return ua(i,"layout")}function Qa(i){let n=[];const s=i.value,l=i.key,h=i.style,p=i.styleSpec;s.type||s.ref||n.push(new qe(l,s,'either "type" or "ref" is required'));let _=Wn(s.type);const v=Wn(s.ref);if(s.id){const w=Wn(s.id);for(let C=0;C<i.arrayIndex;C++){const S=h.layers[C];Wn(S.id)===w&&n.push(new qe(l,s.id,`duplicate layer id "${s.id}", previously used at line ${S.id.__line__}`))}}if("ref"in s){let w;["type","source","source-layer","filter","layout"].forEach(C=>{C in s&&n.push(new qe(l,s[C],`"${C}" is prohibited for ref layers`))}),h.layers.forEach(C=>{Wn(C.id)===v&&(w=C)}),w?w.ref?n.push(new qe(l,s.ref,"ref cannot reference another ref layer")):_=Wn(w.type):n.push(new qe(l,s.ref,`ref layer "${v}" not found`))}else if("background"!==_&&"sky"!==_)if(s.source){const w=h.sources&&h.sources[s.source],C=w&&Wn(w.type);w?"vector"===C&&"raster"===_?n.push(new qe(l,s.source,`layer "${s.id}" requires a raster source`)):"raster"===C&&"raster"!==_?n.push(new qe(l,s.source,`layer "${s.id}" requires a vector source`)):"vector"!==C||s["source-layer"]?"raster-dem"===C&&"hillshade"!==_?n.push(new qe(l,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!s.paint||!s.paint["line-gradient"]||"geojson"===C&&w.lineMetrics||n.push(new qe(l,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new qe(l,s,`layer "${s.id}" must specify a "source-layer"`)):n.push(new qe(l,s.source,`source "${s.source}" not found`))}else n.push(new qe(l,s,'missing required property "source"'));return n=n.concat(mi({key:l,value:s,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Cr({key:`${l}.type`,value:s.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,object:s,objectKey:"type"}),filter:w=>Qr(Ws({layerType:_},w)),layout:w=>mi({layer:s,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":C=>Qo(Ws({layerType:_},C))}}),paint:w=>mi({layer:s,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":C=>Xh(Ws({layerType:_},C))}})}})),n}function Ms(i){const n=i.value,s=i.key,l=Yt(n);return"string"!==l?[new qe(s,n,`string expected, ${l} found`)]:[]}const bt={promoteId:function({key:i,value:n}){if("string"===Yt(n))return Ms({key:i,value:n});{const s=[];for(const l in n)s.push(...Ms({key:`${i}.${l}`,value:n[l]}));return s}}};function _p(i){const n=i.value,s=i.key,l=i.styleSpec,h=i.style;if(!n.type)return[new qe(s,n,'"type" is required')];const p=Wn(n.type);let _;switch(p){case"vector":case"raster":case"raster-dem":return _=mi({key:s,value:n,valueSpec:l[`source_${p.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:bt}),_;case"geojson":if(_=mi({key:s,value:n,valueSpec:l.source_geojson,style:h,styleSpec:l,objectElementValidators:bt}),n.cluster)for(const v in n.clusterProperties){const[w,C]=n.clusterProperties[v],S="string"==typeof w?[w,["accumulated"],["get",v]]:w;_.push(...Jo({key:`${s}.${v}.map`,value:C,expressionContext:"cluster-map"})),_.push(...Jo({key:`${s}.${v}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return _;case"video":return mi({key:s,value:n,valueSpec:l.source_video,style:h,styleSpec:l});case"image":return mi({key:s,value:n,valueSpec:l.source_image,style:h,styleSpec:l});case"canvas":return[new qe(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fc({key:`${s}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:l})}}function Bu(i){const n=i.value,s=i.styleSpec,l=s.light,h=i.style;let p=[];const _=Yt(n);if(void 0===n)return p;if("object"!==_)return p=p.concat([new qe("light",n,`object expected, ${_} found`)]),p;for(const v in n){const w=v.match(/^(.*)-transition$/);p=p.concat(w&&l[w[1]]&&l[w[1]].transition?Cr({key:v,value:n[v],valueSpec:s.transition,style:h,styleSpec:s}):l[v]?Cr({key:v,value:n[v],valueSpec:l[v],style:h,styleSpec:s}):[new qe(v,n[v],`unknown property "${v}"`)])}return p}function Nu(i){const n=i.value,s=i.key,l=i.style,h=i.styleSpec,p=h.terrain;let _=[];const v=Yt(n);if(void 0===n)return _;if("object"!==v)return _=_.concat([new qe("terrain",n,`object expected, ${v} found`)]),_;for(const w in n){const C=w.match(/^(.*)-transition$/);_=_.concat(C&&p[C[1]]&&p[C[1]].transition?Cr({key:w,value:n[w],valueSpec:h.transition,style:l,styleSpec:h}):p[w]?Cr({key:w,value:n[w],valueSpec:p[w],style:l,styleSpec:h}):[new qe(w,n[w],`unknown property "${w}"`)])}if(n.source){const w=l.sources&&l.sources[n.source],C=w&&Wn(w.type);w?"raster-dem"!==C&&_.push(new qe(s,n.source,`terrain cannot be used with a source of type ${C}, it only be used with a "raster-dem" source type`)):_.push(new qe(s,n.source,`source "${n.source}" not found`))}else _.push(new qe(s,n,'terrain is missing required property "source"'));return _}function Vu(i){const n=i.value,s=i.style,l=i.styleSpec,h=l.fog;let p=[];const _=Yt(n);if(void 0===n)return p;if("object"!==_)return p=p.concat([new qe("fog",n,`object expected, ${_} found`)]),p;for(const v in n){const w=v.match(/^(.*)-transition$/);p=p.concat(w&&h[w[1]]&&h[w[1]].transition?Cr({key:v,value:n[v],valueSpec:l.transition,style:s,styleSpec:l}):h[v]?Cr({key:v,value:n[v],valueSpec:h[v],style:s,styleSpec:l}):[new qe(v,n[v],`unknown property "${v}"`)])}return p}const Lc={"*":()=>[],array:Ru,boolean:function(i){const n=i.value,s=i.key,l=Yt(n);return"boolean"!==l?[new qe(s,n,`boolean expected, ${l} found`)]:[]},number:Pc,color:function(i){const n=i.key,s=i.value,l=Yt(s);return"string"!==l?[new qe(n,s,`color expected, ${l} found`)]:null===Ks.parseCSSColor(s)?[new qe(n,s,`color expected, "${s}" found`)]:[]},constants:ap,enum:Fc,filter:Qr,function:kc,layer:Qa,object:mi,source:_p,light:Bu,terrain:Nu,fog:Vu,string:Ms,formatted:function(i){return 0===Ms(i).length?[]:Jo(i)},resolvedImage:function(i){return 0===Ms(i).length?[]:Jo(i)},projection:function(i){const n=i.value,s=i.styleSpec,l=s.projection,h=i.style;let p=[];const _=Yt(n);if("object"===_)for(const v in n)p=p.concat(Cr({key:v,value:n[v],valueSpec:l[v],style:h,styleSpec:s}));else"string"!==_&&(p=p.concat([new qe("projection",n,`object or string expected, ${_} found`)]));return p}};function Cr(i){const n=i.value,s=i.valueSpec,l=i.styleSpec;return s.expression&&qa(Wn(n))?kc(i):s.expression&&Za(bs(n))?Jo(i):s.type&&Lc[s.type]?Lc[s.type](i):mi(Ws({},i,{valueSpec:s.type?l[s.type]:s}))}function ju(i){const n=i.value,s=i.key,l=Ms(i);return l.length||(-1===n.indexOf("{fontstack}")&&l.push(new qe(s,n,'"glyphs" url must include a "{fontstack}" token')),-1===n.indexOf("{range}")&&l.push(new qe(s,n,'"glyphs" url must include a "{range}" token'))),l}function ze(i,n=Ee){let s=[];return s=s.concat(Cr({key:"",value:i,valueSpec:n.$root,styleSpec:n,style:i,objectElementValidators:{glyphs:ju,"*":()=>[]}})),i.constants&&(s=s.concat(ap({key:"constants",value:i.constants,style:i,styleSpec:n}))),Qt(s)}function Qt(i){return[].concat(i).sort((n,s)=>n.line-s.line)}function ei(i){return function(...n){return Qt(i.apply(this,n))}}ze.source=ei(_p),ze.light=ei(Bu),ze.terrain=ei(Nu),ze.fog=ei(Vu),ze.layer=ei(Qa),ze.filter=ei(Qr),ze.paintProperty=ei(Xh),ze.layoutProperty=ei(Qo);const zn=ze,ha=zn.light,Vl=zn.fog,Gi=zn.paintProperty,Uu=zn.layoutProperty;function Oc(i,n){let s=!1;if(n&&n.length)for(const l of n)i.fire(new vu(new Error(l.message))),s=!0;return s}var zc=ti;function ti(i,n,s){var l=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(n=h[1])+2*(s=h[2]);for(var p=0;p<this.d*this.d;p++){var _=h[3+p],v=h[3+p+1];l.push(_===v?null:h.subarray(_,v))}var w=h[3+l.length+1];this.keys=h.subarray(h[3+l.length],w),this.bboxes=h.subarray(w),this.insert=this._insertReadonly}else{this.d=n+2*s;for(var C=0;C<this.d*this.d;C++)l.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=i,this.padding=s,this.scale=n/i,this.uid=0;var S=s/n*i;this.min=-S,this.max=i+S}ti.prototype.insert=function(i,n,s,l,h){this._forEachCell(n,s,l,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(h)},ti.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ti.prototype._insertCell=function(i,n,s,l,h,p){this.cells[h].push(p)},ti.prototype.query=function(i,n,s,l,h){var p=this.min,_=this.max;if(i<=p&&n<=p&&_<=s&&_<=l&&!h)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(i,n,s,l,this._queryCell,v,{},h),v},ti.prototype._queryCell=function(i,n,s,l,h,p,_,v){var w=this.cells[h];if(null!==w)for(var C=this.keys,S=this.bboxes,I=0;I<w.length;I++){var A=w[I];if(void 0===_[A]){var O=4*A;(v?v(S[O+0],S[O+1],S[O+2],S[O+3]):i<=S[O+2]&&n<=S[O+3]&&s>=S[O+0]&&l>=S[O+1])?(_[A]=!0,p.push(C[A])):_[A]=!1}}},ti.prototype._forEachCell=function(i,n,s,l,h,p,_,v){for(var w=this._convertToCellCoord(i),C=this._convertToCellCoord(n),S=this._convertToCellCoord(s),I=this._convertToCellCoord(l),A=w;A<=S;A++)for(var O=C;O<=I;O++){var N=this.d*O+A;if((!v||v(this._convertFromCellCoord(A),this._convertFromCellCoord(O),this._convertFromCellCoord(A+1),this._convertFromCellCoord(O+1)))&&h.call(this,i,n,s,l,N,p,_,v))return}},ti.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},ti.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},ti.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,n=3+this.cells.length+1+1,s=0,l=0;l<this.cells.length;l++)s+=this.cells[l].length;var h=new Int32Array(n+s+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var p=n,_=0;_<i.length;_++){var v=i[_];h[3+_]=p,h.set(v,p),p+=v.length}return h[3+i.length]=p,h.set(this.keys,p),h[3+i.length+1]=p+=this.keys.length,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer};const{ImageData:Ss,ImageBitmap:es}=Ae,mr={};function Xe(i,n,s={}){Object.defineProperty(n,"_classRegistryKey",{value:i,writeable:!1}),mr[i]={klass:n,omit:s.omit||[],shallow:s.shallow||[]}}Xe("Object",Object),zc.serialize=function(i,n){const s=i.toArrayBuffer();return n&&n.push(s),{buffer:s}},zc.deserialize=function(i){return new zc(i.buffer)},Xe("Grid",zc),Xe("Color",Wt),Xe("Error",Error),Xe("ResolvedImage",pr),Xe("StylePropertyFunction",Ka),Xe("StyleExpression",ku,{omit:["_evaluator"]}),Xe("ZoomDependentExpression",Fu),Xe("ZoomConstantExpression",Xa),Xe("CompoundExpression",br,{omit:["_evaluate"]});for(const i in Io)Io[i]._classRegistryKey||Xe(`Expression_${i}`,Io[i]);function da(i){return i&&"undefined"!=typeof ArrayBuffer&&(i instanceof ArrayBuffer||i.constructor&&"ArrayBuffer"===i.constructor.name)}function pa(i){return es&&i instanceof es}function Ri(i,n){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(da(i)||pa(i))return n&&n.push(i),i;if(ArrayBuffer.isView(i)){const s=i;return n&&n.push(s.buffer),s}if(i instanceof Ss)return n&&n.push(i.data.buffer),i;if(Array.isArray(i)){const s=[];for(const l of i)s.push(Ri(l,n));return s}if("object"==typeof i){const s=i.constructor,l=s._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class");const h=s.serialize?s.serialize(i,n):{};if(!s.serialize){for(const p in i){if(!i.hasOwnProperty(p)||mr[l].omit.indexOf(p)>=0)continue;const _=i[p];h[p]=mr[l].shallow.indexOf(p)>=0?_:Ri(_,n)}i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==l&&(h.$name=l),h}throw new Error("can't serialize object of type "+typeof i)}function Is(i){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||da(i)||pa(i)||ArrayBuffer.isView(i)||i instanceof Ss)return i;if(Array.isArray(i))return i.map(Is);if("object"==typeof i){const n=i.$name||"Object",{klass:s}=mr[n];if(!s)throw new Error(`can't deserialize unregistered class ${n}`);if(s.deserialize)return s.deserialize(i);const l=Object.create(s.prototype);for(const h of Object.keys(i)){if("$name"===h)continue;const p=i[h];l[h]=mr[n].shallow.indexOf(h)>=0?p:Is(p)}return l}throw new Error("can't deserialize object of type "+typeof i)}class f{constructor(){this.first=!0}update(n,s){const l=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=l,!0))}}const o=i=>i>=1536&&i<=1791,c=i=>i>=1872&&i<=1919,g=i=>i>=2208&&i<=2303,y=i=>i>=11904&&i<=12031,x=i=>i>=12032&&i<=12255,E=i=>i>=12272&&i<=12287,T=i=>i>=12288&&i<=12351,P=i=>i>=12352&&i<=12447,F=i=>i>=12448&&i<=12543,R=i=>i>=12544&&i<=12591,z=i=>i>=12704&&i<=12735,j=i=>i>=12736&&i<=12783,Z=i=>i>=12784&&i<=12799,H=i=>i>=12800&&i<=13055,W=i=>i>=13056&&i<=13311,oe=i=>i>=13312&&i<=19903,$=i=>i>=19968&&i<=40959,ne=i=>i>=40960&&i<=42127,ee=i=>i>=42128&&i<=42191,te=i=>i>=44032&&i<=55215,re=i=>i>=63744&&i<=64255,se=i=>i>=64336&&i<=65023,ge=i=>i>=65040&&i<=65055,xe=i=>i>=65072&&i<=65103,Ue=i=>i>=65104&&i<=65135,Re=i=>i>=65136&&i<=65279,ke=i=>i>=65280&&i<=65519;function be(i){for(const n of i)if(Me(n.charCodeAt(0)))return!0;return!1}function ve(i){for(const n of i)if(!Fe(n.charCodeAt(0)))return!1;return!0}function Fe(i){return!(o(i)||c(i)||g(i)||se(i)||Re(i))}function Me(i){return!(746!==i&&747!==i&&(i<4352||!(z(i)||R(i)||xe(i)&&!(i>=65097&&i<=65103)||re(i)||W(i)||y(i)||j(i)||!(!T(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||12336===i)||oe(i)||$(i)||H(i)||(n=i,n>=12592&&n<=12687)||(n=>n>=43360&&n<=43391)(i)||(n=>n>=55216&&n<=55295)(i)||(n=>n>=4352&&n<=4607)(i)||te(i)||P(i)||E(i)||(n=>n>=12688&&n<=12703)(i)||x(i)||Z(i)||F(i)&&12540!==i||!(!ke(i)||65288===i||65289===i||65293===i||i>=65306&&i<=65310||65339===i||65341===i||65343===i||i>=65371&&i<=65503||65507===i||i>=65512&&i<=65519)||!(!Ue(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(n=>n>=5120&&n<=5759)(i)||(n=>n>=6320&&n<=6399)(i)||ge(i)||(n=>n>=19904&&n<=19967)(i)||ne(i)||ee(i))));var n}function tt(i){return!(Me(i)||(n=i,(s=n)>=128&&s<=255&&(167===n||169===n||174===n||177===n||188===n||189===n||190===n||215===n||247===n)||(s=>s>=8192&&s<=8303)(n)&&(8214===n||8224===n||8225===n||8240===n||8241===n||8251===n||8252===n||8258===n||8263===n||8264===n||8265===n||8273===n)||(s=>s>=8448&&s<=8527)(n)||(s=>s>=8528&&s<=8591)(n)||(s=>s>=8960&&s<=9215)(n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||9003===n||n>=9085&&n<=9114||n>=9150&&n<=9165||9167===n||n>=9169&&n<=9179||n>=9186&&n<=9215)||(s=>s>=9216&&s<=9279)(n)&&9251!==n||(s=>s>=9280&&s<=9311)(n)||(s=>s>=9312&&s<=9471)(n)||(s=>s>=9632&&s<=9727)(n)||(s=>s>=9728&&s<=9983)(n)&&!(n>=9754&&n<=9759)||(s=>s>=11008&&s<=11263)(n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||T(n)||F(n)||(s=>s>=57344&&s<=63743)(n)||xe(n)||Ue(n)||ke(n)||8734===n||8756===n||8757===n||n>=9984&&n<=10087||n>=10102&&n<=10131||65532===n||65533===n));var n,s}function lt(i){return i>=1424&&i<=2303||se(i)||Re(i)}function Mt(i,n){return!(!n&&lt(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(s=i,s>=6016&&s<=6143));var s}function je(i){for(const n of i)if(lt(n.charCodeAt(0)))return!0;return!1}const st="deferred",mt="loading",ln="loaded";let _n=null,yt="unavailable",Lt=null;const yn=function(i){i&&"string"==typeof i&&i.indexOf("NetworkError")>-1&&(yt="error"),_n&&_n(i)};function Jn(){Vr.fire(new nr("pluginStateChange",{pluginStatus:yt,pluginURL:Lt}))}const Vr=new xs,ni=function(){return yt},$i=function(){if(yt!==st||!Lt)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");yt=mt,Jn(),Lt&&Ua({url:Lt},i=>{i?yn(i):(yt=ln,Jn())})},Ut={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>yt===ln||null!=Ut.applyArabicShaping,isLoading:()=>yt===mt,setState(i){yt=i.pluginStatus,Lt=i.pluginURL},isParsed:()=>null!=Ut.applyArabicShaping&&null!=Ut.processBidirectionalText&&null!=Ut.processStyledBidirectionalText,getPluginURL:()=>Lt};class ft{constructor(n,s){this.zoom=n,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new f,this.transition={},this.pitch=0)}isSupportedScript(n){return function(s,l){for(const h of s)if(!Mt(h.charCodeAt(0),l))return!1;return!0}(n,Ut.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,s=n-Math.floor(n),l=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}}}class Bt{constructor(n,s){this.property=n,this.value=s,this.expression=function(l,h){if(qa(l))return new Ka(l,h);if(Za(l)){const p=Ac(l,h);if("error"===p.result)throw new Error(p.value.map(_=>`${_.key}: ${_.message}`).join(", "));return p.value}{let p=l;return"string"==typeof l&&"color"===h.type&&(p=Wt.parse(l)),{kind:"constant",evaluate:()=>p}}}(void 0===s?n.specification.default:s,n.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(n,s,l){return this.property.possiblyEvaluate(this,n,s,l)}}class Dn{constructor(n){this.property=n,this.value=new Bt(n,void 0)}transitioned(n,s){return new pn(this.property,this.value,s,Un({},n.transition,this.transition),n.now)}untransitioned(){return new pn(this.property,this.value,null,{},0)}}class ri{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return Si(this._values[n].value.value)}setValue(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new Dn(this._values[n].property)),this._values[n].value=new Bt(this._values[n].property,null===s?void 0:Si(s))}getTransition(n){return Si(this._values[n].transition)}setTransition(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new Dn(this._values[n].property)),this._values[n].transition=Si(s)||void 0}serialize(){const n={};for(const s of Object.keys(this._values)){const l=this.getValue(s);void 0!==l&&(n[s]=l);const h=this.getTransition(s);void 0!==h&&(n[`${s}-transition`]=h)}return n}transitioned(n,s){const l=new Hi(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(n,s._values[h]);return l}untransitioned(){const n=new Hi(this._properties);for(const s of Object.keys(this._values))n._values[s]=this._values[s].untransitioned();return n}}class pn{constructor(n,s,l,h,p){const _=h.delay||0,v=h.duration||0;p=p||0,this.property=n,this.value=s,this.begin=p+_,this.end=this.begin+v,n.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(n,s,l){const h=n.now||0,p=this.value.possiblyEvaluate(n,s,l),_=this.prior;if(_){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return _.possiblyEvaluate(n,s,l);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(n,s,l),p,Oa(v))}}return p}}class Hi{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,s,l){const h=new fa(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(n,s,l);return h}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class el{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}getValue(n){return Si(this._values[n].value)}setValue(n,s){this._values[n]=new Bt(this._values[n].property,null===s?void 0:Si(s))}serialize(){const n={};for(const s of Object.keys(this._values)){const l=this.getValue(s);void 0!==l&&(n[s]=l)}return n}possiblyEvaluate(n,s,l){const h=new fa(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(n,s,l);return h}}class ii{constructor(n,s,l){this.property=n,this.value=s,this.parameters=l}isConstant(){return"constant"===this.value.kind}constantOr(n){return"constant"===this.value.kind?this.value.value:n}evaluate(n,s,l,h){return this.property.evaluate(this.value,this.parameters,n,s,l,h)}}class fa{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class nt{constructor(n){this.specification=n}possiblyEvaluate(n,s){return n.expression.evaluate(s)}interpolate(n,s,l){const h=fr[this.specification.type];return h?h(n,s,l):n}}class at{constructor(n,s){this.specification=n,this.overrides=s}possiblyEvaluate(n,s,l,h){return new ii(this,"constant"===n.expression.kind||"camera"===n.expression.kind?{kind:"constant",value:n.expression.evaluate(s,null,{},l,h)}:n.expression,s)}interpolate(n,s,l){if("constant"!==n.value.kind||"constant"!==s.value.kind)return n;if(void 0===n.value.value||void 0===s.value.value)return new ii(this,{kind:"constant",value:void 0},n.parameters);const h=fr[this.specification.type];return h?new ii(this,{kind:"constant",value:h(n.value.value,s.value.value,l)},n.parameters):n}evaluate(n,s,l,h,p,_){return"constant"===n.kind?n.value:n.evaluate(s,l,h,p,_)}}class or extends at{possiblyEvaluate(n,s,l,h){if(void 0===n.value)return new ii(this,{kind:"constant",value:void 0},s);if("constant"===n.expression.kind){const p=n.expression.evaluate(s,null,{},l,h),_="resolvedImage"===n.property.specification.type&&"string"!=typeof p?p.name:p,v=this._calculate(_,_,_,s);return new ii(this,{kind:"constant",value:v},s)}if("camera"===n.expression.kind){const p=this._calculate(n.expression.evaluate({zoom:s.zoom-1}),n.expression.evaluate({zoom:s.zoom}),n.expression.evaluate({zoom:s.zoom+1}),s);return new ii(this,{kind:"constant",value:p},s)}return new ii(this,n.expression,s)}evaluate(n,s,l,h,p,_){if("source"===n.kind){const v=n.evaluate(s,l,h,p,_);return this._calculate(v,v,v,s)}return"composite"===n.kind?this._calculate(n.evaluate({zoom:Math.floor(s.zoom)-1},l,h),n.evaluate({zoom:Math.floor(s.zoom)},l,h),n.evaluate({zoom:Math.floor(s.zoom)+1},l,h),s):n.value}_calculate(n,s,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:n,to:s,other:l}:{from:l,to:s,other:n}}interpolate(n){return n}}class ts{constructor(n){this.specification=n}possiblyEvaluate(n,s,l,h){if(void 0!==n.value){if("constant"===n.expression.kind){const p=n.expression.evaluate(s,null,{},l,h);return this._calculate(p,p,p,s)}return this._calculate(n.expression.evaluate(new ft(Math.floor(s.zoom-1),s)),n.expression.evaluate(new ft(Math.floor(s.zoom),s)),n.expression.evaluate(new ft(Math.floor(s.zoom+1),s)),s)}}_calculate(n,s,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:n,to:s}:{from:l,to:s}}interpolate(n){return n}}class co{constructor(n){this.specification=n}possiblyEvaluate(n,s,l,h){return!!n.expression.evaluate(s,null,{},l,h)}interpolate(){return!1}}class sr{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in n){const l=n[s];l.specification.overridable&&this.overridableProperties.push(s);const h=this.defaultPropertyValues[s]=new Bt(l,void 0),p=this.defaultTransitionablePropertyValues[s]=new Dn(l);this.defaultTransitioningPropertyValues[s]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=h.possiblyEvaluate({})}}}function tm(i,n){return 256*(i=cn(Math.floor(i),0,255))+cn(Math.floor(n),0,255)}Xe("DataDrivenProperty",at),Xe("DataConstantProperty",nt),Xe("CrossFadedDataDrivenProperty",or),Xe("CrossFadedProperty",ts),Xe("ColorRampProperty",co);const nm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Bc{constructor(n,s){this._structArray=n,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Hn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,s){return n._trim(),s&&(n.isTransferred=!0,s.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const s=Object.create(this.prototype);return s.arrayBuffer=n.arrayBuffer,s.length=n.length,s.capacity=n.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Rn(i,n=1){let s=0,l=0;return{members:i.map(h=>{const p=nm[h.type].BYTES_PER_ELEMENT,_=s=rm(s,Math.max(n,p)),v=h.components||1;return l=Math.max(l,p),s+=p*v,{name:h.name,type:h.type,components:v,offset:_}}),size:rm(s,Math.max(l,n)),alignment:n}}function rm(i,n){return Math.ceil(i/n)*n}class Nc extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s){const l=this.length;return this.resize(l+1),this.emplace(l,n,s)}emplace(n,s,l){const h=2*n;return this.int16[h+0]=s,this.int16[h+1]=l,n}}Nc.prototype.bytesPerElement=4,Xe("StructArrayLayout2i4",Nc);class ma extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,l,h)}emplace(n,s,l,h,p){const _=4*n;return this.int16[_+0]=s,this.int16[_+1]=l,this.int16[_+2]=h,this.int16[_+3]=p,n}}ma.prototype.bytesPerElement=8,Xe("StructArrayLayout4i8",ma);class jl extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,l,h,p,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,s,l,h,p,_,v)}emplace(n,s,l,h,p,_,v,w){const C=6*n,S=12*n,I=3*n;return this.int16[C+0]=s,this.int16[C+1]=l,this.uint8[S+4]=h,this.uint8[S+5]=p,this.uint8[S+6]=_,this.uint8[S+7]=v,this.float32[I+2]=w,n}}jl.prototype.bytesPerElement=12,Xe("StructArrayLayout2i4ub1f12",jl);class Vc extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,n,s,l)}emplace(n,s,l,h){const p=3*n;return this.float32[p+0]=s,this.float32[p+1]=l,this.float32[p+2]=h,n}}Vc.prototype.bytesPerElement=12,Xe("StructArrayLayout3f12",Vc);class ga extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,l,h,p,_,v,w,C,S){const I=this.length;return this.resize(I+1),this.emplace(I,n,s,l,h,p,_,v,w,C,S)}emplace(n,s,l,h,p,_,v,w,C,S,I){const A=10*n;return this.uint16[A+0]=s,this.uint16[A+1]=l,this.uint16[A+2]=h,this.uint16[A+3]=p,this.uint16[A+4]=_,this.uint16[A+5]=v,this.uint16[A+6]=w,this.uint16[A+7]=C,this.uint16[A+8]=S,this.uint16[A+9]=I,n}}ga.prototype.bytesPerElement=20,Xe("StructArrayLayout10ui20",ga);class Gu extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,l,h,p,_,v,w){const C=this.length;return this.resize(C+1),this.emplace(C,n,s,l,h,p,_,v,w)}emplace(n,s,l,h,p,_,v,w,C){const S=8*n;return this.uint16[S+0]=s,this.uint16[S+1]=l,this.uint16[S+2]=h,this.uint16[S+3]=p,this.uint16[S+4]=_,this.uint16[S+5]=v,this.uint16[S+6]=w,this.uint16[S+7]=C,n}}Gu.prototype.bytesPerElement=16,Xe("StructArrayLayout8ui16",Gu);class tl extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,l,h,p,_,v,w,C,S,I,A,O,N,U,q){const J=this.length;return this.resize(J+1),this.emplace(J,n,s,l,h,p,_,v,w,C,S,I,A,O,N,U,q)}emplace(n,s,l,h,p,_,v,w,C,S,I,A,O,N,U,q,J){const ie=16*n;return this.int16[ie+0]=s,this.int16[ie+1]=l,this.int16[ie+2]=h,this.int16[ie+3]=p,this.uint16[ie+4]=_,this.uint16[ie+5]=v,this.uint16[ie+6]=w,this.uint16[ie+7]=C,this.int16[ie+8]=S,this.int16[ie+9]=I,this.int16[ie+10]=A,this.int16[ie+11]=O,this.int16[ie+12]=N,this.int16[ie+13]=U,this.int16[ie+14]=q,this.int16[ie+15]=J,n}}tl.prototype.bytesPerElement=32,Xe("StructArrayLayout4i4ui4i4i32",tl);class jr extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint32[1*n+0]=s,n}}jr.prototype.bytesPerElement=4,Xe("StructArrayLayout1ul4",jr);class $u extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,l,h,p,_,v,w,C,S,I,A,O){const N=this.length;return this.resize(N+1),this.emplace(N,n,s,l,h,p,_,v,w,C,S,I,A,O)}emplace(n,s,l,h,p,_,v,w,C,S,I,A,O,N){const U=20*n,q=10*n;return this.int16[U+0]=s,this.int16[U+1]=l,this.int16[U+2]=h,this.int16[U+3]=p,this.int16[U+4]=_,this.float32[q+3]=v,this.float32[q+4]=w,this.float32[q+5]=C,this.float32[q+6]=S,this.int16[U+14]=I,this.uint32[q+8]=A,this.uint16[U+18]=O,this.uint16[U+19]=N,n}}$u.prototype.bytesPerElement=40,Xe("StructArrayLayout5i4f1i1ul2ui40",$u);class jc extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,l,h,p,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,s,l,h,p,_,v)}emplace(n,s,l,h,p,_,v,w){const C=8*n;return this.int16[C+0]=s,this.int16[C+1]=l,this.int16[C+2]=h,this.int16[C+4]=p,this.int16[C+5]=_,this.int16[C+6]=v,this.int16[C+7]=w,n}}jc.prototype.bytesPerElement=16,Xe("StructArrayLayout3i2i2i16",jc);class nl extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,l,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,s,l,h,p)}emplace(n,s,l,h,p,_){const v=4*n,w=8*n;return this.float32[v+0]=s,this.float32[v+1]=l,this.float32[v+2]=h,this.int16[w+6]=p,this.int16[w+7]=_,n}}nl.prototype.bytesPerElement=16,Xe("StructArrayLayout2f1f2i16",nl);class rl extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,l,h)}emplace(n,s,l,h,p){const _=12*n,v=3*n;return this.uint8[_+0]=s,this.uint8[_+1]=l,this.float32[v+1]=h,this.float32[v+2]=p,n}}rl.prototype.bytesPerElement=12,Xe("StructArrayLayout2ub2f12",rl);class Ur extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,n,s,l)}emplace(n,s,l,h){const p=3*n;return this.uint16[p+0]=s,this.uint16[p+1]=l,this.uint16[p+2]=h,n}}Ur.prototype.bytesPerElement=6,Xe("StructArrayLayout3ui6",Ur);class Kh extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,s,l,h,p,_,v,w,C,S,I,A,O,N,U,q,J,ie,ce,he,pe){const de=this.length;return this.resize(de+1),this.emplace(de,n,s,l,h,p,_,v,w,C,S,I,A,O,N,U,q,J,ie,ce,he,pe)}emplace(n,s,l,h,p,_,v,w,C,S,I,A,O,N,U,q,J,ie,ce,he,pe,de){const Ce=30*n,we=15*n,Ge=60*n;return this.int16[Ce+0]=s,this.int16[Ce+1]=l,this.int16[Ce+2]=h,this.float32[we+2]=p,this.float32[we+3]=_,this.uint16[Ce+8]=v,this.uint16[Ce+9]=w,this.uint32[we+5]=C,this.uint32[we+6]=S,this.uint32[we+7]=I,this.uint16[Ce+16]=A,this.uint16[Ce+17]=O,this.uint16[Ce+18]=N,this.float32[we+10]=U,this.float32[we+11]=q,this.uint8[Ge+48]=J,this.uint8[Ge+49]=ie,this.uint8[Ge+50]=ce,this.uint32[we+13]=he,this.int16[Ce+28]=pe,this.uint8[Ge+58]=de,n}}Kh.prototype.bytesPerElement=60,Xe("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",Kh);class Hu extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,s,l,h,p,_,v,w,C,S,I,A,O,N,U,q,J,ie,ce,he,pe,de,Ce,we,Ge,Be,De,Ve,Ze,Pe){const We=this.length;return this.resize(We+1),this.emplace(We,n,s,l,h,p,_,v,w,C,S,I,A,O,N,U,q,J,ie,ce,he,pe,de,Ce,we,Ge,Be,De,Ve,Ze,Pe)}emplace(n,s,l,h,p,_,v,w,C,S,I,A,O,N,U,q,J,ie,ce,he,pe,de,Ce,we,Ge,Be,De,Ve,Ze,Pe,We){const Qe=38*n,Nt=19*n;return this.int16[Qe+0]=s,this.int16[Qe+1]=l,this.int16[Qe+2]=h,this.float32[Nt+2]=p,this.float32[Nt+3]=_,this.int16[Qe+8]=v,this.int16[Qe+9]=w,this.int16[Qe+10]=C,this.int16[Qe+11]=S,this.int16[Qe+12]=I,this.int16[Qe+13]=A,this.uint16[Qe+14]=O,this.uint16[Qe+15]=N,this.uint16[Qe+16]=U,this.uint16[Qe+17]=q,this.uint16[Qe+18]=J,this.uint16[Qe+19]=ie,this.uint16[Qe+20]=ce,this.uint16[Qe+21]=he,this.uint16[Qe+22]=pe,this.uint16[Qe+23]=de,this.uint16[Qe+24]=Ce,this.uint16[Qe+25]=we,this.uint16[Qe+26]=Ge,this.uint16[Qe+27]=Be,this.uint16[Qe+28]=De,this.uint32[Nt+15]=Ve,this.float32[Nt+16]=Ze,this.float32[Nt+17]=Pe,this.float32[Nt+18]=We,n}}Hu.prototype.bytesPerElement=76,Xe("StructArrayLayout3i2f6i15ui1ul3f76",Hu);class _a extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.float32[1*n+0]=s,n}}_a.prototype.bytesPerElement=4,Xe("StructArrayLayout1f4",_a);class im extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,n,s,l)}emplace(n,s,l,h){const p=3*n;return this.int16[p+0]=s,this.int16[p+1]=l,this.int16[p+2]=h,n}}im.prototype.bytesPerElement=6,Xe("StructArrayLayout3i6",im);class qu extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,l,h,p,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,s,l,h,p,_,v)}emplace(n,s,l,h,p,_,v,w){const C=7*n;return this.float32[C+0]=s,this.float32[C+1]=l,this.float32[C+2]=h,this.float32[C+3]=p,this.float32[C+4]=_,this.float32[C+5]=v,this.float32[C+6]=w,n}}qu.prototype.bytesPerElement=28,Xe("StructArrayLayout7f28",qu);class Xt extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,l,h)}emplace(n,s,l,h,p){const _=6*n;return this.uint32[3*n+0]=s,this.uint16[_+2]=l,this.uint16[_+3]=h,this.uint16[_+4]=p,n}}Xt.prototype.bytesPerElement=12,Xe("StructArrayLayout1ul3ui12",Xt);class Ul extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s){const l=this.length;return this.resize(l+1),this.emplace(l,n,s)}emplace(n,s,l){const h=2*n;return this.uint16[h+0]=s,this.uint16[h+1]=l,n}}Ul.prototype.bytesPerElement=4,Xe("StructArrayLayout2ui4",Ul);class yp extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint16[1*n+0]=s,n}}yp.prototype.bytesPerElement=2,Xe("StructArrayLayout1ui2",yp);class vp extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s){const l=this.length;return this.resize(l+1),this.emplace(l,n,s)}emplace(n,s,l){const h=2*n;return this.float32[h+0]=s,this.float32[h+1]=l,n}}vp.prototype.bytesPerElement=8,Xe("StructArrayLayout2f8",vp);class om extends Hn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,l,h)}emplace(n,s,l,h,p){const _=4*n;return this.float32[_+0]=s,this.float32[_+1]=l,this.float32[_+2]=h,this.float32[_+3]=p,n}}om.prototype.bytesPerElement=16,Xe("StructArrayLayout4f16",om);class g_ extends Bc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}g_.prototype.size=40;class sm extends $u{get(n){return new g_(this,n)}}Xe("CollisionBoxArray",sm);class __ extends Bc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}__.prototype.size=60;class Uc extends Kh{get(n){return new __(this,n)}}Xe("PlacedSymbolArray",Uc);class y_ extends Bc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(n){this._structArray.uint32[this._pos4+15]=n}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}y_.prototype.size=76;class Dr extends Hu{get(n){return new y_(this,n)}}Xe("SymbolInstanceArray",Dr);class Jh extends _a{getoffsetX(n){return this.float32[1*n+0]}}Xe("GlyphOffsetArray",Jh);class Gc extends im{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}Xe("SymbolLineVertexArray",Gc);class v_ extends Bc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}v_.prototype.size=12;class am extends Xt{get(n){return new v_(this,n)}}Xe("FeatureIndexArray",am);class uo extends Bc{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}uo.prototype.size=4;class ns extends Ul{get(n){return new uo(this,n)}}Xe("FillExtrusionCentroidArray",ns);const lm=Rn([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Yh=Rn([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var $c=Es(function(i){i.exports=function(n,s){var l,h,p,_,v,w,C,S;for(h=n.length-(l=3&n.length),p=s,v=3432918353,w=461845907,S=0;S<h;)C=255&n.charCodeAt(S)|(255&n.charCodeAt(++S))<<8|(255&n.charCodeAt(++S))<<16|(255&n.charCodeAt(++S))<<24,++S,p=27492+(65535&(_=5*(65535&(p=(p^=C=(65535&(C=(C=(65535&C)*v+(((C>>>16)*v&65535)<<16)&4294967295)<<15|C>>>17))*w+(((C>>>16)*w&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(C=0,l){case 3:C^=(255&n.charCodeAt(S+2))<<16;case 2:C^=(255&n.charCodeAt(S+1))<<8;case 1:p^=C=(65535&(C=(C=(65535&(C^=255&n.charCodeAt(S)))*v+(((C>>>16)*v&65535)<<16)&4294967295)<<15|C>>>17))*w+(((C>>>16)*w&65535)<<16)&4294967295}return p^=n.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}}),cm=Es(function(i){i.exports=function(n,s){for(var l,h=n.length,p=s^h,_=0;h>=4;)l=1540483477*(65535&(l=255&n.charCodeAt(_)|(255&n.charCodeAt(++_))<<8|(255&n.charCodeAt(++_))<<16|(255&n.charCodeAt(++_))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:p^=(255&n.charCodeAt(_+2))<<16;case 2:p^=(255&n.charCodeAt(_+1))<<8;case 1:p=1540483477*(65535&(p^=255&n.charCodeAt(_)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}}),Zu=$c,x_=cm;Zu.murmur3=$c,Zu.murmur2=x_;class xp{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,s,l,h){this.ids.push(b_(n)),this.positions.push(s,l,h)}getPositions(n){const s=b_(n);let l=0,h=this.ids.length-1;for(;l<h;){const _=l+h>>1;this.ids[_]>=s?h=_:l=_+1}const p=[];for(;this.ids[l]===s;)p.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return p}static serialize(n,s){const l=new Float64Array(n.ids),h=new Uint32Array(n.positions);return Qh(l,h,0,l.length-1),s&&s.push(l.buffer,h.buffer),{ids:l,positions:h}}static deserialize(n){const s=new xp;return s.ids=n.ids,s.positions=n.positions,s.indexed=!0,s}}function b_(i){const n=+i;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:Zu(String(i))}function Qh(i,n,s,l){for(;s<l;){const h=i[s+l>>1];let p=s-1,_=l+1;for(;;){do{p++}while(i[p]<h);do{_--}while(i[_]>h);if(p>=_)break;_i(i,p,_),_i(n,3*p,3*_),_i(n,3*p+1,3*_+1),_i(n,3*p+2,3*_+2)}_-s<l-_?(Qh(i,n,s,_),s=_+1):(Qh(i,n,_+1,l),l=_)}}function _i(i,n,s){const l=i[n];i[n]=i[s],i[s]=l}Xe("FeaturePositionMap",xp);class rs{constructor(n,s){this.gl=n.gl,this.location=s}}class ya extends rs{constructor(n,s){super(n,s),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class w_ extends rs{constructor(n,s){super(n,s),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class bp extends rs{constructor(n,s){super(n,s),this.current=Wt.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const E_=new Float32Array(16),C_=new Float32Array(9),D_=new Float32Array(4);function wp(i){return[tm(255*i.r,255*i.g),tm(255*i.b,255*i.a)]}class Wu{constructor(n,s,l){this.value=n,this.uniformNames=s.map(h=>`u_${h}`),this.type=l}setUniform(n,s,l){n.set(l.constantOr(this.value))}getBinding(n,s,l){return"color"===this.type?new bp(n,s):new ya(n,s)}}class Gl{constructor(n,s){this.uniformNames=s.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=s.tl.concat(s.br),this.patternTo=n.tl.concat(n.br)}setUniform(n,s,l,h){const p="u_pattern_to"===h||"u_dash_to"===h?this.patternTo:"u_pattern_from"===h||"u_dash_from"===h?this.patternFrom:"u_pixel_ratio_to"===h?this.pixelRatioTo:"u_pixel_ratio_from"===h?this.pixelRatioFrom:null;p&&n.set(p)}getBinding(n,s,l){return"u_pattern_from"===l||"u_pattern_to"===l||"u_dash_from"===l||"u_dash_to"===l?new w_(n,s):new ya(n,s)}}class is{constructor(n,s,l,h){this.expression=n,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(p=>({name:`a_${p}`,type:"Float32",components:"color"===l?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(n,s,l,h,p,_){const v=this.paintVertexArray.length,w=this.expression.evaluate(new ft(0),s,{},p,h,_);this.paintVertexArray.resize(n),this._setPaintValue(v,n,w)}updatePaintArray(n,s,l,h,p){const _=this.expression.evaluate({zoom:0},l,h,void 0,p);this._setPaintValue(n,s,_)}_setPaintValue(n,s,l){if("color"===this.type){const h=wp(l);for(let p=n;p<s;p++)this.paintVertexArray.emplace(p,h[0],h[1])}else{for(let h=n;h<s;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class qi{constructor(n,s,l,h,p,_){this.expression=n,this.uniformNames=s.map(v=>`u_${v}_t`),this.type=l,this.useIntegerZoom=h,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:"color"===l?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(n,s,l,h,p,_){const v=this.expression.evaluate(new ft(this.zoom),s,{},p,h,_),w=this.expression.evaluate(new ft(this.zoom+1),s,{},p,h,_),C=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(C,n,v,w)}updatePaintArray(n,s,l,h,p){const _=this.expression.evaluate({zoom:this.zoom},l,h,void 0,p),v=this.expression.evaluate({zoom:this.zoom+1},l,h,void 0,p);this._setPaintValue(n,s,_,v)}_setPaintValue(n,s,l,h){if("color"===this.type){const p=wp(l),_=wp(h);for(let v=n;v<s;v++)this.paintVertexArray.emplace(v,p[0],p[1],_[0],_[1])}else{for(let p=n;p<s;p++)this.paintVertexArray.emplace(p,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,s){const l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,h=cn(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);n.set(h)}getBinding(n,s,l){return new ya(n,s)}}class $l{constructor(n,s,l,h,p,_,v){this.expression=n,this.type=l,this.useIntegerZoom=h,this.zoom=p,this.layerId=v,this.paintVertexAttributes=("array"===l?Yh:lm).members;for(let w=0;w<s.length;++w);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(n,s,l){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(h,n,s.patterns&&s.patterns[this.layerId],l)}updatePaintArray(n,s,l,h,p,_){this._setPaintValues(n,s,l.patterns&&l.patterns[this.layerId],_)}_setPaintValues(n,s,l,h){if(!h||!l)return;const{min:p,mid:_,max:v}=l,w=h[p],C=h[_],S=h[v];if(w&&C&&S)for(let I=n;I<s;I++)this._setPaintValue(this.zoomInPaintVertexArray,I,C,w),this._setPaintValue(this.zoomOutPaintVertexArray,I,C,S)}_setPaintValue(n,s,l,h){n.emplace(s,l.tl[0],l.tl[1],l.br[0],l.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],l.pixelRatio,h.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ho{constructor(n,s,l=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const p in n.paint._values){if(!l(p))continue;const _=n.paint.get(p);if(!(_ instanceof ii&&Bl(_.property.specification)))continue;const v=T_(p,n.type),w=_.value,C=_.property.specification.type,S=_.property.useIntegerZoom,I=_.property.specification["property-type"],A="cross-faded"===I||"cross-faded-data-driven"===I,O="line-dasharray"===String(p)&&"constant"!==n.layout.get("line-cap").value.kind;if("constant"!==w.kind||O)if("source"===w.kind||O||A){const N=Ep(p,C,"source");this.binders[p]=A?new $l(w,v,C,S,s,N,n.id):new is(w,v,C,N),h.push(`/a_${p}`)}else{const N=Ep(p,C,"composite");this.binders[p]=new qi(w,v,C,S,s,N),h.push(`/z_${p}`)}else this.binders[p]=A?new Gl(w.value,v):new Wu(w.value,v,C),h.push(`/u_${p}`)}this.cacheKey=h.sort().join("")}getMaxValue(n){const s=this.binders[n];return s instanceof is||s instanceof qi?s.maxValue:0}populatePaintArrays(n,s,l,h,p,_){for(const v in this.binders){const w=this.binders[v];(w instanceof is||w instanceof qi||w instanceof $l)&&w.populatePaintArray(n,s,l,h,p,_)}}setConstantPatternPositions(n,s){for(const l in this.binders){const h=this.binders[l];h instanceof Gl&&h.setConstantPatternPositions(n,s)}}updatePaintArrays(n,s,l,h,p,_){let v=!1;for(const w in n){const C=s.getPositions(w);for(const S of C){const I=l.feature(S.index);for(const A in this.binders){const O=this.binders[A];if((O instanceof is||O instanceof qi||O instanceof $l)&&!0===O.expression.isStateDependent){const N=h.paint.get(A);O.expression=N.value,O.updatePaintArray(S.start,S.end,I,n[w],p,_),v=!0}}}}return v}defines(){const n=[];for(const s in this.binders){const l=this.binders[s];(l instanceof Wu||l instanceof Gl)&&n.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return n}getBinderAttributes(){const n=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof is||l instanceof qi||l instanceof $l)for(let h=0;h<l.paintVertexAttributes.length;h++)n.push(l.paintVertexAttributes[h].name)}return n}getBinderUniforms(){const n=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof Wu||l instanceof Gl||l instanceof qi)for(const h of l.uniformNames)n.push(h)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,s){const l=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof Wu||p instanceof Gl||p instanceof qi)for(const _ of p.uniformNames)if(s[_]){const v=p.getBinding(n,s[_],_);l.push({name:_,property:h,binding:v})}}return l}setUniforms(n,s,l,h){for(const{name:p,property:_,binding:v}of s)this.binders[_].setUniform(v,h,l.get(_),p)}updatePaintBuffers(n){this._buffers=[];for(const s in this.binders){const l=this.binders[s];if(n&&l instanceof $l){const h=2===n.fromScale?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(l instanceof is||l instanceof qi)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(n){for(const s in this.binders){const l=this.binders[s];(l instanceof is||l instanceof qi||l instanceof $l)&&l.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const s=this.binders[n];(s instanceof is||s instanceof qi||s instanceof $l)&&s.destroy()}}}class va{constructor(n,s,l=(()=>!0)){this.programConfigurations={};for(const h of n)this.programConfigurations[h.id]=new ho(h,s,l);this.needsUpload=!1,this._featureMap=new xp,this._bufferOffset=0}populatePaintArrays(n,s,l,h,p,_,v){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(n,s,h,p,_,v);void 0!==s.id&&this._featureMap.add(s.id,l,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,s,l,h,p){for(const _ of l)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(n,this._featureMap,s,_,h,p)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const ed={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function T_(i,n){return ed[i]||[i.replace(`${n}-`,"").replace(/-/g,"_")]}const M_={"line-pattern":{source:ga,composite:ga},"fill-pattern":{source:ga,composite:ga},"fill-extrusion-pattern":{source:ga,composite:ga},"line-dasharray":{source:Gu,composite:Gu}},S_={color:{source:vp,composite:om},number:{source:_a,composite:vp}};function Ep(i,n,s){const l=M_[i];return l&&l[s]||S_[n][s]}Xe("ConstantBinder",Wu),Xe("CrossFadedConstantBinder",Gl),Xe("SourceExpressionBinder",is),Xe("CrossFadedCompositeBinder",$l),Xe("CompositeExpressionBinder",qi),Xe("ProgramConfiguration",ho,{omit:["_buffers"]}),Xe("ProgramConfigurationSet",va);const td="-transition";class Li extends xs{constructor(n,s){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==n.type&&(this.metadata=(n=n).metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,"background"!==n.type&&"sky"!==n.type&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),s.layout&&(this._unevaluatedLayout=new el(s.layout)),s.paint)){this._transitionablePaint=new ri(s.paint);for(const l in n.paint)this.setPaintProperty(l,n.paint[l],{validate:!1});for(const l in n.layout)this.setLayoutProperty(l,n.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fa(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return"visibility"===n?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,s,l={}){null!=s&&this._validate(Uu,`layers.${this.id}.layout.${n}`,n,s,l)||("visibility"!==n?this._unevaluatedLayout.setValue(n,s):this.visibility=s)}getPaintProperty(n){return Sl(n,td)?this._transitionablePaint.getTransition(n.slice(0,-td.length)):this._transitionablePaint.getValue(n)}setPaintProperty(n,s,l={}){if(null!=s&&this._validate(Gi,`layers.${this.id}.paint.${n}`,n,s,l))return!1;if(Sl(n,td))return this._transitionablePaint.setTransition(n.slice(0,-td.length),s||void 0),!1;{const h=this._transitionablePaint._values[n],p="cross-faded-data-driven"===h.property.specification["property-type"],_=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(n,s),this._handleSpecialPaintPropertyUpdate(n);const w=this._transitionablePaint._values[n].value;return w.isDataDriven()||_||p||this._handleOverridablePaintPropertyUpdate(n,v,w)}}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getProgramConfiguration(n){return null}_handleOverridablePaintPropertyUpdate(n,s,l){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||"none"===this.visibility}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,s){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,s)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Hs(n,(s,l)=>!(void 0===s||"layout"===l&&!Object.keys(s).length||"paint"===l&&!Object.keys(s).length))}_validate(n,s,l,h,p={}){return(!p||!1!==p.validate)&&Oc(this,n.call(zn,{key:s,layerType:this.type,objectKey:l,value:h,styleSpec:Ee,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const s=this.paint.get(n);if(s instanceof ii&&Bl(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Lu(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const um=Rn([{name:"a_pos",components:2,type:"Int16"}],4),{members:I_}=um;class dt{constructor(n=[]){this.segments=n}prepareSegment(n,s,l,h){let p=this.segments[this.segments.length-1];return n>dt.MAX_VERTEX_ARRAY_LENGTH&&An(`Max vertices per segment is ${dt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!p||p.vertexLength+n>dt.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},void 0!==h&&(p.sortKey=h),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const n of this.segments)for(const s in n.vaos)n.vaos[s].destroy()}static simpleSegment(n,s,l,h){return new dt([{vertexOffset:n,primitiveOffset:s,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}dt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xe("SegmentVector",dt);var Rt=8192;class Hl{constructor(n,s){n&&(s?this.setSouthWest(n).setNorthEast(s):4===n.length?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))}setNorthEast(n){return this._ne=n instanceof nn?new nn(n.lng,n.lat):nn.convert(n),this}setSouthWest(n){return this._sw=n instanceof nn?new nn(n.lng,n.lat):nn.convert(n),this}extend(n){const s=this._sw,l=this._ne;let h,p;if(n instanceof nn)h=n,p=n;else{if(!(n instanceof Hl))return Array.isArray(n)?4===n.length||n.every(Array.isArray)?this.extend(Hl.convert(n)):this.extend(nn.convert(n)):this;if(h=n._sw,p=n._ne,!h||!p)return this}return s||l?(s.lng=Math.min(h.lng,s.lng),s.lat=Math.min(h.lat,s.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new nn(h.lng,h.lat),this._ne=new nn(p.lng,p.lat)),this}getCenter(){return new nn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new nn(this.getWest(),this.getNorth())}getSouthEast(){return new nn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:s,lat:l}=nn.convert(n);let h=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(n){return!n||n instanceof Hl?n:new Hl(n)}}const nd=6371008.8;class nn{constructor(n,s){if(isNaN(n)||isNaN(s))throw new Error(`Invalid LngLat object: (${n}, ${s})`);if(this.lng=+n,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new nn(gs(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const s=Math.PI/180,l=this.lat*s,h=n.lat*s,p=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((n.lng-this.lng)*s);return nd*Math.acos(Math.min(p,1))}toBounds(n=0){const s=360*n/40075017,l=s/Math.cos(Math.PI/180*this.lat);return new Hl(new nn(this.lng-l,this.lat-s),new nn(this.lng+l,this.lat+s))}static convert(n){if(n instanceof nn)return n;if(Array.isArray(n)&&(2===n.length||3===n.length))return new nn(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&"object"==typeof n&&null!==n)return new nn(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const hm=2*Math.PI*nd;function dm(i){return hm*Math.cos(i*Math.PI/180)}function Hc(i){return(180+i)/360}function il(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Zi(i,n){return i/dm(n)}function As(i){return 360*i-180}function Oi(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function pm(i,n){return i*dm(Oi(n))}const os=85.051129;class qc{constructor(n,s,l=0){this.x=+n,this.y=+s,this.z=+l}static fromLngLat(n,s=0){const l=nn.convert(n);return new qc(Hc(l.lng),il(l.lat),Zi(s,l.lat))}toLngLat(){return new nn(As(this.x),Oi(this.y))}toAltitude(){return pm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/hm*(n=Oi(this.y),1/Math.cos(n*Math.PI/180));var n}}function Zc(i,n,s,l,h,p,_,v,w){const C=(n+l)/2,S=(s+h)/2,I=new Ke(C,S);v(I),function(A,O,N,U,q,J){const ie=N-q,ce=U-J;return Math.abs((U-O)*ie-(N-A)*ce)/Math.hypot(ie,ce)}(I.x,I.y,p.x,p.y,_.x,_.y)>=w?(Zc(i,n,s,C,S,p,I,v,w),Zc(i,C,S,l,h,I,_,v,w)):i.push(_)}function fm(i,n,s){const l=[];let h,p,_;for(const v of i){const{x:w,y:C}=v;n(v),_?Zc(l,h,p,w,C,_,v,n,s):l.push(v),h=w,p=C,_=v}return l}const Cp=Math.pow(2,14)-1,mm=-Cp-1;function Wc(i,n){const s=Math.round(i.x*n),l=Math.round(i.y*n);return i.x=cn(s,mm,Cp),i.y=cn(l,mm,Cp),(s<i.x||s>i.x+1||l<i.y||l>i.y+1)&&An("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function po(i,n,s){const l=i.loadGeometry(),h=i.extent,p=Rt/h;if(n&&s&&s.projection.isReprojectedInTileSpace){const _=1<<n.z,{scale:v,x:w,y:C,projection:S}=s,I=A=>{const O=As((n.x+A.x/h)/_),N=Oi((n.y+A.y/h)/_),U=S.project(O,N);A.x=(U.x*v-w)*h,A.y=(U.y*v-C)*h};for(let A=0;A<l.length;A++)if(1!==i.type)l[A]=fm(l[A],I,1);else{const O=[];for(const N of l[A])N.x<0||N.x>=h||N.y<0||N.y>=h||(I(N),O.push(N));l[A]=O}}for(const _ of l)for(const v of _)Wc(v,p);return l}function ql(i,n){return{type:i.type,id:i.id,properties:i.properties,geometry:n?po(i):[]}}function Dp(i,n,s,l,h){i.emplaceBack(2*n+(l+1)/2,2*s+(h+1)/2)}class rd{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Nc,this.indexArray=new Ur,this.segments=new dt,this.programConfigurations=new va(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(n,s,l,h){const p=this.layers[0],_=[];let v=null;"circle"===p.type&&(v=p.layout.get("circle-sort-key"));for(const{feature:w,id:C,index:S,sourceLayerIndex:I}of n){const A=this.layers[0]._featureFilter.needGeometry,O=ql(w,A);if(!this.layers[0]._featureFilter.filter(new ft(this.zoom),O,l))continue;const N=v?v.evaluate(O,{},l):void 0,U={id:C,properties:w.properties,type:w.type,sourceLayerIndex:I,index:S,geometry:A?O.geometry:po(w,l,h),patterns:{},sortKey:N};_.push(U)}v&&_.sort((w,C)=>w.sortKey-C.sortKey);for(const w of _){const{geometry:C,index:S,sourceLayerIndex:I}=w,A=n[S].feature;this.addFeature(w,C,S,s.availableImages,l),s.featureIndex.insert(A,C,S,I,this.index)}}update(n,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,I_),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,s,l,h,p){for(const _ of s)for(const v of _){const w=v.x,C=v.y;if(w<0||w>=Rt||C<0||C>=Rt)continue;const S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),I=S.vertexLength;Dp(this.layoutVertexArray,w,C,-1,-1),Dp(this.layoutVertexArray,w,C,1,-1),Dp(this.layoutVertexArray,w,C,1,1),Dp(this.layoutVertexArray,w,C,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,{},h,p)}}function gm(i,n){for(let s=0;s<i.length;s++)if(Xc(n,i[s]))return!0;for(let s=0;s<n.length;s++)if(Xc(i,n[s]))return!0;return!!Tp(i,n)}function bx(i,n,s){return!!Xc(i,n)||!!Xu(n,i,s)}function _m(i,n){if(1===i.length)return ym(n,i[0]);for(let s=0;s<n.length;s++){const l=n[s];for(let h=0;h<l.length;h++)if(Xc(i,l[h]))return!0}for(let s=0;s<i.length;s++)if(ym(n,i[s]))return!0;for(let s=0;s<n.length;s++)if(Tp(i,n[s]))return!0;return!1}function A_(i,n,s){if(i.length>1){if(Tp(i,n))return!0;for(let l=0;l<n.length;l++)if(Xu(n[l],i,s))return!0}for(let l=0;l<i.length;l++)if(Xu(i[l],n,s))return!0;return!1}function Tp(i,n){if(0===i.length||0===n.length)return!1;for(let s=0;s<i.length-1;s++){const l=i[s],h=i[s+1];for(let p=0;p<n.length-1;p++)if(id(l,h,n[p],n[p+1]))return!0}return!1}function id(i,n,s,l){return Ii(i,s,l)!==Ii(n,s,l)&&Ii(i,n,s)!==Ii(i,n,l)}function Xu(i,n,s){const l=s*s;if(1===n.length)return i.distSqr(n[0])<l;for(let h=1;h<n.length;h++)if(Zl(i,n[h-1],n[h])<l)return!0;return!1}function Zl(i,n,s){const l=n.distSqr(s);if(0===l)return i.distSqr(n);const h=((i.x-n.x)*(s.x-n.x)+(i.y-n.y)*(s.y-n.y))/l;return i.distSqr(h<0?n:h>1?s:s.sub(n)._mult(h)._add(n))}function ym(i,n){let s,l,h,p=!1;for(let _=0;_<i.length;_++){s=i[_];for(let v=0,w=s.length-1;v<s.length;w=v++)l=s[v],h=s[w],l.y>n.y!=h.y>n.y&&n.x<(h.x-l.x)*(n.y-l.y)/(h.y-l.y)+l.x&&(p=!p)}return p}function Xc(i,n){let s=!1;for(let l=0,h=i.length-1;l<i.length;h=l++){const p=i[l],_=i[h];p.y>n.y!=_.y>n.y&&n.x<(_.x-p.x)*(n.y-p.y)/(_.y-p.y)+p.x&&(s=!s)}return s}function P_(i,n,s,l,h){for(const _ of i)if(n<=_.x&&s<=_.y&&l>=_.x&&h>=_.y)return!0;const p=[new Ke(n,s),new Ke(n,h),new Ke(l,h),new Ke(l,s)];if(i.length>2)for(const _ of p)if(Xc(i,_))return!0;for(let _=0;_<i.length-1;_++)if(od(i[_],i[_+1],p))return!0;return!1}function od(i,n,s){const l=s[0],h=s[2];if(i.x<l.x&&n.x<l.x||i.x>h.x&&n.x>h.x||i.y<l.y&&n.y<l.y||i.y>h.y&&n.y>h.y)return!1;const p=Ii(i,n,s[0]);return p!==Ii(i,n,s[1])||p!==Ii(i,n,s[2])||p!==Ii(i,n,s[3])}function ol(i,n,s){const l=n.paint.get(i).value;return"constant"===l.kind?l.value:s.programConfigurations.get(n.id).getMaxValue(i)}function Ku(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Mp(i,n,s,l,h){if(!n[0]&&!n[1])return i;const p=Ke.convert(n)._mult(h);"viewport"===s&&p._rotate(-l);const _=[];for(let v=0;v<i.length;v++)_.push(i[v].sub(p));return _}function Sp(i,n,s,l){const h=Ke.convert(i)._mult(l);return"viewport"===n&&h._rotate(-s),h}Xe("CircleBucket",rd,{omit:["layers"]});const vm=new sr({"circle-sort-key":new at(Ee.layout_circle["circle-sort-key"])});var k_={paint:new sr({"circle-radius":new at(Ee.paint_circle["circle-radius"]),"circle-color":new at(Ee.paint_circle["circle-color"]),"circle-blur":new at(Ee.paint_circle["circle-blur"]),"circle-opacity":new at(Ee.paint_circle["circle-opacity"]),"circle-translate":new nt(Ee.paint_circle["circle-translate"]),"circle-translate-anchor":new nt(Ee.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new nt(Ee.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new nt(Ee.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new at(Ee.paint_circle["circle-stroke-width"]),"circle-stroke-color":new at(Ee.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new at(Ee.paint_circle["circle-stroke-opacity"])}),layout:vm};class Ip{constructor(n,s){this.points=n,this.planes=s}static fromInvProjectionMatrix(n,s,l,h){const p=Math.pow(2,l),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const C=zr([],w,n),S=1/C[3]/s*p;return(I=C)[0]=(A=C)[0]*(O=[S,S,h?1/C[3]:S,S])[0],I[1]=A[1]*O[1],I[2]=A[2]*O[2],I[3]=A[3]*O[3],I;var I,A,O}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const C=Ns([],Ra([],js([],_[w[0]],_[w[1]]),js([],_[w[2]],_[w[1]]))),S=-xo(C,_[w[1]]);return C.concat(S)});return new Ip(_,v)}}class ss{constructor(n,s){this.min=n,this.max=s,this.center=no([],El([],this.min,this.max),.5)}quadrant(n){const s=[n%2==0,n<2],l=$o(this.min),h=$o(this.max);for(let p=0;p<s.length;p++)l[p]=s[p]?this.min[p]:this.center[p],h[p]=s[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new ss(l,h)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,s=this.max;return[[n[0],n[1],n[2]],[s[0],n[1],n[2]],[s[0],s[1],n[2]],[n[0],s[1],n[2]],[n[0],n[1],s[2]],[s[0],n[1],s[2]],[s[0],s[1],s[2]],[n[0],s[1],s[2]]]}intersects(n){const s=this.getCorners();let l=!0;for(let h=0;h<n.planes.length;h++){const p=n.planes[h];let _=0;for(let v=0;v<s.length;v++)_+=xo(p,s[v])+p[3]>=0;if(0===_)return 0;_!==s.length&&(l=!1)}if(l)return 2;for(let h=0;h<3;h++){let p=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let v=0;v<n.points.length;v++){const w=n.points[v][h]-this.min[h];p=Math.min(p,w),_=Math.max(_,w)}if(_<0||p>this.max[h]-this.min[h])return 0}return 1}}function xm(i,n,s,l,h,p,_,v,w){if(p&&i.queryGeometry.isAboveHorizon)return!1;p&&(w*=i.pixelToTileUnitsFactor);for(const C of n)for(const S of C){const I=S.add(v),A=h&&s.elevation?s.elevation.exaggeration()*h.getElevationAt(I.x,I.y,!0):0,O=p?I:F_(I,A,l),N=p?i.tilespaceRays.map(q=>R_(q,A)):i.queryGeometry.screenGeometry,U=zr([],[S.x,S.y,A,1],l);if(!_&&p?w*=U[3]/s.cameraToCenterDistance:_&&!p&&(w*=s.cameraToCenterDistance/U[3]),bx(N,O,w))return!0}return!1}function F_(i,n,s){const l=zr([],[i.x,i.y,n,1],s);return new Ke(l[0]/l[3],l[1]/l[3])}const xa=to(0,0,0),Ju=to(0,0,1);function R_(i,n){const s=Bs();return xa[2]=n,i.intersectsPlane(xa,Ju,s),new Ke(s[0],s[1])}class L_ extends rd{}function bm(i,{width:n,height:s},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==n*s*l)throw new RangeError("mismatched image size")}else h=new Uint8Array(n*s*l);return i.width=n,i.height=s,i.data=h,i}function O_(i,{width:n,height:s},l){if(n===i.width&&s===i.height)return;const h=bm({},{width:n,height:s},l);wm(i,h,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,n),height:Math.min(i.height,s)},l),i.width=n,i.height=s,i.data=h.data}function wm(i,n,s,l,h,p){if(0===h.width||0===h.height)return n;if(h.width>i.width||h.height>i.height||s.x>i.width-h.width||s.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>n.width||h.height>n.height||l.x>n.width-h.width||l.y>n.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,v=n.data;for(let w=0;w<h.height;w++){const C=((s.y+w)*i.width+s.x)*p,S=((l.y+w)*n.width+l.x)*p;for(let I=0;I<h.width*p;I++)v[S+I]=_[C+I]}return n}Xe("HeatmapBucket",L_,{omit:["layers"]});class Wl{constructor(n,s){bm(this,n,1,s)}resize(n){O_(this,n,1)}clone(){return new Wl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,l,h,p){wm(n,s,l,h,p,1)}}class Wi{constructor(n,s){bm(this,n,4,s)}resize(n){O_(this,n,4)}replace(n,s){s?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Wi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,l,h,p){wm(n,s,l,h,p,4)}}Xe("AlphaImage",Wl),Xe("RGBAImage",Wi);var z_={paint:new sr({"heatmap-radius":new at(Ee.paint_heatmap["heatmap-radius"]),"heatmap-weight":new at(Ee.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new nt(Ee.paint_heatmap["heatmap-intensity"]),"heatmap-color":new co(Ee.paint_heatmap["heatmap-color"]),"heatmap-opacity":new nt(Ee.paint_heatmap["heatmap-opacity"])})};function Ap(i){const n={},s=i.resolution||256,l=i.clips?i.clips.length:1,h=i.image||new Wi({width:s,height:l}),p=(_,v,w)=>{n[i.evaluationKey]=w;const C=i.expression.evaluate(n);h.data[_+v+0]=Math.floor(255*C.r/C.a),h.data[_+v+1]=Math.floor(255*C.g/C.a),h.data[_+v+2]=Math.floor(255*C.b/C.a),h.data[_+v+3]=Math.floor(255*C.a)};if(i.clips)for(let _=0,v=0;_<l;++_,v+=4*s)for(let w=0,C=0;w<s;w++,C+=4){const S=w/(s-1),{start:I,end:A}=i.clips[_];p(v,C,I*(1-S)+A*S)}else for(let _=0,v=0;_<s;_++,v+=4)p(0,v,_/(s-1));return h}var B_={paint:new sr({"hillshade-illumination-direction":new nt(Ee.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new nt(Ee.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new nt(Ee.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new nt(Ee.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new nt(Ee.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new nt(Ee.paint_hillshade["hillshade-accent-color"])})};const N_=Rn([{name:"a_pos",components:2,type:"Int16"}],4),{members:wx}=N_;var sd=Yu,ad=Yu;function Yu(i,n,s){s=s||2;var l,h,p,_,v,w,C,S=n&&n.length,I=S?n[0]*s:i.length,A=as(i,0,I,s,!0),O=[];if(!A||A.next===A.prev)return O;if(S&&(A=function(U,q,J,ie){var ce,he,pe,de=[];for(ce=0,he=q.length;ce<he;ce++)(pe=as(U,q[ce]*ie,ce<he-1?q[ce+1]*ie:U.length,ie,!1))===pe.next&&(pe.steiner=!0),de.push(Tx(pe));for(de.sort(Dx),ce=0;ce<de.length;ce++)J=ko(J=Pp(de[ce],J),J.next);return J}(i,n,A,s)),i.length>80*s){l=p=i[0],h=_=i[1];for(var N=s;N<I;N+=s)(v=i[N])<l&&(l=v),(w=i[N+1])<h&&(h=w),v>p&&(p=v),w>_&&(_=w);C=0!==(C=Math.max(p-l,_-h))?1/C:0}return Kc(A,O,s,l,h,C),O}function as(i,n,s,l,h){var p,_;if(h===Fp(i,n,s,l)>0)for(p=n;p<s;p+=l)_=ud(p,i[p],i[p+1],_);else for(p=s-l;p>=n;p-=l)_=ud(p,i[p],i[p+1],_);return _&&ld(_,_.next)&&(nh(_),_=_.next),_}function ko(i,n){if(!i)return i;n||(n=i);var s,l=i;do{if(s=!1,l.steiner||!ld(l,l.next)&&0!==Yn(l.prev,l,l.next))l=l.next;else{if(nh(l),(l=n=l.prev)===l.next)break;s=!0}}while(s||l!==n);return n}function Kc(i,n,s,l,h,p,_){if(i){!_&&p&&function(S,I,A,O){var N=S;do{null===N.z&&(N.z=Qu(N.x,N.y,I,A,O)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next}while(N!==S);N.prevZ.nextZ=null,N.prevZ=null,function(U){var q,J,ie,ce,he,pe,de,Ce,we=1;do{for(J=U,U=null,he=null,pe=0;J;){for(pe++,ie=J,de=0,q=0;q<we&&(de++,ie=ie.nextZ);q++);for(Ce=we;de>0||Ce>0&&ie;)0!==de&&(0===Ce||!ie||J.z<=ie.z)?(ce=J,J=J.nextZ,de--):(ce=ie,ie=ie.nextZ,Ce--),he?he.nextZ=ce:U=ce,ce.prevZ=he,he=ce;J=ie}he.nextZ=null,we*=2}while(pe>1)}(N)}(i,l,h,p);for(var v,w,C=i;i.prev!==i.next;)if(v=i.prev,w=i.next,p?Cm(i,l,h,p):Em(i))n.push(v.i/s),n.push(i.i/s),n.push(w.i/s),nh(i),i=w.next,C=w.next;else if((i=w)===C){_?1===_?Kc(i=Ex(ko(i),n,s),n,s,l,h,p,2):2===_&&Cx(i,n,s,l,h,p):Kc(ko(i),n,s,l,h,p,1);break}}}function Em(i){var n=i.prev,s=i,l=i.next;if(Yn(n,s,l)>=0)return!1;for(var h=i.next.next;h!==i.prev;){if(eh(n.x,n.y,s.x,s.y,l.x,l.y,h.x,h.y)&&Yn(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function Cm(i,n,s,l){var h=i.prev,p=i,_=i.next;if(Yn(h,p,_)>=0)return!1;for(var v=h.x>p.x?h.x>_.x?h.x:_.x:p.x>_.x?p.x:_.x,w=h.y>p.y?h.y>_.y?h.y:_.y:p.y>_.y?p.y:_.y,C=Qu(h.x<p.x?h.x<_.x?h.x:_.x:p.x<_.x?p.x:_.x,h.y<p.y?h.y<_.y?h.y:_.y:p.y<_.y?p.y:_.y,n,s,l),S=Qu(v,w,n,s,l),I=i.prevZ,A=i.nextZ;I&&I.z>=C&&A&&A.z<=S;){if(I!==i.prev&&I!==i.next&&eh(h.x,h.y,p.x,p.y,_.x,_.y,I.x,I.y)&&Yn(I.prev,I,I.next)>=0||(I=I.prevZ,A!==i.prev&&A!==i.next&&eh(h.x,h.y,p.x,p.y,_.x,_.y,A.x,A.y)&&Yn(A.prev,A,A.next)>=0))return!1;A=A.nextZ}for(;I&&I.z>=C;){if(I!==i.prev&&I!==i.next&&eh(h.x,h.y,p.x,p.y,_.x,_.y,I.x,I.y)&&Yn(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;A&&A.z<=S;){if(A!==i.prev&&A!==i.next&&eh(h.x,h.y,p.x,p.y,_.x,_.y,A.x,A.y)&&Yn(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function Ex(i,n,s){var l=i;do{var h=l.prev,p=l.next.next;!ld(h,p)&&Tm(h,l,l.next,p)&&sl(h,p)&&sl(p,h)&&(n.push(h.i/s),n.push(l.i/s),n.push(p.i/s),nh(l),nh(l.next),l=i=p),l=l.next}while(l!==i);return ko(l)}function Cx(i,n,s,l,h,p){var _=i;do{for(var v=_.next.next;v!==_.prev;){if(_.i!==v.i&&Dm(_,v)){var w=Mm(_,v);return _=ko(_,_.next),w=ko(w,w.next),Kc(_,n,s,l,h,p),void Kc(w,n,s,l,h,p)}v=v.next}_=_.next}while(_!==i)}function Dx(i,n){return i.x-n.x}function Pp(i,n){var s=function(p,_){var v,w=_,C=p.x,S=p.y,I=-1/0;do{if(S<=w.y&&S>=w.next.y&&w.next.y!==w.y){var A=w.x+(S-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(A<=C&&A>I){if(I=A,A===C){if(S===w.y)return w;if(S===w.next.y)return w.next}v=w.x<w.next.x?w:w.next}}w=w.next}while(w!==_);if(!v)return null;if(C===I)return v;var O,N=v,U=v.x,q=v.y,J=1/0;w=v;do{C>=w.x&&w.x>=U&&C!==w.x&&eh(S<q?C:I,S,U,q,S<q?I:C,S,w.x,w.y)&&(O=Math.abs(S-w.y)/(C-w.x),sl(w,p)&&(O<J||O===J&&(w.x>v.x||w.x===v.x&&kp(v,w)))&&(v=w,J=O)),w=w.next}while(w!==N);return v}(i,n);if(!s)return n;var l=Mm(s,i),h=ko(s,s.next);return ko(l,l.next),n===s?h:n}function kp(i,n){return Yn(i.prev,i,n.prev)<0&&Yn(n.next,i,i.next)<0}function Qu(i,n,s,l,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-s)*h)|i<<8))|i<<4))|i<<2))|i<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-l)*h)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function Tx(i){var n=i,s=i;do{(n.x<s.x||n.x===s.x&&n.y<s.y)&&(s=n),n=n.next}while(n!==i);return s}function eh(i,n,s,l,h,p,_,v){return(h-_)*(n-v)-(i-_)*(p-v)>=0&&(i-_)*(l-v)-(s-_)*(n-v)>=0&&(s-_)*(p-v)-(h-_)*(l-v)>=0}function Dm(i,n){return i.next.i!==n.i&&i.prev.i!==n.i&&!function(s,l){var h=s;do{if(h.i!==s.i&&h.next.i!==s.i&&h.i!==l.i&&h.next.i!==l.i&&Tm(h,h.next,s,l))return!0;h=h.next}while(h!==s);return!1}(i,n)&&(sl(i,n)&&sl(n,i)&&function(s,l){var h=s,p=!1,_=(s.x+l.x)/2,v=(s.y+l.y)/2;do{h.y>v!=h.next.y>v&&h.next.y!==h.y&&_<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next}while(h!==s);return p}(i,n)&&(Yn(i.prev,i,n.prev)||Yn(i,n.prev,n))||ld(i,n)&&Yn(i.prev,i,i.next)>0&&Yn(n.prev,n,n.next)>0)}function Yn(i,n,s){return(n.y-i.y)*(s.x-n.x)-(n.x-i.x)*(s.y-n.y)}function ld(i,n){return i.x===n.x&&i.y===n.y}function Tm(i,n,s,l){var h=th(Yn(i,n,s)),p=th(Yn(i,n,l)),_=th(Yn(s,l,i)),v=th(Yn(s,l,n));return h!==p&&_!==v||!(0!==h||!cd(i,s,n))||!(0!==p||!cd(i,l,n))||!(0!==_||!cd(s,i,l))||!(0!==v||!cd(s,n,l))}function cd(i,n,s){return n.x<=Math.max(i.x,s.x)&&n.x>=Math.min(i.x,s.x)&&n.y<=Math.max(i.y,s.y)&&n.y>=Math.min(i.y,s.y)}function th(i){return i>0?1:i<0?-1:0}function sl(i,n){return Yn(i.prev,i,i.next)<0?Yn(i,n,i.next)>=0&&Yn(i,i.prev,n)>=0:Yn(i,n,i.prev)<0||Yn(i,i.next,n)<0}function Mm(i,n){var s=new ar(i.i,i.x,i.y),l=new ar(n.i,n.x,n.y),h=i.next,p=n.prev;return i.next=n,n.prev=i,s.next=h,h.prev=s,l.next=s,s.prev=l,p.next=l,l.prev=p,l}function ud(i,n,s,l){var h=new ar(i,n,s);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function nh(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function ar(i,n,s){this.i=i,this.x=n,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Fp(i,n,s,l){for(var h=0,p=n,_=s-l;p<s;p+=l)h+=(i[_]-i[p])*(i[p+1]+i[_+1]),_=p;return h}function V_(i,n,s,l,h){Rp(i,n,s||0,l||i.length-1,h||j_)}function Rp(i,n,s,l,h){for(;l>s;){if(l-s>600){var p=l-s+1,_=n-s+1,v=Math.log(p),w=.5*Math.exp(2*v/3),C=.5*Math.sqrt(v*w*(p-w)/p)*(_-p/2<0?-1:1);Rp(i,n,Math.max(s,Math.floor(n-_*w/p+C)),Math.min(l,Math.floor(n+(p-_)*w/p+C)),h)}var S=i[n],I=s,A=l;for(Jc(i,s,n),h(i[l],S)>0&&Jc(i,s,l);I<A;){for(Jc(i,I,A),I++,A--;h(i[I],S)<0;)I++;for(;h(i[A],S)>0;)A--}0===h(i[s],S)?Jc(i,s,A):Jc(i,++A,l),A<=n&&(s=A+1),n<=A&&(l=A-1)}}function Jc(i,n,s){var l=i[n];i[n]=i[s],i[s]=l}function j_(i,n){return i<n?-1:i>n?1:0}function Lp(i,n){const s=i.length;if(s<=1)return[i];const l=[];let h,p;for(let _=0;_<s;_++){const v=Na(i[_]);0!==v&&(i[_].area=Math.abs(v),void 0===p&&(p=v<0),p===v<0?(h&&l.push(h),h=[i[_]]):h.push(i[_]))}if(h&&l.push(h),n>1)for(let _=0;_<l.length;_++)l[_].length<=n||(V_(l[_],n,1,l[_].length-1,U_),l[_]=l[_].slice(0,n));return l}function U_(i,n){return n.area-i.area}function Op(i,n,s){const l=s.patternDependencies;let h=!1;for(const p of n){const _=p.paint.get(`${i}-pattern`);_.isConstant()||(h=!0);const v=_.constantOr(null);v&&(h=!0,l[v.to]=!0,l[v.from]=!0)}return h}function zp(i,n,s,l,h){const p=h.patternDependencies;for(const _ of n){const v=_.paint.get(`${i}-pattern`).value;if("constant"!==v.kind){let w=v.evaluate({zoom:l-1},s,{},h.availableImages),C=v.evaluate({zoom:l},s,{},h.availableImages),S=v.evaluate({zoom:l+1},s,{},h.availableImages);w=w&&w.name?w.name:w,C=C&&C.name?C.name:C,S=S&&S.name?S.name:S,p[w]=!0,p[C]=!0,p[S]=!0,s.patterns[_.id]={min:w,mid:C,max:S}}}return s}Yu.deviation=function(i,n,s,l){var h=n&&n.length,p=Math.abs(Fp(i,0,h?n[0]*s:i.length,s));if(h)for(var _=0,v=n.length;_<v;_++)p-=Math.abs(Fp(i,n[_]*s,_<v-1?n[_+1]*s:i.length,s));var w=0;for(_=0;_<l.length;_+=3){var C=l[_]*s,S=l[_+1]*s,I=l[_+2]*s;w+=Math.abs((i[C]-i[I])*(i[S+1]-i[C+1])-(i[C]-i[S])*(i[I+1]-i[C+1]))}return 0===p&&0===w?0:Math.abs((w-p)/p)},Yu.flatten=function(i){for(var n=i[0][0].length,s={vertices:[],holes:[],dimensions:n},l=0,h=0;h<i.length;h++){for(var p=0;p<i[h].length;p++)for(var _=0;_<n;_++)s.vertices.push(i[h][p][_]);h>0&&s.holes.push(l+=i[h-1].length)}return s},sd.default=ad;class Bp{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Nc,this.indexArray=new Ur,this.indexArray2=new Ul,this.programConfigurations=new va(n.layers,n.zoom),this.segments=new dt,this.segments2=new dt,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(n,s,l,h){this.hasPattern=Op("fill",this.layers,s);const p=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:v,id:w,index:C,sourceLayerIndex:S}of n){const I=this.layers[0]._featureFilter.needGeometry,A=ql(v,I);if(!this.layers[0]._featureFilter.filter(new ft(this.zoom),A,l))continue;const O=p?p.evaluate(A,{},l,s.availableImages):void 0,N={id:w,properties:v.properties,type:v.type,sourceLayerIndex:S,index:C,geometry:I?A.geometry:po(v,l,h),patterns:{},sortKey:O};_.push(N)}p&&_.sort((v,w)=>v.sortKey-w.sortKey);for(const v of _){const{geometry:w,index:C,sourceLayerIndex:S}=v;if(this.hasPattern){const I=zp("fill",this.layers,v,this.zoom,s);this.patternFeatures.push(I)}else this.addFeature(v,w,C,l,{},s.availableImages);s.featureIndex.insert(n[C].feature,w,C,S,this.index)}}update(n,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l,h)}addFeatures(n,s,l,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,wx),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,s,l,h,p,_=[]){for(const v of Lp(s,500)){let w=0;for(const N of v)w+=N.length;const C=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),S=C.vertexLength,I=[],A=[];for(const N of v){if(0===N.length)continue;N!==v[0]&&A.push(I.length/2);const U=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),q=U.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(q+N.length-1,q),I.push(N[0].x),I.push(N[0].y);for(let J=1;J<N.length;J++)this.layoutVertexArray.emplaceBack(N[J].x,N[J].y),this.indexArray2.emplaceBack(q+J-1,q+J),I.push(N[J].x),I.push(N[J].y);U.vertexLength+=N.length,U.primitiveLength+=N.length}const O=sd(I,A);for(let N=0;N<O.length;N+=3)this.indexArray.emplaceBack(S+O[N],S+O[N+1],S+O[N+2]);C.vertexLength+=w,C.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,p,_,h)}}Xe("FillBucket",Bp,{omit:["layers","patternFeatures"]});const Mx=new sr({"fill-sort-key":new at(Ee.layout_fill["fill-sort-key"])});var rh={paint:new sr({"fill-antialias":new nt(Ee.paint_fill["fill-antialias"]),"fill-opacity":new at(Ee.paint_fill["fill-opacity"]),"fill-color":new at(Ee.paint_fill["fill-color"]),"fill-outline-color":new at(Ee.paint_fill["fill-outline-color"]),"fill-translate":new nt(Ee.paint_fill["fill-translate"]),"fill-translate-anchor":new nt(Ee.paint_fill["fill-translate-anchor"]),"fill-pattern":new or(Ee.paint_fill["fill-pattern"])}),layout:Mx};const zi=Rn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Np=Rn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Sm}=zi;var Vp=gr;function gr(i,n,s,l,h){this.properties={},this.extent=s,this.type=0,this._pbf=i,this._geometry=-1,this._keys=l,this._values=h,i.readFields(ih,this,n)}function ih(i,n,s){1==i?n.id=s.readVarint():2==i?function(l,h){for(var p=l.readVarint()+l.pos;l.pos<p;){var _=h._keys[l.readVarint()],v=h._values[l.readVarint()];h.properties[_]=v}}(s,n):3==i?n.type=s.readVarint():4==i&&(n._geometry=s.pos)}function jp(i){for(var n,s,l=0,h=0,p=i.length,_=p-1;h<p;_=h++)l+=((s=i[_]).x-(n=i[h]).x)*(n.y+s.y);return l}gr.types=["Unknown","Point","LineString","Polygon"],gr.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var n,s=i.readVarint()+i.pos,l=1,h=0,p=0,_=0,v=[];i.pos<s;){if(h<=0){var w=i.readVarint();l=7&w,h=w>>3}if(h--,1===l||2===l)p+=i.readSVarint(),_+=i.readSVarint(),1===l&&(n&&v.push(n),n=[]),n.push(new Ke(p,_));else{if(7!==l)throw new Error("unknown command "+l);n&&n.push(n[0].clone())}}return n&&v.push(n),v},gr.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var n=i.readVarint()+i.pos,s=1,l=0,h=0,p=0,_=1/0,v=-1/0,w=1/0,C=-1/0;i.pos<n;){if(l<=0){var S=i.readVarint();s=7&S,l=S>>3}if(l--,1===s||2===s)(h+=i.readSVarint())<_&&(_=h),h>v&&(v=h),(p+=i.readSVarint())<w&&(w=p),p>C&&(C=p);else if(7!==s)throw new Error("unknown command "+s)}return[_,w,v,C]},gr.prototype.toGeoJSON=function(i,n,s){var l,h,p=this.extent*Math.pow(2,s),_=this.extent*i,v=this.extent*n,w=this.loadGeometry(),C=gr.types[this.type];function S(O){for(var N=0;N<O.length;N++){var U=O[N];O[N]=[360*(U.x+_)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+v)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(l=0;l<w.length;l++)I[l]=w[l][0];S(w=I);break;case 2:for(l=0;l<w.length;l++)S(w[l]);break;case 3:for(w=function(O){var N=O.length;if(N<=1)return[O];for(var U,q,J=[],ie=0;ie<N;ie++){var ce=jp(O[ie]);0!==ce&&(void 0===q&&(q=ce<0),q===ce<0?(U&&J.push(U),U=[O[ie]]):U.push(O[ie]))}return U&&J.push(U),J}(w),l=0;l<w.length;l++)for(h=0;h<w[l].length;h++)S(w[l][h])}1===w.length?w=w[0]:C="Multi"+C;var A={type:"Feature",geometry:{type:C,coordinates:w},properties:this.properties};return"id"in this&&(A.id=this.id),A};var Im=Am;function Am(i,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Pm,this,n),this.length=this._features.length}function Pm(i,n,s){15===i?n.version=s.readVarint():1===i?n.name=s.readString():5===i?n.extent=s.readVarint():2===i?n._features.push(s.pos):3===i?n._keys.push(s.readString()):4===i&&n._values.push(function(l){for(var h=null,p=l.readVarint()+l.pos;l.pos<p;){var _=l.readVarint()>>3;h=1===_?l.readString():2===_?l.readFloat():3===_?l.readDouble():4===_?l.readVarint64():5===_?l.readVarint():6===_?l.readSVarint():7===_?l.readBoolean():null}return h}(s))}function G_(i,n,s){if(3===i){var l=new Im(s,s.readVarint()+s.pos);l.length&&(n[l.name]=l)}}Am.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var n=this._pbf.readVarint()+this._pbf.pos;return new Vp(this._pbf,n,this.extent,this._keys,this._values)};var al={VectorTile:function(i,n){this.layers=i.readFields(G_,{},n)},VectorTileFeature:Vp,VectorTileLayer:Im};const $_=al.VectorTileFeature.types,km=Math.pow(2,13);function oh(i,n,s,l,h,p,_,v){i.emplaceBack((n<<1)+_,(s<<1)+p,(Math.floor(l*km)<<1)+h,Math.round(v))}class Fm{constructor(){this.acc=new Ke(0,0),this.polyCount=[]}startRing(n){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ke(n.x,n.y),this.max=new Ke(n.x,n.y))}append(n,s){this.currentPolyCount.edges++,this.acc._add(n);let l=!!this.borders;const h=this.min,p=this.max;n.x<h.x?(h.x=n.x,l=!0):n.x>p.x&&(p.x=n.x,l=!0),n.y<h.y?(h.y=n.y,l=!0):n.y>p.y&&(p.y=n.y,l=!0),((0===n.x||n.x===Rt)&&n.x===s.x)!=((0===n.y||n.y===Rt)&&n.y===s.y)&&this.processBorderOverlap(n,s),l&&this.checkBorderIntersection(n,s)}checkBorderIntersection(n,s){s.x<0!=n.x<0&&this.addBorderIntersection(0,zt(s.y,n.y,(0-s.x)/(n.x-s.x))),s.x>Rt!=n.x>Rt&&this.addBorderIntersection(1,zt(s.y,n.y,(Rt-s.x)/(n.x-s.x))),s.y<0!=n.y<0&&this.addBorderIntersection(2,zt(s.x,n.x,(0-s.y)/(n.y-s.y))),s.y>Rt!=n.y>Rt&&this.addBorderIntersection(3,zt(s.x,n.x,(Rt-s.y)/(n.y-s.y)))}addBorderIntersection(n,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[n];s<l[0]&&(l[0]=s),s>l[1]&&(l[1]=s)}processBorderOverlap(n,s){if(n.x===s.x){if(n.y===s.y)return;const l=0===n.x?0:1;this.addBorderIntersection(l,s.y),this.addBorderIntersection(l,n.y)}else{const l=0===n.y?2:3;this.addBorderIntersection(l,s.x),this.addBorderIntersection(l,n.x)}}centroid(){const n=this.polyCount.reduce((s,l)=>s+l.edges,0);return 0!==n?this.acc.div(n)._round():new Ke(0,0)}span(){return new Ke(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((n,s)=>n+ +(s[0]!==Number.MAX_VALUE),0)}}class sh{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new ma,this.centroidVertexArray=new ns,this.indexArray=new Ur,this.programConfigurations=new va(n.layers,n.zoom),this.segments=new dt,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=n.enableTerrain}populate(n,s,l,h){this.features=[],this.hasPattern=Op("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(p){const _=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*_/(_*_+1)/Rt/(1<<p.z)}(l);for(const{feature:p,id:_,index:v,sourceLayerIndex:w}of n){const C=this.layers[0]._featureFilter.needGeometry,S=ql(p,C);if(!this.layers[0]._featureFilter.filter(new ft(this.zoom),S,l))continue;const I={id:_,sourceLayerIndex:w,index:v,geometry:C?S.geometry:po(p,l,h),properties:p.properties,type:p.type,patterns:{}},A=this.layoutVertexArray.length;this.hasPattern?this.features.push(zp("fill-extrusion",this.layers,I,this.zoom,s)):this.addFeature(I,I.geometry,v,l,{},s.availableImages),s.featureIndex.insert(p,I.geometry,v,w,this.index,A)}this.sortBorders()}addFeatures(n,s,l,h){for(const p of this.features){const{geometry:_}=p;this.addFeature(p,_,p.index,s,l,h)}this.sortBorders()}update(n,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Sm),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,Np.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,s,l,h,p,_){const v=this.enableTerrain?new Fm:null;for(const C of Lp(s,500)){let S=0,I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===C.length||(w=C[0]).every(q=>q.x<=0)||w.every(q=>q.x>=Rt)||w.every(q=>q.y<=0)||w.every(q=>q.y>=Rt))continue;for(let q=0;q<C.length;q++){const J=C[q];if(0===J.length)continue;S+=J.length;let ie=0;v&&v.startRing(J[0]);for(let ce=0;ce<J.length;ce++){const he=J[ce];if(ce>=1){const pe=J[ce-1];if(!H_(he,pe)){v&&v.append(he,pe),I.vertexLength+4>dt.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const de=he.sub(pe)._perp(),Ce=de.x/(Math.abs(de.x)+Math.abs(de.y)),we=de.y>0?1:0,Ge=pe.dist(he);ie+Ge>32768&&(ie=0),oh(this.layoutVertexArray,he.x,he.y,Ce,we,0,0,ie),oh(this.layoutVertexArray,he.x,he.y,Ce,we,0,1,ie),ie+=Ge,oh(this.layoutVertexArray,pe.x,pe.y,Ce,we,0,0,ie),oh(this.layoutVertexArray,pe.x,pe.y,Ce,we,0,1,ie);const Be=I.vertexLength;this.indexArray.emplaceBack(Be,Be+2,Be+1),this.indexArray.emplaceBack(Be+1,Be+2,Be+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+S>dt.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),"Polygon"!==$_[n.type])continue;const A=[],O=[],N=I.vertexLength;for(let q=0;q<C.length;q++){const J=C[q];if(0!==J.length){J!==C[0]&&O.push(A.length/2);for(let ie=0;ie<J.length;ie++){const ce=J[ie];oh(this.layoutVertexArray,ce.x,ce.y,0,0,1,1,0),A.push(ce.x),A.push(ce.y),v&&v.currentPolyCount.top++}}}const U=sd(A,O);for(let q=0;q<U.length;q+=3)this.indexArray.emplaceBack(N+U[q],N+U[q+2],N+U[q+1]);I.primitiveLength+=U.length/3,I.vertexLength+=S}var w;if(v&&v.polyCount.length>0){if(v.borders){v.vertexArrayOffset=this.centroidVertexArray.length;const C=v.borders,S=this.featuresOnBorder.push(v)-1;for(let I=0;I<4;I++)C[I][0]!==Number.MAX_VALUE&&this.borders[I].push(S)}this.encodeCentroid(v.borders?void 0:v.centroid(),v)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,p,_,h)}sortBorders(){for(let n=0;n<4;n++)this.borders[n].sort((s,l)=>this.featuresOnBorder[s].borders[n][0]-this.featuresOnBorder[l].borders[n][0])}encodeCentroid(n,s,l=!0){let h,p;if(n)if(0!==n.y){const v=s.span()._mult(this.tileToMeter);h=(Math.max(n.x,1)<<3)+Math.min(7,Math.round(v.x/10)),p=(Math.max(n.y,1)<<3)+Math.min(7,Math.round(v.y/10))}else h=Math.ceil(7*(n.x+450)),p=0;else h=0,p=+l;let _=l?this.centroidVertexArray.length:s.vertexArrayOffset;for(const v of s.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*v.edges+v.top);for(let w=0;w<2*v.edges;w++)this.centroidVertexArray.emplace(_++,0,p),this.centroidVertexArray.emplace(_++,h,p);for(let w=0;w<v.top;w++)this.centroidVertexArray.emplace(_++,h,p)}}}function H_(i,n){return i.x===n.x&&(i.x<0||i.x>Rt)||i.y===n.y&&(i.y<0||i.y>Rt)}Xe("FillExtrusionBucket",sh,{omit:["layers","features"]}),Xe("PartMetadata",Fm);var q_={paint:new sr({"fill-extrusion-opacity":new nt(Ee["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new at(Ee["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new nt(Ee["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new nt(Ee["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new or(Ee["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new at(Ee["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new at(Ee["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new nt(Ee["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Xl(i,n){return i.x*n.x+i.y*n.y}function Rm(i,n){if(1===i.length){let s=0;const l=n[s++];let h;for(;!h||l.equals(h);)if(h=n[s++],!h)return 1/0;for(;s<n.length;s++){const p=n[s],_=i[0],v=h.sub(l),w=p.sub(l),C=_.sub(l),S=Xl(v,v),I=Xl(v,w),A=Xl(w,w),O=Xl(C,v),N=Xl(C,w),U=S*A-I*I,q=(A*O-I*N)/U,J=(S*N-I*O)/U,ie=l.z*(1-q-J)+h.z*q+p.z*J;if(isFinite(ie))return ie}return 1/0}{let s=1/0;for(const l of n)s=Math.min(s,l.z);return s}}function Lm(i){const n=new Ke(i[0],i[1]);return n.z=i[2],n}function ah(i,n,s,l,h,p,_,v){const w=_*h.getElevationAt(i,n,!0,!0),C=0!==p[0],S=C?0===p[1]?_*(p[0]/7-450):_*function(I,A,O){const N=Math.floor(A[0]/8),U=Math.floor(A[1]/8),q=10*(A[0]-8*N),J=10*(A[1]-8*U),ie=I.getElevationAt(N,U,!0,!0),ce=I.getMeterToDEM(O),he=Math.floor(.5*(q*ce-1)),pe=Math.floor(.5*(J*ce-1)),de=I.tileCoordToPixel(N,U),Ce=2*he+1,we=2*pe+1,Ge=(mn=Ce,Gt=we,[(We=I).getElevationAtPixel(Qe=de.x-he,Nt=de.y-pe,!0),We.getElevationAtPixel(Qe+Gt,Nt,!0),We.getElevationAtPixel(Qe,Nt+Gt,!0),We.getElevationAtPixel(Qe+mn,Nt+Gt,!0)]),Be=Math.abs(Ge[0]-Ge[1]),De=Math.abs(Ge[2]-Ge[3]),Ve=Math.abs(Ge[0]-Ge[2])+Math.abs(Ge[1]-Ge[3]),Ze=Math.min(.25,.5*ce*(Be+De)/Ce),Pe=Math.min(.25,.5*ce*Ve/we);var We,Qe,Nt,mn,Gt;return ie+Math.max(Ze*q,Pe*J)}(h,p,v):w;return{base:w+(0===s)?-1:s,top:C?Math.max(S+l,w+s+2):w+l}}const Z_=Rn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:W_}=Z_,X_=Rn([{name:"a_packed",components:3,type:"Float32"}]),{members:K_}=X_,J_=al.VectorTileFeature.types,Om=Math.cos(Math.PI/180*37.5);class hd{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new jl,this.layoutVertexArray2=new Vc,this.indexArray=new Ur,this.programConfigurations=new va(n.layers,n.zoom),this.segments=new dt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(n,s,l,h){this.hasPattern=Op("line",this.layers,s);const p=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:S,id:I,index:A,sourceLayerIndex:O}of n){const N=this.layers[0]._featureFilter.needGeometry,U=ql(S,N);if(!this.layers[0]._featureFilter.filter(new ft(this.zoom),U,l))continue;const q=p?p.evaluate(U,{},l):void 0,J={id:I,properties:S.properties,type:S.type,sourceLayerIndex:O,index:A,geometry:N?U.geometry:po(S,l,h),patterns:{},sortKey:q};_.push(J)}p&&_.sort((S,I)=>S.sortKey-I.sortKey);const{lineAtlas:v,featureIndex:w}=s,C=this.addConstantDashes(v);for(const S of _){const{geometry:I,index:A,sourceLayerIndex:O}=S;if(C&&this.addFeatureDashes(S,v),this.hasPattern){const N=zp("line",this.layers,S,this.zoom,s);this.patternFeatures.push(N)}else this.addFeature(S,I,A,l,v.positions,s.availableImages);w.insert(n[A].feature,I,A,O,this.index)}}addConstantDashes(n){let s=!1;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==p.kind)s=!0;else{const _=p.value,v=h.value;if(!v)continue;n.addDash(v.from,_),n.addDash(v.to,_),v.other&&n.addDash(v.other,_)}}return s}addFeatureDashes(n,s){const l=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if("constant"===p.kind&&"constant"===_.kind)continue;let v,w,C,S,I,A;if("constant"===p.kind){const q=p.value;if(!q)continue;v=q.other||q.to,w=q.to,C=q.from}else v=p.evaluate({zoom:l-1},n),w=p.evaluate({zoom:l},n),C=p.evaluate({zoom:l+1},n);"constant"===_.kind?S=I=A=_.value:(S=_.evaluate({zoom:l-1},n),I=_.evaluate({zoom:l},n),A=_.evaluate({zoom:l+1},n)),s.addDash(v,S),s.addDash(w,I),s.addDash(C,A);const O=s.getKey(v,S),N=s.getKey(w,I),U=s.getKey(C,A);n.patterns[h.id]={min:O,mid:N,max:U}}}update(n,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l,h)}addFeatures(n,s,l,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,K_)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,W_),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,s,l,h,p,_){const v=this.layers[0].layout,w=v.get("line-join").evaluate(n,{}),C=v.get("line-cap").evaluate(n,{}),S=v.get("line-miter-limit"),I=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const A of s)this.addLine(A,n,w,C,S,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,p,_,h)}addLine(n,s,l,h,p,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<n.length-1;J++)this.totalDistance+=n[J].dist(n[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v="Polygon"===J_[s.type];let w=n.length;for(;w>=2&&n[w-1].equals(n[w-2]);)w--;let C=0;for(;C<w-1&&n[C].equals(n[C+1]);)C++;if(w<(v?3:2))return;"bevel"===l&&(p=1.05);const S=this.overscaling<=16?122880/(512*this.overscaling):0,I=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let A,O,N,U,q;this.e1=this.e2=-1,v&&(A=n[w-2],q=n[C].sub(A)._unit()._perp());for(let J=C;J<w;J++){if(N=J===w-1?v?n[C+1]:void 0:n[J+1],N&&n[J].equals(N))continue;q&&(U=q),A&&(O=A),A=n[J],q=N?N.sub(A)._unit()._perp():U,U=U||q;let ie=U.add(q);0===ie.x&&0===ie.y||ie._unit();const ce=U.x*q.x+U.y*q.y,he=ie.x*q.x+ie.y*q.y,pe=0!==he?1/he:1/0,de=2*Math.sqrt(2-2*he),Ce=he<Om&&O&&N,we=U.x*q.y-U.y*q.x>0;if(Ce&&J>C){const De=A.dist(O);if(De>2*S){const Ve=A.sub(A.sub(O)._mult(S/De)._round());this.updateDistance(O,Ve),this.addCurrentVertex(Ve,U,0,0,I),O=Ve}}const Ge=O&&N;let Be=Ge?l:v?"butt":h;if(Ge&&"round"===Be&&(pe<_?Be="miter":pe<=2&&(Be="fakeround")),"miter"===Be&&pe>p&&(Be="bevel"),"bevel"===Be&&(pe>2&&(Be="flipbevel"),pe<p&&(Be="miter")),O&&this.updateDistance(O,A),"miter"===Be)ie._mult(pe),this.addCurrentVertex(A,ie,0,0,I);else if("flipbevel"===Be){if(pe>100)ie=q.mult(-1);else{const De=pe*U.add(q).mag()/U.sub(q).mag();ie._perp()._mult(De*(we?-1:1))}this.addCurrentVertex(A,ie,0,0,I),this.addCurrentVertex(A,ie.mult(-1),0,0,I)}else if("bevel"===Be||"fakeround"===Be){const De=-Math.sqrt(pe*pe-1),Ve=we?De:0,Ze=we?0:De;if(O&&this.addCurrentVertex(A,U,Ve,Ze,I),"fakeround"===Be){const Pe=Math.round(180*de/Math.PI/20);for(let We=1;We<Pe;We++){let Qe=We/Pe;if(.5!==Qe){const mn=Qe-.5;Qe+=Qe*mn*(Qe-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*mn*mn+(.848013+ce*(.215638*ce-1.06021)))}const Nt=q.sub(U)._mult(Qe)._add(U)._unit()._mult(we?-1:1);this.addHalfVertex(A,Nt.x,Nt.y,!1,we,0,I)}}N&&this.addCurrentVertex(A,q,-Ve,-Ze,I)}else if("butt"===Be)this.addCurrentVertex(A,ie,0,0,I);else if("square"===Be){const De=O?1:-1;O||this.addCurrentVertex(A,ie,De,De,I),this.addCurrentVertex(A,ie,0,0,I),O&&this.addCurrentVertex(A,ie,De,De,I)}else"round"===Be&&(O&&(this.addCurrentVertex(A,U,0,0,I),this.addCurrentVertex(A,U,1,1,I,!0)),N&&(this.addCurrentVertex(A,q,-1,-1,I,!0),this.addCurrentVertex(A,q,0,0,I)));if(Ce&&J<w-1){const De=A.dist(N);if(De>2*S){const Ve=A.add(N.sub(A)._mult(S/De)._round());this.updateDistance(A,Ve),this.addCurrentVertex(Ve,q,0,0,I),A=Ve}}}}addCurrentVertex(n,s,l,h,p,_=!1){const v=s.y*h-s.x,w=-s.y-s.x*h;this.addHalfVertex(n,s.x+s.y*l,s.y-s.x*l,_,!1,l,p),this.addHalfVertex(n,v,w,_,!0,-h,p)}addHalfVertex({x:n,y:s},l,h,p,_,v,w){this.layoutVertexArray.emplaceBack((n<<1)+(p?1:0),(s<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(0===v?0:v<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const C=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),w.primitiveLength++),_?this.e2=C:this.e1=C}updateScaledDistance(){if(this.lineClips){const n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,s){this.distance+=n.dist(s),this.updateScaledDistance()}}Xe("LineBucket",hd,{omit:["layers","patternFeatures"]});const Y_=new sr({"line-cap":new at(Ee.layout_line["line-cap"]),"line-join":new at(Ee.layout_line["line-join"]),"line-miter-limit":new nt(Ee.layout_line["line-miter-limit"]),"line-round-limit":new nt(Ee.layout_line["line-round-limit"]),"line-sort-key":new at(Ee.layout_line["line-sort-key"])});var zm={paint:new sr({"line-opacity":new at(Ee.paint_line["line-opacity"]),"line-color":new at(Ee.paint_line["line-color"]),"line-translate":new nt(Ee.paint_line["line-translate"]),"line-translate-anchor":new nt(Ee.paint_line["line-translate-anchor"]),"line-width":new at(Ee.paint_line["line-width"]),"line-gap-width":new at(Ee.paint_line["line-gap-width"]),"line-offset":new at(Ee.paint_line["line-offset"]),"line-blur":new at(Ee.paint_line["line-blur"]),"line-dasharray":new or(Ee.paint_line["line-dasharray"]),"line-pattern":new or(Ee.paint_line["line-pattern"]),"line-gradient":new co(Ee.paint_line["line-gradient"])}),layout:Y_};const Bm=new class extends at{possiblyEvaluate(i,n){return n=new ft(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(i,n)}evaluate(i,n,s,l){return n=Un({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(i,n,s,l)}}(zm.paint.properties["line-width"].specification);function Nm(i,n){return n>0?n+2*i:i}Bm.useIntegerZoom=!0;const Q_=Rn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),ey=Rn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Rn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ty=Rn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Yc=Rn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Rn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ls=Rn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Sx=Rn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Rn([{name:"triangle",components:3,type:"Uint16"}]),Rn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Rn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Rn([{type:"Float32",name:"offsetX"}]),Rn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const cs=128;function Vm(i,n){const{expression:s}=n;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new ft(i+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:l,interpolationType:h}=s;let p=0;for(;p<l.length&&l[p]<=i;)p++;p=Math.max(0,p-1);let _=p;for(;_<l.length&&l[_]<i+1;)_++;_=Math.min(l.length-1,_);const v=l[p],w=l[_];return"composite"===s.kind?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:w,minSize:s.evaluate(new ft(v)),maxSize:s.evaluate(new ft(w)),interpolationType:h}}}function yi(i,{uSize:n,uSizeT:s},{lowerSize:l,upperSize:h}){return"source"===i.kind?l/cs:"composite"===i.kind?zt(l/cs,h/cs,s):n}function ll(i,n){let s=0,l=0;if("constant"===i.kind)l=i.layoutSize;else if("source"!==i.kind){const{interpolationType:h,minZoom:p,maxZoom:_}=i,v=h?cn(Mn.interpolationFactor(h,n,p,_),0,1):0;"camera"===i.kind?l=zt(i.minSize,i.maxSize,v):s=v}return{uSizeT:s,uSize:l}}var Up=Object.freeze({__proto__:null,getSizeData:Vm,evaluateSizeForFeature:yi,evaluateSizeForZoom:ll,SIZE_PACK_FACTOR:cs});function ny(i,n,s){return i.sections.forEach(l=>{l.text=function(h,p,_){const v=p.layout.get("text-transform").evaluate(_,{});return"uppercase"===v?h=h.toLocaleUpperCase():"lowercase"===v&&(h=h.toLocaleLowerCase()),Ut.applyArabicShaping&&(h=Ut.applyArabicShaping(h)),h}(l.text,n,s)}),i}const Qc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function lh(i){return"\ufe36"===i||"\ufe48"===i||"\ufe38"===i||"\ufe44"===i||"\ufe42"===i||"\ufe3e"===i||"\ufe3c"===i||"\ufe3a"===i||"\ufe18"===i||"\ufe40"===i||"\ufe10"===i||"\ufe13"===i||"\ufe14"===i||"\uff40"===i||"\uffe3"===i||"\ufe11"===i||"\ufe12"===i}function jm(i){return"\ufe35"===i||"\ufe47"===i||"\ufe37"===i||"\ufe43"===i||"\ufe41"===i||"\ufe3d"===i||"\ufe3b"===i||"\ufe39"===i||"\ufe17"===i||"\ufe3f"===i}var Gp=function(i,n,s,l,h){var p,_,v=8*h-l-1,w=(1<<v)-1,C=w>>1,S=-7,I=s?h-1:0,A=s?-1:1,O=i[n+I];for(I+=A,p=O&(1<<-S)-1,O>>=-S,S+=v;S>0;p=256*p+i[n+I],I+=A,S-=8);for(_=p&(1<<-S)-1,p>>=-S,S+=l;S>0;_=256*_+i[n+I],I+=A,S-=8);if(0===p)p=1-C;else{if(p===w)return _?NaN:1/0*(O?-1:1);_+=Math.pow(2,l),p-=C}return(O?-1:1)*_*Math.pow(2,p-l)},dd=function(i,n,s,l,h,p){var _,v,w,C=8*p-h-1,S=(1<<C)-1,I=S>>1,A=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,O=l?0:p-1,N=l?1:-1,U=n<0||0===n&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(v=isNaN(n)?1:0,_=S):(_=Math.floor(Math.log(n)/Math.LN2),n*(w=Math.pow(2,-_))<1&&(_--,w*=2),(n+=_+I>=1?A/w:A*Math.pow(2,1-I))*w>=2&&(_++,w/=2),_+I>=S?(v=0,_=S):_+I>=1?(v=(n*w-1)*Math.pow(2,h),_+=I):(v=n*Math.pow(2,I-1)*Math.pow(2,h),_=0));h>=8;i[s+O]=255&v,O+=N,v/=256,h-=8);for(_=_<<h|v,C+=h;C>0;i[s+O]=255&_,O+=N,_/=256,C-=8);i[s+O-N]|=128*U},Kl=fn;function fn(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}fn.Varint=0,fn.Fixed64=1,fn.Bytes=2,fn.Fixed32=5;var Um=4294967296,Jl=1/Um,pd="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Ps(i){return i.type===fn.Bytes?i.readVarint()+i.pos:i.pos+1}function fd(i,n,s){var l=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));s.realloc(l);for(var h=s.pos-1;h>=i;h--)s.buf[h+l]=s.buf[h]}function ry(i,n){for(var s=0;s<i.length;s++)n.writeVarint(i[s])}function iy(i,n){for(var s=0;s<i.length;s++)n.writeSVarint(i[s])}function oy(i,n){for(var s=0;s<i.length;s++)n.writeFloat(i[s])}function sy(i,n){for(var s=0;s<i.length;s++)n.writeDouble(i[s])}function ay(i,n){for(var s=0;s<i.length;s++)n.writeBoolean(i[s])}function ly(i,n){for(var s=0;s<i.length;s++)n.writeFixed32(i[s])}function Gm(i,n){for(var s=0;s<i.length;s++)n.writeSFixed32(i[s])}function $p(i,n){for(var s=0;s<i.length;s++)n.writeFixed64(i[s])}function $m(i,n){for(var s=0;s<i.length;s++)n.writeSFixed64(i[s])}function tu(i,n){return(i[n]|i[n+1]<<8|i[n+2]<<16)+16777216*i[n+3]}function nu(i,n,s){i[s]=n,i[s+1]=n>>>8,i[s+2]=n>>>16,i[s+3]=n>>>24}function Hm(i,n){return(i[n]|i[n+1]<<8|i[n+2]<<16)+(i[n+3]<<24)}function qm(i,n,s){n.glyphs=[],1===i&&s.readMessage(Zm,n)}function Zm(i,n,s){if(3===i){const{id:l,bitmap:h,width:p,height:_,left:v,top:w,advance:C}=s.readMessage(Yl,{});n.glyphs.push({id:l,bitmap:new Wl({width:p+6,height:_+6},h),metrics:{width:p,height:_,left:v,top:w,advance:C}})}else 4===i?n.ascender=s.readSVarint():5===i&&(n.descender=s.readSVarint())}function Yl(i,n,s){1===i?n.id=s.readVarint():2===i?n.bitmap=s.readBytes():3===i?n.width=s.readVarint():4===i?n.height=s.readVarint():5===i?n.left=s.readSVarint():6===i?n.top=s.readSVarint():7===i&&(n.advance=s.readVarint())}function md(i){let n=0,s=0;for(const _ of i)n+=_.w*_.h,s=Math.max(s,_.w);i.sort((_,v)=>v.h-_.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),s),h:1/0}];let h=0,p=0;for(const _ of i)for(let v=l.length-1;v>=0;v--){const w=l[v];if(!(_.w>w.w||_.h>w.h)){if(_.x=w.x,_.y=w.y,p=Math.max(p,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===w.w&&_.h===w.h){const C=l.pop();v<l.length&&(l[v]=C)}else _.h===w.h?(w.x+=_.w,w.w-=_.w):_.w===w.w?(w.y+=_.h,w.h-=_.h):(l.push({x:w.x+_.w,y:w.y,w:w.w-_.w,h:_.h}),w.y+=_.h,w.h-=_.h);break}}return{w:h,h:p,fill:n/(h*p)||0}}fn.prototype={destroy:function(){this.buf=null},readFields:function(i,n,s){for(s=s||this.length;this.pos<s;){var l=this.readVarint(),h=l>>3,p=this.pos;this.type=7&l,i(h,n,this),this.pos===p&&this.skip(l)}return n},readMessage:function(i,n){return this.readFields(i,n,this.readVarint()+this.pos)},readFixed32:function(){var i=tu(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Hm(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=tu(this.buf,this.pos)+tu(this.buf,this.pos+4)*Um;return this.pos+=8,i},readSFixed64:function(){var i=tu(this.buf,this.pos)+Hm(this.buf,this.pos+4)*Um;return this.pos+=8,i},readFloat:function(){var i=Gp(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Gp(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var n,s,l=this.buf;return n=127&(s=l[this.pos++]),s<128?n:(n|=(127&(s=l[this.pos++]))<<7,s<128?n:(n|=(127&(s=l[this.pos++]))<<14,s<128?n:(n|=(127&(s=l[this.pos++]))<<21,s<128?n:function(h,p,_){var v,w,C=_.buf;if(v=(112&(w=C[_.pos++]))>>4,w<128||(v|=(127&(w=C[_.pos++]))<<3,w<128)||(v|=(127&(w=C[_.pos++]))<<10,w<128)||(v|=(127&(w=C[_.pos++]))<<17,w<128)||(v|=(127&(w=C[_.pos++]))<<24,w<128)||(v|=(1&(w=C[_.pos++]))<<31,w<128))return function eu(i,n,s){return s?4294967296*n+(i>>>0):4294967296*(n>>>0)+(i>>>0)}(h,v,p);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(s=l[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,n=this.pos;return this.pos=i,i-n>=12&&pd?pd.decode(this.buf.subarray(n,i)):function(s,l,h){for(var p="",_=l;_<h;){var v,w,C,S=s[_],I=null,A=S>239?4:S>223?3:S>191?2:1;if(_+A>h)break;1===A?S<128&&(I=S):2===A?128==(192&(v=s[_+1]))&&(I=(31&S)<<6|63&v)<=127&&(I=null):3===A?(w=s[_+2],128==(192&(v=s[_+1]))&&128==(192&w)&&((I=(15&S)<<12|(63&v)<<6|63&w)<=2047||I>=55296&&I<=57343)&&(I=null)):4===A&&(w=s[_+2],C=s[_+3],128==(192&(v=s[_+1]))&&128==(192&w)&&128==(192&C)&&((I=(15&S)<<18|(63&v)<<12|(63&w)<<6|63&C)<=65535||I>=1114112)&&(I=null)),null===I?(I=65533,A=1):I>65535&&(I-=65536,p+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),p+=String.fromCharCode(I),_+=A}return p}(this.buf,n,i)},readBytes:function(){var i=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,i);return this.pos=i,n},readPackedVarint:function(i,n){if(this.type!==fn.Bytes)return i.push(this.readVarint(n));var s=Ps(this);for(i=i||[];this.pos<s;)i.push(this.readVarint(n));return i},readPackedSVarint:function(i){if(this.type!==fn.Bytes)return i.push(this.readSVarint());var n=Ps(this);for(i=i||[];this.pos<n;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==fn.Bytes)return i.push(this.readBoolean());var n=Ps(this);for(i=i||[];this.pos<n;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==fn.Bytes)return i.push(this.readFloat());var n=Ps(this);for(i=i||[];this.pos<n;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==fn.Bytes)return i.push(this.readDouble());var n=Ps(this);for(i=i||[];this.pos<n;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==fn.Bytes)return i.push(this.readFixed32());var n=Ps(this);for(i=i||[];this.pos<n;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==fn.Bytes)return i.push(this.readSFixed32());var n=Ps(this);for(i=i||[];this.pos<n;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==fn.Bytes)return i.push(this.readFixed64());var n=Ps(this);for(i=i||[];this.pos<n;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==fn.Bytes)return i.push(this.readSFixed64());var n=Ps(this);for(i=i||[];this.pos<n;)i.push(this.readSFixed64());return i},skip:function(i){var n=7&i;if(n===fn.Varint)for(;this.buf[this.pos++]>127;);else if(n===fn.Bytes)this.pos=this.readVarint()+this.pos;else if(n===fn.Fixed32)this.pos+=4;else{if(n!==fn.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(i,n){this.writeVarint(i<<3|n)},realloc:function(i){for(var n=this.length||16;n<this.pos+i;)n*=2;if(n!==this.length){var s=new Uint8Array(n);s.set(this.buf),this.buf=s,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),nu(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),nu(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),nu(this.buf,-1&i,this.pos),nu(this.buf,Math.floor(i*Jl),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),nu(this.buf,-1&i,this.pos),nu(this.buf,Math.floor(i*Jl),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(n,s){var l,h,p,v;if(n>=0?(l=n%4294967296|0,h=n/4294967296|0):(h=~(-n/4294967296),4294967295^(l=~(-n%4294967296))?l=l+1|0:(l=0,h=h+1|0)),n>=0x10000000000000000||n<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),p=l,(v=s).buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7),function(p,_){var v=(7&p)<<4;_.buf[_.pos++]|=v|((p>>>=3)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p)))))}(h,s)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var n=this.pos;this.pos=function(l,h,p){for(var _,v,w=0;w<h.length;w++){if((_=h.charCodeAt(w))>55295&&_<57344){if(!v){_>56319||w+1===h.length?(l[p++]=239,l[p++]=191,l[p++]=189):v=_;continue}if(_<56320){l[p++]=239,l[p++]=191,l[p++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(l[p++]=239,l[p++]=191,l[p++]=189,v=null);_<128?l[p++]=_:(_<2048?l[p++]=_>>6|192:(_<65536?l[p++]=_>>12|224:(l[p++]=_>>18|240,l[p++]=_>>12&63|128),l[p++]=_>>6&63|128),l[p++]=63&_|128)}return p}(this.buf,i,this.pos);var s=this.pos-n;s>=128&&fd(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeFloat:function(i){this.realloc(4),dd(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),dd(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var n=i.length;this.writeVarint(n),this.realloc(n);for(var s=0;s<n;s++)this.buf[this.pos++]=i[s]},writeRawMessage:function(i,n){this.pos++;var s=this.pos;i(n,this);var l=this.pos-s;l>=128&&fd(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeMessage:function(i,n,s){this.writeTag(i,fn.Bytes),this.writeRawMessage(n,s)},writePackedVarint:function(i,n){n.length&&this.writeMessage(i,ry,n)},writePackedSVarint:function(i,n){n.length&&this.writeMessage(i,iy,n)},writePackedBoolean:function(i,n){n.length&&this.writeMessage(i,ay,n)},writePackedFloat:function(i,n){n.length&&this.writeMessage(i,oy,n)},writePackedDouble:function(i,n){n.length&&this.writeMessage(i,sy,n)},writePackedFixed32:function(i,n){n.length&&this.writeMessage(i,ly,n)},writePackedSFixed32:function(i,n){n.length&&this.writeMessage(i,Gm,n)},writePackedFixed64:function(i,n){n.length&&this.writeMessage(i,$p,n)},writePackedSFixed64:function(i,n){n.length&&this.writeMessage(i,$m,n)},writeBytesField:function(i,n){this.writeTag(i,fn.Bytes),this.writeBytes(n)},writeFixed32Field:function(i,n){this.writeTag(i,fn.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(i,n){this.writeTag(i,fn.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(i,n){this.writeTag(i,fn.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(i,n){this.writeTag(i,fn.Fixed64),this.writeSFixed64(n)},writeVarintField:function(i,n){this.writeTag(i,fn.Varint),this.writeVarint(n)},writeSVarintField:function(i,n){this.writeTag(i,fn.Varint),this.writeSVarint(n)},writeStringField:function(i,n){this.writeTag(i,fn.Bytes),this.writeString(n)},writeFloatField:function(i,n){this.writeTag(i,fn.Fixed32),this.writeFloat(n)},writeDoubleField:function(i,n){this.writeTag(i,fn.Fixed64),this.writeDouble(n)},writeBooleanField:function(i,n){this.writeVarintField(i,Boolean(n))}};class gd{constructor(n,{pixelRatio:s,version:l,stretchX:h,stretchY:p,content:_}){this.paddedRect=n,this.pixelRatio=s,this.stretchX=h,this.stretchY=p,this.content=_,this.version=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Wm{constructor(n,s){const l={},h={};this.haveRenderCallbacks=[];const p=[];this.addImages(n,l,p),this.addImages(s,h,p);const{w:_,h:v}=md(p),w=new Wi({width:_||1,height:v||1});for(const C in n){const S=n[C],I=l[C].paddedRect;Wi.copy(S.data,w,{x:0,y:0},{x:I.x+1,y:I.y+1},S.data)}for(const C in s){const S=s[C],I=h[C].paddedRect,A=I.x+1,O=I.y+1,N=S.data.width,U=S.data.height;Wi.copy(S.data,w,{x:0,y:0},{x:A,y:O},S.data),Wi.copy(S.data,w,{x:0,y:U-1},{x:A,y:O-1},{width:N,height:1}),Wi.copy(S.data,w,{x:0,y:0},{x:A,y:O+U},{width:N,height:1}),Wi.copy(S.data,w,{x:N-1,y:0},{x:A-1,y:O},{width:1,height:U}),Wi.copy(S.data,w,{x:0,y:0},{x:A+N,y:O},{width:1,height:U})}this.image=w,this.iconPositions=l,this.patternPositions=h}addImages(n,s,l){for(const h in n){const p=n[h],_={x:0,y:0,w:p.data.width+2,h:p.data.height+2};l.push(_),s[h]=new gd(_,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(n,s){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in n.updatedImages)this.patchUpdatedImage(this.iconPositions[l],n.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],n.getImage(l),s)}patchUpdatedImage(n,s,l){if(!n||!s||n.version===s.version)return;n.version=s.version;const[h,p]=n.tl;l.update(s.data,void 0,{x:h,y:p})}}Xe("ImagePosition",gd),Xe("ImageAtlas",Wm);const vi={horizontal:1,vertical:2,horizontalOnly:3};class ch{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,s){const l=new ch;return l.scale=n||1,l.fontStack=s,l}static forImage(n){const s=new ch;return s.imageName=n,s}}class Ql{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,s){const l=new Ql;for(let h=0;h<n.sections.length;h++){const p=n.sections[h];p.image?l.addImageSection(p):l.addTextSection(p,s)}return l}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(n){this.text=function(s,l){let h="";for(let p=0;p<s.length;p++){const _=s.charCodeAt(p+1)||null,v=s.charCodeAt(p-1)||null;h+=!l&&(_&&tt(_)&&!Qc[s[p+1]]||v&&tt(v)&&!Qc[s[p-1]])||!Qc[s[p]]?s[p]:Qc[s[p]]}return h}(this.text,n)}trim(){let n=0;for(let l=0;l<this.text.length&&uh[this.text.charCodeAt(l)];l++)n++;let s=this.text.length;for(let l=this.text.length-1;l>=0&&l>=n&&uh[this.text.charCodeAt(l)];l--)s--;this.text=this.text.substring(n,s),this.sectionIndex=this.sectionIndex.slice(n,s)}substring(n,s){const l=new Ql;return l.text=this.text.substring(n,s),l.sectionIndex=this.sectionIndex.slice(n,s),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,s)=>Math.max(n,this.sections[s].scale),0)}addTextSection(n,s){this.text+=n.text,this.sections.push(ch.forText(n.scale,n.fontStack||s));const l=this.sections.length-1;for(let h=0;h<n.text.length;++h)this.sectionIndex.push(l)}addImageSection(n){const s=n.image?n.image.name:"";if(0===s.length)return void An("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(ch.forImage(s)),this.sectionIndex.push(this.sections.length-1)):An("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _d(i,n,s,l,h,p,_,v,w,C,S,I,A,O,N,U){const q=Ql.fromFeature(i,h);let J;I===vi.vertical&&q.verticalizePunctuation(A);const{processBidirectionalText:ie,processStyledBidirectionalText:ce}=Ut;if(ie&&1===q.sections.length){J=[];const de=ie(q.toString(),xd(q,C,p,n,l,O,N));for(const Ce of de){const we=new Ql;we.text=Ce,we.sections=q.sections;for(let Ge=0;Ge<Ce.length;Ge++)we.sectionIndex.push(0);J.push(we)}}else if(ce){J=[];const de=ce(q.text,q.sectionIndex,xd(q,C,p,n,l,O,N));for(const Ce of de){const we=new Ql;we.text=Ce[0],we.sectionIndex=Ce[1],we.sections=q.sections,J.push(we)}}else J=function(de,Ce){const we=[],Ge=de.text;let Be=0;for(const De of Ce)we.push(de.substring(Be,De)),Be=De;return Be<Ge.length&&we.push(de.substring(Be,Ge.length)),we}(q,xd(q,C,p,n,l,O,N));const he=[],pe={positionedLines:he,text:q.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(de,Ce,we,Ge,Be,De,Ve,Ze,Pe,We,Qe,Nt){let mn=0,Gt=0,$t=0;const Ne="right"===Ze?1:"left"===Ze?0:.5;let rn=!1;for(const on of Be){const Vt=on.getSections();for(const Nn of Vt){if(Nn.imageName)continue;const lr=Ce[Nn.fontStack];if(lr&&(rn=void 0!==lr.ascender&&void 0!==lr.descender,!rn))break}if(!rn)break}let Kt=0;for(const on of Be){on.trim();const Vt=on.getMaxScale(),Nn=24*(Vt-1),lr={positionedGlyphs:[],lineOffset:0};de.positionedLines[Kt]=lr;const Vn=lr.positionedGlyphs;let cr=0;if(!on.length()){Gt+=De,++Kt;continue}let Rr=0,wi=0;for(let Jt=0;Jt<on.length();Jt++){const Lr=on.getSection(Jt),hs=on.getSectionIndex(Jt),Mr=on.getCharCode(Jt);let dn=Lr.scale,_r=null,Ln=null,Ei=null,ur=24,St=0;const Ci=!(Pe===vi.horizontal||!Qe&&!Me(Mr)||Qe&&(uh[Mr]||(Qn=Mr,o(Qn)||c(Qn)||g(Qn)||se(Qn)||Re(Qn))));if(Lr.imageName){const $r=Ge[Lr.imageName];if(!$r)continue;Ei=Lr.imageName,de.iconsInText=de.iconsInText||!0,Ln=$r.paddedRect;const Sr=$r.displaySize;dn=24*dn/Nt,_r={width:Sr[0],height:Sr[1],left:1,top:-3,advance:Ci?Sr[1]:Sr[0],localGlyph:!1},St=rn?-_r.height*dn:24*Vt-17-Sr[1]*dn,ur=_r.advance;const ds=(Ci?Sr[0]:Sr[1])*dn-24*Vt;ds>0&&ds>cr&&(cr=ds)}else{const $r=we[Lr.fontStack];if(!$r)continue;$r[Mr]&&(Ln=$r[Mr]);const Sr=Ce[Lr.fontStack];if(!Sr)continue;const ds=Sr.glyphs[Mr];if(!ds)continue;if(_r=ds.metrics,ur=8203!==Mr?24:0,rn){const lu=void 0!==Sr.ascender?Math.abs(Sr.ascender):0,Eh=void 0!==Sr.descender?Math.abs(Sr.descender):0,Ch=(lu+Eh)*dn;Rr<Ch&&(Rr=Ch,wi=(lu-Eh)/2*dn),St=-lu*dn}else St=24*(Vt-dn)-17}Ci?(de.verticalizable=!0,Vn.push({glyph:Mr,imageName:Ei,x:mn,y:Gt+St,vertical:Ci,scale:dn,localGlyph:_r.localGlyph,fontStack:Lr.fontStack,sectionIndex:hs,metrics:_r,rect:Ln}),mn+=ur*dn+We):(Vn.push({glyph:Mr,imageName:Ei,x:mn,y:Gt+St,vertical:Ci,scale:dn,localGlyph:_r.localGlyph,fontStack:Lr.fontStack,sectionIndex:hs,metrics:_r,rect:Ln}),mn+=_r.advance*dn+We)}0!==Vn.length&&($t=Math.max(mn-We,$t),rn?ru(Vn,Ne,cr,wi,De*Vt/2):ru(Vn,Ne,cr,0,De/2)),mn=0;const Ji=De*Vt+cr;lr.lineOffset=Math.max(cr,Nn),Gt+=Ji,++Kt}var Qn;const Bn=Gt,{horizontalAlign:Fr,verticalAlign:Gr}=dh(Ve);(function(on,Vt,Nn,lr,Vn,cr){const Rr=(Vt-Nn)*Vn,wi=-cr*lr;for(const Ji of on)for(const Jt of Ji.positionedGlyphs)Jt.x+=Rr,Jt.y+=wi})(de.positionedLines,Ne,Fr,Gr,$t,Bn),de.top+=-Gr*Bn,de.bottom=de.top+Bn,de.left+=-Fr*$t,de.right=de.left+$t,de.hasBaseline=rn}(pe,n,s,l,J,_,v,w,I,C,A,U),!function(de){for(const Ce of de)if(0!==Ce.positionedGlyphs.length)return!1;return!0}(he)&&pe}const uh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Hp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function qp(i,n,s,l,h,p){if(n.imageName){const _=l[n.imageName];return _?_.displaySize[0]*n.scale*24/p+h:0}{const _=s[n.fontStack],v=_&&_.glyphs[i];return v?v.metrics.advance*n.scale+h:0}}function hh(i,n,s,l){const h=Math.pow(i-n,2);return l?i<n?h/2:2*h:h+Math.abs(s)*s}function yd(i,n,s){let l=0;return 10===i&&(l-=1e4),s&&(l+=150),40!==i&&65288!==i||(l+=50),41!==n&&65289!==n||(l+=50),l}function Zp(i,n,s,l,h,p){let _=null,v=hh(n,s,h,p);for(const w of l){const C=hh(n-w.x,s,h,p)+w.badness;C<=v&&(_=w,v=C)}return{index:i,x:n,priorBreak:_,badness:v}}function vd(i){return i?vd(i.priorBreak).concat(i.index):[]}function xd(i,n,s,l,h,p,_){if("point"!==p)return[];if(!i)return[];const v=[],w=function(A,O,N,U,q,J){let ie=0;for(let ce=0;ce<A.length();ce++){const he=A.getSection(ce);ie+=qp(A.getCharCode(ce),he,U,q,O,J)}return ie/Math.max(1,Math.ceil(ie/N))}(i,n,s,l,h,_),C=i.text.indexOf("\u200b")>=0;let S=0;for(let A=0;A<i.length();A++){const O=i.getSection(A),N=i.getCharCode(A);if(uh[N]||(S+=qp(N,O,l,h,n,_)),A<i.length()-1){const U=!((I=N)<11904||!(z(I)||R(I)||xe(I)||re(I)||W(I)||y(I)||j(I)||T(I)||oe(I)||$(I)||H(I)||ke(I)||P(I)||E(I)||x(I)||Z(I)||F(I)||ge(I)||ee(I)||ne(I)));(Hp[N]||U||O.imageName)&&v.push(Zp(A+1,S,w,v,yd(N,i.getCharCode(A+1),U&&C),!1))}}var I;return vd(Zp(i.length(),S,w,v,0,!0))}function dh(i){let n=.5,s=.5;switch(i){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:n,verticalAlign:s}}function ru(i,n,s,l,h){if(!(n||s||l||h))return;const p=i.length-1,_=i[p],v=(_.x+_.metrics.advance*_.scale)*n;for(let w=0;w<=p;w++)i[w].x-=v,i[w].y+=s+l+h}function cy(i,n,s){const{horizontalAlign:l,verticalAlign:h}=dh(s),p=n[0]-i.displaySize[0]*l,_=n[1]-i.displaySize[1]*h;return{image:i,top:_,bottom:_+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function Wp(i,n,s,l,h,p){const _=i.image;let v;if(_.content){const q=_.content,J=_.pixelRatio||1;v=[q[0]/J,q[1]/J,_.displaySize[0]-q[2]/J,_.displaySize[1]-q[3]/J]}const w=n.left*p,C=n.right*p;let S,I,A,O;"width"===s||"both"===s?(O=h[0]+w-l[3],I=h[0]+C+l[1]):(O=h[0]+(w+C-_.displaySize[0])/2,I=O+_.displaySize[0]);const N=n.top*p,U=n.bottom*p;return"height"===s||"both"===s?(S=h[1]+N-l[0],A=h[1]+U+l[2]):(S=h[1]+(N+U-_.displaySize[1])/2,A=S+_.displaySize[1]),{image:_,top:S,right:I,bottom:A,left:O,collisionPadding:v}}class ba extends Ke{constructor(n,s,l,h,p){super(n,s),this.angle=h,this.z=l,void 0!==p&&(this.segment=p)}clone(){return new ba(this.x,this.y,this.z,this.angle,this.segment)}}function Xm(i,n,s,l,h){if(void 0===n.segment)return!0;let p=n,_=n.segment+1,v=0;for(;v>-s/2;){if(_--,_<0)return!1;v-=i[_].dist(p),p=i[_]}v+=i[_].dist(i[_+1]),_++;const w=[];let C=0;for(;v<s/2;){const S=i[_],I=i[_+1];if(!I)return!1;let A=i[_-1].angleTo(S)-S.angleTo(I);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:A}),C+=A;v-w[0].distance>l;)C-=w.shift().angleDelta;if(C>h)return!1;_++,v+=S.dist(I)}return!0}function Xp(i){let n=0;for(let s=0;s<i.length-1;s++)n+=i[s].dist(i[s+1]);return n}function bd(i,n,s){return i?.6*n*s:0}function Kp(i,n){return Math.max(i?i.right-i.left:0,n?n.right-n.left:0)}function Ix(i,n,s,l,h,p){const _=bd(s,h,p),v=Kp(s,l)*p;let w=0;const C=Xp(i)/2;for(let S=0;S<i.length-1;S++){const I=i[S],A=i[S+1],O=I.dist(A);if(w+O>C){const N=(C-w)/O,U=zt(I.x,A.x,N),q=zt(I.y,A.y,N),J=new ba(U,q,0,A.angleTo(I),S);return!_||Xm(i,J,v,_,n)?J:void 0}w+=O}}function Km(i,n,s,l,h,p,_,v,w){const C=bd(l,p,_),S=Kp(l,h),I=S*_,A=0===i[0].x||i[0].x===w||0===i[0].y||i[0].y===w;return n-I<n/4&&(n=I+n/4),Jm(i,A?n/2*v%n:(S/2+2*p)*_*v%n,n,C,s,I,A,!1,w)}function Jm(i,n,s,l,h,p,_,v,w){const C=p/2,S=Xp(i);let I=0,A=n-s,O=[];for(let N=0;N<i.length-1;N++){const U=i[N],q=i[N+1],J=U.dist(q),ie=q.angleTo(U);for(;A+s<I+J;){A+=s;const ce=(A-I)/J,he=zt(U.x,q.x,ce),pe=zt(U.y,q.y,ce);if(he>=0&&he<w&&pe>=0&&pe<w&&A-C>=0&&A+C<=S){const de=new ba(he,pe,0,ie,N);de._round(),l&&!Xm(i,de,p,l,h)||O.push(de)}}I+=J}return v||O.length||_||(O=Jm(i,I/2,s,l,h,p,_,!0,w)),O}function Jp(i,n,s,l,h){const p=[];for(let _=0;_<i.length;_++){const v=i[_];let w;for(let C=0;C<v.length-1;C++){let S=v[C],I=v[C+1];S.x<n&&I.x<n||(S.x<n?S=new Ke(n,S.y+(n-S.x)/(I.x-S.x)*(I.y-S.y))._round():I.x<n&&(I=new Ke(n,S.y+(n-S.x)/(I.x-S.x)*(I.y-S.y))._round()),S.y<s&&I.y<s||(S.y<s?S=new Ke(S.x+(s-S.y)/(I.y-S.y)*(I.x-S.x),s)._round():I.y<s&&(I=new Ke(S.x+(s-S.y)/(I.y-S.y)*(I.x-S.x),s)._round()),S.x>=l&&I.x>=l||(S.x>=l?S=new Ke(l,S.y+(l-S.x)/(I.x-S.x)*(I.y-S.y))._round():I.x>=l&&(I=new Ke(l,S.y+(l-S.x)/(I.x-S.x)*(I.y-S.y))._round()),S.y>=h&&I.y>=h||(S.y>=h?S=new Ke(S.x+(h-S.y)/(I.y-S.y)*(I.x-S.x),h)._round():I.y>=h&&(I=new Ke(S.x+(h-S.y)/(I.y-S.y)*(I.x-S.x),h)._round()),w&&S.equals(w[w.length-1])||(w=[S],p.push(w)),w.push(I)))))}}return p}Xe("Anchor",ba);const ph=1e20;function Ym(i,n,s,l,h,p,_,v,w){for(let C=n;C<n+l;C++)Fo(i,s*p+C,p,h,_,v,w);for(let C=s;C<s+h;C++)Fo(i,C*p+n,1,l,_,v,w)}function Fo(i,n,s,l,h,p,_){p[0]=0,_[0]=-ph,_[1]=ph,h[0]=i[n];for(let v=1,w=0,C=0;v<l;v++){h[v]=i[n+v*s];const S=v*v;do{const I=p[w];C=(h[v]-h[I]+S-I*I)/(v-I)/2}while(C<=_[w]&&--w>-1);w++,p[w]=v,_[w]=C,_[w+1]=ph}for(let v=0,w=0;v<l;v++){for(;_[w+1]<v;)w++;const C=p[w],S=v-C;i[n+v*s]=h[C]+S*S}}const Yp={none:0,ideographs:1,all:2};class ec{constructor(n,s,l){this.requestManager=n,this.localGlyphMode=s,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n){this.url=n}getGlyphs(n,s){const l=[];for(const h in n)for(const p of n[h])l.push({stack:h,id:p});Ba(l,({stack:h,id:p},_)=>{let v=this.entries[h];v||(v=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=v.glyphs[p];if(void 0!==w)return void _(null,{stack:h,id:p,glyph:w});if(w=this._tinySDF(v,h,p),w)return v.glyphs[p]=w,void _(null,{stack:h,id:p,glyph:w});const C=Math.floor(p/256);if(256*C>65535)return void _(new Error("glyphs > 65535 not supported"));if(v.ranges[C])return void _(null,{stack:h,id:p,glyph:w});let S=v.requests[C];S||(S=v.requests[C]=[],ec.loadGlyphRange(h,C,this.url,this.requestManager,(I,A)=>{if(A){v.ascender=A.ascender,v.descender=A.descender;for(const O in A.glyphs)this._doesCharSupportLocalGlyph(+O)||(v.glyphs[+O]=A.glyphs[+O]);v.ranges[C]=!0}for(const O of S)O(I,A);delete v.requests[C]})),S.push((I,A)=>{I?_(I):A&&_(null,{stack:h,id:p,glyph:A.glyphs[p]||null})})},(h,p)=>{if(h)s(h);else if(p){const _={};for(const{stack:v,id:w,glyph:C}of p)void 0===_[v]&&(_[v]={}),void 0===_[v].glyphs&&(_[v].glyphs={}),_[v].glyphs[w]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},_[v].ascender=this.entries[v].ascender,_[v].descender=this.entries[v].descender;s(null,_)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==Yp.none&&(this.localGlyphMode===Yp.all?!!this.localFontFamily:!!this.localFontFamily&&($(n)||te(n)||P(n)||F(n))||T(n))}_tinySDF(n,s,l){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let p=n.tinySDF;if(!p){let U="400";/bold/i.test(s)?U="900":/medium/i.test(s)?U="500":/light/i.test(s)&&(U="200"),p=n.tinySDF=new ec.TinySDF({fontFamily:h,fontWeight:U,fontSize:48,buffer:6,radius:16}),p.fontWeight=U}if(this.localGlyphs[p.fontWeight][l])return this.localGlyphs[p.fontWeight][l];const _=String.fromCharCode(l),{data:v,width:w,height:C,glyphWidth:S,glyphHeight:I,glyphLeft:A,glyphTop:O,glyphAdvance:N}=p.draw(_);return this.localGlyphs[p.fontWeight][l]={id:l,bitmap:new Wl({width:w,height:C},v),metrics:{width:S/2,height:I/2,left:A/2,top:O/2-27,advance:N/2,localGlyph:!0}}}}function Qm(i,n,s,l){const h=[],p=i.image,_=p.pixelRatio,v=p.paddedRect.w-2,w=p.paddedRect.h-2,C=i.right-i.left,S=i.bottom-i.top,I=p.stretchX||[[0,v]],A=p.stretchY||[[0,w]],O=(De,Ve)=>De+Ve[1]-Ve[0],N=I.reduce(O,0),U=A.reduce(O,0),q=v-N,J=w-U;let ie=0,ce=N,he=0,pe=U,de=0,Ce=q,we=0,Ge=J;if(p.content&&l){const De=p.content;ie=wd(I,0,De[0]),he=wd(A,0,De[1]),ce=wd(I,De[0],De[2]),pe=wd(A,De[1],De[3]),de=De[0]-ie,we=De[1]-he,Ce=De[2]-De[0]-ce,Ge=De[3]-De[1]-pe}const Be=(De,Ve,Ze,Pe)=>{const We=Ed(De.stretch-ie,ce,C,i.left),Qe=fh(De.fixed-de,Ce,De.stretch,N),Nt=Ed(Ve.stretch-he,pe,S,i.top),mn=fh(Ve.fixed-we,Ge,Ve.stretch,U),Gt=Ed(Ze.stretch-ie,ce,C,i.left),$t=fh(Ze.fixed-de,Ce,Ze.stretch,N),Ne=Ed(Pe.stretch-he,pe,S,i.top),rn=fh(Pe.fixed-we,Ge,Pe.stretch,U),Kt=new Ke(We,Nt),Qn=new Ke(Gt,Nt),Bn=new Ke(Gt,Ne),Fr=new Ke(We,Ne),Gr=new Ke(Qe/_,mn/_),on=new Ke($t/_,rn/_),Vt=n*Math.PI/180;if(Vt){const Vn=Math.sin(Vt),cr=Math.cos(Vt),Rr=[cr,-Vn,Vn,cr];Kt._matMult(Rr),Qn._matMult(Rr),Fr._matMult(Rr),Bn._matMult(Rr)}const Nn=De.stretch+De.fixed,lr=Ve.stretch+Ve.fixed;return{tl:Kt,tr:Qn,bl:Fr,br:Bn,tex:{x:p.paddedRect.x+1+Nn,y:p.paddedRect.y+1+lr,w:Ze.stretch+Ze.fixed-Nn,h:Pe.stretch+Pe.fixed-lr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Gr,pixelOffsetBR:on,minFontScaleX:Ce/_/C,minFontScaleY:Ge/_/S,isSDF:s}};if(l&&(p.stretchX||p.stretchY)){const De=eg(I,q,N),Ve=eg(A,J,U);for(let Ze=0;Ze<De.length-1;Ze++){const Pe=De[Ze],We=De[Ze+1];for(let Qe=0;Qe<Ve.length-1;Qe++)h.push(Be(Pe,Ve[Qe],We,Ve[Qe+1]))}}else h.push(Be({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return h}function wd(i,n,s){let l=0;for(const h of i)l+=Math.max(n,Math.min(s,h[1]))-Math.max(n,Math.min(s,h[0]));return l}function eg(i,n,s){const l=[{fixed:-1,stretch:0}];for(const[h,p]of i){const _=l[l.length-1];l.push({fixed:h-_.stretch,stretch:_.stretch}),l.push({fixed:h-_.stretch,stretch:_.stretch+(p-h)})}return l.push({fixed:n+1,stretch:s}),l}function Ed(i,n,s,l){return i/n*s+l}function fh(i,n,s,l){return i-n*s/l}function uy(i,n,s,l){const h=n+i.positionedLines[l].lineOffset;return 0===l?s+h/2:s+(h+(n+i.positionedLines[l-1].lineOffset))/2}ec.loadGlyphRange=function(i,n,s,l,h){const p=256*n,_=p+255,v=l.transformRequest(l.normalizeGlyphsURL(s).replace("{fontstack}",i).replace("{range}",`${p}-${_}`),ja.Glyphs);Ua(v,(w,C)=>{if(w)h(w);else if(C){const S={},I=new Kl(C).readFields(qm,{});for(const A of I.glyphs)S[A.id]=A;h(null,{glyphs:S,ascender:I.ascender,descender:I.descender})}})},ec.TinySDF=class{constructor({fontSize:i=24,buffer:n=3,radius:s=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:_="normal"}){this.buffer=n,this.cutoff=l,this.radius=s;const v=this.size=i+4*n,w=this._createCanvas(v),C=this.ctx=w.getContext("2d",{willReadFrequently:!0});C.font=`${_} ${p} ${i}px ${h}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(i){const n=document.createElement("canvas");return n.width=n.height=i,n}draw(i){const{width:n,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(i),_=Math.floor(s),v=Math.min(this.size-this.buffer,Math.ceil(p-h)),w=Math.min(this.size-this.buffer,Math.ceil(s)+Math.ceil(l)),C=v+2*this.buffer,S=w+2*this.buffer,I=C*S,A=new Uint8ClampedArray(I),O={data:A,width:C,height:S,glyphWidth:v,glyphHeight:w,glyphTop:_,glyphLeft:0,glyphAdvance:n};if(0===v||0===w)return O;const{ctx:N,buffer:U,gridInner:q,gridOuter:J}=this;N.clearRect(U,U,v,w),N.fillText(i,U,U+_+1);const ie=N.getImageData(U,U,v,w);J.fill(ph,0,I),q.fill(0,0,I);for(let ce=0;ce<w;ce++)for(let he=0;he<v;he++){const pe=ie.data[4*(ce*v+he)+3]/255;if(0===pe)continue;const de=(ce+U)*C+he+U;if(1===pe)J[de]=0,q[de]=ph;else{const Ce=.5-pe;J[de]=Ce>0?Ce*Ce:0,q[de]=Ce<0?Ce*Ce:0}}Ym(J,0,0,C,S,C,this.f,this.v,this.z),Ym(q,U,U,v,w,C,this.f,this.v,this.z);for(let ce=0;ce<I;ce++){const he=Math.sqrt(J[ce])-Math.sqrt(q[ce]);A[ce]=Math.round(255-255*(he/this.radius+this.cutoff))}return O}};class hy{constructor(n=[],s=dy){if(this.data=n,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const n=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:s,compare:l}=this,h=s[n];for(;n>0;){const p=n-1>>1,_=s[p];if(l(h,_)>=0)break;s[n]=_,n=p}s[n]=h}_down(n){const{data:s,compare:l}=this,h=this.length>>1,p=s[n];for(;n<h;){let _=1+(n<<1),v=s[_];const w=_+1;if(w<this.length&&l(s[w],v)<0&&(_=w,v=s[w]),l(v,p)>=0)break;s[n]=v,n=_}s[n]=p}}function dy(i,n){return i<n?-1:i>n?1:0}function At(i,n=1,s=!1){let l=1/0,h=1/0,p=-1/0,_=-1/0;const v=i[0];for(let O=0;O<v.length;O++){const N=v[O];(!O||N.x<l)&&(l=N.x),(!O||N.y<h)&&(h=N.y),(!O||N.x>p)&&(p=N.x),(!O||N.y>_)&&(_=N.y)}const w=Math.min(p-l,_-h);let C=w/2;const S=new hy([],si);if(0===w)return new Ke(l,h);for(let O=l;O<p;O+=w)for(let N=h;N<_;N+=w)S.push(new tc(O+C,N+C,C,i));let I=function(O){let N=0,U=0,q=0;const J=O[0];for(let ie=0,ce=J.length,he=ce-1;ie<ce;he=ie++){const pe=J[ie],de=J[he],Ce=pe.x*de.y-de.x*pe.y;U+=(pe.x+de.x)*Ce,q+=(pe.y+de.y)*Ce,N+=3*Ce}return new tc(U/N,q/N,0,O)}(i),A=S.length;for(;S.length;){const O=S.pop();(O.d>I.d||!I.d)&&(I=O,s&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,A)),O.max-I.d<=n||(C=O.h/2,S.push(new tc(O.p.x-C,O.p.y-C,C,i)),S.push(new tc(O.p.x+C,O.p.y-C,C,i)),S.push(new tc(O.p.x-C,O.p.y+C,C,i)),S.push(new tc(O.p.x+C,O.p.y+C,C,i)),A+=4)}return s&&(console.log(`num probes: ${A}`),console.log(`best distance: ${I.d}`)),I.p}function si(i,n){return n.max-i.max}function tc(i,n,s,l){this.p=new Ke(i,n),this.h=s,this.d=function(h,p){let _=!1,v=1/0;for(let w=0;w<p.length;w++){const C=p[w];for(let S=0,I=C.length,A=I-1;S<I;A=S++){const O=C[S],N=C[A];O.y>h.y!=N.y>h.y&&h.x<(N.x-O.x)*(h.y-O.y)/(N.y-O.y)+O.x&&(_=!_),v=Math.min(v,Zl(h,O,N))}}return(_?1:-1)*Math.sqrt(v)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}const Cd=Number.POSITIVE_INFINITY,Dd=Math.sqrt(2);function Ro(i,n){return n[1]!==Cd?function(s,l,h){let p=0,_=0;switch(l=Math.abs(l),h=Math.abs(h),s){case"top-right":case"top-left":case"top":_=h-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-h}switch(s){case"top-right":case"bottom-right":case"right":p=-l;break;case"top-left":case"bottom-left":case"left":p=l}return[p,_]}(i,n[0],n[1]):function(s,l){let h=0,p=0;l<0&&(l=0);const _=l/Dd;switch(s){case"top-right":case"top-left":p=_-7;break;case"bottom-right":case"bottom-left":p=7-_;break;case"bottom":p=7-l;break;case"top":p=l-7}switch(s){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=l;break;case"right":h=-l}return[h,p]}(i,n[0])}function tg(i,n,s,l,h,p,_,v,w,C){i.createArrays(),i.tilePixelRatio=Rt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const S=i.layers[0].layout,I=i.layers[0]._unevaluatedLayout._values,A={};if("composite"===i.textSizeData.kind){const{minZoom:U,maxZoom:q}=i.textSizeData;A.compositeTextSizes=[I["text-size"].possiblyEvaluate(new ft(U),v),I["text-size"].possiblyEvaluate(new ft(q),v)]}if("composite"===i.iconSizeData.kind){const{minZoom:U,maxZoom:q}=i.iconSizeData;A.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new ft(U),v),I["icon-size"].possiblyEvaluate(new ft(q),v)]}A.layoutTextSize=I["text-size"].possiblyEvaluate(new ft(w+1),v),A.layoutIconSize=I["icon-size"].possiblyEvaluate(new ft(w+1),v),A.textMaxSize=I["text-size"].possiblyEvaluate(new ft(18),v);const O="map"===S.get("text-rotation-alignment")&&"point"!==S.get("symbol-placement"),N=S.get("text-size");for(const U of i.features){const q=S.get("text-font").evaluate(U,{},v).join(","),J=N.evaluate(U,{},v),ie=A.layoutTextSize.evaluate(U,{},v),ce=(A.layoutIconSize.evaluate(U,{},v),{horizontal:{},vertical:void 0}),he=U.text;let pe,de=[0,0];if(he){const Ge=he.toString(),Be=24*S.get("text-letter-spacing").evaluate(U,{},v),De=24*S.get("text-line-height").evaluate(U,{},v),Ve=ve(Ge)?Be:0,Ze=S.get("text-anchor").evaluate(U,{},v),Pe=S.get("text-variable-anchor");if(!Pe){const $t=S.get("text-radial-offset").evaluate(U,{},v);de=$t?Ro(Ze,[24*$t,Cd]):S.get("text-offset").evaluate(U,{},v).map(Ne=>24*Ne)}let We=O?"center":S.get("text-justify").evaluate(U,{},v);const Qe=S.get("symbol-placement"),Nt="point"===Qe,mn="point"===Qe?24*S.get("text-max-width").evaluate(U,{},v):0,Gt=$t=>{i.allowVerticalPlacement&&be(Ge)&&(ce.vertical=_d(he,n,s,h,q,mn,De,Ze,$t,Ve,de,vi.vertical,!0,Qe,ie,J))};if(!O&&Pe){const $t="auto"===We?Pe.map(rn=>Qp(rn)):[We];let Ne=!1;for(let rn=0;rn<$t.length;rn++){const Kt=$t[rn];if(!ce.horizontal[Kt])if(Ne)ce.horizontal[Kt]=ce.horizontal[0];else{const Qn=_d(he,n,s,h,q,mn,De,"center",Kt,Ve,de,vi.horizontal,!1,Qe,ie,J);Qn&&(ce.horizontal[Kt]=Qn,Ne=1===Qn.positionedLines.length)}}Gt("left")}else{if("auto"===We&&(We=Qp(Ze)),Nt||S.get("text-writing-mode").indexOf("horizontal")>=0||!be(Ge)){const $t=_d(he,n,s,h,q,mn,De,Ze,We,Ve,de,vi.horizontal,!1,Qe,ie,J);$t&&(ce.horizontal[We]=$t)}Gt("point"===Qe?"left":We)}}let Ce=!1;if(U.icon&&U.icon.name){const Ge=l[U.icon.name];Ge&&(pe=cy(h[U.icon.name],S.get("icon-offset").evaluate(U,{},v),S.get("icon-anchor").evaluate(U,{},v)),Ce=Ge.sdf,void 0===i.sdfIcons?i.sdfIcons=Ge.sdf:i.sdfIcons!==Ge.sdf&&An("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ge.pixelRatio!==i.pixelRatio||0!==S.get("icon-rotate").constantOr(1))&&(i.iconsNeedLinear=!0))}const we=tf(ce.horizontal)||ce.vertical;i.iconsInText||(i.iconsInText=!!we&&we.iconsInText),(we||pe)&&ef(i,U,ce,pe,l,A,ie,0,de,Ce,_,v,C)}p&&i.generateCollisionDebugBuffers(w,i.collisionBoxArray)}function Qp(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ef(i,n,s,l,h,p,_,v,w,C,S,I,A){let O=p.textMaxSize.evaluate(n,{},I);void 0===O&&(O=_);const N=i.layers[0].layout,U=N.get("icon-offset").evaluate(n,{},I),q=tf(s.horizontal)||s.vertical,J=_/24,ie=i.tilePixelRatio*O/24,ce=i.tilePixelRatio*N.get("symbol-spacing"),he=N.get("text-padding")*i.tilePixelRatio,pe=N.get("icon-padding")*i.tilePixelRatio,de=Ot(N.get("text-max-angle")),Ce="map"===N.get("text-rotation-alignment")&&"point"!==N.get("symbol-placement"),we="map"===N.get("icon-rotation-alignment")&&"point"!==N.get("symbol-placement"),Ge=N.get("symbol-placement"),Be=ce/2,De=N.get("icon-text-fit");let Ve;l&&"none"!==De&&(i.allowVerticalPlacement&&s.vertical&&(Ve=Wp(l,s.vertical,De,N.get("icon-text-fit-padding"),U,J)),q&&(l=Wp(l,q,De,N.get("icon-text-fit-padding"),U,J)));const Ze=(Pe,We,Qe)=>{if(We.x<0||We.x>=Rt||We.y<0||We.y>=Rt)return;const{x:Nt,y:mn,z:Gt}=A.projectTilePoint(We.x,We.y,Qe),$t=new ba(Nt,mn,Gt,0,void 0);!function(Ne,rn,Kt,Qn,Bn,Fr,Gr,on,Vt,Nn,lr,Vn,cr,Rr,wi,Ji,Jt,Lr,hs,Mr,dn,_r,Ln,Ei,ur){const St=Ne.addToLineVertexArray(rn,Qn);let Ci,$r,Sr,ds,lu,Eh,Ch,vg=0,Dh=0,hc=0,xg=0,dc=-1,Mf=-1;const Fs={};let Vd=Zu(""),zo=0,pc=0;if(void 0===Vt._unevaluatedLayout.getValue("text-radial-offset")?[zo,pc]=Vt.layout.get("text-offset").evaluate(dn,{},ur).map(Gn=>24*Gn):(zo=24*Vt.layout.get("text-radial-offset").evaluate(dn,{},ur),pc=Cd),Ne.allowVerticalPlacement&&Bn.vertical){const Gn=Bn.vertical;if(wi)Eh=ng(Gn),on&&(Ch=ng(on));else{const hr=Vt.layout.get("text-rotate").evaluate(dn,{},ur)+90;Sr=iu(Nn,Kt,rn,lr,Vn,cr,Gn,Rr,hr,Ji),on&&(ds=iu(Nn,Kt,rn,lr,Vn,cr,on,Lr,hr))}}if(Fr){const Gn=Vt.layout.get("icon-rotate").evaluate(dn,{},ur),hr="none"!==Vt.layout.get("icon-text-fit"),Rs=Qm(Fr,Gn,Ln,hr),ml=on?Qm(on,Gn,Ln,hr):void 0;$r=iu(Nn,Kt,rn,lr,Vn,cr,Fr,Lr,Gn),vg=4*Rs.length;const fc=Ne.iconSizeData;let Bo=null;"source"===fc.kind?(Bo=[cs*Vt.layout.get("icon-size").evaluate(dn,{},ur)],Bo[0]>xi&&An(`${Ne.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===fc.kind&&(Bo=[cs*_r.compositeIconSizes[0].evaluate(dn,{},ur),cs*_r.compositeIconSizes[1].evaluate(dn,{},ur)],(Bo[0]>xi||Bo[1]>xi)&&An(`${Ne.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ne.addSymbols(Ne.icon,Rs,Bo,Mr,hs,dn,!1,Kt,rn,St.lineStartIndex,St.lineLength,-1,Ei,ur),dc=Ne.icon.placedSymbolArray.length-1,ml&&(Dh=4*ml.length,Ne.addSymbols(Ne.icon,ml,Bo,Mr,hs,dn,vi.vertical,Kt,rn,St.lineStartIndex,St.lineLength,-1,Ei,ur),Mf=Ne.icon.placedSymbolArray.length-1)}for(const Gn in Bn.horizontal){const hr=Bn.horizontal[Gn];Ci||(Vd=Zu(hr.text),wi?lu=ng(hr):Ci=iu(Nn,Kt,rn,lr,Vn,cr,hr,Rr,Vt.layout.get("text-rotate").evaluate(dn,{},ur),Ji));const Rs=1===hr.positionedLines.length;if(hc+=Td(Ne,Kt,rn,hr,Gr,Vt,wi,dn,Ji,St,Bn.vertical?vi.horizontal:vi.horizontalOnly,Rs?Object.keys(Bn.horizontal):[Gn],Fs,dc,_r,Ei,ur),Rs)break}Bn.vertical&&(xg+=Td(Ne,Kt,rn,Bn.vertical,Gr,Vt,wi,dn,Ji,St,vi.vertical,["vertical"],Fs,Mf,_r,Ei,ur));let er=-1;const Ca=(Gn,hr)=>Gn?Math.max(Gn,hr):hr;er=Ca(lu,er),er=Ca(Eh,er),er=Ca(Ch,er);const jd=er>-1?1:0;Ne.glyphOffsetArray.length>=cl.MAX_GLYPHS&&An("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==dn.sortKey&&Ne.addToSortKeyRanges(Ne.symbolInstances.length,dn.sortKey),Ne.symbolInstances.emplaceBack(Kt.x,Kt.y,Kt.z,rn.x,rn.y,Fs.right>=0?Fs.right:-1,Fs.center>=0?Fs.center:-1,Fs.left>=0?Fs.left:-1,Fs.vertical>=0?Fs.vertical:-1,dc,Mf,Vd,void 0!==Ci?Ci:Ne.collisionBoxArray.length,void 0!==Ci?Ci+1:Ne.collisionBoxArray.length,void 0!==Sr?Sr:Ne.collisionBoxArray.length,void 0!==Sr?Sr+1:Ne.collisionBoxArray.length,void 0!==$r?$r:Ne.collisionBoxArray.length,void 0!==$r?$r+1:Ne.collisionBoxArray.length,ds||Ne.collisionBoxArray.length,ds?ds+1:Ne.collisionBoxArray.length,lr,hc,xg,vg,Dh,jd,0,zo,pc,er)}(i,We,$t,Pe,s,l,h,Ve,i.layers[0],i.collisionBoxArray,n.index,n.sourceLayerIndex,i.index,he,Ce,w,0,pe,we,U,n,p,C,S,I)};if("line"===Ge)for(const Pe of Jp(n.geometry,0,0,Rt,Rt)){const We=Km(Pe,ce,de,s.vertical||q,l,24,ie,i.overscaling,Rt);for(const Qe of We){const Nt=q;Nt&&rg(i,Nt.text,Be,Qe)||Ze(Pe,Qe,I)}}else if("line-center"===Ge){for(const Pe of n.geometry)if(Pe.length>1){const We=Ix(Pe,de,s.vertical||q,l,24,ie);We&&Ze(Pe,We,I)}}else if("Polygon"===n.type)for(const Pe of Lp(n.geometry,0)){const We=At(Pe,16);Ze(Pe[0],new ba(We.x,We.y,0,0,void 0),I)}else if("LineString"===n.type)for(const Pe of n.geometry)Ze(Pe,new ba(Pe[0].x,Pe[0].y,0,0,void 0),I);else if("Point"===n.type)for(const Pe of n.geometry)for(const We of Pe)Ze([We],new ba(We.x,We.y,0,0,void 0),I)}const xi=32640;function Td(i,n,s,l,h,p,_,v,w,C,S,I,A,O,N,U,q){const J=function(he,pe,de,Ce,we,Ge,Be,De){const Ve=[];if(0===pe.positionedLines.length)return Ve;const Ze=Ce.layout.get("text-rotate").evaluate(Ge,{})*Math.PI/180,Pe=function(Gt){const $t=Gt[0],Ne=Gt[1],rn=$t*Ne;return rn>0?[$t,-Ne]:rn<0?[-$t,Ne]:0===$t?[Ne,$t]:[Ne,-$t]}(de);let We=Math.abs(pe.top-pe.bottom);for(const Gt of pe.positionedLines)We-=Gt.lineOffset;const Qe=pe.positionedLines.length,Nt=We/Qe;let mn=pe.top-de[1];for(let Gt=0;Gt<Qe;++Gt){const $t=pe.positionedLines[Gt];mn=uy(pe,Nt,mn,Gt);for(const Ne of $t.positionedGlyphs){if(!Ne.rect)continue;const rn=Ne.rect||{};let Kt=4,Qn=!0,Bn=1,Fr=0;if(Ne.imageName){const Ln=Be[Ne.imageName];if(!Ln)continue;if(Ln.sdf){An("SDF images are not supported in formatted text and will be ignored.");continue}Qn=!1,Bn=Ln.pixelRatio,Kt=1/Bn}const Gr=(we||De)&&Ne.vertical,on=Ne.metrics.advance*Ne.scale/2,Vt=Ne.metrics,Nn=Ne.rect;if(null===Nn)continue;De&&pe.verticalizable&&(Fr=Ne.imageName?on-Ne.metrics.width*Ne.scale/2:0);const lr=we?[Ne.x+on,Ne.y]:[0,0];let Vn=[0,0],cr=[0,0],Rr=!1;we||(Gr?(cr=[Ne.x+on+Pe[0],Ne.y+Pe[1]-Fr],Rr=!0):Vn=[Ne.x+on+de[0],Ne.y+de[1]-Fr]);const wi=Nn.w*Ne.scale/(Bn*(Ne.localGlyph?2:1)),Ji=Nn.h*Ne.scale/(Bn*(Ne.localGlyph?2:1));let Jt,Lr,hs,Mr;if(Gr){const Ln=Ne.y-mn,Ei=new Ke(-on,on-Ln),ur=-Math.PI/2,St=new Ke(...cr);Jt=new Ke(-on+Vn[0],Vn[1]),Jt._rotateAround(ur,Ei)._add(St),Jt.x+=-Ln+on,Jt.y-=(Vt.left-Kt)*Ne.scale;const Ci=Ne.imageName?Vt.advance*Ne.scale:24*Ne.scale,$r=String.fromCharCode(Ne.glyph);lh($r)?Jt.x+=(1-Kt)*Ne.scale:jm($r)?Jt.x+=Ci-Vt.height*Ne.scale+(-Kt-1)*Ne.scale:Jt.x+=Ne.imageName||Vt.width+2*Kt===Nn.w&&Vt.height+2*Kt===Nn.h?(Ci-Ji)/2:(Ci-(Vt.height+2*Kt)*Ne.scale)/2,Lr=new Ke(Jt.x,Jt.y-wi),hs=new Ke(Jt.x+Ji,Jt.y),Mr=new Ke(Jt.x+Ji,Jt.y-wi)}else{const Ln=(Vt.left-Kt)*Ne.scale-on+Vn[0],Ei=(-Vt.top-Kt)*Ne.scale+Vn[1],ur=Ln+wi,St=Ei+Ji;Jt=new Ke(Ln,Ei),Lr=new Ke(ur,Ei),hs=new Ke(Ln,St),Mr=new Ke(ur,St)}if(Ze){let Ln;Ln=we?new Ke(0,0):Rr?new Ke(Pe[0],Pe[1]):new Ke(de[0],de[1]),Jt._rotateAround(Ze,Ln),Lr._rotateAround(Ze,Ln),hs._rotateAround(Ze,Ln),Mr._rotateAround(Ze,Ln)}const dn=new Ke(0,0),_r=new Ke(0,0);Ve.push({tl:Jt,tr:Lr,bl:hs,br:Mr,tex:rn,writingMode:pe.writingMode,glyphOffset:lr,sectionIndex:Ne.sectionIndex,isSDF:Qn,pixelOffsetTL:dn,pixelOffsetBR:_r,minFontScaleX:0,minFontScaleY:0})}}return Ve}(0,l,w,p,_,v,h,i.allowVerticalPlacement),ie=i.textSizeData;let ce=null;"source"===ie.kind?(ce=[cs*p.layout.get("text-size").evaluate(v,{},q)],ce[0]>xi&&An(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ie.kind&&(ce=[cs*N.compositeTextSizes[0].evaluate(v,{},q),cs*N.compositeTextSizes[1].evaluate(v,{},q)],(ce[0]>xi||ce[1]>xi)&&An(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,J,ce,w,_,v,S,n,s,C.lineStartIndex,C.lineLength,O,U,q);for(const he of I)A[he]=i.text.placedSymbolArray.length-1;return 4*J.length}function tf(i){for(const n in i)return i[n];return null}function iu(i,n,s,l,h,p,_,v,w,C){let S=_.top,I=_.bottom,A=_.left,O=_.right;const N=_.collisionPadding;if(N&&(A-=N[0],S-=N[1],O+=N[2],I+=N[3]),w){const U=new Ke(A,S),q=new Ke(O,S),J=new Ke(A,I),ie=new Ke(O,I),ce=Ot(w);let he=new Ke(0,0);C&&(he=new Ke(C[0],C[1])),U._rotateAround(ce,he),q._rotateAround(ce,he),J._rotateAround(ce,he),ie._rotateAround(ce,he),A=Math.min(U.x,q.x,J.x,ie.x),O=Math.max(U.x,q.x,J.x,ie.x),S=Math.min(U.y,q.y,J.y,ie.y),I=Math.max(U.y,q.y,J.y,ie.y)}return i.emplaceBack(n.x,n.y,n.z,s.x,s.y,A,S,O,I,v,l,h,p),i.length-1}function ng(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const n=i.bottom-i.top;return n>0?Math.max(10,n):null}function rg(i,n,s,l){const h=i.compareText;if(n in h){const p=h[n];for(let _=p.length-1;_>=0;_--)if(l.dist(p[_])<s)return!0}else h[n]=[];return h[n].push(l),!1}const Ax=al.VectorTileFeature.types,Md=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function nc(i,n,s,l,h,p,_,v,w,C,S,I,A,O,N,U){const q=S?Math.min(xi,Math.round(S[0])):0,J=S?Math.min(xi,Math.round(S[1])):0;i.emplaceBack(n,s,Math.round(32*_),Math.round(32*v),w,C,(q<<1)+(I?1:0),J,16*A,16*O,256*N,256*U,l,h,p,0)}function mh(i,n,s){i.emplaceBack(n.x,n.y,s),i.emplaceBack(n.x,n.y,s),i.emplaceBack(n.x,n.y,s),i.emplaceBack(n.x,n.y,s)}function nf(i){for(const n of i.sections)if(je(n.text))return!0;return!1}class gh{constructor(n){this.layoutVertexArray=new tl,this.indexArray=new Ur,this.programConfigurations=n,this.segments=new dt,this.dynamicLayoutVertexArray=new Vc,this.opacityVertexArray=new jr,this.placedSymbolArray=new Uc}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(n,s,l,h){this.isEmpty()||(l&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Q_.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,ey.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,Md,!0),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Xe("SymbolBuffers",gh);class ig{constructor(n,s,l){this.layoutVertexArray=new n,this.layoutAttributes=s,this.indexArray=new l,this.segments=new dt,this.collisionVertexArray=new rl,this.collisionVertexArrayExt=new Vc}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,ty.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,Yc.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Xe("CollisionBuffers",ig);class cl{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(_=>_.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=hi([]),this.placementViewportMatrix=hi([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Vm(this.zoom,s["text-size"]),this.iconSizeData=Vm(this.zoom,s["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),p=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==p&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===p||"auto"===p&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(_=>vi[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=n.sourceID}createArrays(){this.text=new gh(new va(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new gh(new va(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new Jh,this.lineVertexArray=new Gc,this.symbolInstances=new Dr}calculateGlyphDependencies(n,s,l,h,p){for(let _=0;_<n.length;_++)if(s[n.charCodeAt(_)]=!0,h&&p){const v=Qc[n.charAt(_)];v&&(s[v.charCodeAt(0)]=!0)}}populate(n,s,l,h){const p=this.layers[0],_=p.layout,v=_.get("text-font"),w=_.get("text-field"),C=_.get("icon-image"),S=("constant"!==w.value.kind||w.value.value instanceof Ct&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&("constant"!==v.value.kind||v.value.value.length>0),I="constant"!==C.value.kind||!!C.value.value||Object.keys(C.parameters).length>0,A=_.get("symbol-sort-key");if(this.features=[],!S&&!I)return;const O=s.iconDependencies,N=s.glyphDependencies,U=s.availableImages,q=new ft(this.zoom);for(const{feature:J,id:ie,index:ce,sourceLayerIndex:he}of n){const pe=p._featureFilter.needGeometry,de=ql(J,pe);if(!p._featureFilter.filter(q,de,l))continue;let Ce,we;if(pe||(de.geometry=po(J,l,h)),S){const Be=p.getValueAndResolveTokens("text-field",de,l,U),De=Ct.factory(Be);nf(De)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ni()||this.hasRTLText&&Ut.isParsed())&&(Ce=ny(De,p,de))}if(I){const Be=p.getValueAndResolveTokens("icon-image",de,l,U);we=Be instanceof pr?Be:pr.fromString(Be)}if(!Ce&&!we)continue;const Ge=this.sortFeaturesByKey?A.evaluate(de,{},l):void 0;if(this.features.push({id:ie,text:Ce,icon:we,index:ce,sourceLayerIndex:he,geometry:de.geometry,properties:J.properties,type:Ax[J.type],sortKey:Ge}),we&&(O[we.name]=!0),Ce){const Be=v.evaluate(de,{},l).join(","),De="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(vi.vertical)>=0;for(const Ve of Ce.sections)if(Ve.image)O[Ve.image.name]=!0;else{const Ze=be(Ce.toString()),Pe=Ve.fontStack||Be,We=N[Pe]=N[Pe]||{};this.calculateGlyphDependencies(Ve.text,We,De,this.allowVerticalPlacement,Ze)}}}"line"===_.get("symbol-placement")&&(this.features=function(J){const ie={},ce={},he=[];let pe=0;function de(Be){he.push(J[Be]),pe++}function Ce(Be,De,Ve){const Ze=ce[Be];return delete ce[Be],ce[De]=Ze,he[Ze].geometry[0].pop(),he[Ze].geometry[0]=he[Ze].geometry[0].concat(Ve[0]),Ze}function we(Be,De,Ve){const Ze=ie[De];return delete ie[De],ie[Be]=Ze,he[Ze].geometry[0].shift(),he[Ze].geometry[0]=Ve[0].concat(he[Ze].geometry[0]),Ze}function Ge(Be,De,Ve){const Ze=Ve?De[0][De[0].length-1]:De[0][0];return`${Be}:${Ze.x}:${Ze.y}`}for(let Be=0;Be<J.length;Be++){const De=J[Be],Ve=De.geometry,Ze=De.text?De.text.toString():null;if(!Ze){de(Be);continue}const Pe=Ge(Ze,Ve),We=Ge(Ze,Ve,!0);if(Pe in ce&&We in ie&&ce[Pe]!==ie[We]){const Qe=we(Pe,We,Ve),Nt=Ce(Pe,We,he[Qe].geometry);delete ie[Pe],delete ce[We],ce[Ge(Ze,he[Nt].geometry,!0)]=Nt,he[Qe].geometry=null}else Pe in ce?Ce(Pe,We,Ve):We in ie?we(Pe,We,Ve):(de(Be),ie[Pe]=pe-1,ce[We]=pe-1)}return he.filter(Be=>Be.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ie)=>J.sortKey-ie.sortKey)}update(n,s,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,s,this.layers,l,h),this.icon.programConfigurations.updatePaintArrays(n,s,this.layers,l,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,s){const l=this.lineVertexArray.length;if(void 0!==n.segment){let h=n.dist(s[n.segment+1]),p=n.dist(s[n.segment]);const _={};for(let v=n.segment+1;v<s.length;v++)_[v]={x:s[v].x,y:s[v].y,tileUnitDistanceFromAnchor:h},v<s.length-1&&(h+=s[v+1].dist(s[v]));for(let v=n.segment||0;v>=0;v--)_[v]={x:s[v].x,y:s[v].y,tileUnitDistanceFromAnchor:p},v>0&&(p+=s[v-1].dist(s[v]));for(let v=0;v<s.length;v++){const w=_[v];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(n,s,l,h,p,_,v,w,C,S,I,A,O,N){const U=n.indexArray,q=n.layoutVertexArray,J=n.segments.prepareSegment(4*s.length,q,U,this.canOverlap?_.sortKey:void 0),ie=this.glyphOffsetArray.length,ce=J.vertexLength,he=this.allowVerticalPlacement&&v===vi.vertical?Math.PI/2:0,pe=_.text&&_.text.sections;for(let de=0;de<s.length;de++){const{tl:Ce,tr:we,bl:Ge,br:Be,tex:De,pixelOffsetTL:Ve,pixelOffsetBR:Ze,minFontScaleX:Pe,minFontScaleY:We,glyphOffset:Qe,isSDF:Nt,sectionIndex:mn}=s[de],Gt=J.vertexLength,$t=Qe[1];nc(q,w.x,w.y,w.z,C.x,C.y,Ce.x,$t+Ce.y,De.x,De.y,l,Nt,Ve.x,Ve.y,Pe,We),nc(q,w.x,w.y,w.z,C.x,C.y,we.x,$t+we.y,De.x+De.w,De.y,l,Nt,Ze.x,Ve.y,Pe,We),nc(q,w.x,w.y,w.z,C.x,C.y,Ge.x,$t+Ge.y,De.x,De.y+De.h,l,Nt,Ve.x,Ze.y,Pe,We),nc(q,w.x,w.y,w.z,C.x,C.y,Be.x,$t+Be.y,De.x+De.w,De.y+De.h,l,Nt,Ze.x,Ze.y,Pe,We),mh(n.dynamicLayoutVertexArray,w,he),U.emplaceBack(Gt,Gt+1,Gt+2),U.emplaceBack(Gt+1,Gt+2,Gt+3),J.vertexLength+=4,J.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qe[0]),de!==s.length-1&&mn===s[de+1].sectionIndex||n.programConfigurations.populatePaintArrays(q.length,_,_.index,{},O,N,pe&&pe[mn])}n.placedSymbolArray.emplaceBack(w.x,w.y,w.z,C.x,C.y,ie,this.glyphOffsetArray.length-ie,ce,S,I,C.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],v,0,!1,0,A,0)}_commitLayoutVertex(n,s,l,h,p,_,v){n.emplaceBack(s,l,h,p,_,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(n,s,l,h,p,_,v){const w=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),C=w.vertexLength,S=v.tileAnchorX,I=v.tileAnchorY;for(let O=0;O<4;O++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(s,-n.padding,-n.padding),l.collisionVertexArrayExt.emplaceBack(s,n.padding,-n.padding),l.collisionVertexArrayExt.emplaceBack(s,n.padding,n.padding),l.collisionVertexArrayExt.emplaceBack(s,-n.padding,n.padding),this._commitLayoutVertex(l.layoutVertexArray,h,p,_,S,I,new Ke(n.x1,n.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,p,_,S,I,new Ke(n.x2,n.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,p,_,S,I,new Ke(n.x2,n.y2)),this._commitLayoutVertex(l.layoutVertexArray,h,p,_,S,I,new Ke(n.x1,n.y2)),w.vertexLength+=4;const A=l.indexArray;A.emplaceBack(C,C+1),A.emplaceBack(C+1,C+2),A.emplaceBack(C+2,C+3),A.emplaceBack(C+3,C),w.primitiveLength+=4}_addTextDebugCollisionBoxes(n,s,l,h,p,_){for(let v=h;v<p;v++){const w=l.get(v),C=this.getSymbolInstanceTextSize(n,_,s,v);this._addCollisionDebugVertices(w,C,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(n,s,l,h,p,_){for(let v=h;v<p;v++){const w=l.get(v),C=this.getSymbolInstanceIconSize(n,s,v);this._addCollisionDebugVertices(w,C,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}generateCollisionDebugBuffers(n,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ig(jc,ls.members,Ul),this.iconCollisionBox=new ig(jc,ls.members,Ul);const l=ll(this.iconSizeData,n),h=ll(this.textSizeData,n);for(let p=0;p<this.symbolInstances.length;p++){const _=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(h,n,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(h,n,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,n,s,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,n,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(n,s,l,h){const p=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:h),_=yi(this.textSizeData,n,p)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(n,s,l){const h=this.icon.placedSymbolArray.get(l),p=yi(this.iconSizeData,n,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(n,s,l){n.emplaceBack(s,-l,-l),n.emplaceBack(s,l,-l),n.emplaceBack(s,l,l),n.emplaceBack(s,-l,l)}_updateTextDebugCollisionBoxes(n,s,l,h,p,_){for(let v=h;v<p;v++){const w=l.get(v),C=this.getSymbolInstanceTextSize(n,_,s,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,C,w.padding)}}_updateIconDebugCollisionBoxes(n,s,l,h,p){for(let _=h;_<p;_++){const v=l.get(_),w=this.getSymbolInstanceIconSize(n,s,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,v.padding)}}updateCollisionDebugBuffers(n,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=ll(this.iconSizeData,n),h=ll(this.textSizeData,n);for(let p=0;p<this.symbolInstances.length;p++){const _=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(h,n,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(h,n,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(l,n,s,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(l,n,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,s,l,h,p,_,v,w,C){const S={};for(let I=s;I<l;I++){const A=n.get(I);S.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},S.textFeatureIndex=A.featureIndex;break}for(let I=h;I<p;I++){const A=n.get(I);S.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},S.verticalTextFeatureIndex=A.featureIndex;break}for(let I=_;I<v;I++){const A=n.get(I);S.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},S.iconFeatureIndex=A.featureIndex;break}for(let I=w;I<C;I++){const A=n.get(I);S.verticalIconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},S.verticalIconFeatureIndex=A.featureIndex;break}return S}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,s){const l=n.placedSymbolArray.get(s),h=l.vertexStartIndex+4*l.numGlyphs;for(let p=l.vertexStartIndex;p<h;p+=4)n.indexArray.emplaceBack(p,p+1,p+2),n.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(n),l=Math.cos(n),h=[],p=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const w=this.symbolInstances.get(v);h.push(0|Math.round(s*w.tileAnchorX+l*w.tileAnchorY)),p.push(w.featureIndex)}return _.sort((v,w)=>h[v]-h[w]||p[w]-p[v]),_}addToSortKeyRanges(n,s){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const l=this.symbolInstances.get(s);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((h,p,_)=>{h>=0&&_.indexOf(h)===p&&this.addIndicesForPlacedSymbol(this.text,h)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Xe("SymbolBucket",cl,{omit:["layers","collisionBoxArray","features","compareText"]}),cl.MAX_GLYPHS=65535,cl.addDynamicAttributes=mh;const py=new sr({"symbol-placement":new nt(Ee.layout_symbol["symbol-placement"]),"symbol-spacing":new nt(Ee.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new nt(Ee.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new at(Ee.layout_symbol["symbol-sort-key"]),"symbol-z-order":new nt(Ee.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new nt(Ee.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new nt(Ee.layout_symbol["icon-ignore-placement"]),"icon-optional":new nt(Ee.layout_symbol["icon-optional"]),"icon-rotation-alignment":new nt(Ee.layout_symbol["icon-rotation-alignment"]),"icon-size":new at(Ee.layout_symbol["icon-size"]),"icon-text-fit":new nt(Ee.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new nt(Ee.layout_symbol["icon-text-fit-padding"]),"icon-image":new at(Ee.layout_symbol["icon-image"]),"icon-rotate":new at(Ee.layout_symbol["icon-rotate"]),"icon-padding":new nt(Ee.layout_symbol["icon-padding"]),"icon-keep-upright":new nt(Ee.layout_symbol["icon-keep-upright"]),"icon-offset":new at(Ee.layout_symbol["icon-offset"]),"icon-anchor":new at(Ee.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new nt(Ee.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new nt(Ee.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new nt(Ee.layout_symbol["text-rotation-alignment"]),"text-field":new at(Ee.layout_symbol["text-field"]),"text-font":new at(Ee.layout_symbol["text-font"]),"text-size":new at(Ee.layout_symbol["text-size"]),"text-max-width":new at(Ee.layout_symbol["text-max-width"]),"text-line-height":new at(Ee.layout_symbol["text-line-height"]),"text-letter-spacing":new at(Ee.layout_symbol["text-letter-spacing"]),"text-justify":new at(Ee.layout_symbol["text-justify"]),"text-radial-offset":new at(Ee.layout_symbol["text-radial-offset"]),"text-variable-anchor":new nt(Ee.layout_symbol["text-variable-anchor"]),"text-anchor":new at(Ee.layout_symbol["text-anchor"]),"text-max-angle":new nt(Ee.layout_symbol["text-max-angle"]),"text-writing-mode":new nt(Ee.layout_symbol["text-writing-mode"]),"text-rotate":new at(Ee.layout_symbol["text-rotate"]),"text-padding":new nt(Ee.layout_symbol["text-padding"]),"text-keep-upright":new nt(Ee.layout_symbol["text-keep-upright"]),"text-transform":new at(Ee.layout_symbol["text-transform"]),"text-offset":new at(Ee.layout_symbol["text-offset"]),"text-allow-overlap":new nt(Ee.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new nt(Ee.layout_symbol["text-ignore-placement"]),"text-optional":new nt(Ee.layout_symbol["text-optional"])});var rf={paint:new sr({"icon-opacity":new at(Ee.paint_symbol["icon-opacity"]),"icon-color":new at(Ee.paint_symbol["icon-color"]),"icon-halo-color":new at(Ee.paint_symbol["icon-halo-color"]),"icon-halo-width":new at(Ee.paint_symbol["icon-halo-width"]),"icon-halo-blur":new at(Ee.paint_symbol["icon-halo-blur"]),"icon-translate":new nt(Ee.paint_symbol["icon-translate"]),"icon-translate-anchor":new nt(Ee.paint_symbol["icon-translate-anchor"]),"text-opacity":new at(Ee.paint_symbol["text-opacity"]),"text-color":new at(Ee.paint_symbol["text-color"],{runtimeType:Zo,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new at(Ee.paint_symbol["text-halo-color"]),"text-halo-width":new at(Ee.paint_symbol["text-halo-width"]),"text-halo-blur":new at(Ee.paint_symbol["text-halo-blur"]),"text-translate":new nt(Ee.paint_symbol["text-translate"]),"text-translate-anchor":new nt(Ee.paint_symbol["text-translate-anchor"])}),layout:py};class og{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:ws,this.defaultValue=n}evaluate(n){if(n.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(n.formattedSection))return s.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Xe("FormatSectionOverride",og,{omit:["defaultValue"]});class _h extends Li{constructor(n){super(n,rf)}recalculate(n,s){super.recalculate(n,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const p of l)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(n,s,l,h){const p=this.layout.get(n).evaluate(s,{},l,h),_=this._unevaluatedLayout._values[n];return _.isDataDriven()||Za(_.value)||!p?p:(v=s.properties,p.replace(/{([^{}]+)}/g,(C,S)=>S in v?String(v[S]):""));var v}createBucket(n){return new cl(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of rf.paint.overridableProperties){if(!_h.hasPaintOverride(this.layout,n))continue;const s=this.paint.get(n),l=new og(s),h=new ku(l,s.property.specification);let p=null;p="constant"===s.value.kind||"source"===s.value.kind?new Xa("source",h):new Fu("composite",h,s.value.zoomStops,s.value._interpolationType),this.paint._values[n]=new ii(s.property,p,s.parameters)}}_handleOverridablePaintPropertyUpdate(n,s,l){return!(!this.layout||s.isDataDriven()||l.isDataDriven())&&_h.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,s){const l=n.get("text-field"),h=rf.paint.properties[s];let p=!1;const _=v=>{for(const w of v)if(h.overrides&&h.overrides.hasOverride(w))return void(p=!0)};if("constant"===l.value.kind&&l.value.value instanceof Ct)_(l.value.value.sections);else if("source"===l.value.kind){const v=C=>{p||(C instanceof Js&&En(C.value)===Xs?_(C.value.sections):C instanceof Do?_(C.sections):C.eachChild(v))},w=l.value;w._styleExpression&&v(w._styleExpression.expression)}return p}getProgramConfiguration(n){return new ho(this,n)}}var Px={paint:new sr({"background-color":new nt(Ee.paint_background["background-color"]),"background-pattern":new ts(Ee.paint_background["background-pattern"]),"background-opacity":new nt(Ee.paint_background["background-opacity"])})},fy={paint:new sr({"raster-opacity":new nt(Ee.paint_raster["raster-opacity"]),"raster-hue-rotate":new nt(Ee.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new nt(Ee.paint_raster["raster-brightness-min"]),"raster-brightness-max":new nt(Ee.paint_raster["raster-brightness-max"]),"raster-saturation":new nt(Ee.paint_raster["raster-saturation"]),"raster-contrast":new nt(Ee.paint_raster["raster-contrast"]),"raster-resampling":new nt(Ee.paint_raster["raster-resampling"]),"raster-fade-duration":new nt(Ee.paint_raster["raster-fade-duration"])})};class kx extends Li{constructor(n){super(n,{}),this.implementation=n}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}var sg={paint:new sr({"sky-type":new nt(Ee.paint_sky["sky-type"]),"sky-atmosphere-sun":new nt(Ee.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new nt(Ee.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new nt(Ee.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new nt(Ee.paint_sky["sky-gradient-radius"]),"sky-gradient":new co(Ee.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new nt(Ee.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new nt(Ee.paint_sky["sky-atmosphere-color"]),"sky-opacity":new nt(Ee.paint_sky["sky-opacity"])})};function Sd(i,n,s){const l=to(0,0,1),h=gu(Us());return function(p,_,v){v*=.5;var w=_[0],C=_[1],S=_[2],I=_[3],A=Math.sin(v),O=Math.cos(v);p[0]=w*O-S*A,p[1]=C*O+I*A,p[2]=S*O+w*A,p[3]=I*O-C*A}(h,h,s?-Ot(i)+Math.PI:Ot(i)),Cl(h,h,-Ot(n)),Vs(l,l,h),Ns(l,l)}const my={circle:class extends Li{constructor(i){super(i,k_)}createBucket(i){return new rd(i)}queryRadius(i){const n=i;return ol("circle-radius",this,n)+ol("circle-stroke-width",this,n)+Ku(this.paint.get("circle-translate"))}queryIntersectsFeature(i,n,s,l,h,p,_,v){const w=Sp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(n,s)+this.paint.get("circle-stroke-width").evaluate(n,s);return xm(i,l,p,_,v,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),w,C)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new ho(this,i)}},heatmap:class extends Li{createBucket(i){return new L_(i)}constructor(i){super(i,z_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){"heatmap-color"===i&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ap({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return ol("heatmap-radius",this,i)}queryIntersectsFeature(i,n,s,l,h,p,_,v){const w=this.paint.get("heatmap-radius").evaluate(n,s);return xm(i,l,p,_,v,!0,!0,new Ke(0,0),w)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new ho(this,i)}},hillshade:class extends Li{constructor(i){super(i,B_)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(i){return new ho(this,i)}},fill:class extends Li{constructor(i){super(i,rh)}getProgramIds(){const i=this.paint.get("fill-pattern"),n=i&&i.constantOr(1),s=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(i){return new ho(this,i)}recalculate(i,n){super.recalculate(i,n);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Bp(i)}queryRadius(){return Ku(this.paint.get("fill-translate"))}queryIntersectsFeature(i,n,s,l,h,p){return!i.queryGeometry.isAboveHorizon&&_m(Mp(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends Li{constructor(i){super(i,q_)}createBucket(i){return new sh(i)}queryRadius(){return Ku(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new ho(this,i)}queryIntersectsFeature(i,n,s,l,h,p,_,v,w){const C=Sp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(n,s),I=this.paint.get("fill-extrusion-base").evaluate(n,s),A=[0,0],O=v&&p.elevation,N=p.elevation?p.elevation.exaggeration():1;if(O){const J=i.tile.getBucket(this).centroidVertexArray,ie=w+1;if(ie<J.length){const ce=J.get(ie);A[0]=ce.a_centroid_pos0,A[1]=ce.a_centroid_pos1}}if(0===A[0]&&1===A[1])return!1;const U=(J=l,ie=I,ce=S,he=C,pe=_,(de=O?v:null)?function(Be,De,Ve,Ze,Pe,We,Qe,Nt,mn){const Gt=[],$t=[],Ne=[0,0,0,1];for(const rn of Be){const Kt=[],Qn=[];for(const Bn of rn){const Fr=Bn.x+Ze.x,Gr=Bn.y+Ze.y,on=ah(Fr,Gr,De,Ve,We,Qe,Nt,mn);Ne[0]=Fr,Ne[1]=Gr,Ne[2]=on.base,Ne[3]=1,zr(Ne,Ne,Pe),Ne[3]=Math.max(Ne[3],1e-5);const Vt=Lm([Ne[0]/Ne[3],Ne[1]/Ne[3],Ne[2]/Ne[3]]);Ne[0]=Fr,Ne[1]=Gr,Ne[2]=on.top,Ne[3]=1,zr(Ne,Ne,Pe),Ne[3]=Math.max(Ne[3],1e-5);const Nn=Lm([Ne[0]/Ne[3],Ne[1]/Ne[3],Ne[2]/Ne[3]]);Kt.push(Vt),Qn.push(Nn)}Gt.push(Kt),$t.push(Qn)}return[Gt,$t]}(J,ie,ce,he,pe,de,A,N,p.center.lat):function(Be,De,Ve,Ze,Pe){const We=[],Qe=[],Nt=Pe[8]*De,mn=Pe[9]*De,Gt=Pe[10]*De,$t=Pe[11]*De,Ne=Pe[8]*Ve,rn=Pe[9]*Ve,Kt=Pe[10]*Ve,Qn=Pe[11]*Ve;for(const Bn of Be){const Fr=[],Gr=[];for(const on of Bn){const Vt=on.x+Ze.x,Nn=on.y+Ze.y,lr=Pe[0]*Vt+Pe[4]*Nn+Pe[12],Vn=Pe[1]*Vt+Pe[5]*Nn+Pe[13],cr=Pe[2]*Vt+Pe[6]*Nn+Pe[14],Rr=Pe[3]*Vt+Pe[7]*Nn+Pe[15],wi=lr+Nt,Ji=Vn+mn,Jt=cr+Gt,Lr=Math.max(Rr+$t,1e-5),hs=lr+Ne,Mr=Vn+rn,dn=cr+Kt,_r=Math.max(Rr+Qn,1e-5),Ln=new Ke(wi/Lr,Ji/Lr);Ln.z=Jt/Lr,Fr.push(Ln);const Ei=new Ke(hs/_r,Mr/_r);Ei.z=dn/_r,Gr.push(Ei)}We.push(Fr),Qe.push(Gr)}return[We,Qe]}(J,ie,ce,he,pe)),q=i.queryGeometry;var J,ie,ce,he,pe,de;return function(J,ie,ce){let he=1/0;_m(ce,ie)&&(he=Rm(ce,ie[0]));for(let pe=0;pe<ie.length;pe++){const de=ie[pe],Ce=J[pe];for(let we=0;we<de.length-1;we++){const Ge=de[we],Be=[Ge,de[we+1],Ce[we+1],Ce[we],Ge];gm(ce,Be)&&(he=Math.min(he,Rm(ce,Be)))}}return he!==1/0&&he}(U[0],U[1],q.isPointQuery()?q.screenBounds:q.screenGeometry)}},line:class extends Li{constructor(i){super(i,zm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if("line-gradient"===i){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof Cs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,n){super.recalculate(i,n),this.paint._values["line-floorwidth"]=Bm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new hd(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new ho(this,i)}queryRadius(i){const n=i,s=Nm(ol("line-width",this,n),ol("line-gap-width",this,n)),l=ol("line-offset",this,n);return s/2+Math.abs(l)+Ku(this.paint.get("line-translate"))}queryIntersectsFeature(i,n,s,l,h,p){if(i.queryGeometry.isAboveHorizon)return!1;const _=Mp(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),v=i.pixelToTileUnitsFactor/2*Nm(this.paint.get("line-width").evaluate(n,s),this.paint.get("line-gap-width").evaluate(n,s)),w=this.paint.get("line-offset").evaluate(n,s);return w&&(l=function(C,S){const I=[],A=new Ke(0,0);for(let O=0;O<C.length;O++){const N=C[O],U=[];for(let q=0;q<N.length;q++){const J=N[q-1],ie=N[q],ce=N[q+1],he=0===q?A:ie.sub(J)._unit()._perp(),pe=q===N.length-1?A:ce.sub(ie)._unit()._perp(),de=he._add(pe)._unit();de._mult(1/(de.x*pe.x+de.y*pe.y)),U.push(de._mult(S)._add(ie))}I.push(U)}return I}(l,w*i.pixelToTileUnitsFactor)),function(C,S,I){for(let A=0;A<S.length;A++){const O=S[A];if(C.length>=3)for(let N=0;N<O.length;N++)if(Xc(C,O[N]))return!0;if(A_(C,O,I))return!0}return!1}(_,l,v)}isTileClipped(){return!0}},symbol:_h,background:class extends Li{constructor(i){super(i,Px)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Li{constructor(i){super(i,fy)}getProgramIds(){return["raster"]}},sky:class extends Li{constructor(i){super(i,sg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){"sky-gradient"===i?this._updateColorRamp():"sky-atmosphere-sun"!==i&&"sky-atmosphere-halo-color"!==i&&"sky-atmosphere-color"!==i&&"sky-atmosphere-sun-intensity"!==i||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ap({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}}getCenter(i,n){const s=this.paint.get("sky-type");if("atmosphere"===s){const l=this.paint.get("sky-atmosphere-sun"),h=!l,p=i.style.light,_=p.properties.get("position");return h&&"viewport"===p.properties.get("anchor")&&An("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Sd(_.azimuthal,90-_.polar,n):Sd(l[0],90-l[1],n)}if("gradient"===s){const l=this.paint.get("sky-gradient-center");return Sd(l[0],90-l[1],n)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return"atmosphere"===i?["skyboxCapture","skybox"]:"gradient"===i?["skyboxGradient"]:null}}},{HTMLImageElement:Id,HTMLCanvasElement:gy,HTMLVideoElement:_y,ImageData:yy,ImageBitmap:of}=Ae;class sf{constructor(n,s,l,h){this.context=n,this.format=l,this.texture=n.gl.createTexture(),this.update(s,h)}update(n,s,l){const{width:h,height:p}=n,{context:_}=this,{gl:v}=_;if(v.bindTexture(v.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!s||!1!==s.premultiply)),l||this.size&&this.size[0]===h&&this.size[1]===p){const{x:w,y:C}=l||{x:0,y:0};n instanceof Id||n instanceof gy||n instanceof _y||n instanceof yy||of&&n instanceof of?v.texSubImage2D(v.TEXTURE_2D,0,w,C,v.RGBA,v.UNSIGNED_BYTE,n):v.texSubImage2D(v.TEXTURE_2D,0,w,C,h,p,v.RGBA,v.UNSIGNED_BYTE,n.data)}else this.size=[h,p],n instanceof Id||n instanceof gy||n instanceof _y||n instanceof yy||of&&n instanceof of?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,n):v.texImage2D(v.TEXTURE_2D,0,this.format,h,p,0,this.format,v.UNSIGNED_BYTE,n.data);this.useMipmap=Boolean(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(n,s){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),n!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?n===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:n),this.filter=n),s!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class ag{constructor(n,s){this.width=n,this.height=s,this.nextRow=0,this.image=new Wl({width:n,height:s}),this.positions={},this.uploaded=!1}getDash(n,s){const l=this.getKey(n,s);return this.positions[l]}trim(){const n=this.width,s=this.height=Ni(this.nextRow);this.image.resize({width:n,height:s})}getKey(n,s){return n.join(",")+s}getDashRanges(n,s,l){const h=[];let p=n.length%2==1?-n[n.length-1]*l:0,_=n[0]*l,v=!0;h.push({left:p,right:_,isDash:v,zeroLength:0===n[0]});let w=n[0];for(let C=1;C<n.length;C++){v=!v;const S=n[C];p=w*l,w+=S,_=w*l,h.push({left:p,right:_,isDash:v,zeroLength:0===S})}return h}addRoundDash(n,s,l){const h=s/2;for(let p=-l;p<=l;p++){const _=this.width*(this.nextRow+l+p);let v=0,w=n[v];for(let C=0;C<this.width;C++){C/w.right>1&&(w=n[++v]);const S=Math.abs(C-w.left),I=Math.abs(C-w.right),A=Math.min(S,I);let O;const N=p/l*(h+1);if(w.isDash){const U=h-Math.abs(N);O=Math.sqrt(A*A+U*U)}else O=h-Math.sqrt(A*A+N*N);this.image.data[_+C]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(n,s){for(let w=n.length-1;w>=0;--w){const C=n[w],S=n[w+1];C.zeroLength?n.splice(w,1):S&&S.isDash===C.isDash&&(S.left=C.left,n.splice(w,1))}const l=n[0],h=n[n.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const p=this.width*this.nextRow;let _=0,v=n[_];for(let w=0;w<this.width;w++){w/v.right>1&&(v=n[++_]);const C=Math.abs(w-v.left),S=Math.abs(w-v.right),I=Math.min(C,S);this.image.data[p+w]=Math.max(0,Math.min(255,(v.isDash?I:-I)+s+128))}}addDash(n,s){const l=this.getKey(n,s);if(this.positions[l])return this.positions[l];const h="round"===s,p=h?7:0,_=2*p+1;if(this.nextRow+_>this.height)return An("LineAtlas out of space"),null;0===n.length&&n.push(1);let v=0;for(let S=0;S<n.length;S++)n[S]<0&&(An("Negative value is found in line dasharray, replacing values with 0"),n[S]=0),v+=n[S];if(0!==v){const S=this.width/v,I=this.getDashRanges(n,this.width,S);h?this.addRoundDash(I,S,p):this.addRegularDash(I,"square"===s?.5*S:0)}const w=this.nextRow+p;this.nextRow+=_;const C={tl:[w,p],br:[v,0]};return this.positions[l]=C,C}}Xe("LineAtlas",ag);class Fx{constructor(n){this._callback=n,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Rx=Ae.performance;function vy(i){const n=i?i.url.toString():void 0;return Rx.getEntriesByName(n)}class Lx{constructor(){this.tasks={},this.taskQueue=[],Ml(["process"],this),this.invoker=new Fx(this.process),this.nextId=0}add(n,s){const l=this.nextId++,h=function({type:p,isSymbolTile:_,zoom:v}){return v=v||0,"message"===p?0:"maybePrepare"!==p||_?"parseTile"!==p||_?"parseTile"===p&&_?300-v:"maybePrepare"===p&&_?400-v:500:200-v:100-v}(s);if(0===h){io();try{n()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:n,metadata:s,priority:h,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){io();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const n=this.pick();if(null===n)return;const s=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let n=null,s=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<s&&(s=p.priority,n=h)}if(null===n)return null;const l=this.taskQueue[n];return this.taskQueue.splice(n,1),l}remove(){this.invoker.remove()}}function wa(i,n,s){var l=2*Math.PI*6378137/256/Math.pow(2,s);return[i*l-2*Math.PI*6378137/2,n*l-2*Math.PI*6378137/2]}class ou{constructor(n,s,l){this.z=n,this.x=s,this.y=l,this.key=rc(0,n,n,s,l)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,s){const l=(_=this.y,v=this.z,w=wa(256*(p=this.x),256*(_=Math.pow(2,v)-_-1),v),C=wa(256*(p+1),256*(_+1),v),w[0]+","+w[1]+","+C[0]+","+C[1]),h=function(p,_,v){let w,C="";for(let S=p;S>0;S--)w=1<<S-1,C+=(_&w?1:0)+(v&w?2:0);return C}(this.z,this.x,this.y);var p,_,v,w,C;return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===s?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class af{constructor(n,s){this.wrap=n,this.canonical=s,this.key=rc(n,s.z,s.z,s.x,s.y)}}class bi{constructor(n,s,l,h,p){this.overscaledZ=n,this.wrap=s,this.canonical=new ou(l,+h,+p),this.key=0===s&&n===l?this.canonical.key:rc(s,n,l,h,p)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const s=this.canonical.z-n;return n>this.canonical.z?new bi(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new bi(n,this.wrap,n,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(n,s=!0){if(this.overscaledZ===n&&s)return this.key;if(n>this.canonical.z)return rc(this.wrap*+s,n,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-n;return rc(this.wrap*+s,n,n,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const s=this.canonical.z-n.canonical.z;return 0===n.overscaledZ||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>s&&n.canonical.y===this.canonical.y>>s}children(n){if(this.overscaledZ>=n)return[new bi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new bi(s,this.wrap,s,l,h),new bi(s,this.wrap,s,l+1,h),new bi(s,this.wrap,s,l,h+1),new bi(s,this.wrap,s,l+1,h+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new bi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new bi(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new af(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function rc(i,n,s,l,h){const p=1<<Math.min(s,22);let _=p*(h%p)+l%p;return i&&s<22&&(_+=p*p*((i<0?-2*i-1:2*i)%(1<<2*(22-s)))),16*(32*_+s)+(n-s)}Xe("CanonicalTileID",ou),Xe("OverscaledTileID",bi,{omit:["projMatrix"]});class ic{constructor(n,s,l){this.func=n,this.mask=s,this.range=l}}ic.ReadOnly=!1,ic.ReadWrite=!0,ic.disabled=new ic(519,ic.ReadOnly,[0,1]);class lf{constructor(n,s,l,h,p,_){this.test=n,this.ref=s,this.mask=l,this.fail=h,this.depthFail=p,this.pass=_}}lf.disabled=new lf({func:519,mask:0},0,0,7680,7680,7680);class ai{constructor(n,s,l){this.blendFunction=n,this.blendColor=s,this.mask=l}}ai.Replace=[1,0],ai.disabled=new ai(ai.Replace,Wt.transparent,[!1,!1,!1,!1]),ai.unblended=new ai(ai.Replace,Wt.transparent,[!0,!0,!0,!0]),ai.alphaBlended=new ai([1,771],Wt.transparent,[!0,!0,!0,!0]);class fo{constructor(n,s,l){this.enable=n,this.mode=s,this.frontFace=l}}fo.disabled=new fo(!1,1029,2305),fo.backCCW=new fo(!0,1029,2305),fo.backCW=new fo(!0,1029,2304),fo.frontCW=new fo(!0,1028,2304),fo.frontCCW=new fo(!0,1028,2305);class lg{constructor(n){this._stringToNumber={},this._numberToString=[];for(let s=0;s<n.length;s++){const l=n[s];this._stringToNumber[l]=s,this._numberToString[s]=l}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}class uf{constructor(n,s,l,h,p){this.type="Feature",this._vectorTileFeature=n,n._z=s,n._x=l,n._y=h,this.properties=n.properties,this.id=p}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const s in this)"_geometry"!==s&&"_vectorTileFeature"!==s&&(n[s]=this[s]);return n}}class xy{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,s,l){const h=String(s);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][h]=this.stateChanges[n][h]||{},Un(this.stateChanges[n][h],l),null===this.deletedStates[n]){this.deletedStates[n]={};for(const p in this.state[n])p!==h&&(this.deletedStates[n][p]=null)}else if(this.deletedStates[n]&&null===this.deletedStates[n][h]){this.deletedStates[n][h]={};for(const p in this.state[n][h])l[p]||(this.deletedStates[n][h][p]=null)}else for(const p in l)this.deletedStates[n]&&this.deletedStates[n][h]&&null===this.deletedStates[n][h][p]&&delete this.deletedStates[n][h][p]}removeFeatureState(n,s,l){if(null===this.deletedStates[n])return;const h=String(s);if(this.deletedStates[n]=this.deletedStates[n]||{},l&&void 0!==s)null!==this.deletedStates[n][h]&&(this.deletedStates[n][h]=this.deletedStates[n][h]||{},this.deletedStates[n][h][l]=null);else if(void 0!==s)if(this.stateChanges[n]&&this.stateChanges[n][h])for(l in this.deletedStates[n][h]={},this.stateChanges[n][h])this.deletedStates[n][h][l]=null;else this.deletedStates[n][h]=null;else this.deletedStates[n]=null}getState(n,s){const l=String(s),h=Un({},(this.state[n]||{})[l],(this.stateChanges[n]||{})[l]);if(null===this.deletedStates[n])return{};if(this.deletedStates[n]){const p=this.deletedStates[n][s];if(null===p)return{};for(const _ in p)delete h[_]}return h}initializeTileState(n,s){n.setFeatureState(this.state,s)}coalesceChanges(n,s){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const p={};for(const _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),Un(this.state[h][_],this.stateChanges[h][_]),p[_]=this.state[h][_];l[h]=p}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const p={};if(null===this.deletedStates[h])for(const _ in this.state[h])p[_]={},this.state[h][_]={};else for(const _ in this.deletedStates[h]){if(null===this.deletedStates[h][_])this.state[h][_]={};else for(const v of Object.keys(this.deletedStates[h][_]))delete this.state[h][_][v];p[_]=this.state[h][_]}l[h]=l[h]||{},Un(l[h],p)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(l).length)for(const h in n)n[h].setFeatureState(l,s)}}class cg{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,s){const l=this.toIdx(n,s);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(n,s){return this.leaves[this.toIdx(n,s)]}toIdx(n,s){return s*this.size+n}}function su(i,n,s,l){let h=0,p=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(l[_])<1e-15){if(s[_]<i[_]||s[_]>n[_])return null}else{const v=1/l[_];let w=(i[_]-s[_])*v,C=(n[_]-s[_])*v;if(w>C){const S=w;w=C,C=S}if(w>h&&(h=w),C<p&&(p=C),h>p)return null}return h}function oc(i,n,s,l,h,p,_,v,w,C,S){const I=l-i,A=h-n,O=p-s,N=_-i,U=v-n,q=w-s,J=S[1]*q-S[2]*U,ie=S[2]*N-S[0]*q,ce=S[0]*U-S[1]*N,he=I*J+A*ie+O*ce;if(Math.abs(he)<1e-15)return null;const pe=1/he,de=C[0]-i,Ce=C[1]-n,we=C[2]-s,Ge=(de*J+Ce*ie+we*ce)*pe;if(Ge<0||Ge>1)return null;const Be=Ce*O-we*A,De=we*I-de*O,Ve=de*A-Ce*I,Ze=(S[0]*Be+S[1]*De+S[2]*Ve)*pe;return Ze<0||Ge+Ze>1?null:(N*Be+U*De+q*Ve)*pe}function Pd(i,n,s){return(i-n)/(s-n)}function sc(i,n,s,l,h,p,_,v,w){const C=1<<s,S=p-l,I=_-h,A=(i+1)/C*S+l,O=(n+0)/C*I+h,N=(n+1)/C*I+h;v[0]=(i+0)/C*S+l,v[1]=O,w[0]=A,w[1]=N}class au{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(p){const _=Math.ceil(Math.log2(p.dim/8)),v=[];let w=Math.ceil(Math.pow(2,_));const C=1/w,S=(O,N,U,q,J)=>{const ie=q?1:0,ce=(O+1)*U-ie,he=N*U,pe=(N+1)*U-ie;J[0]=O*U,J[1]=he,J[2]=ce,J[3]=pe};let I=new cg(w);const A=[];for(let O=0;O<w*w;O++){S(O%w,Math.floor(O/w),C,!1,A);const N=ul(A[0],A[1],p),U=ul(A[2],A[1],p),q=ul(A[2],A[3],p),J=ul(A[0],A[3],p);I.minimums.push(Math.min(N,U,q,J)),I.maximums.push(Math.max(N,U,q,J)),I.leaves.push(1)}for(v.push(I),w/=2;w>=1;w/=2){const O=v[v.length-1];I=new cg(w);for(let N=0;N<w*w;N++){S(N%w,Math.floor(N/w),2,!0,A);const U=O.getElevation(A[0],A[1]),q=O.getElevation(A[2],A[1]),J=O.getElevation(A[2],A[3]),ie=O.getElevation(A[0],A[3]),ce=O.isLeaf(A[0],A[1]),he=O.isLeaf(A[2],A[1]),pe=O.isLeaf(A[2],A[3]),de=O.isLeaf(A[0],A[3]),Ce=Math.min(U.min,q.min,J.min,ie.min),we=Math.max(U.max,q.max,J.max,ie.max),Ge=ce&&he&&pe&&de;I.maximums.push(we),I.minimums.push(Ce),I.leaves.push(we-Ce<=5&&Ge?1:0)}v.push(I)}return v}(this.dem),l=s.length-1,h=s[l];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(s,0,0,l,0)}raycastRoot(n,s,l,h,p,_,v=1){return su([n,s,-100],[l,h,this.maximums[0]*v],p,_)}raycast(n,s,l,h,p,_,v=1){if(!this.nodeCount)return null;const w=this.raycastRoot(n,s,l,h,p,_,v);if(null==w)return null;const C=[],S=[],I=[],A=[],O=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:N,t:U,nodex:q,nodey:J,depth:ie}=O.pop();if(this.leaves[N]){sc(q,J,ie,n,s,l,h,I,A);const he=1<<ie,pe=(q+0)/he,de=(q+1)/he,Ce=(J+0)/he,we=(J+1)/he,Ge=ul(pe,Ce,this.dem)*v,Be=ul(de,Ce,this.dem)*v,De=ul(de,we,this.dem)*v,Ve=ul(pe,we,this.dem)*v,Ze=oc(I[0],I[1],Ge,A[0],I[1],Be,A[0],A[1],De,p,_),Pe=oc(A[0],A[1],De,I[0],A[1],Ve,I[0],I[1],Ge,p,_),We=Math.min(null!==Ze?Ze:Number.MAX_VALUE,null!==Pe?Pe:Number.MAX_VALUE);if(We!==Number.MAX_VALUE)return We;{const Qe=xn([],p,_,U);if(ac(Ge,Be,Ve,De,Pd(Qe[0],I[0],A[0]),Pd(Qe[1],I[1],A[1]))>=Qe[2])return U}continue}let ce=0;for(let he=0;he<this._siblingOffset.length;he++){sc((q<<1)+this._siblingOffset[he][0],(J<<1)+this._siblingOffset[he][1],ie+1,n,s,l,h,I,A),I[2]=-100,A[2]=this.maximums[this.childOffsets[N]+he]*v;const pe=su(I,A,p,_);if(null!=pe){const de=pe;C[he]=de;let Ce=!1;for(let we=0;we<ce&&!Ce;we++)de>=C[S[we]]&&(S.splice(we,0,he),Ce=!0);Ce||(S[ce]=he),ce++}}for(let he=0;he<ce;he++){const pe=S[he];O.push({idx:this.childOffsets[N]+pe,t:C[pe],nodex:(q<<1)+this._siblingOffset[pe][0],nodey:(J<<1)+this._siblingOffset[pe][1],depth:ie+1})}}return null}_addNode(n,s,l){return this.minimums.push(n),this.maximums.push(s),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(n,s,l,h,p){if(1===n[h].isLeaf(s,l))return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const _=h-1,v=n[_];let w,C=0;for(let S=0;S<this._siblingOffset.length;S++){const I=2*s+this._siblingOffset[S][0],A=2*l+this._siblingOffset[S][1],O=v.getElevation(I,A),N=v.isLeaf(I,A),U=this._addNode(O.min,O.max,N);N&&(C|=1<<S),w||(w=U)}for(let S=0;S<this._siblingOffset.length;S++)C&1<<S||this._construct(n,2*s+this._siblingOffset[S][0],2*l+this._siblingOffset[S][1],_,w+S)}}function ac(i,n,s,l,h,p){return zt(zt(i,s,p),zt(n,l,p),h)}function ul(i,n,s){const l=s.dim,h=cn(i*l-.5,0,l-1),p=cn(n*l-.5,0,l-1),_=Math.floor(h),v=Math.floor(p),w=Math.min(_+1,l-1),C=Math.min(v+1,l-1);return ac(s.get(_,v),s.get(w,v),s.get(_,C),s.get(w,C),h-_,p-v)}const hf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class vh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,s,l,h=!1,p=!1){if(this.uid=n,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&"mapbox"!==l&&"terrarium"!==l)return An(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const _=this.dim=s.height-2;if(this.data=new Uint32Array(s.data.buffer),this.encoding=l||"mapbox",this.borderReady=h,!h){for(let v=0;v<_;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(_,v)]=this.data[this._idx(_-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,_)]=this.data[this._idx(v,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new au(this)}get(n,s,l=!1){const h=new Uint8Array(this.data.buffer);l&&(n=cn(n,-1,this.dim),s=cn(s,-1,this.dim));const p=4*this._idx(n,s);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(h[p],h[p+1],h[p+2])}static getUnpackVector(n){return hf[n]}get unpackVector(){return hf[this.encoding]}_idx(n,s){if(n<-1||n>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(n+1)}_unpackMapbox(n,s,l){return(256*n*256+256*s+l)/10-1e4}_unpackTerrarium(n,s,l){return 256*n+s+l/256-32768}static pack(n,s){const l=[0,0,0,0],h=vh.getUnpackVector(s);let p=Math.floor((n+h[3])/h[2]);return l[2]=p%256,p=Math.floor(p/256),l[1]=p%256,p=Math.floor(p/256),l[0]=p,l}getPixels(){return new Wi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,s,l){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let h=s*this.dim,p=s*this.dim+this.dim,_=l*this.dim,v=l*this.dim+this.dim;switch(s){case-1:h=p-1;break;case 1:p=h+1}switch(l){case-1:_=v-1;break;case 1:v=_+1}const w=-s*this.dim,C=-l*this.dim;for(let S=_;S<v;S++)for(let I=h;I<p;I++)this.data[this._idx(I,S)]=n.data[this._idx(I+w,S+C)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Xe("DEMData",vh),Xe("DemMinMaxQuadTree",au,{omit:["dem"]});class df{constructor(n,s){this.max=n,this.onRemove=s,this.reset()}reset(){for(const n in this.data)for(const s of this.data[n])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(n,s,l){const h=n.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const p={value:s,timeout:void 0};if(void 0!==l&&(p.timeout=setTimeout(()=>{this.remove(n,p)},l)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const s=this.data[n].shift();return s.timeout&&clearTimeout(s.timeout),0===this.data[n].length&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),s.value}getByKey(n){const s=this.data[n];return s?s[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,s){if(!this.has(n))return this;const l=n.wrapped().key,h=void 0===s?0:this.data[l].indexOf(s),p=this.data[l][h];return this.data[l].splice(h,1),p.timeout&&clearTimeout(p.timeout),0===this.data[l].length&&delete this.data[l],this.onRemove(p.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(n){const s=[];for(const l in this.data)for(const h of this.data[l])n(h.value)||s.push(h);for(const l of s)this.remove(l.value.tileID,l)}}class Ea extends xs{constructor(n,s,l){super(),this.id=n,this._onlySymbols=l,s.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new df(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new xy}onAdd(n){this.map=n,this._minTileCacheSize=n?n._minTileCacheSize:null,this._maxTileCacheSize=n?n._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const s=this._tiles[n];if("loaded"!==s.state&&"errored"!==s.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,s){return n.isSymbolTile=this._onlySymbols,this._source.loadTile(n,s)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n,()=>{})}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(n),l.prepare(this.map.style.imageManager)}}getIds(){return Bi(this._tiles).map(n=>n.tileID).sort(pf).map(n=>n.key)}getRenderableIds(n){const s=[];for(const l in this._tiles)this._isIdRenderable(+l,n)&&s.push(this._tiles[l]);return n?s.sort((l,h)=>{const p=l.tileID,_=h.tileID,v=new Ke(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),w=new Ke(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-_.overscaledZ||w.y-v.y||w.x-v.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(pf).map(l=>l.key)}hasRenderableParent(n){const s=this.findLoadedParent(n,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(n,s){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(s||!this._tiles[n].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)"errored"!==this._tiles[n].state&&this._reloadTile(+n,"reloading")}}_reloadTile(n,s){const l=this._tiles[n];l&&("loading"!==l.state&&(l.state=s),this._loadTile(l,this._tileLoaded.bind(this,l,n,s)))}_tileLoaded(n,s,l,h){if(h)if(n.state="errored",404!==h.status)this._source.fire(new vu(h,{tile:n}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else n.timeAdded=Ai.now(),"expired"===l&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(s,n),"raster-dem"===this._source.type&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new nr("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const s=this.getRenderableIds();for(let h=0;h<s.length;h++){const p=s[h];if(n.neighboringTiles&&n.neighboringTiles[p]){const _=this.getTileByID(p);l(n,_),l(_,n)}}function l(h,p){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let _=p.tileID.canonical.x-h.tileID.canonical.x;const v=p.tileID.canonical.y-h.tileID.canonical.y,w=Math.pow(2,h.tileID.canonical.z),C=p.tileID.key;0===_&&0===v||Math.abs(v)>1||(Math.abs(_)>1&&(1===Math.abs(_+w)?_+=w:1===Math.abs(_-w)&&(_-=w)),p.dem&&h.dem&&(h.dem.backfillBorder(p.dem,_,v),h.neighboringTiles&&h.neighboringTiles[C]&&(h.neighboringTiles[C].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,s,l,h){for(const p in this._tiles){let _=this._tiles[p];if(h[p]||!_.hasData()||_.tileID.overscaledZ<=s||_.tileID.overscaledZ>l)continue;let v=_.tileID;for(;_&&_.tileID.overscaledZ>s+1;){const C=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[C.key],_&&_.hasData()&&(v=C)}let w=v;for(;w.overscaledZ>s;)if(w=w.scaledTo(w.overscaledZ-1),n[w.key]){h[v.key]=v;break}}}findLoadedParent(n,s){if(n.key in this._loadedParentTiles){const l=this._loadedParentTiles[n.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=n.overscaledZ-1;l>=s;l--){const h=n.scaledTo(l),p=this._getLoadedTile(h);if(p)return p}}_getLoadedTile(n){const s=this._tiles[n.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,s){s=s||this._source.tileSize;const l=Math.ceil(n.width/s)+1,h=Math.ceil(n.height/s)+1,p=Math.floor(l*h*5),_="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,p):p,v="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(v)}handleWrapJump(n){const s=Math.round((n-(void 0===this._prevLng?n:this._prevLng))/360);if(this._prevLng=n,s){const l={};for(const h in this._tiles){const p=this._tiles[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),l[p.tileID.key]=p}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(n,s,l){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let h;this.updateCacheSize(n,s),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new bi(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(h=n.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(v=>this._source.hasTile(v)))):h=[];const p=this._updateRetainedTiles(h);if(xh(this._source.type)&&0!==h.length){const v={},w={},C=Object.keys(p);for(const I of C){const A=p[I],O=this._tiles[I];if(!O||O.fadeEndTime&&O.fadeEndTime<=Ai.now())continue;const N=this.findLoadedParent(A,Math.max(A.overscaledZ-Ea.maxOverzooming,this._source.minzoom));N&&(this._addTile(N.tileID),v[N.tileID.key]=N.tileID),w[I]=A}const S=h[h.length-1].overscaledZ;for(const I in this._tiles){const A=this._tiles[I];if(p[I]||!A.hasData())continue;let O=A.tileID;for(;O.overscaledZ>S;){O=O.scaledTo(O.overscaledZ-1);const N=this._tiles[O.key];if(N&&N.hasData()&&w[O.key]){p[I]=A.tileID;break}}}for(const I in v)p[I]||(this._coveredTiles[I]=!0,p[I]=v[I])}for(const v in p)this._tiles[v].clearFadeHold();const _=function(v,w){const C=[];for(const S in v)S in w||C.push(S);return C}(this._tiles,p);for(const v of _){const w=this._tiles[v];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const s={};if(0===n.length)return s;const l={},h=n.reduce((C,S)=>Math.min(C,S.overscaledZ),1/0),p=n[0].overscaledZ,_=Math.max(p-Ea.maxOverzooming,this._source.minzoom),v=Math.max(p+Ea.maxUnderzooming,this._source.minzoom),w={};for(const C of n){const S=this._addTile(C);s[C.key]=C,S.hasData()||h<this._source.maxzoom&&(w[C.key]=C)}this._retainLoadedChildren(w,h,v,s);for(const C of n){let S=this._tiles[C.key];if(S.hasData())continue;if(C.canonical.z>=this._source.maxzoom){const A=C.children(this._source.maxzoom)[0],O=this.getTile(A);if(O&&O.hasData()){s[A.key]=A;continue}}else{const A=C.children(this._source.maxzoom);if(s[A[0].key]&&s[A[1].key]&&s[A[2].key]&&s[A[3].key])continue}let I=S.wasRequested();for(let A=C.overscaledZ-1;A>=_;--A){const O=C.scaledTo(A);if(l[O.key]||(l[O.key]=!0,S=this.getTile(O),!S&&I&&(S=this._addTile(O)),S&&(s[O.key]=O,I=S.wasRequested(),S.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const s=[];let l,h=this._tiles[n].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}s.push(h.key);const p=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(p),l)break;h=p}for(const p of s)this._loadedParentTiles[p]=l}}_addTile(n){let s=this._tiles[n.key];if(s)return s;s=this._cache.getAndRemove(n),s&&(this._setTileReloadTimer(n.key,s),s.tileID=n,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,s)));const l=Boolean(s);if(!l){const h=this.map?this.map.painter:null,p="raster"===this._source.type||"raster-dem"===this._source.type;s=new Rd(n,this._source.tileSize*n.overscaleFactor(),this.transform.tileZoom,h,p),this._loadTile(s,this._tileLoaded.bind(this,s,n.key,s.state))}return s?(s.uses++,this._tiles[n.key]=s,l||this._source.fire(new nr("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(n,s){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const l=s.getExpiryTimeout();l&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},l))}_removeTile(n){const s=this._tiles[n];s&&(s.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),s.uses>0||(s.hasData()&&"reloading"!==s.state?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(n,s,l){const h=[],p=this.transform;if(!p)return h;for(const _ in this._tiles){const v=this._tiles[_];if(l&&v.clearQueryDebugViz(),v.holdingForFade())continue;const w=n.containsTile(v,p,s);w&&h.push(w)}return h}getVisibleCoordinates(n){const s=this.getRenderableIds(n).map(l=>this._tiles[l].tileID);for(const l of s)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(xh(this._source.type))for(const n in this._tiles){const s=this._tiles[n];if(void 0!==s.fadeEndTime&&s.fadeEndTime>=Ai.now())return!0}return!1}setFeatureState(n,s,l){this._state.updateState(n=n||"_geojsonTileLayer",s,l)}removeFeatureState(n,s,l){this._state.removeFeatureState(n=n||"_geojsonTileLayer",s,l)}getFeatureState(n,s){return this._state.getState(n=n||"_geojsonTileLayer",s)}setDependencies(n,s,l){const h=this._tiles[n];h&&h.setDependencies(s,l)}reloadTilesForDependencies(n,s){for(const l in this._tiles)this._tiles[l].hasDependency(n,s)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(n,s))}_preloadTiles(n,s){const l=new Map,h=Array.isArray(n)?n:[n],p=this.map.painter.terrain,_=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const C of h){const S=C.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const I of S)l.set(I.key,I);this.usedForTerrain&&C.updateElevation(!1)}const v=Array.from(l.values()),w="raster"===this._source.type||"raster-dem"===this._source.type;Ba(v,(C,S)=>{const I=new Rd(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,w);this._loadTile(I,A=>{"raster-dem"===this._source.type&&I.dem&&this._backfillDEM(I),S(A,I)})},s)}}function pf(i,n){const s=Math.abs(2*i.wrap)-+(i.wrap<0),l=Math.abs(2*n.wrap)-+(n.wrap<0);return i.overscaledZ-n.overscaledZ||l-s||n.canonical.y-i.canonical.y||n.canonical.x-i.canonical.x}function xh(i){return"raster"===i||"image"===i||"video"===i}Ea.maxOverzooming=10,Ea.maxUnderzooming=3;class kd{constructor(n,s,l){this._demTile=n,this._dem=this._demTile.dem,this._scale=s,this._offset=l}static create(n,s,l){const h=l||n.findDEMTileFor(s);if(!h||!h.dem)return;const p=h.dem,_=h.tileID,v=1<<s.canonical.z-_.canonical.z;return new kd(h,h.tileSize/Rt/v,[(s.canonical.x/v-_.canonical.x)*p.dim,(s.canonical.y/v-_.canonical.y)*p.dim])}tileCoordToPixel(n,s){const l=s*this._scale+this._offset[1],h=Math.floor(n*this._scale+this._offset[0]),p=Math.floor(l);return new Ke(h,p)}getElevationAt(n,s,l,h){const p=n*this._scale+this._offset[0],_=s*this._scale+this._offset[1],v=Math.floor(p),w=Math.floor(_),C=this._dem;return h=!!h,l?zt(zt(C.get(v,w,h),C.get(v,w+1,h),_-w),zt(C.get(v+1,w,h),C.get(v+1,w+1,h),_-w),p-v):C.get(v,w,h)}getElevationAtPixel(n,s,l){return this._dem.get(n,s,!!l)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*Zi(1,n)*this._dem.stride}}class ff{constructor(n,s){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new zc(Rt,16,0),this.featureIndexArray=new am,this.promoteId=s}insert(n,s,l,h,p,_=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,p,_);const w=this.grid;for(let C=0;C<s.length;C++){const S=s[C],I=[1/0,1/0,-1/0,-1/0];for(let A=0;A<S.length;A++){const O=S[A];I[0]=Math.min(I[0],O.x),I[1]=Math.min(I[1],O.y),I[2]=Math.max(I[2],O.x),I[3]=Math.max(I[3],O.y)}I[0]<Rt&&I[1]<Rt&&I[2]>=0&&I[3]>=0&&w.insert(v,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new al.VectorTile(new Kl(this.rawTileData)).layers,this.sourceLayerCoder=new lg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,s,l,h){this.loadVTLayers();const p=n.params||{},_=Lu(p.filter),v=n.tileResult,w=n.transform,C=v.bufferedTilespaceBounds,S=this.grid.query(C.min.x,C.min.y,C.max.x,C.max.y,(N,U,q,J)=>P_(v.bufferedTilespaceGeometry,N,U,q,J));S.sort(ug);let I=null;w.elevation&&S.length>0&&(I=kd.create(w.elevation,this.tileID));const A={};let O;for(let N=0;N<S.length;N++){const U=S[N];if(U===O)continue;O=U;const q=this.featureIndexArray.get(U);let J=null;this.loadMatchingFeature(A,q,_,p.layers,p.availableImages,s,l,h,(ie,ce,he,pe=0)=>(J||(J=po(ie,this.tileID.canonical,n.tileTransform)),ce.queryIntersectsFeature(v,ie,he,J,this.z,n.transform,n.pixelPosMatrix,I,pe)))}return A}loadMatchingFeature(n,s,l,h,p,_,v,w,C){const{featureIndex:S,bucketIndex:I,sourceLayerIndex:A,layoutVertexArrayOffset:O}=s,N=this.bucketLayerIDs[I];if(h&&!function(ie,ce){for(let he=0;he<ie.length;he++)if(ce.indexOf(ie[he])>=0)return!0;return!1}(h,N))return;const U=this.sourceLayerCoder.decode(A),q=this.vtLayers[U].feature(S);if(l.needGeometry){const ie=ql(q,!0);if(!l.filter(new ft(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!l.filter(new ft(this.tileID.overscaledZ),q))return;const J=this.getId(q,U);for(let ie=0;ie<N.length;ie++){const ce=N[ie];if(h&&h.indexOf(ce)<0)continue;const he=_[ce];if(!he)continue;let pe={};void 0!==J&&w&&(pe=w.getState(he.sourceLayer||"_geojsonTileLayer",J));const de=Un({},v[ce]);de.paint=by(de.paint,he.paint,q,pe,p),de.layout=by(de.layout,he.layout,q,pe,p);const Ce=!C||C(q,he,pe,O);if(!Ce)continue;const we=new uf(q,this.z,this.x,this.y,J);we.layer=de;let Ge=n[ce];void 0===Ge&&(Ge=n[ce]=[]),Ge.push({featureIndex:S,feature:we,intersectionZ:Ce})}}lookupSymbolFeatures(n,s,l,h,p,_,v,w){const C={};this.loadVTLayers();const S=Lu(p);for(const I of n)this.loadMatchingFeature(C,{bucketIndex:l,sourceLayerIndex:h,featureIndex:I,layoutVertexArrayOffset:0},S,_,v,w,s);return C}loadFeature(n){const{featureIndex:s,sourceLayerIndex:l}=n;this.loadVTLayers();const h=this.sourceLayerCoder.decode(l),p=this.vtFeatures[h];if(p[s])return p[s];const _=this.vtLayers[h].feature(s);return p[s]=_,_}hasLayer(n){for(const s of this.bucketLayerIDs)for(const l of s)if(n===l)return!0;return!1}getId(n,s){let l=n.id;return this.promoteId&&(l=n.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[s]],"boolean"==typeof l&&(l=Number(l))),l}}function by(i,n,s,l,h){return $s(i,(p,_)=>{const v=n instanceof fa?n.get(_):null;return v&&v.evaluate?v.evaluate(s,l,h):v})}function ug(i,n){return n-i}Xe("FeatureIndex",ff,{omit:["rawTileData","sourceLayerCoder"]});var hg=Rn([{name:"a_pos",type:"Int16",components:2}]);const hl=new Uint16Array(8184);for(let i=0;i<2046;i++){let n=i+2,s=0,l=0,h=0,p=0,_=0,v=0;for(1&n?h=p=_=32:s=l=v=32;(n>>=1)>1;){const C=s+h>>1,S=l+p>>1;1&n?(h=s,p=l,s=_,l=v):(s=h,l=p,h=_,p=v),_=C,v=S}const w=4*i;hl[w+0]=s,hl[w+1]=l,hl[w+2]=h,hl[w+3]=p}const ks=new Uint16Array(2178),Tr=new Uint8Array(1089),Fd=new Uint16Array(1089);function dg(i){return 0===i?-.03125:32===i?.03125:0}var pg=Rn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const wy={type:2,extent:Rt,loadGeometry:()=>[[new Ke(0,0),new Ke(8193,0),new Ke(8193,8193),new Ke(0,8193),new Ke(0,0)]]};class Rd{constructor(n,s,l,h,p){this.tileID=n,this.uid=Tl(),this.uses=0,this.tileSize=s,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(n){const s=n+this.timeAdded;s<Ai.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=pl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,s,l){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(h,p){const _={};if(!p)return _;for(const v of h){const w=v.layerIds.map(C=>p.getLayer(C)).filter(Boolean);if(0!==w.length){v.layers=w,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(C=>w.filter(S=>S.id===C)[0]));for(const C of w)_[C.id]=v}}return _}(n.buckets,s.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const p=this.buckets[h];if(p instanceof cl){if(this.hasSymbolBuckets=!0,!l)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const p=this.buckets[h];if(p instanceof cl&&p.hasRTLText){this.hasRTLText=!0,Ut.isLoading()||Ut.isLoaded()||"deferred"!==ni()||$i();break}}this.queryPadding=0;for(const h in this.buckets){const p=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(h).queryRadius(p))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas)}else this.collisionBoxArray=new sm}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.id]}upload(n){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(n)}const s=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new sf(n,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new sf(n,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new sf(n,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,s,l,h,p,_,v,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:v,transform:_,params:p,tileTransform:this.tileTransform},n,s,l):{}}querySourceFeatures(n,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),p=s?s.sourceLayer:"",_=h._geojsonTileLayer||h[p];if(!_)return;const v=Lu(s&&s.filter),{z:w,x:C,y:S}=this.tileID.canonical,I={z:w,x:C,y:S};for(let A=0;A<_.length;A++){const O=_.feature(A);if(v.needGeometry){const q=ql(O,!0);if(!v.filter(new ft(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!v.filter(new ft(this.tileID.overscaledZ),O))continue;const N=l.getId(O,p),U=new uf(O,w,C,S,N);U.tile=I,n.push(U)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const s=this.expirationTime;if(n.cacheControl){const l=qs(n.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(s)if(this.expirationTime<s)h=!0;else{const p=this.expirationTime-s;p?this.expirationTime=l+Math.max(p,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(n,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(n).length||!s)return;const l=this.latestFeatureIndex.loadVTLayers(),h=s.style.listImages();for(const p in this.buckets){if(!s.style.hasLayer(p))continue;const _=this.buckets[p],v=_.layers[0].sourceLayer||"_geojsonTileLayer",w=l[v],C=n[v];if(!w||!C||0===Object.keys(C).length)continue;if(_.update(C,w,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof hd||_ instanceof Bp){const I=s.style._getSourceCache(_.layers[0].source);s._terrain&&s._terrain.enabled&&I&&_.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(I.id,this.tileID)}const S=s&&s.style&&s.style.getLayer(p);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ai.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=Ai.now()+n}setDependencies(n,s){const l={};for(const h of s)l[h]=!0;this.dependencies[n]=l}hasDependency(n,s){for(const l of n){const h=this.dependencies[l];if(h)for(const p of s)if(h[p])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,s){if(!s||"mercator"===s.name||this._tileDebugBuffer)return;const l=po(wy,this.tileID.canonical,this.tileTransform)[0],h=new Nc,p=new yp;for(let _=0;_<l.length;_++){const{x:v,y:w}=l[_];h.emplaceBack(v,w),p.emplaceBack(_)}p.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(p),this._tileDebugBuffer=n.createVertexBuffer(h,pg.members),this._tileDebugSegments=dt.simpleSegment(0,0,h.length,p.length)}_makeTileBoundsBuffers(n,s){if(this._tileBoundsBuffer||!s||"mercator"===s.name)return;const l=po(wy,this.tileID.canonical,this.tileTransform)[0];let h,p;if(this.isRaster){const _=function(v,w){const C=pl(v,w),S=Math.pow(2,v.z);for(let q=0;q<33;q++)for(let J=0;J<33;J++){const ie=As((v.x+(J+dg(J))/32)/S),ce=Oi((v.y+(q+dg(q))/32)/S),he=w.project(ie,ce),pe=33*q+J;ks[2*pe+0]=Math.round((he.x*C.scale-C.x)*Rt),ks[2*pe+1]=Math.round((he.y*C.scale-C.y)*Rt)}Tr.fill(0),Fd.fill(0);for(let q=2045;q>=0;q--){const J=4*q,ie=hl[J+0],ce=hl[J+1],he=hl[J+2],pe=hl[J+3],de=ie+he>>1,Ce=ce+pe>>1,we=de+Ce-ce,Ge=Ce+ie-de,Be=33*ce+ie,De=33*pe+he,Ve=33*Ce+de,Ze=Math.hypot((ks[2*Be+0]+ks[2*De+0])/2-ks[2*Ve+0],(ks[2*Be+1]+ks[2*De+1])/2-ks[2*Ve+1])>=16;if(Tr[Ve]=Tr[Ve]||(Ze?1:0),q<1022){const Pe=33*(ce+Ge>>1)+(ie+we>>1),We=33*(pe+Ge>>1)+(he+we>>1);Tr[Ve]=Tr[Ve]||Tr[Pe]||Tr[We]}}const I=new ma,A=new Ur;let O=0;function N(q,J){const ie=33*J+q;return 0===Fd[ie]&&(I.emplaceBack(ks[2*ie+0],ks[2*ie+1],q*Rt/32,J*Rt/32),Fd[ie]=++O),Fd[ie]-1}function U(q,J,ie,ce,he,pe){const de=q+ie>>1,Ce=J+ce>>1;if(Math.abs(q-he)+Math.abs(J-pe)>1&&Tr[33*Ce+de])U(he,pe,q,J,de,Ce),U(ie,ce,he,pe,de,Ce);else{const we=N(q,J),Ge=N(ie,ce),Be=N(he,pe);A.emplaceBack(we,Ge,Be)}}return U(0,0,32,32,32,0),U(32,32,0,0,0,32),{vertices:I,indices:A}}(this.tileID.canonical,s);h=_.vertices,p=_.indices}else{h=new ma,p=new Ur;for(const{x:v,y:w}of l)h.emplaceBack(v,w,0,0);const _=sd(h.int16,void 0,4);for(let v=0;v<_.length;v+=3)p.emplaceBack(_[v],_[v+1],_[v+2])}this._tileBoundsBuffer=n.createVertexBuffer(h,pg.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(p),this._tileBoundsSegments=dt.simpleSegment(0,0,h.length,p.length)}}const Ox=Rn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),Ey=Rn([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ld}=Ox;function dl(i,n){const s=i.fovAboveCenter,l=i.elevation?i.elevation.getMinElevationBelowMSL()*n:0,h=(i._camera.position[2]*i.worldSize-l)/Math.cos(i._pitch),p=Math.sin(s)*h/Math.sin(Math.max(Math.PI/2-i._pitch-s,.01)),_=Math.sin(i._pitch)*p+h;return Math.min(1.01*_,h*(1/i._horizonShift))}const mf=Rt/Math.PI/2,Xi=-mf,Ki=mf,fg=[new ss([Xi,Xi,Xi],[Ki,Ki,Ki]),new ss([Xi,Xi,Xi],[0,0,Ki]),new ss([0,Xi,Xi],[Ki,0,Ki]),new ss([Xi,0,Xi],[0,Ki,Ki]),new ss([0,0,Xi],[Ki,Ki,Ki])];function Od(i){if(i.z<=1)return fg[i.z+2*i.y+i.x];const[n,s]=gf(i),l=[zd(n[0],n[1]),zd(n[0],s[1]),zd(s[0],n[1]),zd(s[0],s[1])],h=[Ki,Ki,Ki],p=[Xi,Xi,Xi];for(const _ of l)h[0]=Math.min(h[0],_[0]),h[1]=Math.min(h[1],_[1]),h[2]=Math.min(h[2],_[2]),p[0]=Math.max(p[0],_[0]),p[1]=Math.max(p[1],_[1]),p[2]=Math.max(p[2],_[2]);return new ss(h,p)}function gf(i){const n=Math.pow(2,i.z),s=i.x/n,l=(i.x+1)/n,h=(i.y+1)/n;return[[Oi(i.y/n),As(s)],[Oi(h),As(l)]]}function _f(i,n,s,l){return s=Ot(s),l||(l=mf),[i*Math.sin(s)*l,-n*l,i*Math.cos(s)*l]}function zd(i,n,s){return _f(Math.cos(Ot(i)),Math.sin(Ot(i)),n,s)}function yf(i){return 16383/Math.max(...js([],i.max,i.min))}function vf(i){const n=hi(new Float64Array(16)),s=1/yf(i);return eo(n,n,i.min),xr(n,n,[s,s,s]),n}function mg(i,n,s){const l=n/(2*Math.PI),h=function(_){const v=Rt/(2*Math.PI);return _/(2*Math.PI)/v}(n);if(!s){const _=cn(i.center.lat,-85.051129,os);s=[Hc(i.center.lng)*n,il(_)*n]}const p=hi(new Float64Array(16));return eo(p,p,[s[0],s[1],-l]),xr(p,p,[h,h,h]),Uo(p,p,Ot(-i._center.lat)),yo(p,p,Ot(-i._center.lng)),p}class Oo{constructor(n){const s=this._createGridIndices();this.gridIndexBuffer=n.createIndexBuffer(s,!0),this.gridSegments=dt.simpleSegment(0,0,4225,8192);const l=this._createPoleTriangleIndices();this.poleIndexBuffer=n.createIndexBuffer(l,!0),this.poleSegments=dt.simpleSegment(0,0,66,64);const h=new qu;h.emplaceBack(-1,1,1,0,0,0,0),h.emplaceBack(1,1,1,0,0,1,0),h.emplaceBack(1,-1,1,0,0,1,1),h.emplaceBack(-1,-1,1,0,0,0,1);const p=new Ur;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.atmosphereVertexBuffer=n.createVertexBuffer(h,Ey.members),this.atmosphereIndexBuffer=n.createIndexBuffer(p),this.atmosphereSegments=dt.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(n,s,l){const h=new qu,p=s/Math.PI/2;h.emplaceBack(0,-p,0,0,0,.5,l?0:1);const _=360/n,v=Math.cos(Ot(85)),w=Math.sin(Ot(85));for(let S=0;S<=64;S++){const I=S/64,A=_f(v,w,0*(1-(C=I))+_*C,p);h.emplaceBack(A[0],A[1],A[2],0,0,I,l?0:1)}var C;return h}_createPoleTriangleIndices(){const n=new Ur;for(let s=0;s<=64;s++)n.emplaceBack(0,s+1,s+2);return n}static createGridVertices(n){const s=Math.pow(2,n.z),l=(w,C,S)=>w*(1-S)+C*S,[h,p]=gf(n),_=new qu,v=function(w){const C=hi(new Float64Array(16)),S=yf(w);var I,A;return xr(C,C,[S,S,S]),eo(C,C,((I=[])[0]=-(A=w.min)[0],I[1]=-A[1],I[2]=-A[2],I)),C}(Od(n));_.reserve(4096);for(let w=0;w<65;w++){const C=l(h[0],p[0],w/64),S=il(C),I=S*s-n.y,A=Math.sin(Ot(C)),O=Math.cos(Ot(C));for(let N=0;N<65;N++){const U=N/64,q=l(h[1],p[1],U),J=_f(O,A,q);Ht(J,J,v);const ie=Hc(q);_.emplaceBack(J[0],J[1],J[2],ie,S,U,I)}}return _}_createGridIndices(){const n=new Ur,s=(l,h)=>{const p=65*h+l;n.emplaceBack(p+1,p,p+65),n.emplaceBack(p+65,p+65+1,p+1)};for(let l=0;l<64;l++)for(let h=0;h<64;h++)s(h,l);return n}getWirefameBuffer(n){if(!this.wireframeSegments){const s=this._createWireframeGrid();this.wireframeIndexBuffer=n.createIndexBuffer(s),this.wireframeSegments=dt.simpleSegment(0,0,4096,s.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const n=new Ul,s=(l,h)=>{const p=65*h+l;n.emplaceBack(p,p+1),n.emplaceBack(p,p+65),n.emplaceBack(p,p+65+1)};for(let l=0;l<64;l++)for(let h=0;h<64;h++)s(h,l);return n}}function pl(i,n){if(!n.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:n};const s=Math.pow(2,-i.z),l=i.x*s,h=(i.x+1)*s,p=i.y*s,_=(i.y+1)*s,v=As(l),w=As(h),C=Oi(p),S=Oi(_),I=n.project(v,C),A=n.project(w,C),O=n.project(w,S),N=n.project(v,S);let U=Math.min(I.x,A.x,O.x,N.x),q=Math.min(I.y,A.y,O.y,N.y),J=Math.max(I.x,A.x,O.x,N.x),ie=Math.max(I.y,A.y,O.y,N.y);const ce=s/16;function he(de,Ce,we,Ge,Be,De){const Ve=(we+Be)/2,Ze=(Ge+De)/2,Pe=n.project(As(Ve),Oi(Ze)),We=Math.max(0,U-Pe.x,q-Pe.y,Pe.x-J,Pe.y-ie);U=Math.min(U,Pe.x),J=Math.max(J,Pe.x),q=Math.min(q,Pe.y),ie=Math.max(ie,Pe.y),We>ce&&(he(de,Pe,we,Ge,Ve,Ze),he(Pe,Ce,Ve,Ze,Be,De))}he(I,A,l,p,h,p),he(A,O,h,p,h,_),he(O,N,h,_,l,_),he(N,I,l,_,l,p),U-=ce,q-=ce,J+=ce,ie+=ce;const pe=1/Math.max(J-U,ie-q);return{scale:pe,x:U*pe,y:q*pe,x2:J*pe,y2:ie*pe,projection:n}}class gg{constructor(n){const s={},l=[];for(const v in n){const w=n[v],C=s[v]={};for(const S in w.glyphs){const I=w.glyphs[+S];if(!I||0===I.bitmap.width||0===I.bitmap.height)continue;const A=I.metrics.localGlyph?2:1,O={x:0,y:0,w:I.bitmap.width+2*A,h:I.bitmap.height+2*A};l.push(O),C[S]=O}}const{w:h,h:p}=md(l),_=new Wl({width:h||1,height:p||1});for(const v in n){const w=n[v];for(const C in w.glyphs){const S=w.glyphs[+C];if(!S||0===S.bitmap.width||0===S.bitmap.height)continue;const I=s[v][C],A=S.metrics.localGlyph?2:1;Wl.copy(S.bitmap,_,{x:0,y:0},{x:I.x+A,y:I.y+A},S.bitmap)}}this.image=_,this.positions=s}}Xe("GlyphAtlas",gg);class Cy{constructor(n){this.tileID=new bi(n.tileID.overscaledZ,n.tileID.wrap,n.tileID.canonical.z,n.tileID.canonical.x,n.tileID.canonical.y),this.tileZoom=n.tileZoom,this.uid=n.uid,this.zoom=n.zoom,this.canonical=n.tileID.canonical,this.pixelRatio=n.pixelRatio,this.tileSize=n.tileSize,this.source=n.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=n.showCollisionBoxes,this.collectResourceTiming=!!n.collectResourceTiming,this.returnDependencies=!!n.returnDependencies,this.promoteId=n.promoteId,this.enableTerrain=!!n.enableTerrain,this.isSymbolTile=n.isSymbolTile,this.tileTransform=pl(n.tileID.canonical,n.projection),this.projection=n.projection}parse(n,s,l,h,p){this.status="parsing",this.data=n,this.collisionBoxArray=new sm;const _=new lg(Object.keys(n.layers).sort()),v=new ff(this.tileID,this.promoteId);v.bucketLayerIDs=[];const w={},C=new ag(256,256),S={featureIndex:v,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:C,availableImages:l},I=s.familiesBySource[this.source];for(const pe in I){const de=n.layers[pe];if(!de)continue;let Ce=!1,we=!1;for(const De of I[pe])"symbol"===De[0].type?Ce=!0:we=!0;if(!0===this.isSymbolTile&&!Ce||!1===this.isSymbolTile&&!we)continue;1===de.version&&An(`Vector tile source "${this.source}" layer "${pe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ge=_.encode(pe),Be=[];for(let De=0;De<de.length;De++){const Ve=de.feature(De),Ze=v.getId(Ve,pe);Be.push({feature:Ve,id:Ze,index:De,sourceLayerIndex:Ge})}for(const De of I[pe]){const Ve=De[0];void 0!==this.isSymbolTile&&"symbol"===Ve.type!==this.isSymbolTile||Ve.minzoom&&this.zoom<Math.floor(Ve.minzoom)||Ve.maxzoom&&this.zoom>=Ve.maxzoom||"none"!==Ve.visibility&&(_g(De,this.zoom,l),(w[Ve.id]=Ve.createBucket({index:v.bucketLayerIDs.length,layers:De,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ge,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:l})).populate(Be,S,this.tileID.canonical,this.tileTransform),v.bucketLayerIDs.push(De.map(Ze=>Ze.id)))}}let A,O,N,U;C.trim();const q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},J=$s(S.glyphDependencies,pe=>Object.keys(pe).map(Number));Object.keys(J).length?h.send("getGlyphs",{uid:this.uid,stacks:J},(pe,de)=>{A||(A=pe,O=de,he.call(this))},void 0,!1,q):O={};const ie=Object.keys(S.iconDependencies);ie.length?h.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"icons"},(pe,de)=>{A||(A=pe,N=de,he.call(this))},void 0,!1,q):N={};const ce=Object.keys(S.patternDependencies);function he(){if(A)return p(A);if(O&&N&&U){const pe=new gg(O),de=new Wm(N,U);for(const Ce in w){const we=w[Ce];we instanceof cl?(_g(we.layers,this.zoom,l),tg(we,O,pe.positions,N,de.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom,this.projection),we.projection=this.projection.name):we.hasPattern&&(we instanceof hd||we instanceof Bp||we instanceof sh)&&(_g(we.layers,this.zoom,l),we.addFeatures(S,this.tileID.canonical,de.patternPositions,l))}this.status="done",p(null,{buckets:Bi(w).filter(Ce=>!Ce.isEmpty()),featureIndex:v,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pe.image,lineAtlas:C,imageAtlas:de,glyphMap:this.returnDependencies?O:null,iconMap:this.returnDependencies?N:null,glyphPositions:this.returnDependencies?pe.positions:null})}}ce.length?h.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"patterns"},(pe,de)=>{A||(A=pe,U=de,he.call(this))},void 0,!1,q):U={},he.call(this)}}function _g(i,n,s){const l=new ft(n);for(const h of i)h.recalculate(l,s)}class xf{constructor(n){this.entries={},this.scheduler=n}request(n,s,l,h){const p=this.entries[n]=this.entries[n]||{callbacks:[]};if(p.result){const[_,v]=p.result;return this.scheduler?this.scheduler.add(()=>{h(_,v)},s):h(_,v),()=>{}}return p.callbacks.push(h),p.cancel||(p.cancel=l((_,v)=>{p.result=[_,v];for(const w of p.callbacks)this.scheduler?this.scheduler.add(()=>{w(_,v)},s):w(_,v);setTimeout(()=>delete this.entries[n],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(_=>_!==h),p.callbacks.length||(p.cancel(),delete this.entries[n]))}}}function yg(i,n,s){const l=JSON.stringify(i.request);return i.data&&(this.deduped.entries[l]={result:[null,i.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},h=>{const p=Ua(i.request,(_,v,w,C)=>{_?h(_):v&&h(null,{vectorTile:s?void 0:new al.VectorTile(new Kl(v)),rawData:v,cacheControl:w,expires:C})});return()=>{p.cancel(),h()}},n)}const Dy=hi(new Float64Array(16));class lc{constructor(n,s){this._tr=n,this._worldSize=s}createInversionMatrix(){return Dy}createTileMatrix(n){let s,l,h;const p=n.canonical,_=hi(new Float64Array(16)),v=this._tr.projection;if(v.isReprojectedInTileSpace){const w=pl(p,v);s=1,l=w.x+n.wrap*w.scale,h=w.y,xr(_,_,[s/w.scale,s/w.scale,this._tr.pixelsPerMeter/this._worldSize])}else s=this._worldSize/this._tr.zoomScale(p.z),l=(p.x+Math.pow(2,p.z)*n.wrap)*s,h=p.y*s;return eo(_,_,[l,h,0]),xr(_,_,[s/Rt,s/Rt,1]),_}pointCoordinate(n,s,l){const h=this._tr.horizonLineFromTop(!1),p=new Ke(n,Math.max(h,s));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(p,l))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var bf={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&xc(this.parallels,this.constants.parallels))return;const i=Math.sin(Ot(this.parallels[0])),n=(i+Math.sin(Ot(this.parallels[1])))/2,s=1+i*(2*n-i),l=Math.sqrt(s)/n;this.constants={n,c:s,r0:l,parallels:this.parallels}},project(i,n){this.initializeConstants();const s=Ot(i-this.center[0]),l=Ot(n),{n:h,c:p,r0:_}=this.constants,v=Math.sqrt(p-2*h*Math.sin(l))/h;return{x:v*Math.sin(s*h),y:v*Math.cos(s*h)-_,z:0}},unproject(i,n){this.initializeConstants();const{n:s,c:l,r0:h}=this.constants,p=h+n;let _=Math.atan2(i,Math.abs(p))*Math.sign(p);p*s<0&&(_-=Math.PI*Math.sign(i)*Math.sign(p));const v=Ot(this.center[0])*s;_=gs(_,-Math.PI-v,Math.PI-v);const w=Mi(_/s)+this.center[0],C=Math.asin(cn((l-(i*i+p*p)*s*s)/(2*s),-1,1)),S=cn(Mi(C),-85.051129,os);return new nn(w,S)},projectTilePoint:(i,n)=>({x:i,y:n,z:0}),locationPoint:(i,n)=>i._coordinatePoint(i.locationCoordinate(n),!1),pixelsPerMeter:(i,n)=>Zi(1,i)*n,farthestPixelDistance(i){return dl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,n)=>new lc(i,n)};const bh=1.340264,wh=-.081106,fl=893e-6,cc=.003796,Bd=Math.sqrt(3)/2;var wf={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(i,n){n=n/180*Math.PI,i=i/180*Math.PI;const s=Math.asin(Bd*Math.sin(n)),l=s*s,h=l*l*l;return{x:.5*(i*Math.cos(s)/(Bd*(bh+3*wh*l+h*(7*fl+9*cc*l)))/Math.PI+.5),y:1-.5*(s*(bh+wh*l+h*(fl+cc*l))/Math.PI+1),z:0}},unproject(i,n){i=(2*i-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,l=s*s,h=l*l*l;for(let C,S,I,A=0;A<12&&(S=s*(bh+wh*l+h*(fl+cc*l))-n,I=bh+3*wh*l+h*(7*fl+9*cc*l),C=S/I,s=cn(s-C,-Math.PI/3,Math.PI/3),l=s*s,h=l*l*l,!(Math.abs(C)<1e-12));++A);const p=Bd*i*(bh+3*wh*l+h*(7*fl+9*cc*l))/Math.cos(s),_=Math.asin(Math.sin(s)/Bd),v=cn(180*p/Math.PI,-180,180),w=cn(180*_/Math.PI,-85.051129,os);return new nn(v,w)},projectTilePoint:(i,n)=>({x:i,y:n,z:0}),locationPoint:(i,n)=>i._coordinatePoint(i.locationCoordinate(n),!1),pixelsPerMeter:(i,n)=>Zi(1,i)*n,farthestPixelDistance(i){return dl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,n)=>new lc(i,n)},Ef={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(i,n)=>({x:.5+i/360,y:.5-n/360,z:0}),unproject(i,n){const s=360*(i-.5),l=cn(360*(.5-n),-85.051129,os);return new nn(s,l)},projectTilePoint:(i,n)=>({x:i,y:n,z:0}),locationPoint:(i,n)=>i._coordinatePoint(i.locationCoordinate(n),!1),pixelsPerMeter:(i,n)=>Zi(1,i)*n,farthestPixelDistance(i){return dl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,n)=>new lc(i,n)};const uc=Math.PI/2;function Nd(i){return Math.tan((uc+i)/2)}var Ty={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&xc(this.parallels,this.constants.parallels))return;const i=Ot(this.parallels[0]),n=Ot(this.parallels[1]),s=Math.cos(i),l=i===n?Math.sin(i):Math.log(s/Math.cos(n))/Math.log(Nd(n)/Nd(i)),h=s*Math.pow(Nd(i),l)/l;this.constants={n:l,f:h,parallels:this.parallels}},project(i,n){this.initializeConstants(),n=Ot(n),i=Ot(i-this.center[0]);const s=1e-6,{n:l,f:h}=this.constants;h>0?n<-uc+s&&(n=-uc+s):n>uc-s&&(n=uc-s);const p=h/Math.pow(Nd(n),l),_=p*Math.sin(l*i),v=h-p*Math.cos(l*i);return{x:.5*(_/Math.PI+.5),y:1-.5*(v/Math.PI+.5),z:0}},unproject(i,n){this.initializeConstants(),i=(2*i-.5)*Math.PI,n=(2*(1-n)-.5)*Math.PI;const{n:s,f:l}=this.constants,h=l-n,p=Math.sign(h),_=Math.sign(s)*Math.sqrt(i*i+h*h);let v=Math.atan2(i,Math.abs(h))*p;h*s<0&&(v-=Math.PI*Math.sign(i)*p);const w=cn(Mi(v/s)+this.center[0],-180,180),C=cn(Mi(2*Math.atan(Math.pow(l/_,1/s))-uc),-85.051129,os);return new nn(w,C)},projectTilePoint:(i,n)=>({x:i,y:n,z:0}),locationPoint:(i,n)=>i._coordinatePoint(i.locationCoordinate(n),!1),pixelsPerMeter:(i,n)=>Zi(1,i)*n,farthestPixelDistance(i){return dl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,n)=>new lc(i,n)},Cf={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(i,n)=>({x:Hc(i),y:il(n),z:0}),unproject(i,n){const s=As(i),l=Oi(n);return new nn(s,l)},projectTilePoint:(i,n)=>({x:i,y:n,z:0}),locationPoint:(i,n)=>i._coordinatePoint(i.locationCoordinate(n),!1),pixelsPerMeter:(i,n)=>Zi(1,i)*n,farthestPixelDistance(i){return dl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,n)=>new lc(i,n)};const My=Ot(os);var Sy={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(i,n){const s=(n=Ot(n))*n,l=s*s;return{x:.5*((i=Ot(i))*(.8707-.131979*s+l*(l*(.003971*s-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+s*(.015085+l*(.028874*s-.044475-.005916*l)))/Math.PI+1),z:0}},unproject(i,n){i=(2*i-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,l=25,h=0,p=s*s;do{p=s*s;const w=p*p;h=(s*(1.007226+p*(.015085+w*(.028874*p-.044475-.005916*w)))-n)/(1.007226+p*(.045255+w*(.259866*p-.311325-.005916*11*w))),s=cn(s-h,-My,My)}while(Math.abs(h)>1e-6&&--l>0);p=s*s;const _=cn(Mi(i/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),v=Mi(s);return new nn(_,v)},projectTilePoint:(i,n)=>({x:i,y:n,z:0}),locationPoint:(i,n)=>i._coordinatePoint(i.locationCoordinate(n),!1),pixelsPerMeter:(i,n)=>Zi(1,i)*n,farthestPixelDistance(i){return dl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,n)=>new lc(i,n)};const Df=Ot(os),Tf={albers:bf,equalEarth:wf,equirectangular:Ef,lambertConformalConic:Ty,mercator:Cf,naturalEarth:Sy,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(i,n){n=Ot(n),i=Ot(i);const s=Math.cos(n),l=2/Math.PI,h=Math.acos(s*Math.cos(i/2)),p=Math.sin(h)/h,_=.5*(i*l+2*s*Math.sin(i/2)/p)||0,v=.5*(n+Math.sin(n)/p)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}},unproject(i,n){let s=i=(2*i-.5)*Math.PI,l=n=(2*(1-n)-1)*Math.PI,h=25;const p=1e-6;let _=0,v=0;do{const w=Math.cos(l),C=Math.sin(l),S=2*C*w,I=C*C,A=w*w,O=Math.cos(s/2),N=Math.sin(s/2),U=2*O*N,q=N*N,J=1-A*O*O,ie=J?1/J:0,ce=J?Math.acos(w*O)*Math.sqrt(1/J):0,he=.5*(2*ce*w*N+2*s/Math.PI)-i,pe=.5*(ce*C+l)-n,de=.5*ie*(A*q+ce*w*O*I)+1/Math.PI,Ce=ie*(U*S/4-ce*C*N),we=.125*ie*(S*N-ce*C*A*U),Ge=.5*ie*(I*O+ce*q*w)+.5,Be=Ce*we-Ge*de;_=(pe*Ce-he*Ge)/Be,v=(he*we-pe*de)/Be,s=cn(s-_,-Math.PI,Math.PI),l=cn(l-v,-Df,Df)}while((Math.abs(_)>p||Math.abs(v)>p)&&--h>0);return new nn(Mi(s),Mi(l))},projectTilePoint:(i,n)=>({x:i,y:n,z:0}),locationPoint:(i,n)=>i._coordinatePoint(i.locationCoordinate(n),!1),pixelsPerMeter:(i,n)=>Zi(1,i)*n,farthestPixelDistance(i){return dl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,n)=>new lc(i,n)}};d.ARRAY_TYPE=Sn,d.AUTH_ERR_MSG=_e,d.Aabb=ss,d.Actor=class{constructor(i,n,s){this.target=i,this.parent=n,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Ml(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=io()?i:Ae,this.scheduler=new Lx}send(i,n,s,l,h=!1,p){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=p,this.callbacks[_]=s);const v=wo(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:i,hasCallback:!!s,targetMapId:l,mustQueue:h,sourceMapId:this.mapId,data:Ri(n,v)},v),{cancel:()=>{s&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(i){const n=i.data,s=n.id;if(s&&(!n.targetMapId||this.mapId===n.targetMapId))if("<cancel>"===n.type){const l=this.cancelCallbacks[s];delete this.cancelCallbacks[s],l&&l.cancel()}else if(n.mustQueue||io()){const l=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,n),l&&l.metadata||{type:"message"})}else this.processTask(s,n)}processTask(i,n){if("<response>"===n.type){const s=this.callbacks[i];delete this.callbacks[i],s&&(n.error?s(Is(n.error)):s(null,Is(n.data)))}else{const s=wo(this.globalScope)?void 0:[],l=n.hasCallback?(p,_)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:p?Ri(p):null,data:Ri(_,s)},s)}:p=>{},h=Is(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,h,l);else if(this.parent.getWorkerSource){const p=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,p[0],h.source)[p[1]](h,l)}else l(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},d.CanonicalTileID=ou,d.Color=Wt,d.ColorMode=ai,d.CullFaceMode=fo,d.DEMData=vh,d.DataConstantProperty=nt,d.DedupedRequest=xf,d.DepthMode=ic,d.EXTENT=Rt,d.Elevation=class{getAtPointOrZero(i,n=0){return this.getAtPoint(i,n)||0}getAtPoint(i,n,s=!0){null==n&&(n=null);const l=this._source();if(!l||i.y<0||i.y>1)return n;const h=l.getSource().maxzoom,p=1<<h,_=Math.floor(i.x),v=i.x-_,w=new bi(h,_,h,Math.floor(v*p),Math.floor(i.y*p)),C=this.findDEMTileFor(w);if(!C||!C.dem)return n;const S=C.dem,I=1<<C.tileID.canonical.z,A=(v*I-C.tileID.canonical.x)*S.dim,O=(i.y*I-C.tileID.canonical.y)*S.dim,N=Math.floor(A),U=Math.floor(O);return(s?this.exaggeration():1)*zt(zt(S.get(N,U),S.get(N,U+1),O-U),zt(S.get(N+1,U),S.get(N+1,U+1),O-U),A-N)}getAtTileOffset(i,n,s){const l=1<<i.canonical.z;return this.getAtPointOrZero(new qc(i.wrap+(i.canonical.x+n/Rt)/l,(i.canonical.y+s/Rt)/l))}getAtTileOffsetFunc(i,n){return s=>{const l=this.getAtTileOffset(i,s.x,s.y),h=n.upVector(i.canonical,s.x,s.y);return no(h,h,l*n.upVectorScale(i.canonical)),h}}getForTilePoints(i,n,s,l){const h=kd.create(this,i,l);return!!h&&(n.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],s)}),!0)}getMinMaxForTile(i){const n=this.findDEMTileFor(i);if(!n||!n.dem)return null;const s=n.dem.tree,l=n.tileID,h=1<<i.canonical.z-l.canonical.z;let p=i.canonical.x/h-l.canonical.x,_=i.canonical.y/h-l.canonical.y,v=0;for(let w=0;w<i.canonical.z-l.canonical.z&&!s.leaves[v];w++){p*=2,_*=2;const C=2*Math.floor(_)+Math.floor(p);v=s.childOffsets[v]+C,p%=1,_%=1}return{min:this.exaggeration()*s.minimums[v],max:this.exaggeration()*s.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,n,s){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},d.ErrorEvent=vu,d.EvaluationParameters=ft,d.Event=nr,d.Evented=xs,d.Frustum=Ip,d.GLOBE_ZOOM_THRESHOLD_MAX=6,d.GlobeSharedBuffers=Oo,d.GlyphManager=ec,d.ImagePosition=gd,d.LineAtlas=ag,d.LngLat=nn,d.LngLatBounds=Hl,d.LocalGlyphMode=Yp,d.MAX_MERCATOR_LATITUDE=os,d.MercatorCoordinate=qc,d.ONE_EM=24,d.OverscaledTileID=bi,d.Properties=sr,d.RGBAImage=Wi,d.Ray=class{constructor(i,n){this.pos=i,this.dir=n}intersectsPlane(i,n,s){const l=xo(n,this.dir);if(Math.abs(l)<1e-6)return!1;const h=((i[0]-this.pos[0])*n[0]+(i[1]-this.pos[1])*n[1]+(i[2]-this.pos[2])*n[2])/l;return s[0]=this.pos[0]+this.dir[0]*h,s[1]=this.pos[1]+this.dir[1]*h,s[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(i,n,s){if(N=(A=this.pos)[0],U=A[1],q=A[2],J=(O=i)[0],ie=O[1],ce=O[2],Math.abs(N-J)<=Ti*Math.max(1,Math.abs(N),Math.abs(J))&&Math.abs(U-ie)<=Ti*Math.max(1,Math.abs(U),Math.abs(ie))&&Math.abs(q-ce)<=Ti*Math.max(1,Math.abs(q),Math.abs(ce))||0===n)return s[0]=s[1]=s[2]=0,!1;var A,O,N,U,q,J,ie,ce;const[l,h,p]=this.dir,_=this.pos[0]-i[0],v=this.pos[1]-i[1],w=this.pos[2]-i[2],C=l*l+h*h+p*p,S=2*(_*l+v*h+w*p),I=S*S-4*C*(_*_+v*v+w*w-n*n);if(I<0){const A=Math.max(-S/2,0),O=_+l*A,N=v+h*A,U=w+p*A,q=Math.hypot(O,N,U);return s[0]=O*n/q,s[1]=N*n/q,s[2]=U*n/q,!1}{const A=(-S-Math.sqrt(I))/(2*C);if(A<0){const O=Math.hypot(_,v,w);return s[0]=_*n/O,s[1]=v*n/O,s[2]=w*n/O,!1}return s[0]=_+l*A,s[1]=v+h*A,s[2]=w+p*A,!0}}},d.RequestManager=class{constructor(i,n,s){this._transformRequestFn=i,this._customAccessToken=n,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const i=function(){let n="";for(let s=0;s<10;s++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ue,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,n){return this._transformRequestFn&&this._transformRequestFn(i,n)||{url:i}}normalizeStyleURL(i,n){if(!Te(i))return i;const s=rt(i);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||n)}normalizeGlyphsURL(i,n){if(!Te(i))return i;const s=rt(i);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||n)}normalizeSourceURL(i,n){if(!Te(i))return i;const s=rt(i);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||n)}normalizeSpriteURL(i,n,s,l){const h=rt(i);return Te(i)?(h.path=`/styles/v1${h.path}/sprite${n}${s}`,this._makeAPIURL(h,this._customAccessToken||l)):(h.path+=`${n}${s}`,ut(h))}normalizeTileURL(i,n,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Te(i))return i;const l=rt(i);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||s&&"raster"!==l.authority&&512===s?"@2x":""}${V.supported?".webp":"$1"}`),"raster"===l.authority?l.path=`/${L.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${L.TILE_URL_VERSION}${l.path}`);const h=this._customAccessToken||function(p){for(const _ of p){const v=_.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(l.params)||L.ACCESS_TOKEN;return L.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,h)}canonicalizeTileURL(i,n){const s=rt(i);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return i;let l="mapbox://";s.path.match(/^\/raster\/v1\//)?l+=`raster/${s.path.replace(`/${L.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${s.path.replace(`/${L.TILE_URL_VERSION}/`,"")}`;let h=s.params;return n&&(h=h.filter(p=>!p.match(/^access_token=/))),h.length&&(l+=`?${h.join("&")}`),l}canonicalizeTileset(i,n){const s=!!n&&Te(n),l=[];for(const h of i.tiles||[])Ie(h)?l.push(this.canonicalizeTileURL(h,s)):l.push(h);return l}_makeAPIURL(i,n){const s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",l=rt(L.API_URL);if(i.protocol=l.protocol,i.authority=l.authority,"http"===i.protocol){const h=i.params.indexOf("secure");h>=0&&i.params.splice(h,1)}if("/"!==l.path&&(i.path=`${l.path}${i.path}`),!L.REQUIRE_ACCESS_TOKEN)return ut(i);if(n=n||L.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===n[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return i.params=i.params.filter(h=>-1===h.indexOf("access_token")),i.params.push(`access_token=${n||""}`),ut(i)}},d.ResourceType=ja,d.SegmentVector=dt,d.SourceCache=Ea,d.StencilMode=lf,d.StructArrayLayout1ui2=yp,d.StructArrayLayout2f1f2i16=nl,d.StructArrayLayout2i4=Nc,d.StructArrayLayout2ui4=Ul,d.StructArrayLayout3f12=Vc,d.StructArrayLayout3ui6=Ur,d.StructArrayLayout4i8=ma,d.Texture=sf,d.Tile=Rd,d.Transitionable=ri,d.Uniform1f=ya,d.Uniform1i=class extends rs{constructor(i,n){super(i,n),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},d.Uniform2f=class extends rs{constructor(i,n){super(i,n),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},d.Uniform3f=class extends rs{constructor(i,n){super(i,n),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},d.Uniform4f=w_,d.UniformColor=bp,d.UniformMatrix2f=class extends rs{constructor(i,n){super(i,n),this.current=D_}set(i){for(let n=0;n<4;n++)if(i[n]!==this.current[n]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},d.UniformMatrix3f=class extends rs{constructor(i,n){super(i,n),this.current=C_}set(i){for(let n=0;n<9;n++)if(i[n]!==this.current[n]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},d.UniformMatrix4f=class extends rs{constructor(i,n){super(i,n),this.current=E_}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let n=1;n<16;n++)if(i[n]!==this.current[n]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},d.UnwrappedTileID=af,d.ValidationError=qe,d.VectorTileWorkerSource=class extends xs{constructor(i,n,s,l,h){super(),this.actor=i,this.layerIndex=n,this.availableImages=s,this.loadVectorData=h||yg,this.loading={},this.loaded={},this.deduped=new xf(i.scheduler),this.isSpriteLoaded=l,this.scheduler=i.scheduler}loadTile(i,n){const s=i.uid,l=i&&i.request,h=l&&l.collectResourceTiming,p=this.loading[s]=new Cy(i);p.abort=this.loadVectorData(i,(_,v)=>{const w=!this.loading[s];if(delete this.loading[s],w||_||!v)return p.status="done",w||(this.loaded[s]=p),n(_);const C=v.rawData,S={};v.expires&&(S.expires=v.expires),v.cacheControl&&(S.cacheControl=v.cacheControl),p.vectorTile=v.vectorTile||new al.VectorTile(new Kl(C));const I=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(A,O)=>{if(A||!O)return n(A);const N={};if(h){const U=vy(l);U.length>0&&(N.resourceTiming=JSON.parse(JSON.stringify(U)))}n(null,Un({rawTileData:C.slice(0)},O,S,N))})};this.isSpriteLoaded?I():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(I,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):I()}),this.loaded=this.loaded||{},this.loaded[s]=p})}reloadTile(i,n){const s=this.loaded,l=i.uid,h=this;if(s&&s[l]){const p=s[l];p.showCollisionBoxes=i.showCollisionBoxes,p.enableTerrain=!!i.enableTerrain,p.projection=i.projection;const _=(v,w)=>{const C=p.reloadCallback;C&&(delete p.reloadCallback,p.parse(p.vectorTile,h.layerIndex,this.availableImages,h.actor,C)),n(v,w)};"parsing"===p.status?p.reloadCallback=_:"done"===p.status&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(i,n){const s=i.uid,l=this.loading[s];l&&(l.abort&&l.abort(),delete this.loading[s]),n()}removeTile(i,n){const s=this.loaded,l=i.uid;s&&s[l]&&delete s[l],n()}},d.WritingMode=vi,d.ZoomHistory=f,d.add=El,d.addDynamicAttributes=mh,d.adjoint=function(i,n){var s=n[0],l=n[1],h=n[2],p=n[3],_=n[4],v=n[5],w=n[6],C=n[7],S=n[8];return i[0]=_*S-v*C,i[1]=h*C-l*S,i[2]=l*v-h*_,i[3]=v*w-p*S,i[4]=s*S-h*w,i[5]=h*p-s*v,i[6]=p*C-_*w,i[7]=l*w-s*C,i[8]=s*_-l*p,i},d.asyncAll=Ba,d.bezier=bc,d.bindAll=Ml,d.boundsAttributes=pg,d.bufferConvexPolygon=function(i,n){const s=[];for(let l=0;l<i.length;l++){const h=gs(l-1,-1,i.length-1),p=gs(l+1,-1,i.length-1),_=i[l],v=i[p],w=i[h].sub(_).unit(),C=v.sub(_).unit(),S=C.angleWithSep(w.x,w.y),I=w.add(C).unit().mult(-1*n/Math.sin(S/2));s.push(_.add(I))}return s},d.cacheEntryPossiblyAdded=function(i){an++,an>Al&&(i.getActor().send("enforceCacheSizeLimit",Lh),an=0)},d.calculateGlobeMatrix=mg,d.calculateGlobeMercatorMatrix=function(i){const n=i.worldSize,s=cn(i.center.lat,-85.051129,os),l=new Ke(Hc(i.center.lng)*n,il(s)*n),h=Zi(1,i.center.lat)*n,p=i.pixelsPerMeter,_=n/(h/i.pixelsPerMeter),v=hi(new Float64Array(16));return eo(v,v,[l.x,l.y,0]),xr(v,v,[_,_,p]),v},d.clamp=cn,d.clearTileCache=function(i){const n=Ae.caches.delete($n);i&&n.catch(i).then(()=>i())},d.clipLine=Jp,d.clone=function(i){var n=new Sn(16);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],n},d.clone$1=Si,d.collisionCircleLayout=Sx,d.config=L,d.conjugate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=n[3],i},d.create=function(){var i=new Sn(16);return Sn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},d.create$1=xl,d.createExpression=Wa,d.createLayout=Rn,d.createStyleLayer=function(i){return"custom"===i.type?new kx(i):new my[i.type](i)},d.cross=Ra,d.degToRad=Ot,d.div=function(i,n,s){return i[0]=n[0]/s[0],i[1]=n[1]/s[1],i[2]=n[2]/s[2],i},d.dot=xo,d.ease=za,d.easeCubicInOut=Oa,d.emitValidationErrors=Oc,d.endsWith=Sl,d.enforceCacheSizeLimit=function(i){un(),Eo&&Eo.then(n=>{n.keys().then(s=>{for(let l=0;l<s.length-i;l++)n.delete(s[l])})})},d.evaluateSizeForFeature=yi,d.evaluateSizeForZoom=ll,d.evaluateVariableOffset=Ro,d.evented=Vr,d.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]},d.exactEquals$1=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]},d.exported=Ai,d.exported$1=V,d.extend=Un,d.extend$1=Ws,d.filterObject=Hs,d.fromMat4=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[4],i[4]=n[5],i[5]=n[6],i[6]=n[8],i[7]=n[9],i[8]=n[10],i},d.fromQuat=function(i,n){var s=n[0],l=n[1],h=n[2],p=n[3],_=s+s,v=l+l,w=h+h,C=s*_,S=l*_,I=l*v,A=h*_,O=h*v,N=h*w,U=p*_,q=p*v,J=p*w;return i[0]=1-I-N,i[1]=S+J,i[2]=A-q,i[3]=0,i[4]=S-J,i[5]=1-C-N,i[6]=O+U,i[7]=0,i[8]=A+q,i[9]=O-U,i[10]=1-C-I,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},d.fromRotation=function(i,n){var s=Math.sin(n),l=Math.cos(n);return i[0]=l,i[1]=s,i[2]=0,i[3]=-s,i[4]=l,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},d.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=n[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},d.furthestTileCorner=function(i){const n=Math.round((i+45+360)%360/90)%4;return La[n]},d.getAABBPointSquareDist=function(i,n,s){let l=0;for(let h=0;h<2;++h){const p=s?s[h]:0;i[h]>p&&(l+=(i[h]-p)*(i[h]-p)),n[h]<p&&(l+=(p-n[h])*(p-n[h]))}return l},d.getAnchorAlignment=dh,d.getAnchorJustification=Qp,d.getBounds=function(i){let n=1/0,s=1/0,l=-1/0,h=-1/0;for(const p of i)n=Math.min(n,p.x),s=Math.min(s,p.y),l=Math.max(l,p.x),h=Math.max(h,p.y);return{min:new Ke(n,s),max:new Ke(l,h)}},d.getColumn=function(i,n){return[i[4*n],i[4*n+1],i[4*n+2],i[4*n+3]]},d.getImage=op,d.getJSON=function(i,n){return gt(Un(i,{type:"json"}),n)},d.getMapSessionAPI=vs,d.getPerformanceMeasurement=vy,d.getProjection=function(i){const n=Tf[i.name];if(!n)throw new Error(`Invalid projection name: ${i.name}`);return n.conic?function(s,l){if(l.parallels&&Math.abs(l.parallels[0]+l.parallels[1])<.01){let h=function(p){const _=Math.max(.01,Math.cos(Ot(p))),v=1/(2*Math.max(Math.PI*_,1/_));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(w,C){const S=Ot(w)*_,I=Math.sin(Ot(C))/_;return{x:S*v+.5,y:-I*v+.5,z:0}},unproject(w,C){const S=-(C-.5)/v,I=cn(Mi((w-.5)/v)/_,-180,180),A=Math.asin(cn(S*_,-1,1)),O=cn(Mi(A),-85.051129,os);return new nn(I,O)}}}(l.parallels[0]);if("lambertConformalConic"===l.name){const{project:p,unproject:_}=Tf.mercator;h={wrap:!0,supportsWorldCopies:!0,project:p,unproject:_}}return Un({},s,l,h)}return Un({},s,l)}(n,i):n},d.getRTLTextPluginStatus=ni,d.getReferrer=wn,d.getTilePoint=function(i,{x:n,y:s},l=0){return new Ke(((n-l)*i.scale-i.x)*Rt,(s*i.scale-i.y)*Rt)},d.getTileVec3=function(i,n,s=0){return to(((n.x-s)*i.scale-i.x)*Rt,(n.y*i.scale-i.y)*Rt,pm(n.z,n.y))},d.getVideo=function(i,n){const s=Ae.document.createElement("video");s.muted=!0,s.onloadstart=function(){n(null,s)};for(let l=0;l<i.length;l++){const h=Ae.document.createElement("source");Dc(i[l])||(s.crossOrigin="Anonymous"),h.src=i[l],s.appendChild(h)}return{cancel:()=>{}}},d.globeBuffersForTileMesh=function(i,n,s,l){const h=i.context,p=i.transform;let _=n.globeGridBuffer,v=n.globePoleBuffer;if(!_){const w=Oo.createGridVertices(s.canonical);_=n.globeGridBuffer=h.createVertexBuffer(w,Ld,!1)}if(!v){const w=Oo.createPoleTriangleVertices(l,p.tileSize*l,0===s.canonical.y);v=n.globePoleBuffer=h.createVertexBuffer(w,Ld,!1)}return[_,v]},d.globeDenormalizeECEF=vf,d.globeMatrixForTile=function(i,n){const s=vf(Od(i)),l=((h=new Float64Array(16))[0]=(p=n)[0],h[1]=p[1],h[2]=p[2],h[3]=p[3],h[4]=p[4],h[5]=p[5],h[6]=p[6],h[7]=p[7],h[8]=p[8],h[9]=p[9],h[10]=p[10],h[11]=p[11],h[12]=p[12],h[13]=p[13],h[14]=p[14],h[15]=p[15],h);var h,p;return Go(l,l,s),l},d.globePoleMatrixForTile=function(i,n,s){const l=hi(new Float64Array(16)),h=Math.pow(2,i.z),p=(i.x-h/2)/h*Math.PI*2,_=s.point,v=s.worldSize/(s.tileSize*h);return eo(l,l,[_.x,_.y,-s.worldSize/Math.PI/2]),xr(l,l,[v,v,v]),Uo(l,l,Ot(-s._center.lat)),yo(l,l,Ot(-s._center.lng)),yo(l,l,p),n&&xr(l,l,[1,-1,1]),l},d.globeTileBounds=Od,d.globeToMercatorTransition=function(i){return Gs(5,6,i)},d.identity=hi,d.identity$1=gu,d.invert=function(i,n){var s=n[0],l=n[1],h=n[2],p=n[3],_=n[4],v=n[5],w=n[6],C=n[7],S=n[8],I=n[9],A=n[10],O=n[11],N=n[12],U=n[13],q=n[14],J=n[15],ie=s*v-l*_,ce=s*w-h*_,he=s*C-p*_,pe=l*w-h*v,de=l*C-p*v,Ce=h*C-p*w,we=S*U-I*N,Ge=S*q-A*N,Be=S*J-O*N,De=I*q-A*U,Ve=I*J-O*U,Ze=A*J-O*q,Pe=ie*Ze-ce*Ve+he*De+pe*Be-de*Ge+Ce*we;return Pe?(i[0]=(v*Ze-w*Ve+C*De)*(Pe=1/Pe),i[1]=(h*Ve-l*Ze-p*De)*Pe,i[2]=(U*Ce-q*de+J*pe)*Pe,i[3]=(A*de-I*Ce-O*pe)*Pe,i[4]=(w*Be-_*Ze-C*Ge)*Pe,i[5]=(s*Ze-h*Be+p*Ge)*Pe,i[6]=(q*he-N*Ce-J*ce)*Pe,i[7]=(S*Ce-A*he+O*ce)*Pe,i[8]=(_*Ve-v*Be+C*we)*Pe,i[9]=(l*Be-s*Ve-p*we)*Pe,i[10]=(N*de-U*he+J*ie)*Pe,i[11]=(I*he-S*de-O*ie)*Pe,i[12]=(v*Ge-_*De-w*we)*Pe,i[13]=(s*De-l*Ge+h*we)*Pe,i[14]=(U*ce-N*pe-q*ie)*Pe,i[15]=(S*pe-I*ce+A*ie)*Pe,i):null},d.isMapAuthenticated=function(i){return Ho.has(i)},d.isMapboxURL=Te,d.latFromMercatorY=Oi,d.len=Wr,d.length=wl,d.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},d.loadVectorTile=yg,d.makeRequest=gt,d.mercatorXfromLng=Hc,d.mercatorYfromLat=il,d.mercatorZfromAltitude=Zi,d.mul=Go,d.mul$1=ro,d.multiply=function(i,n,s){var l=n[0],h=n[1],p=n[2],_=n[3],v=n[4],w=n[5],C=n[6],S=n[7],I=n[8],A=s[0],O=s[1],N=s[2],U=s[3],q=s[4],J=s[5],ie=s[6],ce=s[7],he=s[8];return i[0]=A*l+O*_+N*C,i[1]=A*h+O*v+N*S,i[2]=A*p+O*w+N*I,i[3]=U*l+q*_+J*C,i[4]=U*h+q*v+J*S,i[5]=U*p+q*w+J*I,i[6]=ie*l+ce*_+he*C,i[7]=ie*h+ce*v+he*S,i[8]=ie*p+ce*w+he*I,i},d.multiply$1=bl,d.multiply$2=vo,d.nextPowerOfTwo=Ni,d.normalize=Ns,d.normalize$1=function(i,n){var s=n[0],l=n[1],h=n[2],p=n[3],_=s*s+l*l+h*h+p*p;return _>0&&(_=1/Math.sqrt(_)),i[0]=s*_,i[1]=l*_,i[2]=h*_,i[3]=p*_,i},d.number=zt,d.ortho=function(i,n,s,l,h,p,_){var v=1/(n-s),w=1/(l-h),C=1/(p-_);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*C,i[11]=0,i[12]=(n+s)*v,i[13]=(h+l)*w,i[14]=(_+p)*C,i[15]=1,i},d.pbf=Kl,d.perspective=function(i,n,s,l,h){var p,_=1/Math.tan(n/2);return i[0]=_/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,null!=h&&h!==1/0?(i[10]=(h+l)*(p=1/(l-h)),i[14]=2*h*l*p):(i[10]=-1,i[14]=-2*l),i},d.pick=function(i,n){const s={};for(let l=0;l<n.length;l++){const h=n[l];h in i&&(s[h]=i[h])}return s},d.plugin=Ut,d.pointGeometry=Ke,d.polygonIntersectsBox=P_,d.polygonIntersectsPolygon=gm,d.polygonizeBounds=function(i,n,s=0,l=!0){const h=new Ke(s,s),p=i.sub(h),_=n.add(h),v=[p,new Ke(_.x,p.y),_,new Ke(p.x,_.y)];return l&&v.push(p),v},d.posAttributes=hg,d.postMapLoadEvent=gn,d.postTurnstileEvent=bn,d.potpack=md,d.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},d.radToDeg=Mi,d.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.registerForPluginStateChange=function(i){return i({pluginStatus:yt,pluginURL:Lt}),Vr.on("pluginStateChange",i),i},d.removeAuthState=function(i){Ho.delete(i)},d.renderColorRamp=Ap,d.rotateX=Uo,d.rotateX$1=Cl,d.rotateY=yo,d.rotateZ=function(i,n,s){var l=Math.sin(s),h=Math.cos(s),p=n[0],_=n[1],v=n[2],w=n[3],C=n[4],S=n[5],I=n[6],A=n[7];return n!==i&&(i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[0]=p*h+C*l,i[1]=_*h+S*l,i[2]=v*h+I*l,i[3]=w*h+A*l,i[4]=C*h-p*l,i[5]=S*h-_*l,i[6]=I*h-v*l,i[7]=A*h-w*l,i},d.rotateZ$1=function(i,n,s){s*=.5;var l=n[0],h=n[1],p=n[2],_=n[3],v=Math.sin(s),w=Math.cos(s);return i[0]=l*w+h*v,i[1]=h*w-l*v,i[2]=p*w+_*v,i[3]=_*w-p*v,i},d.scale=xr,d.scale$1=function(i,n,s){return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=n[3]*s,i},d.scale$2=no,d.scaleAndAdd=xn,d.setCacheLimits=function(i,n){Lh=i,Al=n},d.setColumn=function(i,n,s){i[4*n+0]=s[0],i[4*n+1]=s[1],i[4*n+2]=s[2],i[4*n+3]=s[3]},d.setRTLTextPlugin=function(i,n,s=!1){if(yt===st||yt===mt||yt===ln)throw new Error("setRTLTextPlugin cannot be called multiple times.");Lt=Ai.resolveURL(i),yt=st,_n=n,Jn(),s||$i()},d.smoothstep=Gs,d.spec=Ee,d.storeAuthState=function(i,n){n?Ho.add(i):Ho.delete(i)},d.sub=js,d.subtract=fs,d.symbolSize=Up,d.tileAABB=function(i,n,s,l,h,p,_,v,w){if("globe"===w.name){const O=Od(new af(p,new ou(s,l,h)).canonical).getCorners(),N=Number.MAX_VALUE,U=[-N,-N,-N],q=[N,N,N],J=mg(i,n);for(let ie=0;ie<O.length;ie++)Ht(O[ie],O[ie],J),S=q,I=O[ie],(C=q)[0]=Math.min(S[0],I[0]),C[1]=Math.min(S[1],I[1]),C[2]=Math.min(S[2],I[2]),Rh(U,U,O[ie]);return new ss(q,U)}var C,S,I;const A=pl({z:s,x:l,y:h},w);return new ss([(p+A.x/A.scale)*n,n*(A.y/A.scale),_],[(p+A.x2/A.scale)*n,n*(A.y2/A.scale),v])},d.tileTransform=pl,d.transformMat3=function(i,n,s){var l=n[0],h=n[1],p=n[2];return i[0]=l*s[0]+h*s[3]+p*s[6],i[1]=l*s[1]+h*s[4]+p*s[7],i[2]=l*s[2]+h*s[5]+p*s[8],i},d.transformMat4=Ht,d.transformMat4$1=zr,d.transformQuat=Vs,d.translate=eo,d.transpose=function(i,n){if(i===n){var s=n[1],l=n[2],h=n[5];i[1]=n[3],i[2]=n[6],i[3]=s,i[5]=n[7],i[6]=l,i[7]=h}else i[0]=n[0],i[1]=n[3],i[2]=n[6],i[3]=n[1],i[4]=n[4],i[5]=n[7],i[6]=n[2],i[7]=n[5],i[8]=n[8];return i},d.triggerPluginCompletionEvent=yn,d.uniqueId=Tl,d.validateCustomStyleLayer=function(i){const n=[],s=i.id;return void 0===s&&n.push({message:`layers.${s}: missing required property "id"`}),void 0===i.render&&n.push({message:`layers.${s}: missing required method "render"`}),i.renderingMode&&"2d"!==i.renderingMode&&"3d"!==i.renderingMode&&n.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),n},d.validateFog=Vl,d.validateLight=ha,d.validateStyle=zn,d.values=Bi,d.vectorTile=al,d.version="2.7.0",d.warnOnce=An,d.window=Ae,d.wrap=gs}),Fh(0,function(d){function Zn(K){const L=typeof K;if("number"===L||"boolean"===L||"string"===L||null==K)return JSON.stringify(K);if(Array.isArray(K)){let Q="[";for(const le of K)Q+=`${Zn(le)},`;return`${Q}]`}const V=Object.keys(K).sort();let X="{";for(let Q=0;Q<V.length;Q++)X+=`${JSON.stringify(V[Q])}:${Zn(K[V[Q]])},`;return`${X}}`}function jo(K){let L="";for(const V of d.refProperties)L+=`/${Zn(K[V])}`;return L}class ui{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,V){for(const Q of L)this._layerConfigs[Q.id]=Q,(this._layers[Q.id]=d.createStyleLayer(Q)).compileFilter(),this.keyCache[Q.id]&&delete this.keyCache[Q.id];for(const Q of V)delete this.keyCache[Q],delete this._layerConfigs[Q],delete this._layers[Q];this.familiesBySource={};const X=function(Q,le){const me={};for(let ue=0;ue<Q.length;ue++){const _e=le&&le[Q[ue].id]||jo(Q[ue]);le&&(le[Q[ue].id]=_e);let Te=me[_e];Te||(Te=me[_e]=[]),Te.push(Q[ue])}const fe=[];for(const ue in me)fe.push(me[ue]);return fe}(d.values(this._layerConfigs),this.keyCache);for(const Q of X){const le=Q.map(Ie=>this._layers[Ie.id]),me=le[0];if("none"===me.visibility)continue;const fe=me.source||"";let ue=this.familiesBySource[fe];ue||(ue=this.familiesBySource[fe]={});const _e=me.sourceLayer||"_geojsonTileLayer";let Te=ue[_e];Te||(Te=ue[_e]=[]),Te.push(le)}}}const{ImageBitmap:Ke}=d.window;class vt{loadTile(L,V){const{uid:X,encoding:Q,rawImageData:le,padding:me,buildQuadTree:fe}=L,ue=Ke&&le instanceof Ke?this.getImageData(le,me):le;V(null,new d.DEMData(X,ue,Q,me<1,fe))}getImageData(L,V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(L.width,L.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=L.width,this.offscreenCanvas.height=L.height,this.offscreenCanvasContext.drawImage(L,0,0,L.width,L.height);const X=this.offscreenCanvasContext.getImageData(-V,-V,L.width+2*V,L.height+2*V);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new d.RGBAImage({width:X.width,height:X.height},X.data)}}var Ae=function K(L,V){var X,Q=L&&L.type;if("FeatureCollection"===Q)for(X=0;X<L.features.length;X++)K(L.features[X],V);else if("GeometryCollection"===Q)for(X=0;X<L.geometries.length;X++)K(L.geometries[X],V);else if("Feature"===Q)K(L.geometry,V);else if("Polygon"===Q)Ti(L.coordinates,V);else if("MultiPolygon"===Q)for(X=0;X<L.coordinates.length;X++)Ti(L.coordinates[X],V);return L};function Ti(K,L){if(0!==K.length){Sn(K[0],L);for(var V=1;V<K.length;V++)Sn(K[V],!L)}}function Sn(K,L){for(var V=0,X=0,Q=0,le=K.length,me=le-1;Q<le;me=Q++){var fe=(K[Q][0]-K[me][0])*(K[me][1]+K[Q][1]),ue=V+fe;X+=Math.abs(V)>=Math.abs(fe)?V-ue+fe:fe-ue+V,V=ue}V+X>=0!=!!L&&K.reverse()}const xl=d.vectorTile.VectorTileFeature.prototype.toGeoJSON;class hi{constructor(L){this._feature=L,this.extent=d.EXTENT,this.type=L.type,this.properties=L.tags,"id"in L&&!isNaN(L.id)&&(this.id=parseInt(L.id,10))}loadGeometry(){if(1===this._feature.type){const L=[];for(const V of this._feature.geometry)L.push([new d.pointGeometry(V[0],V[1])]);return L}{const L=[];for(const V of this._feature.geometry){const X=[];for(const Q of V)X.push(new d.pointGeometry(Q[0],Q[1]));L.push(X)}return L}}toGeoJSON(L,V,X){return xl.call(this,L,V,X)}}class bl{constructor(L){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.EXTENT,this.length=L.length,this._features=L}feature(L){return new hi(this._features[L])}}var eo=d.vectorTile.VectorTileFeature,xr=Uo;function Uo(K,L){this.options=L||{},this.features=K,this.length=K.length}function yo(K,L){this.id="number"==typeof K.id?K.id:void 0,this.type=K.type,this.rawGeometry=1===K.type?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=L||4096}Uo.prototype.feature=function(K){return new yo(this.features[K],this.options.extent)},yo.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var L=0;L<K.length;L++){for(var V=K[L],X=[],Q=0;Q<V.length;Q++)X.push(new d.pointGeometry(V[Q][0],V[Q][1]));this.geometry.push(X)}return this.geometry},yo.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,L=1/0,V=-1/0,X=1/0,Q=-1/0,le=0;le<K.length;le++)for(var me=K[le],fe=0;fe<me.length;fe++){var ue=me[fe];L=Math.min(L,ue.x),V=Math.max(V,ue.x),X=Math.min(X,ue.y),Q=Math.max(Q,ue.y)}return[L,X,V,Q]},yo.prototype.toGeoJSON=eo.prototype.toGeoJSON;var Go=$o,Bs=xr;function $o(K){var L=new d.pbf;return function(V,X){for(var Q in V.layers)X.writeMessage(3,wl,V.layers[Q])}(K,L),L.finish()}function wl(K,L){var V;L.writeVarintField(15,K.version||1),L.writeStringField(1,K.name||""),L.writeVarintField(5,K.extent||4096);var X={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<K.length;V++)X.feature=K.feature(V),L.writeMessage(2,to,X);var Q=X.keys;for(V=0;V<Q.length;V++)L.writeStringField(3,Q[V]);var le=X.values;for(V=0;V<le.length;V++)L.writeMessage(4,no,le[V])}function to(K,L){var V=K.feature;void 0!==V.id&&L.writeVarintField(1,V.id),L.writeMessage(2,El,K),L.writeVarintField(3,V.type),L.writeMessage(4,Rh,V)}function El(K,L){var V=K.feature,X=K.keys,Q=K.values,le=K.keycache,me=K.valuecache;for(var fe in V.properties){var ue=V.properties[fe],_e=le[fe];if(null!==ue){void 0===_e&&(X.push(fe),le[fe]=_e=X.length-1),L.writeVarint(_e);var Te=typeof ue;"string"!==Te&&"boolean"!==Te&&"number"!==Te&&(ue=JSON.stringify(ue));var Ie=Te+":"+ue,Le=me[Ie];void 0===Le&&(Q.push(ue),me[Ie]=Le=Q.length-1),L.writeVarint(Le)}}}function fs(K,L){return(L<<3)+(7&K)}function vo(K){return K<<1^K>>31}function Rh(K,L){for(var V=K.loadGeometry(),X=K.type,Q=0,le=0,me=V.length,fe=0;fe<me;fe++){var ue=V[fe],_e=1;1===X&&(_e=ue.length),L.writeVarint(fs(1,_e));for(var Te=3===X?ue.length-1:ue.length,Ie=0;Ie<Te;Ie++){1===Ie&&1!==X&&L.writeVarint(fs(2,Te-1));var Le=ue[Ie].x-Q,rt=ue[Ie].y-le;L.writeVarint(vo(Le)),L.writeVarint(vo(rt)),Q+=Le,le+=rt}3===X&&L.writeVarint(fs(7,1))}}function no(K,L){var V=typeof K;"string"===V?L.writeStringField(1,K):"boolean"===V?L.writeBooleanField(7,K):"number"===V&&(K%1!=0?L.writeDoubleField(3,K):K<0?L.writeSVarintField(6,K):L.writeVarintField(5,K))}function xn(K,L,V,X,Q,le){if(Q-X<=V)return;const me=X+Q>>1;Ns(K,L,me,X,Q,le%2),xn(K,L,V,X,me-1,le+1),xn(K,L,V,me+1,Q,le+1)}function Ns(K,L,V,X,Q,le){for(;Q>X;){if(Q-X>600){const _e=Q-X+1,Te=V-X+1,Ie=Math.log(_e),Le=.5*Math.exp(2*Ie/3),rt=.5*Math.sqrt(Ie*Le*(_e-Le)/_e)*(Te-_e/2<0?-1:1);Ns(K,L,V,Math.max(X,Math.floor(V-Te*Le/_e+rt)),Math.min(Q,Math.floor(V+(_e-Te)*Le/_e+rt)),le)}const me=L[2*V+le];let fe=X,ue=Q;for(xo(K,L,X,V),L[2*Q+le]>me&&xo(K,L,X,Q);fe<ue;){for(xo(K,L,fe,ue),fe++,ue--;L[2*fe+le]<me;)fe++;for(;L[2*ue+le]>me;)ue--}L[2*X+le]===me?xo(K,L,X,ue):(ue++,xo(K,L,ue,Q)),ue<=V&&(X=ue+1),V<=ue&&(Q=ue-1)}}function xo(K,L,V,X){Ra(K,V,X),Ra(L,2*V,2*X),Ra(L,2*V+1,2*X+1)}function Ra(K,L,V){const X=K[L];K[L]=K[V],K[V]=X}function Ht(K,L,V,X){const Q=K-V,le=L-X;return Q*Q+le*le}Go.fromVectorTileJs=$o,Go.fromGeojsonVt=function(K,L){L=L||{};var V={};for(var X in K)V[X]=new xr(K[X].features,L),V[X].name=X,V[X].version=L.version,V[X].extent=L.extent;return $o({layers:V})},Go.GeoJSONWrapper=Bs;const Vs=K=>K[0],ms=K=>K[1];class js{constructor(L,V=Vs,X=ms,Q=64,le=Float64Array){this.nodeSize=Q,this.points=L;const me=L.length<65536?Uint16Array:Uint32Array,fe=this.ids=new me(L.length),ue=this.coords=new le(2*L.length);for(let _e=0;_e<L.length;_e++)fe[_e]=_e,ue[2*_e]=V(L[_e]),ue[2*_e+1]=X(L[_e]);xn(fe,ue,Q,0,fe.length-1,0)}range(L,V,X,Q){return function(le,me,fe,ue,_e,Te,Ie){const Le=[0,le.length-1,0],rt=[];let ut,ct;for(;Le.length;){const ht=Le.pop(),Pt=Le.pop(),bn=Le.pop();if(Pt-bn<=Ie){for(let Tn=bn;Tn<=Pt;Tn++)ut=me[2*Tn],ct=me[2*Tn+1],ut>=fe&&ut<=_e&&ct>=ue&&ct<=Te&&rt.push(le[Tn]);continue}const In=Math.floor((bn+Pt)/2);ut=me[2*In],ct=me[2*In+1],ut>=fe&&ut<=_e&&ct>=ue&&ct<=Te&&rt.push(le[In]);const gn=(ht+1)%2;(0===ht?fe<=ut:ue<=ct)&&(Le.push(bn),Le.push(In-1),Le.push(gn)),(0===ht?_e>=ut:Te>=ct)&&(Le.push(In+1),Le.push(Pt),Le.push(gn))}return rt}(this.ids,this.coords,L,V,X,Q,this.nodeSize)}within(L,V,X){return function(Q,le,me,fe,ue,_e){const Te=[0,Q.length-1,0],Ie=[],Le=ue*ue;for(;Te.length;){const rt=Te.pop(),ut=Te.pop(),ct=Te.pop();if(ut-ct<=_e){for(let gn=ct;gn<=ut;gn++)Ht(le[2*gn],le[2*gn+1],me,fe)<=Le&&Ie.push(Q[gn]);continue}const ht=Math.floor((ct+ut)/2),Pt=le[2*ht],bn=le[2*ht+1];Ht(Pt,bn,me,fe)<=Le&&Ie.push(Q[ht]);const In=(rt+1)%2;(0===rt?me-ue<=Pt:fe-ue<=bn)&&(Te.push(ct),Te.push(ht-1),Te.push(In)),(0===rt?me+ue>=Pt:fe+ue>=bn)&&(Te.push(ht+1),Te.push(ut),Te.push(In))}return Ie}(this.ids,this.coords,L,V,X,this.nodeSize)}}const ro={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},Wr=Math.fround||(zr=new Float32Array(1),K=>(zr[0]=+K,zr[0]));var zr;class Us{constructor(L){this.options=La(Object.create(ro),L),this.trees=new Array(this.options.maxZoom+1)}load(L){const{log:V,minZoom:X,maxZoom:Q,nodeSize:le}=this.options;V&&console.time("total time");const me=`prepare ${L.length} points`;V&&console.time(me),this.points=L;let fe=[];for(let ue=0;ue<L.length;ue++)L[ue].geometry&&fe.push(Cl(L[ue],ue));this.trees[Q+1]=new js(fe,Oa,bc,le,Float32Array),V&&console.timeEnd(me);for(let ue=Q;ue>=X;ue--){const _e=+Date.now();fe=this._cluster(fe,ue),this.trees[ue]=new js(fe,Oa,bc,le,Float32Array),V&&console.log("z%d: %d clusters in %dms",ue,fe.length,+Date.now()-_e)}return V&&console.timeEnd("total time"),this}getClusters(L,V){let X=((L[0]+180)%360+360)%360-180;const Q=Math.max(-90,Math.min(90,L[1]));let le=180===L[2]?180:((L[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)X=-180,le=180;else if(X>le){const Te=this.getClusters([X,Q,180,me],V),Ie=this.getClusters([-180,Q,le,me],V);return Te.concat(Ie)}const fe=this.trees[this._limitZoom(V)],ue=fe.range(Dl(X),Ot(me),Dl(le),Ot(Q)),_e=[];for(const Te of ue){const Ie=fe.points[Te];_e.push(Ie.numPoints?xc(Ie):this.points[Ie.index])}return _e}getChildren(L){const V=this._getOriginId(L),X=this._getOriginZoom(L),Q="No cluster with the specified id.",le=this.trees[X];if(!le)throw new Error(Q);const me=le.points[V];if(!me)throw new Error(Q);const fe=this.options.radius/(this.options.extent*Math.pow(2,X-1)),ue=le.within(me.x,me.y,fe),_e=[];for(const Te of ue){const Ie=le.points[Te];Ie.parentId===L&&_e.push(Ie.numPoints?xc(Ie):this.points[Ie.index])}if(0===_e.length)throw new Error(Q);return _e}getLeaves(L,V,X){const Q=[];return this._appendLeaves(Q,L,V=V||10,X=X||0,0),Q}getTile(L,V,X){const Q=this.trees[this._limitZoom(L)],le=Math.pow(2,L),{extent:me,radius:fe}=this.options,ue=fe/me,_e=(X-ue)/le,Te=(X+1+ue)/le,Ie={features:[]};return this._addTileFeatures(Q.range((V-ue)/le,_e,(V+1+ue)/le,Te),Q.points,V,X,le,Ie),0===V&&this._addTileFeatures(Q.range(1-ue/le,_e,1,Te),Q.points,le,X,le,Ie),V===le-1&&this._addTileFeatures(Q.range(0,_e,ue/le,Te),Q.points,-1,X,le,Ie),Ie.features.length?Ie:null}getClusterExpansionZoom(L){let V=this._getOriginZoom(L)-1;for(;V<=this.options.maxZoom;){const X=this.getChildren(L);if(V++,1!==X.length)break;L=X[0].properties.cluster_id}return V}_appendLeaves(L,V,X,Q,le){const me=this.getChildren(V);for(const fe of me){const ue=fe.properties;if(ue&&ue.cluster?le+ue.point_count<=Q?le+=ue.point_count:le=this._appendLeaves(L,ue.cluster_id,X,Q,le):le<Q?le++:L.push(fe),L.length===X)break}return le}_addTileFeatures(L,V,X,Q,le,me){for(const fe of L){const ue=V[fe],_e=ue.numPoints;let Te,Ie,Le;if(_e)Te=_u(ue),Ie=ue.x,Le=ue.y;else{const ct=this.points[ue.index];Te=ct.properties,Ie=Dl(ct.geometry.coordinates[0]),Le=Ot(ct.geometry.coordinates[1])}const rt={type:1,geometry:[[Math.round(this.options.extent*(Ie*le-X)),Math.round(this.options.extent*(Le*le-Q))]],tags:Te};let ut;_e?ut=ue.id:this.options.generateId?ut=ue.index:this.points[ue.index].id&&(ut=this.points[ue.index].id),void 0!==ut&&(rt.id=ut),me.features.push(rt)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(+L,this.options.maxZoom+1))}_cluster(L,V){const X=[],{radius:Q,extent:le,reduce:me,minPoints:fe}=this.options,ue=Q/(le*Math.pow(2,V));for(let _e=0;_e<L.length;_e++){const Te=L[_e];if(Te.zoom<=V)continue;Te.zoom=V;const Ie=this.trees[V+1],Le=Ie.within(Te.x,Te.y,ue),rt=Te.numPoints||1;let ut=rt;for(const ct of Le){const ht=Ie.points[ct];ht.zoom>V&&(ut+=ht.numPoints||1)}if(ut>rt&&ut>=fe){let ct=Te.x*rt,ht=Te.y*rt,Pt=me&&rt>1?this._map(Te,!0):null;const bn=(_e<<5)+(V+1)+this.points.length;for(const In of Le){const gn=Ie.points[In];if(gn.zoom<=V)continue;gn.zoom=V;const Tn=gn.numPoints||1;ct+=gn.x*Tn,ht+=gn.y*Tn,gn.parentId=bn,me&&(Pt||(Pt=this._map(Te,!0)),me(Pt,this._map(gn)))}Te.parentId=bn,X.push(gu(ct/ut,ht/ut,bn,ut,Pt))}else if(X.push(Te),ut>1)for(const ct of Le){const ht=Ie.points[ct];ht.zoom<=V||(ht.zoom=V,X.push(ht))}}return X}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,V){if(L.numPoints)return V?La({},L.properties):L.properties;const X=this.points[L.index].properties,Q=this.options.map(X);return V&&Q===X?La({},Q):Q}}function gu(K,L,V,X,Q){return{x:Wr(K),y:Wr(L),zoom:1/0,id:V,parentId:-1,numPoints:X,properties:Q}}function Cl(K,L){const[V,X]=K.geometry.coordinates;return{x:Wr(Dl(V)),y:Wr(Ot(X)),zoom:1/0,index:L,parentId:-1}}function xc(K){return{type:"Feature",id:K.id,properties:_u(K),geometry:{type:"Point",coordinates:[(L=K.x,360*(L-.5)),Mi(K.y)]}};var L}function _u(K){const L=K.numPoints,V=L>=1e4?`${Math.round(L/1e3)}k`:L>=1e3?Math.round(L/100)/10+"k":L;return La(La({},K.properties),{cluster:!0,cluster_id:K.id,point_count:L,point_count_abbreviated:V})}function Dl(K){return K/360+.5}function Ot(K){const L=Math.sin(K*Math.PI/180),V=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return V<0?0:V>1?1:V}function Mi(K){const L=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function La(K,L){for(const V in L)K[V]=L[V];return K}function Oa(K){return K.x}function bc(K){return K.y}function za(K,L,V,X){for(var Q,le=X,me=V-L>>1,fe=V-L,ue=K[L],_e=K[L+1],Te=K[V],Ie=K[V+1],Le=L+3;Le<V;Le+=3){var rt=cn(K[Le],K[Le+1],ue,_e,Te,Ie);if(rt>le)Q=Le,le=rt;else if(rt===le){var ut=Math.abs(Le-me);ut<fe&&(Q=Le,fe=ut)}}le>X&&(Q-L>3&&za(K,L,Q,X),K[Q+2]=le,V-Q>3&&za(K,Q,V,X))}function cn(K,L,V,X,Q,le){var me=Q-V,fe=le-X;if(0!==me||0!==fe){var ue=((K-V)*me+(L-X)*fe)/(me*me+fe*fe);ue>1?(V=Q,X=le):ue>0&&(V+=me*ue,X+=fe*ue)}return(me=K-V)*me+(fe=L-X)*fe}function Gs(K,L,V,X){var Q={id:void 0===K?null:K,type:L,geometry:V,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(le){var me=le.geometry,fe=le.type;if("Point"===fe||"MultiPoint"===fe||"LineString"===fe)gs(le,me);else if("Polygon"===fe||"MultiLineString"===fe)for(var ue=0;ue<me.length;ue++)gs(le,me[ue]);else if("MultiPolygon"===fe)for(ue=0;ue<me.length;ue++)for(var _e=0;_e<me[ue].length;_e++)gs(le,me[ue][_e])}(Q),Q}function gs(K,L){for(var V=0;V<L.length;V+=3)K.minX=Math.min(K.minX,L[V]),K.minY=Math.min(K.minY,L[V+1]),K.maxX=Math.max(K.maxX,L[V]),K.maxY=Math.max(K.maxY,L[V+1])}function Ba(K,L,V,X){if(L.geometry){var Q=L.geometry.coordinates,le=L.geometry.type,me=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),fe=[],ue=L.id;if(V.promoteId?ue=L.properties[V.promoteId]:V.generateId&&(ue=X||0),"Point"===le)Bi(Q,fe);else if("MultiPoint"===le)for(var _e=0;_e<Q.length;_e++)Bi(Q[_e],fe);else if("LineString"===le)Un(Q,fe,me,!1);else if("MultiLineString"===le){if(V.lineMetrics){for(_e=0;_e<Q.length;_e++)Un(Q[_e],fe=[],me,!1),K.push(Gs(ue,"LineString",fe,L.properties));return}wc(Q,fe,me,!1)}else if("Polygon"===le)wc(Q,fe,me,!0);else{if("MultiPolygon"!==le){if("GeometryCollection"===le){for(_e=0;_e<L.geometry.geometries.length;_e++)Ba(K,{id:ue,geometry:L.geometry.geometries[_e],properties:L.properties},V,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(_e=0;_e<Q.length;_e++){var Te=[];wc(Q[_e],Te,me,!0),fe.push(Te)}}K.push(Gs(ue,le,fe,L.properties))}}function Bi(K,L){L.push(Tl(K[0])),L.push(Ec(K[1])),L.push(0)}function Un(K,L,V,X){for(var Q,le,me=0,fe=0;fe<K.length;fe++){var ue=Tl(K[fe][0]),_e=Ec(K[fe][1]);L.push(ue),L.push(_e),L.push(0),fe>0&&(me+=X?(Q*_e-ue*le)/2:Math.sqrt(Math.pow(ue-Q,2)+Math.pow(_e-le,2))),Q=ue,le=_e}var Te=L.length-3;L[2]=1,za(L,0,Te,V),L[Te+2]=1,L.size=Math.abs(me),L.start=0,L.end=L.size}function wc(K,L,V,X){for(var Q=0;Q<K.length;Q++){var le=[];Un(K[Q],le,V,X),L.push(le)}}function Tl(K){return K/360+.5}function Ec(K){var L=Math.sin(K*Math.PI/180),V=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return V<0?0:V>1?1:V}function Ni(K,L,V,X,Q,le,me,fe){if(X/=L,le>=(V/=L)&&me<X)return K;if(me<V||le>=X)return null;for(var ue=[],_e=0;_e<K.length;_e++){var Te=K[_e],Ie=Te.geometry,Le=Te.type,rt=0===Q?Te.minX:Te.minY,ut=0===Q?Te.maxX:Te.maxY;if(rt>=V&&ut<X)ue.push(Te);else if(!(ut<V||rt>=X)){var ct=[];if("Point"===Le||"MultiPoint"===Le)yu(Ie,ct,V,X,Q);else if("LineString"===Le)Ml(Ie,ct,V,X,Q,!1,fe.lineMetrics);else if("MultiLineString"===Le)$s(Ie,ct,V,X,Q,!1);else if("Polygon"===Le)$s(Ie,ct,V,X,Q,!0);else if("MultiPolygon"===Le)for(var ht=0;ht<Ie.length;ht++){var Pt=[];$s(Ie[ht],Pt,V,X,Q,!0),Pt.length&&ct.push(Pt)}if(ct.length){if(fe.lineMetrics&&"LineString"===Le){for(ht=0;ht<ct.length;ht++)ue.push(Gs(Te.id,Le,ct[ht],Te.tags));continue}"LineString"!==Le&&"MultiLineString"!==Le||(1===ct.length?(Le="LineString",ct=ct[0]):Le="MultiLineString"),"Point"!==Le&&"MultiPoint"!==Le||(Le=3===ct.length?"Point":"MultiPoint"),ue.push(Gs(Te.id,Le,ct,Te.tags))}}}return ue.length?ue:null}function yu(K,L,V,X,Q){for(var le=0;le<K.length;le+=3){var me=K[le+Q];me>=V&&me<=X&&(L.push(K[le]),L.push(K[le+1]),L.push(K[le+2]))}}function Ml(K,L,V,X,Q,le,me){for(var fe,ue,_e=Sl(K),Te=0===Q?Si:Il,Ie=K.start,Le=0;Le<K.length-3;Le+=3){var rt=K[Le],ut=K[Le+1],ct=K[Le+2],ht=K[Le+3],Pt=K[Le+4],bn=0===Q?rt:ut,In=0===Q?ht:Pt,gn=!1;me&&(fe=Math.sqrt(Math.pow(rt-ht,2)+Math.pow(ut-Pt,2))),bn<V?In>V&&(ue=Te(_e,rt,ut,ht,Pt,V),me&&(_e.start=Ie+fe*ue)):bn>X?In<X&&(ue=Te(_e,rt,ut,ht,Pt,X),me&&(_e.start=Ie+fe*ue)):Hs(_e,rt,ut,ct),In<V&&bn>=V&&(ue=Te(_e,rt,ut,ht,Pt,V),gn=!0),In>X&&bn<=X&&(ue=Te(_e,rt,ut,ht,Pt,X),gn=!0),!le&&gn&&(me&&(_e.end=Ie+fe*ue),L.push(_e),_e=Sl(K)),me&&(Ie+=fe)}var Tn=K.length-3;rt=K[Tn],ut=K[Tn+1],ct=K[Tn+2],(bn=0===Q?rt:ut)>=V&&bn<=X&&Hs(_e,rt,ut,ct),Tn=_e.length-3,le&&Tn>=3&&(_e[Tn]!==_e[0]||_e[Tn+1]!==_e[1])&&Hs(_e,_e[0],_e[1],_e[2]),_e.length&&L.push(_e)}function Sl(K){var L=[];return L.size=K.size,L.start=K.start,L.end=K.end,L}function $s(K,L,V,X,Q,le){for(var me=0;me<K.length;me++)Ml(K[me],L,V,X,Q,le,!1)}function Hs(K,L,V,X){K.push(L),K.push(V),K.push(X)}function Si(K,L,V,X,Q,le){var me=(le-L)/(X-L);return K.push(le),K.push(V+(Q-V)*me),K.push(1),me}function Il(K,L,V,X,Q,le){var me=(le-V)/(Q-V);return K.push(L+(X-L)*me),K.push(le),K.push(1),me}function An(K,L){for(var V=[],X=0;X<K.length;X++){var Q,le=K[X],me=le.type;if("Point"===me||"MultiPoint"===me||"LineString"===me)Q=Ii(le.geometry,L);else if("MultiLineString"===me||"Polygon"===me){Q=[];for(var fe=0;fe<le.geometry.length;fe++)Q.push(Ii(le.geometry[fe],L))}else if("MultiPolygon"===me)for(Q=[],fe=0;fe<le.geometry.length;fe++){for(var ue=[],_e=0;_e<le.geometry[fe].length;_e++)ue.push(Ii(le.geometry[fe][_e],L));Q.push(ue)}V.push(Gs(le.id,me,Q,le.tags))}return V}function Ii(K,L){var V=[];V.size=K.size,void 0!==K.start&&(V.start=K.start,V.end=K.end);for(var X=0;X<K.length;X+=3)V.push(K[X]+L,K[X+1],K[X+2]);return V}function Na(K,L){if(K.transformed)return K;var V,X,Q,le=1<<K.z,me=K.x,fe=K.y;for(V=0;V<K.features.length;V++){var ue=K.features[V],_e=ue.geometry,Te=ue.type;if(ue.geometry=[],1===Te)for(X=0;X<_e.length;X+=2)ue.geometry.push(io(_e[X],_e[X+1],L,le,me,fe));else for(X=0;X<_e.length;X++){var Ie=[];for(Q=0;Q<_e[X].length;Q+=2)Ie.push(io(_e[X][Q],_e[X][Q+1],L,le,me,fe));ue.geometry.push(Ie)}}return K.transformed=!0,K}function io(K,L,V,X,Q,le){return[Math.round(V*(K*X-Q)),Math.round(V*(L*X-le))]}function qs(K,L,V,X,Q){for(var le=L===Q.maxZoom?0:Q.tolerance/((1<<L)*Q.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:X,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},fe=0;fe<K.length;fe++){me.numFeatures++,_s(me,K[fe],le,Q);var ue=K[fe].minX,_e=K[fe].minY,Te=K[fe].maxX,Ie=K[fe].maxY;ue<me.minX&&(me.minX=ue),_e<me.minY&&(me.minY=_e),Te>me.maxX&&(me.maxX=Te),Ie>me.maxY&&(me.maxY=Ie)}return me}function _s(K,L,V,X){var Q=L.geometry,le=L.type,me=[];if("Point"===le||"MultiPoint"===le)for(var fe=0;fe<Q.length;fe+=3)me.push(Q[fe]),me.push(Q[fe+1]),K.numPoints++,K.numSimplified++;else if("LineString"===le)bo(me,Q,K,V,!1,!1);else if("MultiLineString"===le||"Polygon"===le)for(fe=0;fe<Q.length;fe++)bo(me,Q[fe],K,V,"Polygon"===le,0===fe);else if("MultiPolygon"===le)for(var ue=0;ue<Q.length;ue++){var _e=Q[ue];for(fe=0;fe<_e.length;fe++)bo(me,_e[fe],K,V,!0,0===fe)}if(me.length){var Te=L.tags||null;if("LineString"===le&&X.lineMetrics){for(var Ie in Te={},L.tags)Te[Ie]=L.tags[Ie];Te.mapbox_clip_start=Q.start/Q.size,Te.mapbox_clip_end=Q.end/Q.size}var Le={geometry:me,type:"Polygon"===le||"MultiPolygon"===le?3:"LineString"===le||"MultiLineString"===le?2:1,tags:Te};null!==L.id&&(Le.id=L.id),K.features.push(Le)}}function bo(K,L,V,X,Q,le){var me=X*X;if(X>0&&L.size<(Q?me:X))V.numPoints+=L.length/3;else{for(var fe=[],ue=0;ue<L.length;ue+=3)(0===X||L[ue+2]>me)&&(V.numSimplified++,fe.push(L[ue]),fe.push(L[ue+1])),V.numPoints++;Q&&function(_e,Te){for(var Ie=0,Le=0,rt=_e.length,ut=rt-2;Le<rt;ut=Le,Le+=2)Ie+=(_e[Le]-_e[ut])*(_e[Le+1]+_e[ut+1]);if(Ie>0===Te)for(Le=0,rt=_e.length;Le<rt/2;Le+=2){var ct=_e[Le],ht=_e[Le+1];_e[Le]=_e[rt-2-Le],_e[Le+1]=_e[rt-1-Le],_e[rt-2-Le]=ct,_e[rt-1-Le]=ht}}(fe,le),K.push(fe)}}function Pr(K,L){var V=(L=this.options=function(Q,le){for(var me in le)Q[me]=le[me];return Q}(Object.create(this.options),L)).debug;if(V&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");var Q,le,me,fe,ue,_e,X=function(Q,le){var me=[];if("FeatureCollection"===Q.type)for(var fe=0;fe<Q.features.length;fe++)Ba(me,Q.features[fe],le,fe);else Ba(me,"Feature"===Q.type?Q:{geometry:Q},le);return me}(K,L);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Q=X,le=L,me=le.buffer/le.extent,fe=Q,ue=Ni(Q,1,-1-me,me,0,-1,2,le),_e=Ni(Q,1,1-me,2+me,0,-1,2,le),(ue||_e)&&(fe=Ni(Q,1,-me,1+me,0,-1,2,le)||[],ue&&(fe=An(ue,1).concat(fe)),_e&&(fe=fe.concat(An(_e,-1)))),X=fe).length&&this.splitTile(X,0,0,0),V&&(X.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ys(K,L,V){return 32*((1<<K)*V+L)+K}function wo(K,L){const V=K.tileID.canonical;if(!this._geoJSONIndex)return L(null,null);const X=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!X)return L(null,null);const Q=new bl(X.features);let le=Go(Q);0===le.byteOffset&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),L(null,{vectorTile:Q,rawData:le.buffer})}Pr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Pr.prototype.splitTile=function(K,L,V,X,Q,le,me){for(var fe=[K,L,V,X],ue=this.options,_e=ue.debug;fe.length;){X=fe.pop(),V=fe.pop(),L=fe.pop(),K=fe.pop();var Te=1<<L,Ie=ys(L,V,X),Le=this.tiles[Ie];if(!Le&&(_e>1&&console.time("creation"),Le=this.tiles[Ie]=qs(K,L,V,X,ue),this.tileCoords.push({z:L,x:V,y:X}),_e)){_e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,V,X,Le.numFeatures,Le.numPoints,Le.numSimplified),console.timeEnd("creation"));var rt="z"+L;this.stats[rt]=(this.stats[rt]||0)+1,this.total++}if(Le.source=K,Q){if(L===ue.maxZoom||L===Q)continue;var ut=1<<Q-L;if(V!==Math.floor(le/ut)||X!==Math.floor(me/ut))continue}else if(L===ue.indexMaxZoom||Le.numPoints<=ue.indexMaxPoints)continue;if(Le.source=null,0!==K.length){_e>1&&console.time("clipping");var ct,ht,Pt,bn,In,gn,Tn=.5*ue.buffer/ue.extent,vs=.5-Tn,Ho=.5+Tn,$n=1+Tn;ct=ht=Pt=bn=null,In=Ni(K,Te,V-Tn,V+Ho,0,Le.minX,Le.maxX,ue),gn=Ni(K,Te,V+vs,V+$n,0,Le.minX,Le.maxX,ue),K=null,In&&(ct=Ni(In,Te,X-Tn,X+Ho,1,Le.minY,Le.maxY,ue),ht=Ni(In,Te,X+vs,X+$n,1,Le.minY,Le.maxY,ue),In=null),gn&&(Pt=Ni(gn,Te,X-Tn,X+Ho,1,Le.minY,Le.maxY,ue),bn=Ni(gn,Te,X+vs,X+$n,1,Le.minY,Le.maxY,ue),gn=null),_e>1&&console.timeEnd("clipping"),fe.push(ct||[],L+1,2*V,2*X),fe.push(ht||[],L+1,2*V,2*X+1),fe.push(Pt||[],L+1,2*V+1,2*X),fe.push(bn||[],L+1,2*V+1,2*X+1)}}},Pr.prototype.getTile=function(K,L,V){var X=this.options,Q=X.extent,le=X.debug;if(K<0||K>24)return null;var me=1<<K,fe=ys(K,L=(L%me+me)%me,V);if(this.tiles[fe])return Na(this.tiles[fe],Q);le>1&&console.log("drilling down to z%d-%d-%d",K,L,V);for(var ue,_e=K,Te=L,Ie=V;!ue&&_e>0;)_e--,Te=Math.floor(Te/2),Ie=Math.floor(Ie/2),ue=this.tiles[ys(_e,Te,Ie)];return ue&&ue.source?(le>1&&console.log("found parent tile z%d-%d-%d",_e,Te,Ie),le>1&&console.time("drilling down"),this.splitTile(ue.source,_e,Te,Ie,K,L,V),le>1&&console.timeEnd("drilling down"),this.tiles[fe]?Na(this.tiles[fe],Q):null):null};class Va extends d.VectorTileWorkerSource{constructor(L,V,X,Q,le){super(L,V,X,Q,wo),le&&(this.loadGeoJSON=le)}loadData(L,V){const X=L&&L.request,Q=X&&X.collectResourceTiming;this.loadGeoJSON(L,(le,me)=>{if(le||!me)return V(le);if("object"!=typeof me)return V(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));{Ae(me,!0);try{if(L.filter){const ue=d.createExpression(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ue.result)throw new Error(ue.value.map(Te=>`${Te.key}: ${Te.message}`).join(", "));const _e=me.features.filter(Te=>ue.value.evaluate({zoom:0},Te));me={type:"FeatureCollection",features:_e}}this._geoJSONIndex=L.cluster?new Us(function({superclusterOptions:ue,clusterProperties:_e}){if(!_e||!ue)return ue;const Te={},Ie={},Le={accumulated:null,zoom:0},rt={properties:null},ut=Object.keys(_e);for(const ct of ut){const[ht,Pt]=_e[ct],bn=d.createExpression(Pt),In=d.createExpression("string"==typeof ht?[ht,["accumulated"],["get",ct]]:ht);Te[ct]=bn.value,Ie[ct]=In.value}return ue.map=ct=>{rt.properties=ct;const ht={};for(const Pt of ut)ht[Pt]=Te[Pt].evaluate(Le,rt);return ht},ue.reduce=(ct,ht)=>{rt.properties=ht;for(const Pt of ut)Le.accumulated=ct[Pt],ct[Pt]=Ie[Pt].evaluate(Le,rt)},ue}(L)).load(me.features):new Pr(ue=me,L.geojsonVtOptions)}catch(ue){return V(ue)}this.loaded={};const fe={};if(Q){const ue=d.getPerformanceMeasurement(X);ue&&(fe.resourceTiming={},fe.resourceTiming[L.source]=JSON.parse(JSON.stringify(ue)))}V(null,fe)}var ue})}reloadTile(L,V){const X=this.loaded;return X&&X[L.uid]?super.reloadTile(L,V):this.loadTile(L,V)}loadGeoJSON(L,V){if(L.request)d.getJSON(L.request,V);else{if("string"!=typeof L.data)return V(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));try{return V(null,JSON.parse(L.data))}catch(X){return V(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(L,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(L.clusterId))}catch(X){V(X)}}getClusterChildren(L,V){try{V(null,this._geoJSONIndex.getChildren(L.clusterId))}catch(X){V(X)}}getClusterLeaves(L,V){try{V(null,this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset))}catch(X){V(X)}}}class Ai{constructor(L){this.self=L,this.actor=new d.Actor(L,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=d.getProjection({name:"mercator"}),this.workerSourceTypes={vector:d.VectorTileWorkerSource,geojson:Va},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,X)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=X},this.self.registerRTLTextPlugin=V=>{if(d.plugin.isParsed())throw new Error("RTL text plugin already registered.");d.plugin.applyArabicShaping=V.applyArabicShaping,d.plugin.processBidirectionalText=V.processBidirectionalText,d.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}clearCaches(L,V,X){delete this.layerIndexes[L],delete this.availableImages[L],delete this.workerSources[L],delete this.demWorkerSources[L],X()}checkIfReady(L,V,X){X()}setReferrer(L,V){this.referrer=V}spriteLoaded(L,V){this.isSpriteLoaded[L]=V;for(const X in this.workerSources[L]){const Q=this.workerSources[L][X];for(const le in Q)Q[le]instanceof d.VectorTileWorkerSource&&(Q[le].isSpriteLoaded=V,Q[le].fire(new d.Event("isSpriteLoaded")))}}setImages(L,V,X){this.availableImages[L]=V;for(const Q in this.workerSources[L]){const le=this.workerSources[L][Q];for(const me in le)le[me].availableImages=V}X()}enableTerrain(L,V,X){this.terrain=V,X()}setProjection(L,V){this.projections[L]=d.getProjection(V)}setLayers(L,V,X){this.getLayerIndex(L).replace(V),X()}updateLayers(L,V,X){this.getLayerIndex(L).update(V.layers,V.removedIds),X()}loadTile(L,V,X){const Q=this.enableTerrain?d.extend({enableTerrain:this.terrain},V):V;Q.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,V.type,V.source).loadTile(Q,X)}loadDEMTile(L,V,X){const Q=this.enableTerrain?d.extend({buildQuadTree:this.terrain},V):V;this.getDEMWorkerSource(L,V.source).loadTile(Q,X)}reloadTile(L,V,X){const Q=this.enableTerrain?d.extend({enableTerrain:this.terrain},V):V;Q.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,V.type,V.source).reloadTile(Q,X)}abortTile(L,V,X){this.getWorkerSource(L,V.type,V.source).abortTile(V,X)}removeTile(L,V,X){this.getWorkerSource(L,V.type,V.source).removeTile(V,X)}removeSource(L,V,X){if(!this.workerSources[L]||!this.workerSources[L][V.type]||!this.workerSources[L][V.type][V.source])return;const Q=this.workerSources[L][V.type][V.source];delete this.workerSources[L][V.type][V.source],void 0!==Q.removeSource?Q.removeSource(V,X):X()}loadWorkerSource(L,V,X){try{this.self.importScripts(V.url),X()}catch(Q){X(Q.toString())}}syncRTLPluginState(L,V,X){try{d.plugin.setState(V);const Q=d.plugin.getPluginURL();if(d.plugin.isLoaded()&&!d.plugin.isParsed()&&null!=Q){this.self.importScripts(Q);const le=d.plugin.isParsed();X(le?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Q}`),le)}}catch(Q){X(Q.toString())}}getAvailableImages(L){let V=this.availableImages[L];return V||(V=[]),V}getLayerIndex(L){let V=this.layerIndexes[L];return V||(V=this.layerIndexes[L]=new ui),V}getWorkerSource(L,V,X){return this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][V]||(this.workerSources[L][V]={}),this.workerSources[L][V][X]||(this.workerSources[L][V][X]=new this.workerSourceTypes[V]({send:(Q,le,me,fe,ue,_e)=>{this.actor.send(Q,le,me,L,ue,_e)},scheduler:this.actor.scheduler},this.getLayerIndex(L),this.getAvailableImages(L),this.isSpriteLoaded[L])),this.workerSources[L][V][X]}getDEMWorkerSource(L,V){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][V]||(this.demWorkerSources[L][V]=new vt),this.demWorkerSources[L][V]}enforceCacheSizeLimit(L,V){d.enforceCacheSizeLimit(V)}getWorkerPerformanceMetrics(L,V,X){X(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Ai(self)),Ai}),Fh(0,function(d){var Zn=jo;function jo(f){return o=f,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,y,x=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(x);try{y=new Worker(E),g=!0}catch(T){g=!1}return y&&y.terminate(),URL.revokeObjectURL(E),g}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var g=document.createElement("canvas");g.width=g.height=1;var y=g.getContext("2d");if(!y)return!1;var x=y.getImageData(0,0,1,1);return x&&x.width===g.width}()||(void 0===ui[c=o&&o.failIfMajorPerformanceCaveat]&&(ui[c]=function(g){var y,E,T,P,x=(E=g,T=document.createElement("canvas"),(P=Object.create(jo.webGLContextAttributes)).failIfMajorPerformanceCaveat=E,T.getContext("webgl",P)||T.getContext("experimental-webgl",P));if(!x)return!1;try{y=x.createShader(x.VERTEX_SHADER)}catch(E){return!1}return!(!y||x.isContextLost())&&(x.shaderSource(y,"void main() {}"),x.compileShader(y),!0===x.getShaderParameter(y,x.COMPILE_STATUS))}(c)),!ui[c]||document.documentMode));var o,c}var ui={};function Ke(f,o){var c=o[0],g=o[1],y=o[2],x=o[3],E=c*x-y*g;return E?(f[0]=x*(E=1/E),f[1]=-g*E,f[2]=-y*E,f[3]=c*E,f):null}function vt(f,o){if(Array.isArray(f)){if(!Array.isArray(o)||f.length!==o.length)return!1;for(let c=0;c<f.length;c++)if(!vt(f[c],o[c]))return!1;return!0}if("object"==typeof f&&null!==f&&null!==o){if("object"!=typeof o||Object.keys(f).length!==Object.keys(o).length)return!1;for(const c in f)if(!vt(f[c],o[c]))return!1;return!0}return f===o}jo.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ae={create:function(f,o,c){const g=d.window.document.createElement(f);return void 0!==o&&(g.className=o),c&&c.appendChild(g),g},createSVG:function(f,o,c){const g=d.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const y of Object.keys(o))g.setAttributeNS(null,y,o[y]);return c&&c.appendChild(g),g}},Ti=d.window.document&&d.window.document.documentElement.style,Sn=Ti&&void 0!==Ti.userSelect?"userSelect":"WebkitUserSelect";let xl;Ae.disableDrag=function(){Ti&&Sn&&(xl=Ti[Sn],Ti[Sn]="none")},Ae.enableDrag=function(){Ti&&Sn&&(Ti[Sn]=xl)};const hi=function(f){f.preventDefault(),f.stopPropagation(),d.window.removeEventListener("click",hi,!0)};function bl(f,o,c){const g=f.offsetWidth===o.width?1:f.offsetWidth/o.width;return new d.pointGeometry((c.clientX-o.left)*g,(c.clientY-o.top)*g)}function eo(f){const{userImage:o}=f;return!!(o&&o.render&&o.render())&&(f.data.replace(new Uint8Array(o.data.buffer)),!0)}Ae.suppressClick=function(){d.window.addEventListener("click",hi,!0),d.window.setTimeout(()=>{d.window.removeEventListener("click",hi,!0)},0)},Ae.mousePos=function(f,o){const c=f.getBoundingClientRect();return bl(f,c,o)},Ae.touchPos=function(f,o){const c=f.getBoundingClientRect(),g=[];for(let y=0;y<o.length;y++)g.push(bl(f,c,o[y]));return g},Ae.mouseButton=function(f){return void 0!==d.window.InstallTrigger&&2===f.button&&f.ctrlKey&&d.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button};class xr extends d.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:c,callback:g}of this.requestors)this._notify(c,g);this.requestors=[]}}getImage(o){return this.images[o]}addImage(o,c){this._validate(o,c)&&(this.images[o]=c)}_validate(o,c){let g=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new d.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),g=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new d.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),g=!1),this._validateContent(c.content,c)||(this.fire(new d.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),g=!1),g}_validateStretch(o,c){if(!o)return!0;let g=0;for(const y of o){if(y[0]<g||y[1]<y[0]||c<y[1])return!1;g=y[1]}return!0}_validateContent(o,c){return!(o&&(4!==o.length||o[0]<0||c.data.width<o[0]||o[1]<0||c.data.height<o[1]||o[2]<0||c.data.width<o[2]||o[3]<0||c.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,c){c.version=this.images[o].version+1,this.images[o]=c,this.updatedImages[o]=!0}removeImage(o){const c=this.images[o];delete this.images[o],delete this.patterns[o],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,c){let g=!0;if(!this.isLoaded())for(const y of o)this.images[y]||(g=!1);this.isLoaded()||g?this._notify(o,c):this.requestors.push({ids:o,callback:c})}_notify(o,c){const g={};for(const y of o){this.images[y]||this.fire(new d.Event("styleimagemissing",{id:y}));const x=this.images[y];x?g[y]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:Boolean(x.userImage&&x.userImage.render)}:d.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,g)}getPixelSize(){const{width:o,height:c}=this.atlasImage;return{width:o,height:c}}getPattern(o){const c=this.patterns[o],g=this.getImage(o);if(!g)return null;if(c&&c.position.version===g.version)return c.position;if(c)c.position.version=g.version;else{const y={w:g.data.width+2,h:g.data.height+2,x:0,y:0},x=new d.ImagePosition(y,g);this.patterns[o]={bin:y,position:x}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const c=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.Texture(o,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const x in this.patterns)o.push(this.patterns[x].bin);const{w:c,h:g}=d.potpack(o),y=this.atlasImage;y.resize({width:c||1,height:g||1});for(const x in this.patterns){const{bin:E}=this.patterns[x],T=E.x+1,P=E.y+1,F=this.images[x].data,R=F.width,z=F.height;d.RGBAImage.copy(F,y,{x:0,y:0},{x:T,y:P},{width:R,height:z}),d.RGBAImage.copy(F,y,{x:0,y:z-1},{x:T,y:P-1},{width:R,height:1}),d.RGBAImage.copy(F,y,{x:0,y:0},{x:T,y:P+z},{width:R,height:1}),d.RGBAImage.copy(F,y,{x:R-1,y:0},{x:T-1,y:P},{width:1,height:z}),d.RGBAImage.copy(F,y,{x:0,y:0},{x:T+R,y:P},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const c of o){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const g=this.images[c];eo(g)&&this.updateImage(c,g)}}}const Uo=new d.Properties({anchor:new d.DataConstantProperty(d.spec.light.anchor),position:new class{constructor(){this.specification=d.spec.light.position}possiblyEvaluate(f,o){return function([c,g,y]){const x=d.degToRad(g+90),E=d.degToRad(y);return{x:c*Math.cos(x)*Math.sin(E),y:c*Math.sin(x)*Math.sin(E),z:c*Math.cos(E),azimuthal:g,polar:y}}(f.expression.evaluate(o))}interpolate(f,o,c){return{x:d.number(f.x,o.x,c),y:d.number(f.y,o.y,c),z:d.number(f.z,o.z,c),azimuthal:d.number(f.azimuthal,o.azimuthal,c),polar:d.number(f.polar,o.polar,c)}}},color:new d.DataConstantProperty(d.spec.light.color),intensity:new d.DataConstantProperty(d.spec.light.intensity)}),yo="-transition";class Go extends d.Evented{constructor(o){super(),this._transitionable=new d.Transitionable(Uo),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,c={}){if(!this._validate(d.validateLight,o,c))for(const g in o){const y=o[g];d.endsWith(g,yo)?this._transitionable.setTransition(g.slice(0,-yo.length),y):this._transitionable.setValue(g,y)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,g){return(!g||!1!==g.validate)&&d.emitValidationErrors(this,o.call(d.validateStyle,d.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}const Bs=new d.Properties({source:new d.DataConstantProperty(d.spec.terrain.source),exaggeration:new d.DataConstantProperty(d.spec.terrain.exaggeration)}),$o="-transition";class wl extends d.Evented{constructor(o,c){super(),this._transitionable=new d.Transitionable(Bs),this.set(o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(o){for(const c in o){const g=o[c];d.endsWith(c,$o)?this._transitionable.setTransition(c.slice(0,-$o.length),g):this._transitionable.setValue(c,g)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}}function to(f,o,c,g){const y=d.smoothstep(45,65,c),[x,E]=El(f,g),T=d.length(o);let P=1-Math.min(1,Math.exp((T-x)/(E-x)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*y*f.alpha}function El(f,o){const c=.5/Math.tan(.5*o);return[f.range[0]+c,f.range[1]+c]}const fs=new d.Properties({range:new d.DataConstantProperty(d.spec.fog.range),color:new d.DataConstantProperty(d.spec.fog.color),"horizon-blend":new d.DataConstantProperty(d.spec.fog["horizon-blend"])}),vo="-transition";class Rh extends d.Evented{constructor(o,c){super(),this._transitionable=new d.Transitionable(fs),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,c={}){if(!this._validate(d.validateFog,o,c))for(const g in o){const y=o[g];d.endsWith(g,vo)?this._transitionable.setTransition(g.slice(0,-vo.length),y):this._transitionable.setValue(g,y)}}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return d.smoothstep(45,65,o)*c.a}getOpacityAtLatLng(o,c){return this._transform.projection.supportsFog?function(g,y,x){const E=d.MercatorCoordinate.fromLngLat(y),T=x.elevation?x.elevation.getAtPointOrZero(E):0,P=[E.x,E.y,T];return d.transformMat4(P,P,x.mercatorFogMatrix),to(g,P,x.pitch,x._fov)}(this.state,o,c):0}getFovAdjustedRange(o){return this._transform.projection.supportsFog?El(this.state,o):[0,1]}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,g){return(!g||!1!==g.validate)&&d.emitValidationErrors(this,o.call(d.validateStyle,d.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}class no{constructor(o,c){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=d.uniqueId();const g=this.workerPool.acquire(this.id);for(let y=0;y<g.length;y++){const x=new no.Actor(g[y],c,this.id);x.name=`Worker ${y}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,c,g){d.asyncAll(this.actors,(y,x)=>{y.send(o,c,x)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function xn(f,o,c){return o*(d.EXTENT/(f.tileSize*Math.pow(2,c-f.tileID.overscaledZ)))}no.Actor=d.Actor;class Ns{constructor(o,c,g){this.context=o;const y=o.gl;this.buffer=y.createBuffer(),this.dynamicDraw=Boolean(g),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const xo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ra{constructor(o,c,g,y){this.length=c.length,this.attributes=g,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.context=o;const x=o.gl;this.buffer=x.createBuffer(),o.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,c){for(let g=0;g<this.attributes.length;g++){const y=c.attributes[this.attributes[g].name];void 0!==y&&o.enableVertexAttribArray(y)}}setVertexAttribPointers(o,c,g){for(let y=0;y<this.attributes.length;y++){const x=this.attributes[y],E=c.attributes[x.name];void 0!==E&&o.vertexAttribPointer(E,x.components,o[xo[x.type]],!1,this.itemSize,x.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ht{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Vs extends Ht{getDefault(){return d.Color.transparent}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class ms extends Ht{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class js extends Ht{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class ro extends Ht{getDefault(){return[!0,!0,!0,!0]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Wr extends Ht{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class zr extends Ht{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Us extends Ht{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const c=this.current;(o.func!==c.func||o.ref!==c.ref||o.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class gu extends Ht{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Cl extends Ht{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=o,this.dirty=!1}}class xc extends Ht{getDefault(){return[0,1]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class _u extends Ht{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=o,this.dirty=!1}}class Dl extends Ht{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Ot extends Ht{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.BLEND):c.disable(c.BLEND),this.current=o,this.dirty=!1}}class Mi extends Ht{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class La extends Ht{getDefault(){return d.Color.transparent}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Oa extends Ht{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class bc extends Ht{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=o,this.dirty=!1}}class za extends Ht{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class cn extends Ht{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Gs extends Ht{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class gs extends Ht{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Ba extends Ht{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Bi extends Ht{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Un extends Ht{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class wc extends Ht{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Tl extends Ht{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Ec extends Ht{getDefault(){return null}set(o){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Ni extends Ht{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class yu extends Ht{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Ml extends Ht{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Sl extends Ht{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class $s extends Ht{constructor(o,c){super(o),this.context=o,this.parent=c}getDefault(){return null}}class Hs extends $s{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Si extends $s{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Il extends Si{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class An{constructor(o,c,g,y){this.context=o,this.width=c,this.height=g;const x=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new Hs(o,x),y&&(this.depthAttachment=new Si(o,x))}destroy(){const o=this.context.gl,c=this.colorAttachment.get();if(c&&o.deleteTexture(c),this.depthAttachment){const g=this.depthAttachment.get();g&&o.deleteRenderbuffer(g)}o.deleteFramebuffer(this.framebuffer)}}class Ii{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Vs(this),this.clearDepth=new ms(this),this.clearStencil=new js(this),this.colorMask=new ro(this),this.depthMask=new Wr(this),this.stencilMask=new zr(this),this.stencilFunc=new Us(this),this.stencilOp=new gu(this),this.stencilTest=new Cl(this),this.depthRange=new xc(this),this.depthTest=new _u(this),this.depthFunc=new Dl(this),this.blend=new Ot(this),this.blendFunc=new Mi(this),this.blendColor=new La(this),this.blendEquation=new Oa(this),this.cullFace=new bc(this),this.cullFaceSide=new za(this),this.frontFace=new cn(this),this.program=new Gs(this),this.activeTexture=new gs(this),this.viewport=new Ba(this),this.bindFramebuffer=new Bi(this),this.bindRenderbuffer=new Un(this),this.bindTexture=new wc(this),this.bindVertexBuffer=new Tl(this),this.bindElementBuffer=new Ec(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ni(this),this.pixelStoreUnpack=new yu(this),this.pixelStoreUnpackPremultiplyAlpha=new Ml(this),this.pixelStoreUnpackFlipY=new Sl(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,c){return new Ns(this,o,c)}createVertexBuffer(o,c,g){return new Ra(this,o,c,g)}createRenderbuffer(o,c,g){const y=this.gl,x=y.createRenderbuffer();return this.bindRenderbuffer.set(x),y.renderbufferStorage(y.RENDERBUFFER,o,c,g),this.bindRenderbuffer.set(null),x}createFramebuffer(o,c,g){return new An(this,o,c,g)}clear({color:o,depth:c,stencil:g}){const y=this.gl;let x=0;o&&(x|=y.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(x|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==g&&(x|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),y.clear(x)}setCullFace(o){!1===o.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){vt(o.blendFunction,d.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Na{constructor(o,c,g,y){this.screenBounds=o,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(x=>y.pointCoordinate3D(x)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(o,c){let g,y;if(o instanceof d.pointGeometry||"number"==typeof o[0]){const x=d.pointGeometry.convert(o);g=[d.pointGeometry.convert(o)],y=c.isPointAboveHorizon(x)}else{const x=d.pointGeometry.convert(o[0]),E=d.pointGeometry.convert(o[1]);g=[x,E],y=d.polygonizeBounds(x,E).every(T=>c.isPointAboveHorizon(T))}return new Na(g,c.getCameraPoint(),y,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(o){return d.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const c=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new d.pointGeometry(1,1)):this.screenBounds[1],y=d.polygonizeBounds(c,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<g.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),d.bufferConvexPolygon(y,o)}containsTile(o,c,g){const y=o.queryPadding+1,x=o.tileID.wrap,E=g?this._bufferedCameraMercator(y,c).map(H=>d.getTilePoint(o.tileTransform,H,x)):this._bufferedScreenMercator(y,c).map(H=>d.getTilePoint(o.tileTransform,H,x)),T=this.screenGeometryMercator.map(H=>d.getTileVec3(o.tileTransform,H,x)),P=T.map(H=>new d.pointGeometry(H[0],H[1])),F=c.getFreeCameraOptions().position||new d.MercatorCoordinate(0,0,0),R=d.getTileVec3(o.tileTransform,F,x),z=T.map(H=>{const W=d.sub(H,H,R);return d.normalize(W,W),new d.Ray(R,W)}),j=xn(o,1,c.zoom);if(d.polygonIntersectsBox(E,0,0,d.EXTENT,d.EXTENT))return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:z,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(Z=d.getBounds(E),Z.min.x=d.clamp(Z.min.x,0,d.EXTENT),Z.min.y=d.clamp(Z.min.y,0,d.EXTENT),Z.max.x=d.clamp(Z.max.x,0,d.EXTENT),Z.max.y=d.clamp(Z.max.y,0,d.EXTENT),Z),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:j};var Z}_bufferedScreenMercator(o,c){const g=io(o);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{const y=this.bufferedScreenGeometry(o).map(x=>c.pointCoordinate3D(x));return this._screenRaycastCache[g]=y,y}}_bufferedCameraMercator(o,c){const g=io(o);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{const y=this.bufferedCameraGeometry(o).map(x=>c.pointCoordinate3D(x));return this._cameraRaycastCache[g]=y,y}}}function io(f){return 100*f|0}function qs(f,o,c){const g=function(y,x){if(y)return c(y);if(x){const E=d.pick(d.extend(x,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(E.vectorLayers=x.vector_layers,E.vectorLayerIds=E.vectorLayers.map(T=>T.id)),E.tiles=o.canonicalizeTileset(E,f.url),c(null,E)}};return f.url?d.getJSON(o.transformRequest(o.normalizeSourceURL(f.url),d.ResourceType.Source),g):d.exported.frame(()=>g(null,f))}class _s{constructor(o,c,g){this.bounds=d.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=c||0,this.maxzoom=g||24}validateBounds(o){return Array.isArray(o)&&4===o.length?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const c=Math.pow(2,o.z),g=Math.floor(d.mercatorXfromLng(this.bounds.getWest())*c),y=Math.floor(d.mercatorYfromLat(this.bounds.getNorth())*c),x=Math.ceil(d.mercatorXfromLng(this.bounds.getEast())*c),E=Math.ceil(d.mercatorYfromLat(this.bounds.getSouth())*c);return o.x>=g&&o.x<x&&o.y>=y&&o.y<E}}class bo extends d.Evented{constructor(o,c,g,y){super(),this.id=o,this.dispatcher=g,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.extend({type:"raster"},c),d.extend(this,d.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=qs(this._options,this.map._requestManager,(o,c)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new d.ErrorEvent(o)):c&&(d.extend(this,c),c.bounds&&(this.tileBounds=new _s(c.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(c.tiles),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,c){const g=d.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);o.request=d.getImage(this.map._requestManager.transformRequest(y,d.ResourceType.Tile),(x,E,T,P)=>{if(delete o.request,o.aborted)o.state="unloaded",c(null);else if(x)o.state="errored",c(x);else if(E){this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:T,expires:P});const F=this.map.painter.context,R=F.gl;o.texture=this.map.painter.getTileTexture(E.width),o.texture?o.texture.update(E,{useMipmap:!0}):(o.texture=new d.Texture(F,E,R.RGBA,{useMipmap:!0}),o.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE),F.extTextureFilterAnisotropic&&R.texParameterf(R.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax)),o.state="loaded",d.cacheEntryPossiblyAdded(this.dispatcher),c(null)}})}abortTile(o,c){o.request&&(o.request.cancel(),delete o.request),c()}unloadTile(o,c){o.texture&&this.map.painter.saveTileTexture(o.texture),c()}hasTransition(){return!1}}let Pr;function ys(f,o,c,g,y,x,E,T){const P=[f,c,y,o,g,x,1,1,1],F=[E,T,1],R=d.adjoint([],P),[z,j,Z]=d.transformMat3(F,F,d.transpose(R,R));return d.multiply(P,[z,0,0,0,j,0,0,0,Z],P)}class wo extends d.Evented{constructor(o,c,g,y){super(),this.id=o,this.dispatcher=g,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=c}load(o,c){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this.url=this.options.url,d.getImage(this.map._requestManager.transformRequest(this.url,d.ResourceType.Image),(g,y)=>{this._loaded=!0,g?this.fire(new d.ErrorEvent(g)):y&&(this.image=d.exported.getImageData(y),this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),c&&c(),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}setCoordinates(o){this.coordinates=o,delete this._boundsArray;const c=o.map(d.MercatorCoordinate.fromLngLat);return this.tileID=function(g){let y=1/0,x=1/0,E=-1/0,T=-1/0;for(const z of g)y=Math.min(y,z.x),x=Math.min(x,z.y),E=Math.max(E,z.x),T=Math.max(T,z.y);const P=Math.max(E-y,T-x),F=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),R=Math.pow(2,F);return new d.CanonicalTileID(F,Math.floor((y+E)/2*R),Math.floor((x+T)/2*R))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const o=d.tileTransform(this.tileID,this.map.transform.projection),[c,g,y,x]=this.coordinates.map(E=>{const T=o.projection.project(E[0],E[1]);return d.getTilePoint(o,T)._round()});return this.perspectiveTransform=function(E,T,P,F,R,z,j,Z,H,W){const oe=ys(0,0,E,0,0,T,E,T),$=ys(P,F,R,z,j,Z,H,W);return d.multiply($,d.adjoint(oe,oe),$),[$[6]/$[8]*E/d.EXTENT,$[7]/$[8]*T/d.EXTENT]}(this.width,this.height,c.x,c.y,g.x,g.y,x.x,x.y,y.x,y.y),this._boundsArray=new d.StructArrayLayout4i8,this._boundsArray.emplaceBack(c.x,c.y,0,0),this._boundsArray.emplaceBack(g.x,g.y,d.EXTENT,0),this._boundsArray.emplaceBack(x.x,x.y,0,d.EXTENT),this._boundsArray.emplaceBack(y.x,y.y,d.EXTENT,d.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const o=this.map.painter.context,c=o.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,d.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new d.Texture(o,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));for(const g in this.tiles){const y=this.tiles[g];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}loadTile(o,c){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},c(null)):(o.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Va={vector:class extends d.Evented{constructor(f,o,c,g){if(super(),this.id=f,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.extend(this,d.pick(o,["url","scheme","tileSize","promoteId"])),this._options=d.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new d.DedupedRequest}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=qs(this._options,this.map._requestManager,(f,o)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new d.ErrorEvent(f)):o&&(d.extend(this,o),o.bounds&&(this.tileBounds=new _s(o.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}onAdd(f){this.map=f,this.load()}setSourceProperty(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f();const o=this.map.style._getSourceCaches(this.id);for(const c of o)c.clearTiles();this.load()}setTiles(f){return this.setSourceProperty(()=>{this._options.tiles=f}),this}setUrl(f){return this.setSourceProperty(()=>{this.url=f,this._options.url=f}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}loadTile(f,o){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(c,d.ResourceType.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:f.isSymbolTile};if(g.request.collectResourceTiming=this._collectResourceTiming,f.actor&&"expired"!==f.state)"loading"===f.state?f.reloadCallback=o:f.request=f.actor.send("reloadTile",g,y.bind(this));else if(f.actor=this._tileWorkers[c]=this._tileWorkers[c]||this.dispatcher.getActor(),this.dispatcher.ready)f.request=f.actor.send("loadTile",g,y.bind(this),void 0,!0);else{const x=d.loadVectorTile.call({deduped:this._deduped},g,(E,T)=>{E||!T?y.call(this,E):(g.data={cacheControl:T.cacheControl,expires:T.expires,rawData:T.rawData.slice(0)},f.actor&&f.actor.send("loadTile",g,y.bind(this),void 0,!0))},!0);f.request={cancel:x}}function y(x,E){return delete f.request,f.aborted?o(null):x&&404!==x.status?o(x):(E&&E.resourceTiming&&(f.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&f.setExpiryData(E),f.loadVectorData(E,this.map.painter),d.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id})}unloadTile(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:bo,"raster-dem":class extends bo{constructor(f,o,c,g){super(f,o,c,g),this.type="raster-dem",this.maxzoom=22,this._options=d.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(f,o){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(y,x){y&&(f.state="errored",o(y)),x&&(f.dem=x,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",o(null))}f.request=d.getImage(this.map._requestManager.transformRequest(c,d.ResourceType.Tile),function(y,x,E,T){if(delete f.request,f.aborted)f.state="unloaded",o(null);else if(y)f.state="errored",o(y);else if(x){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:E,expires:T});const P=d.window.ImageBitmap&&x instanceof d.window.ImageBitmap&&(null==Pr&&(Pr=d.window.OffscreenCanvas&&new d.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof d.window.createImageBitmap),Pr),F=1-(x.width-d.prevPowerOfTwo(x.width))/2;F<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const R=P?x:d.exported.getImageData(x,F),z={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:R,encoding:this.encoding,padding:F};f.actor&&"expired"!==f.state||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",z,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const o=f.canonical,c=Math.pow(2,o.z),g=(o.x-1+c)%c,y=0===o.x?f.wrap-1:f.wrap,x=(o.x+1+c)%c,E=o.x+1===c?f.wrap+1:f.wrap,T={};return T[new d.OverscaledTileID(f.overscaledZ,y,o.z,g,o.y).key]={backfilled:!1},T[new d.OverscaledTileID(f.overscaledZ,E,o.z,x,o.y).key]={backfilled:!1},o.y>0&&(T[new d.OverscaledTileID(f.overscaledZ,y,o.z,g,o.y-1).key]={backfilled:!1},T[new d.OverscaledTileID(f.overscaledZ,f.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},T[new d.OverscaledTileID(f.overscaledZ,E,o.z,x,o.y-1).key]={backfilled:!1}),o.y+1<c&&(T[new d.OverscaledTileID(f.overscaledZ,y,o.z,g,o.y+1).key]={backfilled:!1},T[new d.OverscaledTileID(f.overscaledZ,f.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},T[new d.OverscaledTileID(f.overscaledZ,E,o.z,x,o.y+1).key]={backfilled:!1}),T}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends d.Evented{constructor(f,o,c,g){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(g),this._data=o.data,this._options=d.extend({},o),this._collectResourceTiming=o.collectResourceTiming,void 0!==o.maxzoom&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const y=d.EXTENT/this.tileSize;this.workerOptions=d.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(void 0!==o.buffer?o.buffer:128)*y,tolerance:(void 0!==o.tolerance?o.tolerance:.375)*y,extent:d.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:void 0!==o.clusterMaxZoom?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:d.EXTENT,radius:(void 0!==o.clusterRadius?o.clusterRadius:50)*y,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},o),this}getClusterChildren(f,o){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},o),this}getClusterLeaves(f,o,c,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:o,offset:c},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new d.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=d.extend({},this.workerOptions),o=this._data;"string"==typeof o?(f.request=this.map._requestManager.transformRequest(d.exported.resolveURL(o),d.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(c,g)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new d.ErrorEvent(c));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(y.resourceTiming=g.resourceTiming[this.id]),this.fire(new d.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,o){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(c,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,y)=>(delete f.request,f.unloadVectorData(),f.aborted?o(null):g?o(g):(f.loadVectorData(y,this.map.painter,"reloadTile"===c),o(null))),void 0,"loadTile"===c)}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return d.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends wo{constructor(f,o,c,g){super(f,o,c,g),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const o of f.urls)this.urls.push(this.map._requestManager.transformRequest(o,d.ResourceType.Source).url);d.getVideo(this.urls,(o,c)=>{this._loaded=!0,o?this.fire(new d.ErrorEvent(o)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const o=this.video.seekable;f<o.start(0)||f>o.end(0)?this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const f=this.map.painter.context,o=f.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new d.Texture(f,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,d.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2));for(const c in this.tiles){const g=this.tiles[c];"loaded"!==g.state&&(g.state="loaded",g.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:wo,canvas:class extends wo{constructor(f,o,c,g){super(f,o,c,g),o.coordinates?Array.isArray(o.coordinates)&&4===o.coordinates.length&&!o.coordinates.some(y=>!Array.isArray(y)||2!==y.length||y.some(x=>"number"!=typeof x))||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),o.animate&&"boolean"!=typeof o.animate&&this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),o.canvas?"string"==typeof o.canvas||o.canvas instanceof d.window.HTMLCanvasElement||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=o,this.animate=void 0===o.animate||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof d.window.HTMLCanvasElement?this.options.canvas:d.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const o=this.map.painter.context,c=o.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,d.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.Texture(o,this.canvas,c.RGBA,{premultiply:!0});for(const g in this.tiles){const y=this.tiles[g];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}}},Ai=function(f,o,c,g){const y=new Va[o.type](f,o,c,g);if(y.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${y.id}`);return d.bindAll(["load","abort","unload","serialize","prepare"],y),y};function K(f,o){const c=d.identity([]);return d.scale(c,c,[.5*f.width,.5*-f.height,1]),d.translate(c,c,[1,-1,0]),d.multiply$1(c,c,f.calculateProjMatrix(o.toUnwrapped()))}function L(f,o,c,g,y,x,E,T=!1){const P=f.tilesIn(g,E,T);P.sort(X);const F=[];for(const z of P)F.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(o,c,f._state,z,y,x,K(f.transform,z.tile.tileID),T)});const R=function(z){const j={},Z={};for(const H of z){const W=H.queryResults,oe=H.wrappedTileID,$=Z[oe]=Z[oe]||{};for(const ne in W){const ee=W[ne],te=$[ne]=$[ne]||{},re=j[ne]=j[ne]||[];for(const se of ee)te[se.featureIndex]||(te[se.featureIndex]=!0,re.push(se))}}return j}(F);for(const z in R)R[z].forEach(j=>{const Z=j.feature,H=f.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=H});return R}function V(f,o){const c=f.getRenderableIds().map(x=>f.getTileByID(x)),g=[],y={};for(let x=0;x<c.length;x++){const E=c[x],T=E.tileID.canonical.key;y[T]||(y[T]=!0,E.querySourceFeatures(g,o))}return g}function X(f,o){const c=f.tileID,g=o.tileID;return c.overscaledZ-g.overscaledZ||c.canonical.y-g.canonical.y||c.wrap-g.wrap||c.canonical.x-g.canonical.x}function Q(){return null!=Is.workerClass?new Is.workerClass:new d.window.Worker(Is.workerUrl)}const le="mapboxgl_preloaded_worker_pool";class me{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<me.workerCount;)this.workers.push(new Q);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[le]}numActive(){return Object.keys(this.active).length}}let fe;function ue(){return fe||(fe=new me),fe}function _e(f,o){const c={};for(const g in f)"ref"!==g&&(c[g]=f[g]);return d.refProperties.forEach(g=>{g in o&&(c[g]=o[g])}),c}function Te(f){f=f.slice();const o=Object.create(null);for(let c=0;c<f.length;c++)o[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=_e(f[c],o[f[c].ref]));return f}me.workerCount=2;const Ie={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Le(f,o,c){c.push({command:Ie.addSource,args:[f,o[f]]})}function rt(f,o,c){o.push({command:Ie.removeSource,args:[f]}),c[f]=!0}function ut(f,o,c,g){rt(f,c,g),Le(f,o,c)}function ct(f,o,c){let g;for(g in f[c])if(f[c].hasOwnProperty(g)&&"data"!==g&&!vt(f[c][g],o[c][g]))return!1;for(g in o[c])if(o[c].hasOwnProperty(g)&&"data"!==g&&!vt(f[c][g],o[c][g]))return!1;return!0}function ht(f,o,c,g,y,x){let E;for(E in o=o||{},f=f||{})f.hasOwnProperty(E)&&(vt(f[E],o[E])||c.push({command:x,args:[g,E,o[E],y]}));for(E in o)o.hasOwnProperty(E)&&!f.hasOwnProperty(E)&&(vt(f[E],o[E])||c.push({command:x,args:[g,E,o[E],y]}))}function Pt(f){return f.id}function bn(f,o){return f[o.id]=o,f}class In{constructor(o,c){this.reset(o,c)}reset(o,c){this.points=o||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(1===this.points.length)return this.points[0];o=d.clamp(o,0,1);let c=1,g=this._distances[c];const y=o*this.paddedLength+this.padding;for(;g<y&&c<this._distances.length;)g=this._distances[++c];const x=c-1,E=this._distances[x],T=g-E,P=T>0?(y-E)/T:0;return this.points[x].mult(1-P).add(this.points[c].mult(P))}}class gn{constructor(o,c,g){const y=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(o/g),this.yCellCount=Math.ceil(c/g);for(let E=0;E<this.xCellCount*this.yCellCount;E++)y.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=c,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,c,g,y,x){this._forEachCell(c,g,y,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(c),this.bboxes.push(g),this.bboxes.push(y),this.bboxes.push(x)}insertCircle(o,c,g,y){this._forEachCell(c-y,g-y,c+y,g+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(c),this.circles.push(g),this.circles.push(y)}_insertBoxCell(o,c,g,y,x,E){this.boxCells[x].push(E)}_insertCircleCell(o,c,g,y,x,E){this.circleCells[x].push(E)}_query(o,c,g,y,x,E){if(g<0||o>this.width||y<0||c>this.height)return!x&&[];const T=[];if(o<=0&&c<=0&&this.width<=g&&this.height<=y){if(x)return!0;for(let P=0;P<this.boxKeys.length;P++)T.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const F=this.circles[3*P],R=this.circles[3*P+1],z=this.circles[3*P+2];T.push({key:this.circleKeys[P],x1:F-z,y1:R-z,x2:F+z,y2:R+z})}return E?T.filter(E):T}return this._forEachCell(o,c,g,y,this._queryCell,T,{hitTest:x,seenUids:{box:{},circle:{}}},E),x?T.length>0:T}_queryCircle(o,c,g,y,x){const E=o-g,T=o+g,P=c-g,F=c+g;if(T<0||E>this.width||F<0||P>this.height)return!y&&[];const R=[];return this._forEachCell(E,P,T,F,this._queryCellCircle,R,{hitTest:y,circle:{x:o,y:c,radius:g},seenUids:{box:{},circle:{}}},x),y?R.length>0:R}query(o,c,g,y,x){return this._query(o,c,g,y,!1,x)}hitTest(o,c,g,y,x){return this._query(o,c,g,y,!0,x)}hitTestCircle(o,c,g,y){return this._queryCircle(o,c,g,!0,y)}_queryCell(o,c,g,y,x,E,T,P){const F=T.seenUids,R=this.boxCells[x];if(null!==R){const j=this.bboxes;for(const Z of R)if(!F.box[Z]){F.box[Z]=!0;const H=4*Z;if(o<=j[H+2]&&c<=j[H+3]&&g>=j[H+0]&&y>=j[H+1]&&(!P||P(this.boxKeys[Z]))){if(T.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[Z],x1:j[H],y1:j[H+1],x2:j[H+2],y2:j[H+3]})}}}const z=this.circleCells[x];if(null!==z){const j=this.circles;for(const Z of z)if(!F.circle[Z]){F.circle[Z]=!0;const H=3*Z;if(this._circleAndRectCollide(j[H],j[H+1],j[H+2],o,c,g,y)&&(!P||P(this.circleKeys[Z]))){if(T.hitTest)return E.push(!0),!0;{const W=j[H],oe=j[H+1],$=j[H+2];E.push({key:this.circleKeys[Z],x1:W-$,y1:oe-$,x2:W+$,y2:oe+$})}}}}}_queryCellCircle(o,c,g,y,x,E,T,P){const F=T.circle,R=T.seenUids,z=this.boxCells[x];if(null!==z){const Z=this.bboxes;for(const H of z)if(!R.box[H]){R.box[H]=!0;const W=4*H;if(this._circleAndRectCollide(F.x,F.y,F.radius,Z[W+0],Z[W+1],Z[W+2],Z[W+3])&&(!P||P(this.boxKeys[H])))return E.push(!0),!0}}const j=this.circleCells[x];if(null!==j){const Z=this.circles;for(const H of j)if(!R.circle[H]){R.circle[H]=!0;const W=3*H;if(this._circlesCollide(Z[W],Z[W+1],Z[W+2],F.x,F.y,F.radius)&&(!P||P(this.circleKeys[H])))return E.push(!0),!0}}}_forEachCell(o,c,g,y,x,E,T,P){const F=this._convertToXCellCoord(o),R=this._convertToYCellCoord(c),z=this._convertToXCellCoord(g),j=this._convertToYCellCoord(y);for(let Z=F;Z<=z;Z++)for(let H=R;H<=j;H++)if(x.call(this,o,c,g,y,this.xCellCount*H+Z,E,T,P))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,c,g,y,x,E){const T=y-o,P=x-c,F=g+E;return F*F>T*T+P*P}_circleAndRectCollide(o,c,g,y,x,E,T){const P=(E-y)/2,F=Math.abs(o-(y+P));if(F>P+g)return!1;const R=(T-x)/2,z=Math.abs(c-(x+R));if(z>R+g)return!1;if(F<=P||z<=R)return!0;const j=F-P,Z=z-R;return j*j+Z*Z<=g*g}}const Tn=Math.tan(85*Math.PI/180);function vs(f,o,c,g,y,x){let E=d.create();if(c){if("globe"===y.projection.name)E=d.calculateGlobeMatrix(y,y.worldSize/y._projectionScaler,[0,0]),d.multiply$1(E,E,d.globeDenormalizeECEF(d.globeTileBounds(o)));else{const T=Ke([],x);E[0]=T[0],E[1]=T[1],E[4]=T[2],E[5]=T[3]}g||d.rotateZ(E,E,y.angle)}else d.multiply$1(E,y.labelPlaneMatrix,f);return E}function Ho(f,o,c,g,y,x){if(c){if("globe"===y.projection.name){const E=vs(f,o,c,g,y,x);return d.invert(E,E),d.multiply$1(E,f,E),E}{const E=d.clone(f),T=d.identity([]);return T[0]=x[0],T[1]=x[1],T[4]=x[2],T[5]=x[3],d.multiply$1(E,E,T),g||d.rotateZ(E,E,-y.angle),E}}return y.glCoordMatrix}function $n(f,o,c=0){const g=[f.x,f.y,c,1];c?d.transformMat4$1(g,g,o):Ua(g,g,o);const y=g[3];return{point:new d.pointGeometry(g[0]/y,g[1]/y),signedDistanceFromCamera:y}}function Eo(f,o){return Math.min(.5+f/o*.5,1.5)}function Cc(f,o){const c=f[0]/f[3],g=f[1]/f[3];return c>=-o[0]&&c<=o[0]&&g>=-o[1]&&g<=o[1]}function Lh(f,o,c,g,y,x,E,T,P,F){const R=c.transform,z=g?f.textSizeData:f.iconSizeData,j=d.evaluateSizeForZoom(z,c.transform.zoom),Z=[256/c.width*2+1,256/c.height*2+1],H=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;H.clear();const W=f.lineVertexArray,oe=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,$=c.transform.width/c.transform.height;let ne=!1;for(let ee=0;ee<oe.length;ee++){const te=oe.get(ee);if(te.writingMode!==d.WritingMode.vertical||ne||0!==ee&&oe.get(ee-1).writingMode===d.WritingMode.horizontal||(ne=!0),te.hidden||te.writingMode===d.WritingMode.vertical&&!ne){gt(te.numGlyphs,H);continue}ne=!1;const re=new d.pointGeometry(te.tileAnchorX,te.tileAnchorY),se=P?P(re):[0,0,0],ge=R.projection.projectTilePoint(re.x,re.y,F.canonical),xe=[ge.x+se[0],ge.y+se[1],ge.z+se[2]],Ue=[...xe,1];if(d.transformMat4$1(Ue,Ue,o),!Cc(Ue,Z)){gt(te.numGlyphs,H);continue}const Re=Eo(c.transform.cameraToCenterDistance,Ue[3]),ke=d.evaluateSizeForFeature(z,j,te),be=E?ke/Re:ke*Re,ve=$n(new d.pointGeometry(xe[0],xe[1]),y,xe[2]);if(ve.signedDistanceFromCamera<=0){gt(te.numGlyphs,H);continue}let Fe={};const Me=E?null:P,tt=Pl(te,be,!1,T,o,y,x,f.glyphOffsetArray,W,H,ve.point,re,Fe,$,Me,R.projection,F);ne=tt.useVertical,Me&&tt.needsFlipping&&(Fe={}),(tt.notEnoughRoom||ne||tt.needsFlipping&&Pl(te,be,!0,T,o,y,x,f.glyphOffsetArray,W,H,ve.point,re,Fe,$,Me,R.projection,F).notEnoughRoom)&&gt(te.numGlyphs,H)}g?f.text.dynamicLayoutVertexBuffer.updateData(H):f.icon.dynamicLayoutVertexBuffer.updateData(H)}function Al(f,o,c,g,y,x,E,T,P,F,R,z,j,Z,H){const W=T.glyphStartIndex+T.numGlyphs,oe=T.lineStartIndex,$=T.lineStartIndex+T.lineLength,ne=o.getoffsetX(T.glyphStartIndex),ee=o.getoffsetX(W-1),te=kl(f*ne,c,g,y,x,E,T.segment,oe,$,P,F,R,z,j,!0,Z,H);if(!te)return null;const re=kl(f*ee,c,g,y,x,E,T.segment,oe,$,P,F,R,z,j,!0,Z,H);return re?{first:te,last:re}:null}function un(f,o,c,g){return f.writingMode===d.WritingMode.horizontal&&Math.abs(c.y-o.y)>Math.abs(c.x-o.x)*g?{useVertical:!0}:f.writingMode===d.WritingMode.vertical?o.y<c.y?{needsFlipping:!0}:null:0!==f.flipState&&function(y,x,E){const T=(x.x-y.x)*E;return 0===T||Math.abs((x.y-y.y)/T)>Tn}(o,c,g)?1===f.flipState?{needsFlipping:!0}:null:o.x>c.x?{needsFlipping:!0}:null}function Pl(f,o,c,g,y,x,E,T,P,F,R,z,j,Z,H,W,oe){const $=o/24,ne=f.lineOffsetX*$,ee=f.lineOffsetY*$;let te;if(f.numGlyphs>1){const re=f.glyphStartIndex+f.numGlyphs,se=f.lineStartIndex,ge=f.lineStartIndex+f.lineLength,xe=Al($,T,ne,ee,c,R,z,f,P,x,j,H,!1,W,oe);if(!xe)return{notEnoughRoom:!0};const Ue=$n(xe.first.point,E).point,Re=$n(xe.last.point,E).point;if(g&&!c){const ke=un(f,Ue,Re,Z);if(f.flipState=ke&&ke.needsFlipping?1:2,ke)return ke}te=[xe.first];for(let ke=f.glyphStartIndex+1;ke<re-1;ke++)te.push(kl($*T.getoffsetX(ke),ne,ee,c,R,z,f.segment,se,ge,P,x,j,H,!1,!1,W,oe));te.push(xe.last)}else{if(g&&!c){const se=$n(z,y).point,ge=f.lineStartIndex+f.segment+1,xe=new d.pointGeometry(P.getx(ge),P.gety(ge)),Ue=$n(xe,y),Re=un(f,se,Ue.signedDistanceFromCamera>0?Ue.point:ja(z,xe,se,1,y,void 0,W,oe.canonical),Z);if(f.flipState=Re&&Re.needsFlipping?1:2,Re)return Re}const re=kl($*T.getoffsetX(f.glyphStartIndex),ne,ee,c,R,z,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,P,x,j,H,!1,!1,W,oe);if(!re)return{notEnoughRoom:!0};te=[re]}for(const re of te)d.addDynamicAttributes(F,re.point,re.angle);return{}}function an(f,o,c,g,y){const x=g.projectTilePoint(f.x,f.y,o);if(!y)return $n(x,c,x.z);const E=y(f);return $n(new d.pointGeometry(x.x+E[0],x.y+E[1]),c,x.z+E[2])}function ja(f,o,c,g,y,x,E,T){const P=an(f.add(f.sub(o)._unit()),T,y,E,x).point,F=c.sub(P);return c.add(F._mult(g/F.mag()))}function kl(f,o,c,g,y,x,E,T,P,F,R,z,j,Z,H,W,oe){const $=g?f-o:f+o;let ne=$>0?1:-1,ee=0;g&&(ne*=-1,ee=Math.PI),ne<0&&(ee+=Math.PI);let te=ne>0?T+E:T+E+1,re=y,se=y,ge=0,xe=0;const Ue=Math.abs($),Re=[],ke=[];let be=x;const ve=()=>{const je=te-ne;return 0===ge?x:new d.pointGeometry(F.getx(je),F.gety(je))},Fe=()=>ja(ve(),be,se,Ue-ge+1,R,j,W,oe.canonical);for(;ge+xe<=Ue;){if(te+=ne,te<T||te>=P)return null;if(se=re,Re.push(re),Z&&ke.push(be||ve()),re=z[te],void 0===re){be=new d.pointGeometry(F.getx(te),F.gety(te));const je=an(be,oe.canonical,R,W,j);re=je.signedDistanceFromCamera>0?z[te]=je.point:Fe()}else be=null;ge+=xe,xe=se.dist(re)}H&&j&&(be=be||new d.pointGeometry(F.getx(te),F.gety(te)),z[te]=re=void 0===z[te]?re:Fe(),xe=se.dist(re));const Me=(Ue-ge)/xe,tt=re.sub(se),lt=tt.mult(Me)._add(se);c&&lt._add(tt._unit()._perp()._mult(c*ne));const Mt=ee+Math.atan2(re.y-se.y,re.x-se.x);return Re.push(lt),Z&&(be=be||new d.pointGeometry(F.getx(te),F.gety(te)),ke.push(function(je,st,mt){const ln=1-mt;return new d.pointGeometry(je.x*ln+st.x*mt,je.y*ln+st.y*mt)}(ke.length>0?ke[ke.length-1]:be,be,Me))),{point:lt,angle:Mt,path:Re,tilePath:ke}}const wn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function gt(f,o){for(let c=0;c<f;c++){const g=o.length;o.resize(g+4),o.float32.set(wn,3*g)}}function Ua(f,o,c){const g=o[0],y=o[1];return f[0]=c[0]*g+c[4]*y+c[12],f[1]=c[1]*g+c[5]*y+c[13],f[3]=c[3]*g+c[7]*y+c[15],f}const qo=100;class en{constructor(o,c,g=new gn(o.width+200,o.height+200,25),y=new gn(o.width+200,o.height+200,25)){this.transform=o,this.grid=g,this.ignoredGrid=y,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+qo,this.screenBottomBoundary=o.height+qo,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=c}placeCollisionBox(o,c,g,y,x,E,T){let P=c.projectedAnchorX,F=c.projectedAnchorY,R=c.projectedAnchorZ;const z=c.elevation,j=c.tileID;if(z&&j){const te=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),re=te.upVector(j.canonical,c.tileAnchorX,c.tileAnchorY),se=te.upVectorScale(j.canonical);P+=re[0]*z*se,F+=re[1]*z*se,R+=re[2]*z*se}const Z=this.projectAndGetPerspectiveRatio(E,P,F,R,c.tileID),H=x*Z.perspectiveRatio,W=(c.x1*o+g.x-c.padding)*H+Z.point.x,oe=(c.y1*o+g.y-c.padding)*H+Z.point.y,$=(c.x2*o+g.x+c.padding)*H+Z.point.x,ne=(c.y2*o+g.y+c.padding)*H+Z.point.y,ee=Z.perspectiveRatio<=.55||Z.aboveHorizon;return!this.isInsideGrid(W,oe,$,ne)||!y&&this.grid.hitTest(W,oe,$,ne,T)||ee?{box:[],offscreen:!1}:{box:[W,oe,$,ne],offscreen:this.isOffscreen(W,oe,$,ne)}}placeCollisionCircles(o,c,g,y,x,E,T,P,F,R,z,j,Z,H){const W=[],oe=this.transform.elevation,$=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),ne=oe?oe.getAtTileOffsetFunc(H,$):Me=>[0,0,0],ee=new d.pointGeometry(c.tileAnchorX,c.tileAnchorY),te=this.transform.projection.projectTilePoint(c.tileAnchorX,c.tileAnchorY,H.canonical),re=ne(ee),se=[te.x+re[0],te.y+re[1],te.z+re[2]],ge=this.projectAndGetPerspectiveRatio(E,se[0],se[1],se[2],H),{perspectiveRatio:xe}=ge,Ue=(R?x/xe:x*xe)/d.ONE_EM,Re=$n(new d.pointGeometry(se[0],se[1]),T,se[2]).point,ke=ge.signedDistanceFromCamera>0?Al(Ue,y,c.lineOffsetX*Ue,c.lineOffsetY*Ue,!1,Re,ee,c,g,T,{},oe&&!R?ne:null,R&&!!oe,this.transform.projection,H):null;let be=!1,ve=!1,Fe=!0;if(ke&&!ge.aboveHorizon){const Me=.5*j*xe+Z,tt=new d.pointGeometry(-100,-100),lt=new d.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Mt=new In,je=ke.first,st=ke.last;let mt=[];for(let yt=je.path.length-1;yt>=1;yt--)mt.push(je.path[yt]);for(let yt=1;yt<st.path.length;yt++)mt.push(st.path[yt]);const ln=2.5*Me;if(P){const yt=mt.map(oe?(Lt,yn)=>{const Jn=ne(yn<je.path.length-1?je.tilePath[je.path.length-1-yn]:st.tilePath[yn-je.path.length+2]);return $n(Lt,P,Jn[2])}:Lt=>$n(Lt,P));mt=yt.some(Lt=>Lt.signedDistanceFromCamera<=0)?[]:yt.map(Lt=>Lt.point)}let _n=[];if(mt.length>0){const yt=mt[0].clone(),Lt=mt[0].clone();for(let yn=1;yn<mt.length;yn++)yt.x=Math.min(yt.x,mt[yn].x),yt.y=Math.min(yt.y,mt[yn].y),Lt.x=Math.max(Lt.x,mt[yn].x),Lt.y=Math.max(Lt.y,mt[yn].y);_n=yt.x>=tt.x&&Lt.x<=lt.x&&yt.y>=tt.y&&Lt.y<=lt.y?[mt]:Lt.x<tt.x||yt.x>lt.x||Lt.y<tt.y||yt.y>lt.y?[]:d.clipLine([mt],tt.x,tt.y,lt.x,lt.y)}for(const yt of _n){Mt.reset(yt,.25*Me);let Lt=0;Lt=Mt.length<=.5*Me?1:Math.ceil(Mt.paddedLength/ln)+1;for(let yn=0;yn<Lt;yn++){const Jn=yn/Math.max(Lt-1,1),Vr=Mt.lerp(Jn),ni=Vr.x+qo,$i=Vr.y+qo;W.push(ni,$i,Me,0);const Ut=ni-Me,ft=$i-Me,Bt=ni+Me,Dn=$i+Me;if(Fe=Fe&&this.isOffscreen(Ut,ft,Bt,Dn),ve=ve||this.isInsideGrid(Ut,ft,Bt,Dn),!o&&this.grid.hitTestCircle(ni,$i,Me,z)&&(be=!0,!F))return{circles:[],offscreen:!1,collisionDetected:be}}}}return{circles:!F&&be||!ve?[]:W,offscreen:Fe,collisionDetected:be}}queryRenderedSymbols(o){if(0===o.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let g=1/0,y=1/0,x=-1/0,E=-1/0;for(const R of o){const z=new d.pointGeometry(R.x+qo,R.y+qo);g=Math.min(g,z.x),y=Math.min(y,z.y),x=Math.max(x,z.x),E=Math.max(E,z.y),c.push(z)}const T=this.grid.query(g,y,x,E).concat(this.ignoredGrid.query(g,y,x,E)),P={},F={};for(const R of T){const z=R.key;if(void 0===P[z.bucketInstanceId]&&(P[z.bucketInstanceId]={}),P[z.bucketInstanceId][z.featureIndex])continue;const j=[new d.pointGeometry(R.x1,R.y1),new d.pointGeometry(R.x2,R.y1),new d.pointGeometry(R.x2,R.y2),new d.pointGeometry(R.x1,R.y2)];d.polygonIntersectsPolygon(c,j)&&(P[z.bucketInstanceId][z.featureIndex]=!0,void 0===F[z.bucketInstanceId]&&(F[z.bucketInstanceId]=[]),F[z.bucketInstanceId].push(z.featureIndex))}return F}insertCollisionBox(o,c,g,y,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:y,collisionGroupID:x},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,c,g,y,x){const E=c?this.ignoredGrid:this.grid,T={bucketInstanceId:g,featureIndex:y,collisionGroupID:x};for(let P=0;P<o.length;P+=4)E.insertCircle(T,o[P],o[P+1],o[P+2])}projectAndGetPerspectiveRatio(o,c,g,y,x){const E=[c,g,y||0,1];let T=!1;if(y||this.transform.pitch>0){d.transformMat4$1(E,E,o);let P=!1;this.fogState&&x&&(P=function(F,R,z,j,Z,H){const W=H.calculateFogTileMatrix(Z),oe=[R,z,j];return d.transformMat4(oe,oe,W),to(F,oe,H.pitch,H._fov)}(this.fogState,c,g,y||0,x.toUnwrapped(),this.transform)>.9),T=E[2]>E[3]||P}else Ua(E,E,o);return{point:new d.pointGeometry((E[0]/E[3]+1)/2*this.transform.width+qo,(-E[1]/E[3]+1)/2*this.transform.height+qo),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/E[3]*.5,1.5),signedDistanceFromCamera:E[3],aboveHorizon:T}}isOffscreen(o,c,g,y){return g<qo||o>=this.screenRightBoundary||y<qo||c>this.screenBottomBoundary}isInsideGrid(o,c,g,y){return g>=0&&o<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const o=d.identity([]);return d.translate(o,o,[-100,-100,0]),o}}class Dc{constructor(o,c,g,y){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?c:-c))):y&&g?1:0,this.placed=g}isHidden(){return 0===this.opacity&&!this.placed}}class xt{constructor(o,c,g,y,x,E=!1){this.text=new Dc(o?o.text:null,c,g,x),this.icon=new Dc(o?o.icon:null,c,y,x),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class tr{constructor(o,c,g,y=!1){this.text=o,this.icon=c,this.skipFade=g,this.clipped=y}}class Fl{constructor(){this.invProjMatrix=d.create(),this.viewportMatrix=d.create(),this.circles=[]}}class op{constructor(o,c,g,y,x){this.bucketInstanceId=o,this.featureIndex=c,this.sourceLayerIndex=g,this.bucketIndex=y,this.tileID=x}}class sp{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const c=++this.maxGroupID;this.collisionGroups[o]={ID:c,predicate:g=>g.collisionGroupID===c}}return this.collisionGroups[o]}}function Zs(f,o,c,g,y){const{horizontalAlign:x,verticalAlign:E}=d.getAnchorAlignment(f),T=-(x-.5)*o,P=-(E-.5)*c,F=d.evaluateVariableOffset(f,g);return new d.pointGeometry(T+F[0]*y,P+F[1]*y)}function nr(f,o,c,g,y){const x=new d.pointGeometry(f,o);return c&&x._rotate(g?y:-y),x}class vu{constructor(o,c,g,y,x){this.transform=o.clone(),this.collisionIndex=new en(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new sp(g),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,c,g,y){const x=g.getBucket(c),E=g.latestFeatureIndex;if(!x||!E||c.id!==x.layerIds[0])return;const T=x.layers[0].layout,P=g.collisionBoxArray,F=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),R=g.tileSize/d.EXTENT,z=g.tileID.toUnwrapped(),j=this.transform.calculateProjMatrix(z),Z="map"===T.get("text-pitch-alignment"),H="map"===T.get("text-rotation-alignment");c.compileFilter();const W=c.dynamicFilter(),oe=c.dynamicFilterNeedsFeature(),$=this.transform.calculatePixelsToTileUnitsMatrix(g),ne=vs(j,g.tileID.canonical,Z,H,this.transform,$);let ee=null;if(Z){const se=Ho(j,g.tileID.canonical,Z,H,this.transform,$);ee=d.multiply$1([],this.transform.labelPlaneMatrix,se)}let te=null;W&&g.latestFeatureIndex&&(te={unwrappedTileID:z,dynamicFilter:W,dynamicFilterNeedsFeature:oe,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new op(x.bucketInstanceId,E,x.sourceLayerIndex,x.index,g.tileID);const re={bucket:x,layout:T,posMatrix:j,textLabelPlaneMatrix:ne,labelToScreenMatrix:ee,clippingData:te,scale:F,textPixelRatio:R,holdingForFade:g.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:d.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:d.evaluateSizeForZoom(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(y)for(const se of x.sortKeyRanges){const{sortKey:ge,symbolInstanceStart:xe,symbolInstanceEnd:Ue}=se;o.push({sortKey:ge,symbolInstanceStart:xe,symbolInstanceEnd:Ue,parameters:re})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:re})}attemptAnchorPlacement(o,c,g,y,x,E,T,P,F,R,z,j,Z,H,W,oe,$,ne){const ee=[j.textOffset0,j.textOffset1],te=Zs(o,g,y,ee,x),re=this.collisionIndex.placeCollisionBox(x,c,nr(te.x,te.y,E,T,this.transform.angle),z,P,F,R.predicate);if((!oe||0!==this.collisionIndex.placeCollisionBox(H.getSymbolInstanceIconSize(ne,this.transform.zoom,Z),oe,nr(te.x,te.y,E,T,this.transform.angle),z,P,F,R.predicate).box.length)&&re.box.length>0){let se;return this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(se=this.prevPlacement.variableOffsets[j.crossTileID].anchor),this.variableOffsets[j.crossTileID]={textOffset:ee,width:g,height:y,anchor:o,textScale:x,prevAnchor:se},this.markUsedJustification(H,o,j,W),H.allowVerticalPlacement&&(this.markUsedOrientation(H,W,j),this.placedOrientations[j.crossTileID]=W),{shift:te,placedGlyphBoxes:re}}}placeLayerBucketPart(o,c,g,y){const{bucket:x,layout:E,posMatrix:T,textLabelPlaneMatrix:P,labelToScreenMatrix:F,clippingData:R,textPixelRatio:z,holdingForFade:j,collisionBoxArray:Z,partiallyEvaluatedTextSize:H,partiallyEvaluatedIconSize:W,collisionGroup:oe}=o.parameters,$=E.get("text-optional"),ne=E.get("icon-optional"),ee=E.get("text-allow-overlap"),te=E.get("icon-allow-overlap"),re="map"===E.get("text-rotation-alignment"),se="map"===E.get("text-pitch-alignment"),ge="none"!==E.get("icon-text-fit"),xe="viewport-y"===E.get("symbol-z-order"),Ue=ee&&(te||!x.hasIconData()||ne),Re=te&&(ee||!x.hasTextData()||$);!x.collisionArrays&&Z&&x.deserializeCollisionBoxes(Z),g&&y&&x.updateCollisionDebugBuffers(this.transform.zoom,Z);const ke=(be,ve,Fe)=>{if(R){const Ut={zoom:this.transform.zoom,pitch:this.transform.pitch};let ft=null;if(R.dynamicFilterNeedsFeature){const Bt=this.retainedQueryData[x.bucketInstanceId];ft=R.featureIndex.loadFeature({featureIndex:be.featureIndex,bucketIndex:Bt.bucketIndex,sourceLayerIndex:Bt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,R.dynamicFilter)(Ut,ft,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new d.pointGeometry(be.tileAnchorX,be.tileAnchorY),this.transform.calculateDistanceTileData(R.unwrappedTileID)))return this.placements[be.crossTileID]=new tr(!1,!1,!1,!0),void(c[be.crossTileID]=!0)}if(c[be.crossTileID])return;if(j)return void(this.placements[be.crossTileID]=new tr(!1,!1,!1));let Me=!1,tt=!1,lt=!0,Mt=null,je={box:null,offscreen:null},st={box:null,offscreen:null},mt=null,ln=null,_n=null,yt=0,Lt=0,yn=0;Fe.textFeatureIndex?yt=Fe.textFeatureIndex:be.useRuntimeCollisionCircles&&(yt=be.featureIndex),Fe.verticalTextFeatureIndex&&(Lt=Fe.verticalTextFeatureIndex);const Jn=Ut=>{Ut.tileID=this.retainedQueryData[x.bucketInstanceId].tileID,(this.transform.elevation||Ut.elevation)&&(Ut.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[x.bucketInstanceId].tileID,Ut.tileAnchorX,Ut.tileAnchorY):0)},Vr=Fe.textBox;if(Vr){Jn(Vr);const Ut=Bt=>{let Dn=d.WritingMode.horizontal;if(x.allowVerticalPlacement&&!Bt&&this.prevPlacement){const ri=this.prevPlacement.placedOrientations[be.crossTileID];ri&&(this.placedOrientations[be.crossTileID]=ri,Dn=ri,this.markUsedOrientation(x,Dn,be))}return Dn},ft=(Bt,Dn)=>{if(x.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&Fe.verticalTextBox){for(const ri of x.writingModes)if(ri===d.WritingMode.vertical?(je=Dn(),st=je):je=Bt(),je&&je.box&&je.box.length)break}else je=Bt()};if(E.get("text-variable-anchor")){let Bt=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[be.crossTileID]){const pn=this.prevPlacement.variableOffsets[be.crossTileID];Bt.indexOf(pn.anchor)>0&&(Bt=Bt.filter(Hi=>Hi!==pn.anchor),Bt.unshift(pn.anchor))}const Dn=(pn,Hi,el)=>{const ii=x.getSymbolInstanceTextSize(H,be,this.transform.zoom,ve),fa=(pn.x2-pn.x1)*ii+2*pn.padding,nt=(pn.y2-pn.y1)*ii+2*pn.padding,at=ge&&!te?Hi:null;at&&Jn(at);let or={box:[],offscreen:!1};const ts=ee?2*Bt.length:Bt.length;for(let co=0;co<ts;++co){const sr=this.attemptAnchorPlacement(Bt[co%Bt.length],pn,fa,nt,ii,re,se,z,T,oe,co>=Bt.length,be,ve,x,el,at,H,W);if(sr&&(or=sr.placedGlyphBoxes,or&&or.box&&or.box.length)){Me=!0,Mt=sr.shift;break}}return or};ft(()=>Dn(Vr,Fe.iconBox,d.WritingMode.horizontal),()=>{const pn=Fe.verticalTextBox;return pn&&Jn(pn),x.allowVerticalPlacement&&!(je&&je.box&&je.box.length)&&be.numVerticalGlyphVertices>0&&pn?Dn(pn,Fe.verticalIconBox,d.WritingMode.vertical):{box:null,offscreen:null}}),je&&(Me=je.box,lt=je.offscreen);const ri=Ut(je&&je.box);if(!Me&&this.prevPlacement){const pn=this.prevPlacement.variableOffsets[be.crossTileID];pn&&(this.variableOffsets[be.crossTileID]=pn,this.markUsedJustification(x,pn.anchor,be,ri))}}else{const Bt=(Dn,ri)=>{const pn=x.getSymbolInstanceTextSize(H,be,this.transform.zoom,ve),Hi=this.collisionIndex.placeCollisionBox(pn,Dn,new d.pointGeometry(0,0),ee,z,T,oe.predicate);return Hi&&Hi.box&&Hi.box.length&&(this.markUsedOrientation(x,ri,be),this.placedOrientations[be.crossTileID]=ri),Hi};ft(()=>Bt(Vr,d.WritingMode.horizontal),()=>{const Dn=Fe.verticalTextBox;return x.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&Dn?(Jn(Dn),Bt(Dn,d.WritingMode.vertical)):{box:null,offscreen:null}}),Ut(je&&je.box&&je.box.length)}}if(mt=je,Me=mt&&mt.box&&mt.box.length>0,lt=mt&&mt.offscreen,be.useRuntimeCollisionCircles){const Ut=x.text.placedSymbolArray.get(be.centerJustifiedTextSymbolIndex>=0?be.centerJustifiedTextSymbolIndex:be.verticalPlacedTextSymbolIndex),ft=d.evaluateSizeForFeature(x.textSizeData,H,Ut),Bt=E.get("text-padding");ln=this.collisionIndex.placeCollisionCircles(ee,Ut,x.lineVertexArray,x.glyphOffsetArray,ft,T,P,F,g,se,oe.predicate,be.collisionCircleDiameter*ft/d.ONE_EM,Bt,this.retainedQueryData[x.bucketInstanceId].tileID),Me=ee||ln.circles.length>0&&!ln.collisionDetected,lt=lt&&ln.offscreen}if(Fe.iconFeatureIndex&&(yn=Fe.iconFeatureIndex),Fe.iconBox){const Ut=ft=>{Jn(ft);const Bt=ge&&Mt?nr(Mt.x,Mt.y,re,se,this.transform.angle):new d.pointGeometry(0,0),Dn=x.getSymbolInstanceIconSize(W,this.transform.zoom,ve);return this.collisionIndex.placeCollisionBox(Dn,ft,Bt,te,z,T,oe.predicate)};st&&st.box&&st.box.length&&Fe.verticalIconBox?(_n=Ut(Fe.verticalIconBox),tt=_n.box.length>0):(_n=Ut(Fe.iconBox),tt=_n.box.length>0),lt=lt&&_n.offscreen}const ni=$||0===be.numHorizontalGlyphVertices&&0===be.numVerticalGlyphVertices,$i=ne||0===be.numIconVertices;if(ni||$i?$i?ni||(tt=tt&&Me):Me=tt&&Me:tt=Me=tt&&Me,Me&&mt&&mt.box&&this.collisionIndex.insertCollisionBox(mt.box,E.get("text-ignore-placement"),x.bucketInstanceId,st&&st.box&&Lt?Lt:yt,oe.ID),tt&&_n&&this.collisionIndex.insertCollisionBox(_n.box,E.get("icon-ignore-placement"),x.bucketInstanceId,yn,oe.ID),ln&&(Me&&this.collisionIndex.insertCollisionCircles(ln.circles,E.get("text-ignore-placement"),x.bucketInstanceId,yt,oe.ID),g)){const Ut=x.bucketInstanceId;let ft=this.collisionCircleArrays[Ut];void 0===ft&&(ft=this.collisionCircleArrays[Ut]=new Fl);for(let Bt=0;Bt<ln.circles.length;Bt+=4)ft.circles.push(ln.circles[Bt+0]),ft.circles.push(ln.circles[Bt+1]),ft.circles.push(ln.circles[Bt+2]),ft.circles.push(ln.collisionDetected?1:0)}this.placements[be.crossTileID]=new tr(Me||Ue,tt||Re,lt||x.justReloaded),c[be.crossTileID]=!0};if(xe){const be=x.getSortedSymbolIndexes(this.transform.angle);for(let ve=be.length-1;ve>=0;--ve){const Fe=be[ve];ke(x.symbolInstances.get(Fe),Fe,x.collisionArrays[Fe])}}else for(let be=o.symbolInstanceStart;be<o.symbolInstanceEnd;be++)ke(x.symbolInstances.get(be),be,x.collisionArrays[be]);if(g&&x.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[x.bucketInstanceId];d.invert(be.invProjMatrix,T),be.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(o,c,g,y){let x;x=y===d.WritingMode.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[d.getAnchorJustification(c)];const E=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const T of E)T>=0&&(o.text.placedSymbolArray.get(T).crossTileID=x>=0&&T!==x?0:g.crossTileID)}markUsedOrientation(o,c,g){const y=c===d.WritingMode.horizontal||c===d.WritingMode.horizontalOnly?c:0,x=c===d.WritingMode.vertical?c:0,E=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const T of E)o.text.placedSymbolArray.get(T).placedOrientation=y;g.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let g=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const y=c?c.symbolFadeChange(o):1,x=c?c.opacities:{},E=c?c.variableOffsets:{},T=c?c.placedOrientations:{};for(const P in this.placements){const F=this.placements[P],R=x[P];R?(this.opacities[P]=new xt(R,y,F.text,F.icon,null,F.clipped),g=g||F.text!==R.text.placed||F.icon!==R.icon.placed):(this.opacities[P]=new xt(null,y,F.text,F.icon,F.skipFade,F.clipped),g=g||F.text||F.icon)}for(const P in x){const F=x[P];if(!this.opacities[P]){const R=new xt(F,y,!1,!1);R.isHidden()||(this.opacities[P]=R,g=g||F.text.placed||F.icon.placed)}}for(const P in E)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=E[P]);for(const P in T)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=T[P]);g?this.lastPlacementChangeTime=o:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:o)}updateLayerOpacities(o,c){const g={};for(const y of c){const x=y.getBucket(o);x&&y.latestFeatureIndex&&o.id===x.layerIds[0]&&this.updateBucketOpacities(x,g,y.collisionBoxArray)}}updateBucketOpacities(o,c,g){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const y=o.layers[0].layout,x=!!o.layers[0].dynamicFilter(),E=new xt(null,0,!1,!1,!0),T=y.get("text-allow-overlap"),P=y.get("icon-allow-overlap"),F=y.get("text-variable-anchor"),R="map"===y.get("text-rotation-alignment"),z="map"===y.get("text-pitch-alignment"),j="none"!==y.get("icon-text-fit"),Z=new xt(null,0,T&&(P||!o.hasIconData()||y.get("icon-optional")),P&&(T||!o.hasTextData()||y.get("text-optional")),!0);!o.collisionArrays&&g&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(g);const H=(oe,$,ne)=>{for(let ee=0;ee<$/4;ee++)oe.opacityVertexArray.emplaceBack(ne)};let W=0;for(let oe=0;oe<o.symbolInstances.length;oe++){const $=o.symbolInstances.get(oe),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:ee,crossTileID:te}=$;let re=this.opacities[te];c[te]?re=E:re||(re=Z,this.opacities[te]=re),c[te]=!0;const se=ne>0||ee>0,ge=$.numIconVertices>0,xe=this.placedOrientations[$.crossTileID],Ue=xe===d.WritingMode.vertical,Re=xe===d.WritingMode.horizontal||xe===d.WritingMode.horizontalOnly;if(!se&&!ge||re.isHidden()||W++,se){const ke=xu(re.text);H(o.text,ne,Ue?ws:ke),H(o.text,ee,Re?ws:ke);const be=re.text.isHidden();[$.rightJustifiedTextSymbolIndex,$.centerJustifiedTextSymbolIndex,$.leftJustifiedTextSymbolIndex].forEach(Me=>{Me>=0&&(o.text.placedSymbolArray.get(Me).hidden=be||Ue?1:0)}),$.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get($.verticalPlacedTextSymbolIndex).hidden=be||Re?1:0);const ve=this.variableOffsets[$.crossTileID];ve&&this.markUsedJustification(o,ve.anchor,$,xe);const Fe=this.placedOrientations[$.crossTileID];Fe&&(this.markUsedJustification(o,"left",$,Fe),this.markUsedOrientation(o,Fe,$))}if(ge){const ke=xu(re.icon);$.placedIconSymbolIndex>=0&&(H(o.icon,$.numIconVertices,Ue?ws:ke),o.icon.placedSymbolArray.get($.placedIconSymbolIndex).hidden=re.icon.isHidden()),$.verticalPlacedIconSymbolIndex>=0&&(H(o.icon,$.numVerticalIconVertices,Re?ws:ke),o.icon.placedSymbolArray.get($.verticalPlacedIconSymbolIndex).hidden=re.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const ke=o.collisionArrays[oe];if(ke){let be=new d.pointGeometry(0,0),ve=!0;if(ke.textBox||ke.verticalTextBox){if(F){const Me=this.variableOffsets[te];Me?(be=Zs(Me.anchor,Me.width,Me.height,Me.textOffset,Me.textScale),R&&be._rotate(z?this.transform.angle:-this.transform.angle)):ve=!1}x&&(ve=!re.clipped),ke.textBox&&xs(o.textCollisionBox.collisionVertexArray,re.text.placed,!ve||Ue,be.x,be.y),ke.verticalTextBox&&xs(o.textCollisionBox.collisionVertexArray,re.text.placed,!ve||Re,be.x,be.y)}const Fe=ve&&Boolean(!Re&&ke.verticalIconBox);ke.iconBox&&xs(o.iconCollisionBox.collisionVertexArray,re.icon.placed,Fe,j?be.x:0,j?be.y:0),ke.verticalIconBox&&xs(o.iconCollisionBox.collisionVertexArray,re.icon.placed,!Fe,j?be.x:0,j?be.y:0)}}}if(o.fullyClipped=0===W,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const oe=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=oe.invProjMatrix,o.placementViewportMatrix=oe.viewportMatrix,o.collisionCircleArray=oe.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return 0===this.fadeDuration?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,c){const g=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*g>o}setStale(){this.stale=!0}}function xs(f,o,c,g,y){f.emplaceBack(o?1:0,c?1:0,g||0,y||0),f.emplaceBack(o?1:0,c?1:0,g||0,y||0),f.emplaceBack(o?1:0,c?1:0,g||0,y||0),f.emplaceBack(o?1:0,c?1:0,g||0,y||0)}const Ee=Math.pow(2,25),qe=Math.pow(2,24),ap=Math.pow(2,17),Ws=Math.pow(2,16),Wn=Math.pow(2,9),bs=Math.pow(2,8),Co=Math.pow(2,1);function xu(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const o=f.placed?1:0,c=Math.floor(127*f.opacity);return c*Ee+o*qe+c*ap+o*Ws+c*Wn+o*bs+c*Co+o}const ws=0;class Je{constructor(o){this._sortAcrossTiles="viewport-y"!==o.layout.get("symbol-z-order")&&void 0!==o.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,c,g,y,x){const E=this._bucketParts;for(;this._currentTileIndex<o.length;)if(c.getBucketParts(E,y,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((T,P)=>T.sortKey-P.sortKey));this._currentPartIndex<E.length;){const T=E[this._currentPartIndex];if(c.placeLayerBucketPart(T,this._seenCrossTileIDs,g,0===T.symbolInstanceStart),this._currentPartIndex++,x())return!0}return!1}}class _t{constructor(o,c,g,y,x,E,T,P){this.placement=new vu(o,x,E,T,P),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(o,c,g){const y=d.exported.now(),x=()=>{const E=d.exported.now()-y;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=c[o[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if("symbol"===E.type&&(!E.minzoom||E.minzoom<=T)&&(!E.maxzoom||E.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new Je(E)),this._inProgressLayer.continuePlacement(g[E.source],this.placement,this._showCollisionBoxes,E,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const ot=512/d.EXTENT/2;class Zo{constructor(o,c,g){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=g;for(let y=0;y<c.length;y++){const x=c.get(y),E=x.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,o)})}}getScaledCoordinates(o,c){const g=ot/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*d.EXTENT+o.tileAnchorX)*g),y:Math.floor((c.canonical.y*d.EXTENT+o.tileAnchorY)*g)}}findMatches(o,c,g){const y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let x=0;x<o.length;x++){const E=o.get(x);if(E.crossTileID)continue;const T=this.indexedSymbolInstances[E.key];if(!T)continue;const P=this.getScaledCoordinates(E,c);for(const F of T)if(Math.abs(F.coord.x-P.x)<=y&&Math.abs(F.coord.y-P.y)<=y&&!g[F.crossTileID]){g[F.crossTileID]=!0,E.crossTileID=F.crossTileID;break}}}}class Rl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class kt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const c=Math.round((o-this.lng)/360);if(0!==c)for(const g in this.indexes){const y=this.indexes[g],x={};for(const E in y){const T=y[E];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+c),x[T.tileID.key]=T}this.indexes[g]=x}this.lng=o}addBucket(o,c,g){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let x=0;x<c.symbolInstances.length;x++)c.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const y=this.usedCrossTileIDs[o.overscaledZ];for(const x in this.indexes){const E=this.indexes[x];if(Number(x)>o.overscaledZ)for(const T in E){const P=E[T];P.tileID.isChildOf(o)&&P.findMatches(c.symbolInstances,o,y)}else{const T=E[o.scaledTo(Number(x)).key];T&&T.findMatches(c.symbolInstances,o,y)}}for(let x=0;x<c.symbolInstances.length;x++){const E=c.symbolInstances.get(x);E.crossTileID||(E.crossTileID=g.generate(),y[E.crossTileID]=!0)}return void 0===this.indexes[o.overscaledZ]&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Zo(o,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(o,c){for(const g in c.indexedSymbolInstances)for(const y of c.indexedSymbolInstances[g])delete this.usedCrossTileIDs[o][y.crossTileID]}removeStaleBuckets(o){let c=!1;for(const g in this.indexes){const y=this.indexes[g];for(const x in y)o[y[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,y[x]),delete y[x],c=!0)}return c}}class tn{constructor(){this.layerIndexes={},this.crossTileIDs=new Rl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,c,g,y){let x=this.layerIndexes[o.id];void 0===x&&(x=this.layerIndexes[o.id]=new kt);let E=!1;const T={};"globe"!==y.name&&x.handleWrapJump(g);for(const P of c){const F=P.getBucket(o);F&&o.id===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(P.tileID,F,this.crossTileIDs)&&(E=!0),T[F.bucketInstanceId]=!0)}return x.removeStaleBuckets(T)&&(E=!0),E}pruneUnusedLayers(o){const c={};o.forEach(g=>{c[g]=!0});for(const g in this.layerIndexes)c[g]||delete this.layerIndexes[g]}}const Xs=(f,o)=>d.emitValidationErrors(f,o&&o.filter(c=>"source.canvas"!==c.identifier)),Xr=d.pick(Ie,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),di=d.pick(Ie,["setCenter","setZoom","setBearing","setPitch"]),Pn=function(){const f={},o=d.spec.$version;for(const c in d.spec.$root){const g=d.spec.$root[c];if(g.required){let y=null;y="version"===c?o:"array"===g.type?[]:{},null!=y&&(f[c]=y)}}return f}(),lp={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class pi extends d.Evented{constructor(o,c={}){super(),this.map=o,this.dispatcher=new no(ue(),this),this.imageManager=new xr,this.imageManager.setEventedParent(this),this.glyphManager=new d.GlyphManager(o._requestManager,c.localFontFamily?d.LocalGlyphMode.all:c.localIdeographFontFamily?d.LocalGlyphMode.ideographs:d.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.lineAtlas=new d.LineAtlas(256,512),this.crossTileSymbolIndex=new tn,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new d.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.getReferrer());const g=this;this._rtlTextPluginCallback=pi.registerForPluginStateChange(y=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(x,E)=>{if(d.triggerPluginCompletionEvent(x),E&&E.every(T=>T))for(const T in g._sourceCaches){const P=g._sourceCaches[T],F=P.getSource().type;"vector"!==F&&"geojson"!==F||P.reload()}})}),this.on("data",y=>{if("source"!==y.dataType||"metadata"!==y.sourceDataType)return;const x=this.getSource(y.sourceId);if(x&&x.vectorLayerIds)for(const E in this._layers){const T=this._layers[E];T.source===x.id&&this._validateLayer(T)}})}loadURL(o,c={}){this.fire(new d.Event("dataloading",{dataType:"style"}));const g="boolean"==typeof c.validate?c.validate:!d.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,c.accessToken);const y=this.map._requestManager.transformRequest(o,d.ResourceType.Style);this._request=d.getJSON(y,(x,E)=>{this._request=null,x?this.fire(new d.ErrorEvent(x)):E&&this._load(E,g)})}loadJSON(o,c={}){this.fire(new d.Event("dataloading",{dataType:"style"})),this._request=d.exported.frame(()=>{this._request=null,this._load(o,!1!==c.validate)})}loadEmpty(){this.fire(new d.Event("dataloading",{dataType:"style"})),this._load(Pn,!1)}_updateLayerCount(o,c){const g=c?1:-1;o.is3D()&&(this._num3DLayers+=g),"circle"===o.type&&(this._numCircleLayers+=g),"symbol"===o.type&&(this._numSymbolLayers+=g)}_load(o,c){if(c&&Xs(this,d.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o,this.updateProjection();for(const y in o.sources)this.addSource(y,o.sources[y],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const g=Te(this.stylesheet.layers);this._order=g.map(y=>y.id),this._layers={},this._serializedLayers={};for(let y of g)y=d.createStyleLayer(y),y.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=y,this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Go(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new d.Event("data",{dataType:"style"})),this.fire(new d.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&0===this.terrain.drapeRenderMode}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const o=this.map.transform.projection,c=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),g=this.map.transform.projection;if(this._loaded&&(g.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),c){if(g.isReprojectedInTileSpace||o.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(o){this._spriteRequest=function(c,g,y){let x,E,T;const P=d.exported.devicePixelRatio>1?"@2x":"";let F=d.getJSON(g.transformRequest(g.normalizeSpriteURL(c,P,".json"),d.ResourceType.SpriteJSON),(j,Z)=>{F=null,T||(T=j,x=Z,z())}),R=d.getImage(g.transformRequest(g.normalizeSpriteURL(c,P,".png"),d.ResourceType.SpriteImage),(j,Z)=>{R=null,T||(T=j,E=Z,z())});function z(){if(T)y(T);else if(x&&E){const j=d.exported.getImageData(E),Z={};for(const H in x){const{width:W,height:oe,x:$,y:ne,sdf:ee,pixelRatio:te,stretchX:re,stretchY:se,content:ge}=x[H],xe=new d.RGBAImage({width:W,height:oe});d.RGBAImage.copy(j,xe,{x:$,y:ne},{x:0,y:0},{width:W,height:oe}),Z[H]={data:xe,pixelRatio:te,sdf:ee,stretchX:re,stretchY:se,content:ge}}y(null,Z)}}return{cancel(){F&&(F.cancel(),F=null),R&&(R.cancel(),R=null)}}}(o,this.map._requestManager,(c,g)=>{if(this._spriteRequest=null,c)this.fire(new d.ErrorEvent(c));else if(g)for(const y in g)this.imageManager.addImage(y,g[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new d.Event("data",{dataType:"style"}))})}_validateLayer(o){const c=this.getSource(o.source);if(!c)return;const g=o.sourceLayer;g&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(g))&&this.fire(new d.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${c.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const c=[];for(const g of o){const y=this._layers[g];"custom"!==y.type&&c.push(y.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&lp[o.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const c=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(y.length||x.length)&&this._updateWorkerLayers(y,x);for(const E in this._updatedSources){const T=this._updatedSources[E];"reload"===T?this._reloadSource(E):"clear"===T&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const g={};for(const y in this._sourceCaches){const x=this._sourceCaches[y];g[y]=x.used,x.used=!1}for(const y of this._order){const x=this._layers[y];if(x.recalculate(o,this._availableImages),!x.isHidden(o.zoom)){const T=this._getLayerSourceCache(x);T&&(T.used=!0)}const E=this.map.painter;if(E){const T=x.getProgramIds();if(!T)continue;const P=x.getProgramConfiguration(o.zoom);for(const F of T)E.useProgram(F,P)}}for(const y in g){const x=this._sourceCaches[y];g[y]!==x.used&&x.getSource().fire(new d.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new d.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),Xs(this,d.validateStyle(o)))return!1;(o=d.clone$1(o)).layers=Te(o.layers);const c=function(y,x){if(!y)return[{command:Ie.setStyle,args:[x]}];let E=[];try{if(!vt(y.version,x.version))return[{command:Ie.setStyle,args:[x]}];vt(y.center,x.center)||E.push({command:Ie.setCenter,args:[x.center]}),vt(y.zoom,x.zoom)||E.push({command:Ie.setZoom,args:[x.zoom]}),vt(y.bearing,x.bearing)||E.push({command:Ie.setBearing,args:[x.bearing]}),vt(y.pitch,x.pitch)||E.push({command:Ie.setPitch,args:[x.pitch]}),vt(y.sprite,x.sprite)||E.push({command:Ie.setSprite,args:[x.sprite]}),vt(y.glyphs,x.glyphs)||E.push({command:Ie.setGlyphs,args:[x.glyphs]}),vt(y.transition,x.transition)||E.push({command:Ie.setTransition,args:[x.transition]}),vt(y.light,x.light)||E.push({command:Ie.setLight,args:[x.light]}),vt(y.fog,x.fog)||E.push({command:Ie.setFog,args:[x.fog]}),vt(y.projection,x.projection)||E.push({command:Ie.setProjection,args:[x.projection]});const T={},P=[];!function(z,j,Z,H){let W;for(W in j=j||{},z=z||{})z.hasOwnProperty(W)&&(j.hasOwnProperty(W)||rt(W,Z,H));for(W in j)j.hasOwnProperty(W)&&(z.hasOwnProperty(W)?vt(z[W],j[W])||("geojson"===z[W].type&&"geojson"===j[W].type&&ct(z,j,W)?Z.push({command:Ie.setGeoJSONSourceData,args:[W,j[W].data]}):ut(W,j,Z,H)):Le(W,j,Z))}(y.sources,x.sources,P,T);const F=[];y.layers&&y.layers.forEach(z=>{T[z.source]?E.push({command:Ie.removeLayer,args:[z.id]}):F.push(z)});let R=y.terrain;R&&T[R.source]&&(E.push({command:Ie.setTerrain,args:[void 0]}),R=void 0),E=E.concat(P),vt(R,x.terrain)||E.push({command:Ie.setTerrain,args:[x.terrain]}),function(z,j,Z){j=j||[];const H=(z=z||[]).map(Pt),W=j.map(Pt),oe=z.reduce(bn,{}),$=j.reduce(bn,{}),ne=H.slice(),ee=Object.create(null);let te,re,se,ge,xe,Ue,Re;for(te=0,re=0;te<H.length;te++)se=H[te],$.hasOwnProperty(se)?re++:(Z.push({command:Ie.removeLayer,args:[se]}),ne.splice(ne.indexOf(se,re),1));for(te=0,re=0;te<W.length;te++)se=W[W.length-1-te],ne[ne.length-1-te]!==se&&(oe.hasOwnProperty(se)?(Z.push({command:Ie.removeLayer,args:[se]}),ne.splice(ne.lastIndexOf(se,ne.length-re),1)):re++,Ue=ne[ne.length-te],Z.push({command:Ie.addLayer,args:[$[se],Ue]}),ne.splice(ne.length-te,0,se),ee[se]=!0);for(te=0;te<W.length;te++)if(se=W[te],ge=oe[se],xe=$[se],!ee[se]&&!vt(ge,xe))if(vt(ge.source,xe.source)&&vt(ge["source-layer"],xe["source-layer"])&&vt(ge.type,xe.type)){for(Re in ht(ge.layout,xe.layout,Z,se,null,Ie.setLayoutProperty),ht(ge.paint,xe.paint,Z,se,null,Ie.setPaintProperty),vt(ge.filter,xe.filter)||Z.push({command:Ie.setFilter,args:[se,xe.filter]}),vt(ge.minzoom,xe.minzoom)&&vt(ge.maxzoom,xe.maxzoom)||Z.push({command:Ie.setLayerZoomRange,args:[se,xe.minzoom,xe.maxzoom]}),ge)ge.hasOwnProperty(Re)&&"layout"!==Re&&"paint"!==Re&&"filter"!==Re&&"metadata"!==Re&&"minzoom"!==Re&&"maxzoom"!==Re&&(0===Re.indexOf("paint.")?ht(ge[Re],xe[Re],Z,se,Re.slice(6),Ie.setPaintProperty):vt(ge[Re],xe[Re])||Z.push({command:Ie.setLayerProperty,args:[se,Re,xe[Re]]}));for(Re in xe)xe.hasOwnProperty(Re)&&!ge.hasOwnProperty(Re)&&"layout"!==Re&&"paint"!==Re&&"filter"!==Re&&"metadata"!==Re&&"minzoom"!==Re&&"maxzoom"!==Re&&(0===Re.indexOf("paint.")?ht(ge[Re],xe[Re],Z,se,Re.slice(6),Ie.setPaintProperty):vt(ge[Re],xe[Re])||Z.push({command:Ie.setLayerProperty,args:[se,Re,xe[Re]]}))}else Z.push({command:Ie.removeLayer,args:[se]}),Ue=ne[ne.lastIndexOf(se)+1],Z.push({command:Ie.addLayer,args:[xe,Ue]})}(F,x.layers,E)}catch(T){console.warn("Unable to compute style diff:",T),E=[{command:Ie.setStyle,args:[x]}]}return E}(this.serialize(),o).filter(y=>!(y.command in di));if(0===c.length)return!1;const g=c.filter(y=>!(y.command in Xr));if(g.length>0)throw new Error(`Unimplemented: ${g.map(y=>y.command).join(", ")}.`);return c.forEach(y=>{"setTransition"!==y.command&&this[y.command].apply(this,y.args)}),this.stylesheet=o,this.updateProjection(),!0}addImage(o,c){if(this.getImage(o))return this.fire(new d.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(o,c),this._afterImageUpdated(o)}updateImage(o,c){this.imageManager.updateImage(o,c)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new d.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(o,c,g={}){if(this._checkLoaded(),void 0!==this.getSource(o))throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(d.validateStyle.source,`sources.${o}`,c,null,g))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const y=Ai(o,c,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:y.serialize(),sourceId:o}));const x=E=>{const T=(E?"symbol:":"other:")+o,P=this._sourceCaches[T]=new d.SourceCache(T,y,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[o]=P,P.style=this,P.onAdd(this.map)};x(!1),"vector"!==c.type&&"geojson"!==c.type||x(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const c=this.getSource(o);if(void 0===c)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===o)return this.fire(new d.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new d.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(o);for(const y of g)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new d.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,c){this._checkLoaded(),this.getSource(o).setData(c),this._changed=!0}getSource(o){const c=this._getSourceCache(o);return c&&c.getSource()}addLayer(o,c,g={}){this._checkLoaded();const y=o.id;if(this.getLayer(y))return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let x;if("custom"===o.type){if(Xs(this,d.validateCustomStyleLayer(o)))return;x=d.createStyleLayer(o)}else{if("object"==typeof o.source&&(this.addSource(y,o.source),o=d.clone$1(o),o=d.extend(o,{source:y})),this._validate(d.validateStyle.layer,`layers.${y}`,o,{arrayIndex:-1},g))return;x=d.createStyleLayer(o),this._validateLayer(x),x.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}const E=c?this._order.indexOf(c):this._order.length;if(c&&-1===E)return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(E,0,y),this._layerOrderChanged=!0,this._layers[y]=x;const T=this._getLayerSourceCache(x);if(this._removedLayers[y]&&x.source&&T&&"custom"!==x.type){const P=this._removedLayers[y];delete this._removedLayers[y],P.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",T.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,c){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===c)return;const g=this._order.indexOf(o);this._order.splice(g,1);const y=c?this._order.indexOf(c):this._order.length;c&&-1===y?this.fire(new d.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(y,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const c=this._layers[o];if(!c)return void this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const g=this._order.indexOf(o);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=c,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const c in this._layers)if(this._layers[c].type===o)return!0;return!1}setLayerZoomRange(o,c,g){this._checkLoaded();const y=this.getLayer(o);y?y.minzoom===c&&y.maxzoom===g||(null!=c&&(y.minzoom=c),null!=g&&(y.maxzoom=g),this._updateLayer(y)):this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,c,g={}){this._checkLoaded();const y=this.getLayer(o);if(y){if(!vt(y.filter,c))return null==c?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(d.validateStyle.filter,`layers.${y.id}.filter`,c,{layerType:y.type},g)||(y.filter=d.clone$1(c),this._updateLayer(y)))}else this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){return d.clone$1(this.getLayer(o).filter)}setLayoutProperty(o,c,g,y={}){this._checkLoaded();const x=this.getLayer(o);x?vt(x.getLayoutProperty(c),g)||(x.setLayoutProperty(c,g,y),this._updateLayer(x)):this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,c){const g=this.getLayer(o);if(g)return g.getLayoutProperty(c);this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,c,g,y={}){this._checkLoaded();const x=this.getLayer(o);x?vt(x.getPaintProperty(c),g)||(x.setPaintProperty(c,g,y)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,c){return this.getLayer(o).getPaintProperty(c)}setFeatureState(o,c){this._checkLoaded();const g=o.source,y=o.sourceLayer,x=this.getSource(g);if(void 0===x)return void this.fire(new d.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const E=x.type;if("geojson"===E&&y)return void this.fire(new d.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===E&&!y)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===o.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided.")));const T=this._getSourceCaches(g);for(const P of T)P.setFeatureState(y,o.id,c)}removeFeatureState(o,c){this._checkLoaded();const g=o.source,y=this.getSource(g);if(void 0===y)return void this.fire(new d.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const x=y.type,E="vector"===x?o.sourceLayer:void 0;if("vector"===x&&!E)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof o.id&&"number"!=typeof o.id)return void this.fire(new d.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const T=this._getSourceCaches(g);for(const P of T)P.removeFeatureState(E,o.id,c)}getFeatureState(o){this._checkLoaded();const c=o.source,g=o.sourceLayer,y=this.getSource(c);if(void 0!==y){if("vector"!==y.type||g)return void 0===o.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(g,o.id);this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return d.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const c in this._sourceCaches){const g=this._sourceCaches[c].getSource();o[g.id]||(o[g.id]=g.serialize())}return d.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:o,layers:this._serializeLayers(this._order)},c=>void 0!==c)}_updateLayer(o){this._updatedLayers[o.id]=!0;const c=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&c&&"raster"!==c.getSource().type&&(this._updatedSources[o.source]="reload",c.pause()),this._changed=!0,o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const c=E=>"fill-extrusion"===this._layers[E].type,g={},y=[];for(let E=this._order.length-1;E>=0;E--){const T=this._order[E];if(c(T)){g[T]=E;for(const P of o){const F=P[T];if(F)for(const R of F)y.push(R)}}}y.sort((E,T)=>T.intersectionZ-E.intersectionZ);const x=[];for(let E=this._order.length-1;E>=0;E--){const T=this._order[E];if(c(T))for(let P=y.length-1;P>=0;P--){const F=y[P].feature;if(g[F.layer.id]<E)break;x.push(F),y.pop()}else for(const P of o){const F=P[T];if(F)for(const R of F)x.push(R.feature)}}return x}queryRenderedFeatures(o,c,g){c&&c.filter&&this._validate(d.validateStyle.filter,"queryRenderedFeatures.filter",c.filter,null,c);const y={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new d.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of c.layers){const F=this._layers[P];if(!F)return this.fire(new d.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];y[F.source]=!0}}const x=[];c.availableImages=this._availableImages;const E=c&&c.layers?c.layers.some(P=>{const F=this.getLayer(P);return F&&F.is3D()}):this.has3DLayers(),T=Na.createFromScreenPoints(o,g);for(const P in this._sourceCaches){const F=this._sourceCaches[P].getSource().id;c.layers&&!y[F]||x.push(L(this._sourceCaches[P],this._layers,this._serializedLayers,T,c,g,E,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(P,F,R,z,j,Z,H){const W={},oe=Z.queryRenderedSymbols(z),$=[];for(const ne of Object.keys(oe).map(Number))$.push(H[ne]);$.sort(X);for(const ne of $){const ee=ne.featureIndex.lookupSymbolFeatures(oe[ne.bucketInstanceId],F,ne.bucketIndex,ne.sourceLayerIndex,j.filter,j.layers,j.availableImages,P);for(const te in ee){const re=W[te]=W[te]||[],se=ee[te];se.sort((ge,xe)=>{const Ue=ne.featureSortOrder;if(Ue){const Re=Ue.indexOf(ge.featureIndex);return Ue.indexOf(xe.featureIndex)-Re}return xe.featureIndex-ge.featureIndex});for(const ge of se)re.push(ge)}}for(const ne in W)W[ne].forEach(ee=>{const te=ee.feature,re=R(P[ne]).getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=re});return W}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),T.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(o,c){c&&c.filter&&this._validate(d.validateStyle.filter,"querySourceFeatures.filter",c.filter,null,c);const g=this._getSourceCaches(o);let y=[];for(const x of g)y=y.concat(V(x,c));return y}addSourceType(o,c,g){return pi.getSourceType(o)?g(new Error(`A source type called "${o}" already exists.`)):(pi.setSourceType(o,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:c.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(o,c={}){this._checkLoaded();const g=this.light.getLight();let y=!1;for(const E in o)if(!vt(o[E],g[E])){y=!0;break}if(!y)return;const x={now:d.exported.now(),transition:d.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,c),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,c=1){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===c){if("object"==typeof o.source){const g="terrain-dem-src";this.addSource(g,o.source),o=d.clone$1(o),o=d.extend(o,{source:g})}if(this._validate(d.validateStyle.terrain,"terrain",o))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode)this._createTerrain(o,c);else{const g=this.terrain,y=g.get();for(const x in o)if(!vt(o[x],y[x])){g.set(o),this.stylesheet.terrain=o;const E={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};g.updateTransitions(E);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const c=this.fog=new Rh(o,this.map.transform);this.stylesheet.fog=o;const g={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(g)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,g=c.get();for(const y in o)if(!vt(o[y],g[y])){c.set(o),this.stylesheet.fog=o;const x={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(x);break}}else this._createFog(o);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(g=>this.isLayerDraped(this._layers[g])),c=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...c)}_createTerrain(o,c){const g=this.terrain=new wl(o,c);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const y={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};g.updateTransitions(y)}_force3DLayerUpdate(){for(const o in this._layers){const c=this._layers[o];"fill-extrusion"===c.type&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const c=this._layers[o];"symbol"===c.type&&this._updateLayer(c)}}_validate(o,c,g,y,x={}){return(!x||!1!==x.validate)&&Xs(this,o.call(d.validateStyle,d.extend({key:c,style:this.serialize(),value:g,styleSpec:d.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const c=this._getSourceCaches(o);for(const g of c)g.clearTiles()}_reloadSource(o){const c=this._getSourceCaches(o);for(const g of c)g.resume(),g.reload()}_updateSources(o){for(const c in this._sourceCaches)this._sourceCaches[c].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const c=this._sourceCaches[o];c.resume(),c.reload()}}_updatePlacement(o,c,g,y,x=!1){let E=!1,T=!1;const P={};for(const F of this._order){const R=this._layers[F];if("symbol"!==R.type)continue;if(!P[R.source]){const j=this._getLayerSourceCache(R);if(!j)continue;P[R.source]=j.getRenderableIds(!0).map(Z=>j.getTileByID(Z)).sort((Z,H)=>H.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(H.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(R,P[R.source],o.center.lng,o.projection);E=E||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),x=x||this._layerOrderChanged||0===g,this._layerOrderChanged&&this.fire(new d.Event("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.exported.now(),o.zoom))&&(this.pauseablePlacement=new _t(o,this._order,x,c,g,y,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.exported.now()),T=!0),E&&this.pauseablePlacement.placement.setStale()),T||E)for(const F of this._order){const R=this._layers[F];"symbol"===R.type&&this.placement.updateLayerOpacities(R,P[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,c,g){this.imageManager.getImages(c.icons,g),this._updateTilesForChangedImages();const y=x=>{x&&x.setDependencies(c.tileID.key,c.type,c.icons)};y(this._otherSourceCaches[c.source]),y(this._symbolSourceCaches[c.source])}getGlyphs(o,c,g){this.glyphManager.getGlyphs(c.stacks,g)}getResource(o,c,g){return d.makeRequest(c,g)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return"symbol"===o.type?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const c=[];return this._otherSourceCaches[o]&&c.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&c.push(this._symbolSourceCaches[o]),c}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}pi.getSourceType=function(f){return Va[f]},pi.setSourceType=function(f,o){Va[f]=o},pi.registerForPluginStateChange=d.registerForPluginStateChange;var Ll="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Wo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Es={},Ks={};Es=Ct("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Ks=Ct("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Wt=Ct("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}\n#ifdef PROJECTION_GLOBE_VIEW\nmat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Et=Ll;var Ol={background:Ct("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Ct("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Ct("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Ct("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ct("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Ct("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ct("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ct("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ct("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Ct("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Ct("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Ct("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Ct("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Ct("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Ct("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Ct("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ct("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Ct("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Ct("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Ct("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Ct("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Ct("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Ct("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Ct("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Ct("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ct("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Wo),skyboxGradient:Ct("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Wo),skyboxCapture:Ct("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ct("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:Ct("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function Ct(f,o,c){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,x=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),E=f.match(y),T=o.match(y),P=Ll.match(y);let F=T?T.concat(E):E;c||(Es.staticUniforms&&(F=Es.staticUniforms.concat(F)),Ks.staticUniforms&&(F=Ks.staticUniforms.concat(F))),F&&(F=F.concat(P));const R={};return{fragmentSource:f=f.replace(g,(z,j,Z,H,W)=>(R[W]=!0,"define"===j?`\n#ifndef HAS_UNIFORM_u_${W}\nvarying ${Z} ${H} ${W};\n#else\nuniform ${Z} ${H} u_${W};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${W}\n    ${Z} ${H} ${W} = u_${W};\n#endif\n`)),vertexSource:o=o.replace(g,(z,j,Z,H,W)=>{const oe="float"===H?"vec2":"vec4",$=W.match(/color/)?"color":oe;return R[W]?"define"===j?`\n#ifndef HAS_UNIFORM_u_${W}\nuniform lowp float u_${W}_t;\nattribute ${Z} ${oe} a_${W};\nvarying ${Z} ${H} ${W};\n#else\nuniform ${Z} ${H} u_${W};\n#endif\n`:"vec4"===$?`\n#ifndef HAS_UNIFORM_u_${W}\n    ${W} = a_${W};\n#else\n    ${Z} ${H} ${W} = u_${W};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${W}\n    ${W} = unpack_mix_${$}(a_${W}, u_${W}_t);\n#else\n    ${Z} ${H} ${W} = u_${W};\n#endif\n`:"define"===j?`\n#ifndef HAS_UNIFORM_u_${W}\nuniform lowp float u_${W}_t;\nattribute ${Z} ${oe} a_${W};\n#else\nuniform ${Z} ${H} u_${W};\n#endif\n`:"vec4"===$?`\n#ifndef HAS_UNIFORM_u_${W}\n    ${Z} ${H} ${W} = a_${W};\n#else\n    ${Z} ${H} ${W} = u_${W};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${W}\n    ${Z} ${H} ${W} = unpack_mix_${$}(a_${W}, u_${W}_t);\n#else\n    ${Z} ${H} ${W} = u_${W};\n#endif\n`}),staticAttributes:x,staticUniforms:F}}class pr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,c,g,y,x,E,T,P){this.context=o;let F=this.boundPaintVertexBuffers.length!==y.length;for(let R=0;!F&&R<y.length;R++)this.boundPaintVertexBuffers[R]!==y[R]&&(F=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===g&&!F&&this.boundIndexBuffer===x&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===P?(o.bindVertexArrayOES.set(this.vao),T&&T.bind(),x&&x.dynamicDraw&&x.bind(),P&&P.bind()):this.freshBind(c,g,y,x,E,T,P)}freshBind(o,c,g,y,x,E,T){let P;const F=o.numAttributes,R=this.context,z=R.gl;if(R.extVertexArrayObject)this.vao&&this.destroy(),this.vao=R.extVertexArrayObject.createVertexArrayOES(),R.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=o,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=y,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=T;else{P=R.currentNumAttributes||0;for(let j=F;j<P;j++)z.disableVertexAttribArray(j)}c.enableAttributes(z,o);for(const j of g)j.enableAttributes(z,o);E&&E.enableAttributes(z,o),T&&T.enableAttributes(z,o),c.bind(),c.setVertexAttribPointers(z,o,x);for(const j of g)j.bind(),j.setVertexAttribPointers(z,o,x);E&&(E.bind(),E.setVertexAttribPointers(z,o,x)),y&&y.bind(),T&&(T.bind(),T.setVertexAttribPointers(z,o,x)),R.currentNumAttributes=F}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function bu(f,o){const c=Math.pow(2,o.canonical.z),g=o.canonical.y;return[new d.MercatorCoordinate(0,g/c).toLngLat().lat,new d.MercatorCoordinate(0,(g+1)/c).toLngLat().lat]}function wu(f,o,c,g,y,x,E){const T=f.context,P=T.gl,F=c.fbo;if(!F)return;f.prepareDrawTile(o);const R=f.useProgram("hillshade");T.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,F.colorAttachment.get());const z=((W,oe,$,ne)=>{const ee=$.paint.get("hillshade-shadow-color"),te=$.paint.get("hillshade-highlight-color"),re=$.paint.get("hillshade-accent-color");let se=$.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===$.paint.get("hillshade-illumination-anchor")&&(se-=W.transform.angle);const ge=!W.options.moving;return{u_matrix:ne||W.transform.calculateProjMatrix(oe.tileID.toUnwrapped(),ge),u_image:0,u_latrange:bu(0,oe.tileID),u_light:[$.paint.get("hillshade-exaggeration"),se],u_shadow:ee,u_highlight:te,u_accent:re}})(f,c,g,f.terrain?o.projMatrix:null);f.prepareDrawProgram(T,R,o.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:Z,tileBoundsSegments:H}=f.getTileBoundsBuffers(c);R.draw(T,P.TRIANGLES,y,x,E,d.CullFaceMode.disabled,z,g.id,j,Z,H)}function En(f,o,c){if(!o.needsDEMTextureUpload)return;const g=f.context,y=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||f.getTileTexture(c.stride);const x=c.getPixels();o.demTexture?o.demTexture.update(x,{premultiply:!1}):o.demTexture=new d.Texture(g,x,y.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Kr(f,o,c,g,y,x){const E=f.context,T=E.gl;if(!o.dem)return;const P=o.dem;if(E.activeTexture.set(T.TEXTURE1),En(f,o,P),!o.demTexture)return;o.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);const F=P.dim;E.activeTexture.set(T.TEXTURE0);let R=o.fbo;if(!R){const H=new d.Texture(E,{width:F,height:F,data:null},T.RGBA);H.bind(T.LINEAR,T.CLAMP_TO_EDGE),R=o.fbo=E.createFramebuffer(F,F,!0),R.colorAttachment.set(H.texture)}E.bindFramebuffer.set(R.framebuffer),E.viewport.set([0,0,F,F]);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:j,tileBoundsSegments:Z}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(E,T.TRIANGLES,g,y,x,d.CullFaceMode.disabled,((H,W)=>{const oe=W.stride,$=d.create();return d.ortho($,0,d.EXTENT,-d.EXTENT,0,0,1),d.translate($,$,[0,-d.EXTENT,0]),{u_matrix:$,u_image:1,u_dimension:[oe,oe],u_zoom:H.overscaledZ,u_unpack:W.unpackVector}})(o.tileID,P),c.id,z,j,Z),o.needsHillshadePrepare=!1}const Js=(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_image0:new d.Uniform1i(f,o.u_image0),u_skirt_height:new d.Uniform1f(f,o.u_skirt_height)}),kr=(f,o)=>({u_matrix:f,u_image0:0,u_skirt_height:o}),Pi=(f,o,c,g,y)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:o,u_merc_matrix:c,u_zoom_transition:g,u_merc_center:y,u_image0:0});function Vi(f,o){return null!=f&&null!=o&&!(!f.hasData()||!o.hasData())&&null!=f.demTexture&&null!=o.demTexture&&f.tileID.key!==o.tileID.key}const Do=new class{constructor(){this.operations={}}newMorphing(f,o,c,g,y){if(f in this.operations){const x=this.operations[f];x.to.tileID.key!==c.tileID.key&&(x.queued=c)}else this.operations[f]={startTime:g,phase:0,duration:y,from:o,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const o=this.operations[f];return{from:o.from,to:o.to,phase:o.phase}}update(f){for(const o in this.operations){const c=this.operations[o];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[o];break}}}_nextOp(f,o){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=o,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Ys={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function em(f,o){const c=1<<f.z;return!o&&(0===f.x||f.x===c-1)||0===f.y||f.y===c-1}const qt=f=>({u_matrix:f});function cp(f,o,c,g,y){if(y>0){const x=d.exported.now(),E=(x-f.timeAdded)/y,T=o?(x-o.timeAdded)/y:-1,P=c.getSource(),F=g.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),R=!o||Math.abs(o.tileID.overscaledZ-F)>Math.abs(f.tileID.overscaledZ-F),z=R&&f.refreshedUponExpiration?1:d.clamp(R?E:1-T,0,1);return f.refreshedUponExpiration&&E>=1&&(f.refreshedUponExpiration=!1),o?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}class up extends d.SourceCache{constructor(o){const c={type:"raster-dem",maxzoom:o.transform.maxZoom},g=new no(ue(),null),y=Ai("mock-dem",c,g,o.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,c){o.state="loaded",c(null)}}class br extends d.SourceCache{constructor(o){const c=Ai("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new no(ue(),null),o.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,c,g){if(o.freezeTileCoverage)return;this.transform=o;const y=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,E)=>{if(x[E.key]="",!this._tiles[E.key]){const T=new d.Tile(E,this._source.tileSize*E.overscaleFactor(),o.tileZoom);T.state="loaded",this._tiles[E.key]=T}return x},{});for(const x in this._tiles)x in y||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(o){const c=this.proxyCachedFBO[o];if(void 0!==c){const g=Object.values(c);this.renderCachePool.push(...g),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class hn extends d.OverscaledTileID{constructor(o,c,g){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=c,this.projMatrix=g}}class oo extends d.Elevation{constructor(o,c){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,y,x]=function(P){const F=new d.StructArrayLayout4i8,R=new d.StructArrayLayout3ui6,z=131;F.reserve(17161),R.reserve(33800);const j=d.EXTENT/128,Z=d.EXTENT+j/2,H=Z+j;for(let oe=-j;oe<H;oe+=j)for(let $=-j;$<H;$+=j){const ne=$<0||$>Z||oe<0||oe>Z?24575:0,ee=d.clamp(Math.round($),0,d.EXTENT),te=d.clamp(Math.round(oe),0,d.EXTENT);F.emplaceBack(ee+ne,te,ee,te)}const W=(oe,$)=>{const ne=$*z+oe;R.emplaceBack(ne+1,ne,ne+z),R.emplaceBack(ne+z,ne+z+1,ne+1)};for(let oe=1;oe<129;oe++)for(let $=1;$<129;$++)W($,oe);return[0,129].forEach(oe=>{for(let $=0;$<130;$++)W($,oe),W(oe,$)}),[F,R,32768]}(),E=o.context;this.gridBuffer=E.createVertexBuffer(g,d.boundsAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(y),this.gridSegments=d.SegmentVector.simpleSegment(0,0,g.length,y.length),this.gridNoSkirtSegments=d.SegmentVector.simpleSegment(0,0,g.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new br(c.map),this.orthoMatrix=d.create(),d.ortho(this.orthoMatrix,0,d.EXTENT,0,d.EXTENT,0,1);const T=E.gl;this._overlapStencilMode=new d.StencilMode({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new up(c.map)}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency()}update(o,c,g){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const y=o.terrain.properties;this.sourceCache=0===o.terrain.drapeRenderMode?this._mockSourceCache:o._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const x=()=>{this.sourceCache.used&&d.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.getScaledDemTileSize();this.sourceCache.update(c,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),c.updateElevation(!g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==o.efficiency&&d.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&"source"===o.dataType?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):"style"===o.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=0===g._centerAltitude&&-1===this.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(g.center),-1),this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=c.getIds().map(P=>{const F=c.getTileByID(P).tileID;return F.projMatrix=g.calculateProjMatrix(F.toUnwrapped()),F});(function(P,F){const R=F.transform.pointCoordinate(F.transform.getCameraPoint()),z=new d.pointGeometry(R.x,R.y);P.sort((j,Z)=>{if(Z.overscaledZ-j.overscaledZ)return Z.overscaledZ-j.overscaledZ;const H=new d.pointGeometry(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),W=new d.pointGeometry(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),oe=z.mult(1<<j.canonical.z);return oe.x-=.5,oe.y-=.5,oe.distSqr(H)-oe.distSqr(W)})})(y,this.painter),this._previousZoom=g.zoom;const x=this.proxyToSource||{};this.proxyToSource={},y.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const P in E){const F=E[P];if(!F.used||(F!==this.sourceCache&&this.resetTileLookupCache(F.id),this._setupProxiedCoordsForOrtho(F,o[P],x),F.usedForTerrain))continue;const R=o[P];F.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[c.id]=y.map(P=>new hn(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1,this._updateTimestamp=d.exported.now();const T={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const F=this.terrainTileForTile[P.key];if(!F)continue;const R=F.tileID.key;R in T||(this._visibleDemTiles.push(F),T[R]=R)}}_assignTerrainTiles(o){this._initializing||o.forEach(c=>{if(this.terrainTileForTile[c.key])return;const g=this._findTileCoveringTileID(c,this.sourceCache);g&&(this.terrainTileForTile[c.key]=g)})}_prepareDEMTextures(){const o=this.painter.context,c=o.gl;for(const g in this.terrainTileForTile){const y=this.terrainTileForTile[g],x=y.dem;!x||y.demTexture&&!y.needsDEMTextureUpload||(o.activeTexture.set(c.TEXTURE1),En(this.painter,y,x))}}_prepareDemTileUniforms(o,c,g,y){if(!c||null==c.demTexture)return!1;const x=o.tileID.canonical,E=Math.pow(2,c.tileID.canonical.z-x.z),T=y||"";return g[`u_dem_tl${T}`]=[x.x*E%1,x.y*E%1],g[`u_dem_scale${T}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,c=o.gl;if(!this._emptyDepthBufferTexture){const g={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new d.Texture(o,g,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const c=this._visibleDemTiles.reduce((g,y)=>{if(!y.dem)return g;const x=y.dem.tree.minimums[0];return x>0&&o++,g+x},0);return o?c/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,c=o.gl;o.activeTexture.set(c.TEXTURE2);const g=this._getLoadedAreaMinimum(),y={width:1,height:1,data:new Uint8Array(d.DEMData.pack(g,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(y,{premultiply:!1}):x=this._emptyDEMTexture=new d.Texture(o,y,c.RGBA,{premultiply:!1}),x}setupElevationDraw(o,c,g){const y=this.painter.context,x=y.gl,E=(T=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:d.DEMData.getUnpackVector(T),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var T;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();const P=this.painter.transform,F=P.projection.createTileTransform(P,P.worldSize),R=o.tileID.canonical;E.u_tile_tl_up=F.upVector(R,0,0),E.u_tile_tr_up=F.upVector(R,d.EXTENT,0),E.u_tile_br_up=F.upVector(R,d.EXTENT,d.EXTENT),E.u_tile_bl_up=F.upVector(R,0,d.EXTENT),E.u_tile_up_scale=F.upVectorScale(R);let z=null,j=null,Z=1;if(g&&g.morphing&&this._useVertexMorphing){const H=g.morphing.srcDemTile,W=g.morphing.dstDemTile;Z=g.morphing.phase,H&&W&&(this._prepareDemTileUniforms(o,H,E,"_prev")&&(j=H),this._prepareDemTileUniforms(o,W,E)&&(z=W))}if(j&&z?(y.activeTexture.set(x.TEXTURE2),z.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),y.activeTexture.set(x.TEXTURE4),j.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),E.u_dem_lerp=Z):(z=this.terrainTileForTile[o.tileID.key],y.activeTexture.set(x.TEXTURE2),(this._prepareDemTileUniforms(o,z,E)?z.demTexture:this.emptyDEMTexture).bind(x.NEAREST,x.CLAMP_TO_EDGE)),y.activeTexture.set(x.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&z){const H=(1<<z.tileID.canonical.z)*d.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=H}g&&g.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),c.setTerrainUniformValues(y,E)}renderToBackBuffer(o){const c=this.painter,g=this.painter.context;0!==o.length&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,c.width,c.height]),this.renderingToTexture=!1,function(y,x,E,T,P){if("globe"===y.transform.projection.name)!function(F,R,z,j,Z){const H=F.context,W=H.gl;let oe,$;const ne=F.options.showTerrainWireframe?2:0,ee=(ke,be)=>{if($===ke)return;const ve=[];be&&ve.push(Ys[ne]),ve.push(Ys[ke]),ve.push("PROJECTION_GLOBE_VIEW"),oe=F.useProgram("globeRaster",null,ve),$=ke},te=F.colorModeForRenderPass(),re=new d.DepthMode(W.LEQUAL,d.DepthMode.ReadWrite,F.depthRangeFor3D);Do.update(Z);const se=F.transform,ge=d.calculateGlobeMatrix(se,se.worldSize),xe=d.calculateGlobeMercatorMatrix(se),Ue=[d.mercatorXfromLng(se.center.lng),d.mercatorYfromLat(se.center.lat)],Re=F.globeSharedBuffers;(ne?[!1,!0]:[!1]).forEach(ke=>{$=-1;const be=ke?W.LINES:W.TRIANGLES;for(const ve of j){const Fe=z.getTile(ve),Me=Math.pow(2,ve.canonical.z),[tt,lt]=d.globeBuffersForTileMesh(F,Fe,ve,Me),Mt=d.StencilMode.disabled,je=R.prevTerrainTileForTile[ve.key],st=R.terrainTileForTile[ve.key];Vi(je,st)&&Do.newMorphing(ve.key,je,st,Z,250),H.activeTexture.set(W.TEXTURE0),Fe.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const mt=Do.getMorphValuesForProxy(ve.key),ln=mt?1:0,_n={};mt&&d.extend$1(_n,{morphing:{srcDemTile:mt.from,dstDemTile:mt.to,phase:d.easeCubicInOut(mt.phase)}});const yt=d.globeMatrixForTile(ve.canonical,ge),Lt=Pi(se.projMatrix,yt,xe,d.globeToMercatorTransition(se.zoom),Ue);if(ee(ln,ke),R.setupElevationDraw(Fe,oe,_n),F.prepareDrawProgram(H,oe,ve.toUnwrapped()),Re){const[yn,Jn]=ke?Re.getWirefameBuffer(F.context):[Re.gridIndexBuffer,Re.gridSegments];oe.draw(H,be,re,Mt,te,d.CullFaceMode.backCCW,Lt,"globe_raster",tt,yn,Jn)}if(!ke){const yn=[0===ve.canonical.y?d.globePoleMatrixForTile(ve.canonical,!1,se):null,ve.canonical.y===Me-1?d.globePoleMatrixForTile(ve.canonical,!0,se):null];for(const Jn of yn){if(!Jn)continue;const Vr=Pi(se.projMatrix,Jn,Jn,0,Ue);Re&&oe.draw(H,be,re,Mt,te,d.CullFaceMode.disabled,Vr,"globe_pole_raster",lt,Re.poleIndexBuffer,Re.poleSegments)}}}})}(y,x,E,T,P);else{const F=y.context,R=F.gl;let z,j;const Z=y.options.showTerrainWireframe?2:0,H=(ee,te)=>{if(j===ee)return;const re=[Ys[ee]];te&&re.push(Ys[Z]),z=y.useProgram("terrainRaster",null,re),j=ee},W=y.colorModeForRenderPass(),oe=new d.DepthMode(R.LEQUAL,d.DepthMode.ReadWrite,y.depthRangeFor3D);Do.update(P);const $=y.transform,ne=6*Math.pow(1.5,22-$.zoom)*x.exaggeration();(Z?[!1,!0]:[!1]).forEach(ee=>{j=-1;const te=ee?R.LINES:R.TRIANGLES,[re,se]=ee?x.getWirefameBuffer():[x.gridIndexBuffer,x.gridSegments];for(const ge of T){const xe=E.getTile(ge),Ue=d.StencilMode.disabled,Re=x.prevTerrainTileForTile[ge.key],ke=x.terrainTileForTile[ge.key];Vi(Re,ke)&&Do.newMorphing(ge.key,Re,ke,P,250),F.activeTexture.set(R.TEXTURE0),xe.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST);const be=Do.getMorphValuesForProxy(ge.key),ve=be?1:0;let Fe;be&&(Fe={morphing:{srcDemTile:be.from,dstDemTile:be.to,phase:d.easeCubicInOut(be.phase)}});const Me=kr(ge.projMatrix,em(ge.canonical,$.renderWorldCopies)?ne/10:ne);H(ve,ee),x.setupElevationDraw(xe,z,Fe),y.prepareDrawProgram(F,z,ge.toUnwrapped()),z.draw(F,te,oe,Ue,W,d.CullFaceMode.backCCW,Me,"terrain_raster",x.gridBuffer,re,se)}})}}(c,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,o.splice(0,o.length))}renderBatch(o){if(0===this._drapedRenderBatches.length)return o+1;this.renderingToTexture=!0;const c=this.painter,g=this.painter.context,y=this.proxySourceCache,x=this.proxiedCoords[y.id],E=this._drapedRenderBatches.shift(),T=[],P=c.style.order;let F=0;for(const R of x){const z=y.getTileByID(R.proxyTileKey),j=y.proxyCachedFBO[R.key]?y.proxyCachedFBO[R.key][o]:void 0,Z=void 0!==j?y.renderCache[j]:this.pool[F++],H=void 0!==j;if(z.texture=Z.tex,H&&!Z.dirty){T.push(z.tileID);continue}let W;g.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(g.clear({color:d.Color.transparent,stencil:0}),Z.dirty=!1);for(let oe=E.start;oe<=E.end;++oe){const $=c.style._layers[P[oe]];if($.isHidden(c.transform.zoom))continue;const ne=c.style._getLayerSourceCache($),ee=ne?this.proxyToSource[R.key][ne.id]:[R];if(!ee)continue;const te=ee;g.viewport.set([0,0,Z.fb.width,Z.fb.height]),W!==(ne?ne.id:null)&&(this._setupStencil(Z,ee,$,ne),W=ne?ne.id:null),c.renderLayer(c,ne,$,te)}this.renderedToTile?(Z.dirty=!0,T.push(z.tileID)):H||--F,5===F&&(F=0,this.renderToBackBuffer(T))}return this.renderToBackBuffer(T),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,c.width,c.height]),E.end+1}postRender(){}renderCacheEfficiency(o){const c=o.order.length;if(0===c)return{efficiency:100};let g,y=0,x=0,E=!1;for(let T=0;T<c;++T){const P=o._layers[o.order[T]];this._style.isLayerDraped(P)?(E&&++y,++x):E||(E=!0,g=P.id)}return 0===x?{efficiency:100}:{efficiency:100*(1-y/x),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{o=Math.min(o,c.dem.tree.minimums[0])}),0===o?o:(o-30)*this._exaggeration}raycast(o,c,g){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const E=x.tileID,T=Math.pow(2,E.overscaledZ),{x:P,y:F}=E.canonical,R=P/T,z=(P+1)/T,j=F/T,Z=(F+1)/T;return{minx:R,miny:j,maxx:z,maxy:Z,t:x.dem.tree.raycastRoot(R,j,z,Z,o,c,g),tile:x}});y.sort((x,E)=>(null!==x.t?x.t:Number.MAX_VALUE)-(null!==E.t?E.t:Number.MAX_VALUE));for(const x of y){if(null==x.t)return null;const E=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,o,c,g);if(null!=E)return E}return null}_createFBO(){const o=this.painter.context,c=o.gl,g=this.drapeBufferSize;o.activeTexture.set(c.TEXTURE0);const y=new d.Texture(o,{width:g[0],height:g[1],data:null},c.RGBA);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);const x=o.createFramebuffer(g[0],g[1],!1);return x.colorAttachment.set(y.texture),x.depthAttachment=new Il(o,x.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:x,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const c=this._style._layers[o],g=c.isHidden(this.painter.transform.zoom),y=c.getCrossfadeParameters(),x=!!y&&1!==y.t,E=c.hasTransition();return"custom"!==c.type&&!g&&(x||E)})}_clearRasterFadeFromRenderCache(){let o=!1;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c]._source instanceof bo){o=!0;break}if(o)for(let c=0;c<this._style.order.length;++c){const g=this._style._layers[this._style.order[c]],y=g.isHidden(this.painter.transform.zoom),x=this._style._getLayerSourceCache(g);if("raster"!==g.type||y||!x)continue;const E=g.paint.get("raster-fade-duration");for(const T of this.proxyCoords){const P=this.proxyToSource[T.key][x.id];if(P)for(const F of P){const R=cp(x.getTile(F),x.findLoadedParent(F,0),x,this.painter.transform,E);(1!==R.opacity||0!==R.mix)&&this._clearRenderCacheForTile(x.id,F)}}}}_setupDrapedRenderBatches(){const o=this._style.order,c=o.length;if(0===c)return;const g=[];let y,x=0,E=this._style._layers[o[x]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++x<c;)E=this._style._layers[o[x]];for(;x<c;++x){const T=this._style._layers[o[x]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?void 0===y&&(y=x):void 0!==y&&(g.push({start:y,end:x-1}),y=void 0))}void 0!==y&&g.push({start:y,end:x-1}),this._drapedRenderBatches=g}_setupRenderCache(o){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const E=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let T=0;T<E.length;++T){const P=Object.values(E[T]);c.renderCachePool.push(...P)}}return}this._clearRasterFadeFromRenderCache();const g=this.proxyCoords,y=this._tilesDirty;for(let E=g.length-1;E>=0;E--){const T=g[E];if(c.getTileByID(T.key),void 0!==c.proxyCachedFBO[T.key]){const P=o[T.key],F=this.proxyToSource[T.key];let R=0;for(const z in F){const j=F[z],Z=P[z];if(!Z||Z.length!==j.length||j.some((H,W)=>H!==Z[W]||y[z]&&y[z].hasOwnProperty(H.key))){R=-1;break}++R}for(const z in c.proxyCachedFBO[T.key])c.renderCache[c.proxyCachedFBO[T.key][z]].dirty=R<0||R!==Object.values(P).length}}const x=[...this._drapedRenderBatches];x.sort((E,T)=>T.end-T.start-(E.end-E.start));for(const E of x)for(const T of g){if(c.proxyCachedFBO[T.key])continue;let P=c.renderCachePool.pop();void 0===P&&c.renderCache.length<50&&(P=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==P&&(c.proxyCachedFBO[T.key]={},c.proxyCachedFBO[T.key][E.start]=P,c.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(o,c,g,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,E=x.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let T;if(g.isTileClipped())T=c.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):d.StencilMode.disabled}_renderTileClippingMasks(o,c){const g=this.painter,y=this.painter.context,x=y.gl;g._tileClippingMaskIDs={},y.setColorMode(d.ColorMode.disabled),y.setDepthMode(d.DepthMode.disabled);const E=g.useProgram("clippingMask");for(const T of o){const P=g._tileClippingMaskIDs[T.key]=--c;E.draw(y,x.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:x.ALWAYS,mask:0},P,255,x.KEEP,x.KEEP,x.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,qt(T.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(o){const c=this.painter.transform;if(o.x<0||o.x>c.width||o.y<0||o.y>c.height)return null;const g=[o.x,o.y,1,1];d.transformMat4$1(g,g,c.pixelMatrixInverse),d.scale$1(g,g,1/g[3]),g[0]/=c.worldSize,g[1]/=c.worldSize;const y=c._camera.position,x=d.mercatorZfromAltitude(1,c.center.lat),E=[y[0],y[1],y[2]/x,0],T=d.subtract([],g.slice(0,3),E);d.normalize(T,T);const P=this.raycast(E,T,this._exaggeration);return null!==P&&P?(d.scaleAndAdd(E,E,T,P),E[3]=E[2],E[2]*=x,E):null}drawDepth(){const o=this.painter,c=o.context,g=this.proxySourceCache,y=Math.ceil(o.width),x=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===x||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const E=c.gl,T=c.createFramebuffer(y,x,!0);c.activeTexture.set(E.TEXTURE0);const P=new d.Texture(c,{width:y,height:x,data:null},E.RGBA);P.bind(E.NEAREST,E.CLAMP_TO_EDGE),T.colorAttachment.set(P.texture);const F=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,y,x);T.depthAttachment.set(F),this._depthFBO=T,this._depthTexture=P}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,y,x]),function(E,T,P,F){if("globe"===E.transform.projection.name)return;const R=E.context,z=R.gl;R.clear({depth:1});const j=E.useProgram("terrainDepth"),Z=new d.DepthMode(z.LESS,d.DepthMode.ReadWrite,E.depthRangeFor3D);for(const H of F){const W=P.getTile(H),oe=kr(H.projMatrix,0);T.setupElevationDraw(W,j),j.draw(R,z.TRIANGLES,Z,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.backCCW,oe,"terrain_depth",T.gridBuffer,T.gridIndexBuffer,T.gridNoSkirtSegments)}}(o,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,c,g){if(o.getSource()instanceof wo)return this._setupProxiedCoordsForImageSource(o,c,g);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const y=this.proxiedCoords[o.id]=[],x=this.proxyCoords;for(let T=0;T<x.length;T++){const P=x[T],F=this._findTileCoveringTileID(P,o);if(F){const R=this._createProxiedId(P,F,g[P.key]&&g[P.key][o.id]);y.push(R),this.proxyToSource[P.key][o.id]=[R]}}let E=!1;for(let T=0;T<c.length;T++){const P=o.getTile(c[T]);if(!P||!P.hasData())continue;const F=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==P.tileID.canonical.z){const R=this.proxyToSource[F.tileID.key][o.id],z=this._createProxiedId(F.tileID,P,g[F.tileID.key]&&g[F.tileID.key][o.id]);R?R.splice(R.length-1,0,z):this.proxyToSource[F.tileID.key][o.id]=[z],y.push(z),E=!0}}this._sourceTilesOverlap[o.id]=E}_setupProxiedCoordsForImageSource(o,c,g){if(!o.getSource().loaded())return;const y=this.proxiedCoords[o.id]=[],x=this.proxyCoords,E=o.getSource(),T=new d.pointGeometry(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),P=E.coordinates.map(d.MercatorCoordinate.fromLngLat).reduce((R,z)=>(R.min.x=Math.min(R.min.x,z.x-T.x),R.min.y=Math.min(R.min.y,z.y-T.y),R.max.x=Math.max(R.max.x,z.x-T.x),R.max.y=Math.max(R.max.y,z.y-T.y),R),{min:new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new d.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(R,z)=>{const j=R.wrap+R.canonical.x/(1<<R.canonical.z),Z=R.canonical.y/(1<<R.canonical.z),H=d.EXTENT/(1<<R.canonical.z),W=z.wrap+z.canonical.x/(1<<z.canonical.z),oe=z.canonical.y/(1<<z.canonical.z);return j+H<W+P.min.x||j>W+P.max.x||Z+H<oe+P.min.y||Z>oe+P.max.y};for(let R=0;R<x.length;R++){const z=x[R];for(let j=0;j<c.length;j++){const Z=o.getTile(c[j]);if(!Z||!Z.hasData()||F(z,Z.tileID))continue;const H=this._createProxiedId(z,Z,g[z.key]&&g[z.key][o.id]),W=this.proxyToSource[z.key][o.id];W?W.push(H):this.proxyToSource[z.key][o.id]=[H],y.push(H)}}}_createProxiedId(o,c,g){let y=this.orthoMatrix;if(g){const x=g.find(E=>E.key===c.tileID.key);if(x)return x}if(c.tileID.key!==o.key){const x=o.canonical.z-c.tileID.canonical.z;let E,T,P;y=d.create();const F=c.tileID.wrap-o.wrap<<o.overscaledZ;x>0?(E=d.EXTENT>>x,T=E*((c.tileID.canonical.x<<x)-o.canonical.x+F),P=E*((c.tileID.canonical.y<<x)-o.canonical.y)):(E=d.EXTENT<<-x,T=d.EXTENT*(c.tileID.canonical.x-(o.canonical.x+F<<-x)),P=d.EXTENT*(c.tileID.canonical.y-(o.canonical.y<<-x))),d.ortho(y,0,E,0,E,0,1),d.translate(y,y,[T,P,0])}return new hn(c.tileID,o.key,y)}_findTileCoveringTileID(o,c){let g=c.getTile(o);if(g&&g.hasData())return g;const y=this._findCoveringTileCache[c.id],x=y[o.key];if(g=x?c.getTileByID(x):null,g&&g.hasData()||null===x)return g;let E=g?g.tileID:o,T=E.overscaledZ;const P=c.getSource().minzoom,F=[];if(!x){const z=c.getSource().maxzoom;if(o.canonical.z>=z){const j=o.canonical.z-z;c.getSource().reparseOverscaled?(T=Math.max(o.canonical.z+2,c.transform.tileZoom),E=new d.OverscaledTileID(T,o.wrap,z,o.canonical.x>>j,o.canonical.y>>j)):0!==j&&(T=z,E=new d.OverscaledTileID(T,o.wrap,z,o.canonical.x>>j,o.canonical.y>>j))}E.key!==o.key&&(F.push(E.key),g=c.getTile(E))}const R=z=>{F.forEach(j=>{y[j]=z}),F.length=0};for(T-=1;T>=P&&(!g||!g.hasData());T--){g&&R(g.tileID.key);const z=E.calculateScaledKey(T);if(g=c.getTileByID(z),g&&g.hasData())break;const j=y[z];if(null===j)break;void 0===j?F.push(z):g=c.getTileByID(j)}return R(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(o){this.renderedToTile=!0}_clearRenderCacheForTile(o,c){let g=this._tilesDirty[o];g||(g=this._tilesDirty[o]={}),g[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(c){let g,y,x;const E=new d.StructArrayLayout2ui4,T=131;for(y=1;y<129;y++){for(g=1;g<129;g++)x=y*T+g,E.emplaceBack(x,x+1),E.emplaceBack(x,x+T),E.emplaceBack(x+1,x+T),128===y&&E.emplaceBack(x+T,x+T+1);E.emplaceBack(x+1,x+1+T)}return E}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=d.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Ga(f){const o=[];for(let c=0;c<f.length;c++){if(null===f[c])continue;const g=f[c].split(" ");o.push(g.pop())}return o}class Qs{static cacheKey(o,c,g){let y=`${o}${g?g.cacheKey:""}`;for(const x of c)y+=`/${x}`;return y}constructor(o,c,g,y,x,E){const T=o.gl;this.program=T.createProgram();const P=Ga(g.staticAttributes),F=y?y.getBinderAttributes():[],R=P.concat(F),z=g.staticUniforms?Ga(g.staticUniforms):[],j=y?y.getBinderUniforms():[],Z=z.concat(j),H=[];for(const re of Z)H.indexOf(re)<0&&H.push(re);let W=y?y.defines():[];W=W.concat(E.map(re=>`#define ${re}`));const oe=W.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Et,Wt.fragmentSource,Ks.fragmentSource,g.fragmentSource).join("\n"),$=W.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Et,Wt.vertexSource,Ks.vertexSource,Es.vertexSource,g.vertexSource).join("\n"),ne=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(ne,oe),T.compileShader(ne),T.attachShader(this.program,ne);const ee=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(ee,$),T.compileShader(ee),T.attachShader(this.program,ee),this.attributes={};const te={};this.numAttributes=R.length;for(let re=0;re<this.numAttributes;re++)R[re]&&(T.bindAttribLocation(this.program,re,R[re]),this.attributes[R[re]]=re);T.linkProgram(this.program),T.deleteShader(ee),T.deleteShader(ne);for(let re=0;re<H.length;re++){const se=H[re];if(se&&!te[se]){const ge=T.getUniformLocation(this.program,se);ge&&(te[se]=ge)}}var re,se;this.fixedUniforms=x(o,te),this.binderUniforms=y?y.getUniforms(o,te):[],-1!==E.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new d.Uniform1i(re=o,(se=te).u_dem),u_dem_prev:new d.Uniform1i(re,se.u_dem_prev),u_dem_unpack:new d.Uniform4f(re,se.u_dem_unpack),u_dem_tl:new d.Uniform2f(re,se.u_dem_tl),u_dem_scale:new d.Uniform1f(re,se.u_dem_scale),u_dem_tl_prev:new d.Uniform2f(re,se.u_dem_tl_prev),u_dem_scale_prev:new d.Uniform1f(re,se.u_dem_scale_prev),u_dem_size:new d.Uniform1f(re,se.u_dem_size),u_dem_lerp:new d.Uniform1f(re,se.u_dem_lerp),u_exaggeration:new d.Uniform1f(re,se.u_exaggeration),u_depth:new d.Uniform1i(re,se.u_depth),u_depth_size_inv:new d.Uniform2f(re,se.u_depth_size_inv),u_meter_to_dem:new d.Uniform1f(re,se.u_meter_to_dem),u_label_plane_matrix_inv:new d.UniformMatrix4f(re,se.u_label_plane_matrix_inv),u_tile_tl_up:new d.Uniform3f(re,se.u_tile_tl_up),u_tile_tr_up:new d.Uniform3f(re,se.u_tile_tr_up),u_tile_br_up:new d.Uniform3f(re,se.u_tile_br_up),u_tile_bl_up:new d.Uniform3f(re,se.u_tile_bl_up),u_tile_up_scale:new d.Uniform1f(re,se.u_tile_up_scale)}),-1!==E.indexOf("FOG")&&(this.fogUniforms=((re,se)=>({u_fog_matrix:new d.UniformMatrix4f(re,se.u_fog_matrix),u_fog_range:new d.Uniform2f(re,se.u_fog_range),u_fog_color:new d.Uniform4f(re,se.u_fog_color),u_fog_horizon_blend:new d.Uniform1f(re,se.u_fog_horizon_blend),u_fog_temporal_offset:new d.Uniform1f(re,se.u_fog_temporal_offset)}))(o,te))}setTerrainUniformValues(o,c){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const y in c)g[y].set(c[y])}}setFogUniformValues(o,c){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const y in c)g[y].location&&g[y].set(c[y])}}draw(o,c,g,y,x,E,T,P,F,R,z,j,Z,H,W,oe){const $=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(g),o.setStencilMode(y),o.setColorMode(x),o.setCullFace(E);for(const ee of Object.keys(this.fixedUniforms))this.fixedUniforms[ee].set(T[ee]);H&&H.setUniforms(o,this.binderUniforms,j,{zoom:Z});const ne={[$.LINES]:2,[$.TRIANGLES]:3,[$.LINE_STRIP]:1}[c];for(const ee of z.get()){const te=ee.vaos||(ee.vaos={});(te[P]||(te[P]=new pr)).bind(o,this,F,H?H.getPaintVertexBuffers():[],R,ee.vertexOffset,W,oe),$.drawElements(c,ee.primitiveLength*ne,$.UNSIGNED_SHORT,ee.primitiveOffset*ne*2)}}}function Eu(f,o,c){const g=1/xn(c,1,o.transform.tileZoom),y=Math.pow(2,c.tileID.overscaledZ),x=c.tileSize*Math.pow(2,o.transform.tileZoom)/y,E=x*(c.tileID.canonical.x+c.tileID.wrap*y),T=x*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[g,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[E>>16,T>>16],u_pixel_coord_lower:[65535&E,65535&T]}}const To=(f,o,c,g)=>{const y=o.style.light,x=y.properties.get("position"),E=[x.x,x.y,x.z],T=d.create$1();"viewport"===y.properties.get("anchor")&&(d.fromRotation(T,-o.transform.angle),d.transformMat3(E,E,T));const P=y.properties.get("color");return{u_matrix:f,u_lightpos:E,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+c,u_opacity:g}},ea=(f,o,c,g,y,x,E)=>d.extend(To(f,o,c,g),Eu(x,o,E),{u_height_factor:-Math.pow(2,y.overscaledZ)/E.tileSize/8}),Oh=f=>({u_matrix:f}),$a=(f,o,c,g)=>d.extend(Oh(f),Eu(c,o,g)),hp=(f,o)=>({u_matrix:f,u_world:o}),Cu=(f,o,c,g,y)=>d.extend($a(f,o,c,g),{u_world:y}),zh=(f,o,c,g)=>{const y=f.transform;let x;return x="map"===g.paint.get("circle-pitch-alignment")?y.calculatePixelsToTileUnitsMatrix(c):new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]),{u_camera_to_center_distance:y.cameraToCenterDistance,u_matrix:f.translatePosMatrix(o.projMatrix,c,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:d.exported.devicePixelRatio,u_extrude_scale:x}},Tc=f=>{const o=[];return"map"===f.paint.get("circle-pitch-alignment")&&o.push("PITCH_WITH_MAP"),"map"===f.paint.get("circle-pitch-scale")&&o.push("SCALE_WITH_MAP"),o},so=(f,o,c)=>{const g=d.EXTENT/c.tileSize;return{u_matrix:f,u_camera_to_center_distance:o.cameraToCenterDistance,u_extrude_scale:[o.pixelsToGLUnits[0]/g,o.pixelsToGLUnits[1]/g]}},Du=(f,o,c=1)=>({u_matrix:f,u_color:o,u_overlay:0,u_overlay_scale:c}),Tu=(f,o,c,g)=>({u_matrix:f,u_extrude_scale:xn(o,1,c),u_intensity:g}),Dt=(f,o,c,g,y,x)=>{const E=f.transform,T=E.calculatePixelsToTileUnitsMatrix(o),P={u_matrix:ji(f,o,c,y),u_pixels_to_tile_units:T,u_device_pixel_ratio:d.exported.devicePixelRatio,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(ao(c)){const F=Xn(o,f.transform);P.u_texsize=o.lineAtlasTexture.size,P.u_scale=[F,g.fromScale,g.toScale],P.u_mix=g.t}return P},rr=(f,o,c,g,y)=>{const x=f.transform,E=Xn(o,x);return{u_matrix:ji(f,o,c,y),u_texsize:o.imageAtlasTexture.size,u_pixels_to_tile_units:x.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:d.exported.devicePixelRatio,u_image:0,u_scale:[E,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Xn(f,o){return 1/xn(f,1,o.tileZoom)}function ji(f,o,c,g){return f.translatePosMatrix(g||o.tileID.projMatrix,o,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function ao(f){const o=f.paint.get("line-dasharray").value;return o.value||"constant"!==o.kind}const Jr=(f,o,c,g,y,x)=>{return{u_matrix:f,u_tl_parent:o,u_scale_parent:c,u_fade_t:g.mix,u_opacity:g.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(T=y.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(E=y.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:ta(y.paint.get("raster-hue-rotate")),u_perspective_transform:x};var E,T};function ta(f){f*=Math.PI/180;const o=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*o-c+1)/3,(Math.sqrt(3)*o-c+1)/3]}const Ha=(f,o,c,g,y,x,E,T,P,F,R,z,j,Z)=>{const H=y.transform;return{u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:H.width/H.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:E,u_coord_matrix:T,u_is_text:+P,u_pitch_with_map:+g,u_texsize:F,u_tile_id:R,u_zoom_transition:z,u_inv_rot_matrix:j,u_merc_center:Z,u_texture:0}},Xo=(f,o,c,g,y,x,E,T,P,F,R,z,j,Z,H)=>{const{cameraToCenterDistance:W,_pitch:oe}=y.transform;return d.extend(Ha(f,o,c,g,y,x,E,T,P,F,z,j,Z,H),{u_gamma_scale:g?W*Math.cos(y.terrain?0:oe):1,u_device_pixel_ratio:d.exported.devicePixelRatio,u_is_halo:+R})},Cs=(f,o,c,g,y,x,E,T,P,F,R,z,j,Z)=>d.extend(Xo(f,o,c,g,y,x,E,T,!0,P,!0,R,z,j,Z),{u_texsize_icon:F,u_texture_icon:1}),zt=(f,o,c)=>({u_matrix:f,u_opacity:o,u_color:c}),fr=(f,o,c,g,y,x)=>d.extend(function(E,T,P,F){const R=P.imageManager.getPattern(E.from.toString()),z=P.imageManager.getPattern(E.to.toString()),{width:j,height:Z}=P.imageManager.getPixelSize(),H=Math.pow(2,F.tileID.overscaledZ),W=F.tileSize*Math.pow(2,P.transform.tileZoom)/H,oe=W*(F.tileID.canonical.x+F.tileID.wrap*H),$=W*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[j,Z],u_mix:T.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/xn(F,1,P.transform.tileZoom),u_pixel_coord_upper:[oe>>16,$>>16],u_pixel_coord_lower:[65535&oe,65535&$]}}(g,x,c,y),{u_matrix:f,u_opacity:o}),Bh={fillExtrusion:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_lightpos:new d.Uniform3f(f,o.u_lightpos),u_lightintensity:new d.Uniform1f(f,o.u_lightintensity),u_lightcolor:new d.Uniform3f(f,o.u_lightcolor),u_vertical_gradient:new d.Uniform1f(f,o.u_vertical_gradient),u_opacity:new d.Uniform1f(f,o.u_opacity)}),fillExtrusionPattern:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_lightpos:new d.Uniform3f(f,o.u_lightpos),u_lightintensity:new d.Uniform1f(f,o.u_lightintensity),u_lightcolor:new d.Uniform3f(f,o.u_lightcolor),u_vertical_gradient:new d.Uniform1f(f,o.u_vertical_gradient),u_height_factor:new d.Uniform1f(f,o.u_height_factor),u_image:new d.Uniform1i(f,o.u_image),u_texsize:new d.Uniform2f(f,o.u_texsize),u_pixel_coord_upper:new d.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(f,o.u_pixel_coord_lower),u_scale:new d.Uniform3f(f,o.u_scale),u_fade:new d.Uniform1f(f,o.u_fade),u_opacity:new d.Uniform1f(f,o.u_opacity)}),fill:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix)}),fillPattern:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_image:new d.Uniform1i(f,o.u_image),u_texsize:new d.Uniform2f(f,o.u_texsize),u_pixel_coord_upper:new d.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(f,o.u_pixel_coord_lower),u_scale:new d.Uniform3f(f,o.u_scale),u_fade:new d.Uniform1f(f,o.u_fade)}),fillOutline:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_world:new d.Uniform2f(f,o.u_world)}),fillOutlinePattern:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_world:new d.Uniform2f(f,o.u_world),u_image:new d.Uniform1i(f,o.u_image),u_texsize:new d.Uniform2f(f,o.u_texsize),u_pixel_coord_upper:new d.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(f,o.u_pixel_coord_lower),u_scale:new d.Uniform3f(f,o.u_scale),u_fade:new d.Uniform1f(f,o.u_fade)}),circle:(f,o)=>({u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_extrude_scale:new d.UniformMatrix2f(f,o.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(f,o.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(f,o.u_matrix)}),collisionBox:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_extrude_scale:new d.Uniform2f(f,o.u_extrude_scale)}),collisionCircle:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_inv_matrix:new d.UniformMatrix4f(f,o.u_inv_matrix),u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_viewport_size:new d.Uniform2f(f,o.u_viewport_size)}),debug:(f,o)=>({u_color:new d.UniformColor(f,o.u_color),u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_overlay:new d.Uniform1i(f,o.u_overlay),u_overlay_scale:new d.Uniform1f(f,o.u_overlay_scale)}),clippingMask:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix)}),heatmap:(f,o)=>({u_extrude_scale:new d.Uniform1f(f,o.u_extrude_scale),u_intensity:new d.Uniform1f(f,o.u_intensity),u_matrix:new d.UniformMatrix4f(f,o.u_matrix)}),heatmapTexture:(f,o)=>({u_image:new d.Uniform1i(f,o.u_image),u_color_ramp:new d.Uniform1i(f,o.u_color_ramp),u_opacity:new d.Uniform1f(f,o.u_opacity)}),hillshade:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_image:new d.Uniform1i(f,o.u_image),u_latrange:new d.Uniform2f(f,o.u_latrange),u_light:new d.Uniform2f(f,o.u_light),u_shadow:new d.UniformColor(f,o.u_shadow),u_highlight:new d.UniformColor(f,o.u_highlight),u_accent:new d.UniformColor(f,o.u_accent)}),hillshadePrepare:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_image:new d.Uniform1i(f,o.u_image),u_dimension:new d.Uniform2f(f,o.u_dimension),u_zoom:new d.Uniform1f(f,o.u_zoom),u_unpack:new d.Uniform4f(f,o.u_unpack)}),line:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_pixels_to_tile_units:new d.UniformMatrix2f(f,o.u_pixels_to_tile_units),u_device_pixel_ratio:new d.Uniform1f(f,o.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(f,o.u_units_to_pixels),u_dash_image:new d.Uniform1i(f,o.u_dash_image),u_gradient_image:new d.Uniform1i(f,o.u_gradient_image),u_image_height:new d.Uniform1f(f,o.u_image_height),u_texsize:new d.Uniform2f(f,o.u_texsize),u_scale:new d.Uniform3f(f,o.u_scale),u_mix:new d.Uniform1f(f,o.u_mix),u_alpha_discard_threshold:new d.Uniform1f(f,o.u_alpha_discard_threshold)}),linePattern:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_texsize:new d.Uniform2f(f,o.u_texsize),u_pixels_to_tile_units:new d.UniformMatrix2f(f,o.u_pixels_to_tile_units),u_device_pixel_ratio:new d.Uniform1f(f,o.u_device_pixel_ratio),u_image:new d.Uniform1i(f,o.u_image),u_units_to_pixels:new d.Uniform2f(f,o.u_units_to_pixels),u_scale:new d.Uniform3f(f,o.u_scale),u_fade:new d.Uniform1f(f,o.u_fade),u_alpha_discard_threshold:new d.Uniform1f(f,o.u_alpha_discard_threshold)}),raster:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_tl_parent:new d.Uniform2f(f,o.u_tl_parent),u_scale_parent:new d.Uniform1f(f,o.u_scale_parent),u_fade_t:new d.Uniform1f(f,o.u_fade_t),u_opacity:new d.Uniform1f(f,o.u_opacity),u_image0:new d.Uniform1i(f,o.u_image0),u_image1:new d.Uniform1i(f,o.u_image1),u_brightness_low:new d.Uniform1f(f,o.u_brightness_low),u_brightness_high:new d.Uniform1f(f,o.u_brightness_high),u_saturation_factor:new d.Uniform1f(f,o.u_saturation_factor),u_contrast_factor:new d.Uniform1f(f,o.u_contrast_factor),u_spin_weights:new d.Uniform3f(f,o.u_spin_weights),u_perspective_transform:new d.Uniform2f(f,o.u_perspective_transform)}),symbolIcon:(f,o)=>({u_is_size_zoom_constant:new d.Uniform1i(f,o.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(f,o.u_is_size_feature_constant),u_size_t:new d.Uniform1f(f,o.u_size_t),u_size:new d.Uniform1f(f,o.u_size),u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_pitch:new d.Uniform1f(f,o.u_pitch),u_rotate_symbol:new d.Uniform1i(f,o.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(f,o.u_aspect_ratio),u_fade_change:new d.Uniform1f(f,o.u_fade_change),u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(f,o.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(f,o.u_coord_matrix),u_is_text:new d.Uniform1i(f,o.u_is_text),u_pitch_with_map:new d.Uniform1i(f,o.u_pitch_with_map),u_texsize:new d.Uniform2f(f,o.u_texsize),u_tile_id:new d.Uniform3f(f,o.u_tile_id),u_zoom_transition:new d.Uniform1f(f,o.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(f,o.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(f,o.u_merc_center),u_texture:new d.Uniform1i(f,o.u_texture)}),symbolSDF:(f,o)=>({u_is_size_zoom_constant:new d.Uniform1i(f,o.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(f,o.u_is_size_feature_constant),u_size_t:new d.Uniform1f(f,o.u_size_t),u_size:new d.Uniform1f(f,o.u_size),u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_pitch:new d.Uniform1f(f,o.u_pitch),u_rotate_symbol:new d.Uniform1i(f,o.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(f,o.u_aspect_ratio),u_fade_change:new d.Uniform1f(f,o.u_fade_change),u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(f,o.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(f,o.u_coord_matrix),u_is_text:new d.Uniform1i(f,o.u_is_text),u_pitch_with_map:new d.Uniform1i(f,o.u_pitch_with_map),u_texsize:new d.Uniform2f(f,o.u_texsize),u_texture:new d.Uniform1i(f,o.u_texture),u_gamma_scale:new d.Uniform1f(f,o.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(f,o.u_device_pixel_ratio),u_tile_id:new d.Uniform3f(f,o.u_tile_id),u_zoom_transition:new d.Uniform1f(f,o.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(f,o.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(f,o.u_merc_center),u_is_halo:new d.Uniform1i(f,o.u_is_halo)}),symbolTextAndIcon:(f,o)=>({u_is_size_zoom_constant:new d.Uniform1i(f,o.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(f,o.u_is_size_feature_constant),u_size_t:new d.Uniform1f(f,o.u_size_t),u_size:new d.Uniform1f(f,o.u_size),u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_pitch:new d.Uniform1f(f,o.u_pitch),u_rotate_symbol:new d.Uniform1i(f,o.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(f,o.u_aspect_ratio),u_fade_change:new d.Uniform1f(f,o.u_fade_change),u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(f,o.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(f,o.u_coord_matrix),u_is_text:new d.Uniform1i(f,o.u_is_text),u_pitch_with_map:new d.Uniform1i(f,o.u_pitch_with_map),u_texsize:new d.Uniform2f(f,o.u_texsize),u_texsize_icon:new d.Uniform2f(f,o.u_texsize_icon),u_texture:new d.Uniform1i(f,o.u_texture),u_texture_icon:new d.Uniform1i(f,o.u_texture_icon),u_gamma_scale:new d.Uniform1f(f,o.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(f,o.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(f,o.u_is_halo)}),background:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_opacity:new d.Uniform1f(f,o.u_opacity),u_color:new d.UniformColor(f,o.u_color)}),backgroundPattern:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_opacity:new d.Uniform1f(f,o.u_opacity),u_image:new d.Uniform1i(f,o.u_image),u_pattern_tl_a:new d.Uniform2f(f,o.u_pattern_tl_a),u_pattern_br_a:new d.Uniform2f(f,o.u_pattern_br_a),u_pattern_tl_b:new d.Uniform2f(f,o.u_pattern_tl_b),u_pattern_br_b:new d.Uniform2f(f,o.u_pattern_br_b),u_texsize:new d.Uniform2f(f,o.u_texsize),u_mix:new d.Uniform1f(f,o.u_mix),u_pattern_size_a:new d.Uniform2f(f,o.u_pattern_size_a),u_pattern_size_b:new d.Uniform2f(f,o.u_pattern_size_b),u_scale_a:new d.Uniform1f(f,o.u_scale_a),u_scale_b:new d.Uniform1f(f,o.u_scale_b),u_pixel_coord_upper:new d.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(f,o.u_pixel_coord_lower),u_tile_units_to_pixels:new d.Uniform1f(f,o.u_tile_units_to_pixels)}),terrainRaster:Js,terrainDepth:Js,skybox:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_sun_direction:new d.Uniform3f(f,o.u_sun_direction),u_cubemap:new d.Uniform1i(f,o.u_cubemap),u_opacity:new d.Uniform1f(f,o.u_opacity),u_temporal_offset:new d.Uniform1f(f,o.u_temporal_offset)}),skyboxGradient:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_color_ramp:new d.Uniform1i(f,o.u_color_ramp),u_center_direction:new d.Uniform3f(f,o.u_center_direction),u_radius:new d.Uniform1f(f,o.u_radius),u_opacity:new d.Uniform1f(f,o.u_opacity),u_temporal_offset:new d.Uniform1f(f,o.u_temporal_offset)}),skyboxCapture:(f,o)=>({u_matrix_3f:new d.UniformMatrix3f(f,o.u_matrix_3f),u_sun_direction:new d.Uniform3f(f,o.u_sun_direction),u_sun_intensity:new d.Uniform1f(f,o.u_sun_intensity),u_color_tint_r:new d.Uniform4f(f,o.u_color_tint_r),u_color_tint_m:new d.Uniform4f(f,o.u_color_tint_m),u_luminance:new d.Uniform1f(f,o.u_luminance)}),globeRaster:(f,o)=>({u_proj_matrix:new d.UniformMatrix4f(f,o.u_proj_matrix),u_globe_matrix:new d.UniformMatrix4f(f,o.u_globe_matrix),u_merc_matrix:new d.UniformMatrix4f(f,o.u_merc_matrix),u_zoom_transition:new d.Uniform1f(f,o.u_zoom_transition),u_merc_center:new d.Uniform2f(f,o.u_merc_center),u_image0:new d.Uniform1i(f,o.u_image0)}),globeAtmosphere:(f,o)=>({u_center:new d.Uniform2f(f,o.u_center),u_radius:new d.Uniform1f(f,o.u_radius),u_screen_size:new d.Uniform2f(f,o.u_screen_size),u_pixel_ratio:new d.Uniform1f(f,o.u_pixel_ratio),u_opacity:new d.Uniform1f(f,o.u_opacity),u_fadeout_range:new d.Uniform1f(f,o.u_fadeout_range),u_start_color:new d.Uniform3f(f,o.u_start_color),u_end_color:new d.Uniform3f(f,o.u_end_color)})};let Br;function et(f,o,c,g,y,x,E){const T=f.context,P=T.gl,F=f.useProgram("collisionBox"),R=[];let z=0,j=0;for(let ee=0;ee<g.length;ee++){const te=g[ee],re=o.getTile(te),se=re.getBucket(c);if(!se)continue;let ge=te.projMatrix;0===y[0]&&0===y[1]||(ge=f.translatePosMatrix(te.projMatrix,re,y,x));const xe=E?se.textCollisionBox:se.iconCollisionBox,Ue=se.collisionCircleArray;if(Ue.length>0){const Re=d.create(),ke=ge;d.mul(Re,se.placementInvProjMatrix,f.transform.glCoordMatrix),d.mul(Re,Re,se.placementViewportMatrix),R.push({circleArray:Ue,circleOffset:j,transform:ke,invTransform:Re}),z+=Ue.length/4,j=z}xe&&(f.terrain&&f.terrain.setupElevationDraw(re,F),F.draw(T,P.LINES,d.DepthMode.disabled,d.StencilMode.disabled,f.colorModeForRenderPass(),d.CullFaceMode.disabled,so(ge,f.transform,re),c.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,null,f.transform.zoom,null,xe.collisionVertexBuffer,xe.collisionVertexBufferExt))}if(!E||!R.length)return;const Z=f.useProgram("collisionCircle"),H=new d.StructArrayLayout2f1f2i16;H.resize(4*z),H._trim();let W=0;for(const ee of R)for(let te=0;te<ee.circleArray.length/4;te++){const re=4*te,se=ee.circleArray[re+0],ge=ee.circleArray[re+1],xe=ee.circleArray[re+2],Ue=ee.circleArray[re+3];H.emplace(W++,se,ge,xe,Ue,0),H.emplace(W++,se,ge,xe,Ue,1),H.emplace(W++,se,ge,xe,Ue,2),H.emplace(W++,se,ge,xe,Ue,3)}(!Br||Br.length<2*z)&&(Br=function(ee){const te=2*ee,re=new d.StructArrayLayout3ui6;re.resize(te),re._trim();for(let se=0;se<te;se++){const ge=6*se;re.uint16[ge+0]=4*se+0,re.uint16[ge+1]=4*se+1,re.uint16[ge+2]=4*se+2,re.uint16[ge+3]=4*se+2,re.uint16[ge+4]=4*se+3,re.uint16[ge+5]=4*se+0}return re}(z));const oe=T.createIndexBuffer(Br,!0),$=T.createVertexBuffer(H,d.collisionCircleLayout.members,!0);for(const ee of R){const te={u_matrix:ee.transform,u_inv_matrix:ee.invTransform,u_camera_to_center_distance:(ne=f.transform).cameraToCenterDistance,u_viewport_size:[ne.width,ne.height]};Z.draw(T,P.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,f.colorModeForRenderPass(),d.CullFaceMode.disabled,te,c.id,$,oe,d.SegmentVector.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,f.transform.zoom,null,null,null)}var ne;$.destroy(),oe.destroy()}const Ft=d.identity(new Float32Array(16));function kn(f,o,c,g,y,x){const{horizontalAlign:E,verticalAlign:T}=d.getAnchorAlignment(f),P=-(E-.5)*o,F=-(T-.5)*c,R=d.evaluateVariableOffset(f,g);return new d.pointGeometry((P/y+R[0])*x,(F/y+R[1])*x)}function ki(f,o,c,g,y,x,E,T,P,F,R,z){const j=f.text.placedSymbolArray,Z=f.text.dynamicLayoutVertexArray,H=f.icon.dynamicLayoutVertexArray,W={},oe=T.projMatrix,$=x.elevation,ne=$?$.getAtTileOffsetFunc(T,z):ee=>[0,0,0];Z.clear();for(let ee=0;ee<j.length;ee++){const te=j.get(ee),re=f.allowVerticalPlacement&&!te.placedOrientation,se=te.hidden||!te.crossTileID||re?null:g[te.crossTileID];if(se){const ge=new d.pointGeometry(te.tileAnchorX,te.tileAnchorY),xe=ne(ge),Ue=$n(ge,c?oe:E,xe[2]),Re=Eo(x.cameraToCenterDistance,Ue.signedDistanceFromCamera);let ke=y.evaluateSizeForFeature(f.textSizeData,F,te)*Re/d.ONE_EM;c&&(ke*=f.tilePixelRatio/P);const{width:be,height:ve,anchor:Fe,textOffset:Me,textScale:tt}=se,lt=kn(Fe,be,ve,Me,tt,ke),Mt=c?$n(ge.add(lt),E,xe[2]).point:Ue.point.add(o?lt.rotate(-x.angle):lt),je=f.allowVerticalPlacement&&te.placedOrientation===d.WritingMode.vertical?Math.PI/2:0;for(let st=0;st<te.numGlyphs;st++)d.addDynamicAttributes(Z,Mt,je);R&&te.associatedIconIndex>=0&&(W[te.associatedIconIndex]={shiftedAnchor:Mt,angle:je})}else gt(te.numGlyphs,Z)}if(R){H.clear();const ee=f.icon.placedSymbolArray;for(let te=0;te<ee.length;te++){const re=ee.get(te);if(re.hidden)gt(re.numGlyphs,H);else{const se=W[te];if(se)for(let ge=0;ge<re.numGlyphs;ge++)d.addDynamicAttributes(H,se.shiftedAnchor,se.angle);else gt(re.numGlyphs,H)}}f.icon.dynamicLayoutVertexBuffer.updateData(H)}f.text.dynamicLayoutVertexBuffer.updateData(Z)}function na(f,o,c){return c.iconsInText&&o?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Kn(f,o,c,g,y,x,E,T,P,F,R,z){const j=f.context,Z=j.gl,H=f.transform,W=H.projection.createTileTransform(H,H.worldSize),oe="map"===T,$="map"===P,ne=oe&&"point"!==c.layout.get("symbol-placement"),ee=oe&&!$&&!ne,te=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let re=!1;const se=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),ge=[d.mercatorXfromLng(H.center.lng),d.mercatorYfromLat(H.center.lat)],xe=c.layout.get("text-variable-anchor"),Ue="globe"===H.projection.name,Re=Ue?d.globeToMercatorTransition(H.zoom):0,ke=[],be=[];f.terrain&&$&&be.push("PITCH_WITH_MAP_TERRAIN"),Ue&&be.push("PROJECTION_GLOBE_VIEW"),ne&&be.push("PROJECTED_POS_ON_VIEWPORT");for(const ve of g){const Fe=o.getTile(ve),Me=Fe.getBucket(c);if(!Me||Me.projection!==H.projection.name)continue;const tt=y?Me.text:Me.icon;if(!tt||Me.fullyClipped||!tt.segments.get().length)continue;const lt=tt.programConfigurations.get(c.id),Mt=y||Me.sdfIcons,je=y?Me.textSizeData:Me.iconSizeData,st=$||0!==H.pitch,mt=f.useProgram(na(Mt,y,Me),lt,be),ln=d.evaluateSizeForZoom(je,H.zoom),_n=[ve.canonical.x,ve.canonical.y,1<<ve.canonical.z];let yt,Lt,yn,Jn,Vr=[0,0],ni=null;if(y){if(Lt=Fe.glyphAtlasTexture,yn=Z.LINEAR,yt=Fe.glyphAtlasTexture.size,Me.iconsInText){Vr=Fe.imageAtlasTexture.size,ni=Fe.imageAtlasTexture;const or="composite"===je.kind||"camera"===je.kind;Jn=st||f.options.rotating||f.options.zooming||or?Z.LINEAR:Z.NEAREST}}else{const or=1!==c.layout.get("icon-size").constantOr(0)||Me.iconsNeedLinear;Lt=Fe.imageAtlasTexture,yn=Mt||f.options.rotating||f.options.zooming||or||st?Z.LINEAR:Z.NEAREST,yt=Fe.imageAtlasTexture.size}const $i=f.transform.calculatePixelsToTileUnitsMatrix(Fe),Ut=vs(ve.projMatrix,Fe.tileID.canonical,$,oe,f.transform,$i),ft=f.terrain&&$&&ne?d.invert(new Float32Array(16),Ut):Ft,Bt=Ho(ve.projMatrix,Fe.tileID.canonical,$,oe,f.transform,$i),Dn=xe&&Me.hasTextData(),ri="none"!==c.layout.get("icon-text-fit")&&Dn&&Me.hasIconData();if(ne){const or=H.elevation,ts=or?or.getAtTileOffsetFunc(ve,W):co=>[0,0,0];Lh(Me,ve.projMatrix,f,y,Ut,Bt,$,F,ts,ve)}const pn=f.translatePosMatrix(ve.projMatrix,Fe,x,E),Hi=ne||y&&xe||ri?Ft:Ut,el=f.translatePosMatrix(Bt,Fe,x,E,!0),ii=Mt&&0!==c.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1);let fa;const nt=W.createInversionMatrix(ve.toUnwrapped());fa=Mt?Me.iconsInText?Cs(je.kind,ln,ee,$,f,pn,Hi,el,yt,Vr,_n,Re,nt,ge):Xo(je.kind,ln,ee,$,f,pn,Hi,el,y,yt,!0,_n,Re,nt,ge):Ha(je.kind,ln,ee,$,f,pn,Hi,el,y,yt,_n,Re,nt,ge);const at={program:mt,buffers:tt,uniformValues:fa,atlasTexture:Lt,atlasTextureIcon:ni,atlasInterpolation:yn,atlasInterpolationIcon:Jn,isSDF:Mt,hasHalo:ii,tile:Fe,labelPlaneMatrixInv:ft};if(te&&Me.canOverlap){re=!0;const or=tt.segments.get();for(const ts of or)ke.push({segments:new d.SegmentVector([ts]),sortKey:ts.sortKey,state:at})}else ke.push({segments:tt.segments,sortKey:0,state:at})}re&&ke.sort((ve,Fe)=>ve.sortKey-Fe.sortKey);for(const ve of ke){const Fe=ve.state;if(f.terrain&&f.terrain.setupElevationDraw(Fe.tile,Fe.program,{useDepthForOcclusion:!Ue,labelPlaneMatrixInv:Fe.labelPlaneMatrixInv}),j.activeTexture.set(Z.TEXTURE0),Fe.atlasTexture.bind(Fe.atlasInterpolation,Z.CLAMP_TO_EDGE),Fe.atlasTextureIcon&&(j.activeTexture.set(Z.TEXTURE1),Fe.atlasTextureIcon&&Fe.atlasTextureIcon.bind(Fe.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Fe.isSDF){const Me=Fe.uniformValues;Fe.hasHalo&&(Me.u_is_halo=1,Mo(Fe.buffers,ve.segments,c,f,Fe.program,se,R,z,Me)),Me.u_is_halo=0}Mo(Fe.buffers,ve.segments,c,f,Fe.program,se,R,z,Fe.uniformValues)}}function Mo(f,o,c,g,y,x,E,T,P){const F=g.context;y.draw(F,F.gl.TRIANGLES,x,E,T,d.CullFaceMode.disabled,P,c.id,f.layoutVertexBuffer,f.indexBuffer,o,c.paint,g.transform.zoom,f.programConfigurations.get(c.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function On(f,o,c,g,y,x,E){const T=f.context.gl,P=c.paint.get("fill-pattern"),F=P&&P.constantOr(1),R=c.getCrossfadeParameters();let z,j,Z,H,W;E?(j=F&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=T.LINES):(j=F?"fillPattern":"fill",z=T.TRIANGLES);for(const oe of g){const $=o.getTile(oe);if(F&&!$.patternsLoaded())continue;const ne=$.getBucket(c);if(!ne)continue;f.prepareDrawTile(oe);const ee=ne.programConfigurations.get(c.id),te=f.useProgram(j,ee);F&&(f.context.activeTexture.set(T.TEXTURE0),$.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),ee.updatePaintBuffers(R));const re=P.constantOr(null);if(re&&$.imageAtlas){const ge=$.imageAtlas,xe=ge.patternPositions[re.to.toString()],Ue=ge.patternPositions[re.from.toString()];xe&&Ue&&ee.setConstantPatternPositions(xe,Ue)}const se=f.translatePosMatrix(oe.projMatrix,$,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(E){H=ne.indexBuffer2,W=ne.segments2;const ge=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[T.drawingBufferWidth,T.drawingBufferHeight];Z="fillOutlinePattern"===j&&F?Cu(se,f,R,$,ge):hp(se,ge)}else H=ne.indexBuffer,W=ne.segments,Z=F?$a(se,f,R,$):Oh(se);f.prepareDrawProgram(f.context,te,oe.toUnwrapped()),te.draw(f.context,z,y,f.stencilModeForClipping(oe),x,d.CullFaceMode.disabled,Z,c.id,ne.layoutVertexBuffer,H,W,c.paint,f.transform.zoom,ee)}}function Ko(f,o,c,g,y,x,E){const T=f.context,P=T.gl,F=c.paint.get("fill-extrusion-pattern"),R=F.constantOr(1),z=c.getCrossfadeParameters(),j=c.paint.get("fill-extrusion-opacity");for(const Z of g){const H=o.getTile(Z),W=H.getBucket(c);if(!W)continue;const oe=W.programConfigurations.get(c.id),$=f.useProgram(R?"fillExtrusionPattern":"fillExtrusion",oe);if(f.terrain){const se=f.terrain;if(!W.enableTerrain)continue;if(se.setupElevationDraw(H,$,{useMeterToDem:!0}),ra(T,o,Z,W,c,se),!W.centroidVertexBuffer){const ge=$.attributes.a_centroid_pos;void 0!==ge&&P.vertexAttrib2f(ge,0,0)}}R&&(f.context.activeTexture.set(P.TEXTURE0),H.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),oe.updatePaintBuffers(z));const ne=F.constantOr(null);if(ne&&H.imageAtlas){const se=H.imageAtlas,ge=se.patternPositions[ne.to.toString()],xe=se.patternPositions[ne.from.toString()];ge&&xe&&oe.setConstantPatternPositions(ge,xe)}const ee=f.translatePosMatrix(Z.projMatrix,H,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),te=c.paint.get("fill-extrusion-vertical-gradient"),re=R?ea(ee,f,te,j,Z,z,H):To(ee,f,te,j);f.prepareDrawProgram(T,$,Z.toUnwrapped()),$.draw(T,T.gl.TRIANGLES,y,x,E,d.CullFaceMode.backCCW,re,c.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,c.paint,f.transform.zoom,oe,f.terrain?W.centroidVertexBuffer:null)}}function ra(f,o,c,g,y,x){const E=[$=>{let ne=$.canonical.x-1,ee=$.wrap;return ne<0&&(ne=(1<<$.canonical.z)-1,ee--),new d.OverscaledTileID($.overscaledZ,ee,$.canonical.z,ne,$.canonical.y)},$=>{let ne=$.canonical.x+1,ee=$.wrap;return ne===1<<$.canonical.z&&(ne=0,ee++),new d.OverscaledTileID($.overscaledZ,ee,$.canonical.z,ne,$.canonical.y)},$=>new d.OverscaledTileID($.overscaledZ,$.wrap,$.canonical.z,$.canonical.x,(0===$.canonical.y?1<<$.canonical.z:$.canonical.y)-1),$=>new d.OverscaledTileID($.overscaledZ,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y===(1<<$.canonical.z)-1?0:$.canonical.y+1)],T=$=>{const ne=o.getSource().maxzoom,ee=ge=>{const xe=o.getTileByID(ge);if(xe&&xe.hasData())return xe.getBucket(y)};let te,re,se;return($.overscaledZ===$.canonical.z||$.overscaledZ>=ne)&&(te=ee($.key)),$.overscaledZ>=ne&&(re=ee($.calculateScaledKey($.overscaledZ+1))),$.overscaledZ>ne&&(se=ee($.calculateScaledKey($.overscaledZ-1))),te||re||se},P=[0,0,0],F=($,ne)=>(P[0]=Math.min($.min.y,ne.min.y),P[1]=Math.max($.max.y,ne.max.y),P[2]=d.EXTENT-ne.min.x>$.max.x?ne.min.x-d.EXTENT:$.max.x,P),R=($,ne)=>(P[0]=Math.min($.min.x,ne.min.x),P[1]=Math.max($.max.x,ne.max.x),P[2]=d.EXTENT-ne.min.y>$.max.y?ne.min.y-d.EXTENT:$.max.y,P),z=[($,ne)=>F($,ne),($,ne)=>F(ne,$),($,ne)=>R($,ne),($,ne)=>R(ne,$)],j=new d.pointGeometry(0,0);let Z,H,W;const oe=($,ne,ee,te,re)=>{const se=[[te?ee:$,te?$:ee,0],[te?ee:ne,te?ne:ee,0]],ge=re<0?d.EXTENT+re:re,xe=[te?ge:($+ne)/2,te?($+ne)/2:ge,0];return 0===ee&&re<0||0!==ee&&re>0?x.getForTilePoints(W,[xe],!0,H):se.push(xe),x.getForTilePoints(c,se,!0,Z),Math.max(se[0][2],se[1][2],xe[2])/x.exaggeration()};for(let $=0;$<4;$++){const ne=g.borders[$];if(0===ne.length&&(g.borderDone[$]=!0),g.borderDone[$])continue;const ee=W=E[$](c),te=T(ee);if(!(te&&te.enableTerrain&&(H=x.findDEMTileFor(ee),H&&H.dem)))continue;if(!Z){const xe=x.findDEMTileFor(c);if(!xe||!xe.dem)return;Z=xe}const re=($<2?1:5)-$,se=te.borders[re];let ge=0;for(let xe=0;xe<ne.length;xe++){const Ue=g.featuresOnBorder[ne[xe]],Re=Ue.borders[$];let ke;for(;ge<se.length&&(ke=te.featuresOnBorder[se[ge]],!(ke.borders[re][1]>Re[0]+3));)te.borderDone[re]||te.encodeCentroid(void 0,ke,!1),ge++;if(ke&&ge<se.length){const be=ge;let ve=0;for(;!(ke.borders[re][0]>Re[1]-3)&&(ve++,++ge!==se.length);)ke=te.featuresOnBorder[se[ge]];if(ke=te.featuresOnBorder[se[be]],Ue.intersectsCount()>1||ke.intersectsCount()>1||1!==ve){1!==ve&&(ge=be),g.encodeCentroid(void 0,Ue,!1),te.borderDone[re]||te.encodeCentroid(void 0,ke,!1);continue}const Fe=z[$](Ue,ke),Me=$%2?d.EXTENT-1:0;j.x=oe(Fe[0],Math.min(d.EXTENT-1,Fe[1]),Me,$<2,Fe[2]),j.y=0,g.encodeCentroid(j,Ue,!1),te.borderDone[re]||te.encodeCentroid(j,ke,!1)}else g.encodeCentroid(void 0,Ue,!1)}g.borderDone[$]=g.needsCentroidUpdate=!0,te.borderDone[re]||(te.borderDone[re]=te.needsCentroidUpdate=!0)}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&0!==g.centroidVertexArray.length)&&g.uploadCentroid(f)}const It=new d.Color(1,0,0,1),Mc=new d.Color(0,1,0,1),So=new d.Color(0,0,1,1),ia=new d.Color(1,0,1,1),oa=new d.Color(0,1,1,1);function Mn(f,o,c,g){Ui(f,0,o+c/2,f.transform.width,c,g)}function Ds(f,o,c,g){Ui(f,o-c/2,0,c,f.transform.height,g)}function Ui(f,o,c,g,y,x){const E=f.context,T=E.gl;T.enable(T.SCISSOR_TEST),T.scissor(o*d.exported.devicePixelRatio,c*d.exported.devicePixelRatio,g*d.exported.devicePixelRatio,y*d.exported.devicePixelRatio),E.clear({color:x}),T.disable(T.SCISSOR_TEST)}function fi(f,o,c){const g=f.context,y=g.gl,x=c.projMatrix,E=f.useProgram("debug"),T=o.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(T,E);const P=d.DepthMode.disabled,F=d.StencilMode.disabled,R=f.colorModeForRenderPass(),z="$debug";g.activeTexture.set(y.TEXTURE0),f.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),T._makeDebugTileBoundsBuffers(f.context,f.transform.projection);const j=T._tileDebugBuffer||f.debugBuffer,Z=T._tileDebugIndexBuffer||f.debugIndexBuffer,H=T._tileDebugSegments||f.debugSegments;E.draw(g,y.LINE_STRIP,P,F,R,d.CullFaceMode.disabled,Du(x,d.Color.red),z,j,Z,H);const W=T.latestRawTileData,oe=Math.floor((W&&W.byteLength||0)/1024),$=o.getTile(c).tileSize,ne=512/Math.min($,512)*(c.overscaledZ/f.transform.zoom)*.5;let ee=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(ee+=` => ${c.overscaledZ}`),function(te,re){te.initDebugOverlayCanvas();const se=te.debugOverlayCanvas,ge=te.context.gl,xe=te.debugOverlayCanvas.getContext("2d");xe.clearRect(0,0,se.width,se.height),xe.shadowColor="white",xe.shadowBlur=2,xe.lineWidth=1.5,xe.strokeStyle="white",xe.textBaseline="top",xe.font="bold 36px Open Sans, sans-serif",xe.fillText(re,5,5),xe.strokeText(re,5,5),te.debugOverlayTexture.update(se),te.debugOverlayTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)}(f,`${ee} ${oe}kb`),E.draw(g,y.TRIANGLES,P,F,d.ColorMode.alphaBlended,d.CullFaceMode.disabled,Du(x,d.Color.transparent,ne),z,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}const Cn=d.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Mu}=Cn;function lo(f,o,c,g){f.emplaceBack(o,c,g)}class Fi{constructor(o){this.vertexArray=new d.StructArrayLayout3f12,this.indices=new d.StructArrayLayout3ui6,lo(this.vertexArray,-1,-1,1),lo(this.vertexArray,1,-1,1),lo(this.vertexArray,-1,1,1),lo(this.vertexArray,1,1,1),lo(this.vertexArray,-1,-1,-1),lo(this.vertexArray,1,-1,-1),lo(this.vertexArray,-1,1,-1),lo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Mu),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=d.SegmentVector.simpleSegment(0,0,36,12)}}function wr(f,o,c,g,y,x){const E=f.gl,T=o.paint.get("sky-atmosphere-color"),P=o.paint.get("sky-atmosphere-halo-color"),F=o.paint.get("sky-atmosphere-sun-intensity"),R={u_matrix_3f:d.fromMat4([],g),u_sun_direction:y,u_sun_intensity:F,u_color_tint_r:[(H=T).r,H.g,H.b,H.a],u_color_tint_m:[(W=P).r,W.g,W.b,W.a],u_luminance:5e-5};var H,W;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+x,o.skyboxTexture,0),c.draw(f,E.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.frontCW,R,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const sa={symbol:function(f,o,c,g,y){if("translucent"!==f.renderPass)return;const x=d.StencilMode.disabled,E=f.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(T,P,F,R,z,j,Z){const H=P.transform,W="map"===z,oe="map"===j,$=H.projection.createTileTransform(H,H.worldSize);for(const ne of T){const ee=R.getTile(ne),te=ee.getBucket(F);if(!te||te.projection!==H.projection.name||!te.text||!te.text.segments.get().length)continue;const re=d.evaluateSizeForZoom(te.textSizeData,H.zoom),se=P.transform.calculatePixelsToTileUnitsMatrix(ee),ge=vs(ne.projMatrix,ee.tileID.canonical,oe,W,P.transform,se),xe="none"!==F.layout.get("icon-text-fit")&&te.hasIconData();if(re){const Ue=Math.pow(2,H.zoom-ee.tileID.overscaledZ);ki(te,W,oe,Z,d.symbolSize,H,ge,ne,Ue,re,xe,$)}}}(g,f,c,o,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y),0!==c.paint.get("icon-opacity").constantOr(1)&&Kn(f,o,c,g,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),x,E),0!==c.paint.get("text-opacity").constantOr(1)&&Kn(f,o,c,g,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),x,E),o.map.showCollisionBoxes&&(et(f,o,c,g,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),et(f,o,c,g,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,o,c,g){if("translucent"!==f.renderPass)return;const y=c.paint.get("circle-opacity"),x=c.paint.get("circle-stroke-width"),E=c.paint.get("circle-stroke-opacity"),T=void 0!==c.layout.get("circle-sort-key").constantOr(1);if(0===y.constantOr(1)&&(0===x.constantOr(1)||0===E.constantOr(1)))return;const P=f.context,F=P.gl,R=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),z=d.StencilMode.disabled,j=f.colorModeForRenderPass(),Z=[];for(let W=0;W<g.length;W++){const oe=g[W],$=o.getTile(oe),ne=$.getBucket(c);if(!ne)continue;const ee=ne.programConfigurations.get(c.id),te=Tc(c),re={programConfiguration:ee,program:f.useProgram("circle",ee,te),layoutVertexBuffer:ne.layoutVertexBuffer,indexBuffer:ne.indexBuffer,uniformValues:zh(f,oe,$,c),tile:$};if(T){const se=ne.segments.get();for(const ge of se)Z.push({segments:new d.SegmentVector([ge]),sortKey:ge.sortKey,state:re})}else Z.push({segments:ne.segments,sortKey:0,state:re})}T&&Z.sort((W,oe)=>W.sortKey-oe.sortKey);const H={useDepthForOcclusion:"globe"!==f.transform.projection.name};for(const W of Z){const{programConfiguration:oe,program:$,layoutVertexBuffer:ne,indexBuffer:ee,uniformValues:te,tile:re}=W.state,se=W.segments;f.terrain&&f.terrain.setupElevationDraw(re,$,H),f.prepareDrawProgram(P,$,re.tileID.toUnwrapped()),$.draw(P,F.TRIANGLES,R,z,j,d.CullFaceMode.disabled,te,c.id,ne,ee,se,c.paint,f.transform.zoom,oe)}},heatmap:function(f,o,c,g){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const y=f.context,x=y.gl,E=d.StencilMode.disabled,T=new d.ColorMode([x.ONE,x.ONE],d.Color.transparent,[!0,!0,!0,!0]);(function(P,F,R){const z=P.gl;P.activeTexture.set(z.TEXTURE1),P.viewport.set([0,0,F.width/4,F.height/4]);let j=R.heatmapFbo;if(j)z.bindTexture(z.TEXTURE_2D,j.colorAttachment.get()),P.bindFramebuffer.set(j.framebuffer);else{const Z=z.createTexture();z.bindTexture(z.TEXTURE_2D,Z),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.LINEAR),j=R.heatmapFbo=P.createFramebuffer(F.width/4,F.height/4,!1),function(H,W,oe,$){const ne=H.gl;ne.texImage2D(ne.TEXTURE_2D,0,ne.RGBA,W.width/4,W.height/4,0,ne.RGBA,H.extRenderToTextureHalfFloat?H.extTextureHalfFloat.HALF_FLOAT_OES:ne.UNSIGNED_BYTE,null),$.colorAttachment.set(oe)}(P,F,Z,j)}})(y,f,c),y.clear({color:d.Color.transparent});for(let P=0;P<g.length;P++){const F=g[P];if(o.hasRenderableParent(F))continue;const R=o.getTile(F),z=R.getBucket(c);if(!z)continue;const j=z.programConfigurations.get(c.id),Z=f.useProgram("heatmap",j),{zoom:H}=f.transform;f.terrain&&f.terrain.setupElevationDraw(R,Z),f.prepareDrawProgram(y,Z,F.toUnwrapped()),Z.draw(y,x.TRIANGLES,d.DepthMode.disabled,E,T,d.CullFaceMode.disabled,Tu(F.projMatrix,R,H,c.paint.get("heatmap-intensity")),c.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,c.paint,f.transform.zoom,j)}y.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(y,x){const E=y.context,T=E.gl,P=x.heatmapFbo;if(!P)return;E.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,P.colorAttachment.get()),E.activeTexture.set(T.TEXTURE1);let F=x.colorRampTexture;F||(F=x.colorRampTexture=new d.Texture(E,x.colorRamp,T.RGBA)),F.bind(T.LINEAR,T.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(E,T.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,y.colorModeForRenderPass(),d.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:x.paint.get("heatmap-opacity")},x.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,x.paint,y.transform.zoom)}(f,c))},line:function(f,o,c,g){if("translucent"!==f.renderPass)return;const y=c.paint.get("line-opacity"),x=c.paint.get("line-width");if(0===y.constantOr(1)||0===x.constantOr(1))return;const E=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),T=f.colorModeForRenderPass(),P=c.paint.get("line-dasharray"),F=P.constantOr(1),R=c.layout.get("line-cap"),z=c.paint.get("line-pattern"),j=z.constantOr(1),Z=c.paint.get("line-gradient"),H=c.getCrossfadeParameters(),W=j?"linePattern":"line",oe=f.context,$=oe.gl,ne=(te=>{const re=[];ao(te)&&re.push("RENDER_LINE_DASH"),te.paint.get("line-gradient")&&re.push("RENDER_LINE_GRADIENT");const se=te.paint.get("line-pattern").constantOr(1),ge=1!==te.paint.get("line-opacity").constantOr(1);return!se&&ge&&re.push("RENDER_LINE_ALPHA_DISCARD"),re})(c);let ee=ne.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(ee=!1);for(const te of g){const re=o.getTile(te);if(j&&!re.patternsLoaded())continue;const se=re.getBucket(c);if(!se)continue;f.prepareDrawTile(te);const ge=se.programConfigurations.get(c.id),xe=f.useProgram(W,ge,ne),Ue=z.constantOr(null);if(Ue&&re.imageAtlas){const Me=re.imageAtlas,tt=Me.patternPositions[Ue.to.toString()],lt=Me.patternPositions[Ue.from.toString()];tt&&lt&&ge.setConstantPatternPositions(tt,lt)}const Re=P.constantOr(null),ke=R.constantOr(null);if(!j&&Re&&ke&&re.lineAtlas){const Me=re.lineAtlas,tt=Me.getDash(Re.to,ke),lt=Me.getDash(Re.from,ke);tt&&lt&&ge.setConstantPatternPositions(tt,lt)}const be=f.terrain?te.projMatrix:null,ve=j?rr(f,re,c,H,be):Dt(f,re,c,H,be,se.lineClipsArray.length);if(Z){const Me=se.gradients[c.id];let tt=Me.texture;if(c.gradientVersion!==Me.version){let lt=256;if(c.stepInterpolant){const Mt=o.getSource().maxzoom,je=te.canonical.z===Mt?Math.ceil(1<<f.transform.maxZoom-te.canonical.z):1;lt=d.clamp(d.nextPowerOfTwo(se.maxLineLength/d.EXTENT*1024*je),256,oe.maxTextureSize)}Me.gradient=d.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:lt,image:Me.gradient||void 0,clips:se.lineClipsArray}),Me.texture?Me.texture.update(Me.gradient):Me.texture=new d.Texture(oe,Me.gradient,$.RGBA),Me.version=c.gradientVersion,tt=Me.texture}oe.activeTexture.set($.TEXTURE1),tt.bind(c.stepInterpolant?$.NEAREST:$.LINEAR,$.CLAMP_TO_EDGE)}F&&(oe.activeTexture.set($.TEXTURE0),re.lineAtlasTexture.bind($.LINEAR,$.REPEAT),ge.updatePaintBuffers(H)),j&&(oe.activeTexture.set($.TEXTURE0),re.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),ge.updatePaintBuffers(H)),f.prepareDrawProgram(oe,xe,te.toUnwrapped());const Fe=Me=>{xe.draw(oe,$.TRIANGLES,E,Me,T,d.CullFaceMode.disabled,ve,c.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,c.paint,f.transform.zoom,ge,se.layoutVertexBuffer2)};if(ee){const Me=f.stencilModeForClipping(te).ref;0===Me&&f.terrain&&oe.clear({stencil:0});const tt={func:$.EQUAL,mask:255};ve.u_alpha_discard_threshold=.8,Fe(new d.StencilMode(tt,Me,255,$.KEEP,$.KEEP,$.INVERT)),ve.u_alpha_discard_threshold=0,Fe(new d.StencilMode(tt,Me,255,$.KEEP,$.KEEP,$.KEEP))}else Fe(f.stencilModeForClipping(te))}ee&&(f.resetStencilClippingMasks(),f.terrain&&oe.clear({stencil:0}))},fill:function(f,o,c,g){const y=c.paint.get("fill-color"),x=c.paint.get("fill-opacity");if(0===x.constantOr(1))return;const E=f.colorModeForRenderPass(),T=c.paint.get("fill-pattern"),P=f.opaquePassEnabledForLayer()&&!T.constantOr(1)&&1===y.constantOr(d.Color.transparent).a&&1===x.constantOr(0)?"opaque":"translucent";if(f.renderPass===P){const F=f.depthModeForSublayer(1,"opaque"===f.renderPass?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly);On(f,o,c,g,F,E,!1)}if("translucent"===f.renderPass&&c.paint.get("fill-antialias")){const F=f.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,d.DepthMode.ReadOnly);On(f,o,c,g,F,E,!0)}},"fill-extrusion":function(f,o,c,g){const y=c.paint.get("fill-extrusion-opacity");if(0!==y&&"translucent"===f.renderPass){const x=new d.DepthMode(f.context.gl.LEQUAL,d.DepthMode.ReadWrite,f.depthRangeFor3D);if(1!==y||c.paint.get("fill-extrusion-pattern").constantOr(1))Ko(f,o,c,g,x,d.StencilMode.disabled,d.ColorMode.disabled),Ko(f,o,c,g,x,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const E=f.colorModeForRenderPass();Ko(f,o,c,g,x,d.StencilMode.disabled,E)}}},hillshade:function(f,o,c,g){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass)return;const y=f.context,x=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),E=f.colorModeForRenderPass(),T=f.terrain&&f.terrain.renderingToTexture,[P,F]="translucent"!==f.renderPass||T?[{},g]:f.stencilConfigForOverlap(g);for(const R of F){const z=o.getTile(R);if(z.needsHillshadePrepare&&"offscreen"===f.renderPass)Kr(f,z,c,x,d.StencilMode.disabled,E);else if("translucent"===f.renderPass){const j=T&&f.terrain?f.terrain.stencilModeForRTTOverlap(R):P[R.overscaledZ];wu(f,R,z,c,x,j,E)}}y.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,o,c,g,y,x){if("translucent"!==f.renderPass||0===c.paint.get("raster-opacity")||!g.length)return;const E=f.context,T=E.gl,P=o.getSource(),F=f.useProgram("raster"),R=f.colorModeForRenderPass(),z=f.terrain&&f.terrain.renderingToTexture,[j,Z]=P instanceof wo||z?[{},g]:f.stencilConfigForOverlap(g),H=Z[Z.length-1].overscaledZ,W=!f.options.moving;for(const oe of Z){const $=z?d.DepthMode.disabled:f.depthModeForSublayer(oe.overscaledZ-H,1===c.paint.get("raster-opacity")?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly,T.LESS),ne=oe.toUnwrapped(),ee=o.getTile(oe);if(z&&(!ee||!ee.hasData()))continue;const te=z?oe.projMatrix:f.transform.calculateProjMatrix(ne,W),re=f.terrain&&z?f.terrain.stencilModeForRTTOverlap(oe):j[oe.overscaledZ],se=x?0:c.paint.get("raster-fade-duration");ee.registerFadeDuration(se);const ge=o.findLoadedParent(oe,0),xe=cp(ee,ge,o,f.transform,se);let Ue,Re;f.terrain&&f.terrain.prepareDrawTile(oe);const ke="nearest"===c.paint.get("raster-resampling")?T.NEAREST:T.LINEAR;E.activeTexture.set(T.TEXTURE0),ee.texture.bind(ke,T.CLAMP_TO_EDGE),E.activeTexture.set(T.TEXTURE1),ge?(ge.texture.bind(ke,T.CLAMP_TO_EDGE),Ue=Math.pow(2,ge.tileID.overscaledZ-ee.tileID.overscaledZ),Re=[ee.tileID.canonical.x*Ue%1,ee.tileID.canonical.y*Ue%1]):ee.texture.bind(ke,T.CLAMP_TO_EDGE);const be=Jr(te,Re||[0,0],Ue||1,xe,c,P instanceof wo?P.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(E,F,ne),P instanceof wo)F.draw(E,T.TRIANGLES,$,d.StencilMode.disabled,R,d.CullFaceMode.disabled,be,c.id,P.boundsBuffer,f.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:ve,tileBoundsIndexBuffer:Fe,tileBoundsSegments:Me}=f.getTileBoundsBuffers(ee);F.draw(E,T.TRIANGLES,$,re,R,d.CullFaceMode.disabled,be,c.id,ve,Fe,Me)}}f.resetStencilClippingMasks()},background:function(f,o,c,g){const y=c.paint.get("background-color"),x=c.paint.get("background-opacity");if(0===x)return;const E=f.context,T=E.gl,P=f.transform,F=P.tileSize,R=c.paint.get("background-pattern");if(f.isPatternMissing(R))return;const z=!R&&1===y.a&&1===x&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==z)return;const j=d.StencilMode.disabled,Z=f.depthModeForSublayer(0,"opaque"===z?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly),H=f.colorModeForRenderPass(),W=f.useProgram(R?"backgroundPattern":"background");let oe,$=g;$||(oe=f.getBackgroundTiles(),$=Object.values(oe).map(ee=>ee.tileID)),R&&(E.activeTexture.set(T.TEXTURE0),f.imageManager.bind(f.context));const ne=c.getCrossfadeParameters();for(const ee of $){const te=ee.toUnwrapped(),re=g?ee.projMatrix:f.transform.calculateProjMatrix(te);f.prepareDrawTile(ee);const se=o?o.getTile(ee):oe?oe[ee.key]:new d.Tile(ee,F,P.zoom,f),ge=R?fr(re,x,f,R,{tileID:ee,tileSize:F},ne):zt(re,x,y);f.prepareDrawProgram(E,W,te);const{tileBoundsBuffer:xe,tileBoundsIndexBuffer:Ue,tileBoundsSegments:Re}=f.getTileBoundsBuffers(se);W.draw(E,T.TRIANGLES,Z,j,H,d.CullFaceMode.disabled,ge,c.id,xe,Ue,Re)}},sky:function(f,o,c){const g=f.transform,y="mercator"===g.projection.name||"globe"===g.projection.name?1:d.smoothstep(7,8,g.zoom),x=c.paint.get("sky-opacity")*y;if(0===x)return;const E=f.context,T=c.paint.get("sky-type"),P=new d.DepthMode(E.gl.LEQUAL,d.DepthMode.ReadOnly,[0,1]),F=f.frameCounter/1e3%1;"atmosphere"===T?"offscreen"===f.renderPass?c.needsSkyboxCapture(f)&&(function(R,z,j,Z){const H=R.context,W=H.gl;let oe=z.skyboxFbo;if(!oe){oe=z.skyboxFbo=H.createFramebuffer(32,32,!1),z.skyboxGeometry=new Fi(H),z.skyboxTexture=H.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,z.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let te=0;te<6;++te)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(oe.framebuffer),H.viewport.set([0,0,32,32]);const $=z.getCenter(R,!0),ne=R.useProgram("skyboxCapture"),ee=new Float64Array(16);d.identity(ee),d.rotateY(ee,ee,.5*-Math.PI),wr(H,z,ne,ee,$,0),d.identity(ee),d.rotateY(ee,ee,.5*Math.PI),wr(H,z,ne,ee,$,1),d.identity(ee),d.rotateX(ee,ee,.5*-Math.PI),wr(H,z,ne,ee,$,2),d.identity(ee),d.rotateX(ee,ee,.5*Math.PI),wr(H,z,ne,ee,$,3),d.identity(ee),wr(H,z,ne,ee,$,4),d.identity(ee),d.rotateY(ee,ee,Math.PI),wr(H,z,ne,ee,$,5),H.viewport.set([0,0,R.width,R.height])}(f,c),c.markSkyboxValid(f)):"sky"===f.renderPass&&function(R,z,j,Z,H){const W=R.context,oe=W.gl,$=R.transform,ne=R.useProgram("skybox");W.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_CUBE_MAP,z.skyboxTexture);const ee={u_matrix:$.skyboxMatrix,u_sun_direction:z.getCenter(R,!1),u_cubemap:0,u_opacity:Z,u_temporal_offset:H};R.prepareDrawProgram(W,ne),ne.draw(W,oe.TRIANGLES,j,d.StencilMode.disabled,R.colorModeForRenderPass(),d.CullFaceMode.backCW,ee,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(f,c,P,x,F):"gradient"===T&&"sky"===f.renderPass&&function(R,z,j,Z,H){const W=R.context,oe=W.gl,$=R.transform,ne=R.useProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new Fi(W)),W.activeTexture.set(oe.TEXTURE0);let ee=z.colorRampTexture;ee||(ee=z.colorRampTexture=new d.Texture(W,z.colorRamp,oe.RGBA)),ee.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const te=(re=$.skyboxMatrix,se=z.getCenter(R,!1),ge=z.paint.get("sky-gradient-radius"),xe=Z,Ue=H,{u_matrix:re,u_color_ramp:0,u_center_direction:se,u_radius:d.degToRad(ge),u_opacity:xe,u_temporal_offset:Ue});var re,se,ge,xe,Ue;R.prepareDrawProgram(W,ne),ne.draw(W,oe.TRIANGLES,j,d.StencilMode.disabled,R.colorModeForRenderPass(),d.CullFaceMode.backCW,te,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(f,c,P,x,F)},debug:function(f,o,c){for(let g=0;g<c.length;g++)fi(f,o,c[g])},custom:function(f,o,c){const g=f.context,y=c.implementation;if(f.transform.projection.unsupportedLayers&&f.transform.projection.unsupportedLayers.includes("custom"))d.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===f.renderPass){const x=y.prerender;x&&(f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),x.call(y,g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState())}else if("translucent"===f.renderPass){f.setCustomLayerDefaults(),g.setColorMode(f.colorModeForRenderPass()),g.setStencilMode(d.StencilMode.disabled);const x="3d"===y.renderingMode?new d.DepthMode(f.context.gl.LEQUAL,d.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,d.DepthMode.ReadOnly);g.setDepthMode(x),y.render(g.gl,f.transform.customLayerMatrix()),g.setDirty(),f.setBaseState(),g.bindFramebuffer.set(null)}}};class zl{constructor(o,c){this.context=new Ii(o),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=d.SourceCache.maxUnderzooming+d.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new tn,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(o,c){const g=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new oo(this,o));const y=this._terrain;this.transform.elevation=g?y:null,y.update(o,this.transform,c)}_updateFog(o){const c=o.fog;if(!c||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,y]=c.getFovAdjustedRange(this.transform._fov);if(g>y)return void(this.transform.fogCullDistSq=null);const x=g+.78*(y-g);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,c){if(this.width=o*d.exported.devicePixelRatio,this.height=c*d.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const o=this.context,c=new d.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(d.EXTENT,0),c.emplaceBack(0,d.EXTENT),c.emplaceBack(d.EXTENT,d.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(c,d.posAttributes.members),this.tileExtentSegments=d.SegmentVector.simpleSegment(0,0,4,2);const g=new d.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(d.EXTENT,0),g.emplaceBack(0,d.EXTENT),g.emplaceBack(d.EXTENT,d.EXTENT),this.debugBuffer=o.createVertexBuffer(g,d.posAttributes.members),this.debugSegments=d.SegmentVector.simpleSegment(0,0,4,5);const y=new d.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(y,d.posAttributes.members),this.viewportSegments=d.SegmentVector.simpleSegment(0,0,4,2);const x=new d.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(d.EXTENT,0,d.EXTENT,0),x.emplaceBack(0,d.EXTENT,0,d.EXTENT),x.emplaceBack(d.EXTENT,d.EXTENT,d.EXTENT,d.EXTENT),this.mercatorBoundsBuffer=o.createVertexBuffer(x,d.boundsAttributes.members),this.mercatorBoundsSegments=d.SegmentVector.simpleSegment(0,0,4,2);const E=new d.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(E);const T=new d.StructArrayLayout1ui2;for(const F of[0,1,3,2,0])T.emplaceBack(F);this.debugIndexBuffer=o.createIndexBuffer(T),this.emptyTexture=new d.Texture(o,{width:1,height:1,data:new Uint8Array([0,0,0,0])},o.gl.RGBA),this.identityMat=d.create();const P=this.context.gl;this.stencilClearMode=new d.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(d.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context,c=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(o,c.TRIANGLES,d.DepthMode.disabled,this.stencilClearMode,d.ColorMode.disabled,d.CullFaceMode.disabled,qt(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,c,g){if(!c||this.currentStencilSource===c.id||!o.isTileClipped()||!g||0===g.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(const P of g)if(void 0===this._tileClippingMaskIDs[P.key]){T=!0;break}if(!T)return}this.currentStencilSource=c.id;const y=this.context,x=y.gl;this.nextStencilID+g.length>256&&this.clearStencil(),y.setColorMode(d.ColorMode.disabled),y.setDepthMode(d.DepthMode.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of g){const P=c.getTile(T),F=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:z,tileBoundsSegments:j}=this.getTileBoundsBuffers(P);E.draw(y,x.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:x.ALWAYS,mask:0},F,255,x.KEEP,x.KEEP,x.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,qt(T.projMatrix),"$clipping",R,z,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,c=this.context.gl;return new d.StencilMode({func:c.NOTEQUAL,mask:255},o,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const c=this.context.gl;return new d.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(o){const c=this.context.gl,g=o.sort((E,T)=>T.overscaledZ-E.overscaledZ),y=g[g.length-1].overscaledZ,x=g[0].overscaledZ-y+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const E={};for(let T=0;T<x;T++)E[T+y]=new d.StencilMode({func:c.GEQUAL,mask:255},T+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=x,[E,g]}return[{[y]:d.StencilMode.disabled},g]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new d.ColorMode([o.CONSTANT_COLOR,o.ONE],new d.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?d.ColorMode.unblended:d.ColorMode.alphaBlended}depthModeForSublayer(o,c,g){if(!this.opaquePassEnabledForLayer())return d.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new d.DepthMode(g||this.context.gl.LEQUAL,c,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,c){this.style=o,this.options=c,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(d.exported.now()),this.imageManager.beginFrame();const g=this.style.order,y=this.style._sourceCaches;for(const F in y){const R=y[F];R.used&&R.prepare(this.context)}const x={},E={},T={};for(const F in y){const R=y[F];x[F]=R.getVisibleCoordinates(),E[F]=x[F].slice().reverse(),T[F]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<g.length;F++)if(this.style._layers[g[F]].is3D()){this.opaquePassCutoff=F;break}if(this.terrain&&(this.terrain.updateTileBinding(T),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new d.GlobeSharedBuffers(this.context)),!d.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const F of g){const R=this.style._layers[F],z=o._getLayerSourceCache(R);if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const j=z?E[z.id]:void 0;("custom"===R.type||R.isSky()||j&&j.length)&&this.renderLayer(this,z,R,j)}this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let P=d.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(P=this.style.fog.properties.get("color")),this.context.clear({color:c.showOverdrawInspector?d.Color.black:P,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[g[this.currentLayer]],R=o._getLayerSourceCache(F);if(F.isSky())continue;const z=R?E[R.id]:void 0;this._renderTileClippingMasks(F,R,z),this.renderLayer(this,R,F,z)}if(this.renderPass="sky",(d.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const F=this.style._layers[g[this.currentLayer]],R=o._getLayerSourceCache(F);F.isSky()&&this.renderLayer(this,R,F,R?E[R.id]:void 0)}for("globe"===this.transform.projection.name&&function(F){const R=F.context,z=R.gl,j=F.transform,Z=new d.DepthMode(z.LEQUAL,d.DepthMode.ReadOnly,[0,1]),H=F.useProgram("globeAtmosphere"),W=j._camera.getWorldToCamera(j.worldSize,1),oe=j._camera.getCameraToClipPerspective(j._fov,j.width/j.height,j._nearZ,j._farZ),$=d.mul([],W,d.calculateGlobeMatrix(j,j.worldSize)),ne=d.mul([],j.labelPlaneMatrix,oe),ee=d.transformMat4([],[0,0,0],$),te=d.add([],ee,[j.worldSize/Math.PI/2,0,0]),re=d.transformMat4([],ee,ne),se=d.transformMat4([],te,ne),ge=d.length(d.sub([],se,re)),xe=1-d.globeToMercatorTransition(j.zoom),Ue={u_center:re,u_radius:ge,u_screen_size:[j.width,j.height],u_pixel_ratio:d.exported.devicePixelRatio,u_opacity:xe,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};F.prepareDrawProgram(R,H);const Re=F.globeSharedBuffers;Re&&H.draw(R,z.TRIANGLES,Z,d.StencilMode.disabled,d.ColorMode.alphaBlended,d.CullFaceMode.backCW,Ue,"skybox",Re.atmosphereVertexBuffer,Re.atmosphereIndexBuffer,Re.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const F=this.style._layers[g[this.currentLayer]],R=o._getLayerSourceCache(F);if(F.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(F)){if(F.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const z=R?("symbol"===F.type?T:E)[R.id]:void 0;this._renderTileClippingMasks(F,R,R?x[R.id]:void 0),this.renderLayer(this,R,F,z),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let F=null;d.values(this.style._layers).forEach(R=>{const z=o._getLayerSourceCache(R);z&&!R.isHidden(this.transform.zoom)&&(!F||F.getSource().maxzoom<z.getSource().maxzoom)&&(F=z)}),F&&this.options.showTileBoundaries&&sa.debug(this,F,F.getVisibleCoordinates())}this.options.showPadding&&function(F){const R=F.transform.padding;Mn(F,F.transform.height-(R.top||0),3,It),Mn(F,R.bottom||0,3,Mc),Ds(F,R.left||0,3,So),Ds(F,F.transform.width-(R.right||0),3,ia);const z=F.transform.centerPoint;var j,Z,H,W;Ui(j=F,(Z=z.x)-1,(H=F.transform.height-z.y)-10,2,20,W=oa),Ui(j,Z-10,H-1,20,2,W)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(d.window.performance.now()),this.saveCanvasCopy())}renderLayer(o,c,g,y){g.isHidden(this.transform.zoom)||("background"===g.type||"sky"===g.type||"custom"===g.type||y&&y.length)&&(this.id=g.id,this.gpuTimingStart(g),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(g.type)||sa[g.type](o,c,g,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let g=this.gpuTimers[o.id];g||(g=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),g.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,g.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const c={};for(const g in o){const y=o[g],x=this.context.extTimerQuery,E=x.getQueryObjectEXT(y.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(y.query),c[g]=E}return c}translatePosMatrix(o,c,g,y,x){if(!g[0]&&!g[1])return o;const E=x?"map"===y?this.transform.angle:0:"viewport"===y?-this.transform.angle:0;if(E){const F=Math.sin(E),R=Math.cos(E);g=[g[0]*R-g[1]*F,g[0]*F+g[1]*R]}const T=[x?g[0]:xn(c,g[0],this.transform.zoom),x?g[1]:xn(c,g[1],this.transform.zoom),0],P=new Float32Array(16);return d.translate(P,o,T),P}saveTileTexture(o){const c=this._tileTextures[o.size[0]];c?c.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const c=this._tileTextures[o];return c&&c.length>0?c.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const c=this.imageManager.getPattern(o.from.toString()),g=this.imageManager.getPattern(o.to.toString());return!c||!g}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,c=this.style&&this.style.fog,g=[];return this.terrain&&!this.terrain.renderingToTexture&&g.push("TERRAIN"),c&&!o&&0!==c.getOpacity(this.transform.pitch)&&g.push("FOG"),o&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}useProgram(o,c,g){this.cache=this.cache||{};const y=g||[],x=this.currentGlobalDefines().concat(y),E=Qs.cacheKey(o,x,c);return this.cache[E]||(this.cache[E]=new Qs(this.context,o,Ol[o],c,Bh[o],x)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=d.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(o){this.terrain&&this.terrain.prepareDrawTile(o)}prepareDrawProgram(o,c,g){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const x=y.getOpacity(this.transform.pitch);0!==x&&c.setFogUniformValues(o,((E,T,P,F)=>{const R=T.properties.get("color"),z=E.frameCounter/1e3%1,j=[R.r/R.a,R.g/R.a,R.b/R.a,F];return{u_fog_matrix:P?E.transform.calculateFogTileMatrix(P):E.identityMat,u_fog_range:T.getFovAdjustedRange(E.transform._fov),u_fog_color:j,u_fog_horizon_blend:T.properties.get("horizon-blend"),u_fog_temporal_offset:z}})(this,y,g,x))}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const o=this.context.gl,c=o.createTexture();return o.bindTexture(o.TEXTURE_2D,c),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&0!==o.getOpacity(this.transform.pitch)}getBackgroundTiles(){const o=this._backgroundTiles,c=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const y of g)c[y.key]=o[y.key]||new d.Tile(y,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class aa{constructor(o=0,c=0,g=0,y=0){if(isNaN(o)||o<0||isNaN(c)||c<0||isNaN(g)||g<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=c,this.left=g,this.right=y}interpolate(o,c,g){return null!=c.top&&null!=o.top&&(this.top=d.number(o.top,c.top,g)),null!=c.bottom&&null!=o.bottom&&(this.bottom=d.number(o.bottom,c.bottom,g)),null!=c.left&&null!=o.left&&(this.left=d.number(o.left,c.left,g)),null!=c.right&&null!=o.right&&(this.right=d.number(o.right,c.right,g)),this}getCenter(o,c){const g=d.clamp((this.left+o-this.right)/2,0,o),y=d.clamp((this.top+c-this.bottom)/2,0,c);return new d.pointGeometry(g,y)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new aa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Er(f,o){const c=d.getColumn(f,3);d.fromQuat(f,o),d.setColumn(f,3,c)}function Nh(f,o){d.setColumn(f,3,[o[0],o[1],o[2],1])}function Vh(f,o){const c=d.identity$1([]);return d.rotateZ$1(c,c,-o),d.rotateX$1(c,c,-f),c}function Su(f,o){const c=[f[0],f[1],0],g=[o[0],o[1],0];if(d.length(c)>=1e-15){const E=d.normalize([],c);d.scale$2(g,E,d.dot(g,E)),o[0]=g[0],o[1]=g[1]}const y=d.cross([],o,f);if(d.len(y)<1e-15)return null;const x=Math.atan2(-y[1],y[0]);return Vh(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),x)}class jh{constructor(o,c){this.position=o,this.orientation=c}get position(){return this._position}set position(o){this._position=this._renderWorldCopies?function(c){if(!c)return;const g=Array.isArray(c)?new d.MercatorCoordinate(c[0],c[1],c[2]):c;return g.x=d.wrap(g.x,0,1),g}(o):o}lookAtPoint(o,c){if(this.orientation=null,!this.position)return;const g=this._elevation?this._elevation.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(o)):0,y=this.position,x=d.MercatorCoordinate.fromLngLat(o,g),E=[x.x-y.x,x.y-y.y,x.z-y.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Su(E,c)}setPitchBearing(o,c){this.orientation=Vh(d.degToRad(o),d.degToRad(-c))}}class Uh{constructor(o,c){this._transform=d.identity([]),this._orientation=d.identity$1([]),c&&(this._orientation=c,Er(this._transform,this._orientation)),o&&Nh(this._transform,o)}get mercatorPosition(){const o=this.position;return new d.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=d.getColumn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){Nh(this._transform,o)}get orientation(){return this._orientation}set orientation(o){this._orientation=o,Er(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,c){this._orientation=Vh(o,c),Er(this._transform,this._orientation)}forward(){const o=d.getColumn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=d.getColumn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=d.getColumn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,c){const g=new Float64Array(16);return d.invert(g,this.getWorldToCamera(o,c)),g}getWorldToCameraPosition(o,c,g){const y=this.position;d.scale$2(y,y,-o);const x=new Float64Array(16);return d.fromScaling(x,[g,g,g]),d.translate(x,x,y),x[10]*=c,x}getWorldToCamera(o,c){const g=new Float64Array(16),y=new Float64Array(4),x=this.position;return d.conjugate(y,this._orientation),d.scale$2(x,x,-o),d.fromQuat(g,y),d.translate(g,g,x),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=c,g[9]*=c,g[10]*=c,g[11]*=c,g}getCameraToClipPerspective(o,c,g,y){const x=new Float64Array(16);return d.perspective(x,o,c,g,y),x}getDistanceToElevation(o){const c=0===o?0:d.mercatorZfromAltitude(o,this.position[1]),g=this.forward();return(c-this.position[2])/g[2]}clone(){return new Uh([...this.position],[...this.orientation])}}function dp(f,o){const c=Au(f),g=function(x,E,T,P,F){const R=new d.LngLat(T.lng-180*Io,T.lat),z=new d.LngLat(T.lng+180*Io,T.lat),j=x.project(R.lng,R.lat),Z=x.project(z.lng,z.lat),H=-Math.atan2(Z.y-j.y,Z.x-j.x),W=d.MercatorCoordinate.fromLngLat(T);W.y=d.clamp(W.y,-.999975,.999975);const oe=W.toLngLat(),$=x.project(oe.lng,oe.lat),ne=d.MercatorCoordinate.fromLngLat(oe);ne.x+=Io;const ee=ne.toLngLat(),te=x.project(ee.lng,ee.lat),re=$h(te.x-$.x,te.y-$.y,H),se=d.MercatorCoordinate.fromLngLat(oe);se.y+=Io;const ge=se.toLngLat(),xe=x.project(ge.lng,ge.lat),Ue=$h(xe.x-$.x,xe.y-$.y,H),Re=Math.abs(re.x)/Math.abs(Ue.y),ke=d.identity([]);d.rotateZ(ke,ke,-H*(1-(F?0:P)));const be=d.identity([]);return d.scale(be,be,[1,1-(1-Re)*P,1]),be[4]=-Ue.x/Ue.y*P,d.rotateZ(be,be,H),d.multiply$1(be,ke,be),be}(f.projection,0,f.center,c,o),y=Iu(f);return d.scale(g,g,[y,y,1]),g}function Iu(f){const o=f.projection,c=Au(f),g=Gh(o,f.center),y=Gh(o,d.LngLat.convert(o.center));return Math.pow(2,g*c+(1-c)*y)}function Au(f){const o=f.projection.range;if(!o)return 0;const c=Math.max(f.width,f.height),g=Math.log(c/1024)/Math.LN2;return d.smoothstep(o[0]+g,o[1]+g,f.zoom)}const Io=1/4e4;function Gh(f,o){const c=d.clamp(o.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),g=new d.LngLat(o.lng-180*Io,c),y=new d.LngLat(o.lng+180*Io,c),x=f.project(g.lng,c),E=f.project(y.lng,c),T=d.MercatorCoordinate.fromLngLat(g),P=d.MercatorCoordinate.fromLngLat(y),F=E.x-x.x,R=E.y-x.y,z=P.x-T.x,j=P.y-T.y,Z=Math.sqrt((z*z+j*j)/(F*F+R*R));return Math.log(Z)/Math.LN2}function $h(f,o,c){const g=Math.cos(c),y=Math.sin(c);return{x:f*g-o*y,y:f*y+o*g}}class Sc{constructor(o,c,g,y,x){this.tileSize=512,this._renderWorldCopies=void 0===x||x,this._minZoom=o||0,this._maxZoom=c||22,this._minPitch=null==g?0:g,this._maxPitch=null==y?60:y,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new aa,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Uh,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const o=new Sc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.setProjection(this.getProjection()),o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o.tileSize=this.tileSize,o.setMaxBounds(this.getMaxBounds()),o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._cameraZoom=this._cameraZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,o?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(o){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),o&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return d.pick(this.projection,["name","center","parallels"])}setProjection(o){null==o&&(o={name:"mercator"}),this.projectionOptions=o;const c=this.projection?this.getProjection():void 0;return this.projection=d.getProjection(o),!vt(c,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(o){void 0===o?o=!0:null===o&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.pointGeometry(this.width,this.height)}get bearing(){return d.wrap(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const c=-o*Math.PI/180;var g,y,x,E,T,P,F,R,z,j;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(g=new d.ARRAY_TYPE(4),d.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),y=this.rotationMatrix,E=this.angle,T=(x=this.rotationMatrix)[0],P=x[1],F=x[2],R=x[3],z=Math.sin(E),j=Math.cos(E),y[0]=T*j+F*z,y[1]=P*j+R*z,y[2]=T*-z+F*j,y[3]=P*-z+R*j)}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const c=d.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(o){const c=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===o?(this._cameraZoom=null,!1):(this._centerAltitude=o,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let y=0,x=0;for(let E=0;E<c.length;E++){const T=new d.pointGeometry(c[E][0]*this.width,g+c[E][1]*(this.height-g)),P=o.pointCoordinate(T);if(!P)continue;const F=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);y+=P[3]*F,x+=F}return 0===x?NaN:y/x}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const o=this._cameraZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*c,y=this._mercatorZfromZoom(o),x=this._mercatorZfromZoom(this._maxZoom),E=Math.max(y-g,x);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let g;g=o.z<this._camera.position[2]?[c.x,c.y,c.z]:[o.x,o.y,o.z];const y=d.length(d.sub([],this._camera.position,g));return d.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let c=!1;if(o.orientation&&!d.exactEquals(o.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(o.orientation)),o.position){const g=[o.position.x,o.position.y,o.position.z];d.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,c=new jh;return c.position=new d.MercatorCoordinate(o[0],o[1],o[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(o){if(!d.length$1(o))return!1;d.normalize$1(o,o);const c=d.transformQuat([],[0,0,-1],o),g=d.transformQuat([],[0,-1,0],o);if(g[2]<0)return!1;const y=Su(c,g);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(o){const c=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;o[2]=d.clamp(o[2],y/g,y/c),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,c,g){this._unmodified=!1,this._edgeInsets.interpolate(o,c,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const c=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(o){const c=[new d.UnwrappedTileID(0,o)];if(this.renderWorldCopies){const g=this.pointCoordinate(new d.pointGeometry(0,0)),y=this.pointCoordinate(new d.pointGeometry(this.width,0)),x=this.pointCoordinate(new d.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new d.pointGeometry(0,this.height)),T=Math.floor(Math.min(g.x,y.x,x.x,E.x)),P=Math.floor(Math.max(g.x,y.x,x.x,E.x)),F=1;for(let R=T-F;R<=P+F;R++)0!==R&&c.push(new d.UnwrappedTileID(R,o))}return c}coveringTiles(o){let c=this.coveringZoomLevel(o);const g=c,y=this.elevation&&!o.isTerrainDEM,x="mercator"===this.projection.name;if(void 0!==o.minzoom&&c<o.minzoom)return[];void 0!==o.maxzoom&&c>o.maxzoom&&(c=o.maxzoom);const E=this.locationCoordinate(this.center),T=1<<c,P=[T*E.x,T*E.y,0],F=d.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,"globe"!==this.projection.name),R=this.pointCoordinate(this.getCameraPoint()),z=T*d.mercatorZfromAltitude(1,this.center.lat),j=this._camera.position[2]/d.mercatorZfromAltitude(1,this.center.lat),Z=[T*R.x,T*R.y,j],H=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),W=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,oe=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,$=o.isTerrainDEM?-oe:this._elevation?this._elevation.getMinElevationBelowMSL():0,ne=this.projection.isReprojectedInTileSpace?Iu(this):1,ee=ve=>{const Me=new d.MercatorCoordinate(ve.x+25e-6,ve.y,ve.z),tt=new d.MercatorCoordinate(ve.x,ve.y+25e-6,ve.z),lt=ve.toLngLat(),Mt=Me.toLngLat(),je=tt.toLngLat(),st=this.locationCoordinate(lt),mt=this.locationCoordinate(Mt),ln=this.locationCoordinate(je),_n=Math.hypot(mt.x-st.x,mt.y-st.y),yt=Math.hypot(ln.x-st.x,ln.y-st.y);return Math.sqrt(_n*yt)*ne/25e-6},te=ve=>{const Fe=oe,Me=$;return{aabb:d.tileAABB(this,T,0,0,0,ve,Me,Fe,this.projection),zoom:0,x:0,y:0,minZ:Me,maxZ:Fe,wrap:ve,fullyVisible:!1}},re=[];let se=[];const ge=c,xe=o.reparseOverscaled?g:c,Ue=ve=>ve*ve,Re=Ue((j-this._centerAltitude)*z),ke=ve=>{if(!this._elevation||!ve.tileID||!x)return;const Fe=this._elevation.getMinMaxForTile(ve.tileID),Me=ve.aabb;Fe?(Me.min[2]=Fe.min,Me.max[2]=Fe.max,Me.center[2]=(Me.min[2]+Me.max[2])/2):(ve.shouldSplit=be(ve),ve.shouldSplit||(Me.min[2]=Me.max[2]=Me.center[2]=this._centerAltitude))},be=ve=>{if(ve.zoom<W)return!0;if(ve.zoom===ge)return!1;if(null!=ve.shouldSplit)return ve.shouldSplit;const Fe=ve.aabb.distanceX(Z),Me=ve.aabb.distanceY(Z);let tt=Re;y&&(tt=Ue(ve.aabb.distanceZ(Z)*z));let lt=1;if(this.projection.isReprojectedInTileSpace&&g<=5){const je=Math.pow(2,ve.zoom),st=ee(new d.MercatorCoordinate((ve.x+.5)/je,(ve.y+.5)/je));lt=st>.85?1:st}const Mt=Fe*Fe+Me*Me+tt;return Mt<Ue((1<<ge-ve.zoom)*H*lt*((je,st)=>{if(st*Ue(.707)<je)return 1;const mt=Math.sqrt(st/je);return mt/(1.4144271570014144+(Math.pow(1.1,mt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(tt,Re),Mt))};if(this.renderWorldCopies)for(let ve=1;ve<=3;ve++)re.push(te(-ve)),re.push(te(ve));for(re.push(te(0));re.length>0;){const ve=re.pop(),Fe=ve.x,Me=ve.y;let tt=ve.fullyVisible;if(!tt){const lt=ve.aabb.intersects(F);if(0===lt)continue;tt=2===lt}if(ve.zoom!==ge&&be(ve))for(let lt=0;lt<4;lt++){const Mt=(Fe<<1)+lt%2,je=(Me<<1)+(lt>>1),st={aabb:x?ve.aabb.quadrant(lt):d.tileAABB(this,T,ve.zoom+1,Mt,je,ve.wrap,ve.minZ,ve.maxZ,this.projection),zoom:ve.zoom+1,x:Mt,y:je,wrap:ve.wrap,fullyVisible:tt,tileID:void 0,shouldSplit:void 0,minZ:ve.minZ,maxZ:ve.maxZ};y&&(st.tileID=new d.OverscaledTileID(ve.zoom+1===ge?xe:ve.zoom+1,ve.wrap,ve.zoom+1,Mt,je),ke(st)),re.push(st)}else{const lt=ve.zoom===ge?xe:ve.zoom;if(o.minzoom&&o.minzoom>lt)continue;const Mt=P[0]-(.5+Fe+(ve.wrap<<ve.zoom))*(1<<c-ve.zoom),je=P[1]-.5-Me,st=ve.tileID?ve.tileID:new d.OverscaledTileID(lt,ve.wrap,ve.zoom,Fe,Me);se.push({tileID:st,distanceSq:Mt*Mt+je*je})}}if(this.fogCullDistSq){const ve=this.fogCullDistSq,Fe=this.horizonLineFromTop();se=se.filter(Me=>{const tt=[0,0,0,1],lt=[d.EXTENT,d.EXTENT,0,1],Mt=this.calculateFogTileMatrix(Me.tileID.toUnwrapped());d.transformMat4$1(tt,tt,Mt),d.transformMat4$1(lt,lt,Mt);const je=d.getAABBPointSquareDist(tt,lt);if(0===je)return!0;let st=!1;const mt=this._elevation;if(mt&&je>ve&&0!==Fe){const ln=this.calculateProjMatrix(Me.tileID.toUnwrapped());let _n;o.isTerrainDEM||(_n=mt.getMinMaxForTile(Me.tileID)),_n||(_n={min:$,max:oe});const yt=d.furthestTileCorner(this.rotation),Lt=[yt[0]*d.EXTENT,yt[1]*d.EXTENT,_n.max];d.transformMat4(Lt,Lt,ln),st=(1-Lt[1])*this.height*.5<Fe}return je<ve||st})}return se.sort((ve,Fe)=>ve.distanceSq-Fe.distanceSq).map(ve=>ve.tileID)}resize(o,c){this.width=o,this.height=c,this.pixelsToGLUnits=[2/o,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const c=d.clamp(o.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),g=this.projection.project(o.lng,c);return new d.pointGeometry(g.x*this.worldSize,g.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(o,c){const g=this.pointCoordinate(c),y=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(o);this.setLocation(new d.MercatorCoordinate(x.x-(g.x-y.x),x.y-(g.y-y.y)))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this._coordinatePoint(this.locationCoordinate(o),!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,c){const g=c?d.mercatorZfromAltitude(c,o.lat):void 0,y=this.projection.project(o.lng,o.lat);return new d.MercatorCoordinate(y.x,y.y,g)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,c){const g=null!=c?c:this._centerAltitude,y=[o.x,o.y,0,1],x=[o.x,o.y,1,1];d.transformMat4$1(y,y,this.pixelMatrixInverse),d.transformMat4$1(x,x,this.pixelMatrixInverse);const E=x[3];d.scale$1(y,y,1/y[3]),d.scale$1(x,x,1/E);const T=y[2],P=x[2];return{p0:y,p1:x,t:T===P?0:(g-T)/(P-T)}}screenPointToMercatorRay(o){const c=[o.x,o.y,0,1],g=[o.x,o.y,1,1];return d.transformMat4$1(c,c,this.pixelMatrixInverse),d.transformMat4$1(g,g,this.pixelMatrixInverse),d.scale$1(c,c,1/c[3]),d.scale$1(g,g,1/g[3]),c[2]=d.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,g[2]=d.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,d.scale$1(c,c,1/this.worldSize),d.scale$1(g,g,1/this.worldSize),new d.Ray([c[0],c[1],c[2]],d.normalize([],d.sub([],g,c)))}rayIntersectionCoordinate(o){const{p0:c,p1:g,t:y}=o,x=d.mercatorZfromAltitude(c[2],this._center.lat),E=d.mercatorZfromAltitude(g[2],this._center.lat);return new d.MercatorCoordinate(d.number(c[0],g[0],y)/this.worldSize,d.number(c[1],g[1],y)/this.worldSize,d.number(x,E,y))}pointCoordinate(o,c=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(o.x,o.y,c)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);const c=this.elevation;let g=this.elevation.pointCoordinate(o);if(g)return new d.MercatorCoordinate(g[0],g[1],g[2]);let y=0,x=this.horizonLineFromTop();if(o.y>x)return this.pointCoordinate(o);const E=.02*x,T=o.clone();for(let P=0;P<10&&x-y>E;P++){T.y=d.number(y,x,.66);const F=c.pointCoordinate(T);F?(x=T.y,g=F):y=T.y}return g?new d.MercatorCoordinate(g[0],g[1],g[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){if(this.elevation)return!this.elevation.pointCoordinate(o);{const c=this.horizonLineFromTop();return o.y<c}}_coordinatePoint(o,c){const g=c&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,y=[o.x*this.worldSize,o.y*this.worldSize,g+o.toAltitude(),1];return d.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new d.pointGeometry(y[0]/y[3],y[1]/y[3]):new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(o,c){const g=new d.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),y=new d.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),x=new d.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),E=new d.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let T=this.pointCoordinate(g,o),P=this.pointCoordinate(y,o);const F=this.pointCoordinate(x,c),R=this.pointCoordinate(E,c),z=(j,Z)=>(Z.y-j.y)/(Z.x-j.x);return T.y>1&&P.y>=0?T=new d.MercatorCoordinate((1-R.y)/z(R,T)+R.x,1):T.y<0&&P.y<=1&&(T=new d.MercatorCoordinate(-R.y/z(R,T)+R.x,0)),P.y>1&&T.y>=0?P=new d.MercatorCoordinate((1-F.y)/z(F,P)+F.x,1):P.y<0&&T.y<=1&&(P=new d.MercatorCoordinate(-F.y/z(F,P)+F.x,0)),(new d.LngLatBounds).extend(this.coordinateLocation(T)).extend(this.coordinateLocation(P)).extend(this.coordinateLocation(R)).extend(this.coordinateLocation(F))}_getBounds3D(){const o=this.elevation;if(!o.visibleDemTiles.length)return this._getBounds(0,0);const c=o.visibleDemTiles.reduce((g,y)=>{if(y.dem){const x=y.dem.tree;g.min=Math.min(g.min,x.minimums[0]),g.max=Math.max(g.max,x.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBounds(c.min*o.exaggeration(),c.max*o.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(o=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-c*(1-this._horizonShift);return o?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-d.MAX_MERCATOR_LATITUDE,this.maxLat=d.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=d.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=d.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=d.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=d.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,c){return this.projection.createTileTransform(this,c).createTileMatrix(o)}calculateDistanceTileData(o){const c=o.key,g=this._distanceTileDataCache;if(g[c])return g[c];const y=o.canonical,x=1/this.height,E=this.cameraWorldSize/this.zoomScale(y.z),T=(y.x+Math.pow(2,y.z)*o.wrap)*E,P=y.y*E,F=this.point,R=this.angle,z=Math.sin(-R),j=-Math.cos(-R);return g[c]={bearing:[z,j],center:[(F.x-T)*x,(F.y-P)*x],scale:E/d.EXTENT*x},g[c]}calculateFogTileMatrix(o){const c=o.key,g=this._fogTileMatrixCache;if(g[c])return g[c];const y=this.calculatePosMatrix(o,this.cameraWorldSize);return d.multiply$1(y,this.worldToFogMatrix,y),g[c]=new Float32Array(y),g[c]}calculateProjMatrix(o,c=!1){const g=o.key,y=c?this._alignedProjMatrixCache:this._projMatrixCache;if(y[g])return y[g];const x=this.calculatePosMatrix(o,this.worldSize);return d.multiply$1(x,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,x),y[g]=new Float32Array(x),y[g]}calculatePixelsToTileUnitsMatrix(o){const c=o.tileID.key,g=this._pixelsToTileUnitsCache;if(g[c])return g[c];const y=function(x,E){const{scale:T}=x.tileTransform,P=T*d.EXTENT/(x.tileSize*Math.pow(2,E.zoom-x.tileID.overscaledZ+x.tileID.canonical.z));return F=new Float32Array(4),j=(R=E.inverseAdjustmentMatrix)[1],Z=R[2],H=R[3],oe=(z=[P,P])[1],F[0]=R[0]*(W=z[0]),F[1]=j*W,F[2]=Z*oe,F[3]=H*oe,F;var F,R,z,j,Z,H,W,oe}(o,this);return g[c]=y,g[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const c=d.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(c),y=this._camera.forward(),x=d.mercatorZfromAltitude(1,this._center.lat);g[2]/=x,y[2]/=x,d.normalize(y,y);const E=o.raycast(g,y,o.exaggeration());if(E){const T=d.scaleAndAdd([],g,y,E),P=new d.MercatorCoordinate(T[0],T[1],d.mercatorZfromAltitude(T[2],d.latFromMercatorY(T[1]))),F=(P.z+d.length([P.x-g[0],P.y-g[1],P.z-g[2]*x]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(F),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const c=d.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(c),y=o.getAtPointOrZero(new d.MercatorCoordinate(...g)),x=this._minimumHeightOverTerrain()*Math.cos(d.degToRad(this._maxPitch)),E=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*y;if(E<x){const T=this.locationCoordinate(this._center,this._centerAltitude),P=[T.x-g[0],T.y-g[1],T.z-g[2]],F=d.length(P);P[2]-=(x-E)/this._projectionScaler;const R=d.length(P);if(0===R)return;d.scale$2(P,P,F/R*this._projectionScaler),this._camera.position=[T.x-P[0],T.y-P[1],T.z*this._projectionScaler-P[2]],this._camera.orientation=Su(P,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const z=this.center;return z.lat=d.clamp(z.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(z.lng=d.clamp(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}const o=this._unmodified,{x:c,y:g}=this.point;let y=0,x=c,E=g;const T=this.width/2,P=this.height/2,F=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(g-P<F&&(E=F+P),g+P>R&&(E=R-P),R-F<this.height&&(y=Math.max(y,this.height/(R-F)),E=(R+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const z=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,Z=this.worldSize/2-(z+j)/2;x=(c+Z+this.worldSize)%this.worldSize-Z,x-T<z&&(x=z+T),x+T>j&&(x=j-T),j-z<this.width&&(y=Math.max(y,this.width/(j-z)),x=(j+z)/2)}x===c&&E===g||(this.center=this.unproject(new d.pointGeometry(x,E))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCameraAltitude(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this._fov/2,c=this.centerOffset,g=this.pixelsPerMeter;this._projectionScaler=g/(d.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(o)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?g:1),x=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);x[8]=2*-c.x/this.width,x[9]=2*c.y/this.height;let E=d.mul([],x,y);if(this.projection.isReprojectedInTileSpace){const te=this.locationCoordinate(this.center),re=d.identity([]);d.translate(re,re,[te.x*this.worldSize,te.y*this.worldSize,0]),d.multiply$1(re,re,dp(this)),d.translate(re,re,[-te.x*this.worldSize,-te.y*this.worldSize,0]),d.multiply$1(E,E,re),this.inverseAdjustmentMatrix=function(se){const ge=dp(se,!0);return Ke([],[ge[0],ge[1],ge[4],ge[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=d.scale([],E,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=E,this.invProjMatrix=d.invert(new Float64Array(16),this.projMatrix);const T=new Float32Array(16);d.identity(T),d.scale(T,T,[1,-1,1]),d.rotateX(T,T,this._pitch),d.rotateZ(T,T,this.angle);const P=d.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),F=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;P[8]=2*-c.x/this.width,P[9]=2*(c.y+F)/this.height,this.skyboxMatrix=d.multiply$1(T,P,T);const R=this.point,z=R.x,j=R.y,Z=this.width%2/2,H=this.height%2/2,W=Math.cos(this.angle),oe=Math.sin(this.angle),$=z-Math.round(z)+W*Z+oe*H,ne=j-Math.round(j)+W*H+oe*Z,ee=new Float64Array(E);if(d.translate(ee,ee,[$>.5?$-1:$,ne>.5?ne-1:ne,0]),this.alignedProjMatrix=ee,E=d.create(),d.scale(E,E,[this.width/2,-this.height/2,1]),d.translate(E,E,[1,-1,0]),this.labelPlaneMatrix=E,E=d.create(),d.scale(E,E,[1,-1,1]),d.translate(E,E,[-1,-1,0]),d.scale(E,E,[2/this.width,2/this.height,1]),this.glCoordMatrix=E,this.pixelMatrix=d.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},E=d.invert(new Float64Array(16),this.pixelMatrix),!E)throw new Error("failed to invert matrix");this.pixelMatrixInverse=E,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSize,c=this.cameraPixelsPerMeter,g=this._camera.position,y=1/this.height,x=[o,o,c];d.scale$2(x,x,y),d.scale$2(g,g,-1),d.multiply$2(g,g,x);const E=d.create();d.translate(E,E,g),d.scale(E,E,x),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,c,y)}_computeCameraPosition(o){const c=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),y=this.point,x=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*c-o/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-g[0]*x,y.y/this.worldSize-g[1]*x,o/this.worldSize*this._centerAltitude-g[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=o[2];let y=1;g>0&&(y=Math.min((c-this._camera.position[2])/g,1)),this._camera.position=d.scaleAndAdd([],this._camera.position,o,y),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,c=this._camera.forward(),{pitch:g,bearing:y}=this._camera.getPitchBearing(),x=d.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(d.degToRad(this._maxPitch)),T=Math.max((o[2]-x)/Math.cos(g),E),P=this._zoomFromMercatorZ(T);d.scaleAndAdd(o,o,c,T),this._pitch=d.clamp(g,d.degToRad(this.minPitch),d.degToRad(this.maxPitch)),this.angle=d.wrap(y,-Math.PI,Math.PI),this._setZoom(d.clamp(P,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new d.MercatorCoordinate(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(d.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(o,c){const g=Math.min(o.x,c.x),y=Math.max(o.x,c.x),x=Math.min(o.y,c.y),E=Math.max(o.y,c.y);if(x<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const T=[new d.pointGeometry(g,x),new d.pointGeometry(y,E),new d.pointGeometry(g,E),new d.pointGeometry(y,x)],P=this.renderWorldCopies?-3:0,F=this.renderWorldCopies?4:1;for(const R of T){const z=this.pointRayIntersection(R);if(z.t<0)return!0;const j=this.rayIntersectionCoordinate(z);if(j.x<P||j.y<0||j.x>F||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+d.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new d.pointGeometry(0,0),new d.pointGeometry(this.width,this.height))}zoomDeltaToMovement(o,c){const g=d.length(d.sub([],this._camera.position,o)),y=this._zoomFromMercatorZ(g)+c;return g-this._mercatorZfromZoom(y)}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.pointGeometry(0,o))}}function la(f,o){let c=!1,g=null;const y=()=>{g=null,c&&(f(),g=setTimeout(y,o),c=!1)};return()=>(c=!0,g||y(),g)}class pp{constructor(o){this._hashName=o&&encodeURIComponent(o),d.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=la(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,d.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return d.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const c=this._map.getCenter(),g=Math.round(100*this._map.getZoom())/100,y=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,y),E=Math.round(c.lng*x)/x,T=Math.round(c.lat*x)/x,P=this._map.getBearing(),F=this._map.getPitch();let R="";if(R+=o?`/${E}/${T}/${g}`:`${g}/${T}/${E}`,(P||F)&&(R+="/"+Math.round(10*P)/10),F&&(R+=`/${Math.round(F)}`),this._hashName){const z=this._hashName;let j=!1;const Z=d.window.location.hash.slice(1).split("&").map(H=>{const W=H.split("=")[0];return W===z?(j=!0,`${W}=${R}`):H}).filter(H=>H);return j||Z.push(`${z}=${R}`),`#${Z.join("&")}`}return`#${R}`}_getCurrentHash(){const o=d.window.location.hash.replace("#","");if(this._hashName){let c;return o.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(c=g)}),(c&&c[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._getCurrentHash();if(o.length>=3&&!o.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:c,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=d.window.location.href.replace(/(#.+)?$/,this.getHashString());d.window.history.replaceState(d.window.history.state,null,o)}}const Ts={linearity:.3,easing:d.bezier(0,0,.3,1)},Bl=d.extend({deceleration:2500,maxSpeed:1400},Ts),fp=d.extend({deceleration:20,maxSpeed:1400},Ts),Hh=d.extend({deceleration:1e3,maxSpeed:360},Ts),Yt=d.extend({deceleration:1e3,maxSpeed:90},Ts);class qa{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,c=d.exported.now();for(;o.length>0&&c-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new d.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)c.zoom+=x.zoomDelta||0,c.bearing+=x.bearingDelta||0,c.pitch+=x.pitchDelta||0,x.panDelta&&c.pan._add(x.panDelta),x.around&&(c.around=x.around),x.pinchAround&&(c.pinchAround=x.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){const x=Ic(c.pan.mag(),g,d.extend({},Bl,o||{}));y.offset=c.pan.mult(x.amount/c.pan.mag()),y.center=this._map.transform.center,Pu(y,x)}if(c.zoom){const x=Ic(c.zoom,g,fp);y.zoom=this._map.transform.zoom+x.amount,Pu(y,x)}if(c.bearing){const x=Ic(c.bearing,g,Hh);y.bearing=this._map.transform.bearing+d.clamp(x.amount,-179,179),Pu(y,x)}if(c.pitch){const x=Ic(c.pitch,g,Yt);y.pitch=this._map.transform.pitch+x.amount,Pu(y,x)}if(y.zoom||y.bearing){const x=void 0===c.pinchAround?c.around:c.pinchAround;y.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),d.extend(y,{noMoveStart:!0})}}function Pu(f,o){(!f.duration||f.duration<o.duration)&&(f.duration=o.duration,f.easing=o.easing)}function Ic(f,o,c){const{maxSpeed:g,linearity:y,deceleration:x}=c,E=d.clamp(f*y/(o/1e3),-g,g),T=Math.abs(E)/(x*y);return{easing:c.easing,duration:1e3*T,amount:E*(T/2)}}class Nr extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,g,y={}){const x=Ae.mousePos(c.getCanvasContainer(),g),E=c.unproject(x);super(o,d.extend({point:x,lngLat:E,originalEvent:g},y)),this._defaultPrevented=!1,this.target=c}}class Ao extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,g){const y="touchend"===o?g.changedTouches:g.touches,x=Ae.touchPos(c.getCanvasContainer(),y),E=x.map(P=>c.unproject(P)),T=x.reduce((P,F,R,z)=>P.add(F.div(z.length)),new d.pointGeometry(0,0));super(o,{points:x,point:T,lngLats:E,lngLat:c.unproject(T),originalEvent:g}),this._defaultPrevented=!1}}class mp extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,g){super(o,{originalEvent:g}),this._defaultPrevented=!1}}class Po{constructor(o,c){this._map=o,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new mp(o.type,this._map,o))}mousedown(o,c){return this._mousedownPos=c,this._firePreventable(new Nr(o.type,this._map,o))}mouseup(o){this._map.fire(new Nr(o.type,this._map,o))}preclick(o){const c=d.extend({},o);c.type="preclick",this._map.fire(new Nr(c.type,this._map,c))}click(o,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Nr(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Nr(o.type,this._map,o))}mouseover(o){this._map.fire(new Nr(o.type,this._map,o))}mouseout(o){this._map.fire(new Nr(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Ao(o.type,this._map,o))}touchmove(o){this._map.fire(new Ao(o.type,this._map,o))}touchend(o){this._map.fire(new Ao(o.type,this._map,o))}touchcancel(o){this._map.fire(new Ao(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qh{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(o){this._map.fire(new Nr(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Nr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Nr(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ku{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,c){this.isEnabled()&&o.shiftKey&&0===o.button&&(Ae.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(o,c){if(!this._active)return;const g=c;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=g,this._box||(this._box=Ae.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const x=Math.min(y.x,g.x),E=Math.max(y.x,g.x),T=Math.min(y.y,g.y),P=Math.max(y.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${T}px)`,this._box.style.width=E-x+"px",this._box.style.height=P-T+"px")})}mouseupWindow(o,c){if(!this._active||0!==o.button)return;const g=this._startPos,y=c;if(this.reset(),Ae.suppressClick(),g.x!==y.x||g.y!==y.y)return this._map.fire(new d.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:x=>x.fitScreenCoordinates(g,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&27===o.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ae.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,c){return this._map.fire(new d.Event(o,{originalEvent:c}))}}function Za(f,o){const c={};for(let g=0;g<f.length;g++)c[f[g].identifier]=o[g];return c}class Wa{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,c,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=o.timeStamp),g.length===this.numTouches&&(this.centroid=function(y){const x=new d.pointGeometry(0,0);for(const E of y)x._add(E);return x.div(y.length)}(c),this.touches=Za(g,c)))}touchmove(o,c,g){if(this.aborted||!this.centroid)return;const y=Za(g,c);for(const x in this.touches){const E=this.touches[x],T=y[x];(!T||T.dist(E)>30)&&(this.aborted=!0)}}touchend(o,c,g){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),0===g.length){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Xa{constructor(o){this.singleTap=new Wa(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,c,g){this.singleTap.touchstart(o,c,g)}touchmove(o,c,g){this.singleTap.touchmove(o,c,g)}touchend(o,c,g){const y=this.singleTap.touchend(o,c,g);if(y){const x=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(y)<30;if(x&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Fu{constructor(){this._zoomIn=new Xa({numTouches:1,numTaps:2}),this._zoomOut=new Xa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,c,g){this._zoomIn.touchstart(o,c,g),this._zoomOut.touchstart(o,c,g)}touchmove(o,c,g){this._zoomIn.touchmove(o,c,g),this._zoomOut.touchmove(o,c,g)}touchend(o,c,g){const y=this._zoomIn.touchend(o,c,g),x=this._zoomOut.touchend(o,c,g);return y?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(y)},{originalEvent:o})}):x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(x)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ac={0:1,2:2};class Ka{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(o,c){return!1}_move(o,c){return{}}mousedown(o,c){if(this._lastPoint)return;const g=Ae.mouseButton(o);this._correctButton(o,g)&&(this._lastPoint=c,this._eventButton=g)}mousemoveWindow(o,c){const g=this._lastPoint;if(g)if(o.preventDefault(),function(y,x){const E=Ac[x];return void 0===y.buttons||(y.buttons&E)!==E}(o,this._eventButton))this.reset();else if(this._moved||!(c.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(g,c)}mouseupWindow(o){this._lastPoint&&Ae.mouseButton(o)===this._eventButton&&(this._moved&&Ae.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yr extends Ka{mousedown(o,c){super.mousedown(o,c),this._lastPoint&&(this._active=!0)}_correctButton(o,c){return 0===c&&!o.ctrlKey}_move(o,c){return{around:c,panDelta:c.sub(o)}}}class mi extends Ka{_correctButton(o,c){return 0===c&&o.ctrlKey||2===c}_move(o,c){const g=.8*(c.x-o.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(o){o.preventDefault()}}class Ru extends Ka{_correctButton(o,c){return 0===c&&o.ctrlKey||2===c}_move(o,c){const g=-.5*(c.y-o.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(o){o.preventDefault()}}class Pc{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),d.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new d.pointGeometry(0,0)}touchstart(o,c,g){return this._calculateTransform(o,c,g)}touchmove(o,c,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===g.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.preventDefault(),this._calculateTransform(o,c,g)}}touchend(o,c,g){this._calculateTransform(o,c,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,c,g){g.length>0&&(this._active=!0);const y=Za(g,c),x=new d.pointGeometry(0,0),E=new d.pointGeometry(0,0);let T=0;for(const F in y){const R=y[F],z=this._touches[F];z&&(x._add(R),E._add(R.sub(z)),T++,y[F]=R)}if(this._touches=y,T<this._minTouches||!E.mag())return;const P=E.div(T);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(T),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ae.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class kc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(o){}_move(o,c,g){return{}}touchstart(o,c,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([c[0],c[1]]))}touchmove(o,c,g){if(!this._firstTwoTouches)return;o.preventDefault();const[y,x]=this._firstTwoTouches,E=Jo(g,c,y),T=Jo(g,c,x);if(!E||!T)return;const P=this._aroundCenter?null:E.add(T).div(2);return this._move([E,T],P,o)}touchend(o,c,g){if(!this._firstTwoTouches)return;const[y,x]=this._firstTwoTouches,E=Jo(g,c,y),T=Jo(g,c,x);E&&T||(this._active&&Ae.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Jo(f,o,c){for(let g=0;g<f.length;g++)if(f[g].identifier===c)return o[g]}function Nl(f,o){return Math.log(f/o)/Math.LN2}class Fc extends kc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,c){const g=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Nl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Nl(this._distance,g),pinchAround:c}}}function Ja(f,o){return 180*f.angleWith(o)/Math.PI}class Lu extends kc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,c){const g=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ja(this._vector,g),pinchAround:c}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const c=25/(Math.PI*this._minDiameter)*360,g=Ja(o,this._startVector);return Math.abs(g)<c}}function Fn(f){return Math.abs(f.y)>Math.abs(f.x)}class Ou extends kc{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(o){this._lastPoints=o,Fn(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,c,g){const y=o[0].sub(this._lastPoints[0]),x=o[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&g.touches.length<3)&&(this._valid=this.gestureBeginsVertically(y,x,g.timeStamp),this._valid))return this._lastPoints=o,this._active=!0,{pitchDelta:(y.y+x.y)/2*-.5}}gestureBeginsVertically(o,c,g){if(void 0!==this._valid)return this._valid;const y=o.mag()>=2,x=c.mag()>=2;if(!y&&!x)return;if(!y||!x)return void 0===this._firstMove&&(this._firstMove=g),g-this._firstMove<100&&void 0;const E=o.y>0==c.y>0;return Fn(o)&&Fn(c)&&E}}const Ya={panStep:100,bearingStep:15,pitchStep:10};class ir{constructor(){const o=Ya;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let c=0,g=0,y=0,x=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:o.shiftKey?g=-1:(o.preventDefault(),x=-1);break;case 39:o.shiftKey?g=1:(o.preventDefault(),x=1);break;case 38:o.shiftKey?y=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?y=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(g=0,y=0),{cameraAnimation:T=>{const P=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:gp,zoom:c?Math.round(P)+c*(o.shiftKey?2:1):P,bearing:T.getBearing()+g*this._bearingStep,pitch:T.getPitch()+y*this._pitchStep,offset:[-x*this._panStep,-E*this._panStep],center:T.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function gp(f){return f*(2-f)}const Zh=4.000244140625;class ca{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,d.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=o.deltaMode===d.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const g=d.exported.now(),y=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,0!==c&&c%Zh==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),o.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=o,this._delta-=c,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Ae.mousePos(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform,c=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(0!==this._delta){const P="wheel"===this._type&&Math.abs(this._delta)>Zh?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&0!==F&&(F=1/F);const R=c(),z=Math.pow(2,R),j="number"==typeof this._targetZoom?o.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(j*F))),"wheel"===this._type&&(this._startZoom=c(),this._easing=this._smoothOutEasing(200)),this._delta=0}const g="number"==typeof this._targetZoom?this._targetZoom:c(),y=this._startZoom,x=this._easing;let E,T=!1;if("wheel"===this._type&&y&&x){const P=Math.min((d.exported.now()-this._lastWheelEventTime)/200,1),F=x(P);E=d.number(y,g,F),P<1?this._frameId||(this._frameId=!0):T=!0}else E=g,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:E-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let c=d.ease;if(this._prevEase){const g=this._prevEase,y=(d.exported.now()-g.start)/g.duration,x=g.easing(y+.01)-g.easing(y),E=.27/Math.sqrt(x*x+1e-4)*.01,T=Math.sqrt(.0729-E*E);c=d.bezier(E,T,.25,1)}return this._prevEase={start:d.exported.now(),duration:o,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ae.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(d.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!d.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class gi{constructor(o,c){this._clickZoom=o,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,c){return o.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(o.shiftKey?-1:1),around:g.unproject(c)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rc{constructor(){this._tap=new Xa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(o,c,g){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=c[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(o,c,g))}touchmove(o,c,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const y=c[0],x=y.y-this._swipePoint.y;return this._swipePoint=y,o.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(o,c,g)}touchend(o,c,g){this._tapTime?this._swipePoint&&0===g.length&&this.reset():this._tap.touchend(o,c,g)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yo{constructor(o,c,g){this._el=o,this._mousePan=c,this._touchPan=g}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qr{constructor(o,c,g){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=c,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class zu{constructor(o,c,g,y){this._el=o,this._touchZoom=c,this._touchRotate=g,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ua=f=>f.zoom||f.drag||f.pitch||f.rotate;class Xh extends d.Event{}class Qo{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,c){const g=d.sub([],c,o);this.radius=d.length(g[2]<0?d.div([],g,this.constants):[g[0],g[1],0])}projectRay(o){d.div(o,o,this.constants),d.normalize(o,o),d.mul$1(o,o,this.constants);const c=d.scale$2([],o,this.radius);if(c[2]>0){const g=d.scale$2([],[0,0,1],d.dot(c,[0,0,1])),y=d.scale$2([],d.normalize([],[c[0],c[1],0]),this.radius),x=d.add([],c,d.scale$2([],d.sub([],d.add([],y,g),c),2));c[0]=x[0],c[1]=x[1]}return c}}function Qa(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Ms{constructor(o,c){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qa(o),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Qo,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),d.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[d.window.document,"mousemove",{capture:!0}],[d.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[d.window,"blur",void 0]];for(const[y,x,E]of this._listeners)y.addEventListener(x,y===d.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[o,c,g]of this._listeners)o.removeEventListener(c,o===d.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(o){const c=this._map,g=c.getCanvasContainer();this._add("mapEvent",new Po(c,o));const y=c.boxZoom=new ku(c,o);this._add("boxZoom",y);const x=new Fu,E=new Wh;c.doubleClickZoom=new gi(E,x),this._add("tapZoom",x),this._add("clickZoom",E);const T=new Rc;this._add("tapDragZoom",T);const P=c.touchPitch=new Ou(c);this._add("touchPitch",P);const F=new mi(o),R=new Ru(o);c.dragRotate=new Qr(o,F,R),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const z=new Yr(o),j=new Pc(c,o);c.dragPan=new Yo(g,z,j),this._add("mousePan",z),this._add("touchPan",j,["touchZoom","touchRotate"]);const Z=new Lu,H=new Fc;c.touchZoomRotate=new zu(g,H,Z,T),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),this._add("blockableMapEvent",new qh(c));const W=c.scrollZoom=new ca(c,this);this._add("scrollZoom",W,["mousePan"]);const oe=c.keyboard=new ir;this._add("keyboard",oe);for(const $ of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[$]&&c[$].enable(o[$])}_add(o,c,g){this._handlers.push({handlerName:o,handler:c,allowed:g}),this._handlersById[o]=c}stop(o){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(ua(this._eventsInProgress))||this.isZooming()}_blockedByActive(o,c,g){for(const y in o)if(y!==g&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const c=[];for(const g of o)this._el.contains(g.target)&&c.push(g);return c}handleEvent(o,c){this._updatingCamera=!0;const g="renderFrame"===o.type,y=g?void 0:o,x={needsRenderFrame:!1},E={},T={},P=o.touches?this._getMapTouches(o.touches):void 0,F=P?Ae.touchPos(this._el,P):g?void 0:Ae.mousePos(this._el,o);for(const{handlerName:j,handler:Z,allowed:H}of this._handlers){if(!Z.isEnabled())continue;let W;this._blockedByActive(T,H,j)?Z.reset():Z[c||o.type]&&(W=Z[c||o.type](o,F,P),this.mergeHandlerResult(x,E,W,j,y),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||Z.isActive())&&(T[j]=Z)}const R={};for(const j in this._previousActiveHandlers)T[j]||(R[j]=y);this._previousActiveHandlers=T,(Object.keys(R).length||Qa(x))&&(this._changes.push([x,E,R]),this._triggerRenderFrame()),(Object.keys(T).length||Qa(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=x;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(o,c,g,y,x){if(!g)return;d.extend(o,g);const E={handlerName:y,originalEvent:g.originalEvent||x};void 0!==g.zoomDelta&&(c.zoom=E),void 0!==g.panDelta&&(c.drag=E),void 0!==g.pitchDelta&&(c.pitch=E),void 0!==g.bearingDelta&&(c.rotate=E)}_applyChanges(){const o={},c={},g={};for(const[y,x,E]of this._changes)y.panDelta&&(o.panDelta=(o.panDelta||new d.pointGeometry(0,0))._add(y.panDelta)),y.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+y.pitchDelta),void 0!==y.around&&(o.around=y.around),void 0!==y.aroundCoord&&(o.aroundCoord=y.aroundCoord),void 0!==y.pinchAround&&(o.pinchAround=y.pinchAround),y.noInertia&&(o.noInertia=y.noInertia),d.extend(c,x),d.extend(g,E);this._updateMapTransform(o,c,g),this._changes=[]}_updateMapTransform(o,c,g){const y=this._map,x=y.transform,E=ne=>[ne.x,ne.y,ne.z];if((ne=>{const ee=this._eventsInProgress.drag;return ee&&!this._handlersById[ee.handlerName].isActive()})()&&!Qa(o)){const ne=x.zoom;x.cameraElevationReference="sea",x.recenterOnTerrain(),x.cameraElevationReference="ground",ne!==x.zoom&&this._map._update(!0)}if(!Qa(o))return this._fireEvents(c,g,!0);let{panDelta:T,zoomDelta:P,bearingDelta:F,pitchDelta:R,around:z,aroundCoord:j,pinchAround:Z}=o;void 0!==Z&&(z=Z),(ne=>c.drag&&!this._eventsInProgress.drag)()&&z&&(this._dragOrigin=E(x.pointCoordinate3D(z)),this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",y._stop(!0),z=z||y.transform.centerPoint,F&&(x.bearing+=F),R&&(x.pitch+=R),x._updateCameraState();const H=[0,0,0];if(T){const ne=x.pointCoordinate(z),ee=x.pointCoordinate(z.sub(T));ne&&ee&&(H[0]=ee.x-ne.x,H[1]=ee.y-ne.y)}const W=x.zoom,oe=[0,0,0];if(P){const ne=E(j||x.pointCoordinate3D(z)),ee={dir:d.normalize([],d.sub([],ne,x._camera.position))};if(ee.dir[2]<0){const te=x.zoomDeltaToMovement(ne,P);d.scale$2(oe,ee.dir,te)}}const $=d.add(H,H,oe);x._translateCameraConstrained($),P&&Math.abs(x.zoom-W)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(c,g,!0)}_fireEvents(o,c,g){const y=ua(this._eventsInProgress),x=ua(o),E={};for(const R in o){const{originalEvent:z}=o[R];this._eventsInProgress[R]||(E[`${R}start`]=z),this._eventsInProgress[R]=o[R]}!y&&x&&this._fireEvent("movestart",x.originalEvent);for(const R in E)this._fireEvent(R,E[R]);x&&this._fireEvent("move",x.originalEvent);for(const R in o){const{originalEvent:z}=o[R];this._fireEvent(R,z)}const T={};let P;for(const R in this._eventsInProgress){const{handlerName:z,originalEvent:j}=this._eventsInProgress[R];this._handlersById[z].isActive()||(delete this._eventsInProgress[R],P=c[z]||j,T[`${R}end`]=P)}for(const R in T)this._fireEvent(R,T[R]);const F=ua(this._eventsInProgress);if(g&&(y||x)&&!F){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=j=>0!==j&&-this._bearingSnap<j&&j<this._bearingSnap;R?(z(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:P})):(this._map.fire(new d.Event("moveend",{originalEvent:P})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,c){this._map.fire(new d.Event(o,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new Xh("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const bt="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class _p extends d.Evented{constructor(o,c){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=c.bearingSnap,d.bindAll(["_renderFrameCallback"],this)}getCenter(){return new d.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,c){return this.jumpTo({center:o},c)}panBy(o,c,g){return o=d.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,d.extend({offset:o},c),g)}panTo(o,c,g){return this.easeTo(d.extend({center:o},c),g)}getZoom(){return this.transform.zoom}setZoom(o,c){return this.jumpTo({zoom:o},c),this}zoomTo(o,c,g){return this.easeTo(d.extend({zoom:o},c),g)}zoomIn(o,c){return this.zoomTo(this.getZoom()+1,o,c),this}zoomOut(o,c){return this.zoomTo(this.getZoom()-1,o,c),this}getBearing(){return this.transform.bearing}setBearing(o,c){return this.jumpTo({bearing:o},c),this}getPadding(){return this.transform.padding}setPadding(o,c){return this.jumpTo({padding:o},c),this}rotateTo(o,c,g){return this.easeTo(d.extend({bearing:o},c),g)}resetNorth(o,c){return this.rotateTo(0,d.extend({duration:1e3},o),c),this}resetNorthPitch(o,c){return this.easeTo(d.extend({bearing:0,pitch:0,duration:1e3},o),c),this}snapToNorth(o,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,c):this}getPitch(){return this.transform.pitch}setPitch(o,c){return this.jumpTo({pitch:o},c),this}cameraForBounds(o,c){o=d.LngLatBounds.convert(o);const g=c&&c.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),g,c)}_extendCameraOptions(o){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(o=d.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding){const g=o.padding;o.padding={top:g,bottom:g,right:g,left:g}}return o.padding=d.extend(c,o.padding),o}_cameraForBoxAndBearing(o,c,g,y){const x=this._extendCameraOptions(y),E=this.transform,T=E.padding,P=E.project(d.LngLat.convert(o)),F=E.project(d.LngLat.convert(c)),R=P.rotate(-d.degToRad(g)),z=F.rotate(-d.degToRad(g)),j=new d.pointGeometry(Math.max(R.x,z.x),Math.max(R.y,z.y)),Z=new d.pointGeometry(Math.min(R.x,z.x),Math.min(R.y,z.y)),H=j.sub(Z),W=(E.width-(T.left+T.right+x.padding.left+x.padding.right))/H.x,oe=(E.height-(T.top+T.bottom+x.padding.top+x.padding.bottom))/H.y;if(oe<0||W<0)return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const $=Math.min(E.scaleZoom(E.scale*Math.min(W,oe)),x.maxZoom),ne="number"==typeof x.offset.x?new d.pointGeometry(x.offset.x,x.offset.y):d.pointGeometry.convert(x.offset),ee=new d.pointGeometry((x.padding.left-x.padding.right)/2,(x.padding.top-x.padding.bottom)/2).rotate(g*Math.PI/180),te=ne.add(ee).mult(E.scale/E.zoomScale($));return{center:E.unproject(P.add(F).div(2).sub(te)),zoom:$,bearing:g}}_cameraForBox(o,c,g,y,x){const E=this._extendCameraOptions(x);g=g||0,y=y||0,o=d.LngLat.convert(o),c=d.LngLat.convert(c);const T=this.transform.clone();T.padding=E.padding;const P=this.getFreeCameraOptions(),F=new d.LngLat(.5*(o.lng+c.lng),.5*(o.lat+c.lat)),R=.5*(g+y);if(T._camera.position[2]<d.mercatorZfromAltitude(R,F.lat))return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");P.lookAtPoint(F),T.setFreeCameraOptions(P);const z=d.MercatorCoordinate.fromLngLat(o),j=d.MercatorCoordinate.fromLngLat(c),Z=T.pointRayIntersection(T.centerPoint,R),H=[(W=T.rayIntersectionCoordinate(Z)).x,W.y,W.z];var W;const oe=T.screenPointToMercatorRay(T.centerPoint),$="globe"!==T.projection.name;let ne,ee=0;do{const te=Math.floor(T.zoom),re=1<<te,se=Math.min(re*z.x,re*j.x),ge=Math.min(re*z.y,re*j.y),xe=Math.max(re*z.x,re*j.x),Ue=Math.max(re*z.y,re*j.y),Re=new d.Aabb([se,ge,g],[xe,Ue,y]),ke=d.Frustum.fromInvProjectionMatrix(T.invProjMatrix,T.worldSize,te,$);if(2!==Re.intersects(ke)){ne&&(T._camera.position=d.scaleAndAdd([],T._camera.position,oe.dir,-ne),T._updateStateFromCamera());break}const be=d.sub([],T._camera.position,H);ne=.5*d.length(be),T._camera.position=d.scaleAndAdd([],T._camera.position,oe.dir,ne);try{T._updateStateFromCamera()}catch(ve){return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ee<10);return{center:T.center,zoom:T.zoom,bearing:T.bearing,pitch:T.pitch}}fitBounds(o,c,g){return this._fitInternal(this.cameraForBounds(o,c),c,g)}_raycastElevationBox(o,c){const g=this.transform.elevation;if(!g)return;const y=new d.pointGeometry(o.x,c.y),x=new d.pointGeometry(c.x,o.y),E=g.pointCoordinate(o);if(!E)return;const T=g.pointCoordinate(c);if(!T)return;const P=g.pointCoordinate(y);if(!P)return;const F=g.pointCoordinate(x);if(!F)return;const R=new d.MercatorCoordinate(E[0],E[1]).toLngLat(),z=new d.MercatorCoordinate(T[0],T[1]).toLngLat(),j=new d.MercatorCoordinate(P[0],P[1]).toLngLat(),Z=new d.MercatorCoordinate(F[0],F[1]).toLngLat(),H=Math.min(R.lng,Math.min(z.lng,Math.min(j.lng,Z.lng))),W=Math.min(R.lat,Math.min(z.lat,Math.min(j.lat,Z.lat))),oe=Math.max(R.lng,Math.max(z.lng,Math.max(j.lng,Z.lng))),$=Math.max(R.lat,Math.max(z.lat,Math.max(j.lat,Z.lat))),ne=Math.min(E[3],Math.min(T[3],Math.min(P[3],F[3]))),ee=Math.max(E[3],Math.max(T[3],Math.max(P[3],F[3])));return{minLngLat:new d.LngLat(H,W),maxLngLat:new d.LngLat(oe,$),minAltitude:ne,maxAltitude:ee}}fitScreenCoordinates(o,c,g,y,x){let E,T,P,F;const R=d.pointGeometry.convert(o),z=d.pointGeometry.convert(c),j=this._raycastElevationBox(R,z);if(j)E=j.minLngLat,T=j.maxLngLat,P=j.minAltitude,F=j.maxAltitude;else{if(this.transform.anyCornerOffEdge(R,z))return this;E=this.transform.pointLocation(R),T=this.transform.pointLocation(z)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(d.pointGeometry.convert(o)),this.transform.pointLocation(d.pointGeometry.convert(c)),g,y):this._cameraForBox(E,T,P,F,y),y,x)}_fitInternal(o,c,g){return o?(delete(c=d.extend(o,c)).padding,c.linear?this.easeTo(c,g):this.flyTo(c,g)):this}jumpTo(o,c){this.stop();const g=o.preloadOnly?this.transform.clone():this.transform;let y=!1,x=!1,E=!1;return"zoom"in o&&g.zoom!==+o.zoom&&(y=!0,g.zoom=+o.zoom),void 0!==o.center&&(g.center=d.LngLat.convert(o.center)),"bearing"in o&&g.bearing!==+o.bearing&&(x=!0,g.bearing=+o.bearing),"pitch"in o&&g.pitch!==+o.pitch&&(E=!0,g.pitch=+o.pitch),null==o.padding||g.isPaddingEqual(o.padding)||(g.padding=o.padding),o.preloadOnly?(this._preloadTiles(g),this):(this.fire(new d.Event("movestart",c)).fire(new d.Event("move",c)),y&&this.fire(new d.Event("zoomstart",c)).fire(new d.Event("zoom",c)).fire(new d.Event("zoomend",c)),x&&this.fire(new d.Event("rotatestart",c)).fire(new d.Event("rotate",c)).fire(new d.Event("rotateend",c)),E&&this.fire(new d.Event("pitchstart",c)).fire(new d.Event("pitch",c)).fire(new d.Event("pitchend",c)),this.fire(new d.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||d.warnOnce(bt),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,c){const g=this.transform;if(!g.projection.supportsFreeCamera)return void d.warnOnce(bt);this.stop();const y=g.zoom,x=g.pitch,E=g.bearing;g.setFreeCameraOptions(o);const T=y!==g.zoom,P=x!==g.pitch,F=E!==g.bearing;return this.fire(new d.Event("movestart",c)).fire(new d.Event("move",c)),T&&this.fire(new d.Event("zoomstart",c)).fire(new d.Event("zoom",c)).fire(new d.Event("zoomend",c)),F&&this.fire(new d.Event("rotatestart",c)).fire(new d.Event("rotate",c)).fire(new d.Event("rotateend",c)),P&&this.fire(new d.Event("pitchstart",c)).fire(new d.Event("pitch",c)).fire(new d.Event("pitchend",c)),this.fire(new d.Event("moveend",c)),this}easeTo(o,c){this._stop(!1,o.easeId),(!1===(o=d.extend({offset:[0,0],duration:500,easing:d.ease},o)).animate||!o.essential&&d.exported.prefersReducedMotion)&&(o.duration=0);const g=this.transform,y=this.getZoom(),x=this.getBearing(),E=this.getPitch(),T=this.getPadding(),P="zoom"in o?+o.zoom:y,F="bearing"in o?this._normalizeBearing(o.bearing,x):x,R="pitch"in o?+o.pitch:E,z="padding"in o?o.padding:g.padding,j=d.pointGeometry.convert(o.offset);let Z=g.centerPoint.add(j);const H="globe"===g.projection.name?g.pointCoordinate(Z).toLngLat():g.pointLocation(Z),W=d.LngLat.convert(o.center||H);this._normalizeCenter(W);const oe=g.project(H),$=g.project(W).sub(oe),ne=g.zoomScale(P-y);let ee,te;o.around&&(ee=d.LngLat.convert(o.around),te=g.locationPoint(ee));const re=this._zooming||P!==y,se=this._rotating||x!==F,ge=this._pitching||R!==E,xe=!g.isPaddingEqual(z),Ue=ke=>be=>{if(re&&(ke.zoom=d.number(y,P,be)),se&&(ke.bearing=d.number(x,F,be)),ge&&(ke.pitch=d.number(E,R,be)),xe&&(ke.interpolatePadding(T,z,be),Z=ke.centerPoint.add(j)),ee)ke.setLocationAtPoint(ee,te);else{const ve=ke.zoomScale(ke.zoom-y),Fe=P>y?Math.min(2,ne):Math.max(.5,ne),Me=Math.pow(Fe,1-be),tt=ke.unproject(oe.add($.mult(be*Me)).mult(ve));ke.setLocationAtPoint(ke.renderWorldCopies?tt.wrap():tt,Z)}return o.preloadOnly||this._fireMoveEvents(c),ke};if(o.preloadOnly){const ke=this._emulate(Ue,o.duration,g);return this._preloadTiles(ke),this}const Re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=se,this._pitching=ge,this._padding=xe,this._easeId=o.easeId,this._prepareEase(c,o.noMoveStart,Re),this._ease(Ue(g),ke=>{g.recenterOnTerrain(),this._afterEase(c,ke)},o),this}_prepareEase(o,c,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||g.moving||this.fire(new d.Event("movestart",o)),this._zooming&&!g.zooming&&this.fire(new d.Event("zoomstart",o)),this._rotating&&!g.rotating&&this.fire(new d.Event("rotatestart",o)),this._pitching&&!g.pitching&&this.fire(new d.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new d.Event("move",o)),this._zooming&&this.fire(new d.Event("zoom",o)),this._rotating&&this.fire(new d.Event("rotate",o)),this._pitching&&this.fire(new d.Event("pitch",o))}_afterEase(o,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId,this.transform.cameraElevationReference="ground";const g=this._zooming,y=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new d.Event("zoomend",o)),y&&this.fire(new d.Event("rotateend",o)),x&&this.fire(new d.Event("pitchend",o)),this.fire(new d.Event("moveend",o))}flyTo(o,c){if(!o.essential&&d.exported.prefersReducedMotion){const je=d.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(je,c)}this.stop(),o=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},o);const g=this.transform,y=this.getZoom(),x=this.getBearing(),E=this.getPitch(),T=this.getPadding(),P="zoom"in o?d.clamp(+o.zoom,g.minZoom,g.maxZoom):y,F="bearing"in o?this._normalizeBearing(o.bearing,x):x,R="pitch"in o?+o.pitch:E,z="padding"in o?o.padding:g.padding,j=g.zoomScale(P-y),Z=d.pointGeometry.convert(o.offset);let H=g.centerPoint.add(Z);const W=g.pointLocation(H),oe=d.LngLat.convert(o.center||W);this._normalizeCenter(oe);const $=g.project(W),ne=g.project(oe).sub($);let ee=o.curve;const te=Math.max(g.width,g.height),re=te/j,se=ne.mag();if("minZoom"in o){const je=d.clamp(Math.min(o.minZoom,y,P),g.minZoom,g.maxZoom),st=te/g.zoomScale(je-y);ee=Math.sqrt(st/se*2)}const ge=ee*ee;function xe(je){const st=(re*re-te*te+(je?-1:1)*ge*ge*se*se)/(2*(je?re:te)*ge*se);return Math.log(Math.sqrt(st*st+1)-st)}function Ue(je){return(Math.exp(je)-Math.exp(-je))/2}function Re(je){return(Math.exp(je)+Math.exp(-je))/2}const ke=xe(0);let be=function(je){return Re(ke)/Re(ke+ee*je)},ve=function(je){return te*((Re(ke)*(Ue(st=ke+ee*je)/Re(st))-Ue(ke))/ge)/se;var st},Fe=(xe(1)-ke)/ee;if(Math.abs(se)<1e-6||!isFinite(Fe)){if(Math.abs(te-re)<1e-6)return this.easeTo(o,c);const je=re<te?-1:1;Fe=Math.abs(Math.log(re/te))/ee,ve=function(){return 0},be=function(st){return Math.exp(je*ee*st)}}o.duration="duration"in o?+o.duration:1e3*Fe/("screenSpeed"in o?+o.screenSpeed/ee:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const Me=x!==F,tt=R!==E,lt=!g.isPaddingEqual(z),Mt=je=>st=>{const mt=st*Fe,ln=1/be(mt);je.zoom=1===st?P:y+je.scaleZoom(ln),Me&&(je.bearing=d.number(x,F,st)),tt&&(je.pitch=d.number(E,R,st)),lt&&(je.interpolatePadding(T,z,st),H=je.centerPoint.add(Z));const _n=1===st?oe:je.unproject($.add(ne.mult(ve(mt))).mult(ln));return je.setLocationAtPoint(je.renderWorldCopies?_n.wrap():_n,H),je._updateCenterElevation(),o.preloadOnly||this._fireMoveEvents(c),je};if(o.preloadOnly){const je=this._emulate(Mt,o.duration,g);return this._preloadTiles(je),this}return this._zooming=!0,this._rotating=Me,this._pitching=tt,this._padding=lt,this._prepareEase(c,!1),this._ease(Mt(g),()=>this._afterEase(c),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,c)}if(!o){const g=this.handlers;g&&g.stop(!1)}return this}_ease(o,c,g){!1===g.animate||0===g.duration?(o(1),c()):(this._easeStart=d.exported.now(),this._easeOptions=g,this._onEaseFrame=o,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((d.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,c){o=d.wrap(o,-180,180);const g=Math.abs(o-c);return Math.abs(o-360-c)<g&&(o-=360),Math.abs(o+360-c)<g&&(o+=360),o}_normalizeCenter(o){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const g=o.lng-c.center.lng;o.lng+=g>180?-360:g<-180?360:0}_emulate(o,c,g){const y=Math.ceil(15*c/1e3),x=[],E=o(g.clone());for(let T=0;T<=y;T++){const P=E(T/y);x.push(P.clone())}return x}}class Bu{constructor(o={}){this.options=o,d.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const c=this.options&&this.options.compact;return this._map=o,this._container=Ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ae.create("button","mapboxgl-ctrl-attrib-button",this._container),Ae.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ae.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,c){const g=this._map._getUIString(`AttributionControl.${c}`);o.setAttribute("aria-label",g),o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.config.ACCESS_TOKEN}];if(o){const g=c.reduce((y,x,E)=>(x.value&&(y+=`${x.key}=${x.value}${E<c.length-1?"&":""}`),y),"?");o.href=`${d.config.FEEDBACK_URL}/${g}${this._map._hash?this._map._hash.getHashString(!0):""}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||"metadata"!==o.sourceDataType&&"visibility"!==o.sourceDataType&&"style"!==o.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const c=this._map.style._sourceCaches;for(const y in c){const x=c[y];if(x.used){const E=x.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o.sort((y,x)=>y.length-x.length),o=o.filter((y,x)=>{for(let E=x+1;E<o.length;E++)if(o[E].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const g=o.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,o.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Nu{constructor(){d.bindAll(["_updateLogo"],this),d.bindAll(["_updateCompact"],this)}onAdd(o){this._map=o,this._container=Ae.create("div","mapboxgl-ctrl");const c=Ae.create("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&"metadata"!==o.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(0===Object.entries(o).length)return!0;for(const c in o){const g=o[c].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const c=o[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Vu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const c=++this._id;return this._queue.push({callback:o,id:c,cancelled:!1}),c}remove(o){const c=this._currentlyRunning,g=c?this._queue.concat(c):this._queue;for(const y of g)if(y.id===o)return void(y.cancelled=!0)}run(o=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const g of c)if(!g.cancelled&&(g.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Lc(f,o,c){if(f=new d.LngLat(f.lng,f.lat),o){const g=new d.LngLat(f.lng-360,f.lat),y=new d.LngLat(f.lng+360,f.lat),x=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),E=c.locationPoint(f).distSqr(o),T=o.x<0||o.y<0||o.x>c.width||o.y>c.height;c.locationPoint(g).distSqr(o)<E&&(T||Math.abs(g.lng-c.center.lng)<x)?f=g:c.locationPoint(y).distSqr(o)<E&&(T||Math.abs(y.lng-c.center.lng)<x)&&(f=y)}for(;Math.abs(f.lng-c.center.lng)>180;){const g=c.locationPoint(f);if(g.x>=0&&g.y>=0&&g.x<=c.width&&g.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const Cr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ju extends d.Evented{constructor(o,c){if(super(),(o instanceof d.window.HTMLElement||c)&&(o=d.extend({element:o},c)),d.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&"auto"!==o.pitchAlignment?o.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),o&&o.element)this._element=o.element,this._offset=d.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ae.create("div");const y=41,x=27,E=Ae.createSVG("svg",{display:"block",height:y*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${y}`},this._element),T=Ae.createSVG("radialGradient",{id:"shadowGradient"},Ae.createSVG("defs",{},E));Ae.createSVG("stop",{offset:"10%","stop-opacity":.4},T),Ae.createSVG("stop",{offset:"100%","stop-opacity":.05},T),Ae.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),Ae.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),Ae.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),Ae.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=d.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const g=this._element.classList;for(const y in Cr)g.remove(`mapboxgl-marker-anchor-${y}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=d.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(24.6+y)],"bottom-right":[-y,-1*(24.6+y)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const c=o.code,g=o.charCode||o.keyCode;"Space"!==c&&"Enter"!==c&&32!==g&&13!==g||this.togglePopup()}_onMapClick(o){const c=o.originalEvent.target,g=this._element;this._popup&&(c===g||g.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const o=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(o))return void this._clearFadeTimer();const c=this._map.unproject(o);let g=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const x=this._map.getFreeCameraOptions();if(x.position){const E=x.position.toLngLat();g=E.distanceTo(c)<.9*E.distanceTo(this._lngLat)}}const y=(1-this._map._queryFogOpacity(c))*(g?.2:1);this._element.style.opacity=`${y}`,this._popup&&this._popup._setOpacity(`${y}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(o){const c=this._map.transform;return!!o&&o.x>=0&&o.x<c.width&&o.y>=0&&o.y<c.height}_updateDOM(){const o=this._pos||new d.pointGeometry(0,0),c=this._calculatePitch(),g=this._calculateRotation();this._element.style.transform=`${Cr[this._anchor]} translate(${o.x}px, ${o.y}px) rotateX(${c}deg) rotateZ(${g}deg)`}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(o){d.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=Lc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),!0===o?this._updateFrameId=d.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const o=this._map.transform,c=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&c._rotate(o.angle),"map"===this._pitchAlignment&&(c.y*=Math.cos(o._pitch)),c}getOffset(){return this._offset}setOffset(o){return this._offset=d.pointGeometry.convert(o),this._update(),this}_onMove(o){if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new d.Event("dragstart"))),this.fire(new d.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new d.Event("dragend")),this._state="inactive"}_addDragHandler(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&"auto"!==o?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class ze{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const c=d.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,c,g){this._start=this.getValue(c),this._end=o,this._startTime=c,this._endTime=c+g}}const Qt={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:ei,HTMLElement:zn,ImageBitmap:ha}=d.window,Vl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Gi(f){f.parentNode&&f.parentNode.removeChild(f)}const Uu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Oc{constructor(o,c,g=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new mi({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,g&&(this.mousePitch=new Ru({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),d.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(o,c){this.mouseRotate.mousedown(o,c),this.mousePitch&&this.mousePitch.mousedown(o,c),Ae.disableDrag()}move(o,c){const g=this.map,y=this.mouseRotate.mousemoveWindow(o,c);if(y&&y.bearingDelta&&g.setBearing(g.getBearing()+y.bearingDelta),this.mousePitch){const x=this.mousePitch.mousemoveWindow(o,c);x&&x.pitchDelta&&g.setPitch(g.getPitch()+x.pitchDelta)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ae.enableDrag(),d.window.removeEventListener("mousemove",this.mousemove),d.window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(d.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),Ae.mousePos(this.element,o)),d.window.addEventListener("mousemove",this.mousemove),d.window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,Ae.mousePos(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){1!==o.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ae.touchPos(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){1!==o.targetTouches.length?this.reset():(this._lastPos=Ae.touchPos(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){0===o.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const zc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let ti,Ss=0,es=!1;const mr={maxWidth:100,unit:"metric"};function Xe(f,o,c){const g=c&&c.maxWidth||100,y=f._containerHeight/2,x=f.unproject([0,y]),E=f.unproject([g,y]),T=x.distanceTo(E);if(c&&"imperial"===c.unit){const P=3.2808*T;P>5280?da(o,g,P/5280,f._getUIString("ScaleControl.Miles"),f):da(o,g,P,f._getUIString("ScaleControl.Feet"),f)}else c&&"nautical"===c.unit?da(o,g,T/1852,f._getUIString("ScaleControl.NauticalMiles"),f):T>=1e3?da(o,g,T/1e3,f._getUIString("ScaleControl.Kilometers"),f):da(o,g,T,f._getUIString("ScaleControl.Meters"),f)}function da(f,o,c,g,y){const x=function(T){const P=Math.pow(10,`${Math.floor(T)}`.length-1);let F=T/P;return F=F>=10?10:F>=5?5:F>=3?3:F>=2?2:F>=1?1:function(R){const z=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*z)/z}(F),P*F}(c),E=x/c;y._requestDomTask(()=>{f.style.width=o*E+"px",f.innerHTML=`${x}&nbsp;${g}`})}const pa={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ri=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Is={version:d.version,supported:Zn,setRTLTextPlugin:d.setRTLTextPlugin,getRTLTextPluginStatus:d.getRTLTextPluginStatus,Map:class extends _p{constructor(f){if(null!=(f=d.extend({},Vl,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Sc(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._renderTaskQueue=new Vu,this._domRenderTaskQueue=new Vu,this._controls=[],this._markers=[],this._mapId=d.uniqueId(),this._locale=d.extend({},Qt,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new ze(0),this._requestManager=new d.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,"string"==typeof f.container){if(this._container=d.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof zn))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&d.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),d.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==d.window&&(d.window.addEventListener("online",this._onWindowOnline,!1),d.window.addEventListener("resize",this._onWindowResize,!1),d.window.addEventListener("orientationchange",this._onWindowResize,!1),d.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Ms(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new pp("string"==typeof f.hash&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,d.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new Bu({customAttribution:f.customAttribution})),this._logoControl=new Nu,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update("style"===o.dataType),this.fire(new d.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new d.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(f,o){if(void 0===o&&(o=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const g=this._controlPositions[o];return-1!==o.indexOf("bottom")?g.insertBefore(c,g.firstChild):g.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(f);return o>-1&&this._controls.splice(o,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new d.Event("movestart",f)).fire(new d.Event("move",f)),this.fire(new d.Event("resize",f)),o&&this.fire(new d.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(d.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=null==f?-2:f)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=null==f?22:f)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=null==f?0:f)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=null==f?85:f)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getProjection(){return this.transform.getProjection()}setProjection(f){return this._lazyInitEmptyStyle(),"string"==typeof f&&(f={name:f}),this._runtimeProjection=f,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(f){return this.transform.locationPoint3D(d.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(d.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(f,o,c){if("mouseenter"===f||"mouseover"===f){let g=!1;const y=E=>{const T=o.filter(F=>this.getLayer(F)),P=T.length?this.queryRenderedFeatures(E.point,{layers:T}):[];P.length?g||(g=!0,c.call(this,new Nr(f,this,E.originalEvent,{features:P}))):g=!1},x=()=>{g=!1};return{layers:new Set(o),listener:c,delegates:{mousemove:y,mouseout:x}}}if("mouseleave"===f||"mouseout"===f){let g=!1;const y=E=>{const T=o.filter(P=>this.getLayer(P));(T.length?this.queryRenderedFeatures(E.point,{layers:T}):[]).length?g=!0:g&&(g=!1,c.call(this,new Nr(f,this,E.originalEvent)))},x=E=>{g&&(g=!1,c.call(this,new Nr(f,this,E.originalEvent)))};return{layers:new Set(o),listener:c,delegates:{mousemove:y,mouseout:x}}}{const g=y=>{const x=o.filter(T=>this.getLayer(T)),E=x.length?this.queryRenderedFeatures(y.point,{layers:x}):[];E.length&&(y.features=E,c.call(this,y),delete y.features)};return{layers:new Set(o),listener:c,delegates:{[f]:g}}}}on(f,o,c){if(void 0===c)return super.on(f,o);Array.isArray(o)||(o=[o]);const g=this._createDelegatedListener(f,o,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(g);for(const y in g.delegates)this.on(y,g.delegates[y]);return this}once(f,o,c){if(void 0===c)return super.once(f,o);Array.isArray(o)||(o=[o]);const g=this._createDelegatedListener(f,o,c);for(const y in g.delegates)this.once(y,g.delegates[y]);return this}off(f,o,c){if(void 0===c)return super.off(f,o);o=new Set(Array.isArray(o)?o:[o]);const g=(x,E)=>{if(x.size!==E.size)return!1;for(const T of x)if(!E.has(T))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[f]:void 0;return y&&(x=>{for(let E=0;E<x.length;E++){const T=x[E];if(T.listener===c&&g(T.layers,o)){for(const P in T.delegates)this.off(P,T.delegates[P]);return x.splice(E,1),this}}})(y),this}queryRenderedFeatures(f,o){return this.style?(void 0!==o||void 0===f||f instanceof d.pointGeometry||Array.isArray(f)||(o=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(f,o){return this.style.querySourceFeatures(f,o)}queryTerrainElevation(f,o){const c=this.transform.elevation;return c?(o=d.extend({},{exaggerated:!0},o),c.getAtPoint(d.MercatorCoordinate.fromLngLat(f),null,o.exaggerated)):null}setStyle(f,o){return!1!==(o=d.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(f,o))}_getUIString(f){const o=this._locale[f];if(null==o)throw new Error(`Missing UI string '${f}'`);return o}_updateStyle(f,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),f&&(this.style=new pi(this,o||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof f?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new pi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,o){if("string"==typeof f){const c=this._requestManager.normalizeStyleURL(f),g=this._requestManager.transformRequest(c,d.ResourceType.Style);d.getJSON(g,(y,x)=>{y?this.fire(new d.ErrorEvent(y)):x&&this._updateDiff(x,o)})}else"object"==typeof f&&this._updateDiff(f,o)}_updateDiff(f,o){try{this.style.setState(f)&&this._update(!0)}catch(c){d.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(f,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.warnOnce("There is no style added to the map.")}addSource(f,o){return this._lazyInitEmptyStyle(),this.style.addSource(f,o),this._update(!0)}isSourceLoaded(f){const o=this.style&&this.style._getSourceCaches(f);if(0!==o.length)return o.every(c=>c.loaded());this.fire(new d.ErrorEvent(new Error(`There is no source with ID '${f}'`)))}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const o in f){const c=f[o]._tiles;for(const g in c){const y=c[g];if("loaded"!==y.state&&"errored"!==y.state)return!1}}return!0}addSourceType(f,o,c){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,o,c)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,o,{pixelRatio:c=1,sdf:g=!1,stretchX:y,stretchY:x,content:E}={}){if(this._lazyInitEmptyStyle(),o instanceof ei||ha&&o instanceof ha){const{width:T,height:P,data:F}=d.exported.getImageData(o);this.style.addImage(f,{data:new d.RGBAImage({width:T,height:P},F),pixelRatio:c,stretchX:y,stretchY:x,content:E,sdf:g,version:0})}else{if(void 0===o.width||void 0===o.height)return this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:T,height:P,data:F}=o,R=o;this.style.addImage(f,{data:new d.RGBAImage({width:T,height:P},new Uint8Array(F)),pixelRatio:c,stretchX:y,stretchY:x,content:E,sdf:g,version:0,userImage:R}),R.onAdd&&R.onAdd(this,f)}}}updateImage(f,o){const c=this.style.getImage(f);if(!c)return this.fire(new d.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=o instanceof ei||ha&&o instanceof ha?d.exported.getImageData(o):o,{width:y,height:x,data:E}=g;return void 0===y||void 0===x?this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):y!==c.data.width||x!==c.data.height?this.fire(new d.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(c.data.replace(E,!(o instanceof ei||ha&&o instanceof ha)),void this.style.updateImage(f,c))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new d.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,o){d.getImage(this._requestManager.transformRequest(f,d.ResourceType.Image),(c,g)=>{o(c,g instanceof ei?d.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(f,o){return this._lazyInitEmptyStyle(),this.style.addLayer(f,o),this._update(!0)}moveLayer(f,o){return this.style.moveLayer(f,o),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,o,c){return this.style.setLayerZoomRange(f,o,c),this._update(!0)}setFilter(f,o,c={}){return this.style.setFilter(f,o,c),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,o,c,g={}){return this.style.setPaintProperty(f,o,c,g),this._update(!0)}getPaintProperty(f,o){return this.style.getPaintProperty(f,o)}setLayoutProperty(f,o,c,g={}){return this.style.setLayoutProperty(f,o,c,g),this._update(!0)}getLayoutProperty(f,o){return this.style.getLayoutProperty(f,o)}setLight(f,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){"globe"===this.transform.projection.name&&this.transform.zoom>=d.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(d.LngLat.convert(f),this.transform):0}setFeatureState(f,o){return this.style.setFeatureState(f,o),this._update()}removeFeatureState(f,o){return this.style.removeFeatureState(f,o),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let c,g=this._container;for(;g&&!c;){const y=d.window.getComputedStyle(g).transform;y&&"none"!==y&&(c=y.match(/matrix.*\((.+)\)/)[1].split(", ")),g=g.parentElement}c?(this._containerWidth=c[0]&&"0"!==c[0]?Math.abs(f/c[0]):f,this._containerHeight=c[3]&&"0"!==c[3]?Math.abs(o/c[3]):o):(this._containerWidth=f,this._containerHeight=o)}_detectMissingCSS(){"rgb(250, 128, 114)"!==d.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&d.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ae.create("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=Ae.create("div","mapboxgl-canvas-container",f);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=Ae.create("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=Ae.create("div","mapboxgl-control-container",f),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{g[y]=Ae.create("div",`mapboxgl-ctrl-${y}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,o){const c=d.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(o),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${o}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const o=this._markers.indexOf(f);-1!==o&&this._markers.splice(o,1)}_setupPainter(){const f=d.extend({},Zn.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);o?(d.storeAuthState(o,!0),this.painter=new zl(o,this.transform),this.on("data",c=>{"source"===c.dataType&&this.painter.setTileLoadedFlag(!0)}),d.exported$1.testSupport(o)):this.fire(new d.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new d.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let o;const c=this.painter.context.extTimerQuery,g=d.exported.now();this.listens("gpu-timing-frame")&&(o=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,o));let y=this._updateAverageElevation(g);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjection();let x=!1;const E=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,F=this.transform.pitch,R=d.exported.now();this.style.zoomHistory.update(P,R);const z=new d.EvaluationParameters(P,{now:R,fadeDuration:E,pitch:F,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),j=z.crossFadingFactor();1===j&&j===this._crossFadingFactor||(x=!0,this._crossFadingFactor=j),this.style.update(z)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,E,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new d.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new d.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const P=d.exported.now()-g;c.endQueryEXT(c.TIME_ELAPSED_EXT,o),setTimeout(()=>{const F=c.getQueryObjectEXT(o,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(o),this.fire(new d.Event("gpu-timing-frame",{cpuTime:P,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(P);this.fire(new d.Event("gpu-timing-layer",{layerTimes:F}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(T||this._repaint)this.triggerRepaint();else{const P=!this.isMoving()&&this.loaded();if(P&&(y=this._updateAverageElevation(g,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new d.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new d.Event("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const f of this._markers)f._update()}_updateAverageElevation(f,o=!1){const c=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);if((o||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const g=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();isNaN(y)?y=0:this._averageElevationLastSampledAt=f;const x=Math.abs(g-y);if(x>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(y),c(y);this._averageElevation.easeTo(y,f,300)}else if(x>1e-4)return this._averageElevation.jumpTo(y),c(y)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){d.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===d.AUTH_ERR_MSG||401===f.status)){const o=this.painter.context.gl;d.storeAuthState(o,!1),this._logoControl instanceof Nu&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new d.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),d.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const c=this.painter.context.gl,g=c.createFramebuffer();function y(x){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,x,0);const E=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,E),E}return c.bindFramebuffer(c.FRAMEBUFFER,g),this._canvasPixelComparison(y(f),o.canvasCopies.map(y),o.timeStamps)}_canvasPixelComparison(f,o,c){let g=c[1]-c[0];const y=f.length/4;for(let x=0;x<o.length;x++){const E=o[x];let T=0;for(let P=0;P<E.length;P+=4)E[P]===f[P]&&E[P+1]===f[P+1]&&E[P+2]===f[P+2]&&E[P+3]===f[P+3]&&(T+=1);g+=(c[x+2]-c[x+1])*(1-T/y)}return g}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==d.window&&(d.window.removeEventListener("resize",this._onWindowResize,!1),d.window.removeEventListener("orientationchange",this._onWindowResize,!1),d.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),d.window.removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),Gi(this._canvasContainer),Gi(this._controlContainer),Gi(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),d.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new d.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=d.exported.frame(o=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(o)}))}_preloadTiles(f){const o=this.style&&Object.values(this.style._sourceCaches)||[];return d.asyncAll(o,(c,g)=>c._preloadTiles(f,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,o){d.setCacheLimits(f,o)}get version(){return d.version}},NavigationControl:class{constructor(f){this.options=d.extend({},Uu,f),this._container=Ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(d.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),Ae.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),Ae.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(d.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=Ae.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const f=this._map.getZoom(),o=f===this._map.getMaxZoom(),c=f===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const f=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=f)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Oc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,o){const c=Ae.create("button",f,this._container);return c.type="button",c.addEventListener("click",o),c}_setButtonTitle(f,o){const c=this._map._getUIString(`NavigationControl.${o}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends d.Evented{constructor(f){super(),this.options=d.extend({},zc,f),d.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=la(this._updateMarkerRotation,20)}onAdd(f){var o;return this._map=f,this._container=Ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,void 0!==ti?o(ti):void 0!==d.window.navigator.permissions?d.window.navigator.permissions.query({name:"geolocation"}).then(c=>{ti="denied"!==c.state,o(ti)}):(ti=!!d.window.navigator.geolocation,o(ti)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,Ss=0,es=!1}_isOutOfMapMaxBounds(f){const o=this._map.getMaxBounds(),c=f.coords;return o&&(c.longitude<o.getWest()||c.longitude>o.getEast()||c.latitude<o.getSouth()||c.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new d.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("geolocate",f)),this._finish()}}_updateCamera(f){const o=new d.LngLat(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,g=this._map.getBearing(),y=d.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(c),y,{geolocateSource:!0})}_updateMarker(f){if(f){const o=new d.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map._containerHeight/2,o=this._map.unproject([0,f]),c=this._map.unproject([100,f]),g=o.distanceTo(c)/100,y=Math.ceil(2*this._accuracy/g);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&es)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=Ae.create("button","mapboxgl-ctrl-geolocate",this._container),Ae.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===f){d.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ae.create("div","mapboxgl-user-location"),this._dotElement.appendChild(Ae.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ae.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ju({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ae.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ju({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||"ACTIVE_LOCK"!==this._watchState||o.originalEvent&&"resize"===o.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new d.Event("trackuserlocationend")))})}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:!0===f.absolute&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return d.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ss--,es=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ss++,Ss>1?(f={maximumAge:6e5,timeout:0},es=!0):(f=this.options.positionOptions,es=!1),this._geolocationWatchID=d.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else d.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{d.window.addEventListener("ondeviceorientationabsolute"in d.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==d.window.DeviceMotionEvent&&"function"==typeof d.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(o=>{"granted"===o&&f()}).catch(console.error):f()}_clearWatch(){d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),d.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),d.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Bu,ScaleControl:class{constructor(f){this.options=d.extend({},mr,f),d.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Xe(this._map,this._container,this.options)}onAdd(f){return this._map=f,this._container=Ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(f){this.options.unit=f,Xe(this._map,this._container,this.options)}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof d.window.HTMLElement?this._container=f.container:d.warnOnce("Full screen control 'container' must be a DOM element.")),d.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in d.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in d.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,d.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!d.window.document.fullscreenEnabled&&!d.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Ae.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ae.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),d.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(d.window.document.fullscreenElement||d.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?d.window.document.exitFullscreen?d.window.document.exitFullscreen():d.window.document.webkitCancelFullScreen&&d.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends d.Evented{constructor(f){super(),this.options=d.extend(Object.create(pa),f),d.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new d.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new d.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=d.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(d.window.document.createTextNode(f))}setHTML(f){const o=d.window.document.createDocumentFragment(),c=d.window.document.createElement("body");let g;for(c.innerHTML=f;g=c.firstChild,g;)o.appendChild(g);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Ae.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._container&&this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._container&&this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let o;return this._classList.delete(f)?o=!1:(this._classList.add(f),o=!0),this._container&&this._updateClassList(),o}_createCloseButton(){this.options.closeButton&&(this._closeButton=Ae.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(f){this._update(f.point)}_onMouseMove(f){this._update(f.point)}_onDrag(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const o=this._pos,c=this._container.offsetWidth,g=this._container.offsetHeight;let y;return y=o.y+f.bottom.y<g?["top"]:o.y>this._map.transform.height-g?["bottom"]:[],o.x<c/2?y.push("left"):o.x>this._map.transform.width-c/2&&y.push("right"),0===y.length?"bottom":y.join("-")}_updateClassList(){const f=[...this._classList];f.push("mapboxgl-popup"),this._anchor&&f.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&f.push("mapboxgl-popup-track-pointer"),this._container.className=f.join(" ")}_update(f){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=Ae.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Ae.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Lc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f){const o=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),c=function(x){if(x||(x=new d.pointGeometry(0,0)),"number"==typeof x){const E=Math.round(Math.sqrt(.5*Math.pow(x,2)));return{center:new d.pointGeometry(0,0),top:new d.pointGeometry(0,x),"top-left":new d.pointGeometry(E,E),"top-right":new d.pointGeometry(-E,E),bottom:new d.pointGeometry(0,-x),"bottom-left":new d.pointGeometry(E,-E),"bottom-right":new d.pointGeometry(-E,-E),left:new d.pointGeometry(x,0),right:new d.pointGeometry(-x,0)}}if(x instanceof d.pointGeometry||Array.isArray(x)){const E=d.pointGeometry.convert(x);return{center:E,top:E,"top-left":E,"top-right":E,bottom:E,"bottom-left":E,"bottom-right":E,left:E,right:E}}return{center:d.pointGeometry.convert(x.center||[0,0]),top:d.pointGeometry.convert(x.top||[0,0]),"top-left":d.pointGeometry.convert(x["top-left"]||[0,0]),"top-right":d.pointGeometry.convert(x["top-right"]||[0,0]),bottom:d.pointGeometry.convert(x.bottom||[0,0]),"bottom-left":d.pointGeometry.convert(x["bottom-left"]||[0,0]),"bottom-right":d.pointGeometry.convert(x["bottom-right"]||[0,0]),left:d.pointGeometry.convert(x.left||[0,0]),right:d.pointGeometry.convert(x.right||[0,0])}}(this.options.offset),g=this._anchor=this._getAnchor(c),y=o.add(c[g]).round();this._map._requestDomTask(()=>{this._container&&g&&(this._container.style.transform=`${Cr[g]} translate(${y.x}px,${y.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Ri);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._content&&(this._content.style.opacity=f),this._tip&&(this._tip.style.opacity=f)}},Marker:ju,Style:pi,LngLat:d.LngLat,LngLatBounds:d.LngLatBounds,Point:d.pointGeometry,MercatorCoordinate:d.MercatorCoordinate,FreeCameraOptions:jh,Evented:d.Evented,config:d.config,prewarm:function(){ue().acquire(le)},clearPrewarmedResources:function(){const f=fe;f&&(f.isPreloaded()&&1===f.numActive()?(f.release(le),fe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return d.config.ACCESS_TOKEN},set accessToken(f){d.config.ACCESS_TOKEN=f},get baseApiUrl(){return d.config.API_URL},set baseApiUrl(f){d.config.API_URL=f},get workerCount(){return me.workerCount},set workerCount(f){me.workerCount=f},get maxParallelImageRequests(){return d.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){d.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){d.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:d.exported.setNow,restoreNow:d.exported.restoreNow};return Is}),jn}()}},rp=>{rp(rp.s=89)}]);